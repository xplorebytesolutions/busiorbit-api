# xByteChat Knowledge Pack
Generated: 2025-08-11 13:31:07 +00:00

--- file: xbytechat-api/appsettings.Development.json  (sha256:35b022f5fc4de497478a081242e17f923b0e21a2c3759fd915dbd31f7704e8cb)
`$lang
{
  "ConnectionStrings": {
    // "DefaultConnection": "Host=localhost;Port=5432;Database=xplorebyte_db;Username=postgres;Password=xplore2025"
    // "DefaultConnection": "Host=db.lxsqynuvccxyhltureew.supabase.co;Port=5432;Database=postgres;Username=postgres;Password=M_Eys9K@r/#PACt;SSL Mode=Require;Trust Server Certificate=true;",
    "DefaultConnection": "Host=ep-sweet-bar-aa16yopw-pooler.westus3.azure.neon.tech; Database=neondb; Username=neondb_owner; Password=npg_LW6vslyGz4YA; SSL Mode=VerifyFull; Channel Binding=Require;"

  },
  "Cors": {
    "AllowedOrigins": [
      "http://localhost:3000",
      "https://lively-field-0de5b8a00.1.azurestaticapps.net",
      "http://localhost:7113",
      "https://localhost:7114"
    ]
  },
  "JwtSettings": {
    "SecretKey": "dev-sevictcret-key-only-cliff-0a-for-tevictsting"
  },
  "WhatsApp": {
    "ApiToken": "EAAIo1fBYKV8BO6tGEYsdH461nPYdyJzlMorCAHYtiasvUorEYUcGCaRdzy0IMhh1D6h1ZBYHLbNWbvF2FrvlaviZCwhZCPeGKE2t62BTp77Ha1IwGvNlEeagFiZBiU7LrkMw11fOPng2PgDphl2vp3DTyZBtICJkhy6ikPGvylZA5aM2oWLoIBS6zZB6vOygIFLmgFKoC7lqYPpP8JydDJI9bVN6Kx73CZAtGS9abjGxnHAZD",
    "PhoneNumberId": "601884673011340",
    "MetaToken": "xbytechat-secret-token"
  }
}



//{
//  "Logging": {
//    "LogLevel": {
//      "Default": "Information",
//      "Microsoft.AspNetCore": "Warning"
//    }
//  },
//  "Cors": {
//    "AllowedOrigins": [
//      "https://victorious-cliff-0ae029a00.1.azurestaticapps.net",
//      "http://localhost:3000"

//    ]
//  }
//}

``n
--- file: xbytechat-api/appsettings.json  (sha256:058d76bd941f2b897aa4c3aba08e9314331322f189d187547969a9819ca3e9a1)
`$lang
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.Hosting.Lifetime": "Information"
    }
  },
  "AllowedHosts": "*",
  "JwtSettings": {
    "Issuer": "xbytechat-api",
    "Audience": "xbytechat-client",
    "ExpiryMinutes": 60
    // Leave SecretKey blank here
  },
  "WhatsApp": {
    // Put only non-secret defaults here (e.g. API base URL)
    "ApiUrl": "https://graph.facebook.com/v22.0/601884673011340/messages",
    "WABA_ID": "999432368375320"
  },
  "Cors": {
    "AllowedOrigins": []
    // you override this per environment
  },
  "ConnectionStrings": {
    // leave empty; override via environment or Key Vault
    "DefaultConnection": ""
  }
}


//{
//  "Logging": {
//    "LogLevel": {
//      "Default": "Information",
//      "Microsoft.AspNetCore": "Warning",
//      "Microsoft.Hosting.Lifetime": "Information" // this lines is used to display log in output window
//    }
//  },
//  "AllowedHosts": "*",
//  "WhatsApp": {
//    "ApiUrl": "https://graph.facebook.com/v22.0/601884673011340/messages",
//    "ApiToken": "EAAIo1fBYKV8BO6tGEYsdH461nPYdyJzlMorCAHYtiasvUorEYUcGCaRdzy0IMhh1D6h1ZBYHLbNWbvF2FrvlaviZCwhZCPeGKE2t62BTp77Ha1IwGvNlEeagFiZBiU7LrkMw11fOPng2PgDphl2vp3DTyZBtICJkhy6ikPGvylZA5aM2oWLoIBS6zZB6vOygIFLmgFKoC7lqYPpP8JydDJI9bVN6Kx73CZAtGS9abjGxnHAZD",
//    "PhoneNumberId": "601884673011340",
//    "MetaToken": "xbytechat-secret-token",
//    "WABA_ID": "999432368375320"

//  },
//  "ConnectionStrings": {
//    "DefaultConnection": "Host=localhost;Port=5432;Database=xplorebyte_db;Username=postgres;Password=xplore2025",
//    "postgresql": null, //postgres:[YOUR-PASSWORD]@db.lxsqynuvccxyhltureew.supabase.co:5432/postgres
//    "DefaultConnection": "Host=db.lxsqynuvccxyhltureew.supabase.co;Port=5432;Database=postgres;Username=postgres;Password=M_Eys9K@r/#PACt;SSL Mode=Require;Trust Server Certificate=true;"

//  },
//  "JwtSettings": {
//    "SecretKey": "your_super_secret_key_here_1234567890", // 🔒 make it strong
//    "Issuer": "xbytechat-api",
//    "Audience": "xbytechat-client",
//    "ExpiryMinutes": 60
//  }



//}

``n
--- file: xbytechat-api/AuthModule/Controllers/AuthController.cs  (sha256:ce71246c74ec02c0bea6716f2f97e3cec601650c44bd545fd698c7b1935f1e65)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.Security.Claims;
using xbytechat.api.AuthModule.DTOs;
using xbytechat.api.AuthModule.Services;
using xbytechat.api.Features.BusinessModule.DTOs;

namespace xbytechat.api.AuthModule.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class AuthController : ControllerBase
    {
        private readonly IAuthService _authService;

        public AuthController(IAuthService authService)
        {
            _authService = authService;
        }

        // ✅ Login → return { token } (NO cookies)
        [AllowAnonymous]
        [HttpPost("login")]
        public async Task<IActionResult> Login([FromBody] UserLoginDto dto)
        {
            var result = await _authService.LoginAsync(dto);
            if (!result.Success || string.IsNullOrWhiteSpace(result.Token))
                return Unauthorized(new { success = false, message = result.Message });

            return Ok(new { token = result.Token });
        }

        // (Optional) Refresh token endpoint if you still issue refresh tokens.
        // Returns tokens in body (NO cookies).
        [AllowAnonymous]
        [HttpPost("refresh-token")]
        public async Task<IActionResult> RefreshToken([FromBody] RefreshTokenRequest request)
        {
            var result = await _authService.RefreshTokenAsync(request.RefreshToken);
            if (!result.Success) return Unauthorized(new { success = false, message = result.Message });

            dynamic data = result.Data!;
            return Ok(new
            {
                accessToken = data.accessToken,
                refreshToken = data.refreshToken
            });
        }
        // ✅ Signup
        [HttpPost("business-user-signup")]
        public async Task<IActionResult> Signup([FromBody] SignupBusinessDto dto)
        {
            if (!ModelState.IsValid)
            {
                var errors = ModelState.Values
                    .SelectMany(v => v.Errors)
                    .Select(e => e.ErrorMessage)
                    .ToList();

                return BadRequest(new
                {
                    success = false,
                    message = "❌ Validation failed.",
                    errors
                });
            }

            var result = await _authService.SignupAsync(dto);
            return result.Success ? Ok(result) : BadRequest(result);
        }

        // ✅ Logout (stateless JWT): nothing server-side to do
        [Authorize]
        [HttpPost("logout")]
        public IActionResult Logout() => Ok(new { success = true, message = "Logged out" });

        // ✅ (Optional) lightweight session echo from claims (works with Bearer)
        [Authorize]
        [HttpGet("session")]
        public IActionResult GetSession()
        {
            var user = HttpContext.User;
            if (user?.Identity is not { IsAuthenticated: true }) return BadRequest("Invalid session");

            var email = user.FindFirst(ClaimTypes.Email)?.Value ?? "unknown";
            var role = user.FindFirst(ClaimTypes.Role)?.Value
                       ?? user.FindFirst("role")?.Value
                       ?? "unknown";
            var plan = user.FindFirst("plan")?.Value ?? "basic";
            var biz = user.FindFirst("businessId")?.Value;

            return Ok(new { isAuthenticated = true, role, email, plan, businessId = biz });
        }

        [Authorize]
        [HttpGet("features")]
        public async Task<IActionResult> GetFeatureAccess()
        {
            var result = await _authService.GetFeatureAccessForUserAsync(User);
            return Ok(result.Features);
        }
    }
}


//using Microsoft.AspNetCore.Authorization;
//using Microsoft.AspNetCore.Mvc;
//using xbytechat.api.AuthModule.DTOs;
//using xbytechat.api.AuthModule.Services;
//using xbytechat.api.Features.BusinessModule.DTOs;
//using System.Security.Claims;
//using xbytechat.api.Helpers;
//using xbytechat.api.Features.FeatureAccessModule.Services;
//using xbytechat.api.Features.FeatureAccess;
//namespace xbytechat.api.AuthModule.Controllers
//{
//    [ApiController]
//    [Route("api/[controller]")]
//    public class AuthController : ControllerBase
//    {
//        private readonly IAuthService _authService;
//        private readonly IFeatureAccessService _featureAccessService;
//        public AuthController(IAuthService authService, IFeatureAccessService featureAccessService)
//        {
//            _authService = authService;
//            _featureAccessService = featureAccessService;
//        }

//        // ✅ Login
//        [AllowAnonymous]
//        [HttpPost("login")]
//        public async Task<IActionResult> Login([FromBody] UserLoginDto dto)
//        {
//            var result = await _authService.LoginAsync(dto);

//            if (!result.Success || string.IsNullOrWhiteSpace(result.Token))
//                return Unauthorized(result);

//            JwtCookieHelper.SetJwtCookie(HttpContext, "xbyte_token", result.Token);

//            if (!string.IsNullOrEmpty(result.RefreshToken))
//            {
//                JwtCookieHelper.SetRefreshTokenCookie(HttpContext, "xbyte_refresh", result.RefreshToken);
//            }

//            return Ok(new
//            {
//                success = true,
//                message = result.Message,
//                data = result.Data
//            });
//        }

//        // ✅ Refresh Token
//        // ✅ Refresh Token with cookie update
//        [AllowAnonymous]
//        [HttpPost("refresh-token")]
//        public async Task<IActionResult> RefreshToken([FromBody] RefreshTokenRequest request)
//        {
//            var result = await _authService.RefreshTokenAsync(request.RefreshToken);

//            if (!result.Success)
//                return Unauthorized(result);

//            dynamic data = result.Data;
//            var newAccessToken = data?.accessToken?.ToString();
//            var newRefreshToken = data?.refreshToken?.ToString();

//            // ✅ Set new JWT token in cookie
//            if (!string.IsNullOrEmpty(newAccessToken))
//                JwtCookieHelper.SetJwtCookie(HttpContext, "xbyte_token", newAccessToken);

//            // ✅ Set new refresh token in cookie (rotated)
//            if (!string.IsNullOrEmpty(newRefreshToken))
//                JwtCookieHelper.SetRefreshTokenCookie(HttpContext, "xbyte_refresh", newRefreshToken);

//            return Ok(new
//            {
//                success = true,
//                message = result.Message
//            });
//        }

//        // ✅ Logout
//        [HttpPost("logout")]
//        public IActionResult Logout()
//        {
//            JwtCookieHelper.ClearJwtCookie(HttpContext, "xbyte_token");
//            return Ok(new
//            {
//                success = true,
//                message = "🚪 Logged out successfully"
//            });
//        }

//        // ✅ Signup
//        [HttpPost("business-user-signup")]
//        public async Task<IActionResult> Signup([FromBody] SignupBusinessDto dto)
//        {
//            if (!ModelState.IsValid)
//            {
//                var errors = ModelState.Values
//                    .SelectMany(v => v.Errors)
//                    .Select(e => e.ErrorMessage)
//                    .ToList();

//                return BadRequest(new
//                {
//                    success = false,
//                    message = "❌ Validation failed.",
//                    errors
//                });
//            }

//            var result = await _authService.SignupAsync(dto);
//            return result.Success ? Ok(result) : BadRequest(result);
//        }

//        // 🔁 Resend confirmation
//        [HttpPost("resend-confirmation")]
//        public async Task<IActionResult> ResendConfirmation([FromBody] ResendConfirmationDto dto)
//        {
//            var result = await _authService.ResendConfirmationAsync(dto);
//            return result.Success ? Ok(result) : BadRequest(result);
//        }

//        // 🔐 Reset password
//        [HttpPost("reset-password")]
//        public async Task<IActionResult> ResetPassword([FromBody] ResetPasswordDto dto)
//        {
//            var result = await _authService.ResetPasswordAsync(dto);
//            return result.Success ? Ok(result) : BadRequest(result);
//        }
//        [Authorize]
//        [HttpGet("features")]
//        public async Task<IActionResult> GetFeatureAccess()
//        {
//            var result = await _authService.GetFeatureAccessForUserAsync(User);
//            return Ok(result.Features);
//        }
//        // ✅ Session Info
//        [Authorize]
//        [HttpGet("session")]
//        public IActionResult GetSession()
//        {
//            var identity = HttpContext.User.Identity as ClaimsIdentity;
//            if (identity == null || !identity.IsAuthenticated)
//                return BadRequest("Invalid session");

//            var email = identity.FindFirst(ClaimTypes.Email)?.Value ?? "unknown";
//            var role = identity.FindFirst(ClaimTypes.Role)?.Value ?? "unknown";
//            var plan = identity.FindFirst("Plan")?.Value ?? "basic";

//            return Ok(new
//            {
//                isAuthenticated = true,
//                role = role,
//                email = email,
//                plan = plan
//            });
//        }


//    }

//}

``n
--- file: xbytechat-api/AuthModule/Controllers/TestJwtController.cs  (sha256:c407c3fdf8977cffcb0cd6131f617087ede160fd75646be61000b68f7a455a22)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Helpers;

namespace xbytechat.api.AuthModule.Controllers
{
    [ApiController]
    [Route("api/auth/test")]
    public class TestJwtController : ControllerBase
    {
        [Authorize]
        [HttpGet("get-logged-in")]
        public IActionResult GetLoggedInUserInfo()
        {
            var userId = UserContextHelper.GetUserId(User);
            var businessId = UserContextHelper.GetBusinessId(User);
            var role = UserContextHelper.GetRole(User);
            var plan = UserContextHelper.GetPlan(User);
            var companyName = UserContextHelper.GetCompanyName(User);

            return Ok(new
            {
                success = true,
                message = "🔐 JWT is valid. Here's your decoded info:",
                data = new
                {
                    userId,
                    businessId,
                    role,
                    plan,
                    companyName
                }
            });
        }

        [HttpGet("get-current-user")]
        public IActionResult GetCurrentUser()
        {
            if (User?.Identity?.IsAuthenticated != true)
            {
                return Unauthorized(new { success = false, message = "❌ Not authenticated" });
            }

            var userId = User.FindFirst("sub")?.Value;
            var email = User.FindFirst("email")?.Value;
            var role = User.FindFirst("role")?.Value;
            var businessId = User.FindFirst("businessId")?.Value;
            var plan = User.FindFirst("plan")?.Value;
            var permissions = User.FindFirst("permissions")?.Value;

            return Ok(new
            {
                success = true,
                message = "✅ Token is valid",
                user = new
                {
                    userId,
                    email,
                    role,
                    businessId,
                    plan,
                    permissions
                }
            });
        }
    }
}


``n
--- file: xbytechat-api/AuthModule/DTOs/FeatureAccessDto.cs  (sha256:2cd5dd1900f770fb91216632561ec241edda181aa0f8f394ca384f8ce04f70b0)
`$lang
// 📁 xbytechat.api/AuthModule/DTOs/FeatureAccessDto.cs
namespace xbytechat.api.AuthModule.DTOs
{
    public class FeatureAccessDto
    {
        public Dictionary<string, bool> Features { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/AuthModule/DTOs/RefreshTokenRequest.cs  (sha256:5f68342bebd5c2664561285523bcabe509a7ffe5fe9c995eeeaf821aba238e2d)
`$lang
namespace xbytechat.api.AuthModule.DTOs
{
    public class RefreshTokenRequest
    {
        public string RefreshToken { get; set; }
    }
}

``n
--- file: xbytechat-api/AuthModule/DTOs/ResendConfirmationDto.cs  (sha256:c390da7f0aa2324928025edc1a4ce1c65e079357cb2219fade8cdc4153734982)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.AuthModule.DTOs
{
    public class ResendConfirmationDto
    {
        [Required]
        [EmailAddress]
        public string Email { get; set; }
    }
}


``n
--- file: xbytechat-api/AuthModule/DTOs/ResetPasswordDto.cs  (sha256:33b22ea5acec9376aef19d7c09ff580b689f7a6bc04ea1d6f214dd9b203de0c4)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.AuthModule.DTOs
{
    public class ResetPasswordDto
    {
        [Required]
        [EmailAddress]
        public string Email { get; set; }

        [Required]
        [MinLength(6, ErrorMessage = "Password must be at least 6 characters long.")]
        public string NewPassword { get; set; }
    }
}

``n
--- file: xbytechat-api/AuthModule/DTOs/UserDto.cs  (sha256:c8fac7c15eafd37ea475d69d23d7448809fe9be92d3b2617370b705721b860d3)
`$lang
namespace xbytechat.api.AuthModule.DTOs
{
    public class UserDto
    {
        public Guid Id { get; set; }
        public string Name { get; set; }
        public string Email { get; set; }
        public string Role { get; set; }
        public string Status { get; set; }
        public DateTime CreatedAt { get; set; }

        // ✅ Extra fields
        public Guid BusinessId { get; set; }
        public string CompanyName { get; set; }
        public string Plan { get; set; }
        public string AccessToken { get; set; }
    }
}

``n
--- file: xbytechat-api/AuthModule/DTOs/UserLoginDto.cs  (sha256:d0b1140af88b221c2cb7dbd58223d5803643620b16d27f016aba26ed9b816482)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.AuthModule.DTOs
{
    public class UserLoginDto
    {
        [Required]
        [EmailAddress]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }
    }
}

``n
--- file: xbytechat-api/AuthModule/Models/User.cs  (sha256:25f82a426c60ebda55385071a527cb10389e2f164415031be0a718cc4dc8f768)
`$lang
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.AccessControl.Models;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.BusinessModule.Models; // 🆕 Required for navigation

namespace xbytechat.api.AuthModule.Models
{
    public class User
    {
        public Guid Id { get; set; }

        // 🔗 FK to Business
        public Guid? BusinessId { get; set; }
        public Business Business { get; set; }

        // 👤 User Info
        [Required]
        public string Name { get; set; }

        [Required]
        [EmailAddress]
        public string Email { get; set; }

        [Required]
        public string PasswordHash { get; set; }

        // 🛡️ Role System
        // 🛡️ Role System (FK + Navigation)
        public Guid? RoleId { get; set; }
        public Role Role { get; set; }// admin / business / agent / staff

        // ✅ Status Management
        public string Status { get; set; } = "Pending"; // Active / Hold / Rejected / Pending

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        // 🗑️ Soft Delete Role 
        public bool IsDeleted { get; set; } = false;
        public DateTime? DeletedAt { get; set; }

        public List<CampaignSendLog> SendLogs { get; set; }
        public ICollection<MessageStatusLog> MessageStatusLogs { get; set; }

        // 🆕 Permission Navigation
        public ICollection<UserPermission> UserPermissions { get; set; } // 💡 Enables .WithMany(u => u.UserPermissions)
        public string? RefreshToken { get; set; }
        public DateTime? RefreshTokenExpiry { get; set; }

    }
}

``n
--- file: xbytechat-api/AuthModule/Roles/UserRoles.cs  (sha256:5a91bb09b9b5fc0f5fe14cf1b9727c0c8a8de225c71455452a14d491125209c5)
`$lang
namespace xbytechat.api.AuthModule.Roles
{
    public static class UserRoles
    {
        public const string Admin = "admin";         // xByte Admin
        public const string Business = "business";   // Tenant Admin
        public const string Staff = "staff";         // CRM Staff (future)
        public const string Agent = "agent";         // WhatsApp/chat agent
        public const string CRM = "crm";             // CRM-only user (future)
        public const string Partner = "partner";
    }
}

``n
--- file: xbytechat-api/AuthModule/Services/AuthService.cs  (sha256:b7d8a43e90f99562d5b03847cec6fbd79fd7009215f4a89c58388c1dc8212aed)
`$lang
using System.Security.Cryptography;
using System.Text;
using xbytechat.api.AuthModule.DTOs;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Helpers;
using xbytechat.api.Repositories.Interfaces;
using xbytechat.api.Features.AccessControl.Services;
using Microsoft.EntityFrameworkCore;
using Microsoft.AspNetCore.Http;
using xbytechat.api.Features.BusinessModule.DTOs;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.BusinessModule.Services;
using xbytechat.api.Features.FeatureAccessModule.Models;
using System.Security.Claims;
using System.IdentityModel.Tokens.Jwt;
using Microsoft.Extensions.Logging;

namespace xbytechat.api.AuthModule.Services
{
    public class AuthService : IAuthService
    {
        private readonly IGenericRepository<User> _userRepo;
        private readonly IBusinessService _businessService;
        private readonly IJwtTokenService _jwtTokenService;
        private readonly IAccessControlService _accessControlService;
        private readonly IHttpContextAccessor _httpContextAccessor;
        private readonly ILogger<AuthService> _logger;
        private readonly AppDbContext _dbContext;
        public AuthService(
            IGenericRepository<User> userRepo,
            IBusinessService businessService,
            IJwtTokenService jwtTokenService,
            IAccessControlService accessControlService,
            IHttpContextAccessor httpContextAccessor,
            ILogger<AuthService> logger,
            AppDbContext dbContext)
        {
            _userRepo = userRepo;
            _businessService = businessService;
            _jwtTokenService = jwtTokenService;
            _accessControlService = accessControlService;
            _httpContextAccessor = httpContextAccessor;
            _logger = logger;
            _dbContext = dbContext;
        }

        // 🔑 Production-grade Login
        //public async Task<ResponseResult> LoginAsync(UserLoginDto dto)
        //{
        //    _logger.LogInformation("🔑 Login attempt for email: {Email}", dto.Email);
        //    var hashedPassword = HashPassword(dto.Password);

        //    var user = await _userRepo
        //        .AsQueryable()
        //        .Where(u => u.Email == dto.Email && u.PasswordHash == hashedPassword && !u.IsDeleted)
        //        .Include(u => u.Role)
        //        .FirstOrDefaultAsync();

        //    if (user == null)
        //    {
        //        _logger.LogWarning("❌ Login failed: Invalid email or password for {Email}", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Invalid email or password");
        //    }

        //    var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
        //    var isAdminType = roleName == "admin" || roleName == "superadmin" || roleName == "partner" || roleName == "reseller";
        //    _logger.LogInformation("User role detected: {Role} (AdminType: {IsAdminType})", roleName, isAdminType);

        //    if (user.BusinessId == null && !isAdminType)
        //    {
        //        _logger.LogWarning("❌ Login denied for {Email}: No BusinessId and not admin", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Your account approval is pending. Please contact your administrator or support.");
        //    }

        //    Business business = null;
        //    if (user.BusinessId != null)
        //    {
        //        business = await _businessService
        //            .Query()
        //            .Include(b => b.BusinessPlanInfo)
        //            .FirstOrDefaultAsync(b => b.Id == user.BusinessId.Value);

        //        if (business == null)
        //        {
        //            _logger.LogError("❌ Login error: Business not found for user {UserId}", user.Id);
        //            return ResponseResult.ErrorInfo("❌ Associated business not found.");
        //        }

        //        if (business.Status == Business.StatusType.Pending)
        //        {
        //            _logger.LogWarning("⏳ Login blocked: Business under review (BusinessId: {BusinessId})", business.Id);
        //            return ResponseResult.ErrorInfo("⏳ Your business is under review. Please wait for approval.");
        //        }
        //    }

        //    var permissions = await _accessControlService.GetPermissionsAsync(user.Id);

        //    string planName;
        //    string companyName;
        //    string businessId = user.BusinessId?.ToString() ?? "";

        //    if (isAdminType)
        //    {
        //        planName = roleName;
        //        companyName = "xByte Admin";
        //        businessId = "";
        //        _logger.LogInformation("Admin/superadmin login. Plan set as role: {Plan}", planName);
        //    }
        //    else
        //    {
        //        planName = business?.BusinessPlanInfo?.Plan.ToString() ?? "";
        //        companyName = business?.CompanyName ?? "";
        //        _logger.LogInformation("Business login. Plan: {Plan}, Company: {Company}", planName, companyName);
        //    }

        //    var claims = new List<Claim>
        //    {
        //        new Claim(JwtRegisteredClaimNames.Sub, user.Id.ToString()),
        //        new Claim(JwtRegisteredClaimNames.Email, user.Email ?? ""),
        //        new Claim("name", user.Name ?? ""),
        //        new Claim(ClaimTypes.Role, roleName),
        //        new Claim("role", roleName),
        //        new Claim("status", user.Status ?? "unknown"),
        //        new Claim("plan", planName ?? ""),
        //        new Claim("businessId", businessId),
        //        new Claim("companyName", companyName ?? "")
        //    };

        //    if (permissions?.Any() == true)
        //    {
        //        claims.AddRange(permissions.Select(p => new Claim("perm", p)));
        //    }

        //    var token = _jwtTokenService.GenerateToken(claims);

        //    var userDto = new UserDto
        //    {
        //        Id = user.Id,
        //        Name = user.Name,
        //        Email = user.Email,
        //        Role = roleName,
        //        Status = user.Status,
        //        CreatedAt = user.CreatedAt,
        //        BusinessId = string.IsNullOrEmpty(businessId) ? Guid.Empty : Guid.Parse(businessId),
        //        CompanyName = companyName,
        //        Plan = planName,
        //        AccessToken = null
        //    };

        //    _logger.LogInformation("✅ Login successful for {Email}, Role: {Role}, Plan: {Plan}", dto.Email, roleName, planName);

        //    return new ResponseResult
        //    {
        //        Success = true,
        //        Message = "✅ Login successful",
        //        Data = userDto,
        //        Token = token
        //    };
        //}

        // 🟢 Signup Business User

        //public async Task<ResponseResult> LoginAsync(UserLoginDto dto)
        //{
        //    _logger.LogInformation("🔑 Login attempt for email: {Email}", dto.Email);
        //    var hashedPassword = HashPassword(dto.Password);

        //    var user = await _userRepo
        //        .AsQueryable()
        //        .Where(u => u.Email == dto.Email && u.PasswordHash == hashedPassword && !u.IsDeleted)
        //        .Include(u => u.Role)
        //        .FirstOrDefaultAsync();

        //    if (user == null)
        //    {
        //        _logger.LogWarning("❌ Login failed: Invalid email or password for {Email}", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Invalid email or password");
        //    }

        //    var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
        //    var isAdminType = roleName == "admin" || roleName == "superadmin" || roleName == "partner" || roleName == "reseller";
        //    _logger.LogInformation("User role detected: {Role} (AdminType: {IsAdminType})", roleName, isAdminType);

        //    if (user.BusinessId == null && !isAdminType)
        //    {
        //        _logger.LogWarning("❌ Login denied for {Email}: No BusinessId and not admin", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Your account approval is pending. Please contact your administrator or support.");
        //    }

        //    Business business = null;
        //    if (user.BusinessId != null)
        //    {
        //        business = await _businessService
        //            .Query()
        //            .Include(b => b.BusinessPlanInfo)
        //            .FirstOrDefaultAsync(b => b.Id == user.BusinessId.Value);

        //        if (business == null)
        //        {
        //            _logger.LogError("❌ Login error: Business not found for user {UserId}", user.Id);
        //            return ResponseResult.ErrorInfo("❌ Associated business not found.");
        //        }

        //        if (business.Status == Business.StatusType.Pending)
        //        {
        //            _logger.LogWarning("⏳ Login blocked: Business under review (BusinessId: {BusinessId})", business.Id);
        //            return ResponseResult.ErrorInfo("⏳ Your business is under review. Please wait for approval.");
        //        }
        //    }

        //    var permissions = await _accessControlService.GetPermissionsAsync(user.Id);

        //    string planName;
        //    string companyName;
        //    string businessId = user.BusinessId?.ToString() ?? "";

        //    if (isAdminType)
        //    {
        //        planName = roleName; // 'superadmin', 'admin', etc.
        //        companyName = "xByte Admin";
        //        businessId = "";
        //        _logger.LogInformation("Admin/superadmin login. Plan set as role: {Plan}", planName);
        //    }
        //    else
        //    {
        //        planName = business?.BusinessPlanInfo?.Plan.ToString() ?? "";
        //        companyName = business?.CompanyName ?? "";
        //        _logger.LogInformation("Business login. Plan: {Plan}, Company: {Company}", planName, companyName);
        //    }

        //    // ✅ Generate token with full claims
        //    var token = _jwtTokenService.GenerateToken(
        //        user.Id.ToString(),
        //        roleName,
        //        user.Name ?? "",
        //        user.Email ?? "",
        //        user.Status ?? "unknown",
        //        businessId,
        //        companyName,
        //        planName,
        //        permissions ?? new List<string>()
        //    );

        //    // ✅ User info for frontend
        //    var userDto = new UserDto
        //    {
        //        Id = user.Id,
        //        Name = user.Name,
        //        Email = user.Email,
        //        Role = roleName,
        //        Status = user.Status,
        //        CreatedAt = user.CreatedAt,
        //        BusinessId = string.IsNullOrEmpty(businessId) ? Guid.Empty : Guid.Parse(businessId),
        //        CompanyName = companyName,
        //        Plan = planName,
        //        AccessToken = null
        //    };

        //    _logger.LogInformation("✅ Login successful for {Email}, Role: {Role}, Plan: {Plan}", dto.Email, roleName, planName);

        //    return new ResponseResult
        //    {
        //        Success = true,
        //        Message = "✅ Login successful",
        //        Data = userDto,
        //        Token = token
        //    };
        //}
        //public async Task<ResponseResult> LoginAsync(UserLoginDto dto)
        //{
        //    _logger.LogInformation("🔑 Login attempt for email: {Email}", dto.Email);
        //    var hashedPassword = HashPassword(dto.Password);

        //    var user = await _userRepo
        //        .AsQueryable()
        //        .Where(u => u.Email == dto.Email && u.PasswordHash == hashedPassword && !u.IsDeleted)
        //        .Include(u => u.Role)
        //        .FirstOrDefaultAsync();

        //    if (user == null)
        //    {
        //        _logger.LogWarning("❌ Login failed: Invalid email or password for {Email}", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Invalid email or password");
        //    }

        //    var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
        //    var isAdminType = roleName == "admin" || roleName == "superadmin" || roleName == "partner" || roleName == "reseller";
        //    _logger.LogInformation("User role detected: {Role} (AdminType: {IsAdminType})", roleName, isAdminType);

        //    if (user.BusinessId == null && !isAdminType)
        //    {
        //        _logger.LogWarning("❌ Login denied for {Email}: No BusinessId and not admin", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Your account approval is pending. Please contact your administrator or support.");
        //    }

        //    Business business = null;
        //    if (user.BusinessId != null)
        //    {
        //        business = await _businessService
        //            .Query()
        //            .Include(b => b.BusinessPlanInfo)
        //            .FirstOrDefaultAsync(b => b.Id == user.BusinessId.Value);

        //        if (business == null)
        //        {
        //            _logger.LogError("❌ Login error: Business not found for user {UserId}", user.Id);
        //            return ResponseResult.ErrorInfo("❌ Associated business not found.");
        //        }

        //        if (business.Status == Business.StatusType.Pending)
        //        {
        //            _logger.LogWarning("⏳ Login blocked: Business under review (BusinessId: {BusinessId})", business.Id);
        //            return ResponseResult.ErrorInfo("⏳ Your business is under review. Please wait for approval.");
        //        }
        //    }

        //    var permissions = await _accessControlService.GetPermissionsAsync(user.Id);

        //    string planName;
        //    string companyName;
        //    string businessId = user.BusinessId?.ToString() ?? "";

        //    if (isAdminType)
        //    {
        //        planName = roleName; // 'superadmin', 'admin', etc.
        //        companyName = "xByte Admin";
        //        businessId = "";
        //        _logger.LogInformation("Admin/superadmin login. Plan set as role: {Plan}", planName);
        //    }
        //    else
        //    {
        //        planName = business?.BusinessPlanInfo?.Plan.ToString() ?? "";
        //        companyName = business?.CompanyName ?? "";
        //        _logger.LogInformation("Business login. Plan: {Plan}, Company: {Company}", planName, companyName);
        //    }

        //    // ✅ Generate token with full claims
        //    var token = _jwtTokenService.GenerateToken(
        //        user.Id.ToString(),
        //        roleName,
        //        user.Name ?? "",
        //        user.Email ?? "",
        //        user.Status ?? "unknown",
        //        businessId,
        //        companyName,
        //        planName,
        //        permissions ?? new List<string>()
        //    );

        //    // ✅ Store token in secure HttpOnly cookie
        //    _httpContextAccessor.HttpContext.Response.Cookies.Append("xbyte_token", token, new CookieOptions
        //    {
        //        HttpOnly = true,
        //        Secure = true, // Set to false only for localhost if needed
        //        SameSite = SameSiteMode.Lax,
        //        Expires = DateTime.UtcNow.AddDays(7)
        //    });

        //    // ✅ User info for frontend
        //    var userDto = new UserDto
        //    {
        //        Id = user.Id,
        //        Name = user.Name,
        //        Email = user.Email,
        //        Role = roleName,
        //        Status = user.Status,
        //        CreatedAt = user.CreatedAt,
        //        BusinessId = string.IsNullOrEmpty(businessId) ? Guid.Empty : Guid.Parse(businessId),
        //        CompanyName = companyName,
        //        Plan = planName,
        //        AccessToken = null
        //    };

        //    _logger.LogInformation("✅ Login successful for {Email}, Role: {Role}, Plan: {Plan}", dto.Email, roleName, planName);

        //    return new ResponseResult
        //    {
        //        Success = true,
        //        Message = "✅ Login successful",
        //        Data = userDto,
        //        Token = token
        //    };
        //}

        #region // Below Code comeneted to replace cokkies to bearer

        //public async Task<ResponseResult> LoginAsync(UserLoginDto dto)
        //{
        //    _logger.LogInformation("🔑 Login attempt for email: {Email}", dto.Email);
        //    var hashedPassword = HashPassword(dto.Password);

        //    var user = await _userRepo
        //        .AsQueryable()
        //        .Where(u => u.Email == dto.Email && u.PasswordHash == hashedPassword && !u.IsDeleted)
        //        .Include(u => u.Role)
        //        .FirstOrDefaultAsync();

        //    if (user == null)
        //    {
        //        _logger.LogWarning("❌ Login failed: Invalid email or password for {Email}", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Invalid email or password");
        //    }

        //    var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
        //    var isAdminType = roleName == "admin" || roleName == "superadmin" || roleName == "partner" || roleName == "reseller";

        //    if (user.BusinessId == null && !isAdminType)
        //    {
        //        _logger.LogWarning("❌ Login denied for {Email}: No BusinessId and not admin", dto.Email);
        //        return ResponseResult.ErrorInfo("❌ Your account approval is pending. Please contact your administrator or support.");
        //    }

        //    Business business = null;
        //    if (user.BusinessId != null)
        //    {
        //        business = await _businessService.Query()
        //            .Include(b => b.BusinessPlanInfo)
        //            .FirstOrDefaultAsync(b => b.Id == user.BusinessId.Value);

        //        if (business == null)
        //        {
        //            _logger.LogError("❌ Login error: Business not found for user {UserId}", user.Id);
        //            return ResponseResult.ErrorInfo("❌ Associated business not found.");
        //        }

        //        if (business.Status == Business.StatusType.Pending)
        //        {
        //            _logger.LogWarning("⏳ Login blocked: Business under review (BusinessId: {BusinessId})", business.Id);
        //            return ResponseResult.ErrorInfo("⏳ Your business is under review. Please wait for approval.");
        //        }
        //    }

        //    var permissions = await _accessControlService.GetPermissionsAsync(user.Id);

        //    string planName;
        //    string companyName;
        //    string businessId = user.BusinessId?.ToString() ?? "";

        //    if (isAdminType)
        //    {
        //        planName = roleName; // e.g., 'superadmin'
        //        companyName = "xByte Admin";
        //        businessId = ""; // Admins are not tied to a business
        //    }
        //    else
        //    {
        //        planName = business?.BusinessPlanInfo?.Plan.ToString() ?? "";
        //        companyName = business?.CompanyName ?? "";
        //    }

        //    // ✅ Generate JWT with lowercase claim keys
        //    var token = _jwtTokenService.GenerateToken(
        //        user.Id.ToString(),
        //        roleName,
        //        user.Name ?? "",
        //        user.Email ?? "",
        //        user.Status ?? "unknown",
        //        businessId,
        //        companyName,
        //        planName,
        //        permissions ?? new List<string>()
        //    );

        //    // ✅ Store token securely as cookie (must match JwtBearer event)
        //    _httpContextAccessor.HttpContext.Response.Cookies.Append("xbyte_token", token, 

        //        new CookieOptions
        //    {
        //        HttpOnly = true,
        //        Secure = true,
        //       // SameSite = SameSiteMode.Strict,
        //        SameSite = SameSiteMode.None,
        //        Expires = DateTime.UtcNow.AddDays(7),
        //        Domain = "http://localhost:3000"
        //    });

        //    // ✅ Build user info for frontend
        //    var userDto = new UserDto
        //    {
        //        Id = user.Id,
        //        Name = user.Name,
        //        Email = user.Email,
        //        Role = roleName,
        //        Status = user.Status,
        //        CreatedAt = user.CreatedAt,
        //        BusinessId = string.IsNullOrEmpty(businessId) ? Guid.Empty : Guid.Parse(businessId),
        //        CompanyName = companyName,
        //        Plan = planName,
        //        AccessToken = null // Not needed since we're using secure cookie
        //    };

        //    _logger.LogInformation("✅ Login successful for {Email}, Role: {Role}, Plan: {Plan}", dto.Email, roleName, planName);

        //    return new ResponseResult
        //    {
        //        Success = true,
        //        Message = "✅ Login successful",
        //        Data = userDto,
        //        Token = token
        //    };
        //}

        #endregion

        public async Task<ResponseResult> LoginAsync(UserLoginDto dto)
        {
            _logger.LogInformation("🔑 Login attempt for email: {Email}", dto.Email);
            var hashedPassword = HashPassword(dto.Password);

            var user = await _userRepo
                .AsQueryable()
                .Where(u => u.Email == dto.Email && u.PasswordHash == hashedPassword && !u.IsDeleted)
                .Include(u => u.Role)
                .FirstOrDefaultAsync();

            if (user == null)
            {
                _logger.LogWarning("❌ Login failed: Invalid email or password for {Email}", dto.Email);
                return ResponseResult.ErrorInfo("❌ Invalid email or password");
            }

            var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
            var isAdminType = roleName is "admin" or "superadmin" or "partner" or "reseller";

            if (user.BusinessId == null && !isAdminType)
            {
                _logger.LogWarning("❌ Login denied for {Email}: No BusinessId and not admin", dto.Email);
                return ResponseResult.ErrorInfo("❌ Your account approval is pending. Please contact your administrator or support.");
            }

            Business? business = null;
            if (user.BusinessId != null)
            {
                business = await _businessService.Query()
                    .Include(b => b.BusinessPlanInfo)
                    .FirstOrDefaultAsync(b => b.Id == user.BusinessId.Value);

                if (business == null)
                    return ResponseResult.ErrorInfo("❌ Associated business not found.");

                if (business.Status == Business.StatusType.Pending)
                    return ResponseResult.ErrorInfo("⏳ Your business is under review. Please wait for approval.");
            }

            var permissions = await _accessControlService.GetPermissionsAsync(user.Id);

            string planName;
            string companyName;
            string businessId = user.BusinessId?.ToString() ?? "";

            if (isAdminType)
            {
                planName = roleName;        // admin types treated as plan in UI
                companyName = "xByte Admin";
                businessId = "";
            }
            else
            {
                planName = business?.BusinessPlanInfo?.Plan.ToString() ?? "basic";
                companyName = business?.CompanyName ?? "";
            }

            // ✅ Generate JWT (includes role/plan/biz + ClaimTypes.Role)
            var token = _jwtTokenService.GenerateToken(
                user.Id.ToString(),
                roleName,
                user.Name ?? "",
                user.Email ?? "",
                user.Status ?? "unknown",
                businessId,
                companyName,
                planName,
                permissions ?? new List<string>()
            );

            // ❌ NO cookie writes in Bearer mode

            var userDto = new UserDto
            {
                Id = user.Id,
                Name = user.Name,
                Email = user.Email,
                Role = roleName,
                Status = user.Status,
                CreatedAt = user.CreatedAt,
                BusinessId = string.IsNullOrEmpty(businessId) ? Guid.Empty : Guid.Parse(businessId),
                CompanyName = companyName,
                Plan = planName,
                AccessToken = null
            };

            _logger.LogInformation("✅ Login successful for {Email}, Role: {Role}, Plan: {Plan}", dto.Email, roleName, planName);

            return new ResponseResult
            {
                Success = true,
                Message = "✅ Login successful",
                Data = userDto,
                Token = token
            };
        }

        public async Task<ResponseResult> SignupAsync(SignupBusinessDto dto)
        {
            _logger.LogInformation("🟢 Signup attempt: {Email}", dto.Email);
            var result = await _businessService.SignupBusinessAsync(dto);

            if (!result.Success)
            {
                _logger.LogWarning("❌ Signup failed for {Email}: {Msg}", dto.Email, result.Message);
                return ResponseResult.ErrorInfo(result.Message);
            }

            var business = await _businessService.GetBusinessByEmailAsync(dto.Email);

            if (business == null)
            {
                _logger.LogError("❌ Signup succeeded but business retrieval failed for {Email}", dto.Email);
                return ResponseResult.ErrorInfo("❌ Signup succeeded but business retrieval failed.");
            }

            try
            {
                // 🆕 Set BusinessAssignedTo if available
                if (dto.CreatedByPartnerId.HasValue && business.CreatedByPartnerId == null)
                {
                    business.CreatedByPartnerId = dto.CreatedByPartnerId;
                    await _businessService.UpdateBusinessAsync(business);
                    _logger.LogInformation("✅ Partner assigned during signup: {PartnerId} for Business: {BusinessId}", dto.CreatedByPartnerId, business.Id);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Signup succeeded but assigning partner failed for {Email}", dto.Email);
                return ResponseResult.ErrorInfo("❌ Signup succeeded but assigning partner failed: " + ex.Message);
            }

            _logger.LogInformation("✅ Signup successful for {Email} (BusinessId: {BusinessId})", dto.Email, business.Id);
            return ResponseResult.SuccessInfo("✅ Signup successful. Pending approval.", new { BusinessId = business.Id });
        }

        // 🔄 Refresh JWT Token (and Rotate)
        public async Task<ResponseResult> RefreshTokenAsync(string refreshToken)
        {
            _logger.LogInformation("🔄 RefreshToken attempt");

            var user = await _userRepo
                .AsQueryable()
                .Include(u => u.Role)
                .Include(u => u.Business)
                    .ThenInclude(b => b.BusinessPlanInfo)
                .FirstOrDefaultAsync(u => u.RefreshToken == refreshToken && u.RefreshTokenExpiry > DateTime.UtcNow);

            if (user == null)
            {
                _logger.LogWarning("❌ Invalid or expired refresh token.");
                return ResponseResult.ErrorInfo("❌ Invalid or expired refresh token.");
            }

            var permissions = await _accessControlService.GetPermissionsAsync(user.Id);
            var roleName = user.Role?.Name?.Trim().ToLower() ?? "unknown";
            var isAdminType = roleName == "superadmin" || roleName == "partner" || roleName == "reseller";

            string planName;
            string companyName;
            string businessId = user.BusinessId?.ToString() ?? "";

            if (isAdminType)
            {
                planName = roleName;
                companyName = "xByte Admin";
                businessId = "";
            }
            else
            {
                planName = user.Business?.BusinessPlanInfo?.Plan.ToString() ?? "";
                companyName = user.Business?.CompanyName ?? "";
            }

            var claims = new List<Claim>
            {
                new Claim(JwtRegisteredClaimNames.Sub, user.Id.ToString()),
                new Claim(JwtRegisteredClaimNames.Email, user.Email ?? ""),
                new Claim("name", user.Name ?? ""),
                new Claim(ClaimTypes.Role, roleName),
                new Claim("role", roleName),
                new Claim("status", user.Status ?? "unknown"),
                new Claim("plan", planName ?? ""),
                new Claim("businessId", businessId),
                new Claim("companyName", companyName ?? "")
            };

            if (permissions?.Any() == true)
            {
                claims.AddRange(permissions.Select(p => new Claim("perm", p)));
            }

            var token = _jwtTokenService.GenerateToken(claims);

            // 🔁 Rotate refresh token
            var newRefreshToken = Guid.NewGuid().ToString("N");
            user.RefreshToken = newRefreshToken;
            user.RefreshTokenExpiry = DateTime.UtcNow.AddDays(30);
            _userRepo.Update(user);

            _logger.LogInformation("🔄 Token refreshed for user {UserId}, role {Role}", user.Id, roleName);

            return ResponseResult.SuccessInfo("🔄 Token refreshed", new
            {
                accessToken = token,
                refreshToken = newRefreshToken
            });
        }

        // 🔁 Resend confirmation
        public async Task<ResponseResult> ResendConfirmationAsync(ResendConfirmationDto dto)
        {
            _logger.LogInformation("🔁 Resend confirmation attempt for {Email}", dto.Email);
            var business = await _businessService.GetBusinessByEmailAsync(dto.Email);
            if (business == null)
            {
                _logger.LogWarning("❌ Resend confirmation failed: No business for {Email}", dto.Email);
                return ResponseResult.ErrorInfo("❌ No business registered with this email");
            }

            _logger.LogInformation("✅ Resend confirmation request processed for {Email}", dto.Email);
            return ResponseResult.SuccessInfo("📨 Confirmation request resent.");
        }
        public async Task<FeatureAccessDto> GetFeatureAccessForUserAsync(ClaimsPrincipal user)
        {
            var role = user.FindFirstValue("role")?.ToLower();
            var dto = new FeatureAccessDto();

            if (role == "superadmin")
            {
                // Grant all known frontend features
                dto.Features = await _dbContext.FeatureAccess
                    .Select(f => f.FeatureName)
                    .Distinct()
                    .ToDictionaryAsync(name => name, name => true);

                return dto;
            }

            var plan = user.FindFirstValue("plan")?.ToLower();
            var businessIdStr = user.FindFirstValue("businessId");

            if (!Guid.TryParse(businessIdStr, out var businessId))
                return dto;

            // Plan-level or per-business override
            var features = await _dbContext.FeatureAccess
                .Where(f => f.BusinessId == businessId || f.Plan.ToLower() == plan)
                .ToListAsync();

            foreach (var feature in features)
            {
                dto.Features[feature.FeatureName] = feature.IsEnabled;
            }

            return dto;
        }

        // 🔒 Reset password
        public async Task<ResponseResult> ResetPasswordAsync(ResetPasswordDto dto)
        {
            _logger.LogInformation("🔒 Reset password attempt for {Email}", dto.Email);
            var user = await _userRepo.FirstOrDefaultAsync(u => u.Email == dto.Email);
            if (user == null)
            {
                _logger.LogWarning("❌ Reset password failed: No user for {Email}", dto.Email);
                return ResponseResult.ErrorInfo("❌ No user found with this email");
            }

            user.PasswordHash = HashPassword(dto.NewPassword);
            _userRepo.Update(user);

            _logger.LogInformation("✅ Password reset successfully for {Email}", dto.Email);
            return ResponseResult.SuccessInfo("✅ Password reset successfully");
        }

        // Utility: Hash password using SHA256
        private string HashPassword(string password)
        {
            using var sha = SHA256.Create();
            var bytes = Encoding.UTF8.GetBytes(password);
            var hash = sha.ComputeHash(bytes);
            return Convert.ToBase64String(hash);
        }
    }
}

``n
--- file: xbytechat-api/AuthModule/Services/IAuthService.cs  (sha256:7d563b4b118d631a798738eddf29e7637d5defe5bf5863d10d24b3e31bd897db)
`$lang
using System.Security.Claims;
using xbytechat.api.AuthModule.DTOs;
using xbytechat.api.Features.BusinessModule.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.AuthModule.Services
{
    public interface IAuthService
    {
        Task<ResponseResult> LoginAsync(UserLoginDto dto);
        Task<ResponseResult> SignupAsync(SignupBusinessDto dto);                  // ✅ Add this
        Task<ResponseResult> ResetPasswordAsync(ResetPasswordDto dto);           // ✅ Add this
        Task<ResponseResult> ResendConfirmationAsync(ResendConfirmationDto dto); // ✅ Add this
        Task<ResponseResult> RefreshTokenAsync(string refreshToken);
        Task<FeatureAccessDto> GetFeatureAccessForUserAsync(ClaimsPrincipal user);
    }
}


``n
--- file: xbytechat-api/AuthModule/Services/IJwtTokenService.cs  (sha256:e5e833dc3a672f0f856a64cb36fc6fb4a8f9474ba97db60bd097bcfa689a7206)
`$lang
using Microsoft.IdentityModel.Tokens;
using System.Collections.Generic;
using System.Security.Claims;

namespace xbytechat.api.AuthModule.Services
{
    public interface IJwtTokenService
    {
        string GenerateToken(
            string userId,
            string role,
            string userName,
            string email,
            string status,
            string businessId,
            string companyName,
            string plan,
            List<string> permissions
        );
        string GenerateToken(IEnumerable<Claim> claims);
        TokenValidationParameters GetValidationParameters(); // ✅ For Middleware validation
    }
}


``n
--- file: xbytechat-api/AuthModule/Services/JwtTokenService.cs  (sha256:225345dede31917d760c8f1a0fa0d82983cfc72e90607a591ee3eaa3f47bca14)
`$lang
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.IdentityModel.Tokens;
using System;
using System.Collections.Generic;
using System.IdentityModel.Tokens.Jwt;
using System.Linq;
using System.Security.Claims;
using System.Text;

namespace xbytechat.api.AuthModule.Services
{
    public class JwtTokenService : IJwtTokenService
    {
        private readonly IConfiguration _config;
        private readonly ILogger<JwtTokenService> _logger;

        public JwtTokenService(IConfiguration config, ILogger<JwtTokenService> logger)
        {
            _config = config;
            _logger = logger;
        }

        //public string GenerateToken(
        //    string userId,
        //    string role,
        //    string userName,
        //    string email,
        //    string status,
        //    string businessId,
        //    string companyName,
        //    string plan,
        //    List<string> permissions)
        //{
        //    try
        //    {
        //        var permissionString = string.Join(",", permissions ?? new List<string>());

        //        var claims = new List<Claim>
        //        {
        //            new Claim(JwtRegisteredClaimNames.Sub, userId),
        //            new Claim("id", userId),
        //            new Claim(ClaimTypes.NameIdentifier, userId),
        //            new Claim("email", email ?? ""),
        //            new Claim("role", role?.ToLowerInvariant() ?? "unknown"),    // lowercased!
        //            new Claim("name", userName ?? ""),
        //            new Claim("status", status ?? "unknown"),
        //            new Claim("businessId", businessId ?? ""),                   // lowercased!
        //            new Claim("companyName", companyName ?? ""),
        //            new Claim("plan", plan?.ToLowerInvariant() ?? "basic"),      // lowercased!
        //            new Claim("permissions", permissionString)
        //        };

        //        return GenerateToken(claims);
        //    }
        //    catch (Exception ex)
        //    {
        //        _logger.LogError(ex, "❌ Error generating token for userId: {UserId}", userId);
        //        throw;
        //    }
        //}
        public string GenerateToken(
    string userId,
    string role,
    string userName,
    string email,
    string status,
    string businessId,
    string companyName,
    string plan,
    List<string> permissions)
        {
            try
            {
                var permissionString = string.Join(",", permissions ?? new List<string>());

                var claims = new List<Claim>
        {
            new Claim(JwtRegisteredClaimNames.Sub, userId),
            new Claim("id", userId),
            new Claim(ClaimTypes.NameIdentifier, userId),
            new Claim("email", email ?? ""),
            new Claim("name", userName ?? ""),
            new Claim("status", status ?? "unknown"),
            new Claim("businessId", businessId ?? ""),
            new Claim("companyName", companyName ?? ""),
            new Claim("plan", plan?.ToLowerInvariant() ?? "basic"),
            new Claim("permissions", permissionString),
            
            // ✅ Proper role mapping for both ASP.NET and frontend
            new Claim("role", role?.ToLowerInvariant() ?? "unknown"),           // for React
            new Claim(ClaimTypes.Role, role?.ToLowerInvariant() ?? "unknown")   // for ASP.NET
        };

                return GenerateToken(claims);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Error generating token for userId: {UserId}", userId);
                throw;
            }
        }

        public string GenerateToken(IEnumerable<Claim> claims)
        {
            try
            {
                var jwtSettings = _config.GetSection("JwtSettings");

                var secret = jwtSettings["SecretKey"];
                if (string.IsNullOrEmpty(secret))
                {
                    _logger.LogWarning("⚠️ JWT SecretKey is missing from configuration.");
                    throw new Exception("JWT SecretKey is not configured.");
                }

                var expiry = jwtSettings["ExpiryMinutes"];
                if (!int.TryParse(expiry, out var expiryMinutes))
                {
                    _logger.LogWarning("⚠️ JWT ExpiryMinutes is invalid or missing. Defaulting to 60 minutes.");
                    expiryMinutes = 60;
                }

                var secretKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(secret));
                var creds = new SigningCredentials(secretKey, SecurityAlgorithms.HmacSha256);

                var expires = DateTime.UtcNow.AddMinutes(expiryMinutes);
                var unixExp = new DateTimeOffset(expires).ToUnixTimeSeconds();

                var finalClaims = claims.ToList();
                finalClaims.Add(new Claim(JwtRegisteredClaimNames.Exp, unixExp.ToString()));

                var token = new JwtSecurityToken(
                    issuer: jwtSettings["Issuer"],
                    audience: jwtSettings["Audience"],
                    claims: finalClaims,
                    expires: expires,
                    signingCredentials: creds
                );

                _logger.LogInformation("✅ Token generated for: {Email}", finalClaims.FirstOrDefault(c => c.Type == "email")?.Value);

                return new JwtSecurityTokenHandler().WriteToken(token);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Error generating JWT from claims.");
                throw;
            }
        }

        public TokenValidationParameters GetValidationParameters()
        {
            var jwtSettings = _config.GetSection("JwtSettings");

            return new TokenValidationParameters
            {
                ValidateIssuer = true,
                ValidateAudience = true,
                ValidateIssuerSigningKey = true,
                ValidateLifetime = true,
                RequireSignedTokens = true,
                RequireExpirationTime = true,
                ValidIssuer = jwtSettings["Issuer"],
                ValidAudience = jwtSettings["Audience"],
                IssuerSigningKey = new SymmetricSecurityKey(
                    Encoding.UTF8.GetBytes(jwtSettings["SecretKey"])
                ),
                ClockSkew = TimeSpan.Zero,
                RoleClaimType = "role",   // standardized!
                NameClaimType = "name"
            };
        }
    }
}

``n
--- file: xbytechat-api/Controllers/BusinessLoginController.cs  (sha256:7eda997e4bb632f6a487b52c57910c7c83ca50c17597d2a02e818cb3ed2459be)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.DTOs;
using xbytechat.api.DTOs.Tenants;
using xbytechat.api.Services.Interfaces;

namespace xbytechat.api.Controllers
{
    [ApiController]
    [Route("api/tenants")]
    public class BusinessLoginController : ControllerBase
    {
        private readonly IBusinessService _tenantService;

        public BusinessLoginController(IBusinessService tenantService)
        {
            _tenantService = tenantService;
        }

        [HttpPost("login")]
        public async Task<IActionResult> Login([FromBody] BusinessLoginRequest request)
        {
            try
            {
                var tenant = await _tenantService.LoginAsync(request);

                return Ok(new
                {
                    tenant.Id,
                    tenant.Email,
                    tenant.CompanyName,
                    //tenant.Role,
                    //tenant.Plan,
                    Message = "Login successful"
                });
            }
            catch (Exception ex)
            {
                return Unauthorized(new { Message = ex.Message });
            }
        }
    }
}

``n
--- file: xbytechat-api/Controllers/HealthCheckController.cs  (sha256:f21f78c4303d754e255e05ed501dcefe6aaff8d18a8a9aa878e4bfa22da44eb2)
`$lang
using Microsoft.AspNetCore.Mvc;

[ApiController]
[Route("api/[controller]")]
public class HealthCheckController : ControllerBase
{
    [HttpGet]
    public IActionResult Get() => Ok("✅ xByteChat backend is running 🚀");
}

``n
--- file: xbytechat-api/Controllers/MessageLogsController.cs  (sha256:e36c308f0d6e42ec75e8db9797ab4ea5e68366e503e0bb04a51824491c22620a)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Models;

namespace xbytechat.api.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class MessageLogsController : ControllerBase
    {
        private readonly AppDbContext _db;

        public MessageLogsController(AppDbContext db)
        {
            _db = db;
        }

        [HttpGet]
        public async Task<IActionResult> Get()
        {
            var logs = await _db.MessageLogs
                .OrderByDescending(log => log.CreatedAt)
                .ToListAsync();

            return Ok(logs);
        }
    }
}

``n
--- file: xbytechat-api/Controllers/MessagesController.cs  (sha256:c23a3ca95ebcc60cdb6a1762b7c1d9605de6427a56dd4b91332e15eecfbb4500)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Helpers;
using xbytechat.api.Services.Messages.Interfaces;

namespace xbytechat.api.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class MessagesController : ControllerBase
    {
        private readonly IMessageService _messageService;

        public MessagesController(IMessageService messageService)
        {
            _messageService = messageService;
        }

        /// ✅ SEND TEXT MESSAGE
        [HttpPost("send-text")]
        public async Task<IActionResult> SendTextMessage([FromBody] TextMessageDto dto)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new
                {
                    success = false,
                    message = "❌ Validation failed",
                    errors = ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage)
                });
            }

            var result = await _messageService.SendMessageAsync(dto);

            return result.Success
                ? Ok(new { success = true, message = result.Message, response = result.Data })
                : StatusCode(500, new { success = false, message = result.Message, error = result.ErrorMessage });
        }

        /// ✅ SEND IMAGE MESSAGE
        [HttpPost("send-image")]
        public async Task<IActionResult> SendImageMessage([FromBody] ImageMessageDto dto)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new
                {
                    success = false,
                    message = "❌ Validation failed",
                    errors = ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage)
                });
            }

            var result = await _messageService.SendMessageAsync(dto);

            return result.Success
                ? Ok(new { success = true, message = result.Message, response = result.Data })
                : StatusCode(500, new { success = false, message = result.Message, error = result.ErrorMessage });
        }

        /// ✅ SEND TEMPLATE MESSAGE
        [HttpPost("send-template")]
        public async Task<IActionResult> SendTemplateMessage([FromBody] TemplateMessageDto dto)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new
                {
                    success = false,
                    message = "❌ Validation failed",
                    errors = ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage)
                });
            }

            var result = await _messageService.SendMessageAsync(dto);

            return result.Success
                ? Ok(new { success = true, message = result.Message, response = result.Data })
                : StatusCode(500, new { success = false, message = result.Message, error = result.ErrorMessage });
        }

        /// ✅ SEND CTA BUTTON MESSAGE (Free-form Interactive)
        [HttpPost("send-cta")]
        public async Task<IActionResult> SendCtaMessage([FromBody] CtaMessageDto dto)
        {
            if (string.IsNullOrWhiteSpace(dto.RecipientPhone) || string.IsNullOrWhiteSpace(dto.BodyText) || dto.Buttons == null || dto.Buttons.Count == 0)
            {
                return BadRequest(new
                {
                    success = false,
                    message = "❌ Invalid request — phone, body text and buttons are required"
                });
            }

            // Optional tracking
            var ipAddress = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
            var userAgent = Request.Headers["User-Agent"].ToString() ?? "unknown";

            var result = await _messageService.SendInteractiveMessageAsync(dto.RecipientPhone, dto.BodyText, dto.Buttons);

            return result.Success
                ? Ok(new
                {
                    success = true,
                    message = result.Message,
                    messageId = result.MessageId,
                    logId = result.MessageLogId,
                    raw = result.RawResponse
                })
                : StatusCode(500, new
                {
                    success = false,
                    message = result.Message,
                    error = result.ErrorMessage
                });
        }

        /// ✅ SEND BULK MESSAGES
        //[HttpPost("send-bulk")]
        //public async Task<SendResultExtended> SendBulkMessagesAsync(BulkMessageDto dto)
        //{
        //    var result = new SendResultExtended
        //    {
        //        Success = true,
        //        Message = "✅ All messages processed.",
        //        LogId = null,
        //        MessageId = null
        //    };

        //    try
        //    {
        //        foreach (var contactId in dto.ContactIds)
        //        {
        //            var contact = await _dbContext.Contacts
        //                .Include(c => c.Business)
        //                .FirstOrDefaultAsync(c => c.Id == contactId);

        //            if (contact == null || string.IsNullOrWhiteSpace(contact.PhoneNumber))
        //                continue;

        //            BaseMessageDto message;

        //            if (dto.MessageType.ToLower() == "template")
        //            {
        //                message = new TemplateMessageDto
        //                {
        //                    RecipientNumber = contact.PhoneNumber,
        //                    MessageContent = dto.MessageTemplate,
        //                    MessageType = "template",
        //                    TemplateName = dto.TemplateName!,
        //                    TemplateParameters = dto.TemplateParams ?? new List<string>(),
        //                    BusinessId = contact.BusinessId
        //                };
        //            }
        //            else
        //            {
        //                message = new TextMessageDto
        //                {
        //                    RecipientNumber = contact.PhoneNumber,
        //                    MessageContent = dto.MessageTemplate,
        //                    MessageType = "text",
        //                    BusinessId = contact.BusinessId
        //                };
        //            }

        //            await SendMessageAsync(message); // already returns SendResultExtended
        //        }

        //        return result;
        //    }
        //    catch (Exception ex)
        //    {
        //        return new SendResultExtended
        //        {
        //            Success = false,
        //            Message = "❌ Bulk send failed.",
        //            ErrorMessage = ex.Message
        //        };
        //    }
        //}


    }
}

``n
--- file: xbytechat-api/Controllers/SendMessageController.cs  (sha256:f2cf8e138d7177000e595b752d8da0ab54cec8a56df32328388c4a4f58f328d9)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Services;
using System.Threading.Tasks;

namespace xbytechat.api.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class WhatsAppController : ControllerBase
    {
        private readonly WhatsAppService _whatsAppService;

        public WhatsAppController(WhatsAppService whatsAppService)
        {
            _whatsAppService = whatsAppService;
        }

        /// <summary>
        /// Endpoint to send a WhatsApp message.
        /// </summary>
        /// <param name="recipientPhone">Recipient's phone number (including country code).</param>
        /// <param name="messageText">Text message to send.</param>
        /// <returns>Response with the result of the send operation.</returns>
        [HttpPost("send")]
        public async Task<IActionResult> SendMessage([FromQuery] string recipientPhone, [FromQuery] string messageText)
        {
            if (string.IsNullOrEmpty(recipientPhone) || string.IsNullOrEmpty(messageText))
            {
                return BadRequest(new { success = false, message = "Phone number and message text are required." });
            }

            // Call WhatsApp service to send the message
            var result = await _whatsAppService.SendMessageAsync(recipientPhone, messageText);

            if (result.Success)
            {
                return Ok(new
                {
                    success = true,
                    message = "✅ Message sent successfully.",
                    response = result.RawResponse
                });
            }
            else
            {
                return StatusCode(500, new
                {
                    success = false,
                    message = result.ErrorMessage ?? "❌ Failed to send message.",
                    response = result.RawResponse
                });
            }
        }
    }
}

``n
--- file: xbytechat-api/CRM/Controllers/ContactsController.cs  (sha256:f2dbd9957b7089c440789b75a5bea341be7057f77f82514eb3c66b0007a7add2)
`$lang
using CsvHelper.Configuration;
using CsvHelper;
using Microsoft.AspNetCore.Mvc;
using System.Globalization;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Helpers; // <-- For ResponseResult
using xbytechat.api.Shared;  // <-- For GetBusinessId extension

namespace xbytechat.api.CRM.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ContactsController : ControllerBase
    {
        private readonly IContactService _contactService;
        private readonly ILogger<ContactsController> _logger;
        public ContactsController(IContactService contactService, ILogger<ContactsController> logger)
        {
            _contactService = contactService;
            _logger = logger;
        }

        // POST: api/contacts
        [HttpPost]
        public async Task<IActionResult> AddContact([FromBody] ContactDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var result = await _contactService.AddContactAsync(businessId, dto);
            return Ok(ResponseResult.SuccessInfo("Contact created.", result));
        }

     

        // GET: api/contacts/{id}
        [HttpGet("{id}")]
        public async Task<IActionResult> GetContactById(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var contact = await _contactService.GetContactByIdAsync(businessId, id);
            if (contact == null)
                return NotFound(ResponseResult.ErrorInfo("Contact not found."));
            return Ok(ResponseResult.SuccessInfo("Contact loaded.", contact));
        }

        // PUT: api/contacts/{id}
        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateContact(Guid id, [FromBody] ContactDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            dto.Id = id;
            var success = await _contactService.UpdateContactAsync(businessId, dto);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Contact not found."));
            return Ok(ResponseResult.SuccessInfo("Contact updated."));
        }

        // DELETE: api/contacts/{id}
        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteContact(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _contactService.DeleteContactAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Contact not found."));
            return Ok(ResponseResult.SuccessInfo("Contact deleted."));
        }

        // POST: api/contacts/parse-csv
        [ApiExplorerSettings(IgnoreApi = true)]
        [HttpPost("parse-csv")]
        [Consumes("multipart/form-data")]
        public async Task<IActionResult> ParseCsvToContactsAsync([FromForm] IFormFile file)
        {
            if (file == null || file.Length == 0)
                return BadRequest(ResponseResult.ErrorInfo("CSV file is required."));

            var businessId = HttpContext.User.GetBusinessId();
            using var stream = file.OpenReadStream();

            try
            {
                var parseResult = await _contactService.ParseCsvToContactsAsync(businessId, stream);
                return Ok(ResponseResult.SuccessInfo("CSV parsed with detailed results.", parseResult));
            }
            catch (Exception ex)
            {
                return BadRequest(ResponseResult.ErrorInfo("CSV parsing failed: " + ex.Message));
            }
        }

        // PATCH: /api/contacts/{id}/favorite
        [HttpPatch("{id}/favorite")]
        public async Task<IActionResult> ToggleFavorite(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _contactService.ToggleFavoriteAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Contact not found."));
            return Ok(ResponseResult.SuccessInfo("Favorite toggled."));
        }

        // PATCH: /api/contacts/{id}/archive
        [HttpPatch("{id}/archive")]
        public async Task<IActionResult> ToggleArchive(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _contactService.ToggleArchiveAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Contact not found."));
            return Ok(ResponseResult.SuccessInfo("Archive toggled."));
        }

        // POST: api/contacts/bulk-assign-tag
        [HttpPost("bulk-assign-tag")]
        public async Task<IActionResult> AssignTagToContacts([FromBody] AssignTagToContactsDto dto)
        {
            if (dto.ContactIds == null || !dto.ContactIds.Any())
                return BadRequest(ResponseResult.ErrorInfo("No contact IDs provided."));

            var businessId = HttpContext.User.GetBusinessId();
            await _contactService.AssignTagToContactsAsync(businessId, dto.ContactIds, dto.TagId);

            return Ok(ResponseResult.SuccessInfo("Tag assigned to selected contacts."));
        }

        //[HttpGet("contacts")]
        [HttpGet]
        public async Task<IActionResult> GetAllContacts(
        [FromQuery] string? tab = "all",
        [FromQuery] int page = 1,
        [FromQuery] int pageSize = 25)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var pagedResult = await _contactService.GetPagedContactsAsync(businessId, tab, page, pageSize);
            return Ok(ResponseResult.SuccessInfo("Contacts loaded.", pagedResult));
        }
        // GET: api/contacts/all
        [HttpGet("all")]
        public async Task<IActionResult> GetAllContactsFlat()
        {
            var businessId = HttpContext.User.GetBusinessId();
            var allContacts = await _contactService.GetAllContactsAsync(businessId); // This returns IEnumerable<ContactDto>
            return Ok(allContacts); // Returns plain array!
        }

        [HttpPost("filter-by-tags")]
        public async Task<IActionResult> GetContactsByTags([FromBody] List<string> tags)
        {
            var businessId = HttpContext.User.GetBusinessId();

            // ✅ Convert to Guid list safely
            var tagGuids = tags
                .Where(x => Guid.TryParse(x, out _))
                .Select(Guid.Parse)
                .ToList();

            var contacts = await _contactService.GetContactsByTagsAsync(businessId, tagGuids);

            return Ok(ResponseResult.SuccessInfo("Contacts filtered successfully", contacts));
        }

        [HttpPost("bulk-import")]
        [Consumes("multipart/form-data")]
        public async Task<IActionResult> BulkImportContactsAsync(IFormFile file)
        {
            if (file == null || file.Length == 0)
                return BadRequest(ResponseResult.ErrorInfo("CSV file is required."));

            var businessId = HttpContext.User.GetBusinessId();

            try
            {
                var result = await _contactService.BulkImportAsync(businessId, file.OpenReadStream());
                return Ok(ResponseResult.SuccessInfo("Contacts imported successfully.", result));
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Bulk import failed.");
                return BadRequest(ResponseResult.ErrorInfo("Import failed: " + ex.Message));
            }
        }
       
        [HttpGet("by-tags")]
        public async Task<IActionResult> GetContactsByTags([FromQuery] List<Guid> tagIds)
        {
            var businessId = User.GetBusinessId();  // Your tenant logic
            var contacts = await _contactService.GetContactsByTagsAsync(businessId, tagIds);
            return Ok(contacts);
        }


    }
}

``n
--- file: xbytechat-api/CRM/Controllers/NotesController.cs  (sha256:c1ed18be16d3c10dbf5792386063ef23934ed457387572ec3e40ae8582d802b1)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Helpers; // For ResponseResult
using xbytechat.api.Shared;  // For GetBusinessId extension

namespace xbytechat.api.CRM.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class NotesController : ControllerBase
    {
        private readonly INoteService _noteService;

        public NotesController(INoteService noteService)
        {
            _noteService = noteService;
        }

        [HttpPost]
        public async Task<IActionResult> AddNote([FromBody] NoteDto dto)
        {
            try
            {
                var businessId = HttpContext.User.GetBusinessId();
                var result = await _noteService.AddNoteAsync(businessId, dto);
                return Ok(ResponseResult.SuccessInfo("Note created.", result));
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("Error creating note", ex.Message));
            }
        }

        [HttpGet("contact/{contactId}")]
        public async Task<IActionResult> GetNotesByContact(Guid contactId)
        {
            try
            {
                var businessId = HttpContext.User.GetBusinessId();
                var result = await _noteService.GetNotesByContactAsync(businessId, contactId);
                return Ok(ResponseResult.SuccessInfo("Notes loaded.", result));
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("Error fetching notes", ex.Message));
            }
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetNoteById(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var result = await _noteService.GetNoteByIdAsync(businessId, id);
            if (result == null)
                return NotFound(ResponseResult.ErrorInfo("Note not found."));
            return Ok(ResponseResult.SuccessInfo("Note loaded.", result));
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateNote(Guid id, [FromBody] NoteDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _noteService.UpdateNoteAsync(businessId, id, dto);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Note not found."));
            return Ok(ResponseResult.SuccessInfo("Note updated."));
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteNote(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _noteService.DeleteNoteAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Note not found."));
            return Ok(ResponseResult.SuccessInfo("Note deleted."));
        }
    }
}

``n
--- file: xbytechat-api/CRM/Controllers/RemindersController.cs  (sha256:3413344e2dc9f58f165ae5e0eaeb97e8c89d0d10e9d6a1d2690d05c6f374148a)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Models;
using xbytechat.api.Helpers; // For ResponseResult
using xbytechat.api.Shared;  // For GetBusinessId extension

namespace xbytechat.api.CRM.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class RemindersController : ControllerBase
    {
        private readonly IReminderService _reminderService;

        public RemindersController(IReminderService reminderService)
        {
            _reminderService = reminderService;
        }

        [HttpPost]
        public async Task<IActionResult> AddReminder(ReminderDto dto)
        {
            try
            {
                var businessId = HttpContext.User.GetBusinessId();
                if (dto == null)
                    return BadRequest(ResponseResult.ErrorInfo("Reminder data is missing."));

                var result = await _reminderService.AddReminderAsync(businessId, dto);
                return Ok(ResponseResult.SuccessInfo("Reminder created.", result));
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("An error occurred while adding the reminder.", ex.Message));
            }
        }

        [HttpGet]
        public async Task<IActionResult> GetAllReminders()
        {
            try
            {
                var businessId = HttpContext.User.GetBusinessId();
                var reminders = await _reminderService.GetAllRemindersAsync(businessId);
                return Ok(ResponseResult.SuccessInfo("Reminders loaded.", reminders));
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("An error occurred while fetching reminders.", ex.Message));
            }
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetReminderById(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var reminder = await _reminderService.GetReminderByIdAsync(businessId, id);
            if (reminder == null)
                return NotFound(ResponseResult.ErrorInfo("Reminder not found."));
            return Ok(ResponseResult.SuccessInfo("Reminder loaded.", reminder));
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateReminder(Guid id, [FromBody] ReminderDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _reminderService.UpdateReminderAsync(businessId, id, dto);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Reminder not found."));
            return Ok(ResponseResult.SuccessInfo("Reminder updated."));
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteReminder(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _reminderService.DeleteReminderAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Reminder not found."));
            return Ok(ResponseResult.SuccessInfo("Reminder deleted."));
        }
    }
}

``n
--- file: xbytechat-api/CRM/Controllers/TagsController.cs  (sha256:11c3bb8832d2e988ed374ddd872288b5af98ce8ce963987e821de0d3107f4971)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Helpers; // For ResponseResult
using xbytechat.api.Shared;  // For GetBusinessId extension

namespace xbytechat.api.CRM.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class TagsController : ControllerBase
    {
        private readonly ITagService _tagService;

        public TagsController(ITagService tagService)
        {
            _tagService = tagService;
        }

        [HttpPost]
        public async Task<IActionResult> AddTag([FromBody] TagDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var result = await _tagService.AddTagAsync(businessId, dto);
            return Ok(ResponseResult.SuccessInfo("Tag created.", result));
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateTag(Guid id, [FromBody] TagDto dto)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _tagService.UpdateTagAsync(businessId, id, dto);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Tag not found."));
            return Ok(ResponseResult.SuccessInfo("Tag updated."));
        }

        [HttpGet]
        public async Task<IActionResult> GetAllTags()
        {
            var businessId = HttpContext.User.GetBusinessId();
            var tags = await _tagService.GetAllTagsAsync(businessId);
            return Ok(ResponseResult.SuccessInfo("Tags loaded.", tags));
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteTag(Guid id)
        {
            var businessId = HttpContext.User.GetBusinessId();
            var success = await _tagService.DeleteTagAsync(businessId, id);
            if (!success)
                return NotFound(ResponseResult.ErrorInfo("Tag not found."));
            return Ok(ResponseResult.SuccessInfo("Tag deleted."));
        }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/AssignTagToContactsDto.cs  (sha256:69c9b7fc83bbaf32fab62812c210f204eca0b723301878252850f6527f71a7f3)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class AssignTagToContactsDto
    {
        public List<Guid> ContactIds { get; set; } = new();
        public Guid TagId { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/BulkImportResultDto.cs  (sha256:05392f5b522d34ba8069854727ab513053a529252f41be0f45e827f4df613eac)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class BulkImportResultDto
    {
        public int Imported { get; set; }
        public List<CsvImportError> Errors { get; set; } = new();
    }

    public class CsvImportErrorMsg
    {
        public int RowNumber { get; set; }
        public string ErrorMessage { get; set; }
    }
}
``n
--- file: xbytechat-api/CRM/Dtos/ContactDto.cs  (sha256:218a964e202fd90d764b7a4deccc1466eb7d4d35cdb1472bf4a808c1304df08a)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.CRM.Dtos
{
    public class ContactDto
    {
        public Guid? Id { get; set; } // Nullable for Create (used in PUT)

        public string Name { get; set; } // Contact full name

        public string PhoneNumber { get; set; } // WhatsApp-compatible number

        public string? Email { get; set; } // Optional email address

        public string? LeadSource { get; set; } // e.g., "WhatsApp", "Facebook", "Landing Page"

        public DateTime? LastContactedAt { get; set; } // Last WhatsApp or CRM interaction

        public DateTime? NextFollowUpAt { get; set; } // For scheduling reminders

        public string? Notes { get; set; } // Internal notes for the contact

        public DateTime? CreatedAt { get; set; } // Read-only timestamp

        // ✅ NEW: Structured Tags (replaces comma-separated strings)
        // Example: [{ id: 1, name: "VIP" }, { id: 2, name: "Follow-up" }]
        public List<ContactTagDto> Tags { get; set; } = new();

        public bool IsFavorite { get; set; } = false;
        public bool IsArchived { get; set; } = false;
        public string? Group { get; set; }

    }
}

``n
--- file: xbytechat-api/CRM/Dtos/ContactDtoCsvMap.cs  (sha256:5dd22482c7625ce4ada21b1595015bd0273b921d8a5ac8787486b4f2ad874570)
`$lang
using CsvHelper.Configuration;

namespace xbytechat.api.CRM.Dtos
{
    public class ContactDtoCsvMap : ClassMap<ContactDto>
    {
        public ContactDtoCsvMap()
        {
            Map(m => m.Name).Name("name", "Name", "full name");
            Map(m => m.PhoneNumber).Name("phone", "Phone", "mobile", "mobile number");
            Map(m => m.Email).Name("email", "Email").Optional();
            Map(m => m.Notes).Name("notes", "Notes").Optional();
        }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/ContactTagDto.cs  (sha256:4b81638e7806bd28b702637f4d9e379725b86e63045e558d2abbdc54663b7650)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class ContactTagDto
    {
        public Guid TagId { get; set; }
        public string TagName { get; set; } = string.Empty;
        public string? ColorHex { get; set; }
        public string? Category { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/CsvImportResult.cs  (sha256:7e0d39bb56ef6fa9d80f69f7c37ece658407016ae68b838cd425050ed5f31680)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class CsvImportResult<T>
    {
        public List<T> SuccessRecords { get; set; } = new();
        public List<CsvImportError> Errors { get; set; } = new();
    }

    public class CsvImportError
    {
        public int RowNumber { get; set; }
        public string ErrorMessage { get; set; } = string.Empty;
    }
}
``n
--- file: xbytechat-api/CRM/Dtos/NoteDto.cs  (sha256:a324df31b2679d4db34a15ec6a647792e8a9456a0684e01787d9baeff44f3c8f)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class NoteDto
    {
        public Guid Id { get; set; }
        public Guid? ContactId { get; set; }
        public string Title { get; set; }
        public string Content { get; set; }
        public string Source { get; set; }
        public string CreatedBy { get; set; }
        public bool IsPinned { get; set; }
        public bool IsInternal { get; set; }
        public DateTime CreatedAt { get; set; }
        public DateTime? EditedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/PagedResult.cs  (sha256:e4a94c533f112f0f35359486e8c904e0afe1168d0e704dc0df7990ced5fd3ad6)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class PagedResult<T>
    {
        public List<T> Items { get; set; } = new();
        public int TotalCount { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/ReminderDto.cs  (sha256:9d68d6f7f4b48cada2f4160bc381166930f0fdfb5212ad239fe27abf981f5d0f)
`$lang
using System;

namespace xbytechat.api.CRM.Dtos
{
    public class ReminderDto
    {
        public Guid? Id { get; set; }  // Null when creating, present when updating

        public Guid? ContactId { get; set; }

        public string Title { get; set; } = default!;

        public string? Description { get; set; }

        public DateTime DueAt { get; set; }

        public string? Status { get; set; } = "Pending";

        public string? ReminderType { get; set; }

        public int? Priority { get; set; }

        public bool IsRecurring { get; set; }

        public string? RecurrencePattern { get; set; }

        public bool SendWhatsappNotification { get; set; }

        public string? LinkedCampaign { get; set; }

        public bool IsActive { get; set; } = true;

        public DateTime? CreatedAt { get; set; }

        public DateTime? UpdatedAt { get; set; }

        public DateTime? CompletedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Dtos/TagDto.cs  (sha256:c13472528bbecc527f9c37b069e6b80729380492eb7126891fe189c354298a04)
`$lang
namespace xbytechat.api.CRM.Dtos
{
    public class TagDto
    {
        public Guid? Id { get; set; }

        public string Name { get; set; } = default!;

        public string? ColorHex { get; set; }

        public string? Category { get; set; }

        public string? Notes { get; set; }

        public bool IsSystemTag { get; set; } = false;

        public bool IsActive { get; set; } = true;

        public DateTime? CreatedAt { get; set; }

        public DateTime? LastUsedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/CRM/Interfaces/IContactService.cs  (sha256:c38a3f42be25b4c4a40f653f2aff4014d6a28e042bcc286ab6481e6f066b797f)
`$lang
using System;
using System.Collections.Generic;
using System.IO;
using System.Threading.Tasks;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Models;

namespace xbytechat.api.CRM.Interfaces
{
    /// <summary>
    /// Defines the contract for all operations related to managing contacts.
    /// </summary>
    public interface IContactService
    {

        Task<ContactDto> AddContactAsync(Guid businessId, ContactDto dto);
        Task<ContactDto> GetContactByIdAsync(Guid businessId, Guid contactId);
        Task<bool> UpdateContactAsync(Guid businessId, ContactDto dto);
        Task<bool> DeleteContactAsync(Guid businessId, Guid contactId);
        Task<CsvImportResult<ContactDto>> ParseCsvToContactsAsync(Guid businessId, Stream csvStream);

        Task<Contact> FindOrCreateAsync(Guid businessId, string phoneNumber);
        Task<bool> ToggleFavoriteAsync(Guid businessId, Guid contactId);
        Task<bool> ToggleArchiveAsync(Guid businessId, Guid contactId);
        Task<IEnumerable<ContactDto>> GetAllContactsAsync(Guid businessId, string? tab = "all");
        Task AssignTagToContactsAsync(Guid businessId, List<Guid> contactIds, Guid tagId);
        Task<PagedResult<ContactDto>> GetPagedContactsAsync(
     Guid businessId,
     string? tab = "all",
     int page = 1,
     int pageSize = 25,
     string? searchTerm = null
 );
        // ✅ Tag-based filtering support
        Task<IEnumerable<ContactDto>> GetContactsByTagsAsync(Guid businessId, List<Guid> tags);

        Task<BulkImportResultDto> BulkImportAsync(Guid businessId, Stream csvStream);
        // 📌 New method to support flow node → tag assignment
        Task<bool> AssignTagsAsync(Guid businessId, string phoneNumber, List<string> tags);

    }
}


``n
--- file: xbytechat-api/CRM/Interfaces/INoteService.cs  (sha256:c7f3f36ea21a7508514c9054225df94aef67048fa1290fb84f860cd103764e87)
`$lang
using xbytechat.api.CRM.Dtos;

namespace xbytechat.api.CRM.Interfaces
{
    public interface INoteService
    {
        // For creating new note
        Task<NoteDto> AddNoteAsync(Guid businessId, NoteDto dto);

        // List all notes for dashboard view
        Task<IEnumerable<NoteDto>> GetNotesByContactAsync(Guid businessId, Guid contactId);

        // For loading note in edit mode
        Task<NoteDto?> GetNoteByIdAsync(Guid businessId, Guid noteId);
        // Handles editing
        Task<bool> UpdateNoteAsync(Guid businessId, Guid noteId, NoteDto dto);
        // Soft delete → IsActive = false
        Task<bool> DeleteNoteAsync(Guid businessId, Guid noteId);
    }
}


``n
--- file: xbytechat-api/CRM/Interfaces/IReminderService.cs  (sha256:b495104def7199c6e12aa28db2fad8c0c13dc551ab0cba0f8c0797361e14d8c3)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.CRM.Dtos;

namespace xbytechat.api.CRM.Interfaces
{
    public interface IReminderService
    {
        //For creating new reminder
        Task<ReminderDto> AddReminderAsync(Guid businessId, ReminderDto dto);

        //List all reminders for dashboard view
        Task<IEnumerable<ReminderDto>> GetAllRemindersAsync(Guid businessId);

        //For loading reminder in edit mode
        Task<ReminderDto?> GetReminderByIdAsync(Guid businessId, Guid reminderId);

        //Handles editing
        Task<bool> UpdateReminderAsync(Guid businessId, Guid reminderId, ReminderDto dto);
        //Soft delete → IsActive = false
        Task<bool> DeleteReminderAsync(Guid businessId, Guid reminderId);
    }
}

``n
--- file: xbytechat-api/CRM/Interfaces/ITagService.cs  (sha256:bf7f3ea814c33020416ac25cd9d3b6f600c58c7dc849701f93e8093bf2949681)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.CRM.Dtos;

namespace xbytechat.api.CRM.Interfaces
{
    public interface ITagService
    {
        Task<TagDto> AddTagAsync(Guid businessId, TagDto dto);

        Task<IEnumerable<TagDto>> GetAllTagsAsync(Guid businessId);
        Task<bool> UpdateTagAsync(Guid businessId, Guid tagId, TagDto dto);
        Task<bool> DeleteTagAsync(Guid businessId, Guid tagId);
       // Task AssignTagAsync(Guid businessId, string phone, string tag);
        Task AssignTagsAsync(Guid businessId, string phoneNumber, List<string> tagNames);
    }
}

``n
--- file: xbytechat-api/CRM/Mappers/ContactDtoCsvMap.cs  (sha256:41e1be6be963984ed9a757aa1575fd03a556851cdea04c287a91c4358696e166)
`$lang
using CsvHelper.Configuration;
using xbytechat.api.CRM.Dtos;

public sealed class ContactDtoCsvMap : ClassMap<ContactDto>
{
    public ContactDtoCsvMap()
    {
        Map(m => m.Name).Name("Name");
        Map(m => m.PhoneNumber).Name("Phone");
        Map(m => m.Email).Name("Email");
        Map(m => m.LeadSource).Name("LeadSource");
        Map(m => m.Notes).Name("Notes");
    }
}

``n
--- file: xbytechat-api/CRM/Mappers/NoteMapper.cs  (sha256:e26b6156b9aca01214bd18633cce4bee5e8ce187f220ff8857ab6c496e4fb933)
`$lang
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Models;

namespace xbytechat.api.CRM.Mappers
{
    public static class NoteMapper
    {
        public static NoteDto MapToDto(Note note)
        {
            return new NoteDto
            {
                Id = note.Id,
                ContactId = note.ContactId,
                Title = note.Title,
                Content = note.Content,
                Source = note.Source,
                CreatedBy = note.CreatedBy,
                IsPinned = note.IsPinned,
                IsInternal = note.IsInternal,
                CreatedAt = note.CreatedAt,
                EditedAt = note.EditedAt
            };
        }

        public static Note MapToEntity(NoteDto dto, Guid businessId)
        {
            return new Note
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                ContactId = dto.ContactId,
                Title = dto.Title,
                Content = dto.Content,
                Source = dto.Source,
                CreatedBy = dto.CreatedBy,
                IsPinned = dto.IsPinned,
                IsInternal = dto.IsInternal,
                CreatedAt = DateTime.UtcNow
            };
        }
    }
}


``n
--- file: xbytechat-api/CRM/Mappers/ReminderMapper.cs  (sha256:53c9d6d5cbdcb101f0bfc0225af4e6afc6b29111d75fb565263bf55135999e2d)
`$lang
namespace xbytechat.api.CRM.Mappers
{
    using xbytechat.api.CRM.Models;
    using xbytechat.api.CRM.Dtos;

    public static class ReminderMapper
    {
        public static ReminderDto MapToDto(Reminder r)
        {
            return new ReminderDto
            {
                Id = r.Id,
                Title = r.Title,
                Description = r.Description,
                DueAt = r.DueAt,
                ReminderType = r.ReminderType,
                Priority = r.Priority,
                IsRecurring = r.IsRecurring,
                RecurrencePattern = r.RecurrencePattern,
                SendWhatsappNotification = r.SendWhatsappNotification,
                LinkedCampaign = r.LinkedCampaign,
                Status = r.Status,
                CreatedAt = r.CreatedAt,
                ContactId = r.ContactId
            };
        }
    }
}

``n
--- file: xbytechat-api/CRM/Models/Contact.cs  (sha256:3d14b66f4de55b9c4de89fedbfd11849b1856950b7b87af1f6dda1771ac640da)
`$lang
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.Features.BusinessModule.Models;

namespace xbytechat.api.CRM.Models
{
    public class Contact
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid BusinessId { get; set; }
        public Business Business { get; set; } = null!;
        // 🔗 FK to Business
        [Required]
        [MaxLength(100)]
        public string Name { get; set; }

        [Required]
        [MaxLength(20)]
        public string PhoneNumber { get; set; }

        [MaxLength(100)]
        public string? Email { get; set; }

        [MaxLength(50)]
        public string? LeadSource { get; set; }

        [MaxLength(200)]
        public string? Tags { get; set; } // Legacy, will be deprecated after ContactTag rollout

        public DateTime? LastContactedAt { get; set; }
        public DateTime? NextFollowUpAt { get; set; }

        [MaxLength(500)]
        public string? Notes { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        // 🧩 NEW: Link to Tags
        public ICollection<ContactTag> ContactTags { get; set; } = new List<ContactTag>();
        // ✅ New: Navigation property for many-to-many tags
        //public ICollection<ContactTag> TagsLink { get; set; } = new List<ContactTag>();

        public DateTime? LastCTAInteraction { get; set; }
        public string? LastCTAType { get; set; }
        public Guid? LastClickedProductId { get; set; }

        // 🚦 If true, skip automation flows (manually or programmatically paused)
        public bool IsAutomationPaused { get; set; } = false;

        // 👤 If agent assigned, automation should pause (runtime check)
        public Guid? AssignedAgentId { get; set; }

        public bool IsFavorite { get; set; } = false;
        public bool IsArchived { get; set; } = false;
        public string? Group { get; set; }
        public bool IsActive { get; set; } = true;

    }
}

``n
--- file: xbytechat-api/CRM/Models/ContactTag.cs  (sha256:422118f780b163abab39572c97ce858dcf1288cc05ae98138b8bdb3dc4329322)
`$lang
using System.ComponentModel.DataAnnotations;
using xbytechat.api.CRM.Models;

public class ContactTag
{
    [Key]
    public Guid Id { get; set; }

    [Required]
    public Guid ContactId { get; set; }

    public Contact Contact { get; set; }

    [Required]
    public Guid TagId { get; set; }

    public Tag Tag { get; set; }

    [Required]
    public Guid BusinessId { get; set; }

    public DateTime AssignedAt { get; set; } = DateTime.UtcNow;

    public string? AssignedBy { get; set; }
}


``n
--- file: xbytechat-api/CRM/Models/Note.cs  (sha256:200a2bd5f7ef4bb6ed3fa7cf3dc7403ea1b2e236a843b985dfc1c02c4fe75112)
`$lang
namespace xbytechat.api.CRM.Models
{
    public class Note
    {
        public Guid Id { get; set; }

        // 🔗 Ownership & Association
        public Guid? BusinessId { get; set; }
        public Guid? ContactId { get; set; }

        // 📝 Core Content
        public string Title { get; set; } // Optional short title (for pinning or preview)
        public string Content { get; set; }

        // 🔖 Contextual Intelligence
        public string Source { get; set; } // e.g., "Manual", "Call Log", "WhatsApp", "LeadForm"
        public string CreatedBy { get; set; } // Store agent/user name or userId

        // 📌 UX Flags
        public bool IsPinned { get; set; } = false;
        public bool IsInternal { get; set; } = false; // if true, only visible to team

        // 🕓 Timestamps
        public DateTime CreatedAt { get; set; }
        public DateTime? EditedAt { get; set; }
    }
}
``n
--- file: xbytechat-api/CRM/Models/Reminder.cs  (sha256:bc1e21ef857422a3ea4524863c8adefe038dc7cd43c474ae463ca6ca5379a830)
`$lang
using System;

namespace xbytechat.api.CRM.Models
{
    public class Reminder
    {
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }   // For multi-tenant isolation

        public Guid ContactId { get; set; }    // Which contact this reminder is for

        public string Title { get; set; } = default!; // Main reminder title (e.g., "Call back about invoice")

        public string? Description { get; set; } // Longer notes, optional (for internal detail)

        public DateTime DueAt { get; set; }    // When reminder should notify

        public string Status { get; set; } = "Pending"; // "Pending", "Done", "Overdue"

        public string? ReminderType { get; set; } // e.g., "Call", "Email", "Follow-up", "Meeting"

        public int? Priority { get; set; } // e.g., 1 (High), 2 (Medium), 3 (Low)

        public bool IsRecurring { get; set; } = false; // For future → repeat reminder

        public string? RecurrencePattern { get; set; } // e.g., "Weekly", "Monthly" (optional)

        public bool SendWhatsappNotification { get; set; } = false; // Future: auto-WA message trigger

        public string? LinkedCampaign { get; set; } // Optional: which campaign this reminder relates to

        public bool IsActive { get; set; } = true;  // Soft delete support

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public DateTime? UpdatedAt { get; set; }

        public DateTime? CompletedAt { get; set; } // Track when it was marked Done

        public string? LastCTAType { get; set; } // e.g., Confirm, Reschedule
        public DateTime? LastClickedAt { get; set; }
        public bool FollowUpSent { get; set; } = false;

    }
}


``n
--- file: xbytechat-api/CRM/Models/Tag.cs  (sha256:e654598a682f6c55d536da4b9e18ace295abe7d611603fd18eaf61f4a5baff54)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.CRM.Models
{
    public class Tag
    {
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }             // Multi-tenant isolation

        public string Name { get; set; } = default!;     // e.g., "VIP", "Follow-up"

        public string? ColorHex { get; set; }            // For UI tag styling (e.g., #FF5733)

        public string? Category { get; set; }            // e.g., "Priority", "Campaign", "Stage"

        public string? Notes { get; set; }               // Admin/internal notes about this tag

        public bool IsSystemTag { get; set; } = false;   // Reserved tags like "New", "Subscribed"

        public bool IsActive { get; set; } = true;       // For soft-deactivation (future bulk ops)

        public DateTime CreatedAt { get; set; }          // For analytics / sorting

        public DateTime? LastUsedAt { get; set; }        // Useful for CRM insights later

        public ICollection<ContactTag> ContactTags { get; set; } = new List<ContactTag>(); // Linked contacts
    }
}

``n
--- file: xbytechat-api/CRM/Services/ContactService.cs  (sha256:cad7c60170297a52cb81725b735932da01f726445ee3f9a86cc00eb5e5213708)
`$lang
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using CsvHelper;
using CsvHelper.Configuration;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using xbytechat.api;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Models;

namespace xbytechat.api.CRM.Services
{
    public class ContactService : IContactService
    {
        private readonly AppDbContext _db;
        private readonly ILogger<ContactService> _logger;

        public ContactService(AppDbContext db, ILogger<ContactService> logger)
        {
            _db = db;
            _logger = logger;
        }

        public async Task<ContactDto> AddContactAsync(Guid businessId, ContactDto dto)
        {
            _logger.LogInformation("AddContactAsync called for businessId={BusinessId}, Name={Name}", businessId, dto.Name);

            var contact = new Contact
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                Name = dto.Name,
                PhoneNumber = dto.PhoneNumber,
                Email = dto.Email,
                LeadSource = dto.LeadSource,
                LastContactedAt = dto.LastContactedAt?.ToUniversalTime(),
                NextFollowUpAt = dto.NextFollowUpAt?.ToUniversalTime(),
                Notes = dto.Notes,
                CreatedAt = DateTime.UtcNow,
                IsFavorite = dto.IsFavorite,
                IsArchived = dto.IsArchived,
                Group = dto.Group
            };

            if (dto.Tags != null && dto.Tags.Any())
            {
                contact.ContactTags = dto.Tags.Select(t => new ContactTag
                {
                    Id = Guid.NewGuid(),
                    ContactId = contact.Id,
                    TagId = t.TagId,
                    BusinessId = businessId,
                    AssignedAt = DateTime.UtcNow,
                    AssignedBy = "system"
                }).ToList();
            }

            _db.Contacts.Add(contact);

            try
            {
                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact added: {ContactId} for businessId={BusinessId}", contact.Id, businessId);
            }
            catch (DbUpdateException ex)
            {
                _logger.LogError(ex, "DB error in AddContactAsync (Contact: {Contact}, BusinessId={BusinessId})", contact, businessId);
                var innerMessage = ex.InnerException?.Message ?? ex.Message;
                throw new Exception("❌ DB save error (Contact): " + innerMessage, ex);
            }

            return new ContactDto
            {
                Id = contact.Id,
                Name = contact.Name,
                PhoneNumber = contact.PhoneNumber,
                Email = contact.Email,
                LeadSource = contact.LeadSource,
                LastContactedAt = contact.LastContactedAt,
                NextFollowUpAt = contact.NextFollowUpAt,
                Notes = contact.Notes,
                CreatedAt = contact.CreatedAt,
                Tags = dto.Tags ?? new List<ContactTagDto>()
            };
        }

        public async Task<ContactDto> GetContactByIdAsync(Guid businessId, Guid contactId)
        {
            _logger.LogInformation("GetContactByIdAsync: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
            try
            {
                var contact = await _db.Contacts
                     .Where(c => c.BusinessId == businessId && c.Id == contactId && c.IsActive)
                    .Include(c => c.ContactTags)
                        .ThenInclude(ct => ct.Tag)
                    .FirstOrDefaultAsync();

                if (contact == null)
                {
                    _logger.LogWarning("Contact not found: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                    return null;
                }

                return new ContactDto
                {
                    Id = contact.Id,
                    Name = contact.Name,
                    PhoneNumber = contact.PhoneNumber,
                    Email = contact.Email,
                    LeadSource = contact.LeadSource,
                    LastContactedAt = contact.LastContactedAt,
                    NextFollowUpAt = contact.NextFollowUpAt,
                    Notes = contact.Notes,
                    CreatedAt = contact.CreatedAt,
                    Tags = contact.ContactTags?
                        .Where(ct => ct.Tag != null)
                        .Select(ct => new ContactTagDto
                        {
                            TagId = ct.TagId,
                            TagName = ct.Tag.Name
                        })
                        .ToList() ?? new List<ContactTagDto>()
                };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error fetching contact by id: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                throw;
            }
        }

        public async Task<bool> UpdateContactAsync(Guid businessId, ContactDto dto)
        {
            _logger.LogInformation("UpdateContactAsync: businessId={BusinessId}, contactId={ContactId}", businessId, dto.Id);
            try
            {
                var contact = await _db.Contacts
                    .Include(c => c.ContactTags)
                    .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.Id == dto.Id);

                if (contact == null)
                {
                    _logger.LogWarning("Contact not found for update: businessId={BusinessId}, contactId={ContactId}", businessId, dto.Id);
                    return false;
                }

                contact.Name = dto.Name;
                contact.PhoneNumber = dto.PhoneNumber;
                contact.Email = dto.Email;
                contact.LeadSource = dto.LeadSource;
                contact.LastContactedAt = dto.LastContactedAt?.ToUniversalTime();
                contact.NextFollowUpAt = dto.NextFollowUpAt?.ToUniversalTime();
                contact.Notes = dto.Notes;

                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact updated: {ContactId}", contact.Id);
                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error updating contact: businessId={BusinessId}, contactId={ContactId}", businessId, dto.Id);
                throw;
            }
        }

        public async Task<bool> DeleteContactAsync(Guid businessId, Guid contactId)
        {
            _logger.LogInformation("DeleteContactAsync: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
            try
            {
                var contact = await _db.Contacts
                    .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.Id == contactId && c.IsActive);

                if (contact == null)
                {
                    _logger.LogWarning("Contact not found for delete: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                    return false;
                }

                contact.IsActive = false; // 👈 Soft delete
                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact soft-deleted: {ContactId}", contactId);
                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error deleting contact: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                throw;
            }
        }

        //public async Task<CsvImportResult<ContactDto>> ParseCsvToContactsAsync(Guid businessId, Stream csvStream)
        //{
        //    _logger.LogInformation("ParseCsvToContactsAsync: businessId={BusinessId}", businessId);
        //    var result = new CsvImportResult<ContactDto>();

        //    var config = new CsvConfiguration(CultureInfo.InvariantCulture)
        //    {
        //        HeaderValidated = null,
        //        MissingFieldFound = null
        //    };

        //    using var reader = new StreamReader(csvStream);
        //    using var csv = new CsvReader(reader, config);

        //    csv.Context.RegisterClassMap<ContactDtoCsvMap>();

        //    int rowNumber = 1; // Assuming header row is 1

        //    await csv.ReadAsync();
        //    csv.ReadHeader();

        //    while (await csv.ReadAsync())
        //    {
        //        rowNumber++;
        //        try
        //        {
        //            var record = csv.GetRecord<ContactDto>();
        //            record.CreatedAt = DateTime.UtcNow;
        //            result.SuccessRecords.Add(record);
        //        }
        //        catch (Exception ex)
        //        {
        //            result.Errors.Add(new CsvImportError
        //            {
        //                RowNumber = rowNumber, 
        //                ErrorMessage = ex.Message
        //            });
        //        }
        //    }

        //    _logger.LogInformation("CSV parsed with {SuccessCount} successes and {ErrorCount} errors.",
        //        result.SuccessRecords.Count, result.Errors.Count);

        //    return result;
        //}

        public async Task<CsvImportResult<ContactDto>> ParseCsvToContactsAsync(Guid businessId, Stream csvStream)
        {
            _logger.LogInformation("ParseCsvToContactsAsync: businessId={BusinessId}", businessId);

            var result = new CsvImportResult<ContactDto>();

            var config = new CsvConfiguration(CultureInfo.InvariantCulture)
            {
                HeaderValidated = null,
                MissingFieldFound = null
            };

            using var reader = new StreamReader(csvStream);
            using var csv = new CsvReader(reader, config);

            // Register custom column mapping for ContactDto
            csv.Context.RegisterClassMap<ContactDtoCsvMap>();

            int rowNumber = 1;

            await csv.ReadAsync();     // Move to first row
            csv.ReadHeader();          // Read header row

            while (await csv.ReadAsync())
            {
                rowNumber++;
                try
                {
                    var record = csv.GetRecord<ContactDto>();
                    record.CreatedAt = DateTime.UtcNow;

                    result.SuccessRecords.Add(record);
                }
                catch (Exception ex)
                {
                    // Avoid ambiguity by using explicit object instantiation
                    var error = new CsvImportError
                    {
                        RowNumber = rowNumber,
                        ErrorMessage = ex.Message
                    };
                    result.Errors.Add(error);
                }
            }

            _logger.LogInformation("CSV parsed with {SuccessCount} successes and {ErrorCount} errors.",
                result.SuccessRecords.Count, result.Errors.Count);

            return result;
        }

        public async Task<Contact> FindOrCreateAsync(Guid businessId, string phoneNumber)
        {
            _logger.LogInformation("FindOrCreateAsync: businessId={BusinessId}, phoneNumber={PhoneNumber}", businessId, phoneNumber);
            try
            {
                var contact = await _db.Contacts
                    .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.PhoneNumber == phoneNumber);

                if (contact != null)
                {
                    _logger.LogInformation("Contact already exists: contactId={ContactId}", contact.Id);
                    return contact;
                }

                var newContact = new Contact
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    Name = "WhatsApp User",
                    PhoneNumber = phoneNumber,
                    CreatedAt = DateTime.UtcNow
                };

                _db.Contacts.Add(newContact);
                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact created: {ContactId}", newContact.Id);

                return newContact;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error in FindOrCreateAsync: businessId={BusinessId}, phoneNumber={PhoneNumber}", businessId, phoneNumber);
                throw;
            }
        }

        public async Task<bool> ToggleFavoriteAsync(Guid businessId, Guid contactId)
        {
            _logger.LogInformation("ToggleFavoriteAsync: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
            try
            {
                var contact = await _db.Contacts.FirstOrDefaultAsync(c => c.BusinessId == businessId && c.Id == contactId);
                if (contact == null)
                {
                    _logger.LogWarning("Contact not found for favorite toggle: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                    return false;
                }

                contact.IsFavorite = !contact.IsFavorite;
                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact favorite toggled: {ContactId} -> {IsFavorite}", contactId, contact.IsFavorite);
                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error toggling favorite: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                throw;
            }
        }

        public async Task AssignTagToContactsAsync(Guid businessId, List<Guid> contactIds, Guid tagId)
        {
            _logger.LogInformation("AssignTagToContactsAsync: businessId={BusinessId}, tagId={TagId}, contactIds={ContactIds}", businessId, tagId, contactIds);
            try
            {
                var contacts = await _db.Contacts
                    .Where(c => c.BusinessId == businessId && contactIds.Contains(c.Id))
                    .Include(c => c.ContactTags)
                    .ToListAsync();

                foreach (var contact in contacts)
                {
                    bool alreadyAssigned = contact.ContactTags.Any(link => link.TagId == tagId);
                    if (!alreadyAssigned)
                    {
                        contact.ContactTags.Add(new ContactTag
                        {
                            ContactId = contact.Id,
                            TagId = tagId
                        });
                    }
                }
                await _db.SaveChangesAsync();
                _logger.LogInformation("Tags assigned to contacts");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error assigning tag: businessId={BusinessId}, tagId={TagId}", businessId, tagId);
                throw;
            }
        }

        public async Task<bool> ToggleArchiveAsync(Guid businessId, Guid contactId)
        {
            _logger.LogInformation("ToggleArchiveAsync: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
            try
            {
                var contact = await _db.Contacts.FirstOrDefaultAsync(c => c.BusinessId == businessId && c.Id == contactId);
                if (contact == null)
                {
                    _logger.LogWarning("Contact not found for archive toggle: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                    return false;
                }

                contact.IsArchived = !contact.IsArchived;
                await _db.SaveChangesAsync();
                _logger.LogInformation("Contact archive toggled: {ContactId} -> {IsArchived}", contactId, contact.IsArchived);
                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error toggling archive: businessId={BusinessId}, contactId={ContactId}", businessId, contactId);
                throw;
            }
        }

        public async Task<IEnumerable<ContactDto>> GetAllContactsAsync(Guid businessId, string? tab = "all")
        {
            _logger.LogInformation("GetAllContactsAsync: businessId={BusinessId}, tab={Tab}", businessId, tab);
            try
            {
                var baseQuery = _db.Contacts
                    .Where(c => c.BusinessId == businessId && c.IsActive);

                if (tab == "favourites")
                    baseQuery = baseQuery.Where(c => c.IsFavorite);
                else if (tab == "archived")
                    baseQuery = baseQuery.Where(c => c.IsArchived);
                else if (tab == "groups")
                    baseQuery = baseQuery.Where(c => !string.IsNullOrEmpty(c.Group));

                var query = baseQuery
                    .Include(c => c.ContactTags)
                    .ThenInclude(ct => ct.Tag);

                var contacts = await query.ToListAsync();

                var result = contacts.Select(c => new ContactDto
                {
                    Id = c.Id,
                    Name = c.Name,
                    PhoneNumber = c.PhoneNumber,
                    Email = c.Email,
                    LeadSource = c.LeadSource,
                    LastContactedAt = c.LastContactedAt,
                    NextFollowUpAt = c.NextFollowUpAt,
                    Notes = c.Notes,
                    CreatedAt = c.CreatedAt,
                    IsFavorite = c.IsFavorite,
                    IsArchived = c.IsArchived,
                    Group = c.Group,
                    Tags = c.ContactTags?
                        .Where(ct => ct.Tag != null)
                        .Select(ct => new ContactTagDto
                        {
                            TagId = ct.TagId,
                            TagName = ct.Tag.Name,
                            ColorHex = ct.Tag.ColorHex,
                            Category = ct.Tag.Category
                        })
                        .ToList() ?? new List<ContactTagDto>()
                });

                _logger.LogInformation("GetAllContactsAsync returned {Count} contacts", contacts.Count);
                return result;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error in GetAllContactsAsync: businessId={BusinessId}", businessId);
                throw;
            }
        }
        public async Task<PagedResult<ContactDto>> GetPagedContactsAsync(Guid businessId, string? tab, int page, int pageSize, string? searchTerm)
        {
            _logger.LogInformation("GetPagedContactsAsync: businessId={BusinessId}, tab={Tab}, page={Page}, pageSize={PageSize}",
                businessId, tab, page, pageSize);

            if (page < 1) page = 1;
            if (pageSize < 1) pageSize = 25;
            if (pageSize > 100) pageSize = 100; // max limit

            var baseQuery = _db.Contacts
                .Where(c => c.BusinessId == businessId && c.IsActive);

            if (tab == "favourites")
                baseQuery = baseQuery.Where(c => c.IsFavorite);
            else if (tab == "archived")
                baseQuery = baseQuery.Where(c => c.IsArchived);
            else if (tab == "groups")
                baseQuery = baseQuery.Where(c => !string.IsNullOrEmpty(c.Group));

            var totalCount = await baseQuery.CountAsync();

            var contacts = await baseQuery
                .Include(c => c.ContactTags)
                    .ThenInclude(ct => ct.Tag)
                .OrderBy(c => c.Name) // or any order preferred
                .Skip((page - 1) * pageSize)
                .Take(pageSize)
                .ToListAsync();

            var items = contacts.Select(c => new ContactDto
            {
                Id = c.Id,
                Name = c.Name,
                PhoneNumber = c.PhoneNumber,
                Email = c.Email,
                LeadSource = c.LeadSource,
                LastContactedAt = c.LastContactedAt,
                NextFollowUpAt = c.NextFollowUpAt,
                Notes = c.Notes,
                CreatedAt = c.CreatedAt,
                IsFavorite = c.IsFavorite,
                IsArchived = c.IsArchived,
                Group = c.Group,
                Tags = c.ContactTags?
                    .Where(ct => ct.Tag != null)
                    .Select(ct => new ContactTagDto
                    {
                        TagId = ct.TagId,
                        TagName = ct.Tag.Name,
                        ColorHex = ct.Tag.ColorHex,
                        Category = ct.Tag.Category
                    })
                    .ToList() ?? new List<ContactTagDto>()
            }).ToList();

            return new PagedResult<ContactDto>
            {
                Items = items,
                TotalCount = totalCount
            };
        }

        public async Task<IEnumerable<ContactDto>> GetContactsByTagsAsync(Guid businessId, List<string> tags)
        {
            var contacts = await _db.Contacts
                .Where(c => c.BusinessId == businessId && !c.IsArchived)
                .Include(c => c.ContactTags)
                    .ThenInclude(ct => ct.Tag)
                .Where(c => c.ContactTags.Any(ct => tags.Contains(ct.Tag.Name))) // 🔍 Filter by tag names
                .OrderBy(c => c.Name)
                .Select(c => new ContactDto
                {
                    Id = c.Id,
                    Name = c.Name,
                    PhoneNumber = c.PhoneNumber,
                    Email = c.Email,
                    Notes = c.Notes,
                    Tags = c.ContactTags.Select(ct => new ContactTagDto
                    {
                        TagId = ct.Tag.Id,
                        TagName = ct.Tag.Name,
                        ColorHex = ct.Tag.ColorHex,
                        Category = ct.Tag.Category
                    }).ToList()
                })
                .ToListAsync();

            return contacts;
        }
        public async Task<BulkImportResultDto> BulkImportAsync(Guid businessId, Stream csvStream)
        {
            _logger.LogInformation("Bulk import started for businessId={BusinessId}", businessId);

            var result = new BulkImportResultDto();
            var config = new CsvConfiguration(CultureInfo.InvariantCulture)
            {
                HeaderValidated = null,
                MissingFieldFound = null
            };

            using var reader = new StreamReader(csvStream);
            using var csv = new CsvReader(reader, config);
            csv.Context.RegisterClassMap<ContactDtoCsvMap>();

            await csv.ReadAsync();
            csv.ReadHeader();

            var contactsToAdd = new List<Contact>();
            int row = 1;

            while (await csv.ReadAsync())
            {
                row++;
                try
                {
                    var dto = csv.GetRecord<ContactDto>();
                    if (string.IsNullOrWhiteSpace(dto.PhoneNumber)) continue;

                    var contact = new Contact
                    {
                        Id = Guid.NewGuid(),
                        Name = dto.Name?.Trim() ?? "Unnamed",
                        PhoneNumber = dto.PhoneNumber.Trim(),
                        Email = dto.Email?.Trim(),
                        Notes = dto.Notes,
                        BusinessId = businessId,
                        CreatedAt = DateTime.UtcNow
                    };

                    contactsToAdd.Add(contact);
                    result.Imported++;
                }
                catch (Exception ex)
                {
                    result.Errors.Add(new CsvImportError
                    {
                        RowNumber = row,
                        ErrorMessage = ex.Message
                    });
                }
            }

            await _db.Contacts.AddRangeAsync(contactsToAdd);
            await _db.SaveChangesAsync();

            _logger.LogInformation("Bulk import completed: {Imported} contacts, {Errors} errors",
                result.Imported, result.Errors.Count);

            return result;
        }
        public async Task<IEnumerable<ContactDto>> GetContactsByTagsAsync(Guid businessId, List<Guid> tagIds)
        {
            // Step 1: Prepare base query (without Include yet)
            var baseQuery = _db.Contacts
                .Where(c => c.BusinessId == businessId && !c.IsArchived);

            // Step 2: Apply tag filter only if tagIds are provided
            if (tagIds?.Any() == true)
            {
                baseQuery = baseQuery.Where(c =>
                    c.ContactTags.Any(ct =>
                        tagIds.Contains(ct.TagId)
                    )
                );
            }

            // Step 3: Add Includes after filtering to avoid cast issue
            var queryWithIncludes = baseQuery
                .Include(c => c.ContactTags)
                    .ThenInclude(ct => ct.Tag);

            // Step 4: Fetch data
            var contacts = await queryWithIncludes.ToListAsync();

            // Step 5: Project to DTO
            return contacts.Select(c => new ContactDto
            {
                Id = c.Id,
                Name = c.Name,
                PhoneNumber = c.PhoneNumber,
                Tags = c.ContactTags.Select(ct => new ContactTagDto
                {
                    TagId = ct.Tag.Id,
                    TagName = ct.Tag.Name,
                    ColorHex = ct.Tag.ColorHex,
                    Category = ct.Tag.Category
                }).ToList()
            });
        }
        public async Task<bool> AssignTagsAsync(Guid businessId, string phoneNumber, List<string> tags)
        {
            if (tags == null || tags.Count == 0)
                return false;

            // 🧠 Step 1: Find the contact by phone
            var contact = await _db.Contacts
                .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.PhoneNumber == phoneNumber && !c.IsArchived);

            if (contact == null)
                return false;

            foreach (var tagName in tags)
            {
                if (string.IsNullOrWhiteSpace(tagName))
                    continue;

                // ✅ Step 2: Find or create the tag (by name)
                var tag = await _db.Tags
                    .FirstOrDefaultAsync(t => t.BusinessId == businessId && t.Name == tagName && t.IsActive);

                if (tag == null)
                {
                    tag = new Tag
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        Name = tagName,
                        ColorHex = "#8c8c8c", // default gray if not assigned
                        IsActive = true,
                        CreatedAt = DateTime.UtcNow
                    };
                    _db.Tags.Add(tag);
                }

                // 🧪 Step 3: Check if contact already has this tag
                var alreadyTagged = await _db.ContactTags.AnyAsync(ct =>
                    ct.ContactId == contact.Id && ct.TagId == tag.Id);

                if (!alreadyTagged)
                {
                    _db.ContactTags.Add(new ContactTag
                    {
                        Id = Guid.NewGuid(),
                        ContactId = contact.Id,
                        TagId = tag.Id
                    });
                }
            }

            await _db.SaveChangesAsync();
            return true;
        }

    }
}


``n
--- file: xbytechat-api/CRM/Services/NoteService.cs  (sha256:b2087e02e5275e90dced5ed8e2b0c1cffcbca20c8c11ad2c68fe22cad1adb2fc)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Mappers;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.xbTimelines.Services;

namespace xbytechat.api.CRM.Services
{
    public class NoteService : INoteService
    {
        private readonly AppDbContext _db;
        private readonly ITimelineService _timelineService; // ✅ Injected Timeline Service

        // ✅ Constructor: Inject AppDbContext + TimelineService
        public NoteService(AppDbContext db, ITimelineService timelineService)
        {
            _db = db;
            _timelineService = timelineService;
        }

        // 📝 Add a new Note + Log into LeadTimeline
        public async Task<NoteDto> AddNoteAsync(Guid businessId, NoteDto dto)
        {
            // 1️⃣ Map incoming DTO to Note entity
            var note = NoteMapper.MapToEntity(dto, businessId);

            // 2️⃣ Save the Note into database
            _db.Notes.Add(note);
            await _db.SaveChangesAsync();

            // 3️⃣ Log this Note creation into LeadTimeline (only if ContactId is present)
            if (dto.ContactId.HasValue)
            {
                try
                {
                    await _timelineService.LogNoteAddedAsync(new CRMTimelineLogDto
                    {
                        ContactId = dto.ContactId.Value,       // ➔ Which contact the note is related to
                        BusinessId = businessId,               // ➔ Which business created this
                        EventType = "NoteAdded",                // ➔ Timeline event type
                        Description = $"📝 Note added: {dto.Title ?? "(Untitled)"}", // ➔ Friendly description
                        ReferenceId = note.Id,                  // ➔ Link back to Note Id
                        CreatedBy = dto.CreatedBy,              // ➔ Who created it
                        Timestamp = DateTime.UtcNow             // ➔ When created
                    });
                }
                catch (Exception ex)
                {
                    // 🛡 Timeline saving failure should not break note creation
                    Console.WriteLine($"⚠️ Timeline log failed for NoteId {note.Id}: {ex.Message}");
                }
            }

            // 4️⃣ Return the saved note as DTO
            return NoteMapper.MapToDto(note);
        }

        // 📋 List all Notes by Contact
        public async Task<IEnumerable<NoteDto>> GetNotesByContactAsync(Guid businessId, Guid contactId)
        {
            return await _db.Notes
                .AsNoTracking()
                .Where(n => n.BusinessId == businessId && n.ContactId == contactId)
                .OrderByDescending(n => n.CreatedAt)
                .Select(n => NoteMapper.MapToDto(n))
                .ToListAsync();
        }

        // 📋 Get a single Note by Id
        public async Task<NoteDto?> GetNoteByIdAsync(Guid businessId, Guid noteId)
        {
            var note = await _db.Notes
                .AsNoTracking()
                .FirstOrDefaultAsync(n => n.Id == noteId && n.BusinessId == businessId);

            return note == null ? null : NoteMapper.MapToDto(note);
        }

        // ✏️ Update an existing Note
        public async Task<bool> UpdateNoteAsync(Guid businessId, Guid noteId, NoteDto dto)
        {
            var note = await _db.Notes.FirstOrDefaultAsync(n => n.Id == noteId && n.BusinessId == businessId);
            if (note == null) return false;

            note.Title = dto.Title;
            note.Content = dto.Content;
            note.IsPinned = dto.IsPinned;
            note.IsInternal = dto.IsInternal;
            note.EditedAt = DateTime.SpecifyKind(DateTime.UtcNow, DateTimeKind.Utc); // Always UTC timestamp

            await _db.SaveChangesAsync();
            return true;
        }

        // 🗑️ Soft delete (actually remove) a Note
        public async Task<bool> DeleteNoteAsync(Guid businessId, Guid noteId)
        {
            var note = await _db.Notes.FirstOrDefaultAsync(n => n.Id == noteId && n.BusinessId == businessId);
            if (note == null) return false;

            _db.Notes.Remove(note);
            await _db.SaveChangesAsync();
            return true;
        }
    }
}

``n
--- file: xbytechat-api/CRM/Services/ReminderService.cs  (sha256:3ad4d8d834b958a925554f6aadbc8360ec657324fee3f939680f3c37df7076a0)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Mappers;
using xbytechat.api.CRM.Models;

namespace xbytechat.api.CRM.Services
{
    public class ReminderService : IReminderService
    {
        private readonly AppDbContext _db;

        public ReminderService(AppDbContext db)
        {
            _db = db;
        }

        //public async Task<ReminderDto> AddReminderAsync(Guid businessId, ReminderDto dto)
        //{
        //    var reminder = new Reminder
        //    {
        //        Id = Guid.NewGuid(),
        //        BusinessId = businessId,
        //        //ContactId = dto.ContactId,
        //        Title = dto.Title,
        //        Description = dto.Description,
        //        DueAt = dto.DueAt,
        //        Status = dto.Status ?? "Pending",
        //        ReminderType = dto.ReminderType,
        //        Priority = dto.Priority,
        //        IsRecurring = dto.IsRecurring,
        //        RecurrencePattern = dto.RecurrencePattern,
        //        SendWhatsappNotification = dto.SendWhatsappNotification,
        //        LinkedCampaign = dto.LinkedCampaign,
        //        CreatedAt = DateTime.UtcNow,
        //        IsActive = true
        //    };

        //    _db.Reminders.Add(reminder);
        //    await _db.SaveChangesAsync();

        //    return MapToDto(reminder);
        //}
        public async Task<ReminderDto> AddReminderAsync(Guid businessId, ReminderDto dto)
        {
            try
            {
                var reminder = new Reminder
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    ContactId = dto.ContactId ?? Guid.Empty, // add default fallback
                    Title = dto.Title,
                    Description = dto.Description,
                    DueAt = DateTime.SpecifyKind(dto.DueAt, DateTimeKind.Utc),
                    Status = dto.Status ?? "Pending",
                    ReminderType = dto.ReminderType,
                    Priority = dto.Priority,
                    IsRecurring = dto.IsRecurring,
                    RecurrencePattern = dto.RecurrencePattern,
                    SendWhatsappNotification = dto.SendWhatsappNotification,
                    LinkedCampaign = dto.LinkedCampaign,
                    CreatedAt = DateTime.SpecifyKind(dto.DueAt, DateTimeKind.Utc),
                    IsActive = true
                };

                _db.Reminders.Add(reminder);
                await _db.SaveChangesAsync();

                return MapToDto(reminder);
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Error in AddReminderAsync: " + ex.Message);
                throw;
            }
        }

        public async Task<IEnumerable<ReminderDto>> GetAllRemindersAsync(Guid businessId)
        {
            return await _db.Reminders
                .AsNoTracking()
                .Where(r => r.BusinessId == businessId && r.IsActive)
                .OrderBy(r => r.DueAt)
                .Select(r => ReminderMapper.MapToDto(r))
                .ToListAsync();
        }


        public async Task<ReminderDto?> GetReminderByIdAsync(Guid businessId, Guid reminderId)
        {
            var reminder = await _db.Reminders
                .FirstOrDefaultAsync(r => r.BusinessId == businessId && r.Id == reminderId && r.IsActive);

            return reminder == null ? null : MapToDto(reminder);
        }

        public async Task<bool> UpdateReminderAsync(Guid businessId, Guid reminderId, ReminderDto dto)
        {
            var reminder = await _db.Reminders.FirstOrDefaultAsync(r => r.BusinessId == businessId && r.Id == reminderId && r.IsActive);
            if (reminder == null) return false;

            reminder.Title = dto.Title;
            reminder.Description = dto.Description;
            reminder.DueAt = DateTime.SpecifyKind(dto.DueAt, DateTimeKind.Utc);
            reminder.Status = dto.Status ?? reminder.Status;
            reminder.ReminderType = dto.ReminderType;
            reminder.Priority = dto.Priority;
            reminder.IsRecurring = dto.IsRecurring;
            reminder.RecurrencePattern = dto.RecurrencePattern;
            reminder.SendWhatsappNotification = dto.SendWhatsappNotification;
            reminder.LinkedCampaign = dto.LinkedCampaign;
            reminder.UpdatedAt = DateTime.UtcNow;

            if (dto.Status?.ToLower() == "done")
                reminder.CompletedAt = DateTime.UtcNow;

            await _db.SaveChangesAsync();
            return true;
        }

        public async Task<bool> DeleteReminderAsync(Guid businessId, Guid reminderId)
        {
            var reminder = await _db.Reminders.FirstOrDefaultAsync(r => r.BusinessId == businessId && r.Id == reminderId && r.IsActive);
            if (reminder == null) return false;

            reminder.IsActive = false;
            await _db.SaveChangesAsync();
            return true;
        }

        private ReminderDto MapToDto(Reminder r)
        {
            return new ReminderDto
            {
                Id = r.Id,
                ContactId = r.ContactId,
                Title = r.Title,
                Description = r.Description,
                DueAt = r.DueAt,
                Status = r.Status,
                ReminderType = r.ReminderType,
                Priority = r.Priority,
                IsRecurring = r.IsRecurring,
                RecurrencePattern = r.RecurrencePattern,
                SendWhatsappNotification = r.SendWhatsappNotification,
                LinkedCampaign = r.LinkedCampaign,
                CreatedAt = r.CreatedAt,
                UpdatedAt = r.UpdatedAt,
                CompletedAt = r.CompletedAt,
                IsActive = r.IsActive
            };
        }
    }
}

``n
--- file: xbytechat-api/CRM/Services/TagService.cs  (sha256:e6319aeaf570d7b97052cbcabccb0de70ab4649b141cea3a48e625b620caa0c1)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.xbTimelines.Services;

namespace xbytechat.api.CRM.Services
{
    public class TagService : ITagService
    {
        private readonly AppDbContext _db;
        private readonly ITimelineService _timelineService; // ✅ Injected TimelineService
        private readonly ILogger<TagService> _logger;
        public TagService(AppDbContext db, ITimelineService timelineService, ILogger<TagService> logger)
        {
            _db = db;
            _timelineService = timelineService;
            _logger = logger;
        }

        public async Task<TagDto> AddTagAsync(Guid businessId, TagDto dto)
        {
            var tag = new Tag
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                Name = dto.Name,
                ColorHex = dto.ColorHex,
                Category = dto.Category,
                Notes = dto.Notes,
                IsSystemTag = dto.IsSystemTag,
                IsActive = dto.IsActive,
                CreatedAt = DateTime.UtcNow,
                LastUsedAt = null
            };

            _db.Tags.Add(tag);
            await _db.SaveChangesAsync();

            // ✅ After saving tag → try logging into Timeline (non-blocking)
            try
            {
                await _timelineService.LogTagAppliedAsync(new CRMTimelineLogDto
                {
                    ContactId = Guid.Empty,    // ➡️ No specific contact, general event
                    BusinessId = businessId,
                    EventType = "TagCreated",
                    Description = $"🏷️ New tag created: {dto.Name}",
                    ReferenceId = tag.Id,
                    CreatedBy = "System",
                    Timestamp = DateTime.UtcNow,
                    Category = "CRM"
                });
            }
            catch (Exception ex)
            {
                // 🛡 Fail-safe: Do not block tag creation if timeline fails
                Console.WriteLine($"⚠️ Timeline log failed for TagId {tag.Id}: {ex.Message}");
            }

            return new TagDto
            {
                Id = tag.Id,
                Name = tag.Name,
                ColorHex = tag.ColorHex,
                Category = tag.Category,
                Notes = tag.Notes,
                IsSystemTag = tag.IsSystemTag,
                IsActive = tag.IsActive,
                CreatedAt = tag.CreatedAt,
                LastUsedAt = tag.LastUsedAt
            };
        }

        public async Task<IEnumerable<TagDto>> GetAllTagsAsync(Guid businessId)
        {
            return await _db.Tags
                .Where(t => t.BusinessId == businessId && t.IsActive)
                .OrderByDescending(t => t.CreatedAt)
                .Select(t => new TagDto
                {
                    Id = t.Id,
                    Name = t.Name,
                    ColorHex = t.ColorHex,
                    Category = t.Category,
                    Notes = t.Notes,
                    IsSystemTag = t.IsSystemTag,
                    IsActive = t.IsActive,
                    CreatedAt = t.CreatedAt,
                    LastUsedAt = t.LastUsedAt
                })
                .ToListAsync();
        }

        public async Task<bool> UpdateTagAsync(Guid businessId, Guid tagId, TagDto dto)
        {
            var tag = await _db.Tags.FirstOrDefaultAsync(t => t.Id == tagId && t.BusinessId == businessId);
            if (tag == null) return false;

            tag.Name = dto.Name;
            tag.ColorHex = dto.ColorHex;
            tag.Category = dto.Category;
            tag.Notes = dto.Notes;
            tag.IsSystemTag = dto.IsSystemTag;
            tag.IsActive = dto.IsActive;
            tag.LastUsedAt = DateTime.UtcNow;

            await _db.SaveChangesAsync();
            return true;
        }

        public async Task<bool> DeleteTagAsync(Guid businessId, Guid tagId)
        {
            var tag = await _db.Tags.FirstOrDefaultAsync(t => t.Id == tagId && t.BusinessId == businessId);
            if (tag == null) return false;

            tag.IsActive = false;
            await _db.SaveChangesAsync();
            return true;
        }
        //public async Task AssignTagAsync(Guid businessId, string phone, string tag)
        //{
        //    try
        //    {
        //        // ✅ Step 1: Lookup contact
        //        var contact = await _db.Contacts
        //            .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.PhoneNumber == phone);

        //        if (contact == null)
        //        {
        //            _logger.LogWarning("⚠️ Contact not found for phone: {Phone}", phone);
        //            return;
        //        }

        //        // ✅ Step 2: Check if tag exists
        //        var existingTag = await _db.Tags
        //            .FirstOrDefaultAsync(t => t.BusinessId == businessId && t.Name == tag);

        //        if (existingTag == null)
        //        {
        //            existingTag = new Tag
        //            {
        //                Id = Guid.NewGuid(),
        //                BusinessId = businessId,
        //                Name = tag,
        //                CreatedAt = DateTime.UtcNow
        //            };

        //            await _db.Tags.AddAsync(existingTag);
        //        }

        //        // ✅ Step 3: Associate tag with contact if not already
        //        var alreadyTagged = await _db.ContactTags
        //            .AnyAsync(ct => ct.ContactId == contact.Id && ct.TagId == existingTag.Id);

        //        if (!alreadyTagged)
        //        {
        //            await _db.ContactTags.AddAsync(new ContactTag
        //            {
        //                Id = Guid.NewGuid(),
        //                ContactId = contact.Id,
        //                TagId = existingTag.Id,
        //                AssignedAt = DateTime.UtcNow
        //            });

        //            _logger.LogInformation("🏷 Tag '{Tag}' assigned to contact {ContactId}", tag, contact.Id);
        //        }

        //        await _db.SaveChangesAsync();
        //    }
        //    catch (Exception ex)
        //    {
        //        _logger.LogError(ex, "❌ Error assigning tag to contact.");
        //        throw;
        //    }
        //}
        public async Task AssignTagsAsync(Guid businessId, string phoneNumber, List<string> tagNames)
        {
            if (tagNames == null || !tagNames.Any())
                return;

            // 🔍 Fetch the contact and existing tag links
            var contact = await _db.Contacts
             .Include(c => c.ContactTags)
             .FirstOrDefaultAsync(c => c.BusinessId == businessId && c.PhoneNumber == phoneNumber);


            if (contact == null) return;

            var existingTagIds = contact.ContactTags.Select(t => t.TagId).ToHashSet();

            // 🔍 Ensure tags exist or create them
            var tags = await _db.Tags
                .Where(t => t.BusinessId == businessId && tagNames.Contains(t.Name))
                .ToListAsync();

            var existingNames = tags.Select(t => t.Name).ToHashSet(StringComparer.OrdinalIgnoreCase);
            var missingNames = tagNames.Where(t => !existingNames.Contains(t)).Distinct().ToList();

            foreach (var name in missingNames)
            {
                var newTag = new Tag
                {
                    Id = Guid.NewGuid(),
                    Name = name,
                    BusinessId = businessId,
                    CreatedAt = DateTime.UtcNow
                };
                _db.Tags.Add(newTag);
                tags.Add(newTag);
            }

            await _db.SaveChangesAsync(); // Save new tags before linking

            // ✅ Link new tags to contact
            foreach (var tag in tags)
            {
                if (!existingTagIds.Contains(tag.Id))
                {
                    contact.ContactTags.Add(new ContactTag
                    {
                        Id = Guid.NewGuid(),
                        TagId = tag.Id,
                        ContactId = contact.Id,
                        BusinessId = businessId,
                        AssignedAt = DateTime.UtcNow,
                        AssignedBy = "automation" // optional: set to flow name
                    });
                }
            }

            await _db.SaveChangesAsync();
        }
    }
}

``n
--- file: xbytechat-api/Data/AppDbContext.cs  (sha256:1d0133425b58fdc5b25f76370481d0709aacc757a52ddc7ca1ec139c82dd5a74)
`$lang
using Microsoft.EntityFrameworkCore;
using System.Globalization;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.Catalog.Models;
using xbytechat.api.Models.BusinessModel;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.AccessControl.Models;
using xbytechat.api.Features.AccessControl.Seeder;
using xbytechat.api.Features.AuditTrail.Models;
using xbytechat.api.Features.xbTimelines.Models;
using xbytechat_api.WhatsAppSettings.Models;
using xbytechat.api.Features.CTAManagement.Models;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.Webhooks.Models;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Features.Inbox.Models;
using xbytechat.api.Features.AutoReplyBuilder.Models;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.FeatureAccessModule.Models;
using xbytechat.api.Features.PlanManagement.Models;
using xbytechat.api.Features.Automation.Models;

namespace xbytechat.api
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options)
            : base(options) { }

        // ✅ Table Registrations
        public DbSet<Business> Businesses { get; set; }
        public DbSet<User> Users { get; set; }
        public DbSet<MessageLog> MessageLogs { get; set; }
        public DbSet<Product> Products { get; set; }
        public DbSet<CatalogClickLog> CatalogClickLogs { get; set; }
        public DbSet<Contact> Contacts { get; set; }
        public DbSet<Tag> Tags { get; set; }
        public DbSet<Reminder> Reminders { get; set; }
        public DbSet<Note> Notes { get; set; }
        public DbSet<LeadTimeline> LeadTimelines { get; set; }
        public DbSet<ContactTag> ContactTags { get; set; }
        public DbSet<Campaign> Campaigns { get; set; }
        public DbSet<CampaignRecipient> CampaignRecipients { get; set; }
        public DbSet<CampaignSendLog> CampaignSendLogs { get; set; }
        public DbSet<MessageStatusLog> MessageStatusLogs { get; set; }

        // 🧩 Access Control
        public DbSet<Role> Roles { get; set; }
        public DbSet<Permission> Permissions { get; set; }
        public DbSet<RolePermission> RolePermissions { get; set; }
        public DbSet<UserPermission> UserPermissions { get; set; }
        public DbSet<AuditLog> AuditLogs { get; set; }
        public DbSet<WhatsAppSettingEntity> WhatsAppSettings { get; set; }
        public DbSet<BusinessPlanInfo> BusinessPlanInfos { get; set; }

        public DbSet<TrackingLog> TrackingLogs { get; set; }
        public DbSet<CTADefinition> CTADefinitions { get; set; }
        public DbSet<CampaignButton> CampaignButtons { get; set; }
        public DbSet<FailedWebhookLog> FailedWebhookLogs { get; set; }
        public DbSet<WebhookSettings> WebhookSettings { get; set; }

        public DbSet<CTAFlowConfig> CTAFlowConfigs { get; set; }
        public DbSet<CTAFlowStep> CTAFlowSteps { get; set; }
        public DbSet<FlowButtonLink> FlowButtonLinks { get; set; }

        public DbSet<CampaignFlowOverride> CampaignFlowOverrides { get; set; }
        public DbSet<FlowExecutionLog> FlowExecutionLogs { get; set; }
        public DbSet<ContactRead> ContactReads { get; set; }

        public DbSet<AutoReplyRule> AutoReplyRules { get; set; }
        public DbSet<AutoReplyFlow> AutoReplyFlows { get; set; }
        public DbSet<AutoReplyFlowNode> AutoReplyFlowNodes { get; set; }
        public DbSet<AutoReplyFlowEdge> AutoReplyFlowEdges { get; set; }
        public DbSet<AutoReplyLog> AutoReplyLogs { get; set; }
        public DbSet<ChatSessionState> ChatSessionStates { get; set; }
        public DbSet<Plan> Plans { get; set; }
        public DbSet<PlanPermission> PlanPermissions { get; set; }
        public DbSet<FeatureAccess> FeatureAccess { get; set; }
        public DbSet<PlanFeatureMatrix> PlanFeatureMatrix { get; set; }
        public DbSet<UserFeatureAccess> UserFeatureAccess { get; set; }
        public DbSet<FeatureMaster> FeatureMasters { get; set; }
        public DbSet<AutomationFlow> AutomationFlows { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // ✅ Seed Role IDs (keep them consistent)
            var superadminRoleId = Guid.Parse("00000000-0000-0000-0000-000000000001");
            var partnerRoleId = Guid.Parse("00000000-0000-0000-0000-000000000002");
            var resellerRoleId = Guid.Parse("00000000-0000-0000-0000-000000000003");
            var businessRoleId = Guid.Parse("00000000-0000-0000-0000-000000000004");
            var agentRoleId = Guid.Parse("00000000-0000-0000-0000-000000000005");

            // ✅ Roles
            modelBuilder.Entity<Role>().HasData(
                new Role { Id = superadminRoleId, Name = "admin", Description = "Super Admin", CreatedAt = DateTime.UtcNow },
                new Role { Id = partnerRoleId, Name = "partner", Description = "Business Partner", CreatedAt = DateTime.UtcNow },
                new Role { Id = resellerRoleId, Name = "reseller", Description = "Reseller Partner", CreatedAt = DateTime.UtcNow },
                new Role { Id = businessRoleId, Name = "business", Description = "Business Owner", CreatedAt = DateTime.UtcNow },
                new Role { Id = agentRoleId, Name = "staff", Description = "Staff", CreatedAt = DateTime.UtcNow }
            );

            // ✅ Permissions from RolePermissionMapping
            var allPermissions = RolePermissionMapping.RolePermissions
                .SelectMany(p => p.Value)
                .Distinct()
                .ToList();

            var permissionEntities = allPermissions.Select((perm, index) => new Permission
            {
                Id = Guid.Parse($"30000000-0000-0000-0000-{index.ToString("D12", CultureInfo.InvariantCulture)}"),
                Name = perm,
                Code = perm,
                Description = $"Permission for {perm}",
                IsActive = true,
                CreatedAt = DateTime.UtcNow
            }).ToList();
            modelBuilder.Entity<Permission>().HasData(permissionEntities);

            // ✅ RolePermission mappings
            var permissionMap = permissionEntities.ToDictionary(p => p.Name, p => p.Id);
            var roleMap = new Dictionary<string, Guid>
            {
                ["admin"] = superadminRoleId,
                ["partner"] = partnerRoleId,
                ["reseller"] = resellerRoleId,
                ["business"] = businessRoleId,
                ["staff"] = agentRoleId
            };

            var rolePermissions = RolePermissionMapping.RolePermissions
                .SelectMany(rp => rp.Value.Select(permissionName => new RolePermission
                {
                    Id = Guid.NewGuid(),
                    RoleId = roleMap[rp.Key],
                    PermissionId = permissionMap[permissionName],
                    IsActive = true,
                    AssignedAt = DateTime.UtcNow
                }))
                .ToList();

            modelBuilder.Entity<RolePermission>().HasData(rolePermissions);

            // ========== 🧩 CORRECT RELATIONSHIPS ==========

            // Role ↔️ RolePermission (One-to-Many)
            modelBuilder.Entity<RolePermission>()
                .HasOne(rp => rp.Role)
                .WithMany(r => r.RolePermissions)
                .HasForeignKey(rp => rp.RoleId)
                .OnDelete(DeleteBehavior.Cascade);

            // Permission ↔️ RolePermission (One-to-Many)
            modelBuilder.Entity<RolePermission>()
                .HasOne(rp => rp.Permission)
                .WithMany(p => p.RolePermissions)
                .HasForeignKey(rp => rp.PermissionId)
                .OnDelete(DeleteBehavior.Cascade);

            // User ↔️ UserPermission (One-to-Many)
            modelBuilder.Entity<UserPermission>()
                .HasOne(up => up.User)
                .WithMany(u => u.UserPermissions)
                .HasForeignKey(up => up.UserId)
                .OnDelete(DeleteBehavior.Cascade);

            // Permission ↔️ UserPermission (One-to-Many)
            modelBuilder.Entity<UserPermission>()
                .HasOne(up => up.Permission)
                .WithMany(p => p.UserPermissions)
                .HasForeignKey(up => up.PermissionId)
                .OnDelete(DeleteBehavior.Cascade);

            // ========== (Rest of your model mappings below remain the same) ==========

            modelBuilder.Entity<CampaignSendLog>()
                .HasOne(s => s.MessageLog)
                .WithMany()
                .HasForeignKey(s => s.MessageLogId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<LeadTimeline>()
                .HasOne(t => t.Contact)
                .WithMany()
                .HasForeignKey(t => t.ContactId);

            modelBuilder.Entity<Campaign>()
                .HasOne(c => c.Business)
                .WithMany(b => b.Campaigns)
                .HasForeignKey(c => c.BusinessId)
                .IsRequired();

            modelBuilder.Entity<CampaignRecipient>()
                .HasOne(r => r.Campaign)
                .WithMany(c => c.Recipients)
                .HasForeignKey(r => r.CampaignId);

            modelBuilder.Entity<CampaignRecipient>()
                .HasOne(r => r.Contact)
                .WithMany()
                .HasForeignKey(r => r.ContactId);

            modelBuilder.Entity<CampaignRecipient>()
                .HasOne(r => r.Business)
                .WithMany()
                .HasForeignKey(r => r.BusinessId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<CampaignSendLog>()
                .HasOne(s => s.Recipient)
                .WithMany(r => r.SendLogs)
                .HasForeignKey(s => s.RecipientId);

            modelBuilder.Entity<CampaignSendLog>()
                .HasOne(s => s.Contact)
                .WithMany()
                .HasForeignKey(s => s.ContactId);

            modelBuilder.Entity<CampaignSendLog>()
                .HasOne(s => s.Campaign)
                .WithMany(c => c.SendLogs)
                .HasForeignKey(s => s.CampaignId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<ContactTag>()
                .HasOne(ct => ct.Contact)
                .WithMany(c => c.ContactTags)
                .HasForeignKey(ct => ct.ContactId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<ContactTag>()
                .HasOne(ct => ct.Tag)
                .WithMany(t => t.ContactTags)
                .HasForeignKey(ct => ct.TagId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<Role>()
                .HasMany(r => r.Users)
                .WithOne(u => u.Role)
                .HasForeignKey(u => u.RoleId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<Campaign>()
                .HasMany(c => c.MultiButtons)
                .WithOne(b => b.Campaign)
                .HasForeignKey(b => b.CampaignId)
                .OnDelete(DeleteBehavior.Cascade);

            modelBuilder.Entity<MessageLog>()
                .HasOne(m => m.SourceCampaign)
                .WithMany(c => c.MessageLogs)
                .HasForeignKey(m => m.CampaignId)
                .OnDelete(DeleteBehavior.Restrict);

            modelBuilder.Entity<CampaignSendLog>()
                .Property(s => s.BusinessId)
                .IsRequired();

            modelBuilder.Entity<FlowButtonLink>()
                .HasKey(b => b.Id);

            modelBuilder.Entity<Business>()
                .HasOne(b => b.WhatsAppSettings)
                .WithOne()
                .HasForeignKey<WhatsAppSettingEntity>(s => s.BusinessId);

            modelBuilder.Entity<ContactRead>()
                .HasIndex(cr => new { cr.ContactId, cr.UserId })
                .IsUnique();

            modelBuilder.Entity<AutoReplyFlowNode>()
                .OwnsOne(n => n.Position);

            modelBuilder.Entity<FeatureAccess>()
            .HasIndex(f => new { f.BusinessId, f.FeatureName })
            .IsUnique();

        }
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/BaseMessageDto.cs  (sha256:9af6b10a0f81ca1fef4fa6f55228cf022cf8f574e7dc66dcee263cde3074a20d)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.DTOs.Messages
{
    public abstract class BaseMessageDto
    {
        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        [Phone]
        public string RecipientNumber { get; set; }

        public abstract string MessageContent { get; set; }

        //[Required]
        //public string MessageType { get; set; }
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/BulkMessageDto.cs  (sha256:c9cf233e8ad3bf868c53de4f40343b326e34c668d015097e2aa6a1221696b9c4)
`$lang
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.DTOs.Messages
{
    public class BulkMessageDto
    {
        [Required]
        public List<Guid> ContactIds { get; set; } = new();

        [Required]
        public string MessageType { get; set; } = string.Empty; // "text" or "template"

        [Required]
        public string MessageTemplate { get; set; } = string.Empty;

        public string? TemplateName { get; set; }

        public List<string>? TemplateParams { get; set; }

        public DateTime? ScheduledAt { get; set; } // Optional future scheduling
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/CtaMessageDto.cs  (sha256:80af1338096deb56a727a9ac543829c364442d6f67637455296e227a56abbd7b)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.DTOs.Messages
{
    public class CtaMessageDto
    {
        // 🎯 Required Fields
        public string RecipientPhone { get; set; } = string.Empty;
        public string BodyText { get; set; } = string.Empty;
        public List<string> Buttons { get; set; } = new();

        // 🔗 Optional Source Info
        public Guid? BusinessId { get; set; }          // Optional: Track for MessageLog
        public Guid? CampaignId { get; set; }          // Optional: If triggered via Campaign
        public string? SourceModule { get; set; }      // e.g., "Catalog", "CRM", "Timeline"

        // 👤 Customer Context (Optional Enrichment)
        public string? CustomerId { get; set; }
        public string? CustomerName { get; set; }
        public string? CustomerPhone { get; set; }

        // 📦 Advanced (Optional but useful)
        public string? BotId { get; set; }             // Bot which served this (optional)
        public string? RefMessageId { get; set; }      // Link to previous message (thread)
        public string? CTATriggeredFrom { get; set; }  // e.g., “Buy Now”, “Know More”

        // ⏱️ Timestamps / Meta
        public DateTime? ScheduledAt { get; set; }     // For future automation (optional)
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/ImageMessageDto.cs  (sha256:f5c8436e0d3055ef94a5fd88067f1497534a889f1296174babd92385a36494cf)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.DTOs.Messages
{
    public class ImageMessageDto : BaseMessageDto
    {
        [Required]
        public override string MessageContent { get; set; } = string.Empty;

        [Required]
        [Url]
        public string MediaUrl { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/RawMessageWrapper.cs  (sha256:d7ac355237d8f59f61eeeee123e9450f669ff9eb387359212b8c2c2456ac4353)
`$lang
// DTOs/Messages/RawMessageWrapper.cs
using Newtonsoft.Json.Linq;

public class RawMessageWrapper
{
    public string MessageType { get; set; } = string.Empty;
    public JObject Payload { get; set; } = new JObject();
}

``n
--- file: xbytechat-api/DTOs/Messages/TemplateMessageDto.cs  (sha256:06b028cea23f4720af49039d87a58cf7134087ad5744eae187c7900c0a2daa35)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.DTOs.Messages
{
    /// <summary>
    /// DTO for sending WhatsApp template-based messages.
    /// </summary>
    public class TemplateMessageDto : BaseMessageDto
    {
        [Required]
        public string TemplateName { get; set; } = string.Empty;

        [Required]
        public string LanguageCode { get; set; } = "en_US";

        public Dictionary<string, string> TemplateParameters { get; set; }

        public List<ButtonPayloadDto>? ButtonParams { get; set; } // ✅ NEW

        public override string MessageContent { get; set; } = "[Template]";
    }

    /// <summary>
    /// DTO for each button in a WhatsApp template.
    /// </summary>
    public class ButtonPayloadDto
    {
        public string SubType { get; set; } = "url"; // or "phone_number"
        public string Index { get; set; } = "0";      // 0-based index as string
        public string Param { get; set; } = string.Empty; // dynamic value for URL or phone number
    }
}

``n
--- file: xbytechat-api/DTOs/Messages/TextMessageDto.cs  (sha256:a899c48829d76e7fdf88be5bdafe15ab5307342c557b6431ba43c60f51a8ee11)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.DTOs.Messages
{
    public class TextMessageDto : BaseMessageDto
    {
        [Required]
        public override string MessageContent { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Controllers/PlanController.cs  (sha256:a399de549f2643097d77c637a587c5d555fec9810c5970e605ed1c9a85ff1086)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Serilog;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.AccessControl.Models;
using xbytechat.api.Features.AccessControl.Services;
using xbytechat.api.Features.Inbox.Services;

namespace xbytechat.api.Features.AccessControl.Controllers
{
    [ApiController]
    [Route("api/admin/plans")]
    [Authorize(Roles = "SuperAdmin")] // Only SuperAdmin can access
    public class PlanController : ControllerBase
    {
        private readonly IPlanService _planService;
        
        private readonly ILogger<PlanController> _logger;
        public PlanController(IPlanService planService)
        {
            _planService = planService;
        }

        [HttpPost("create")]
        public async Task<IActionResult> CreatePlan([FromBody] CreatePlanRequest request)
        {
            if (string.IsNullOrWhiteSpace(request.Name))
                return BadRequest("Plan name is required.");

            var plan = await _planService.CreatePlanAsync(request.Name, request.Description);
            return Ok(plan);
        }

        [HttpPost("{planId}/assign-permissions")]
        public async Task<IActionResult> AssignPermissions(Guid planId, [FromBody] AssignPermissionsRequest request)
        {
            await _planService.AssignPermissionsAsync(planId, request.PermissionIds);
            return Ok(new { success = true });
        }

        [HttpGet]
        public async Task<IActionResult> GetAllPlans()
        {
            var plans = await _planService.GetAllPlansAsync();
            return Ok(plans);
        }

        [HttpGet("{planId}")]
        public async Task<IActionResult> GetPlanDetails(Guid planId)
        {
            var plan = await _planService.GetPlanByIdAsync(planId);
            if (plan == null) return NotFound();

            return Ok(plan);
        }

        [HttpGet("{planId}/permissions")]
        public async Task<IActionResult> GetPermissionsForPlan(Guid planId)
        {
            var permissions = await _planService.GetPermissionsByPlanAsync(planId);
            return Ok(permissions);
        }
    }

    // ✅ DTOs

    public class CreatePlanRequest
    {
        public string Name { get; set; }
        public string? Description { get; set; }
    }

    public class AssignPermissionsRequest
    {
        public List<Guid> PermissionIds { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Models/Permission.cs  (sha256:fcd9e1246cb604b09ae39112c767a3725356276976f6c9dfa886a6c04b8f7937)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class Permission
    {
        public Guid Id { get; set; }

        public string Code { get; set; } // Unique key like "ViewDashboard"

        public string Name { get; set; } // Friendly name like "View Dashboard"

        public string? Group { get; set; } // Optional grouping, e.g., "CRM", "Catalog", "Admin"

        public string? Description { get; set; }

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public ICollection<RolePermission> RolePermissions { get; set; }

        public ICollection<UserPermission> UserPermissions { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Models/Plan.cs  (sha256:ff7331ee580eb764c3179cfb14fc53ab20cef71361c044577b09fa6e6b4d1b8d)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class Plan
    {
        public Guid Id { get; set; }

        public string Code { get; set; } // e.g. "FREE", "SMART", "ADVANCED"
        public string Name { get; set; } // Friendly display name

        public string? Description { get; set; }

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public ICollection<PlanPermission> PlanPermissions { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Models/PlanPermission.cs  (sha256:e6e65f0ae33c19e9d2585d73812bcf99ed207d52ac6d804a3c2bf86b3152eca7)
`$lang
using System;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class PlanPermission
    {
        public Guid Id { get; set; }

        public Guid PlanId { get; set; }
        public Plan Plan { get; set; }

        public Guid PermissionId { get; set; }
        public Permission Permission { get; set; }

        public bool IsActive { get; set; } = true;

        public DateTime AssignedAt { get; set; } = DateTime.UtcNow;
        public string? AssignedBy { get; set; } // Admin email or ID
    }
}


``n
--- file: xbytechat-api/Features/AccessControl/Models/Role.cs  (sha256:4c2e237e65d702febee355976cfc64209fd4cf2d98f87e7ef6de4b199dd048a4)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.AuthModule.Models;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class Role
    {
        public Guid Id { get; set; }

        public string Name { get; set; } // e.g. SuperAdmin, PartnerAdmin, BusinessAdmin, Staff, etc.

        public string? Description { get; set; }

        public bool IsSystemDefined { get; set; } = false; // true for SuperAdmin, PartnerAdmin

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public ICollection<RolePermission> RolePermissions { get; set; }
        public ICollection<User> Users { get; set; } // 🧩 One-to-many relation: Role → Users

    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Models/RolePermission.cs  (sha256:d9b31669bec3fbda1b95c89def9a6cc641e0dd21f5e38583b8dae4c0239b9a8a)
`$lang
using System;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class RolePermission
    {
        public Guid Id { get; set; }

        public Guid RoleId { get; set; }
        public Role Role { get; set; }

        public Guid PermissionId { get; set; }
        public Permission Permission { get; set; }

        public DateTime AssignedAt { get; set; } = DateTime.UtcNow;
        public string? AssignedBy { get; set; } // Admin user email or ID

        public bool IsActive { get; set; } = true; // ✅ Add this line
        public bool IsRevoked { get; set; } = false; // ✅ Required
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Models/UserPermission.cs  (sha256:6b85321ec68fced21477222e85ac56594106c4654b5d99061c42bc1c46d876aa)
`$lang
using System;
using xbytechat.api.AuthModule.Models;

namespace xbytechat.api.Features.AccessControl.Models
{
    public class UserPermission
    {
        public Guid Id { get; set; }

        public Guid UserId { get; set; }
        public User User { get; set; }

        public Guid PermissionId { get; set; }
        public Permission Permission { get; set; }

        public bool IsGranted { get; set; } = true; // ✅ true = allow, false = explicitly deny

        public DateTime AssignedAt { get; set; } = DateTime.UtcNow;
        public string? AssignedBy { get; set; } // Admin or system

        public bool IsRevoked { get; set; } = false; // ✅ Required
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Seeder/PermissionConstants.cs  (sha256:47104d91bf08a96917121e247b83aac03fe402f24bb851d3fa4b1b9ee5375469)
`$lang
namespace xbytechat.api.Features.AccessControl.Seeder
{
    public static class PermissionConstants
    {
        public static class Dashboard
        {
            public const string View = "dashboard.view";
        }

        public static class Campaigns
        {
            public const string View = "campaign.view";
            public const string Create = "campaign.create";
            public const string Delete = "campaign.delete";
        }

        public static class Products
        {
            public const string View = "product.view";
            public const string Create = "product.create";
            public const string Delete = "product.delete";
        }

        public static class CRM
        {
            public const string ContactsView = "contacts.view";
            public const string TagsEdit = "tags.edit";
        }

        public static class Admin
        {
            public const string BusinessApprove = "admin.business.approve";
            public const string ViewLogs = "admin.logs.view";
        }

        // 🆕 Add more modules and permissions here as needed
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Seeder/RolePermissionMapping.cs  (sha256:47f001a1b2d6404c28e73be68faf79485c10c1c0a7dab0a5346cc06fff4f049a)
`$lang
namespace xbytechat.api.Features.AccessControl.Seeder
{
    public static class RolePermissionMapping
    {
        public static readonly Dictionary<string, List<string>> RolePermissions = new()
        {
            ["admin"] = new()
            {
                PermissionConstants.Dashboard.View,
                PermissionConstants.Campaigns.View,
                PermissionConstants.Campaigns.Create,
                PermissionConstants.Campaigns.Delete,
                PermissionConstants.Products.View,
                PermissionConstants.Products.Create,
                PermissionConstants.Products.Delete,
                PermissionConstants.CRM.ContactsView,
                PermissionConstants.CRM.TagsEdit,
                PermissionConstants.Admin.BusinessApprove,
                PermissionConstants.Admin.ViewLogs
            },

            ["business"] = new()
            {
                PermissionConstants.Dashboard.View,
                PermissionConstants.Campaigns.View,
                PermissionConstants.CRM.ContactsView,
                PermissionConstants.Products.View
            },

            ["staff"] = new()
            {
                PermissionConstants.Dashboard.View,
                PermissionConstants.CRM.ContactsView
            }
        };
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Services/AccessControlService.cs  (sha256:61ef8b78157d0d313e9872c31df8b6d0e7a5139d4ae1de38dc8da55ae9f01cc9)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Security.Claims;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.AccessControl.Models;
using xbytechat.api.Repositories.Interfaces;
using System.Linq.Expressions;


namespace xbytechat.api.Features.AccessControl.Services
{
    public class AccessControlService : IAccessControlService
    {
        private readonly IGenericRepository<User> _userRepo;
        private readonly IGenericRepository<RolePermission> _rolePermissionRepo;
        private readonly IGenericRepository<UserPermission> _userPermissionRepo;
        private readonly IGenericRepository<Permission> _permissionRepo;

        public AccessControlService(
            IGenericRepository<User> userRepo,
            IGenericRepository<RolePermission> rolePermissionRepo,
            IGenericRepository<UserPermission> userPermissionRepo,
            IGenericRepository<Permission> permissionRepo
        )
        {
            _userRepo = userRepo;
            _rolePermissionRepo = rolePermissionRepo;
            _userPermissionRepo = userPermissionRepo;
            _permissionRepo = permissionRepo;
        }

        /// <summary>
        /// ✅ Fetch all permissions (Role-based + User-specific) for a given user
        /// </summary>
        public async Task<List<string>> GetPermissionsAsync(Guid userId)
        {
            var user = await _userRepo.FindByIdAsync(userId);
            if (user == null || user.RoleId == null)
                return new List<string>();

            // 🔐 Get Role-based permissions
            var rolePerms = await _rolePermissionRepo
                .WhereAsync(rp => rp.RoleId == user.RoleId && !rp.IsRevoked);

            // 🔐 Get User-specific extra permissions
            var userPerms = await _userPermissionRepo
                .WhereAsync(up => up.UserId == userId && !up.IsRevoked);

            // 🧠 Merge permission IDs
            var permissionIds = rolePerms.Select(r => r.PermissionId)
                .Union(userPerms.Select(u => u.PermissionId))
                .Distinct()
                .ToList();

            // 🎯 Get full permission names from Permission table
            var allPerms = await _permissionRepo
                .WhereAsync(p => permissionIds.Contains(p.Id));

            return allPerms.Select(p => p.Code).Distinct().ToList(); // Use Code (standard)
        }

        /// <summary>
        /// ✅ Runtime permission checker (for controller/middleware)
        /// </summary>
        public bool HasPermission(ClaimsPrincipal user, string requiredPermission)
        {
            var perms = user.Claims
                .Where(c => c.Type == "permissions")
                .Select(c => c.Value)
                .ToList();

            return perms.Contains(requiredPermission);
        }
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Services/IAccessControlService.cs  (sha256:1596c83e56e4da37e66e5e211aee92e040132bf01e57a9f3fa97659d4086e0c3)
`$lang
using System.Security.Claims;

namespace xbytechat.api.Features.AccessControl.Services
{
    public interface IAccessControlService
    {
        Task<List<string>> GetPermissionsAsync(Guid userId);
        bool HasPermission(ClaimsPrincipal user, string permission);
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Services/IPlanService.cs  (sha256:d8608c41fe95d4dc1ee574bf1fbf39016cc3ab08db8aba49f8c64f003f32b2f7)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.AccessControl.Models;

namespace xbytechat.api.Features.AccessControl.Services
{
    public interface IPlanService
    {
        Task<Plan> CreatePlanAsync(string name, string description);
        Task AssignPermissionsAsync(Guid planId, List<Guid> permissionIds);
        Task<List<Permission>> GetPermissionsByPlanAsync(Guid planId);
        Task<List<Plan>> GetAllPlansAsync();
        Task<Plan?> GetPlanByIdAsync(Guid planId);
    }
}

``n
--- file: xbytechat-api/Features/AccessControl/Services/PlanService.cs  (sha256:f72638ec141e47c33274e31d49fd10046b6b4fa292e216ff10f4b3a1de2cf0f2)
`$lang
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.AccessControl.Models;

namespace xbytechat.api.Features.AccessControl.Services
{
    public class PlanService : IPlanService
    {
        private readonly AppDbContext _context;

        public PlanService(AppDbContext context)
        {
            _context = context;
        }

        public async Task<Plan> CreatePlanAsync(string name, string description)
        {
            var plan = new Plan
            {
                Id = Guid.NewGuid(),
                Name = name,
                Description = description,
                CreatedAt = DateTime.UtcNow
            };

            _context.Plans.Add(plan);
            await _context.SaveChangesAsync();
            return plan;
        }

        public async Task AssignPermissionsAsync(Guid planId, List<Guid> permissionIds)
        {
            var existing = await _context.PlanPermissions
                .Where(pp => pp.PlanId == planId)
                .ToListAsync();

            _context.PlanPermissions.RemoveRange(existing);

            var newLinks = permissionIds.Select(pid => new PlanPermission
            {
                Id = Guid.NewGuid(),
                PlanId = planId,
                PermissionId = pid,
                AssignedAt = DateTime.UtcNow
            });

            await _context.PlanPermissions.AddRangeAsync(newLinks);
            await _context.SaveChangesAsync();
        }

        public async Task<List<Permission>> GetPermissionsByPlanAsync(Guid planId)
        {
            return await _context.PlanPermissions
                .Where(pp => pp.PlanId == planId)
                .Include(pp => pp.Permission)
                .Select(pp => pp.Permission)
                .ToListAsync();
        }

        public async Task<List<Plan>> GetAllPlansAsync()
        {
            return await _context.Plans.ToListAsync();
        }

        public async Task<Plan?> GetPlanByIdAsync(Guid planId)
        {
            return await _context.Plans
                .Include(p => p.PlanPermissions)
                .ThenInclude(pp => pp.Permission)
                .FirstOrDefaultAsync(p => p.Id == planId);
        }
    }
}

``n
--- file: xbytechat-api/Features/AuditTrail/DTOs/CreateAuditLogDto.cs  (sha256:845322cca23fe6666ea3c5947bf45d55d34363c27d5bacec30375a04b24a73ef)
`$lang
namespace xbytechat.api.Features.AuditTrail.DTOs;

public class CreateAuditLogDto
{
    public string ActionType { get; set; }
    public string Module { get; set; }
    public string? RecordId { get; set; }

    public string? OldValues { get; set; }
    public string? NewValues { get; set; }
    public string? Description { get; set; }

    public string? IPAddress { get; set; }
    public string? UserAgent { get; set; }
    public string? Location { get; set; }
}

``n
--- file: xbytechat-api/Features/AuditTrail/Models/AuditLog.cs  (sha256:91e4760f6e10564db50d99acec9f1c83de5fd0b8ca2e0d3bc5874d645ac93a45)
`$lang
using System;

namespace xbytechat.api.Features.AuditTrail.Models
{
    public class AuditLog
    {
        public Guid Id { get; set; } = Guid.NewGuid();

        // 📍 Business Context (Multi-Tenant)
        public Guid BusinessId { get; set; }

        // 🙋 Who performed the action
        public Guid PerformedByUserId { get; set; }
        public string? PerformedByUserName { get; set; } // Optional for display
        public string? RoleAtTime { get; set; } // admin / business / agent

        // 🔍 Action Details
        public string ActionType { get; set; } = ""; // e.g., campaign.created, user.login
        public string? Description { get; set; } // Free text for summary or custom note

        // 🌐 Optional: Technical metadata
        public string? IPAddress { get; set; }
        public string? UserAgent { get; set; }
        public string? Location { get; set; } // Optional for geo-capture later

        // 🕒 Timestamp
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/AuditTrail/Services/AuditLogService.cs  (sha256:6b18d820c4191681a1bf26d6672f189bce0cadcfba3c8beb9e29dbed4ad4fdd9)
`$lang
using xbytechat.api.Features.AuditTrail.Models;
using xbytechat.api.Repositories;
using xbytechat.api.Repositories.Interfaces;

namespace xbytechat.api.Features.AuditTrail.Services
{
    public class AuditLogService : IAuditLogService
    {
        private readonly IGenericRepository<AuditLog> _repo;

        public AuditLogService(IGenericRepository<AuditLog> repo)
        {
            _repo = repo;
        }

        public async Task SaveLogAsync(AuditLog log)
        {
            await _repo.AddAsync(log);
        }
    }
}

``n
--- file: xbytechat-api/Features/AuditTrail/Services/IAuditLogService.cs  (sha256:65d811af2c7dc349002b7b1a340a765025625f9fe31c241dccc8f3eaeab15330)
`$lang
using xbytechat.api.Features.AuditTrail.Models;

namespace xbytechat.api.Features.AuditTrail.Services
{
    public interface IAuditLogService
    {
        Task SaveLogAsync(AuditLog log);
    }
}

``n
--- file: xbytechat-api/Features/Automation/Config/ChoiceConfig.cs  (sha256:0d09e0bc40325856d625ab31e93694e661b6df532e5de78f2a55254783e40c1c)
`$lang
namespace xbytechat.api.Features.Automation.Config
{
    public class ChoiceConfig
    {
        public List<ChoiceCondition> Conditions { get; set; } = new();
        public string FallbackNodeId { get; set; }
    }

    public class ChoiceCondition
    {
        public string Match { get; set; }
        public string NextNodeId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Automation/Config/MessageConfig.cs  (sha256:564fbd35e79d9ef3f8b48ed54e15d55a9d0226b7d6ea72315d81b562a7a4ecae)
`$lang
namespace xbytechat.api.Features.Automation.Models.Configs
{
    public class MessageConfig
    {
        public string Text { get; set; } = string.Empty;

        // Future: Add support for media, buttons, templates
    }
}

``n
--- file: xbytechat-api/Features/Automation/Config/TagNodeConfig.cs  (sha256:81144c1418ba70285c6af13bf7aee6346f8f6674416ffc9ab79614bceb3be4d0)
`$lang
using System.Collections.Generic;

namespace xbytechat.api.Features.Automation.Models.Configs
{
    public class TagNodeConfig
    {
        public List<string> Tags { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/Features/Automation/Config/WaitConfig.cs  (sha256:d13667732f9e18370123b10c2881aa385e8d11a33bc01acaf0f7eb96f4903bd6)
`$lang
namespace xbytechat.api.Features.Automation.Models.Configs
{
    public class WaitConfig
    {
        public int Seconds { get; set; } = 2; // Default wait time
    }
}

``n
--- file: xbytechat-api/Features/Automation/Controllers/AutomationController.cs  (sha256:3a2f3e472a351808592f6357f3e907d20c118e1e0f86f035a76e49697013e4ff)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.Automation.DTOs;
using xbytechat.api.Features.Automation.Repositories;
using xbytechat.api.Features.Automation.Services;
using xbytechat.api.Helpers;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.Automation.Controllers
{
    [ApiController]
    [Route("api/automation")]
    [Authorize]
    public class AutomationController : ControllerBase
    {
        private readonly IAutomationFlowRepository _automationRepository;
        private readonly IAutomationRunner _automationRunner;
        private readonly IContactService _contactService;

        public AutomationController(
            IAutomationFlowRepository automationRepository,
            IAutomationRunner automationRunner,
            IContactService contactService)
        {
            _automationRepository = automationRepository;
            _automationRunner = automationRunner;
            _contactService = contactService;
        }

        [HttpPost("trigger")]
        public async Task<IActionResult> TriggerByKeyword([FromBody] AutomationTriggerRequest request)
        {
            var businessId = User.GetBusinessId();
            var userId = User.GetUserId();

            if (string.IsNullOrWhiteSpace(request.Keyword) || string.IsNullOrWhiteSpace(request.Phone))
                return BadRequest("Keyword and phone are required.");

            var flow = await _automationRepository.GetFlowByKeywordAsync(businessId, request.Keyword);
            if (flow == null || !flow.IsActive)
                return NotFound("⚠️ No matching active automation flow found.");

            var contact = await _contactService.FindOrCreateAsync(businessId, request.Phone);

            var result = await _automationRunner.RunFlowAsync(
                flow,
                businessId,
                contact.Id,
                request.Phone,
                request.SourceChannel ?? "manual",
                request.IndustryTag ?? "manual"
            );

            return Ok(result);
        }

    }
}

``n
--- file: xbytechat-api/Features/Automation/DTOs/AutomationEdgeDto.cs  (sha256:d9093a43a35fa0c12238f7c78daec3980190c4160320cfe73c6b93ff2d41c5ce)
`$lang
using System;

namespace xbytechat.api.Features.Automation.DTOs
{
    /// <summary>
    /// Represents a connection (edge) between two automation nodes.
    /// </summary>
    public class AutomationEdgeDto
    {
        public Guid SourceNodeId { get; set; }

        public Guid TargetNodeId { get; set; }

        public string? Condition { get; set; }  // Optional: for future conditional routing (e.g., "if clicked", "if not responded")
    }
}

``n
--- file: xbytechat-api/Features/Automation/DTOs/AutomationTriggerRequest.cs  (sha256:aeca572a0bab580b70dddd50cb6f4e1b282f17508311aaeb9beaefef34d8fa46)
`$lang
namespace xbytechat.api.Features.Automation.DTOs
{
    public class AutomationTriggerRequest
    {
        public string Keyword { get; set; }

        public string Phone { get; set; }

        public string? SourceChannel { get; set; }

        public string? IndustryTag { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Automation/DTOs/MessageNodeConfig.cs  (sha256:8fdadb2bb6457b35ed85d89655b1f6d1d9bc5028a0ec212d9dd7eaa70b1a8e0d)
`$lang
namespace xbytechat.api.Features.Automation.DTOs
{
    public class MessageNodeConfig
    {
        public string Text { get; set; } = string.Empty;

        // Optional: Later you can add buttons, media, etc.
    }
}

``n
--- file: xbytechat-api/Features/Automation/DTOs/TagNodeConfig.cs  (sha256:2feaf9902643a6bb0e59b019cfca34a41ada3abf9f66afffcac065c6bb545b6c)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.Features.Automation.DTOs
{
    public class TagNodeConfig
    {
        public List<Guid> Tags { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/Features/Automation/DTOs/WaitNodeConfig.cs  (sha256:f520007158ae72db229b2a23f437666e64d34fcc96cdd728ad57a4320f152b75)
`$lang
namespace xbytechat.api.Features.Automation.DTOs
{
    public class WaitNodeConfig
    {
        public int Seconds { get; set; } = 3;
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/AutomationFlow.cs  (sha256:7dd5063615cfa824960a08fdd88d9fdf500a3c0461151b27e09fcaa7d97b45fe)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.Automation.Models
{
    /// <summary>
    /// Represents a saved automation flow with nodes and edges.
    /// </summary>
    public class AutomationFlow
    {
        [Key]
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }

        public string Name { get; set; } = string.Empty;

        public string TriggerKeyword { get; set; } = string.Empty; // ✅ Better naming

        public string NodesJson { get; set; } = "[]";

        public string EdgesJson { get; set; } = "[]";

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/AutomationFlowEdge.cs  (sha256:ad1f63ff8580807f996a658e2a95652c94370929e8dd75eac9f1fdc98c398105)
`$lang
namespace xbytechat.api.Features.Automation.Models
{
    public class AutomationFlowEdge
    {
        public string SourceNodeId { get; set; } = string.Empty;
        public string TargetNodeId { get; set; } = string.Empty;
        public string? Condition { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/AutomationFlowNode.cs  (sha256:c18876f0d4c8fdf851da8df67ddff902fee66217b804a6765a9b533f8402e76d)
`$lang
using System;

namespace xbytechat.api.Features.Automation.Models
{
    public class AutomationFlowNode
    {
        public string Id { get; set; } = Guid.NewGuid().ToString("N");
        public string Label { get; set; } = string.Empty;
        public NodeTypeEnum NodeType { get; set; }
        public string ConfigJson { get; set; } = "{}";
    }
}


``n
--- file: xbytechat-api/Features/Automation/Models/AutomationFlowRunResult.cs  (sha256:61407553e4f66fbfdc8c0a51868372170e58411cd6c74e857e8e9cab13e27b6b)
`$lang
using System;

namespace xbytechat.api.Features.Automation.Models
{
    public class AutomationFlowRunResult
    {
        public bool NeedsAgent { get; set; } = false;

        public Guid? HandoffNodeId { get; set; } = null;

        public string? Notes { get; set; }  // Optional: track execution info (e.g., exit reason)

        public DateTime ExecutedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/FlowExecutionContext.cs  (sha256:aef2132567e314889ae4d98f06dd96c43873ab3513b6c02cd8553346e3e7ff57)
`$lang
using System;

namespace xbytechat.api.Features.Automation.Models
{
    /// <summary>
    /// Context required to run an automation flow.
    /// </summary>
    public class FlowExecutionContext
    {
        public AutomationFlow Flow { get; set; }

        public Guid BusinessId { get; set; }

        public Guid ContactId { get; set; }

        public string ContactPhone { get; set; }

        public string SourceChannel { get; set; } = "manual";

        public string IndustryTag { get; set; } = "manual";
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/FlowRunResult.cs  (sha256:64baa95c50dc4528fa36e8ad36a12ac82a0528c8c640797d16b58e17455d6125)
`$lang
using System;

namespace xbytechat.api.Features.Automation.Models
{
    /// <summary>
    /// Represents the result of running an automation flow.
    /// </summary>
    public class FlowRunResult
    {
        public bool NeedsAgent { get; set; } = false;

        public Guid? HandoffNodeId { get; set; } // If agent handoff requested
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/NodeConfigs.cs  (sha256:0e8b3fb72dd676ec59568e34b569e1302a621a35a6efca4553736f89b15b21c4)
`$lang
namespace xbytechat.api.Features.Automation.Models.NodeConfigs
{
    public class MessageConfig
    {
        public string Text { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/NodeTypeEnum.cs  (sha256:ac2b60c1ffd633136ef56df710b0cf7f141496e92e30cd1c4bd42f201f4d85d3)
`$lang
namespace xbytechat.api.Features.Automation.Models
{
    public enum NodeTypeEnum
    {
        Message,
        Wait,
        Tag,
        AgentHandoff,
        Choice,
        Condition,
        Loop,
        End
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/TagNodeConfig.cs  (sha256:9cec10f188aea021e4b186075bf0f84e18cb4071046ade7098c2658d077559f5)
`$lang
using System.Collections.Generic;

namespace xbytechat.api.Features.Automation.Models.NodeConfigs
{
    public class TagNodeConfig
    {
        public List<string> Tags { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/Features/Automation/Models/WaitConfig.cs  (sha256:641533b56ae811de7505263f827bc5f89cc405f67645b053fd06737f1e5fa621)
`$lang
namespace xbytechat.api.Features.Automation.Models.NodeConfigs
{
    public class WaitConfig
    {
        public int Seconds { get; set; } = 1;
    }
}

``n
--- file: xbytechat-api/Features/Automation/Repositories/AutomationFlowRepository.cs  (sha256:0e6a38673480db7c067e41901c2725f6c93683975ffaacfdcefb67bcfe90820e)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Automation.Models;

namespace xbytechat.api.Features.Automation.Repositories
{
    public class AutomationFlowRepository : IAutomationFlowRepository
    {
        private readonly AppDbContext _db;

        public AutomationFlowRepository(AppDbContext db)
        {
            _db = db;
        }

        public async Task<AutomationFlow?> GetByIdAsync(Guid flowId, Guid businessId)
        {
            return await _db.AutomationFlows
                .FirstOrDefaultAsync(f => f.Id == flowId && f.BusinessId == businessId && f.IsActive);
        }

        public async Task<AutomationFlow?> GetFlowByKeywordAsync(Guid businessId, string keyword)
        {
            return await _db.AutomationFlows
                .FirstOrDefaultAsync(f =>
                    f.BusinessId == businessId &&
                    f.TriggerKeyword.ToLower() == keyword.ToLower() &&
                    f.IsActive);
        }

        public async Task<IEnumerable<AutomationFlow>> GetAllByBusinessAsync(Guid businessId)
        {
            return await _db.AutomationFlows
                .Where(f => f.BusinessId == businessId && f.IsActive)
                .OrderBy(f => f.Name)
                .ToListAsync();
        }

        public async Task<AutomationFlow> CreateAsync(AutomationFlow flow)
        {
            flow.Id = Guid.NewGuid();
            flow.CreatedAt = DateTime.UtcNow;
            flow.IsActive = true;

            _db.AutomationFlows.Add(flow);
            await _db.SaveChangesAsync();
            return flow;
        }

        public async Task<AutomationFlow> UpdateAsync(AutomationFlow flow)
        {
            var existing = await _db.AutomationFlows
                .FirstOrDefaultAsync(f => f.Id == flow.Id && f.BusinessId == flow.BusinessId && f.IsActive);

            if (existing == null)
                throw new KeyNotFoundException("Automation flow not found.");

            existing.Name = flow.Name;
            existing.TriggerKeyword = flow.TriggerKeyword;
            existing.NodesJson = flow.NodesJson;
            existing.EdgesJson = flow.EdgesJson;
            existing.UpdatedAt = DateTime.UtcNow;

            _db.AutomationFlows.Update(existing);
            await _db.SaveChangesAsync();

            return existing;
        }

        public async Task<bool> DeleteAsync(Guid flowId, Guid businessId)
        {
            var flow = await _db.AutomationFlows
                .FirstOrDefaultAsync(f => f.Id == flowId && f.BusinessId == businessId && f.IsActive);

            if (flow == null)
                return false;

            flow.IsActive = false;
            flow.UpdatedAt = DateTime.UtcNow;

            _db.AutomationFlows.Update(flow);
            await _db.SaveChangesAsync();
            return true;
        }
        public async Task<AutomationFlow?> GetByKeywordAsync(Guid businessId, string keyword)
        {
            return await _db.AutomationFlows
                .FirstOrDefaultAsync(f =>
                f.BusinessId == businessId &&
                EF.Functions.ILike(f.TriggerKeyword, keyword) &&
                f.IsActive);
        }


    }
}

``n
--- file: xbytechat-api/Features/Automation/Repositories/IAutomationFlowRepository.cs  (sha256:3c0e87413a797f0b2cb7de16b419204f9f84555fd58a4435ca5bffc5f570b2fe)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.Automation.Models;

namespace xbytechat.api.Features.Automation.Repositories
{
    public interface IAutomationFlowRepository
    {
        // 🔍 Get flow by unique FlowId + BusinessId (strict filtering)
        Task<AutomationFlow?> GetByIdAsync(Guid flowId, Guid businessId);

        // 🔍 Get flow by keyword for auto-trigger
        Task<AutomationFlow?> GetFlowByKeywordAsync(Guid businessId, string keyword);

        // 📋 List all flows for business
        Task<IEnumerable<AutomationFlow>> GetAllByBusinessAsync(Guid businessId);

        // ➕ Create flow
        Task<AutomationFlow> CreateAsync(AutomationFlow flow);

        // ✏️ Update flow
        Task<AutomationFlow> UpdateAsync(AutomationFlow flow);

        // ❌ Delete flow
        Task<bool> DeleteAsync(Guid flowId, Guid businessId);
        Task<AutomationFlow?> GetByKeywordAsync(Guid businessId, string keyword);


    }
}


``n
--- file: xbytechat-api/Features/Automation/Services/AutomationRunner.cs  (sha256:3f1cb7807540e05fcd7092da474d3784a3f5c6065fd4c98ca22abc2753b97765)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using Microsoft.EntityFrameworkCore;
using Newtonsoft.Json;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.Automation.Models;
using xbytechat.api.Features.Automation.Models.Configs;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.Inbox.Models;
using xbytechat.api.Features.Automation.Config;

namespace xbytechat.api.Features.Automation.Services
{
    public class AutomationRunner : IAutomationRunner
    {
        private readonly IMessageEngineService _messageService;
        private readonly IContactService _contactService;
        private readonly ILogger<AutomationRunner> _logger;
        private readonly AppDbContext _appDbContext;
        public AutomationRunner(
            IMessageEngineService messageService,
            IContactService contactService,
            ILogger<AutomationRunner> logger, AppDbContext appDbContext)
        {
            _messageService = messageService;
            _contactService = contactService;
            _logger = logger;
            _appDbContext = appDbContext;
        }

        public async Task<AutomationFlowRunResult> RunFlowAsync(
            AutomationFlow flow,
            Guid businessId,
            Guid contactId,
            string contactPhone,
            string sourceChannel,
            string industryTag)
        {
            var nodes = JsonConvert.DeserializeObject<List<AutomationFlowNode>>(flow.NodesJson);
            var edges = JsonConvert.DeserializeObject<List<AutomationFlowEdge>>(flow.EdgesJson);

            var result = new AutomationFlowRunResult();
            var currentNode = nodes.FirstOrDefault(); // Start from first node

            if (currentNode == null)
            {
                _logger.LogWarning("🚫 Flow has no start node.");
                result.NeedsAgent = true;
                result.Notes = "No start node found.";
                return result;
            }

            while (currentNode != null)
            {
                _logger.LogInformation("➡️ Running node: {NodeType} | {NodeId}", currentNode.NodeType, currentNode.Id);

                switch (currentNode.NodeType)
                {
                    case NodeTypeEnum.Message:
                        var msgCfg = JsonConvert.DeserializeObject<MessageConfig>(currentNode.ConfigJson);
                        var msgDto = new TextMessageSendDto
                        {
                            BusinessId = businessId,
                            ContactId = contactId,
                            RecipientNumber = contactPhone,
                            TextContent = msgCfg.Text,
                            Source = "automation"
                        };
                        _logger.LogInformation("📤 Sending message: {Text}", msgCfg.Text);
                        await _messageService.SendAutomationReply(msgDto);
                        break;

                    case NodeTypeEnum.Wait:
                        var waitCfg = JsonConvert.DeserializeObject<WaitConfig>(currentNode.ConfigJson);
                        _logger.LogInformation("⏳ Waiting {Seconds}s", waitCfg.Seconds);
                        await Task.Delay(waitCfg.Seconds * 1000);
                        break;

                    case NodeTypeEnum.Tag:
                        var tagCfg = JsonConvert.DeserializeObject<TagNodeConfig>(currentNode.ConfigJson);
                        _logger.LogInformation("🏷️ Assigning tags: {Tags}", string.Join(", ", tagCfg.Tags));
                        await _contactService.AssignTagsAsync(businessId, contactPhone, tagCfg.Tags);
                        break;

                    case NodeTypeEnum.AgentHandoff:
                        result.NeedsAgent = true;
                        if (Guid.TryParse(currentNode.Id, out var parsedId))
                        {
                            result.HandoffNodeId = parsedId;
                        }
                        else
                        {
                            _logger.LogWarning("⚠️ Invalid node ID format for AgentHandoff node: {Id}", currentNode.Id);
                            result.HandoffNodeId = null;
                        }
                        result.Notes = "Flow routed to human agent.";
                        return result;

                    case NodeTypeEnum.End:
                        _logger.LogInformation("✅ End node reached.");
                        currentNode = null;
                        continue;

                    case NodeTypeEnum.Choice:
                        _logger.LogInformation("🧠 Reached Choice node. Saving session state to wait for user input...");

                        var session = await _appDbContext.ChatSessionStates.FirstOrDefaultAsync(s =>
                            s.BusinessId == businessId && s.ContactId == contactId);

                        if (session == null)
                        {
                            session = new ChatSessionState
                            {
                                Id = Guid.NewGuid(),
                                BusinessId = businessId,
                                ContactId = contactId
                            };
                            _appDbContext.ChatSessionStates.Add(session);
                        }

                        session.Mode = "awaiting_choice";
                        session.UpdatedBy = currentNode.Id.ToString();
                        session.LastUpdatedAt = DateTime.UtcNow;

                        await _appDbContext.SaveChangesAsync();

                        result.Notes = "Choice node reached. Flow paused.";
                        return result;
                }

                var edge = edges.FirstOrDefault(e => e.SourceNodeId == currentNode.Id);
                currentNode = edge == null ? null : nodes.FirstOrDefault(n => n.Id == edge.TargetNodeId);
            }

            result.Notes = "Flow completed.";
            return result;
        }
        public async Task<AutomationFlowRunResult> ResumeFlowAsync(
           Guid businessId,
           Guid contactId,
           string contactPhone,
           string incomingMessage)
        {
            var session = await _appDbContext.ChatSessionStates
                .FirstOrDefaultAsync(s => s.BusinessId == businessId && s.ContactId == contactId);

            if (session == null || session.Mode != "awaiting_choice")
            {
                _logger.LogWarning("❌ No active automation session found or mode not awaiting_choice.");
                return new AutomationFlowRunResult { NeedsAgent = true, Notes = "No active automation session." };
            }

            var flow = await _appDbContext.AutomationFlows
                .Where(f => f.BusinessId == businessId && f.IsActive)
                .OrderByDescending(f => f.UpdatedAt)
                .FirstOrDefaultAsync();

            if (flow == null)
            {
                _logger.LogWarning("❌ No active automation flow found for business.");
                return new AutomationFlowRunResult { NeedsAgent = true, Notes = "No active flow found." };
            }

            var nodes = JsonConvert.DeserializeObject<List<AutomationFlowNode>>(flow.NodesJson);
            var edges = JsonConvert.DeserializeObject<List<AutomationFlowEdge>>(flow.EdgesJson);

            var choiceNode = nodes.FirstOrDefault(n => n.Id == session.UpdatedBy && n.NodeType == NodeTypeEnum.Choice);
            if (choiceNode == null)
            {
                _logger.LogWarning("❌ Stored session node not found or not a Choice node.");
                return new AutomationFlowRunResult { NeedsAgent = true, Notes = "Invalid Choice node in session." };
            }

            var cfg = JsonConvert.DeserializeObject<ChoiceConfig>(choiceNode.ConfigJson);
            if (cfg?.Conditions == null)
            {
                _logger.LogWarning("❌ Choice config is null or empty.");
                return new AutomationFlowRunResult { NeedsAgent = true, Notes = "Invalid Choice config." };
            }

            var match = cfg.Conditions.FirstOrDefault(c =>
                string.Equals(c.Match.Trim(), incomingMessage.Trim(), StringComparison.OrdinalIgnoreCase));

            string nextNodeId = match?.NextNodeId ?? cfg.FallbackNodeId;
            if (match == null)
            {
                _logger.LogWarning("🔁 No matching condition found. Using fallback: {Fallback}", nextNodeId);
            }

            var nextNode = nodes.FirstOrDefault(n => n.Id == nextNodeId);
            if (nextNode == null)
            {
                _logger.LogWarning("❌ Next node after choice not found.");
                return new AutomationFlowRunResult { NeedsAgent = true, Notes = "Next node not found." };
            }

            // ✅ Clear session after resume
            _appDbContext.ChatSessionStates.Remove(session);
            await _appDbContext.SaveChangesAsync();

            // ✅ Resume from the matched node using shared loop
            return await ExecuteNodeLoopAsync(flow, nextNode, nodes, edges, businessId, contactId, contactPhone);
        }


        private async Task<AutomationFlowRunResult> ExecuteNodeLoopAsync(
    AutomationFlow flow,
    AutomationFlowNode startNode,
    List<AutomationFlowNode> nodes,
    List<AutomationFlowEdge> edges,
    Guid businessId,
    Guid contactId,
    string contactPhone)
        {
            var result = new AutomationFlowRunResult();
            var currentNode = startNode;

            while (currentNode != null)
            {
                _logger.LogInformation("➡️ Executing node: {NodeType} | {NodeId}", currentNode.NodeType, currentNode.Id);

                switch (currentNode.NodeType)
                {
                    case NodeTypeEnum.Message:
                        var msgCfg = JsonConvert.DeserializeObject<MessageConfig>(currentNode.ConfigJson);
                        var msgDto = new TextMessageSendDto
                        {
                            BusinessId = businessId,
                            ContactId = contactId,
                            RecipientNumber = contactPhone,
                            TextContent = msgCfg.Text,
                            Source = "automation"
                        };
                        await _messageService.SendAutomationReply(msgDto);
                        break;

                    case NodeTypeEnum.Tag:
                        var tagCfg = JsonConvert.DeserializeObject<TagNodeConfig>(currentNode.ConfigJson);
                        await _contactService.AssignTagsAsync(businessId, contactPhone, tagCfg.Tags);
                        break;

                    case NodeTypeEnum.Wait:
                        var waitCfg = JsonConvert.DeserializeObject<WaitConfig>(currentNode.ConfigJson);
                        await Task.Delay(waitCfg.Seconds * 1000);
                        break;

                    case NodeTypeEnum.End:
                        return new AutomationFlowRunResult { Notes = "✅ Flow ended." };

                    case NodeTypeEnum.AgentHandoff:
                        return new AutomationFlowRunResult
                        {
                            NeedsAgent = true,
                            Notes = "Routed to human agent."
                        };

                    case NodeTypeEnum.Choice:
                        var session = new ChatSessionState
                        {
                            Id = Guid.NewGuid(),
                            BusinessId = businessId,
                            ContactId = contactId,
                            Mode = "awaiting_choice",
                            UpdatedBy = currentNode.Id.ToString(),
                            LastUpdatedAt = DateTime.UtcNow
                        };
                        _appDbContext.ChatSessionStates.Add(session);
                        await _appDbContext.SaveChangesAsync();

                        return new AutomationFlowRunResult { Notes = "Paused at Choice node." };
                }

                var edge = edges.FirstOrDefault(e => e.SourceNodeId == currentNode.Id);
                currentNode = edge == null ? null : nodes.FirstOrDefault(n => n.Id == edge.TargetNodeId);
            }

            return new AutomationFlowRunResult { Notes = "Flow completed." };
        }

    }
}

``n
--- file: xbytechat-api/Features/Automation/Services/AutomationService.cs  (sha256:c42e37b6d7f110e3f94e15cae67213a79f8219feb763ecb1ba4ca86c636e423c)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.Automation.Models;
using xbytechat.api.Features.Automation.Repositories;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.Automation.Services
{
    public class AutomationService : IAutomationService
    {
        private readonly IAutomationFlowRepository _flowRepository;
        private readonly IAutomationRunner _runner;
        private readonly IContactService _contactService;
        private readonly ILogger<AutomationService> _logger;
        private readonly IHttpContextAccessor _httpContextAccessor;

        public AutomationService(
            IAutomationFlowRepository flowRepository,
            IAutomationRunner runner,
            IContactService contactService,
            ILogger<AutomationService> logger,
            IHttpContextAccessor httpContextAccessor)
        {
            _flowRepository = flowRepository;
            _runner = runner;
            _contactService = contactService;
            _logger = logger;
            _httpContextAccessor = httpContextAccessor;
        }

        public async Task<AutomationFlow?> GetFlowByIdAsync(Guid flowId, Guid businessId)
        {
            return await _flowRepository.GetByIdAsync(flowId, businessId);
        }

        public async Task<AutomationFlow?> GetFlowByKeywordAsync(Guid businessId, string keyword)
        {
            return await _flowRepository.GetByKeywordAsync(businessId, keyword);
        }

        public async Task<AutomationFlowRunResult> RunFlowAsync(
            AutomationFlow flow,
            Guid businessId,
            Guid contactId,
            string phone,
            string sourceChannel,
            string industryTag)
        {
            return await _runner.RunFlowAsync(flow, businessId, contactId, phone, sourceChannel, industryTag);
        }

        public async Task<IEnumerable<AutomationFlow>> GetAllFlowsAsync(Guid businessId)
        {
            return await _flowRepository.GetAllByBusinessAsync(businessId);
        }

        public async Task<AutomationFlow> CreateFlowAsync(Guid businessId, AutomationFlow flow)
        {
            flow.BusinessId = businessId;
            return await _flowRepository.CreateAsync(flow);
        }

        public async Task<bool> DeleteFlowAsync(Guid flowId, Guid businessId)
        {
            return await _flowRepository.DeleteAsync(flowId, businessId);
        }

        public async Task RunByKeywordAsync(string messageText, string phoneNumber, string sourceChannel = "whatsapp")
        {
            var businessId = _httpContextAccessor.HttpContext?.User?.GetBusinessId()
                ?? throw new UnauthorizedAccessException("BusinessId could not be resolved from context.");

            var flow = await _flowRepository.GetByKeywordAsync(businessId, messageText);
            if (flow == null)
            {
                _logger.LogInformation("No matching automation flow for keyword: {Keyword}", messageText);
                return;
            }

            var contact = await _contactService.FindOrCreateAsync(businessId, phoneNumber);
            await _runner.RunFlowAsync(flow, businessId, contact.Id, contact.PhoneNumber, sourceChannel, industryTag: "default");
        }

        public async Task<bool> TryRunFlowByKeywordAsync(
         Guid businessId,
         string messageText,
         string userPhone,
         string sourceChannel,
         string industryTag)
        {
            try
            {
                // 🔍 Normalize keyword
                var normalizedKeyword = messageText.Trim().ToLower();

                // ✅ Fetch flow by trigger keyword
                var flow = await _flowRepository.GetByKeywordAsync(businessId, normalizedKeyword);
                if (flow == null)
                {
                    _logger.LogInformation("TryRun: No matching automation flow found for keyword: '{Keyword}'", normalizedKeyword);
                    return false;
                }

                // 👤 Ensure contact exists
                var contact = await _contactService.FindOrCreateAsync(businessId, userPhone);
                if (contact == null)
                {
                    _logger.LogWarning("❌ TryRun: Failed to resolve or create contact for phone: {Phone}", userPhone);
                    return false;
                }

                // ▶️ Run automation flow
                _logger.LogInformation("🚀 Running flow '{FlowName}' for keyword '{Keyword}'", flow.Name, normalizedKeyword);
                await _runner.RunFlowAsync(flow, businessId, contact.Id, contact.PhoneNumber, sourceChannel, industryTag);

                return true;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ TryRun: Exception while executing flow for keyword '{Keyword}'", messageText);
                return false;
            }
        }

    }
}

``n
--- file: xbytechat-api/Features/Automation/Services/IAutomationRunner.cs  (sha256:0aa081c7006bb76ff84c8cee9da21e51a021a69c4e0b6d191ffdc1356b5e4001)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Automation.Models;

namespace xbytechat.api.Features.Automation.Services
{
    public interface IAutomationRunner
    {
        Task<AutomationFlowRunResult> RunFlowAsync(
             AutomationFlow flow,
             Guid businessId,
             Guid contactId,
             string contactPhone,
             string sourceChannel,
             string industryTag
 );

    }
}


``n
--- file: xbytechat-api/Features/Automation/Services/IAutomationService.cs  (sha256:fd32d83e0e970571048b14fb8805162a0b1139c917ed0bf99ad84b4a244ce609)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.Automation.Models;

namespace xbytechat.api.Features.Automation.Services
{
    public interface IAutomationService
    {
        // 📌 Get flow by FlowId (for admin UI or debugging)
        Task<AutomationFlow?> GetFlowByIdAsync(Guid flowId, Guid businessId);

        // 📌 Get flow by keyword match (used for auto-triggering)
        Task<AutomationFlow?> GetFlowByKeywordAsync(Guid businessId, string keyword);

        // 🛠️ Execute a flow with contact and channel info
        Task<AutomationFlowRunResult> RunFlowAsync(
            AutomationFlow flow,
            Guid businessId,
            Guid contactId,
            string phone,
            string sourceChannel,
            string industryTag
        );

        // 📋 List all flows (for admin or dashboard)
        Task<IEnumerable<AutomationFlow>> GetAllFlowsAsync(Guid businessId);

        // ➕ Create new flow
        Task<AutomationFlow> CreateFlowAsync(Guid businessId, AutomationFlow flow);

        // ❌ Delete existing flow
        Task<bool> DeleteFlowAsync(Guid flowId, Guid businessId);

        // ⚡ Runtime entry point – called when a message arrives
        Task RunByKeywordAsync(
            string messageText,
            string phoneNumber,
            string sourceChannel = "whatsapp"
        );

        // ✅ Returns true if flow matched and executed
        Task<bool> TryRunFlowByKeywordAsync(
            Guid businessId,
            string messageText,
            string userPhone,
            string sourceChannel,
            string industryTag
        );
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Controllers/AutoReplyController.cs  (sha256:c575c41a8f3145df1332211adef4017099c86609c2981442039fcfbd0823a6de)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Services;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.AutoReplyBuilder.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class AutoReplyController : ControllerBase
    {
        private readonly IAutoReplyService _service;

        public AutoReplyController(IAutoReplyService service)
        {
            _service = service;
        }

        [HttpPost]
        public async Task<IActionResult> CreateRule([FromBody] AutoReplyRuleDto dto)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var result = await _service.CreateRuleAsync(businessId, dto);
            return Ok(result);
        }

        [HttpGet]
        public async Task<IActionResult> GetAllRules()
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var rules = await _service.GetAllRulesAsync(businessId);
            return Ok(rules);
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetRuleById(Guid id)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var rule = await _service.GetRuleByIdAsync(id, businessId);
            return rule == null ? NotFound() : Ok(rule);
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateRule(Guid id, [FromBody] AutoReplyRuleDto dto)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            dto.Id = id;
            var success = await _service.UpdateRuleAsync(businessId, dto);
            return success ? NoContent() : NotFound();
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteRule(Guid id)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var success = await _service.DeleteRuleAsync(id, businessId);
            return success ? NoContent() : NotFound();
        }

        // Optional — for debugging match logic (not exposed in prod)
        [HttpGet("match")]
        public async Task<IActionResult> MatchByKeyword([FromQuery] string message)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var matchedRule = await _service.MatchRuleByKeywordAsync(businessId, message);
            return matchedRule == null ? NotFound("No match found.") : Ok(matchedRule);
        }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Controllers/AutoReplyFlowsController.cs  (sha256:442d35032e1265a4ba687db6033f7cd70d21c92e30f63d3122e43e50540bb763)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Services;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class AutoReplyFlowsController : ControllerBase
    {
        private readonly IAutoReplyFlowService _service;

        public AutoReplyFlowsController(IAutoReplyFlowService service)
        {
            _service = service;
        }

        // [HttpPost("save")]
        //public async Task<IActionResult> SaveFlow([FromBody] SaveFlowDto dto)
        //{
        //    var id = await _service.SaveFlowAsync(dto);
        //    return Ok(new { id });
        //}
        [HttpPost("save")]
        public async Task<IActionResult> SaveFlow([FromBody] SaveFlowDto dto)
        {
            Guid businessId;
            try { businessId = User.GetBusinessId(); }
            catch (UnauthorizedAccessException) { return Unauthorized("Missing or invalid business ID"); }

            var id = await _service.SaveFlowAsync(dto, businessId);
            return Ok(new { id });
        }

        [HttpGet("business/{businessId}")]
        public async Task<IActionResult> GetFlowsByBusiness(Guid businessId)
        {
            var flows = await _service.GetFlowsByBusinessIdAsync(businessId);
            return Ok(flows);
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetFlowById(Guid id)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);
            var flow = await _service.GetFlowByIdAsync(id, businessId);
            return flow == null ? NotFound() : Ok(flow);
        }
        [HttpGet("business/{businessId}/count")]
        public async Task<IActionResult> GetFlowCount(Guid businessId)
        {
            var count = await _service.GetFlowCountForBusinessAsync(businessId);
            return Ok(count);
        }
        [HttpPut("{id}/rename")]
        public async Task<IActionResult> RenameFlow(Guid id, [FromBody] RenameFlowDto dto)
        {
            var result = await _service.RenameFlowAsync(id, dto.NewName);
            if (!result) return NotFound();
            return Ok();
        }
        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteFlow(Guid id)
        {
            Guid businessId;
            try
            {
                businessId = User.GetBusinessId(); // ✅ Clean and secure
            }
            catch (UnauthorizedAccessException)
            {
                return Unauthorized("Missing or invalid business ID");
            }

            var success = await _service.DeleteFlowAsync(id, businessId);
            if (!success)
                return NotFound("Flow not found or not owned by your business");

            return Ok(new { message = "Flow deleted successfully" });
        }


    }
}


``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Controllers/AutoReplyRuntimeController.cs  (sha256:a8f103874213b2129c6d59932b03582a9f21206d073f756ca97bfe08e0015e85)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Services;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.AutoReplyBuilder.Controllers
{
    [ApiController]
    [Route("api/auto-reply-runtime")]
    [Authorize]
    public class AutoReplyRuntimeController : ControllerBase
    {
        private readonly IAutoReplyRuntimeService _runtimeService;
        private readonly ILogger<AutoReplyRuntimeController> _logger;

        public AutoReplyRuntimeController(
            IAutoReplyRuntimeService runtimeService,
            ILogger<AutoReplyRuntimeController> logger)
        {
            _runtimeService = runtimeService;
            _logger = logger;
        }

        // 🔁 Runtime button reply based on keyword (used in message click)
        [HttpPost("button-click")]
        public async Task<IActionResult> HandleButtonClick([FromBody] AutoReplyButtonClickDto dto)
        {
            var businessId = ClaimsBusinessDetails.GetBusinessId(User);

            _logger.LogInformation("🔘 Button clicked: BusinessId={BusinessId}, Phone={Phone}, Button={ButtonText}, RefMsg={RefMessageId}",
                businessId, dto.Phone, dto.ButtonText, dto.RefMessageId?.ToString() ?? "null");

            await _runtimeService.TryRunAutoReplyFlowByButtonAsync(
                businessId,
                dto.Phone,
                dto.ButtonText,
                dto.RefMessageId
            );

            return Ok(new { success = true });
        }

        // 🧪 Manual test (canvas-based flow trigger)
        [HttpPost("flow-by-button")]
        public async Task<IActionResult> TriggerFlowByButton([FromBody] AutoReplyButtonClickDto dto)
        {
            if (string.IsNullOrWhiteSpace(dto.Phone) || string.IsNullOrWhiteSpace(dto.ButtonText))
                return BadRequest("Phone and ButtonText are required.");

            try
            {
                _logger.LogInformation("🚀 Triggering flow from button: FlowId={FlowId}, BusinessId={BusinessId}, ContactId={ContactId}, Phone={Phone}, ButtonText={ButtonText}",
                    dto.FlowId, dto.BusinessId, dto.ContactId, dto.Phone, dto.ButtonText);

                await _runtimeService.RunFlowFromButtonAsync(
                    dto.FlowId,
                    dto.BusinessId,
                    dto.ContactId,
                    dto.Phone,
                    dto.ButtonText.Trim()
                );

                return Ok(new
                {
                    success = true,
                    flowId = dto.FlowId,
                    contactId = dto.ContactId,
                    triggeredAt = DateTime.UtcNow
                });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to trigger flow from button click: FlowId={FlowId}, Phone={Phone}, Button={ButtonText}",
                    dto.FlowId, dto.Phone, dto.ButtonText);

                return StatusCode(500, "Internal server error");
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Controllers/TemplatesController.cs  (sha256:555d0e0c3deaa65e82290ddcf55e06bb4fa67bbcf43e5b9d56ea5109f7c236b8)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.TemplateMessages.DTOs;

namespace xbytechat.api.Features.TemplateMessages.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class TemplatesController : ControllerBase
    {
        private static readonly List<TemplateDto> MockTemplates = new()
        {
            new TemplateDto
            {
                Id = Guid.NewGuid(),
                Name = "Welcome Template",
                Placeholders = 2
            },
            new TemplateDto
            {
                Id = Guid.NewGuid(),
                Name = "Offer Reminder",
                Placeholders = 1
            },
            new TemplateDto
            {
                Id = Guid.NewGuid(),
                Name = "Follow Up",
                Placeholders = 3
            }
        };

        [HttpGet]
        public ActionResult<List<TemplateDto>> GetAll()
        {
            return Ok(MockTemplates);
        }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/AutoReplyButtonClickDto.cs  (sha256:c33e345f9a02ff4d627ba42ba92505f5819a034035b07bde678784a244b9d6ac)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs
{
    public class AutoReplyButtonClickDto
    {
        public Guid FlowId { get; set; }
        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }
        public string Phone { get; set; } = string.Empty;
        public string ButtonText { get; set; } = string.Empty;
        public Guid? RefMessageId { get; set; }

    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/AutoReplyLogDto.cs  (sha256:4674e27873c9ca6a52ab8c85ac1fb97864c6a1e653138b78096a19b3b230124e)
`$lang
using System;

namespace xbytechat.api.Features.AutoReplyBuilder.DTOs
{
    public class AutoReplyLogDto
    {
        public Guid Id { get; set; }
        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }

        public string TriggerType { get; set; } = "rule"; // or "flow"
        public string TriggerKeyword { get; set; } = string.Empty;
        public string ReplyContent { get; set; } = string.Empty;

        public DateTime TriggeredAt { get; set; }

        public string? FlowName { get; set; }

        public Guid? MessageLogId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/AutoReplyRuleDto.cs  (sha256:47945e41d0ce9fc41bf7949aea8b58a0caf3bb5083fae0bc6d4815ea846d23ab)
`$lang
using System;

namespace xbytechat.api.Features.AutoReplyBuilder.DTOs
{
    /// <summary>
    /// DTO used to create or retrieve AutoReplyRule.
    /// </summary>
    public class AutoReplyRuleDto
    {
        public Guid? Id { get; set; } // Nullable to allow re-use for Create and Update
        public string TriggerKeyword { get; set; } = string.Empty;
        public string ReplyMessage { get; set; } = string.Empty;
        public string? MediaUrl { get; set; } // Optional media
        public int Priority { get; set; } = 0; // Lower = higher priority
        public bool IsActive { get; set; } = true;

        // Audit Fields (optional for now, useful for admin UI)
        public DateTime? CreatedAt { get; set; }
        public DateTime? UpdatedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/ButtonChoiceNodeConfig.cs  (sha256:a573ed18c3b3cce438f3f126b958408f9c6245ac01be98c3db1d0c4a92adbb18)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class ButtonChoiceNodeConfig
    {
        public string PromptText { get; set; } = "Please choose an option:";

        public List<ButtonOption> Options { get; set; } = new();
    }

    public class ButtonOption
    {
        public string Label { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;

        // Optional metadata to control button behavior
        public string? NextStepHint { get; set; } // Can guide user or be used for logging
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/ConditionNodeConfig.cs  (sha256:836736c40f25f700d3a84836ee147930568713f5f623bcdc1569b42ff5b4432e)
`$lang
using System.Collections.Generic;
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class ConditionNodeConfig
    {
    
        public string InputKey { get; set; } = "buttonText";

        public Dictionary<string, string> PathMap { get; set; } = new();
       
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/DecisionNodeConfig.cs  (sha256:5575668b5865a5bb2847165208e60278c44386e8f710abb968606e22bb52fe70)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class DecisionNodeConfig
    {
        public string ConditionType { get; set; } = "keyword"; // or "tag", "time", "plan", etc.
        public string Parameter { get; set; } = string.Empty;   // e.g. "yes", "vip", "evening"
        public string SourceChannel { get; set; } = "whatsapp"; // Optional for multi-channel control
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/FormInputNodeConfig.cs  (sha256:34b1ef9a54bc19dbb2163a80371edaf8d5bf75420e9924e90e82762fa4831216)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class FormInputNodeConfig
    {
        public string QuestionText { get; set; } = "Please enter your response:";

        public string FieldKey { get; set; } = "customer_name";
        // Used for storing user response under a label

        public string? ValidationRegex { get; set; }
        // Optional, e.g., @"^[0-9]{10}$" for phone numbers

        public string? PlaceholderHint { get; set; }
        // e.g., "Full Name", "10-digit Phone"

        public bool IsRequired { get; set; } = true;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/FormNodeConfig.cs  (sha256:f839475742eb0fc23ab0c6e58e1f23a0583e4b649301ac588feb0808dd1c243d)
`$lang
using System.Collections.Generic;
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class FormNodeConfig
    {
        public string Title { get; set; } = "Please fill out this form";

        public List<FormFieldConfig> Fields { get; set; } = new();

        public bool SaveToContact { get; set; } = true; // Whether to update contact info

        public string? SubmitMessage { get; set; } = "Thanks for submitting!";
    }

    public class FormFieldConfig
    {
        public string Key { get; set; } = string.Empty;      // contactName, email, phone
        public string Label { get; set; } = string.Empty;    // "Your Name"
        public string Type { get; set; } = "text";           // text, number, email, etc.
        public bool Required { get; set; } = true;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/ForwardToAgentNodeConfig.cs  (sha256:486eab52256f3ee2bfea5f06ada3bf8fade4f055f1012e4a1291ac0e61c9f35c)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class ForwardToAgentNodeConfig
    {
        public string? NoteToAgent { get; set; } // Optional instruction for agent
        public bool MarkAsUrgent { get; set; } = false;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/NodeIconMap.cs  (sha256:e56ce9b9bdedf03682aaa6c56815fb85dd510ecd2ec1e4c82f53c0fa5c8f9401)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class NodeIconMap
    {
        public static readonly Dictionary<string, string> IconMap = new()
        {
            { NodeTypeEnum.Message, "🗨️" },
            { NodeTypeEnum.Template, "📄" },
            { NodeTypeEnum.Tag, "🏷️" },
            { NodeTypeEnum.Wait, "⏱️" },
            { NodeTypeEnum.ButtonChoice, "🔘" },
            { NodeTypeEnum.Branch, "🌿" },
            { NodeTypeEnum.AgentHandoff, "👨‍💼" },
            { NodeTypeEnum.End, "⛔" }
        };
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/FlowNodeConfigs/NodeTypeEnum.cs  (sha256:d21739b3b7651f2a026a4e412de76d45fe215ae50907b0c7ee025bee0c1ed189)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs.FlowNodeConfigs
{
    public class NodeTypeEnum
    {
        public const string Message = "message";
        public const string Template = "template";
        public const string Tag = "tag";
        public const string Wait = "wait";
        public const string ButtonChoice = "button_choice";
        public const string Branch = "branch";
        public const string End = "end"; // Optional: Used for flow exit
        public const string AgentHandoff = "agent_handoff"; // Optional: Transfer to human
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/RenameFlowDto.cs  (sha256:c2ad4577f121df77190a9463e0eb6528c20054bd0901e7bc9a355aedfb53031c)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.DTOs
{
    public class RenameFlowDto
    {
        public string NewName { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/SaveFlowDto.cs  (sha256:b4b9d49533bad3114236c255a28ecc08bc82a01f1141b981146f320c76cc39f4)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs
{
    public class SaveFlowDto
    {
        public Guid Id { get; set; }
        public Guid BusinessId { get; set; }
        public string Name { get; set; }
        public string? TriggerKeyword { get; set; }
        public List<NodeDto> Nodes { get; set; } = new();
        public List<EdgeDto> Edges { get; set; } = new();
        public DateTime CreatedAt { get; set; }

        public string? IndustryTag { get; set; }     // e.g. "restaurant", "clinic", etc.
        public string? UseCase { get; set; }         // e.g. "Order Flow", "Appointment Flow"
        public bool IsDefaultTemplate { get; set; } = false; // Flag for prebuilt templates

    }

    public class NodeDto
    {
        public string Id { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public AutoPositionDto Position { get; set; } = new();
        public NodeDataDto Data { get; set; } = new();
    }

    public class AutoPositionDto
    {
        public double X { get; set; }
        public double Y { get; set; }
    }

    public class NodeDataDto
    {
        public string Label { get; set; } = string.Empty;
        public object Config { get; set; } = new { };
    }

    public class EdgeDto
    {
        public string Id { get; set; } = string.Empty;
        public string Source { get; set; } = string.Empty;
        public string Target { get; set; } = string.Empty;
        public string SourceNodeId { get; set; } = string.Empty;
        public string TargetNodeId { get; set; } = string.Empty;
        public string SourceHandle { get; set; } = string.Empty;
        public string TargetHandle { get; set; } = string.Empty;
    }
}


//using System;

//namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs
//{
//    public class SaveFlowDto
//    {
//        public Guid Id { get; set; }
//        public Guid BusinessId { get; set; }
//        public string Name { get; set; } = string.Empty;
//        public List<Dictionary<string, object>> Nodes { get; set; }

//        public List<Dictionary<string, object>> Edges { get; set; }
//        public DateTime CreatedAt { get; set; }
//        public string? TriggerKeyword { get; set; }

//    }
//}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/DTOs/TemplateDto.cs  (sha256:42ae32842447bb89f8178a8bae3c490d1fe646b526c27cbe72571e23536f7116)
`$lang
namespace xbytechat.api.Features.TemplateMessages.DTOs
{
    public class TemplateDto
    {
        public Guid Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public int Placeholders { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/AutoReplyEdgeDto.cs  (sha256:5cbac1daff177794f7ae69aabf6b323f279f0b7132dc060e462a91226849f868)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class AutoReplyEdgeDto
    {
        public string Id { get; set; }
        public string SourceNodeId { get; set; }
        public string TargetNodeId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/MessageConfig.cs  (sha256:6e7673134b9b3fabb432529dd4b510007ff1d934f016b3a2d831a4503d01c2c7)
`$lang
// MessageConfig.cs
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class MessageConfig
    {
        public string Text { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/RuntimeConfigs.cs  (sha256:280793d810ae7ce0f016f2671b3627cd52a4029b6ea574d0fee20e0c0e11e5ae)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class RuntimeConfigs
    {
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/TagNodeConfig.cs  (sha256:d9fade9fca5845b7cb33279a01288a4dd94a90aaaed58d384a778209656b5ead)
`$lang
// TagConfig.cs
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class TagNodeConfig
    {
        public List<string> Tags { get; set; } = new();
    }
}


``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/TemplateConfig.cs  (sha256:5c7ea8f78b131705f6bccf1ced0e21a754dadf67bbd6420696995f565c07767a)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class TemplateConfig
    {
        public string TemplateName { get; set; } = string.Empty;
        public List<string> Placeholders { get; set; } = new();
        public string? Language { get; set; } = "en_US";
        public string? ImageUrl { get; set; }
        public List<TemplateButtonDto>? MultiButtons { get; set; } = new();
    }

    public class TemplateButtonDto
    {
        public string ButtonText { get; set; } = string.Empty;
        public string ButtonType { get; set; } = "url"; // or "quick_reply"
        public string TargetUrl { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/DTOs/FlowNodeConfigs/WaitConfig.cs  (sha256:afe336952d0d4959422bbbc499884b286291888fcbd64dd068f26013160261c6)
`$lang
// WaitConfig.cs
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs
{
    public class WaitConfig
    {
        public int Seconds { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Flows/Enum/NodeTypes.cs  (sha256:94b210bd5bbbbce823c3a1beb8172eddf708305bfbb8b897d1e3c7ef10097b36)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Enum
{
    public class NodeTypes
    {
        public const string Start = "start";
        public const string Message = "message";
        public const string Template = "template";
        public const string Wait = "wait";
        public const string Tag = "tag";
        public const string Agent = "agent";
        public const string Condition = "condition"; // Coming soon
        public const string Form = "form";           // For “Ask Name”, “Ask Email”
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/AutoReplyFlow.cs  (sha256:2825905f983da1290a44badeda57c8ff26c8920d7fa13e7ebd85dd0da2e0aaca)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Models
{
    public class AutoReplyFlow
    {
        [Key]
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }

        [Required]
        public string Name { get; set; } = string.Empty;

        [Required]
        public string NodesJson { get; set; } = string.Empty;

        [Required]
        public string EdgesJson { get; set; } = string.Empty;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public string? TriggerKeyword { get; set; }

        public bool IsActive { get; set; } = true;

        public string? IndustryTag { get; set; }    // e.g., "restaurant", "clinic", "education"
        public string? UseCase { get; set; }        // e.g., "Order Flow", "Booking Flow"
        public bool IsDefaultTemplate { get; set; } = false; // Flag to indicate system-provided template
        public string? Keyword { get; set; }

    }
}


``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/AutoReplyFlowEdge.cs  (sha256:7996bdb8fa1917943e90dad9ad4225984a34b6342eb153028849b30ca63abd7f)
`$lang
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class AutoReplyFlowEdge
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid FlowId { get; set; }

        [ForeignKey("FlowId")]
        public AutoReplyFlow Flow { get; set; }

        public string SourceNodeId { get; set; } = string.Empty;
        public string TargetNodeId { get; set; } = string.Empty;
    
        public string? SourceHandle { get; set; }
        public string? TargetHandle { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }

}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/AutoReplyFlowNode.cs  (sha256:88a50d45fe3b72f6c3bc0593104b7ee549180c842628cb3d9048c5227a025871)
`$lang
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class AutoReplyFlowNode
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid FlowId { get; set; }

        [ForeignKey("FlowId")]
        public AutoReplyFlow Flow { get; set; }

        // 🔄 Use a constrained string or enum (recommended for future)
        [Required]
        public string NodeType { get; set; } = string.Empty;

        public string Label { get; set; } = string.Empty;

        public string? NodeName { get; set; } // 🆕 Optional internal label for debugging

        [Required]
        public string ConfigJson { get; set; } = string.Empty;

        public Position Position { get; set; } = new();

        public int Order { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/AutoReplyLog.cs  (sha256:d2949264f0ac5b81395d2dee6578df20759d95d300da30d5f0f9003e0ed1c5eb)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    [Table("AutoReplyLogs")]
    public class AutoReplyLog
    {
        [Key]
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }

        public string TriggerKeyword { get; set; } = string.Empty; // e.g., "hi", "price"
        public string TriggerType { get; set; } = string.Empty;     // "flow" or "rule"

        public string ReplyContent { get; set; } = string.Empty;    // Plaintext summary of what was sent
        public string? FlowName { get; set; }                       // Nullable if rule-based

        public Guid? MessageLogId { get; set; }                     // Optional link to MessageLog
        public DateTime TriggeredAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/AutoReplyRule.cs  (sha256:c3049863f7add2dfd09dd962dbdbc904585fa5db4e12ac189193077bfee08a78)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class AutoReplyRule
    {
        [Key]
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }

        public string TriggerKeyword { get; set; } = string.Empty;

        public string ReplyMessage { get; set; } = string.Empty;

        public string? MediaUrl { get; set; }

        public int Priority { get; set; }

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; }

        public DateTime? UpdatedAt { get; set; }

        public string? FlowName { get; set; }

        // ✅ NEW: Link to the flow
        public Guid? FlowId { get; set; }

        [ForeignKey("FlowId")]
        public AutoReplyFlow? Flow { get; set; }

        public string? IndustryTag { get; set; } // e.g., "restaurant", "clinic", "real_estate"
        public string? SourceChannel { get; set; } // e.g., "whatsapp", "instagram"
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/FlowExecutionContext.cs  (sha256:0d3e6415c151099db94a6f0f6dc8f695fd31492808dc09079919950efedf0776)
`$lang
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class FlowExecutionContext
    {
        public AutoReplyFlow Flow { get; set; } = null!;
        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }
        public string ContactPhone { get; set; } = null!;
        public string SourceChannel { get; set; } = "whatsapp";
        public string IndustryTag { get; set; } = "";
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/FlowNode.cs  (sha256:8991ad6277d58a2785f6a93fd8b8ca815af4ce80351d38f30aaf47890909471f)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class FlowNode
    {
        public string Id { get; set; }
        public string Type { get; set; }
        public Position Position { get; set; }
        public Dictionary<string, object> Data { get; set; }  // This should capture config
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/FlowRunResult.cs  (sha256:67982580319a635214c13b2ec05cc279d9afc21fdeb1224248a8060036e27f5c)
`$lang
// File: Features/AutoReplyBuilder/Models/FlowRunResult.cs

using System;

namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    /// <summary>
    /// Encapsulates the result of running a visual flow, including agent handoff status.
    /// </summary>
    public class FlowRunResult
    {
        public bool NeedsAgent { get; set; } = false;


        public Guid? HandoffNodeId { get; set; }

        public string? ContextJson { get; set; }

    }
}


``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Models/Position.cs  (sha256:0c352c43f4dfcebdc462622ca0acdcd8c1eaafa07a91a70804793d8c76724201)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Models
{
    public class Position
    {
        public double X { get; set; }
        public double Y { get; set; }
    }

}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/AutoReplyFlowRepository.cs  (sha256:d919b1d695c3c29ccc653b806d4884197b3d52fb9eb5f86c0f32f893eb198671)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;
using xbytechat.api.Features.AutoReplyBuilder.Models;

public class AutoReplyFlowRepository : IAutoReplyFlowRepository
{
    private readonly AppDbContext _context;
    private readonly ILogger<AutoReplyFlowRepository> _logger;

    public AutoReplyFlowRepository(AppDbContext context, ILogger<AutoReplyFlowRepository> logger)
    {
        _context = context;
        _logger = logger;
    }

    public async Task<AutoReplyFlow> SaveAsync(AutoReplyFlow flow)
    {
        _context.AutoReplyFlows.Add(flow);
        try
        {
            await _context.SaveChangesAsync();
        }
        catch (DbUpdateException ex)
        {
            _logger.LogError(ex, "❌ Save failed: {0}", ex.InnerException?.Message);
            throw;
        }

        return flow;
    }

    public async Task SaveNodesAndEdgesAsync(IEnumerable<AutoReplyFlowNode> nodes, IEnumerable<AutoReplyFlowEdge> edges)
    {
        _context.AutoReplyFlowNodes.AddRange(nodes);
        _context.AutoReplyFlowEdges.AddRange(edges);
        try
        {
            await _context.SaveChangesAsync();
        }
        catch (DbUpdateException ex)
        {
            _logger.LogError(ex, "❌ Save failed: {0}", ex.InnerException?.Message);
            throw;
        }

    }

    public async Task<List<AutoReplyFlow>> GetAllByBusinessIdAsync(Guid businessId)
    {
        return await _context.AutoReplyFlows
            .Where(f => f.BusinessId == businessId)
            .OrderByDescending(f => f.CreatedAt)
            .ToListAsync();
    }

    public async Task<AutoReplyFlow?> GetByIdAsync(Guid flowId, Guid businessId)
    {
        return await _context.AutoReplyFlows
            .FirstOrDefaultAsync(f => f.Id == flowId && f.BusinessId == businessId);
    }

    public async Task<int> GetFlowCountAsync(Guid businessId)
    {
        return await _context.AutoReplyFlows.CountAsync(f => f.BusinessId == businessId);
    }

    public async Task<bool> RenameFlowAsync(Guid id, string newName)
    {
        var flow = await _context.AutoReplyFlows.FindAsync(id);
        if (flow == null) return false;

        flow.Name = newName;
        try
        {
            await _context.SaveChangesAsync();
        }
        catch (DbUpdateException ex)
        {
            _logger.LogError(ex, "❌ Save failed: {0}", ex.InnerException?.Message);
            throw;
        }

        return true;
    }

    public async Task<bool> DeleteFlowAsync(Guid id, Guid businessId)
    {
        var flow = await _context.AutoReplyFlows
            .FirstOrDefaultAsync(f => f.Id == id && f.BusinessId == businessId);

        if (flow == null) return false;

        _context.AutoReplyFlows.Remove(flow);
        try
        {
            await _context.SaveChangesAsync();
        }
        catch (DbUpdateException ex)
        {
            _logger.LogError(ex, "❌ Save failed: {0}", ex.InnerException?.Message);
            throw;
        }

        return true;
    }
    public async Task<List<AutoReplyFlowNode>> GetNodesByFlowIdAsync(Guid flowId)
    {
        return await _context.AutoReplyFlowNodes
            .Where(n => n.FlowId == flowId)
            .ToListAsync();
    }

    public async Task<List<AutoReplyFlowEdge>> GetEdgesByFlowIdAsync(Guid flowId)
    {
        return await _context.AutoReplyFlowEdges
            .Where(e => e.FlowId == flowId)
            .ToListAsync();
    }
    public async Task<AutoReplyFlow?> FindFlowByKeywordAsync(Guid businessId, string keyword)
    {
        return await _context.AutoReplyFlows
            .Where(f => f.BusinessId == businessId && f.IsActive && f.TriggerKeyword == keyword)
            .OrderByDescending(f => f.CreatedAt)
            .FirstOrDefaultAsync();
    }
    public async Task<List<AutoReplyFlowNode>> GetStructuredNodesAsync(Guid flowId)
    {
        return await _context.AutoReplyFlowNodes
            .Where(n => n.FlowId == flowId)
            .ToListAsync();
    }

    public async Task<List<AutoReplyFlowEdge>> GetStructuredEdgesAsync(Guid flowId)
    {
        return await _context.AutoReplyFlowEdges
            .Where(e => e.FlowId == flowId)
            .ToListAsync();
    }

}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/AutoReplyLogRepository.cs  (sha256:4a8777aecfb95fef141063dfa3475992a3848fdd582209819e66ab552d045f71)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;
using xbytechat.api.Models;
using xbytechat.api.Shared;
using Microsoft.Extensions.Logging;
using xbytechat.api.Features.AutoReplyBuilder.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public class AutoReplyLogRepository : IAutoReplyLogRepository
    {
        private readonly AppDbContext _context;
        private readonly ILogger<AutoReplyLogRepository> _logger;

        public AutoReplyLogRepository(AppDbContext context, ILogger<AutoReplyLogRepository> logger)
        {
            _context = context;
            _logger = logger;
        }

        public async Task SaveAsync(AutoReplyLogDto dto)
        {
            try
            {
                var log = new AutoReplyLog
                {
                    Id = dto.Id,
                    BusinessId = dto.BusinessId,
                    ContactId = dto.ContactId,
                    TriggerKeyword = dto.TriggerKeyword,
                    TriggerType = dto.TriggerType,
                    ReplyContent = dto.ReplyContent,
                    TriggeredAt = dto.TriggeredAt,
                    FlowName = dto.FlowName,
                    MessageLogId = dto.MessageLogId
                };

                _context.AutoReplyLogs.Add(log);
                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to save AutoReplyLog");
                throw;
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/AutoReplyRepository.cs  (sha256:6339294423a06a5ebeacfa42db916a0e6fcac770f4082cb3db53569c2dd80483)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.AutoReplyBuilder.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public class AutoReplyRepository : IAutoReplyRepository
    {
        private readonly AppDbContext _dbContext;

        public AutoReplyRepository(AppDbContext dbContext)
        {
            _dbContext = dbContext;
        }

        public async Task<AutoReplyRule> AddAsync(AutoReplyRule rule)
        {
            _dbContext.AutoReplyRules.Add(rule);
            await _dbContext.SaveChangesAsync();
            return rule;
        }

        public async Task<IEnumerable<AutoReplyRule>> GetAllByBusinessIdAsync(Guid businessId)
        {
            return await _dbContext.AutoReplyRules
                .Where(r => r.BusinessId == businessId && r.IsActive)
                .OrderBy(r => r.Priority)
                .ToListAsync();
        }

        public async Task<AutoReplyRule?> GetByIdAsync(Guid ruleId, Guid businessId)
        {
            return await _dbContext.AutoReplyRules
                .FirstOrDefaultAsync(r => r.Id == ruleId && r.BusinessId == businessId);
        }

        public async Task<bool> UpdateAsync(AutoReplyRule rule)
        {
            _dbContext.AutoReplyRules.Update(rule);
            return await _dbContext.SaveChangesAsync() > 0;
        }

        public async Task<bool> DeleteAsync(Guid ruleId, Guid businessId)
        {
            var rule = await GetByIdAsync(ruleId, businessId);
            if (rule == null) return false;

            _dbContext.AutoReplyRules.Remove(rule);
            return await _dbContext.SaveChangesAsync() > 0;
        }

        public async Task<AutoReplyRule?> MatchByKeywordAsync(Guid businessId, string incomingMessage)
        {
            return await _dbContext.AutoReplyRules
                .Where(r => r.BusinessId == businessId && r.IsActive)
                .OrderBy(r => r.Priority)
                .FirstOrDefaultAsync(r => incomingMessage.Contains(r.TriggerKeyword));
        }

        public async Task<bool> LinkFlowToRuleAsync(Guid businessId, string keyword, Guid flowId, string? flowName)
        {
            var rule = await _dbContext.AutoReplyRules
                .FirstOrDefaultAsync(r => r.BusinessId == businessId && r.TriggerKeyword.ToLower() == keyword.ToLower());

            if (rule == null) return false;

            rule.FlowId = flowId;
            rule.FlowName = flowName ?? "";
            rule.UpdatedAt = DateTime.UtcNow;

            await _dbContext.SaveChangesAsync();
            return true;
        }
        public async Task<AutoReplyRule> UpsertRuleLinkedToFlowAsync(Guid businessId, string keyword, Guid flowId, string? flowName)
        {
            // Ensure keyword is normalized
            var normalizedKeyword = keyword.ToLower().Trim();

            var rule = await _dbContext.AutoReplyRules
                .FirstOrDefaultAsync(r => r.BusinessId == businessId && r.TriggerKeyword.ToLower() == normalizedKeyword);

            if (rule != null)
            {
                // Update existing rule
                rule.FlowId = flowId;
                rule.FlowName = flowName ?? "";
                rule.UpdatedAt = DateTime.UtcNow;
            }
            else
            {
                // Create new rule
                rule = new AutoReplyRule
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    TriggerKeyword = normalizedKeyword,
                    FlowId = flowId,
                    FlowName = flowName ?? "",
                    CreatedAt = DateTime.UtcNow,
                    IsActive = true,
                    Priority = 1,
                    ReplyMessage = "" // Fallback (optional)
                };

                _dbContext.AutoReplyRules.Add(rule);
            }

            await _dbContext.SaveChangesAsync();
            return rule;
        }

    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/FlowRepository.cs  (sha256:215b4fc5005e126adf33375390d0ac254a146dbdae11aa8c98eb52aa9054551b)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public class FlowRepository
    {
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/IAutoReplyFlowRepository.cs  (sha256:f78ae431c2892c49cc0844c2f19e5df301598c964326722b3ca52aec7e9ba61d)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;
using xbytechat.api.Features.AutoReplyBuilder.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories
{
    public interface IAutoReplyFlowRepository
    {
        Task<AutoReplyFlow> SaveAsync(AutoReplyFlow flow);
        Task<AutoReplyFlow?> GetByIdAsync(Guid flowId, Guid businessId);
        Task<List<AutoReplyFlow>> GetAllByBusinessIdAsync(Guid businessId);
        Task<int> GetFlowCountAsync(Guid businessId);
        Task<bool> RenameFlowAsync(Guid id, string newName);
        Task<bool> DeleteFlowAsync(Guid id, Guid businessId);
        Task SaveNodesAndEdgesAsync(IEnumerable<AutoReplyFlowNode> nodes, IEnumerable<AutoReplyFlowEdge> edges);
        Task<List<AutoReplyFlowNode>> GetNodesByFlowIdAsync(Guid flowId);
        Task<List<AutoReplyFlowEdge>> GetEdgesByFlowIdAsync(Guid flowId);
        Task<AutoReplyFlow?> FindFlowByKeywordAsync(Guid businessId, string keyword);
        Task<List<AutoReplyFlowNode>> GetStructuredNodesAsync(Guid flowId);
        Task<List<AutoReplyFlowEdge>> GetStructuredEdgesAsync(Guid flowId);

    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/IAutoReplyLogRepository.cs  (sha256:49f1ecf8c4ab7bb6a0122d7d98e22eb4cb6e2b4b522c99c3963ca64d57889264)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;

namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public interface IAutoReplyLogRepository
    {
        Task SaveAsync(AutoReplyLogDto logDto);
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/IAutoReplyRepository.cs  (sha256:136fdda2ad552eadc942d50774dc0ba7cf0796c507e703b6aa20f4fd64fd40d5)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public interface IAutoReplyRepository
    {
        Task<AutoReplyRule> AddAsync(AutoReplyRule rule);
        Task<IEnumerable<AutoReplyRule>> GetAllByBusinessIdAsync(Guid businessId);
        Task<AutoReplyRule?> GetByIdAsync(Guid ruleId, Guid businessId);
        Task<bool> UpdateAsync(AutoReplyRule rule);
        Task<bool> DeleteAsync(Guid ruleId, Guid businessId);

        // Runtime keyword match logic
        Task<AutoReplyRule?> MatchByKeywordAsync(Guid businessId, string incomingMessage);
        Task<bool> LinkFlowToRuleAsync(Guid businessId, string keyword, Guid flowId, string? flowName);
        Task<AutoReplyRule> UpsertRuleLinkedToFlowAsync(Guid businessId, string keyword, Guid flowId, string? flowName);

    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Repositories/IFlowRepository.cs  (sha256:dc4b9a1195add53536172098cfd18c52a19a3a5c767ba81f25e2bceb2a483e14)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Repositories
{
    public class IFlowRepository
    {
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/AutoReplyFlowService.cs  (sha256:60a2f344bc7993fa13dd56c9514c142e4a3bb6100c4e6f48056178d09d8d71b4)
`$lang
using Microsoft.Extensions.Logging;
using Newtonsoft.Json;
using System.Numerics;
using System.Text.Json;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Models;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;
using xbytechat.api.Features.AutoReplyBuilder.Models;
using xbytechat.api.Features.AutoReplyBuilder.Repositories;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Services
{
    public class AutoReplyFlowService : IAutoReplyFlowService
    {
        private readonly IAutoReplyFlowRepository _flowRepository;
        private readonly ILogger<AutoReplyFlowService> _logger;
        private readonly IMessageEngineService _messageService;
        private readonly ITagService _tagService;
        private readonly IAutoReplyRepository _autoReplyRepository;
        public AutoReplyFlowService(IAutoReplyFlowRepository flowrepository, ILogger<AutoReplyFlowService> logger,
            IMessageEngineService messageService, ITagService tagService, IAutoReplyRepository autoReplyRepository)
        {
            _flowRepository = flowrepository;
            _logger = logger;
            _messageService = messageService;
            _tagService = tagService;
            _autoReplyRepository = autoReplyRepository;
        }

        //public async Task<Guid> SaveFlowAsync(SaveFlowDto dto)
        //{
        //    _logger.LogInformation("🔄 Starting flow save for business {BusinessId} with keyword '{Keyword}'", dto.BusinessId, dto.TriggerKeyword);

        //    var flow = new AutoReplyFlow
        //    {
        //        Id = Guid.NewGuid(),
        //        BusinessId = dto.BusinessId,
        //        Name = dto.Name,
        //        NodesJson = JsonConvert.SerializeObject(dto.Nodes),
        //        EdgesJson = JsonConvert.SerializeObject(dto.Edges),
        //        TriggerKeyword = dto.TriggerKeyword?.Trim().ToLower(),
        //        IsActive = true,
        //        CreatedAt = DateTime.UtcNow
        //    };

        //    var saved = await _flowRepository.SaveAsync(flow);
        //    _logger.LogInformation("✅ Flow saved: {FlowId}", saved.Id);

        //    // ✅ Save parsed nodes
        //    var parsedNodes = new List<AutoReplyFlowNode>();
        //    var nodes = dto.Nodes as List<Dictionary<string, object>>;

        //    if (nodes != null)
        //    {
        //        foreach (var nodeDict in nodes)
        //        {
        //            if (!nodeDict.ContainsKey("type") || !nodeDict.ContainsKey("data") || !nodeDict.ContainsKey("position"))
        //            {
        //                _logger.LogWarning("⚠️ Skipped malformed node during flow save: {Node}", JsonConvert.SerializeObject(nodeDict));
        //                continue;
        //            }

        //            var data = nodeDict["data"] as Dictionary<string, object>;
        //            var positionDict = nodeDict["position"] as Dictionary<string, object>;

        //            var position = new Position
        //            {
        //                X = Convert.ToDouble(positionDict?["x"] ?? 0),
        //                Y = Convert.ToDouble(positionDict?["y"] ?? 0)
        //            };

        //            parsedNodes.Add(new AutoReplyFlowNode
        //            {
        //                Id = Guid.NewGuid(),
        //                FlowId = saved.Id,
        //                NodeType = nodeDict["type"]?.ToString() ?? "",
        //                Label = data?["label"]?.ToString() ?? "",
        //                ConfigJson = JsonConvert.SerializeObject(data?["config"] ?? new { }),
        //                Position = position // ✅ strongly typed
        //            });
        //        }
        //    }

        //    _logger.LogInformation("🧩 Parsed {NodeCount} nodes", parsedNodes.Count);

        //    // ✅ Save parsed edges
        //    var parsedEdges = new List<AutoReplyFlowEdge>();
        //    var edges = dto.Edges as List<Dictionary<string, object>>;

        //    if (edges != null)
        //    {
        //        foreach (var edgeDict in edges)
        //        {
        //            if (!edgeDict.ContainsKey("source") || !edgeDict.ContainsKey("target"))
        //            {
        //                _logger.LogWarning("⚠️ Skipped malformed edge during flow save: {Edge}", JsonConvert.SerializeObject(edgeDict));
        //                continue;
        //            }

        //            parsedEdges.Add(new AutoReplyFlowEdge
        //            {
        //                Id = Guid.NewGuid(),
        //                FlowId = saved.Id,
        //                SourceNodeId = edgeDict["source"]?.ToString() ?? "",
        //                TargetNodeId = edgeDict["target"]?.ToString() ?? "",
        //                CreatedAt = DateTime.UtcNow
        //            });
        //        }
        //    }

        //    _logger.LogInformation("🔗 Parsed {EdgeCount} edges", parsedEdges.Count);

        //    await _flowRepository.SaveNodesAndEdgesAsync(parsedNodes, parsedEdges);

        //    _logger.LogInformation("✅ Node + edge persistence complete for flow {FlowId}", saved.Id);

        //    return saved.Id;
        //}

        //public async Task<Guid> SaveFlowAsync(SaveFlowDto dto)
        //{
        //    _logger.LogInformation("🔄 Starting flow save for business {BusinessId} with keyword '{Keyword}'", dto.BusinessId, dto.TriggerKeyword);

        //    // ✅ Step 1: Save main flow
        //    var flow = new AutoReplyFlow
        //    {
        //        Id = Guid.NewGuid(),
        //        BusinessId = dto.BusinessId,
        //        Name = dto.Name?.Trim() ?? "",
        //        NodesJson = JsonConvert.SerializeObject(dto.Nodes),
        //        EdgesJson = JsonConvert.SerializeObject(dto.Edges),
        //        TriggerKeyword = dto.TriggerKeyword?.Trim().ToLower(),
        //        IsActive = true,
        //        CreatedAt = DateTime.UtcNow
        //    };

        //    var saved = await _flowRepository.SaveAsync(flow);
        //    _logger.LogInformation("✅ Flow saved: {FlowId}", saved.Id);

        //    // ✅ Step 2: Build ID map and parse nodes
        //    var nodeIdMap = new Dictionary<string, Guid>();
        //    var parsedNodes = new List<AutoReplyFlowNode>();

        //    foreach (var n in dto.Nodes)
        //    {
        //        if (string.IsNullOrWhiteSpace(n.Id))
        //        {
        //            _logger.LogWarning("⚠️ Skipped node with missing Id");
        //            continue;
        //        }

        //        var internalNodeId = Guid.NewGuid();
        //        nodeIdMap[n.Id] = internalNodeId;

        //        parsedNodes.Add(new AutoReplyFlowNode
        //        {
        //            Id = internalNodeId,
        //            FlowId = saved.Id,
        //            NodeType = n.Type,
        //            Label = n.Data?.Label ?? "",
        //            ConfigJson = JsonConvert.SerializeObject(n.Data?.Config ?? new { }),
        //            Position = new Position
        //            {
        //                X = n.Position?.X ?? 0,
        //                Y = n.Position?.Y ?? 0
        //            },
        //            CreatedAt = DateTime.UtcNow
        //        });
        //    }

        //    _logger.LogInformation("🧩 Parsed {NodeCount} nodes", parsedNodes.Count);

        //    // ✅ Step 3: Map Source/TargetNodeId from external → internal GUIDs
        //    var parsedEdges = new List<AutoReplyFlowEdge>();

        //    foreach (var e in dto.Edges)
        //    {
        //        if (!nodeIdMap.TryGetValue(e.SourceNodeId ?? "", out var sourceId))
        //        {
        //            _logger.LogWarning("⚠️ Edge skipped: SourceNodeId '{Source}' not found", e.SourceNodeId);
        //            continue;
        //        }

        //        if (!nodeIdMap.TryGetValue(e.TargetNodeId ?? "", out var targetId))
        //        {
        //            _logger.LogWarning("⚠️ Edge skipped: TargetNodeId '{Target}' not found", e.TargetNodeId);
        //            continue;
        //        }

        //        parsedEdges.Add(new AutoReplyFlowEdge
        //        {
        //            Id = Guid.NewGuid(),
        //            FlowId = saved.Id,
        //            SourceNodeId = sourceId.ToString(),
        //            TargetNodeId = targetId.ToString(),
        //            CreatedAt = DateTime.UtcNow
        //        });
        //    }

        //    _logger.LogInformation("🔗 Parsed {EdgeCount} edges", parsedEdges.Count);

        //    // ✅ Final Save
        //    await _flowRepository.SaveNodesAndEdgesAsync(parsedNodes, parsedEdges);
        //    _logger.LogInformation("✅ Node + edge persistence complete for flow {FlowId}", saved.Id);

        //    return saved.Id;
        //}
        //public async Task<Guid> SaveFlowAsync(SaveFlowDto dto)
        //{
        //    _logger.LogInformation("🔄 Starting flow save for business {BusinessId} with keyword '{Keyword}'", dto?.BusinessId, dto?.TriggerKeyword);

        //    if (dto == null) throw new ArgumentNullException(nameof(dto));
        //    if (dto.BusinessId == Guid.Empty) throw new ArgumentException("BusinessId is required.");
        //    if (string.IsNullOrWhiteSpace(dto.TriggerKeyword)) throw new ArgumentException("TriggerKeyword is required.");
        //    if (dto.Nodes == null || !dto.Nodes.Any()) throw new ArgumentException("At least one node is required.");

        //    dto.Edges ??= new List<EdgeDto>();

        //    // ✅ Step 1: Save Flow
        //    var flow = new AutoReplyFlow
        //    {
        //        Id = Guid.NewGuid(),
        //        BusinessId = dto.BusinessId,
        //        Name = dto.Name?.Trim() ?? "",
        //        NodesJson = JsonConvert.SerializeObject(dto.Nodes),
        //        EdgesJson = JsonConvert.SerializeObject(dto.Edges),
        //        TriggerKeyword = dto.TriggerKeyword?.Trim().ToLower(),
        //        IsActive = true,
        //        CreatedAt = DateTime.UtcNow
        //    };

        //    var savedFlow = await _flowRepository.SaveAsync(flow);
        //    _logger.LogInformation("✅ Flow saved: {FlowId}", savedFlow.Id);

        //    // ✅ Step 2: Parse Nodes
        //    var nodeIdMap = new Dictionary<string, Guid>();
        //    var parsedNodes = new List<AutoReplyFlowNode>();

        //    foreach (var n in dto.Nodes)
        //    {
        //        if (string.IsNullOrWhiteSpace(n.Id)) continue;

        //        var internalNodeId = Guid.NewGuid();
        //        nodeIdMap[n.Id] = internalNodeId;

        //        string configJson = n.Data?.Config is JsonElement elem
        //            ? elem.GetRawText()
        //            : JsonConvert.SerializeObject(n.Data?.Config ?? new { });

        //        parsedNodes.Add(new AutoReplyFlowNode
        //        {
        //            Id = internalNodeId,
        //            FlowId = savedFlow.Id,
        //            NodeType = n.Type,
        //            Label = n.Data?.Label ?? "",
        //            ConfigJson = configJson,
        //            Position = new Position
        //            {
        //                X = n.Position?.X ?? 0,
        //                Y = n.Position?.Y ?? 0
        //            },
        //            CreatedAt = DateTime.UtcNow
        //        });
        //    }

        //    _logger.LogInformation("🧩 Parsed {NodeCount} nodes", parsedNodes.Count);

        //    // ✅ Step 3: Parse Edges
        //    var parsedEdges = new List<AutoReplyFlowEdge>();

        //    foreach (var e in dto.Edges)
        //    {
        //        if (!nodeIdMap.TryGetValue(e.SourceNodeId ?? "", out var sourceId)) continue;
        //        if (!nodeIdMap.TryGetValue(e.TargetNodeId ?? "", out var targetId)) continue;

        //        parsedEdges.Add(new AutoReplyFlowEdge
        //        {
        //            Id = Guid.NewGuid(),
        //            FlowId = savedFlow.Id,
        //            SourceNodeId = sourceId.ToString(),
        //            TargetNodeId = targetId.ToString(),
        //            SourceHandle = e.SourceHandle, 
        //            TargetHandle = e.TargetHandle, 
        //            CreatedAt = DateTime.UtcNow
        //        });
        //    }

        //    _logger.LogInformation("🔗 Parsed {EdgeCount} edges", parsedEdges.Count);

        //    // ✅ Step 4: Save Nodes + Edges
        //    await _flowRepository.SaveNodesAndEdgesAsync(parsedNodes, parsedEdges);
        //    _logger.LogInformation("✅ Node + edge persistence complete for flow {FlowId}", savedFlow.Id);

        //    // ✅ Step 5: Link to Rule via Repository
        //    var keyword = dto.TriggerKeyword.Trim().ToLower();
        //    var rule = await _autoReplyRepository.UpsertRuleLinkedToFlowAsync(dto.BusinessId, keyword, savedFlow.Id, dto.Name);

        //    _logger.LogInformation("🔁 Linked flow to auto-reply rule: {RuleId}", rule.Id);

        //    return savedFlow.Id;
        //}
        public async Task<Guid> SaveFlowAsync(SaveFlowDto dto, Guid businessId)
        {
            _logger.LogInformation("🔄 Starting flow save for business {BusinessId} with keyword '{Keyword}'", businessId, dto?.TriggerKeyword);

            if (dto == null) throw new ArgumentNullException(nameof(dto));
            if (string.IsNullOrWhiteSpace(dto.TriggerKeyword)) throw new ArgumentException("TriggerKeyword is required.");
            if (dto.Nodes == null || !dto.Nodes.Any()) throw new ArgumentException("At least one node is required.");

            dto.Edges ??= new List<EdgeDto>();

            // ✅ Step 1: Save Flow
            var flow = new AutoReplyFlow
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId, // << Use parameter, not from dto!
                Name = dto.Name?.Trim() ?? "",
                NodesJson = JsonConvert.SerializeObject(dto.Nodes),
                EdgesJson = JsonConvert.SerializeObject(dto.Edges),
                TriggerKeyword = dto.TriggerKeyword?.Trim().ToLower(),
                IsActive = true,
                CreatedAt = DateTime.UtcNow
            };

            var savedFlow = await _flowRepository.SaveAsync(flow);
            _logger.LogInformation("✅ Flow saved: {FlowId}", savedFlow.Id);

            // ... rest of code unchanged ...

            // ✅ Step 5: Link to Rule via Repository
            var keyword = dto.TriggerKeyword.Trim().ToLower();
            var rule = await _autoReplyRepository.UpsertRuleLinkedToFlowAsync(
                businessId, // << Use parameter, not from dto!
                keyword, savedFlow.Id, dto.Name);

            _logger.LogInformation("🔁 Linked flow to auto-reply rule: {RuleId}", rule.Id);

            return savedFlow.Id;
        }

        public async Task<List<SaveFlowDto>> GetFlowsByBusinessIdAsync(Guid businessId)
        {
            _logger.LogInformation("📥 Fetching auto-reply flows for business {BusinessId}", businessId);

            var flows = await _flowRepository.GetAllByBusinessIdAsync(businessId);

            var results = flows.Select(f => new SaveFlowDto
            {
                Id = f.Id,
                BusinessId = f.BusinessId,
                Name = f.Name,
                Nodes = string.IsNullOrEmpty(f.NodesJson)
                    ? new()
                    : JsonConvert.DeserializeObject<List<NodeDto>>(f.NodesJson),

                Edges = string.IsNullOrEmpty(f.EdgesJson)
                    ? new()
                    : JsonConvert.DeserializeObject<List<EdgeDto>>(f.EdgesJson),


                CreatedAt = f.CreatedAt
            }).ToList();

            _logger.LogInformation("📤 Returned {Count} auto-reply flows for business {BusinessId}", results.Count, businessId);

            return results;
        }

        public async Task<SaveFlowDto?> GetFlowByIdAsync(Guid flowId, Guid businessId)
        {
            var flow = await _flowRepository.GetByIdAsync(flowId, businessId);
            if (flow == null)
            {
                _logger.LogWarning("❌ No flow found for FlowId {FlowId} and BusinessId {BusinessId}", flowId, businessId);
                return null;
            }

            var nodes = await _flowRepository.GetNodesByFlowIdAsync(flowId);
            var edges = await _flowRepository.GetEdgesByFlowIdAsync(flowId);

            var mappedNodes = nodes.Select(n => new Dictionary<string, object>
            {
                ["id"] = n.Id,
                ["type"] = n.NodeType,
                ["position"] = new Dictionary<string, object>
                {
                    ["x"] = n.Position?.X ?? 0,
                    ["y"] = n.Position?.Y ?? 0
                },
                ["data"] = new Dictionary<string, object>
                {
                    ["label"] = n.Label,
                    ["config"] = string.IsNullOrEmpty(n.ConfigJson)
                        ? null
                        : JsonConvert.DeserializeObject<object>(n.ConfigJson)
                }
            }).ToList();

            var mappedEdges = edges.Select(e => new Dictionary<string, object>
            {
                ["id"] = e.Id,
                ["source"] = e.SourceNodeId,
                ["target"] = e.TargetNodeId
            }).ToList();

            _logger.LogInformation("📤 Returning flow {FlowId} with {NodeCount} nodes and {EdgeCount} edges", flow.Id, mappedNodes.Count, mappedEdges.Count);

            return new SaveFlowDto
            {
                Id = flow.Id,
                BusinessId = flow.BusinessId,
                Name = flow.Name,
                Nodes = JsonConvert.DeserializeObject<List<NodeDto>>(JsonConvert.SerializeObject(mappedNodes)),
                Edges = JsonConvert.DeserializeObject<List<EdgeDto>>(JsonConvert.SerializeObject(mappedEdges)),
                CreatedAt = flow.CreatedAt
            };

        }

        public async Task<int> GetFlowCountForBusinessAsync(Guid businessId)
        {
            return await _flowRepository.GetFlowCountAsync(businessId);
        }

        public async Task<bool> RenameFlowAsync(Guid id, string newName)
        {
            return await _flowRepository.RenameFlowAsync(id, newName);
        }
        public async Task<bool> DeleteFlowAsync(Guid id, Guid businessId)
        {
            return await _flowRepository.DeleteFlowAsync(id, businessId);
        }
        public async Task ExecuteFlowAsync(Guid businessId, string triggerKeyword, string customerPhone)
        {
            var flow = await _flowRepository.FindFlowByKeywordAsync(businessId, triggerKeyword);
            if (flow == null) return;

            var nodes = await _flowRepository.GetNodesByFlowIdAsync(flow.Id);
            var edges = await _flowRepository.GetEdgesByFlowIdAsync(flow.Id);

            var nodeMap = nodes.ToDictionary(n => n.Id, n => n);
            var edgeMap = edges.GroupBy(e => e.SourceNodeId)
                               .ToDictionary(g => g.Key, g => g.ToList());

            var current = nodes.FirstOrDefault(n => n.NodeType == "start");
            while (current != null)
            {
                switch (current.NodeType)
                {
                    case "message":
                        var msgCfg = JsonConvert.DeserializeObject<MessageConfig>(current.ConfigJson);
                        await _messageService.SendTextDirectAsync(new TextMessageSendDto
                        {
                            BusinessId = businessId,
                            RecipientNumber = customerPhone,
                            TextContent = msgCfg.Text
                        });

                        break;
                    case "template":
                        var tempCfg = JsonConvert.DeserializeObject<TemplateConfig>(current.ConfigJson);

                        var dto = new SimpleTemplateMessageDto
                        {
                            RecipientNumber = customerPhone,
                            TemplateName = tempCfg.TemplateName,
                            TemplateParameters = tempCfg.Placeholders ?? new List<string>()
                        };

                        await _messageService.SendTemplateMessageSimpleAsync(businessId, dto);
                        break;


                    case "wait":
                        var waitCfg = JsonConvert.DeserializeObject<WaitConfig>(current.ConfigJson);
                        await Task.Delay(TimeSpan.FromSeconds(waitCfg.Seconds));
                        break;

                    case "tag":
                        var tagCfg = JsonConvert.DeserializeObject<TagNodeConfig>(current.ConfigJson);
                        await _tagService.AssignTagsAsync(businessId, customerPhone, tagCfg.Tags);
                        break;
                }

                var nextEdge = edgeMap.ContainsKey(current.Id.ToString())
                     ? edgeMap[current.Id.ToString()].FirstOrDefault()
                        : null;

                if (nextEdge == null) break;

                current = nodeMap.ContainsKey(Guid.Parse(nextEdge.TargetNodeId))
                    ? nodeMap[Guid.Parse(nextEdge.TargetNodeId)]
                    : null;

            }
        }
        public async Task TriggerAutoReplyAsync(Guid businessId, string incomingText, string phone)
        {
            // Step 1: Find flow matching keyword
            var flow = await _flowRepository.FindFlowByKeywordAsync(businessId, incomingText.ToLower());
            if (flow == null) return;

            // Step 2: Load flow nodes + edges
            var nodes = await _flowRepository.GetStructuredNodesAsync(flow.Id);
            var edges = await _flowRepository.GetStructuredEdgesAsync(flow.Id);

            // Step 3: Find start node
            var startNode = nodes.FirstOrDefault(n => n.NodeType == "start");
            if (startNode == null) return;

            var visited = new HashSet<string>();
            var currentNodeId = startNode.Id.ToString();

            while (!string.IsNullOrEmpty(currentNodeId) && !visited.Contains(currentNodeId))
            {
                visited.Add(currentNodeId);

                var currentNode = nodes.FirstOrDefault(n => n.Id.ToString() == currentNodeId);
                if (currentNode == null) break;

                // Step 4: Handle current node
                switch (currentNode.NodeType)
                {
                    case "message":
                        var config = JsonConvert.DeserializeObject<MessageConfig>(currentNode.ConfigJson);
                        await _messageService.SendTextDirectAsync(new TextMessageSendDto
                        {
                            BusinessId = businessId,
                            RecipientNumber = phone,
                            TextContent = config.Text
                        });
                        break;

                    case "template":
                        var tpl = JsonConvert.DeserializeObject<TemplateConfig>(currentNode.ConfigJson);

                        var dto = new SimpleTemplateMessageDto
                        {
                            RecipientNumber = phone,
                            TemplateName = tpl.TemplateName,
                            TemplateParameters = tpl.Placeholders ?? new List<string>()
                        };

                        await _messageService.SendTemplateMessageSimpleAsync(businessId, dto);
                        break;


                    case "wait":
                        var waitConfig = JsonConvert.DeserializeObject<WaitConfig>(currentNode.ConfigJson);
                        await Task.Delay(waitConfig.Seconds * 1000); // Can replace with async scheduling later
                        break;

                    case "tag":
                        var tagConfig = JsonConvert.DeserializeObject<TagNodeConfig>(currentNode.ConfigJson);
                        await _tagService.AssignTagsAsync(businessId,phone, tagConfig.Tags);
                        break;

                }

                // Step 5: Find next node
                var nextEdge = edges.FirstOrDefault(e => e.SourceNodeId == currentNodeId);
                currentNodeId = nextEdge?.TargetNodeId;
            }
        }


    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/AutoReplyRuntimeService.cs  (sha256:f9e35069e50bbf3a57f0c5134ae99c32f604d94885000c29aacb8ddab0d00d94)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using Newtonsoft.Json;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.FlowNodeConfigs;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;
using xbytechat.api.Features.AutoReplyBuilder.Models;
using xbytechat.api.Features.AutoReplyBuilder.Repositories;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Services;
using xbytechat.api;
using xbytechat.api.CRM.Models;
using xbytechat.api.CRM.Interfaces;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.CampaignModule.Models;

namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public class AutoReplyRuntimeService : IAutoReplyRuntimeService
    {
        private readonly IAutoReplyRepository _autoReplyRepo;
        private readonly IAutoReplyFlowRepository _flowRepo;
        private readonly IMessageEngineService _messageEngine;
        private readonly AppDbContext _context;
        private readonly ILogger<AutoReplyRuntimeService> _logger;
        private readonly IContactService _contactService;
        private readonly ITagService _tagService;
        private readonly ITemplateMessageSender _templateSender;
        public AutoReplyRuntimeService(
            IAutoReplyRepository autoReplyRepo,
            IAutoReplyFlowRepository flowRepo,
            IMessageEngineService messageEngine,
            AppDbContext context,
            ILogger<AutoReplyRuntimeService> logger, IContactService contactService, ITagService tagService, ITemplateMessageSender templateSender)
        {
            _autoReplyRepo = autoReplyRepo;
            _flowRepo = flowRepo;
            _messageEngine = messageEngine;
            _context = context;
            _logger = logger;
            _contactService = contactService;
            _tagService = tagService;
            _templateSender = templateSender;
        }

        public async Task<bool> TryRunAutoReplyFlowAsync(Guid businessId, string keyword, Guid contactId, string phone)
        {
            _logger.LogInformation("🔍 Auto-reply trigger: '{Keyword}' from {Phone}", keyword, phone);

            try
            {
                // 1️⃣ Try matching a flow by keyword
                var flow = await _flowRepo.FindFlowByKeywordAsync(businessId, keyword);
                if (flow != null)
                {
                    _logger.LogInformation("✅ Flow matched: {FlowName}", flow.Name);
                    await RunFlowAsync(flow.Id, businessId, contactId, phone, keyword, flow.Name);
                    return true;
                }

                // 2️⃣ Fallback: Try matching auto-reply rule
                var rule = await _autoReplyRepo.MatchByKeywordAsync(businessId, keyword);
                if (rule != null)
                {
                    _logger.LogInformation("🔁 Fallback auto-reply triggered: {Rule}", rule.TriggerKeyword);

                    var messageDto = new TextMessageSendDto
                    {
                        BusinessId = businessId,
                        RecipientNumber = phone,
                        TextContent = rule.ReplyMessage
                    };

                    var result = await _messageEngine.SendTextDirectAsync(messageDto);

                    await LogAutoReplyAsync(
                        businessId,
                        contactId,
                        keyword,
                        "fallback",
                        rule.ReplyMessage,
                        null,
                        result?.LogId
                    );

                    return true;
                }

                _logger.LogWarning("❌ No flow or fallback rule matched for: {Keyword}", keyword);
                return false;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Error in TryRunAutoReplyFlowAsync");
                return false;
            }
        }

        public async Task RunFlowAsync(Guid flowId, Guid businessId, Guid contactId, string phone, string keyword, string flowName)
        {
            var nodes = await _flowRepo.GetNodesByFlowIdAsync(flowId);
            var edges = await _flowRepo.GetEdgesByFlowIdAsync(flowId);

            var nodeDict = nodes.ToDictionary(n => n.Id.ToString(), n => n);
            var edgeLookup = edges.GroupBy(e => e.SourceNodeId)
                                  .ToDictionary(g => g.Key, g => g.ToList());

            var currentNodeId = nodes.FirstOrDefault(n => n.NodeType == "start")?.Id.ToString();
            if (string.IsNullOrEmpty(currentNodeId)) return;

            // ✅ Ensure contact exists
            var contact = await _contactService.FindOrCreateAsync(businessId, phone);

            while (!string.IsNullOrEmpty(currentNodeId))
            {
                if (!nodeDict.TryGetValue(currentNodeId, out var node)) break;

                _logger.LogInformation("⚙️ Executing node {NodeId} [{NodeType}]", node.Id, node.NodeType);

                try
                {
                    switch (node.NodeType)
                    {
                        case "start":
                            _logger.LogInformation("🚦 Start node reached: {NodeId}", node.Id);

                            // 🛑 If Start node contains buttons, STOP and wait for user interaction
                            try
                            {
                                var config = JsonConvert.DeserializeObject<Dictionary<string, object>>(node.ConfigJson ?? "{}");
                                if (config != null && config.TryGetValue("multiButtons", out var rawButtons))
                                {
                                    var buttons = JsonConvert.DeserializeObject<List<object>>(rawButtons.ToString() ?? "[]");
                                    if (buttons.Count > 0)
                                    {
                                        _logger.LogInformation("🛑 Start node has buttons – waiting for user interaction. Halting flow.");
                                        return;
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                _logger.LogError(ex, "❌ Failed to parse start node config for button detection.");
                            }
                            break;

                        case "message":
                            await ExecuteMessageNodeAsync(node, businessId, contactId, phone, keyword, flowName);
                            break;

                        case "template":
                            await ExecuteTemplateNodeAsync(node, businessId, contactId, phone, keyword, flowName);

                          
                                try
                                {
                                    var cfg = JsonConvert.DeserializeObject<TemplateConfig>(node.ConfigJson ?? "{}");
                                    if (cfg?.MultiButtons?.Any(b => !string.IsNullOrWhiteSpace(b.ButtonText)) == true)
                                    {
                                        _logger.LogInformation("🛑 Template node has buttons – halting flow for user click.");
                                        return;
                                    }
                                }

                            
                            catch (Exception ex)
                            {
                                _logger.LogError(ex, "❌ Failed to parse template config for button detection.");
                            }
                            break;

                        case "tag":
                            await ExecuteTagNodeAsync(businessId, contactId, node);
                            break;

                        case "wait":
                            try
                            {
                                var waitCfg = JsonConvert.DeserializeObject<WaitConfig>(node.ConfigJson ?? "{}");
                                var delayMs = (waitCfg?.Seconds ?? 1) * 1000;
                                _logger.LogInformation("⏳ Wait node delay: {Seconds}s", waitCfg?.Seconds ?? 1);
                                await Task.Delay(delayMs);
                            }
                            catch (Exception ex)
                            {
                                _logger.LogError(ex, "❌ Failed to parse wait config for node {NodeId}", node.Id);
                            }
                            break;
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogError(ex, "❌ Error while executing node {NodeId} of type {NodeType}", node.Id, node.NodeType);
                }

                currentNodeId = edgeLookup.TryGetValue(currentNodeId, out var next)
                    ? next.FirstOrDefault()?.TargetNodeId
                    : null;
            }
        }

        private bool TryNodeHasButtons(string? configJson)
        {
            if (string.IsNullOrWhiteSpace(configJson)) return false;

            try
            {
                var config = JsonConvert.DeserializeObject<Dictionary<string, object>>(configJson);
                if (config != null && config.TryGetValue("multiButtons", out var rawButtons))
                {
                    var buttons = JsonConvert.DeserializeObject<List<object>>(rawButtons.ToString() ?? "[]");
                    return buttons.Count > 0;
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "⚠️ Failed to parse buttons from template config");
            }

            return false;
        }

        private async Task LogAutoReplyAsync(Guid businessId, Guid contactId, string keyword, string type, string replyText, string? flowName, Guid? messageLogId)
        {
            var log = new AutoReplyLog
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                ContactId = contactId,
                TriggerKeyword = keyword,
                TriggerType = type,
                ReplyContent = replyText,
                FlowName = flowName,
                MessageLogId = messageLogId,
                TriggeredAt = DateTime.UtcNow
            };

            _context.AutoReplyLogs.Add(log);
            await _context.SaveChangesAsync();
        }


        //    private async Task ExecuteTemplateNodeAsync(
        //    AutoReplyFlowNode node,
        //    Guid businessId,
        //    Guid contactId,
        //    string phone,
        //    string keyword,
        //    string? flowName)
        //    {
        //        _logger.LogInformation("🧠 Raw config JSON for template node: {Json}", node.ConfigJson);

        //        TemplateConfig? tmpl;
        //        try
        //        {
        //            tmpl = JsonConvert.DeserializeObject<TemplateConfig>(node.ConfigJson ?? "{}");
        //        }
        //        catch (Exception ex)
        //        {
        //            _logger.LogError(ex, "❌ Failed to deserialize TemplateConfig for node {NodeId}", node.Id);
        //            return;
        //        }

        //        if (tmpl == null || string.IsNullOrWhiteSpace(tmpl.TemplateName))
        //        {
        //            _logger.LogWarning("❌ Template node config is missing or invalid.");
        //            return;
        //        }

        //        var contact = await _context.Contacts
        //            .FirstOrDefaultAsync(c => c.Id == contactId && c.BusinessId == businessId);

        //        if (contact == null)
        //        {
        //            _logger.LogWarning("❌ Contact not found for AutoReply.");
        //            return;
        //        }

        //        //var buttons = tmpl.MultiButtons?.Select(b => new CampaignButton
        //        //{
        //        //    Title = b.ButtonText,
        //        //    Type = b.ButtonType,
        //        //    Value = b.TargetUrl
        //        //}).ToList();
        //        var buttons = tmpl.MultiButtons?
        //.Where(b => !string.IsNullOrWhiteSpace(b.ButtonText)) // ✅ Avoid empty
        //.Select((b, idx) => new
        //{
        //    type = "button",
        //    sub_type = b.ButtonType.ToLowerInvariant(), // must be 'quick_reply' or 'url'
        //    index = idx.ToString(),
        //    parameters = new List<object>
        //    {
        //        new {
        //            type = "text",
        //            text = b.ButtonText
        //        }
        //    }
        //}).ToList();

        //        var response = await _templateSender.SendTemplateMessageToContactAsync(
        //            businessId: businessId,
        //            contact: contact,
        //            templateName: tmpl.TemplateName,
        //            templateParams: tmpl.Placeholders ?? new List<string>(),
        //            imageUrl: tmpl.ImageUrl,
        //            buttons: buttons,
        //            source: "auto_reply",
        //            refMessageId: null
        //        );

        //        await LogAutoReplyAsync(
        //            businessId,
        //            contactId,
        //            keyword,
        //            "flow",
        //            $"Template: {tmpl.TemplateName}",
        //            flowName,
        //            response.LogId
        //        );
        //    }


        private async Task ExecuteTemplateNodeAsync(
    AutoReplyFlowNode node,
    Guid businessId,
    Guid contactId,
    string phone,
    string keyword,
    string? flowName)
        {
            _logger.LogInformation("🧠 Raw config JSON for template node: {Json}", node.ConfigJson);

            TemplateConfig? tmpl;
            try
            {
                tmpl = JsonConvert.DeserializeObject<TemplateConfig>(node.ConfigJson ?? "{}");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to deserialize TemplateConfig for node {NodeId}", node.Id);
                return;
            }

            if (tmpl == null || string.IsNullOrWhiteSpace(tmpl.TemplateName))
            {
                _logger.LogWarning("❌ Template node config is missing or invalid.");
                return;
            }

            var contact = await _context.Contacts
                .FirstOrDefaultAsync(c => c.Id == contactId && c.BusinessId == businessId);

            if (contact == null)
            {
                _logger.LogWarning("❌ Contact not found for AutoReply.");
                return;
            }

            var buttons = tmpl.MultiButtons?
                .Where(b => !string.IsNullOrWhiteSpace(b.ButtonText))
                .Select(b => new CampaignButton
                {
                    Title = b.ButtonText,
                    Type = b.ButtonType,
                    Value = b.TargetUrl
                })
                .ToList();

            var response = await _templateSender.SendTemplateMessageToContactAsync(
                businessId: businessId,
                contact: contact,
                templateName: tmpl.TemplateName,
                templateParams: tmpl.Placeholders ?? new List<string>(),
                imageUrl: tmpl.ImageUrl,
                buttons: buttons,
                source: "auto_reply",
                refMessageId: null
            );

            await LogAutoReplyAsync(
                businessId,
                contactId,
                keyword,
                "flow",
                $"Template: {tmpl.TemplateName}",
                flowName,
                response.LogId
            );
        }

        private async Task ExecuteMessageNodeAsync( AutoReplyFlowNode node, Guid businessId, Guid contactId,string phone, string keyword, string? flowName)
        {
            _logger.LogInformation("🧠 Raw config JSON for message node: {Json}", node.ConfigJson);

            MessageConfig? config = null;
            try
            {
                config = JsonConvert.DeserializeObject<MessageConfig>(node.ConfigJson ?? "{}");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to parse config for message node {NodeId}", node.Id);
                return;
            }

            if (config == null || string.IsNullOrWhiteSpace(config.Text))
            {
                _logger.LogWarning("⚠️ Message node config missing or empty.");
                return;
            }

            var result = await _messageEngine.SendTextDirectAsync(new TextMessageSendDto
            {
                BusinessId = businessId,
                RecipientNumber = phone,
                TextContent = config.Text
            });

            await LogAutoReplyAsync(
                businessId,
                contactId,
                keyword,
                "flow",
                config.Text,
                flowName,
                result?.LogId
            );
        }
        private async Task ExecuteTagNodeAsync(Guid businessId, Guid contactId, AutoReplyFlowNode node)
        {
            if (node == null || string.IsNullOrWhiteSpace(node.ConfigJson))
                return;

            try
            {
                var config = System.Text.Json.JsonSerializer.Deserialize<TagNodeConfig>(node.ConfigJson);

                if (config?.Tags != null && config.Tags.Any())
                {
                    // ✅ Load contact from DB
                    var contact = await _context.Contacts.FirstOrDefaultAsync(c => c.Id == contactId && c.BusinessId == businessId);
                    if (contact == null)
                    {
                        _logger.LogWarning("⚠️ TagNode: Contact not found for {ContactId}", contactId);
                        return;
                    }

                    await _tagService.AssignTagsAsync(businessId, contact.PhoneNumber, config.Tags);
                    _logger.LogInformation("✅ TagNode: Tags [{Tags}] assigned to contact {Phone}", string.Join(", ", config.Tags), contact.PhoneNumber);
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ TagNode: Failed to execute for contact {ContactId}", contactId);
            }
        }

        public async Task TryRunAutoReplyFlowByButtonAsync(Guid businessId, string phone, string buttonText, Guid? refMessageId = null)
        {
            var contact = await _contactService.FindOrCreateAsync(businessId, phone);
            if (contact == null)
            {
                _logger.LogWarning("❌ Contact not found or could not be created for phone: {Phone}", phone);
                return;
            }

            _logger.LogInformation("📩 Button clicked: '{ButtonText}' by {Phone}", buttonText, phone);

            var flows = await _flowRepo.GetAllByBusinessIdAsync(businessId);
            if (flows == null || !flows.Any())
            {
                _logger.LogInformation("📭 No flows found for business {BusinessId}", businessId);
                return;
            }

            foreach (var flow in flows)
            {
                var nodes = await _flowRepo.GetNodesByFlowIdAsync(flow.Id);
                var edges = await _flowRepo.GetEdgesByFlowIdAsync(flow.Id);

                var matchedStartNode = nodes
                    .Where(n => n.NodeType == "start")
                    .FirstOrDefault(n =>
                    {
                        try
                        {
                            var config = JsonConvert.DeserializeObject<Dictionary<string, object>>(n.ConfigJson ?? "{}");

                            if (config != null && config.TryGetValue("triggerKeywords", out var raw))
                            {
                                var keywordArray = JsonConvert.DeserializeObject<List<string>>(raw.ToString() ?? "[]");

                                return keywordArray.Any(k =>
                                    string.Equals(k?.Trim(), buttonText.Trim(), StringComparison.OrdinalIgnoreCase));
                            }

                            return false;
                        }
                        catch
                        {
                            return false;
                        }
                    });

                if (matchedStartNode != null)
                {
                    _logger.LogInformation("✅ Matched flow {FlowName} by button '{ButtonText}'", flow.Name, buttonText);
                   // await RunFlowAsync(flow.Id, businessId, contact.Id, phone, buttonText, flow.Name);
                  await RunFlowFromButtonAsync(flow.Id, businessId, contact.Id, phone, buttonText);
                    return;
                }
            }

            _logger.LogInformation("❌ No flow matched for button: {ButtonText}", buttonText);
        }
        public async Task RunFlowFromButtonAsync(Guid flowId, Guid businessId, Guid contactId, string phone, string buttonText)
        {
            var nodes = await _flowRepo.GetNodesByFlowIdAsync(flowId);
            var edges = await _flowRepo.GetEdgesByFlowIdAsync(flowId);

            var nodeMap = nodes.ToDictionary(n => n.Id.ToString(), n => n);
            var edgeMap = edges.GroupBy(e => e.SourceNodeId)
                               .ToDictionary(g => g.Key, g => g.ToList());

            // 🟢 1. Find start node
            var startNode = nodes.FirstOrDefault(n => n.NodeType == "start");
            if (startNode == null)
            {
                _logger.LogWarning("❌ No start node found in flow {FlowId}", flowId);
                return;
            }

            // 🔍 2. Find button index from triggerKeywords
            int matchedIndex = -1;
            try
            {
                var config = JsonConvert.DeserializeObject<Dictionary<string, object>>(startNode.ConfigJson ?? "{}");

                if (config != null && config.TryGetValue("triggerKeywords", out var raw))
                {
                    var keywordList = JsonConvert.DeserializeObject<List<string>>(raw.ToString() ?? "[]");
                    matchedIndex = keywordList.FindIndex(k =>
                        string.Equals(k?.Trim(), buttonText.Trim(), StringComparison.OrdinalIgnoreCase));
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to parse Start node config");
                return;
            }

            if (matchedIndex < 0)
            {
                _logger.LogWarning("❌ No trigger match for buttonText '{Button}'", buttonText);
                return;
            }

            // ✅ 3. Lookup edge from StartNode using SourceHandle = button-{index}
            var nextNodeId = edgeMap.TryGetValue(startNode.Id.ToString(), out var list)
                ? list.FirstOrDefault(e => e.SourceHandle == $"button-{matchedIndex}")?.TargetNodeId
                : null;

            if (string.IsNullOrEmpty(nextNodeId))
            {
                _logger.LogWarning("❌ No outgoing edge found for button index {Index}", matchedIndex);
                return;
            }

            var visited = new HashSet<string>();

            while (!string.IsNullOrEmpty(nextNodeId) && !visited.Contains(nextNodeId))
            {
                visited.Add(nextNodeId);

                if (!nodeMap.TryGetValue(nextNodeId, out var node))
                    break;

                _logger.LogInformation("⚙️ Executing node {NodeId} [{NodeType}]", node.Id, node.NodeType);

                try
                {
                    switch (node.NodeType)
                    {
                        case "message":
                            await ExecuteMessageNodeAsync(node, businessId, contactId, phone, buttonText, null);
                            break;

                        case "template":
                            await ExecuteTemplateNodeAsync(node, businessId, contactId, phone, buttonText, null);

                            // ✅ Check buttons and halt if any button exists
                            try
                            {
                                var cfg = JsonConvert.DeserializeObject<TemplateConfig>(node.ConfigJson ?? "{}");
                                if (cfg?.MultiButtons?.Any(b => !string.IsNullOrWhiteSpace(b.ButtonText)) == true)
                                {
                                    _logger.LogInformation("🛑 Template node has buttons – halting flow for user click.");
                                    return;
                                }
                            }
                            catch (Exception ex)
                            {
                                _logger.LogError(ex, "❌ Failed to parse template config for button detection.");
                            }
                            break;


                        case "tag":
                            await ExecuteTagNodeAsync(businessId, contactId, node);
                            break;

                        case "wait":
                            var waitCfg = JsonConvert.DeserializeObject<WaitConfig>(node.ConfigJson ?? "{}");
                            await Task.Delay((waitCfg?.Seconds ?? 1) * 1000);
                            break;
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogError(ex, "❌ Error executing node {NodeId}", node.Id);
                }

                nextNodeId = edgeMap.TryGetValue(nextNodeId, out var nextList)
                    ? nextList.FirstOrDefault()?.TargetNodeId
                    : null;
            }
        }

    }
}





``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/AutoReplyService.cs  (sha256:df6edf428cebc4dc2d292bef7eb4e47f8cdcbe402b71d79ff9e6ae300502cf70)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;
using xbytechat.api.Features.AutoReplyBuilder.Models;
using xbytechat.api.Features.AutoReplyBuilder.Repositories;

namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public class AutoReplyService : IAutoReplyService
    {
        private readonly IAutoReplyRepository _repository;

        public AutoReplyService(IAutoReplyRepository repository)
        {
            _repository = repository;
        }

        public async Task<AutoReplyRuleDto> CreateRuleAsync(Guid businessId, AutoReplyRuleDto dto)
        {
            var model = new AutoReplyRule
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                TriggerKeyword = dto.TriggerKeyword,
                ReplyMessage = dto.ReplyMessage,
                MediaUrl = dto.MediaUrl,
                Priority = dto.Priority,
                IsActive = dto.IsActive,
                CreatedAt = DateTime.UtcNow
            };

            var saved = await _repository.AddAsync(model);

            return ToDto(saved);
        }

        public async Task<IEnumerable<AutoReplyRuleDto>> GetAllRulesAsync(Guid businessId)
        {
            var rules = await _repository.GetAllByBusinessIdAsync(businessId);
            return rules.Select(ToDto);
        }

        public async Task<AutoReplyRuleDto?> GetRuleByIdAsync(Guid ruleId, Guid businessId)
        {
            var rule = await _repository.GetByIdAsync(ruleId, businessId);
            return rule == null ? null : ToDto(rule);
        }

        public async Task<bool> UpdateRuleAsync(Guid businessId, AutoReplyRuleDto dto)
        {
            var existing = await _repository.GetByIdAsync(dto.Id!.Value, businessId);
            if (existing == null) return false;

            existing.TriggerKeyword = dto.TriggerKeyword;
            existing.ReplyMessage = dto.ReplyMessage;
            existing.MediaUrl = dto.MediaUrl;
            existing.Priority = dto.Priority;
            existing.IsActive = dto.IsActive;
            existing.UpdatedAt = DateTime.UtcNow;

            return await _repository.UpdateAsync(existing);
        }

        public async Task<bool> DeleteRuleAsync(Guid ruleId, Guid businessId)
        {
            return await _repository.DeleteAsync(ruleId, businessId);
        }

        public async Task<AutoReplyRuleDto?> MatchRuleByKeywordAsync(Guid businessId, string incomingMessage)
        {
            var rule = await _repository.MatchByKeywordAsync(businessId, incomingMessage);
            return rule == null ? null : ToDto(rule);
        }

        private AutoReplyRuleDto ToDto(AutoReplyRule rule)
        {
            return new AutoReplyRuleDto
            {
                Id = rule.Id,
                TriggerKeyword = rule.TriggerKeyword,
                ReplyMessage = rule.ReplyMessage,
                MediaUrl = rule.MediaUrl,
                Priority = rule.Priority,
                IsActive = rule.IsActive,
                CreatedAt = rule.CreatedAt,
                UpdatedAt = rule.UpdatedAt
            };
        }
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/FlowRunner.cs  (sha256:d8c0004b19eb4964915bcf51a0ecdadf6dc89cfe50220970befa0fe58a5d4307)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public class FlowRunner
    {
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/IAutoReplyFlowService.cs  (sha256:dfa67a436f77fb405478dfff58668d94aaed35d2e14d087bffd2fa6eb5b0112b)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs;

namespace xbytechat.api.Features.AutoReplyBuilder.Flows.Services
{
    public interface IAutoReplyFlowService
    {
        Task<Guid> SaveFlowAsync(SaveFlowDto dto, Guid businessId);
        Task<List<SaveFlowDto>> GetFlowsByBusinessIdAsync(Guid businessId);
        Task<SaveFlowDto?> GetFlowByIdAsync(Guid flowId, Guid businessId);
        Task<int> GetFlowCountForBusinessAsync(Guid businessId);
        Task<bool> RenameFlowAsync(Guid id, string newName);
        Task<bool> DeleteFlowAsync(Guid id, Guid businessId);
        Task ExecuteFlowAsync(Guid businessId, string triggerKeyword, string customerPhoneNumber);

    }

}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/IAutoReplyRuntimeService.cs  (sha256:444b22549b3c870a3e8cef485bfbf318b5c82a42194255e035be52e27262d4e9)
`$lang
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public interface IAutoReplyRuntimeService
    {
        Task<bool> TryRunAutoReplyFlowAsync(Guid businessId, string messageText, Guid contactId, string phoneNumber);
        Task RunFlowAsync(Guid flowId, Guid businessId, Guid contactId, string phone, string keyword, string flowName);
        Task TryRunAutoReplyFlowByButtonAsync(Guid businessId, string phone, string buttonText, Guid? refMessageId = null);
        Task RunFlowFromButtonAsync(Guid flowId, Guid businessId, Guid contactId, string phone, string buttonText);

    }
}


``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/IAutoReplyService.cs  (sha256:b2816300ae56acd5368c993c2bccc75ff481290ca8379e745ac361e2d27e620f)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.AutoReplyBuilder.DTOs;

namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public interface IAutoReplyService
    {
        Task<AutoReplyRuleDto> CreateRuleAsync(Guid businessId, AutoReplyRuleDto dto);
        Task<IEnumerable<AutoReplyRuleDto>> GetAllRulesAsync(Guid businessId);
        Task<AutoReplyRuleDto?> GetRuleByIdAsync(Guid ruleId, Guid businessId);
        Task<bool> UpdateRuleAsync(Guid businessId, AutoReplyRuleDto dto);
        Task<bool> DeleteRuleAsync(Guid ruleId, Guid businessId);

        // For runtime matching
        Task<AutoReplyRuleDto?> MatchRuleByKeywordAsync(Guid businessId, string incomingMessage);
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyBuilder/Services/IFlowRunner.cs  (sha256:11438f4864857ba65f652f4ed62baf47119c77fcd6933106db70602675dce48b)
`$lang
namespace xbytechat.api.Features.AutoReplyBuilder.Services
{
    public class IFlowRunner
    {
    }
}

``n
--- file: xbytechat-api/Features/AutoReplyTemplates/Restaurant/Configs/MenuNodeConfig.cs  (sha256:f20da12fb12eed3191a2998cb2e7a7dbc65b03bfcb571cf1b6a413f52d78d42a)
`$lang
namespace xbytechat.api.Features.AutoReplyTemplates.Restaurant.Configs
{
    public class MenuNodeConfig
    {
        public string MenuTitle { get; set; } = string.Empty;         // e.g., "Today's Specials"
        public string Description { get; set; } = string.Empty;       // e.g., "Lunch combos starting at ₹199"
        public string MenuImageUrl { get; set; } = string.Empty;      // CDN or public link
        public string MenuDownloadUrl { get; set; } = string.Empty;   // PDF link or product catalog URL
    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/Controllers/BusinessesController.cs  (sha256:c52f56f9044f3f1ebffdd162a172dfba6ba4632df54e60016adab111f526940b)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Helpers;
using Serilog;
using System.Security.Claims;
using xbytechat.api.Features.BusinessModule.DTOs;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.BusinessModule.Services;
using Microsoft.AspNetCore.Authorization;

namespace xbytechat.api.Features.BusinessModule.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class BusinessesController : ControllerBase
    {
        private readonly IBusinessService _businessService;

        public BusinessesController(IBusinessService businessService)
        {
            _businessService = businessService;
        }

 

        [HttpGet("pending")]
        public async Task<IActionResult> GetPendingBusinesses()
        {
            try
            {
                var role = HttpContext.User.Claims
                    .FirstOrDefault(c => c.Type == ClaimTypes.Role)?.Value;
                var userId = HttpContext.User.Claims.FirstOrDefault(c => c.Type == "id")?.Value ?? "";

                if (!new[] { "admin", "superadmin", "partner" }.Contains(role))
                {
                    return StatusCode(403, ResponseResult.ErrorInfo("⛔ Access denied: You are not authorized to view pending businesses."));
                }

                var result = await _businessService.GetPendingBusinessesAsync(role, userId);

                return Ok(ResponseResult.SuccessInfo("✅ Pending businesses fetched successfully.", result));
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("❌ Failed to fetch pending businesses. Please try again later."));
            }
        }


        // ✅ Get business by ID (used for profile completion)

        [HttpGet("{id}")]
        public async Task<IActionResult> GetBusinessById(Guid id)
        {
            try
            {
                var business = await _businessService.GetByIdAsync(id);
                if (business == null)
                    return NotFound(ResponseResult.ErrorInfo("❌ Business not found."));

                return Ok(business);
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("🚨 Failed to fetch business. " + ex.Message));
            }
        }

        [HttpPut("assigned-to/{id}")]
        public async Task<IActionResult> UpdateBusiness(Guid id, [FromBody] Business business)
        {
            if (id != business.Id)
            {
                return BadRequest(new { message = "❌ ID mismatch." });
            }

            var result = await _businessService.UpdateBusinessAsync(business);
            if (!result.Success)
            {
                return BadRequest(result);
            }

            return Ok(result);
        }


        // 🟢 Approve a business
        [HttpPost("approve/{id}")]
        public async Task<IActionResult> Approve(Guid id)
        {
            try
            {
                var result = await _businessService.ApproveBusinessAsync(id);

                if (result.Success)
                {
                    // ✅ Optional Success Logging
                    Log.Information("✅ Business approved successfully. BusinessId: {BusinessId}", id);
                    return Ok(result);
                }
                else
                {
                    // ✅ Optional Warning Logging
                    Log.Warning("⚠️ Business approval failed. BusinessId: {BusinessId} - Message: {Message}", id, result.Message);
                    return BadRequest(result);
                }
            }
            catch (Exception ex)
            {
                // ✅ Proper Error Logging
                Log.Error(ex, "❌ Exception occurred while approving business. BusinessId: {BusinessId}", id);

                return StatusCode(500, ResponseResult.ErrorInfo(
                    "❌ Something went wrong while approving business. Please try again later."
                ));
            }
        }


        // 🔴 Reject a business
        [HttpPost("reject/{id}")]
        public async Task<IActionResult> Reject(Guid id)
        {
            try
            {
                var result = await _businessService.RejectBusinessAsync(id);
                return result.Success ? Ok(result) : NotFound(result);
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("❌ Failed to reject business. " + ex.Message));
            }
        }

        // 🟡 Put a business on hold
        [HttpPost("hold/{id}")]
        public async Task<IActionResult> Hold(Guid id)
        {
            try
            {
                var result = await _businessService.HoldBusinessAsync(id);
                return result.Success ? Ok(result) : NotFound(result);
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("❌ Failed to hold business. " + ex.Message));
            }
        }

        // 🛠 Complete profile after signup
        [HttpPost("profile-completion/{businessId}")]
        public async Task<IActionResult> CompleteProfile(Guid businessId, [FromBody] ProfileCompletionDto dto)
        {
            try
            {
                var result = await _businessService.CompleteProfileAsync(businessId, dto);
                return result.Success ? Ok(result) : BadRequest(result);
            }
            catch (Exception ex)
            {
                return StatusCode(500, ResponseResult.ErrorInfo("❌ Failed to update profile. " + ex.Message));
            }
        }

        [HttpGet("approved")]
        [Authorize(Roles = "SuperAdmin")]
        public async Task<IActionResult> GetApprovedBusinesses()
        {
            var result = await _businessService.GetApprovedBusinessesAsync();
            return Ok(result);
        }

    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/DTOs/PendingBusinessDto.cs  (sha256:262c7390254b692bef62525ec48c34eb502354e446d2e98e77586b32f640f2be)
`$lang
namespace xbytechat.api.Features.BusinessModule.DTOs
{
    public class PendingBusinessDto
    {
        public Guid BusinessId { get; set; }
        public string CompanyName { get; set; }
        public string BusinessEmail { get; set; }
        public string? RepresentativeName { get; set; }
        public string? Phone { get; set; }
        public string Plan { get; set; }
        public DateTime CreatedAt { get; set; }
        public bool? IsApproved { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/DTOs/ProfileCompletionDto.cs  (sha256:cbd238cd045c0ee7bfc5061311058fa84005f29244727a11ef5b7a6eedbcf64f)
`$lang
namespace xbytechat.api.Features.BusinessModule.DTOs
{
    public class ProfileCompletionDto
    {
        public string? BusinessName { get; set; }
        public string? ReperesentativeName { get; set; }
        public string? CompanyPhone { get; set; }
        public string? Phone { get; set; }
        public string? Website { get; set; }
        public string? Address { get; set; }
        public string? Industry { get; set; }
        public string? LogoUrl { get; set; }

    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/DTOs/SignupBusinessDto.cs  (sha256:daebace2d54e91a96825decc469c8acd57822d3e74bd5271ca80792e36cbb30e)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.BusinessModule.DTOs
{
    public class SignupBusinessDto
    {
        [Required]
        public string CompanyName { get; set; }

        [Required]
        [EmailAddress]
        public string Email { get; set; }

        [Required]
        public string Password { get; set; }

        public string? RepresentativeName { get; set; }

        public string? Phone { get; set; }
        public string RoleName { get; set; } = "business"; // Default to business role

        // 🆕 NEW FIELD (Internal use only)
        public Guid? CreatedByPartnerId { get; set; } // to assign the business to a specific user/agent/partner}

    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/Models/Business.cs  (sha256:055d611b4b5423e751e8bf6d2827af589920c5d7dff393b04b3e1fd8c776a189)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Models.BusinessModel;
using xbytechat_api.WhatsAppSettings.Models;

namespace xbytechat.api.Features.BusinessModule.Models
{
    public class Business
    {
        public Guid Id { get; set; }

        // 🏢 Basic Info
        public string? CompanyName { get; set; }
        public string BusinessName { get; set; }
        public string BusinessEmail { get; set; }  // Not used for login, just business contact
        public string? RepresentativeName { get; set; }

        public Guid? CreatedByPartnerId { get; set; }
        public string? Phone { get; set; }
        public string? CompanyPhone { get; set; }
        public string? Website { get; set; }
        public string? Address { get; set; }
        public string? Industry { get; set; }
        public string? LogoUrl { get; set; }

        // 📦 SaaS Plan & Status using Enums
        // public enum PlanType { Basic, Smart, Advanced } -- moved to bisinessinfo
        // public PlanType Plan { get; set; } = PlanType.Basic;  // moved to bisinessinfo
        public enum StatusType { Pending, Approved, Rejected }
        public StatusType Status { get; set; } = StatusType.Pending;  // Default to Pending

        // 📝 Metadata
        public string? Tags { get; set; }
        public string? Source { get; set; }
        public string? Notes { get; set; }

        // 📅 Timestamps
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public string? CreatedBy { get; set; }
        public bool IsApproved { get; set; } = false;
        public string? ApprovedBy { get; set; }
        public DateTime? ApprovedAt { get; set; }
        public DateTime? LastLoginAt { get; set; }

        // 🗑 Soft Deletion
        public bool IsDeleted { get; set; } = false;
        public DateTime? DeletedAt { get; set; }
        public string? DeletedBy { get; set; }

        // 👥 Navigation Property - List of Users (nullable if no users)
        public List<User> Users { get; set; } = new();


        public ICollection<MessageStatusLog> MessageStatusLogs { get; set; }
        public ICollection<Campaign> Campaigns { get; set; } = new List<Campaign>();
        // 🔗 Plan Info linked

        /// This is a one-to-one relationship with BusinessPlanInfo
        public BusinessPlanInfo? BusinessPlanInfo { get; set; }

        public WhatsAppSettingEntity WhatsAppSettings { get; set; }


    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/Services/BusinessService.cs  (sha256:a5ceba39eb2d4c79822b04180b564b268fc5ed58c58f9e85c968cbd5b5d7d5a0)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using System.Security.Cryptography;
using System.Text;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.AccessControl.Models;
using xbytechat.api.Features.AuditTrail.Models;
using xbytechat.api.Features.AuditTrail.Services;
using xbytechat.api.Features.BusinessModule.DTOs;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.PlanManagement.Models;
using xbytechat.api.Helpers;
using xbytechat.api.Models.BusinessModel;
using xbytechat.api.Repositories.Interfaces;

namespace xbytechat.api.Features.BusinessModule.Services
{
    public class BusinessService : IBusinessService
    {
        private readonly IGenericRepository<Business> _businessRepo;
        private readonly IGenericRepository<User> _userRepo;
        private readonly IGenericRepository<Role> _roleRepo;
        private readonly IAuditLogService _auditLogService;
        private readonly IHttpContextAccessor _httpContextAccessor;

        public BusinessService(
            IGenericRepository<Business> businessRepo,
            IGenericRepository<User> userRepo,
            IGenericRepository<Role> roleRepo,
            IAuditLogService auditLogService,
            IHttpContextAccessor httpContextAccessor)
        {
            _businessRepo = businessRepo;
            _userRepo = userRepo;
            _roleRepo = roleRepo;
            _auditLogService = auditLogService;
            _httpContextAccessor = httpContextAccessor;
        }

        public async Task<ResponseResult> SignupBusinessAsync(SignupBusinessDto dto)
        {
            var normalizedEmail = dto.Email.Trim().ToLower();
            var existing = await _userRepo.FirstOrDefaultAsync(u => u.Email == normalizedEmail);
            if (existing != null)
                return ResponseResult.ErrorInfo("❌ Email already exists");

            var business = new Business
            {
                Id = Guid.NewGuid(),
                CompanyName = dto.CompanyName,
                BusinessName = dto.CompanyName,
                BusinessEmail = normalizedEmail,
                RepresentativeName = dto.RepresentativeName,
                Phone = dto.Phone,
                Status = Business.StatusType.Pending,
                // Plan = PlanType.Basic,
                IsApproved = false,
                CreatedAt = DateTime.UtcNow
            };
            // STEP 2: Create Plan Info separately
            var planInfo = new BusinessPlanInfo
            {
                BusinessId = business.Id,
                Plan = PlanType.Basic,
                TotalMonthlyQuota = 1000,
                RemainingMessages = 1000,
                QuotaResetDate = DateTime.UtcNow.AddMonths(1),
                WalletBalance = 0
            };
            // STEP 3: Link them
            business.BusinessPlanInfo = planInfo;
            // STEP 4: Save both
            await _businessRepo.AddAsync(business);
            await _businessRepo.SaveAsync();

            var role = await _roleRepo.FirstOrDefaultAsync(r => r.Name.ToLower() == dto.RoleName.Trim().ToLower());

            if (role == null)
                return ResponseResult.ErrorInfo("❌ Invalid role specified");

            var user = new User
            {
                Id = Guid.NewGuid(),
                Name = dto.CompanyName,
                Email = normalizedEmail,
                PasswordHash = HashPassword(dto.Password),
                Role = role,
                Status = "Pending",
                BusinessId = business.Id
            };

            await _userRepo.AddAsync(user);
            await _userRepo.SaveAsync();

            await _auditLogService.SaveLogAsync(new AuditLog
            {
                BusinessId = business.Id,
                PerformedByUserId = user.Id,
                PerformedByUserName = user.Name,
                RoleAtTime = "business",
                ActionType = "business.signup",
                Description = $"New business signup: {business.CompanyName}",
                IPAddress = _httpContextAccessor.HttpContext?.Connection?.RemoteIpAddress?.ToString(),
                UserAgent = _httpContextAccessor.HttpContext?.Request?.Headers["User-Agent"].ToString()
            });

            return ResponseResult.SuccessInfo("✅ Signup successful. Pending approval.", new { BusinessId = business.Id });
        }

        public async Task<ResponseResult> UpdateBusinessAsync(Business business)
        {
            if (business == null)
                return ResponseResult.ErrorInfo("❌ Invalid business object provided.");

            try
            {
                _businessRepo.Update(business);
                await _businessRepo.SaveAsync();

                return ResponseResult.SuccessInfo("✅ Business updated successfully.");
            }
            catch (Exception ex)
            {
                // 🚨 Catch any unexpected error
                return ResponseResult.ErrorInfo("❌ Failed to update business: " + ex.Message);
            }
        }
      
        public async Task<List<PendingBusinessDto>> GetPendingBusinessesAsync(string role, string userId)
        {
            try
            {
                if (string.IsNullOrEmpty(userId) || string.IsNullOrEmpty(role))
                {
                    // 🔴 Invalid session or token
                    return new List<PendingBusinessDto>();
                }

                if (!Guid.TryParse(userId, out var currentGuid))
                {
                    // 🔴 Bad ID format
                    return new List<PendingBusinessDto>();
                }

                IQueryable<Business> query = _businessRepo.AsQueryable()
                    .Where(b => b.Status == Business.StatusType.Pending && !b.IsDeleted);

                if (role == "partner")
                {
                    query = query.Where(b => b.CreatedByPartnerId == currentGuid);
                }

                var pending = await query.ToListAsync();

                return pending.Select(b => new PendingBusinessDto
                {
                    BusinessId = b.Id,
                    CompanyName = b.CompanyName ?? "",
                    BusinessEmail = b.BusinessEmail ?? "",
                    RepresentativeName = b.RepresentativeName ?? "",
                    Phone = b.Phone ?? "",
                    //Plan = b.Plan.ToString(),
                    Plan = b.BusinessPlanInfo?.Plan.ToString() ?? "Unknown",

                    CreatedAt = b.CreatedAt,
                    IsApproved = b.IsApproved
                }).ToList();
            }
            catch (Exception ex)
            {
                return new List<PendingBusinessDto>();
            }
        }

        public async Task<ResponseResult> ApproveBusinessAsync(Guid businessId)
        {
            var business = await _businessRepo
                .AsQueryable()
                .Include(b => b.Users)
                .FirstOrDefaultAsync(b => b.Id == businessId);

            if (business == null)
                return ResponseResult.ErrorInfo("❌ Business not found.");

            // ✅ Current Logged-in User Details
            var httpContext = _httpContextAccessor.HttpContext;
            var currentUserId = httpContext?.User?.FindFirst("id")?.Value;
            var currentUserRole = httpContext?.User?.Claims
    .FirstOrDefault(c => c.Type.Contains("role"))?.Value;
            //httpContext?.User?.FindFirst("role")?.Value;

            // var currentUserName = httpContext?.User?.FindFirst("name")?.Value ?? "Unknown";
            var currentUserName = httpContext?.User?.Claims
    .FirstOrDefault(c => c.Type.Contains("name"))?.Value ?? "Unknown";
            if (string.IsNullOrEmpty(currentUserId) || string.IsNullOrEmpty(currentUserRole))
                return ResponseResult.ErrorInfo("❌ Unauthorized access. Please login again.");

            var currentGuid = Guid.Parse(currentUserId);

            // ✅ Authorization Logic
            var isSuperAdmin = currentUserRole.Equals("admin", StringComparison.OrdinalIgnoreCase) ||
                               currentUserRole.Equals("superadmin", StringComparison.OrdinalIgnoreCase);

            var isAssignedPartner = business.CreatedByPartnerId.HasValue &&
                                     business.CreatedByPartnerId.Value == currentGuid;

            if (!isSuperAdmin && !isAssignedPartner)
            {
                return ResponseResult.ErrorInfo("⛔ You are not authorized to approve this business.");
            }

            // ✅ Approve Business
            business.IsApproved = true;
            business.Status = Business.StatusType.Approved;
            business.ApprovedAt = DateTime.UtcNow;
            business.ApprovedBy = currentUserName;

            _businessRepo.Update(business);

            // ✅ Update all Users to "ProfilePending"
            foreach (var user in business.Users)
            {
                user.Status = "ProfilePending";
                _userRepo.Update(user);
            }

            await _businessRepo.SaveAsync();
            await _userRepo.SaveAsync();

            // ✅ Audit Log
            await _auditLogService.SaveLogAsync(new AuditLog
            {
                BusinessId = business.Id,
                PerformedByUserId = currentGuid,
                PerformedByUserName = currentUserName,
                RoleAtTime = currentUserRole,
                ActionType = "business.approved",
                Description = $"Business approved: {business.CompanyName}",
                IPAddress = httpContext?.Connection?.RemoteIpAddress?.ToString(),
                UserAgent = httpContext?.Request?.Headers["User-Agent"].ToString()
            });

            return ResponseResult.SuccessInfo("✅ Business approved successfully.");
        }

        public async Task<ResponseResult> RejectBusinessAsync(Guid businessId)
        {
            var business = await _businessRepo.FindByIdAsync(businessId);
            if (business is null)
                return ResponseResult.ErrorInfo("❌ Business not found");

            business.Status = Business.StatusType.Rejected;
            business.IsDeleted = true;
            business.DeletedAt = DateTime.UtcNow;

            _businessRepo.Update(business);
            await _businessRepo.SaveAsync();

            await _auditLogService.SaveLogAsync(new AuditLog
            {
                BusinessId = business.Id,
                PerformedByUserId = Guid.TryParse(_httpContextAccessor.HttpContext?.User?.FindFirst("id")?.Value, out var userId) ? userId : Guid.Empty,
                PerformedByUserName = _httpContextAccessor.HttpContext?.User?.FindFirst("email")?.Value,
                RoleAtTime = _httpContextAccessor.HttpContext?.User?.FindFirst("role")?.Value,
                ActionType = "business.rejected",
                Description = $"Business rejected: {business.CompanyName}",
                IPAddress = _httpContextAccessor.HttpContext?.Connection?.RemoteIpAddress?.ToString(),
                UserAgent = _httpContextAccessor.HttpContext?.Request?.Headers["User-Agent"].ToString()
            });

            return ResponseResult.SuccessInfo("✅ Business rejected and marked as deleted");
        }

        public async Task<ResponseResult> HoldBusinessAsync(Guid businessId)
        {
            var business = await _businessRepo.FindByIdAsync(businessId);
            if (business is null)
                return ResponseResult.ErrorInfo("❌ Business not found");

            business.IsApproved = false;
            business.Status = Business.StatusType.Pending;

            _businessRepo.Update(business);
            await _businessRepo.SaveAsync();

            await _auditLogService.SaveLogAsync(new AuditLog
            {
                BusinessId = business.Id,
                PerformedByUserId = Guid.TryParse(_httpContextAccessor.HttpContext?.User?.FindFirst("id")?.Value, out var userId) ? userId : Guid.Empty,
                PerformedByUserName = _httpContextAccessor.HttpContext?.User?.FindFirst("email")?.Value,
                RoleAtTime = _httpContextAccessor.HttpContext?.User?.FindFirst("role")?.Value,
                ActionType = "business.hold",
                Description = $"Business put on hold: {business.CompanyName}",
                IPAddress = _httpContextAccessor.HttpContext?.Connection?.RemoteIpAddress?.ToString(),
                UserAgent = _httpContextAccessor.HttpContext?.Request?.Headers["User-Agent"].ToString()
            });

            return ResponseResult.SuccessInfo("⏸ Business put on hold");
        }

        public async Task<ResponseResult> CompleteProfileAsync(Guid businessId, ProfileCompletionDto dto)
        {
            var business = await _businessRepo.FindByIdAsync(businessId);
            if (business is null)
                return ResponseResult.ErrorInfo("❌ Business not found");

            if (!string.IsNullOrEmpty(dto.BusinessName)) business.BusinessName = dto.BusinessName;
            if (!string.IsNullOrEmpty(dto.CompanyPhone)) business.CompanyPhone = dto.CompanyPhone;
            if (!string.IsNullOrEmpty(dto.Website)) business.Website = dto.Website;
            if (!string.IsNullOrEmpty(dto.Address)) business.Address = dto.Address;
            if (!string.IsNullOrEmpty(dto.Industry)) business.Industry = dto.Industry;
            if (!string.IsNullOrEmpty(dto.LogoUrl)) business.LogoUrl = dto.LogoUrl;
            if (!string.IsNullOrEmpty(dto.ReperesentativeName)) business.RepresentativeName = dto.ReperesentativeName;
            if (!string.IsNullOrEmpty(dto.Phone)) business.Phone = dto.Phone;
            _businessRepo.Update(business);
            await _businessRepo.SaveAsync();
            return ResponseResult.SuccessInfo("✅ Profile updated successfully");
        }

        public async Task<Business?> GetBusinessByEmailAsync(string email)
        {
            return await _businessRepo.FirstOrDefaultAsync(b => b.BusinessEmail.ToLower() == email.Trim().ToLower());
        }

        private string HashPassword(string password)
        {
            using var sha = SHA256.Create();
            var bytes = Encoding.UTF8.GetBytes(password);
            var hash = sha.ComputeHash(bytes);
            return Convert.ToBase64String(hash);
        }

        public async Task<Business?> GetByIdAsync(Guid businessId)
        {
            return await _businessRepo.FindByIdAsync(businessId);
        }

        public async Task<List<Business>> GetApprovedBusinessesAsync()
        {
            return await _businessRepo.AsQueryable()
               .Where(b => b.IsApproved && !b.IsDeleted)
               .OrderBy(b => b.CompanyName)
               .ToListAsync();
        }
        public IQueryable<Business> Query()
        {
            return _businessRepo.AsQueryable();
        }
    }
}

``n
--- file: xbytechat-api/Features/BusinessModule/Services/IBusinessService.cs  (sha256:c89cefb9912082865f89106271d35ec1e815ec97981e3cd0ea7cd34149cbe55f)
`$lang
using System.Runtime.CompilerServices;
using xbytechat.api.Features.BusinessModule.DTOs;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Helpers;
using xbytechat.api.Models;
namespace xbytechat.api.Features.BusinessModule.Services
{

    public interface IBusinessService
    {
        IQueryable<Business> Query();
        //  This is move to AuthController 
        Task<ResponseResult> SignupBusinessAsync(SignupBusinessDto dto); /// Signup + create admin user

        //  Task<List<PendingBusinessDto>> GetPendingBusinessesAsync();      // Admin: list of unapproved businesses
        Task<ResponseResult> ApproveBusinessAsync(Guid businessId);      // Admin action
        Task<ResponseResult> RejectBusinessAsync(Guid businessId);       // Admin action
        Task<ResponseResult> HoldBusinessAsync(Guid businessId);         // Admin action
        Task<ResponseResult> CompleteProfileAsync(Guid businessId, ProfileCompletionDto dto); // Post-login completion
        Task<Business?> GetBusinessByEmailAsync(string email);
        Task<Business?> GetByIdAsync(Guid businessId);
        Task<ResponseResult> UpdateBusinessAsync(Business business);
        Task<List<PendingBusinessDto>> GetPendingBusinessesAsync(string role, string userId);
        Task<List<Business>> GetApprovedBusinessesAsync();
    }

}

``n
--- file: xbytechat-api/Features/CampaignModule/Controllers/CampaignController.cs  (sha256:284cd1ba527750abfce187560ac888f526e05714d08705bf52794949f2aa65de)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Serilog;
using System;
using System.Security.Claims;
using System.Threading.Tasks;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.BusinessModule.Services;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignModule.Services;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Helpers;
using xbytechat.api.Shared;
using static xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController;

namespace xbytechat.api.Features.CampaignModule.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class CampaignController : ControllerBase
    {
        private readonly ICampaignService _campaignService;
        private readonly IBusinessService _businessService;
        private readonly IMessageEngineService _messageService;
        private readonly IHttpContextAccessor _httpContextAccessor;

        public CampaignController(
            ICampaignService campaignService,
            IBusinessService businessService,
            IMessageEngineService messageEngineService,
            IHttpContextAccessor httpContextAccessor)
        {
            _campaignService = campaignService;
            _businessService = businessService;
            _messageService = messageEngineService;
            _httpContextAccessor = httpContextAccessor;
        }

        [HttpGet("get-image-campaign")]
        public async Task<IActionResult> GetAll([FromQuery] string? type)
        {
            var user = HttpContext.User;
            var businessIdClaim = user.FindFirst("businessId");

            if (businessIdClaim == null || !Guid.TryParse(businessIdClaim.Value, out var businessId))
                return Unauthorized(new { message = "🚫 Invalid or missing BusinessId claim." });

            var result = await _campaignService.GetAllCampaignsAsync(businessId, type);
            return Ok(result);
        }

        [HttpGet("paginated")]
        public async Task<IActionResult> GetPaginatedCampaigns([FromQuery] PaginatedRequest request)
        {
            var user = HttpContext.User;
            var businessIdClaim = user.FindFirst("businessId");

            if (businessIdClaim == null || !Guid.TryParse(businessIdClaim.Value, out var businessId))
                return Unauthorized(new { message = "🚫 Invalid or missing BusinessId claim." });

            var result = await _campaignService.GetPaginatedCampaignsAsync(businessId, request);
            return Ok(result);
        }

        [HttpGet("debug-claims")]
        public IActionResult DebugClaims()
        {
            var user = HttpContext.User;
            var businessId = user.FindFirst("businessId")?.Value;

            return Ok(new
            {
                name = user.Identity?.Name,
                businessId
            });
        }

        [HttpPost("create-text-campaign")]
        public async Task<IActionResult> CreateTextCampaign([FromBody] CampaignCreateDto dto)
        {
            try
            {
                var businessIdClaim = User.FindFirst("businessId")?.Value;
                if (!Guid.TryParse(businessIdClaim, out var businessId))
                    return Unauthorized(new { message = "🚫 Invalid or missing BusinessId claim." });

                var createdBy = User.Identity?.Name ?? "system";

                if (string.IsNullOrWhiteSpace(dto.Name))
                    return BadRequest(new { message = "🚫 Campaign name is required." });

                if (string.IsNullOrWhiteSpace(dto.TemplateId))
                    return BadRequest(new { message = "🚫 TemplateId is required for template campaigns." });

                if (string.IsNullOrWhiteSpace(dto.MessageTemplate))
                    return BadRequest(new { message = "🚫 Message template content is required." });

                var campaignId = await _campaignService.CreateTextCampaignAsync(dto, businessId, createdBy);

                return campaignId != null
                    ? Ok(new
                    {
                        success = true,
                        message = "✅ Campaign created successfully",
                        campaignId = campaignId.Value
                    })
                    : BadRequest(new { success = false, message = "❌ Failed to create campaign" });
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception in CreateTextCampaign");
                return StatusCode(500, new { message = "🚨 Internal server error", error = ex.Message });
            }
        }

        [HttpPost("create-image-campaign")]
        public async Task<IActionResult> CreateImageCampaign([FromBody] CampaignCreateDto dto)
        {
            try
            {
                var user = HttpContext.User;
                var businessIdClaim = user.FindFirst("businessId");

                if (businessIdClaim == null || !Guid.TryParse(businessIdClaim.Value, out var businessId))
                    return Unauthorized(new { message = "🚫 Invalid or missing BusinessId claim." });

                if (dto.MultiButtons != null && dto.MultiButtons.Any())
                {
                    var allowedTypes = new[] { "url", "copy_code", "flow", "phone_number", "quick_reply" };
                    foreach (var button in dto.MultiButtons)
                    {
                        var type = button.ButtonType?.Trim().ToLower();

                        if (!allowedTypes.Contains(type))
                            return BadRequest(new { message = $"❌ Invalid ButtonType: '{type}' is not supported." });

                        var needsValue = new[] { "url", "flow", "copy_code", "phone_number" };
                        if (needsValue.Contains(type) && string.IsNullOrWhiteSpace(button.TargetUrl))
                            return BadRequest(new { message = $"❌ Button '{button.ButtonText}' requires a valid TargetUrl or Value for type '{type}'." });

                        if (button.TargetUrl?.ToLower() == "unknown")
                            return BadRequest(new { message = $"❌ Invalid value 'unknown' found in button '{button.ButtonText}'." });
                    }
                }

                var createdBy = user.Identity?.Name ?? "system";
                var campaignId = await _campaignService.CreateImageCampaignAsync(businessId, dto, createdBy);

                return Ok(new
                {
                    success = true,
                    message = "✅ Campaign created successfully",
                    campaignId
                });
            }
            catch (UnauthorizedAccessException ex)
            {
                return BadRequest(new { message = ex.Message });
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception in CreateImageCampaign");
                return StatusCode(500, new { message = "🚨 Internal server error", error = ex.Message });
            }
        }

        // ✅ Moved above {id} routes
        [HttpPost("{id}/assign-contacts")]
        public async Task<IActionResult> AssignContactsToCampaign(Guid id, [FromBody] AssignContactsDto request)
        {
            try
            {
                var businessId = GetBusinessId();
                var success = await _campaignService.AssignContactsToCampaignAsync(id, businessId, request.ContactIds);

                return success
                    ? Ok(new { message = "✅ Contacts assigned" })
                    : BadRequest(new { message = "❌ Failed to assign contacts" });
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Error assigning contacts: " + ex.Message);
                return StatusCode(500, new { message = "Internal error", error = ex.Message });
            }
        }

        [HttpDelete("{campaignId}/recipients/{contactId}")]
        public async Task<IActionResult> RemoveCampaignRecipient(Guid campaignId, Guid contactId)
        {
            try
            {
                var businessId = GetBusinessId();
                var success = await _campaignService.RemoveRecipientAsync(businessId, campaignId, contactId);

                if (!success)
                    return NotFound(new { message = "Recipient not found or not assigned" });

                return NoContent();
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Remove recipient failed: " + ex.Message);
                return StatusCode(500, new { message = "Error removing recipient", detail = ex.Message });
            }
        }

        [HttpPost("send-campaign/{campaignId}")] // use to send free text and Template campaigns
        public async Task<IActionResult> SendTemplateCampaign(Guid campaignId)
        {
            try
            {
                var result = await _campaignService.SendTemplateCampaignWithTypeDetectionAsync(campaignId);
                return result.Success ? Ok(result) : BadRequest(result);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception while sending image template campaign");
                return StatusCode(500, ResponseResult.ErrorInfo("🚨 Server error while sending campaign", ex.ToString()));
            }
        }

        [HttpPost("send-template-campaign/{id}")]
        public async Task<IActionResult> SendImageCampaign(Guid id)
        {
            var result = await _campaignService.SendTemplateCampaignAsync(id);
            return result.Success ? Ok(result) : BadRequest(result);
        }

        [HttpPost("send/{campaignId}")]
        public async Task<IActionResult> SendCampaign(Guid campaignId)
        {
            try
            {
                var ipAddress = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
                var userAgent = Request.Headers["User-Agent"].ToString() ?? "unknown";

                var success = await _campaignService.SendCampaignAsync(campaignId, ipAddress, userAgent);

                return success
                    ? Ok(new { success = true, message = "✅ Campaign sent successfully" })
                    : BadRequest(new { success = false, message = "❌ Campaign sending failed" });
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception in SendCampaign");
                return StatusCode(500, new { success = false, message = "🚨 Internal Server Error", error = ex.Message });
            }
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateCampaign(Guid id, [FromBody] CampaignCreateDto dto)
        {
            var result = await _campaignService.UpdateCampaignAsync(id, dto);
            return result
                ? Ok(new { message = "✏️ Campaign updated successfully" })
                : BadRequest(new { message = "❌ Update failed — only draft campaigns can be edited" });
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteCampaign(Guid id)
        {
            var result = await _campaignService.DeleteCampaignAsync(id);
            return result
                ? Ok(new { message = "🗑️ Campaign deleted successfully" })
                : BadRequest(new { message = "❌ Delete failed — only draft campaigns can be deleted" });
        }

        [HttpGet("recipients/{id}")]
        public async Task<IActionResult> GetCampaignRecipients(Guid id)
        {
            try
            {
                var businessId = GetBusinessId();
                var recipients = await _campaignService.GetRecipientsByCampaignIdAsync(id, businessId);
                return Ok(recipients);
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Error fetching campaign recipients: " + ex.Message);
                return StatusCode(500, new { message = "Error fetching recipients", detail = ex.Message });
            }
        }

        [HttpGet("{id}")]
        public async Task<ActionResult<CampaignDto>> GetCampaignById(Guid id)
        {
            var businessId = GetBusinessId();
            var campaign = await _campaignService.GetCampaignByIdAsync(id, businessId);

            if (campaign == null)
                return NotFound();

            return Ok(campaign);
        }

        private Guid GetBusinessId()
        {
            var claim = HttpContext.User.FindFirst("businessId")?.Value;
            if (string.IsNullOrEmpty(claim))
                throw new UnauthorizedAccessException("BusinessId not found in token claims.");

            return Guid.Parse(claim);
        }
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Controllers/CampaignRecipientController.cs  (sha256:247e52ea9259e04d5bc4fb6e22d3aa4791b77af05431022b0572a837bbf7e326)
`$lang
using Microsoft.AspNetCore.Mvc;
using Serilog;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignModule.Services;

namespace xbytechat.api.Features.CampaignModule.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class CampaignRecipientController : ControllerBase
    {
        private readonly ICampaignRecipientService _recipientService;

        public CampaignRecipientController(ICampaignRecipientService recipientService)
        {
            _recipientService = recipientService;
        }

        // ✅ Get a single recipient by ID
        [HttpGet("{id}")]
        public async Task<ActionResult<CampaignRecipientDto>> GetRecipientById(Guid id)
        {
            var recipient = await _recipientService.GetByIdAsync(id);
            if (recipient == null)
                return NotFound(new { message = "Recipient not found" });

            return Ok(recipient);
        }

        // ✅ Get all recipients for a specific campaign
        [HttpGet("/api/campaigns/{campaignId}/recipients")]
        public async Task<ActionResult> GetRecipientsForCampaign(Guid campaignId)
        {
            var recipients = await _recipientService.GetByCampaignIdAsync(campaignId);
            return Ok(recipients);
        }

        // ✅ Update recipient status (e.g., from Pending → Sent)
        [HttpPut("{recipientId}/status")]
        public async Task<ActionResult> UpdateStatus(Guid recipientId, [FromQuery] string newStatus)
        {
            var success = await _recipientService.UpdateStatusAsync(recipientId, newStatus);
            if (!success)
                return NotFound(new { message = "Recipient not found or update failed" });

            return Ok(new { message = "Status updated" });
        }

        // ✅ Track a reply from customer
        [HttpPut("{recipientId}/reply")]
        public async Task<ActionResult> TrackReply(Guid recipientId, [FromQuery] string replyText)
        {
            var success = await _recipientService.TrackReplyAsync(recipientId, replyText);
            if (!success)
                return NotFound(new { message = "Recipient not found or tracking failed" });

            return Ok(new { message = "Reply tracked" });
        }

        // 🔍 Search recipients by optional filters (status, keyword)
        [HttpGet("search")]
        public async Task<ActionResult<List<CampaignRecipientDto>>> SearchRecipients([FromQuery] string? status, [FromQuery] string? keyword)
        {
            var results = await _recipientService.SearchRecipientsAsync(status, keyword);
            return Ok(results);
        }

        [HttpPost("{id}/assign-contacts")]
        public async Task<IActionResult> AssignContacts(Guid id, [FromBody] AssignContactsDto dto)
        {
            try
            {
                await _recipientService.AssignContactsToCampaignAsync(id, dto.ContactIds);
                return Ok(new { message = "Contacts assigned successfully" });
            }
            catch (Exception ex)
            {
                Log.Error(ex, "Error assigning contacts to campaign");
                return StatusCode(500, new { message = "Failed to assign contacts" });
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/AssignContactsDto.cs  (sha256:8f8b9b0da213111f833dd07dd7e5189ccc02984cef1b34deb5b1d93a5d40678e)
`$lang
namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class AssignContactsDto
    {
        public List<Guid> ContactIds { get; set; }
    }

}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignButtonDto.cs  (sha256:21e757f8859c9ea36b40c0d3418d5211cce8a22a26b07b81af62b723f93dc2e5)
`$lang
namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignButtonDto
    {
        public string ButtonText { get; set; } = string.Empty; // 📍 e.g., "Buy Now"
        public string ButtonType { get; set; } = "url";         // 🔘 url | quick_reply | call
        public string TargetUrl { get; set; } = string.Empty;  // 🌐 or phone/call param
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignButtonParamFromMetaDto.cs  (sha256:8162311781c02a6a61e91fbe4b39251da400422e50341b7ca21f484a74d926f4)
`$lang
namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignButtonParamFromMetaDto
    {
        public string Text { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public string SubType { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignCreateDto.cs  (sha256:421004e6e792a8d5452c241aed6795a710992d4aac7169c63ae22dc1129352c2)
`$lang
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations.Schema;
using xbytechat.api.Features.CTAManagement.DTOs;
using xbytechat.api.Features.MessagesEngine.DTOs; // Required to reference CTAButtonDto

namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignCreateDto
    {
        public string Name { get; set; }

        [Column(TypeName = "text")]
        public string MessageTemplate { get; set; }

        public string? TemplateId { get; set; } // ✅ Optional Meta template ID

        public string? FollowUpTemplateId { get; set; } // 🔁 Auto-reply template after interest

        public string? CampaignType { get; set; } //= "template"; // "text", "template", "cta"

        public Guid? CtaId { get; set; } // 🔘 For legacy CTA support (optional)

        public List<CampaignButtonDto> MultiButtons { get; set; } = new(); // ✅ New multi-button support
        public DateTime? ScheduledAt { get; set; } // 📅 Optional future scheduling

        //public List<Guid>? ContactIds { get; set; } // 👥 Target contact list

        public string? ImageUrl { get; set; } // 🖼️ Optional image field

        public string? ImageCaption { get; set; } // 📝 Optional caption

        public List<Guid> ContactIds { get; set; } = new();

        public List<string>? TemplateParameters { get; set; }
        public List<CampaignButtonParamFromMetaDto>? ButtonParams { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignDto.cs  (sha256:f2b7b259bf5244382d2ce138feef7ed1aeb97228ac2866143092b5a24bc07bbd)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.Features.CampaignModule.DTOs;

namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignDto
    {
        public Guid Id { get; set; }

        public string Name { get; set; }

        public string MessageTemplate { get; set; }

        public string? TemplateId { get; set; }
        public string? MessageBody { get; set; }
        public string? CampaignType { get; set; }

        public string? Status { get; set; }

        public string? ImageUrl { get; set; }

        public string? ImageCaption { get; set; }

        public DateTime CreatedAt { get; set; }

        public DateTime? ScheduledAt { get; set; }

        public Guid? CtaId { get; set; }

        public CtaPreviewDto? Cta { get; set; }

        public List<CampaignButtonDto> MultiButtons { get; set; } = new();
    }

    // 📦 Embedded DTO for CTA preview (title + button text only)
    public class CtaPreviewDto
    {
        public string Title { get; set; } = string.Empty;

        public string ButtonText { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignRecipientDto.cs  (sha256:7d59f3b2a92ff69f0425bf1c3541facd28da12efde822400d313e6beddc8ace5)
`$lang
using System;

namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignRecipientDto
    {
        public Guid Id { get; set; }

        public Guid ContactId { get; set; }
        public string ContactName { get; set; }
        public string ContactPhone { get; set; }

        public string Status { get; set; }
        public DateTime? SentAt { get; set; }

        // 🔁 Advanced Fields (for analytics & future automation)
        public string? BotId { get; set; }
        public string? MessagePreview { get; set; }
        public string? ClickedCTA { get; set; }
        public string? CategoryBrowsed { get; set; }
        public string? ProductBrowsed { get; set; }
        public bool IsAutoTagged { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/DTOs/CampaignSummaryDto.cs  (sha256:d2517a48edbd1df32b85f5a55469c9fbbe4e356db965cd6cc0067e5af60c0bf1)
`$lang
namespace xbytechat.api.Features.CampaignModule.DTOs
{
    public class CampaignSummaryDto
    {
        public Guid Id { get; set; }
        public string? Name { get; set; }
        public string? Status { get; set; }
        public DateTime? ScheduledAt { get; set; }
        public DateTime CreatedAt { get; set; }


        public string? ImageUrl { get; set; } // ✅ Add this
        public string? ImageCaption { get; set; } // ✅ Add this
        public string? CtaTitle { get; set; } // Optional: For CTA info
        public int RecipientCount { get; set; } // Optional: To show 0/10 etc
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Models/Campaign.cs  (sha256:93a715f18655cfc7298072fd57b541aebd7393291f393194598bb0e0c3ade37d)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.CTAManagement.Models;
using System.ComponentModel.DataAnnotations.Schema;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.BusinessModule.Models;

namespace xbytechat.api.Features.CampaignModule.Models
{
    public class Campaign
    {
        public Guid Id { get; set; }

        // 🔗 Business info
        public Guid BusinessId { get; set; }
        public Business Business { get; set; }
        public Guid? CampaignId { get; set; }
        public Campaign? SourceCampaign { get; set; }

        // 📋 Core campaign details
        public string Name { get; set; }
        public string MessageTemplate { get; set; }
        public string? TemplateId { get; set; } // ✅ Meta-approved template ID

        [Column(TypeName = "text")]
        public string? MessageBody { get; set; } // ✅ Final resolved WhatsApp message body


        public string? FollowUpTemplateId { get; set; } // 🔁 For auto-reply follow-up after interest
        public string? CampaignType { get; set; } // = "template"; // text, template, cta

        // 🔘 CTA tracking (optional)
        public Guid? CtaId { get; set; }
        public CTADefinition? Cta { get; set; }

       
        public DateTime? ScheduledAt { get; set; }
        public string Status { get; set; } = "Draft"; // Draft, Scheduled, Sent

        // 👤 Metadata
        public string? CreatedBy { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

        // 🗑️ Soft delete support
        public bool IsDeleted { get; set; } = false;
        public DateTime? DeletedAt { get; set; }
        public string? DeletedBy { get; set; }

        // 👥 Recipient relationship
        public ICollection<CampaignRecipient> Recipients { get; set; }

        // 📊 Logs
        public ICollection<CampaignSendLog> SendLogs { get; set; } = new List<CampaignSendLog>();
        public ICollection<MessageStatusLog> MessageStatusLogs { get; set; }

        //public ICollection<Campaign> Campaigns { get; set; } = new List<Campaign>();

        public string? ImageUrl { get; set; } // ✅ store image URL
        public string? ImageCaption { get; set; } // optional caption
        public string? TemplateParameters { get; set; } // ✅ stores ["value1", "value2", ...] as JSON string

        public ICollection<CampaignButton> MultiButtons { get; set; } = new List<CampaignButton>();

        public ICollection<MessageLog> MessageLogs { get; set; } = new List<MessageLog>();

    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Models/CampaignButton.cs  (sha256:bfca22e0aed3117f3be8b3712de4a7b229991bc3c4b02bdb1f17e43709991977)
`$lang
using System;

namespace xbytechat.api.Features.CampaignModule.Models
{
    public class CampaignButton
    {
        public Guid Id { get; set; }

        public Guid CampaignId { get; set; } // 🔗 Foreign key
        public Campaign Campaign { get; set; }

        public string Title { get; set; } = string.Empty; // Button Text (e.g. Buy Now)
        public string Type { get; set; } = "url"; // Type: url, quick_reply, call, etc.
        public string Value { get; set; } = string.Empty; // Target URL or payload

        public int Position { get; set; } // Button order (1–3)
        public bool IsFromTemplate { get; set; } = false;

    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Models/CampaignFlowOverride .cs  (sha256:c4ee719e7601cfb0eb6d67fbba7e11cbd4a57ad5be58dd84f72beead08d88370)
`$lang
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.CampaignModule.Models
{
    public class CampaignFlowOverride
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid CampaignId { get; set; }

        [Required]
        [MaxLength(100)]
        public string TemplateName { get; set; } = string.Empty;

        [Required]
        [MaxLength(50)]
        public string ButtonText { get; set; } = string.Empty;

        public string? OverrideNextTemplate { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public string? CreatedBy { get; set; }

        [ForeignKey("CampaignId")]
        public Campaign? Campaign { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Models/CampaignRecipient.cs  (sha256:56577228e95ed7f6c8f49036a0f4a95c7536726ea3c45a0a6f3b60ea7fe33362)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.CampaignTracking.Models;

namespace xbytechat.api.Features.CampaignModule.Models
{
    public class CampaignRecipient
    {
        public Guid Id { get; set; }

        public Guid CampaignId { get; set; }
        public Campaign Campaign { get; set; }

        public Guid ContactId { get; set; }
        public Contact Contact { get; set; }

        public string Status { get; set; } = "Pending"; // Pending, Sent, Delivered, Failed, Replied
        public DateTime? SentAt { get; set; }

        public string? BotId { get; set; } // Multi-bot support
        public string? MessagePreview { get; set; } // Final message sent
        public string? ClickedCTA { get; set; } // Track CTA clicked like "BuyNow"
        public string? CategoryBrowsed { get; set; } // e.g., Ads
        public string? ProductBrowsed { get; set; } // e.g., Product name
        public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

        public bool IsAutoTagged { get; set; } = false; // Flag for automation-based tagging

        // ✅ NEW: One-to-many link to detailed logs (message attempts, delivery tracking)
        public ICollection<CampaignSendLog> SendLogs { get; set; }

        public Guid BusinessId { get; set; }  // ✅ Add this line
        public Business Business { get; set; } = null!; // if navigation is needed


    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Services/CampaignRecipientService.cs  (sha256:305276af3a69097d77fd771487b6a7edda41b141122cd38e0868e3915d9ae53d)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignModule.Models;

namespace xbytechat.api.Features.CampaignModule.Services
{
    public class CampaignRecipientService : ICampaignRecipientService
    {
        private readonly AppDbContext _context;

        public CampaignRecipientService(AppDbContext context)
        {
            _context = context;
        }

        // 🔍 Get a single recipient by ID
        public async Task<CampaignRecipientDto?> GetByIdAsync(Guid id)
        {
            return await _context.CampaignRecipients
                .Include(r => r.Contact)
                .Where(r => r.Id == id)
                .Select(r => new CampaignRecipientDto
                {
                    Id = r.Id,
                    ContactId = r.ContactId,
                    ContactName = r.Contact.Name,
                    ContactPhone = r.Contact.PhoneNumber,
                    Status = r.Status,
                    SentAt = r.SentAt
                })
                .FirstOrDefaultAsync();
        }

        // 📦 Get all recipients of a specific campaign
        public async Task<List<CampaignRecipientDto>> GetByCampaignIdAsync(Guid campaignId)
        {
            return await _context.CampaignRecipients
                .Include(r => r.Contact)
                .Where(r => r.CampaignId == campaignId)
                .Select(r => new CampaignRecipientDto
                {
                    Id = r.Id,
                    ContactId = r.ContactId,
                    ContactName = r.Contact.Name,
                    ContactPhone = r.Contact.PhoneNumber,
                    Status = r.Status,
                    SentAt = r.SentAt
                })
                .ToListAsync();
        }

        // ✏️ Update status of a specific recipient
        public async Task<bool> UpdateStatusAsync(Guid recipientId, string newStatus)
        {
            var recipient = await _context.CampaignRecipients.FindAsync(recipientId);
            if (recipient == null) return false;

            recipient.Status = newStatus;
            recipient.UpdatedAt = DateTime.UtcNow;

            await _context.SaveChangesAsync();
            return true;
        }

        // 💬 Track customer reply or CTA
        // 🗣️ Track customer reply on a recipient
        public async Task<bool> TrackReplyAsync(Guid recipientId, string replyText)
        {
            var recipient = await _context.CampaignRecipients.FindAsync(recipientId);
            if (recipient == null) return false;

            recipient.ClickedCTA = replyText; // You may later rename this to something like `LastReply`
            recipient.UpdatedAt = DateTime.UtcNow;

            await _context.SaveChangesAsync();
            return true;
        }


        // 🔎 Global recipient search across all campaigns
        // 🔍 Search recipients by optional status or keyword
        public async Task<List<CampaignRecipientDto>> SearchRecipientsAsync(string status = null, string keyword = null)
        {
            var query = _context.CampaignRecipients
                .Include(r => r.Contact)
                .AsQueryable();

            if (!string.IsNullOrEmpty(status))
                query = query.Where(r => r.Status == status);

            if (!string.IsNullOrEmpty(keyword))
                query = query.Where(r =>
                    r.Contact.Name.Contains(keyword) ||
                    r.Contact.PhoneNumber.Contains(keyword)
                );

            return await query
                .Select(r => new CampaignRecipientDto
                {
                    Id = r.Id,
                    ContactId = r.ContactId,
                    ContactName = r.Contact.Name,
                    ContactPhone = r.Contact.PhoneNumber,
                    Status = r.Status,
                    SentAt = r.SentAt
                })
                .ToListAsync();
        }

        //public async Task AssignContactsToCampaignAsync(Guid campaignId, List<Guid> contactIds)
        //{
        //    var existing = await _context.CampaignRecipients
        //        .Where(r => r.CampaignId == campaignId && contactIds.Contains(r.ContactId))
        //        .Select(r => r.ContactId)
        //        .ToListAsync();

        //    var newRecipients = contactIds
        //        .Where(id => !existing.Contains(id))
        //        .Select(contactId => new CampaignRecipient
        //        {
        //            Id = Guid.NewGuid(),
        //            CampaignId = campaignId,
        //            ContactId = contactId,
        //            Status = "Pending",
        //            SentAt = DateTime.UtcNow,
        //            UpdatedAt = DateTime.UtcNow,
        //            IsAutoTagged = false
        //        }).ToList();

        //    if (newRecipients.Any())
        //    {
        //        await _context.CampaignRecipients.AddRangeAsync(newRecipients);
        //        await _context.SaveChangesAsync();
        //    }
        //}
        public async Task AssignContactsToCampaignAsync(Guid campaignId, List<Guid> contactIds)
        {
            var campaign = await _context.Campaigns
                .AsNoTracking()
                .FirstOrDefaultAsync(c => c.Id == campaignId);

            if (campaign == null)
                throw new Exception("Campaign not found.");

            var businessId = campaign.BusinessId;

            var existing = await _context.CampaignRecipients
                .Where(r => r.CampaignId == campaignId && contactIds.Contains(r.ContactId))
                .Select(r => r.ContactId)
                .ToListAsync();

            var newRecipients = contactIds
                .Where(id => !existing.Contains(id))
                .Select(contactId => new CampaignRecipient
                {
                    Id = Guid.NewGuid(),
                    CampaignId = campaignId,
                    ContactId = contactId,
                    BusinessId = businessId, // ✅ required
                    Status = "Pending",
                    SentAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow,
                    IsAutoTagged = false
                }).ToList();

            if (newRecipients.Any())
            {
                await _context.CampaignRecipients.AddRangeAsync(newRecipients);
                await _context.SaveChangesAsync();
            }
        }

    }
}

``n
--- file: xbytechat-api/Features/CampaignModule/Services/CampaignService.cs  (sha256:f74197300f315bdfa4e8c0d87e323a7b7608a705baf836df2e38827e71b2f22e)
`$lang
using System;
using System.Linq;
using System.Threading.Tasks;
using System.Collections.Generic;
using Microsoft.EntityFrameworkCore;
using Serilog;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Shared;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Services.Messages.Interfaces;
using xbytechat.api.DTOs.Messages;
using Microsoft.Extensions.DependencyInjection;
using xbytechat.api.Features.xbTimeline.Services;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.CRM.Dtos;
using Newtonsoft.Json;
using xbytechat.api.Helpers;
using xbytechat_api.WhatsAppSettings.Services;
using xbytechat.api.Shared.utility;
using xbytechat.api.Features.MessagesEngine.PayloadBuilders;
using xbytechat.api.WhatsAppSettings.DTOs;
using xbytechat.api.Features.BusinessModule.Models;

namespace xbytechat.api.Features.CampaignModule.Services
{
    public class CampaignService : ICampaignService
    {
        private readonly AppDbContext _context;
        private readonly IMessageService _messageService;
        private readonly IServiceProvider _serviceProvider;
        private readonly ILeadTimelineService _timelineService;
        private readonly IMessageEngineService _messageEngineService;
        private readonly IWhatsAppTemplateFetcherService _templateFetcherService;
        public CampaignService(AppDbContext context, IMessageService messageService,
                               IServiceProvider serviceProvider,
                               ILeadTimelineService timelineService,
                               IMessageEngineService messageEngineService,
                               IWhatsAppTemplateFetcherService templateFetcherService)
        {
            _context = context;
            _messageService = messageService;
            _serviceProvider = serviceProvider;
            _timelineService = timelineService; // ✅ new
            _messageEngineService = messageEngineService;
            _templateFetcherService = templateFetcherService;

        }


        #region Get All Types of Get and Update and Delete Methods

        public async Task<List<CampaignSummaryDto>> GetAllCampaignsAsync(Guid businessId)
        {
            return await _context.Campaigns
                .Where(c => c.BusinessId == businessId)
                .OrderByDescending(c => c.CreatedAt)
                .Select(c => new CampaignSummaryDto
                {
                    Id = c.Id,
                    Name = c.Name,
                    Status = c.Status,
                    ScheduledAt = c.ScheduledAt,
                    CreatedAt = c.CreatedAt,

                })
                .ToListAsync();
        }
        public async Task<CampaignDto?> GetCampaignByIdAsync(Guid campaignId, Guid businessId)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Cta) // if CTA is stored in a separate table
                .Include(c => c.MultiButtons) // assuming EF Core relation
                .FirstOrDefaultAsync(c => c.Id == campaignId && c.BusinessId == businessId);

            if (campaign == null) return null;

            return new CampaignDto
            {
                Id = campaign.Id,
                Name = campaign.Name,
                MessageTemplate = campaign.MessageTemplate,
                MessageBody = campaign.MessageBody,
                TemplateId = campaign.TemplateId,
                CampaignType = campaign.CampaignType,
                Status = campaign.Status,
                ImageUrl = campaign.ImageUrl,
                ImageCaption = campaign.ImageCaption,
                CreatedAt = campaign.CreatedAt,
                ScheduledAt = campaign.ScheduledAt,
                CtaId = campaign.CtaId,
                Cta = campaign.Cta == null ? null : new CtaPreviewDto
                {
                    Title = campaign.Cta.Title,
                    ButtonText = campaign.Cta.ButtonText
                },
                MultiButtons = campaign.MultiButtons?
                    .Select(b => new CampaignButtonDto
                    {
                        ButtonText = b.Title,// ButtonText,
                        ButtonType = b.Type,//ButtonType,
                        TargetUrl = b.Value
                    }).ToList() ?? new List<CampaignButtonDto>()
            };
        }

        public async Task<List<CampaignSummaryDto>> GetAllCampaignsAsync(Guid businessId, string? type = null)
        {
            var query = _context.Campaigns
                .Where(c => c.BusinessId == businessId)
                .AsQueryable();

            if (!string.IsNullOrEmpty(type))
                query = query.Where(c => c.CampaignType == type);

            return await query
                .OrderByDescending(c => c.CreatedAt)
                .Select(c => new CampaignSummaryDto
                {
                    Id = c.Id,
                    Name = c.Name,
                    Status = c.Status,
                    ScheduledAt = c.ScheduledAt,
                    CreatedAt = c.CreatedAt,
                    ImageUrl = c.ImageUrl,            // ✅ Now mapped
                    ImageCaption = c.ImageCaption,    // ✅ Now mapped
                    CtaTitle = c.Cta != null ? c.Cta.Title : null,  // optional
                    RecipientCount = c.Recipients.Count()
                })
                .ToListAsync();
        }

        public async Task<List<ContactDto>> GetRecipientsByCampaignIdAsync(Guid campaignId, Guid businessId)
        {
            var recipients = await _context.CampaignRecipients
                .Include(r => r.Contact)
                .Where(r => r.CampaignId == campaignId && r.Contact.BusinessId == businessId)
                .Select(r => new ContactDto
                {
                    Id = r.Contact.Id,
                    Name = r.Contact.Name,
                    PhoneNumber = r.Contact.PhoneNumber,
                    Email = r.Contact.Email,
                    LeadSource = r.Contact.LeadSource,
                    CreatedAt = r.Contact.CreatedAt
                })
                .ToListAsync();

            return recipients;
        }

        public async Task<PaginatedResponse<CampaignSummaryDto>> GetPaginatedCampaignsAsync(Guid businessId, PaginatedRequest request)
        {
            var query = _context.Campaigns
                .Where(c => c.BusinessId == businessId)
                .OrderByDescending(c => c.CreatedAt);

            var total = await query.CountAsync();

            var items = await query
                .Skip((request.Page - 1) * request.PageSize)
                .Take(request.PageSize)
                .Select(c => new CampaignSummaryDto
                {
                    Id = c.Id,
                    Name = c.Name,
                    Status = c.Status,
                    ScheduledAt = c.ScheduledAt,
                    CreatedAt = c.CreatedAt
                })
                .ToListAsync();

            return new PaginatedResponse<CampaignSummaryDto>
            {
                Items = items,
                TotalCount = total,
                Page = request.Page,
                PageSize = request.PageSize
            };
        }
        public async Task<bool> UpdateCampaignAsync(Guid id, CampaignCreateDto dto)
        {
            var campaign = await _context.Campaigns.FindAsync(id);
            if (campaign == null || campaign.Status != "Draft")
                return false;

            // ✅ Extract BusinessId from current campaign
            var businessId = campaign.BusinessId;

            // ✅ Optional CTA ownership validation
            if (dto.CtaId.HasValue)
            {
                var cta = await _context.CTADefinitions
                    .FirstOrDefaultAsync(c => c.Id == dto.CtaId && c.BusinessId == businessId && c.IsActive);

                if (cta == null)
                    throw new UnauthorizedAccessException("❌ The selected CTA does not belong to your business or is inactive.");
            }

            // ✏️ Update campaign fields
            campaign.Name = dto.Name;
            campaign.MessageTemplate = dto.MessageTemplate;
            campaign.TemplateId = dto.TemplateId;
            campaign.FollowUpTemplateId = dto.FollowUpTemplateId;
            campaign.CampaignType = dto.CampaignType;
            campaign.CtaId = dto.CtaId;
            campaign.ImageUrl = dto.ImageUrl;
            campaign.ImageCaption = dto.ImageCaption;
            campaign.UpdatedAt = DateTime.UtcNow;

            await _context.SaveChangesAsync();
            return true;
        }

        public async Task<bool> DeleteCampaignAsync(Guid id)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Recipients)
                .FirstOrDefaultAsync(c => c.Id == id);

            if (campaign == null || campaign.Status != "Draft")
                return false;

            _context.CampaignRecipients.RemoveRange(campaign.Recipients);
            _context.Campaigns.Remove(campaign);

            await _context.SaveChangesAsync();
            Log.Information("🗑️ Campaign deleted: {Id}", id);
            return true;
        }

        #endregion

        #region // 🆕 CreateCampaignAsync(Text/Image)
        public async Task<Guid?> CreateTextCampaignAsync(CampaignCreateDto dto, Guid businessId, string createdBy)
        {
            try
            {
                var campaignId = Guid.NewGuid();

                // 🔁 Parse template parameters into list
                var parsedParams = TemplateParameterHelper.ParseTemplateParams(
                    JsonConvert.SerializeObject(dto.TemplateParameters ?? new List<string>())
                );

                // 🧠 Fetch template (for body + buttons)
                var template = await _templateFetcherService.GetTemplateByNameAsync(businessId, dto.TemplateId, true);

                // 🧠 Fill message body
                var resolvedBody = TemplateParameterHelper.FillPlaceholders(
                    template?.Body ?? dto.MessageTemplate,
                    parsedParams
                );

                // ✅ Step 1: Create campaign object
                var campaign = new Campaign
                {
                    Id = campaignId,
                    BusinessId = businessId,
                    Name = dto.Name,
                    MessageTemplate = dto.MessageTemplate,
                    TemplateId = dto.TemplateId,
                    FollowUpTemplateId = dto.FollowUpTemplateId,
                    CampaignType = dto.CampaignType ?? "text",
                    CtaId = dto.CtaId,
                    ScheduledAt = dto.ScheduledAt,
                    CreatedBy = createdBy,
                    CreatedAt = DateTime.UtcNow,
                    UpdatedAt = DateTime.UtcNow,
                    Status = "Draft",
                    ImageUrl = dto.ImageUrl,
                    ImageCaption = dto.ImageCaption,
                    TemplateParameters = JsonConvert.SerializeObject(dto.TemplateParameters ?? new List<string>()),
                    MessageBody = resolvedBody // ✅ final resolved message
                };

                await _context.Campaigns.AddAsync(campaign);

                // ✅ Step 2: Assign contacts if provided
                if (dto.ContactIds != null && dto.ContactIds.Any())
                {
                    var recipients = dto.ContactIds.Select(contactId => new CampaignRecipient
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaignId,
                        ContactId = contactId,
                        BusinessId = businessId,
                        Status = "Pending",
                        SentAt = DateTime.UtcNow,
                        UpdatedAt = DateTime.UtcNow
                    });

                    await _context.CampaignRecipients.AddRangeAsync(recipients);
                }

                // ✅ Step 3a: Save manual buttons from frontend
                if (dto.MultiButtons != null && dto.MultiButtons.Any())
                {
                    var buttons = dto.MultiButtons
                        .Where(btn => !string.IsNullOrWhiteSpace(btn.ButtonText) && !string.IsNullOrWhiteSpace(btn.TargetUrl))
                        .Take(3)
                        .Select((btn, index) => new CampaignButton
                        {
                            Id = Guid.NewGuid(),
                            CampaignId = campaignId,
                            Title = btn.ButtonText,
                            Type = btn.ButtonType ?? "url",
                            Value = btn.TargetUrl,
                            Position = index + 1,
                            IsFromTemplate = false
                        });

                    await _context.CampaignButtons.AddRangeAsync(buttons);
                }

                // ✅ Step 3b: Save buttons auto-fetched from WhatsApp Template
                if (template != null && template.ButtonParams?.Count > 0)
                {
                    var autoButtons = template.ButtonParams
                        .Take(3)
                        .Select((btn, index) => new CampaignButton
                        {
                            Id = Guid.NewGuid(),
                            CampaignId = campaignId,
                            Title = btn.Text,
                            Type = btn.Type,
                            // Value = btn.SubType == "url" ? "https://your-redirect.com" : btn.SubType,
                            Value = btn.ParameterValue,
                            Position = index + 1,
                            IsFromTemplate = true
                        });

                    await _context.CampaignButtons.AddRangeAsync(autoButtons);
                }

                // ✅ Final Save
                await _context.SaveChangesAsync();

                Log.Information("✅ Campaign '{Name}' created with {Contacts} recipients, {ManualButtons} user buttons, {TemplateButtons} template buttons and {Params} template parameters",
                    dto.Name,
                    dto.ContactIds?.Count ?? 0,
                    dto.MultiButtons?.Count ?? 0,
                    template?.ButtonParams?.Count ?? 0,
                    dto.TemplateParameters?.Count ?? 0
                );

                return campaignId;
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to create campaign");
                return null;
            }
        }
        public async Task<Guid> CreateImageCampaignAsync(Guid businessId, CampaignCreateDto dto, string createdBy)
        {
            // 🔐 Optional CTA validation
            if (dto.CtaId.HasValue)
            {
                var cta = await _context.CTADefinitions
                    .FirstOrDefaultAsync(c => c.Id == dto.CtaId && c.BusinessId == businessId && c.IsActive);

                if (cta == null)
                    throw new UnauthorizedAccessException("❌ The selected CTA does not belong to your business or is inactive.");
            }

            // 🎯 Create campaign
            var campaign = new Campaign
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                Name = dto.Name,
                MessageTemplate = dto.MessageTemplate,
                TemplateId = dto.TemplateId,
                FollowUpTemplateId = dto.FollowUpTemplateId,
                CampaignType = "image",
                ImageUrl = dto.ImageUrl,
                ImageCaption = dto.ImageCaption,
                CtaId = dto.CtaId,
                CreatedBy = createdBy,
                CreatedAt = DateTime.UtcNow,
                UpdatedAt = DateTime.UtcNow,
                Status = "Draft"
            };

            await _context.Campaigns.AddAsync(campaign);

            // 🔘 Save manual buttons from UI
            if (dto.MultiButtons?.Any() == true)
            {
                var buttons = dto.MultiButtons
                    .Where(btn => !string.IsNullOrWhiteSpace(btn.ButtonText) && !string.IsNullOrWhiteSpace(btn.TargetUrl))
                    .Take(3)
                    .Select((btn, index) => new CampaignButton
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaign.Id,
                        Title = btn.ButtonText,
                        Type = string.IsNullOrWhiteSpace(btn.ButtonType) ? "url" : btn.ButtonType,
                        Value = btn.TargetUrl,
                        Position = index + 1,
                        IsFromTemplate = false
                    }).ToList();

                if (buttons.Any())
                    await _context.CampaignButtons.AddRangeAsync(buttons);
            }

            // 🔘 Save template buttons (from Meta) with proper dynamic/static handling
            if (dto.ButtonParams?.Any() == true)
            {
                var templateButtons = dto.ButtonParams
                    .Where(btn => !string.IsNullOrWhiteSpace(btn.Text) && !string.IsNullOrWhiteSpace(btn.Type))
                    .Take(3)
                    .Select((btn, index) =>
                    {
                        var subType = btn.SubType?.ToLower();
                        var isDynamic = subType == "url" || subType == "flow" || subType == "copy_code";

                        // ✅ Prefer user-provided value if dynamic, fallback to Meta value
                        var userInput = dto.MultiButtons?.ElementAtOrDefault(index)?.TargetUrl?.Trim();
                        var valueToSave = isDynamic && !string.IsNullOrWhiteSpace(userInput)
                            ? userInput
                            : btn.Value;

                        return new CampaignButton
                        {
                            Id = Guid.NewGuid(),
                            CampaignId = campaign.Id,
                            Title = btn.Text,
                            Type = btn.Type,
                            Value = valueToSave,
                            Position = index + 1,
                            IsFromTemplate = true
                        };
                    })
                    .Where(btn => !string.IsNullOrWhiteSpace(btn.Value)) // ✅ Prevent null insert error
                    .ToList();

                if (templateButtons.Any())
                    await _context.CampaignButtons.AddRangeAsync(templateButtons);
            }

            await _context.SaveChangesAsync();
            return campaign.Id;
        }
        #endregion

        public async Task<bool> SendCampaignAsync(Guid campaignId, string ipAddress, string userAgent)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Recipients)
                .ThenInclude(r => r.Contact)
                .FirstOrDefaultAsync(c => c.Id == campaignId);

            if (campaign == null || campaign.Recipients.Count == 0)
            {
                Log.Warning("🚫 Campaign not found or has no recipients");
                return false;
            }

            campaign.Status = "Sending";
            campaign.UpdatedAt = DateTime.UtcNow;
            await _context.SaveChangesAsync();

            int throttleLimit = 5;

            await Parallel.ForEachAsync(campaign.Recipients, new ParallelOptions { MaxDegreeOfParallelism = throttleLimit }, async (recipient, ct) =>
            {
                try
                {
                    using var scope = _serviceProvider.CreateScope();
                    var scopedDb = scope.ServiceProvider.GetRequiredService<AppDbContext>();

                    // 🟢 Use SimpleTemplateMessageDto instead of raw text
                    var dto = new SimpleTemplateMessageDto
                    {
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        TemplateName = campaign.MessageTemplate,
                        TemplateParameters = new List<string> { recipient.Contact.Name ?? "Customer" }
                    };

                    var result = await _messageEngineService.SendTemplateMessageSimpleAsync(campaign.BusinessId, dto);

                    var sendLog = new CampaignSendLog
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaign.Id,
                        ContactId = recipient.ContactId,
                        RecipientId = recipient.Id,
                        TemplateId = campaign.TemplateId,
                        MessageBody = campaign.MessageTemplate,
                        MessageId = null,
                        SendStatus = result.Success ? "Sent" : "Failed",
                        ErrorMessage = result.Message,
                        SentAt = DateTime.UtcNow,
                        CreatedAt = DateTime.UtcNow,
                        SourceChannel = "whatsapp",
                        IpAddress = ipAddress,
                        DeviceInfo = userAgent
                    };

                    scopedDb.CampaignSendLogs.Add(sendLog);

                    var recipientToUpdate = await scopedDb.CampaignRecipients.FirstOrDefaultAsync(r => r.Id == recipient.Id);
                    if (recipientToUpdate != null)
                    {
                        recipientToUpdate.Status = result.Success ? "Sent" : "Failed";
                        recipientToUpdate.MessagePreview = campaign.MessageTemplate;
                        recipientToUpdate.SentAt = DateTime.UtcNow;
                        recipientToUpdate.UpdatedAt = DateTime.UtcNow;
                    }

                    await scopedDb.SaveChangesAsync();
                }
                catch (Exception ex)
                {
                    Log.Error(ex, "❌ Send failed for recipient: {RecipientId}", recipient.Id);
                }
            });

            campaign.Status = "Sent";
            campaign.UpdatedAt = DateTime.UtcNow;
            await _context.SaveChangesAsync();

            Log.Information("📤 Campaign {CampaignId} sent via template to {Count} recipients", campaign.Id, campaign.Recipients.Count);
            return true;
        }
        public async Task<bool> SendCampaignInParallelAsync(Guid campaignId, string ipAddress, string userAgent)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Recipients)
                .ThenInclude(r => r.Contact)
                .FirstOrDefaultAsync(c => c.Id == campaignId);

            if (campaign == null || campaign.Recipients.Count == 0)
            {
                Log.Warning("🚫 Campaign not found or has no recipients");
                return false;
            }

            campaign.Status = "Sending";
            campaign.UpdatedAt = DateTime.UtcNow;
            await _context.SaveChangesAsync();

            int maxParallelism = 5;

#if NET6_0_OR_GREATER
            await Parallel.ForEachAsync(campaign.Recipients, new ParallelOptions
            {
                MaxDegreeOfParallelism = maxParallelism
            },
            async (recipient, cancellationToken) =>
            {
                await SendToRecipientAsync(campaign, recipient, ipAddress, userAgent);
            });
#else
    var tasks = campaign.Recipients.Select(recipient =>
        SendToRecipientAsync(campaign, recipient, ipAddress, userAgent)
    );
    await Task.WhenAll(tasks);
#endif

            campaign.Status = "Sent";
            campaign.UpdatedAt = DateTime.UtcNow;
            await _context.SaveChangesAsync();

            Log.Information("📤 Campaign {CampaignId} sent in parallel to {Count} recipients", campaign.Id, campaign.Recipients.Count);
            return true;
        }
        private async Task SendToRecipientAsync(Campaign campaign, CampaignRecipient recipient, string ip, string ua)
        {
            try
            {
                var dto = new SimpleTemplateMessageDto
                {
                    RecipientNumber = recipient.Contact.PhoneNumber,
                    TemplateName = campaign.MessageTemplate,
                    TemplateParameters = new List<string> { recipient.Contact.Name ?? "Customer" }
                };

                var result = await _messageEngineService.SendTemplateMessageSimpleAsync(campaign.BusinessId, dto);


                var log = new CampaignSendLog
                {
                    Id = Guid.NewGuid(),
                    CampaignId = campaign.Id,
                    ContactId = recipient.ContactId,
                    RecipientId = recipient.Id,
                    TemplateId = campaign.TemplateId,
                    MessageBody = campaign.MessageTemplate,
                    MessageId = null,
                    SendStatus = result.Success ? "Sent" : "Failed",
                    ErrorMessage = result.Message,
                    SentAt = DateTime.UtcNow,
                    CreatedAt = DateTime.UtcNow,
                    SourceChannel = "whatsapp",
                    IpAddress = ip,
                    DeviceInfo = ua
                };

                lock (_context)
                {
                    _context.CampaignSendLogs.Add(log);
                    recipient.Status = result.Success ? "Sent" : "Failed";
                    recipient.MessagePreview = campaign.MessageTemplate;
                    recipient.SentAt = DateTime.UtcNow;
                    recipient.UpdatedAt = DateTime.UtcNow;
                }

                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to send template to recipient: {RecipientId}", recipient.Id);
            }
        }

        public async Task<bool> RemoveRecipientAsync(Guid businessId, Guid campaignId, Guid contactId)
        {
            var entry = await _context.CampaignRecipients
                .FirstOrDefaultAsync(r =>
                    r.CampaignId == campaignId &&
                    r.ContactId == contactId &&
                    r.Campaign.BusinessId == businessId); // ✅ Filter by related Campaign.BusinessId

            if (entry == null)
                return false;

            _context.CampaignRecipients.Remove(entry);
            await _context.SaveChangesAsync();
            return true;
        }

        public async Task<bool> AssignContactsToCampaignAsync(Guid campaignId, Guid businessId, List<Guid> contactIds)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Recipients)
                .FirstOrDefaultAsync(c => c.Id == campaignId && c.BusinessId == businessId);

            if (campaign == null)
                return false;

            var newRecipients = contactIds.Select(id => new CampaignRecipient
            {
                Id = Guid.NewGuid(),
                CampaignId = campaignId,
                ContactId = id,
                BusinessId = businessId,
                Status = "Pending",
                SentAt = DateTime.UtcNow,
                UpdatedAt = DateTime.UtcNow
            });

            _context.CampaignRecipients.AddRange(newRecipients);
            await _context.SaveChangesAsync();
            return true;
        }
        public async Task<ResponseResult> SendTemplateCampaignAsync(Guid campaignId)
        {
            try
            {
                var campaign = await _context.Campaigns
                    .Include(c => c.Recipients)
                        .ThenInclude(r => r.Contact) // 🧠 include contact details
                    .Include(c => c.MultiButtons)
                    .FirstOrDefaultAsync(c => c.Id == campaignId && !c.IsDeleted);

                if (campaign == null)
                    return ResponseResult.ErrorInfo("❌ Campaign not found.");

                if (campaign.Recipients == null || !campaign.Recipients.Any())
                    return ResponseResult.ErrorInfo("❌ No recipients assigned to this campaign.");

                var templateName = campaign.MessageTemplate;
                var templateId = campaign.TemplateId;
                var language = "en_US"; // Optional: make dynamic later
                var isImageTemplate = !string.IsNullOrEmpty(campaign.ImageUrl);

                var templateParams = JsonConvert.DeserializeObject<List<string>>(campaign.TemplateParameters ?? "[]");

                int success = 0, failed = 0;

                foreach (var recipient in campaign.Recipients)
                {
                    var messageDto = new ImageTemplateMessageDto
                    {
                       // BusinessId = campaign.BusinessId,
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        TemplateName = templateName,
                        LanguageCode = language,
                        HeaderImageUrl = isImageTemplate ? campaign.ImageUrl : null,
                        TemplateParameters = templateParams,
                        ButtonParameters = campaign.MultiButtons
                            .OrderBy(b => b.Position)
                            .Take(3)
                            .Select(btn => new CampaignButtonDto
                            {
                                ButtonText = btn.Title,
                                ButtonType = btn.Type,
                                TargetUrl = btn.Value
                            }).ToList()
                    };

                    // ✅ Call the image/template sender
                    var sendResult = await _messageEngineService.SendImageTemplateMessageAsync(messageDto, campaign.BusinessId);
                    var isSuccess = sendResult.ToString().ToLower().Contains("messages");

                    var log = new MessageLog
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = campaign.BusinessId,
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        MessageContent = templateName,
                        MediaUrl = campaign.ImageUrl,
                        Status = isSuccess ? "Sent" : "Failed",
                        ErrorMessage = isSuccess ? null : "API Failure",
                        RawResponse = JsonConvert.SerializeObject(sendResult),
                        CreatedAt = DateTime.UtcNow,
                        SentAt = DateTime.UtcNow
                    };

                    await _context.MessageLogs.AddAsync(log);

                    if (isSuccess) success++;
                    else failed++;
                }

                await _context.SaveChangesAsync();
                return ResponseResult.SuccessInfo($"✅ Sent: {success}, ❌ Failed: {failed}");
            }
            catch (Exception ex)
            {
                return ResponseResult.ErrorInfo("❌ Unexpected error during campaign send.", ex.ToString());
            }
        }

        #region  This region include all the code related to sending text and image based

        // Detection - which type of campaign to send (text based or Image based)
        public async Task<ResponseResult> SendTemplateCampaignWithTypeDetectionAsync(Guid campaignId)
        {
            var campaign = await _context.Campaigns
                .Include(c => c.Recipients)
                    .ThenInclude(r => r.Contact)
                .Include(c => c.MultiButtons)
                .FirstOrDefaultAsync(c => c.Id == campaignId && !c.IsDeleted);

            if (campaign == null)
                return ResponseResult.ErrorInfo("❌ Campaign not found.");

            // Template Type Detection
            return campaign.CampaignType?.ToLower() switch
            {
                "text" => await SendTextTemplateCampaignAsync(campaign),
                "image" => await SendImageTemplateCampaignAsync(campaign),
                _ => ResponseResult.ErrorInfo("❌ Unsupported campaign type.")
            };
        }

        // This is used for "Text" based campaigns sending
        public async Task<ResponseResult> SendTextTemplateCampaignAsync(Campaign campaign)
        {
            try
            {
                if (campaign == null || campaign.IsDeleted)
                {
                    Log.Warning("❌ Campaign is null or marked as deleted.");
                    return ResponseResult.ErrorInfo("❌ Invalid campaign.");
                }

                if (campaign.Recipients == null || !campaign.Recipients.Any())
                {
                    Log.Warning("⚠️ Campaign has no assigned recipients.");
                    return ResponseResult.ErrorInfo("⚠️ No recipients assigned to this campaign.");
                }

                var businessId = campaign.BusinessId;
                var templateName = campaign.TemplateId;
                var templateParams = TemplateParameterHelper.ParseTemplateParams(campaign.TemplateParameters);
                var buttons = campaign.MultiButtons?.ToList();

                // ✅ Fetch WhatsApp template metadata
                var templateMeta = await _templateFetcherService.GetTemplateByNameAsync(businessId, templateName, includeButtons: true);
                if (templateMeta == null)
                {
                    Log.Error("❌ Could not fetch template metadata for {Template}.", templateName);
                    return ResponseResult.ErrorInfo("Template metadata not found.");
                }

                if (templateParams.Count != templateMeta.PlaceholderCount)
                {
                    Log.Warning("⚠️ Template expects {Expected} body parameters but received {Actual}.",
                        templateMeta.PlaceholderCount, templateParams.Count);
                }

                int successCount = 0, failureCount = 0;

                foreach (var recipient in campaign.Recipients)
                {
                    if (recipient?.Contact == null)
                    {
                        Log.Warning("⚠️ Skipping recipient: recipient or contact is null. Recipient ID: {RecipientId}", recipient?.Id);
                        continue;
                    }

                    Log.Information("📨 Preparing to send to {Phone}", recipient.Contact.PhoneNumber);

                    var components = BuildTextTemplateComponents(templateParams, buttons, templateMeta);

                    var payload = new
                    {
                        messaging_product = "whatsapp",
                        to = recipient.Contact.PhoneNumber,
                        type = "template",
                        template = new
                        {
                            name = templateName,
                            language = new { code = templateMeta.Language ?? "en_US" },
                            components = components
                        }
                    };

                    Log.Debug("📦 WhatsApp Payload:\n{Payload}", JsonConvert.SerializeObject(payload, Formatting.Indented));

                    ResponseResult sendResult = await _messageEngineService.SendToWhatsAppAsync(payload, businessId);
                    Log.Information("📬 Send result: {Result}", JsonConvert.SerializeObject(sendResult));

                    var messageLog = new MessageLog
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        CampaignId = campaign.Id,
                        ContactId = recipient.ContactId,
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        MessageContent = campaign.MessageTemplate ?? templateName,
                        Status = sendResult.Success ? "Sent" : "Failed",
                        MessageId = sendResult.MessageId,
                        ErrorMessage = sendResult.ErrorMessage,
                        RawResponse = sendResult.RawResponse,
                        CreatedAt = DateTime.UtcNow,
                        SentAt = sendResult.Success ? DateTime.UtcNow : null
                    };

                    await _context.MessageLogs.AddAsync(messageLog);
                    Log.Information("✅ Added MessageLog for {Recipient}", recipient.Contact.PhoneNumber);

                    await _context.CampaignSendLogs.AddAsync(new CampaignSendLog
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaign.Id,
                        ContactId = recipient.ContactId,
                        RecipientId = recipient.Id,
                        MessageBody = campaign.MessageBody ?? templateName,
                        TemplateId = templateName,
                        SendStatus = sendResult.Success ? "Sent" : "Failed",
                        MessageLogId = messageLog.Id,
                        MessageId = sendResult.MessageId,
                        CreatedAt = DateTime.UtcNow,
                        SentAt = DateTime.UtcNow,
                        CreatedBy = campaign.CreatedBy
                    });

                    Log.Information("📘 Added CampaignSendLog for recipient {Recipient}", recipient.Id);

                    if (sendResult.Success) successCount++;
                    else failureCount++;
                }

                Log.Information("💾 Saving all DB changes...");
                await _context.SaveChangesAsync();
                Log.Information("✅ All saved successfully.");

                return ResponseResult.SuccessInfo($"📤 Sent to {successCount} contacts. ❌ Failed for {failureCount}.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error while sending text template campaign");
                return ResponseResult.ErrorInfo("🚨 Unexpected error while sending campaign.", ex.ToString());
            }
        }

        private List<object> BuildTextTemplateComponents(List<string> templateParams, List<CampaignButton>? buttonList, TemplateMetadataDto templateMeta)
        {
            var components = new List<object>();

            // ✅ 1. Optional Header
            if (templateMeta.HasImageHeader)
            {
                Log.Information("ℹ️ Header detected, but skipping image as it's a text template.");
                // If you ever support header text, you can handle here
            }

            // ✅ 2. Body parameters
            if (templateParams != null && templateParams.Count > 0)
            {
                components.Add(new
                {
                    type = "body",
                    parameters = templateParams.Select(p => new
                    {
                        type = "text",
                        text = p
                    }).ToArray()
                });
            }
            else if (templateMeta.PlaceholderCount > 0)
            {
                Log.Warning("⚠️ Body params missing but template expects {Count} placeholders.", templateMeta.PlaceholderCount);
            }

            // ✅ 3. Footer (optional, static — Meta doesn’t accept dynamic footer
            // ly)
            // If you want to support footer with text later, it can go like this:
            // components.Add(new { type = "footer", parameters = new[] { new { type = "text", text = "Your footer text" } } });

            // ✅ 4. Buttons
            if (buttonList != null && buttonList.Any())
            {
                for (int i = 0; i < buttonList.Count && i < templateMeta.ButtonParams.Count; i++)
                {
                    var btn = buttonList[i];
                    var meta = templateMeta.ButtonParams[i];

                    string index = i.ToString();
                    string subtype = meta.SubType?.ToLower() ?? "url";
                    string? value = btn.Value?.Trim();
                    string? metaParam = meta.ParameterValue?.Trim();

                    // 🔍 Determine if this is a dynamic param (contains {{}})
                    bool isDynamic = metaParam != null && metaParam.Contains("{{");

                    // ✅ Skip entire button if static and no dynamic value
                    if (!isDynamic)
                    {
                        Log.Information("⏩ Skipping static button '{Title}' as it requires no parameters", btn.Title);
                        continue;
                    }

                    var paramType = subtype switch
                    {
                        "url" => "text",
                        "copy_code" => "coupon_code",
                        "phone_number" => "phone_number",
                        "flow" => "flow_id",
                        _ => "text"
                    };

                    var buttonPayload = new Dictionary<string, object>
        {
                        { "type", "button" },
                        { "sub_type", subtype },
                        { "index", index },
                        { "parameters", new[] {
                            new Dictionary<string, object>
                            {
                                { "type", paramType },
                                { paramType, value }
                            }
                        }}
                    };

                    components.Add(buttonPayload);
                }

            }

            return components;
        }


        // This is used for "Image" based campaigns sending
        public async Task<ResponseResult> SendImageTemplateCampaignAsync(Campaign campaign)
        {
            try
            {
                if (campaign == null || campaign.IsDeleted)
                {
                    Log.Warning("❌ Campaign is null or marked as deleted.");
                    return ResponseResult.ErrorInfo("❌ Invalid campaign.");
                }

                if (campaign.Recipients == null || !campaign.Recipients.Any())
                {
                    Log.Warning("⚠️ Campaign has no assigned recipients.");
                    return ResponseResult.ErrorInfo("⚠️ No recipients assigned to this campaign.");
                }

                var businessId = campaign.BusinessId;
                var templateName = campaign.TemplateId;
                var imageUrl = campaign.ImageUrl;
                var templateParams = TemplateParameterHelper.ParseTemplateParams(campaign.TemplateParameters);
                var buttons = campaign.MultiButtons?.ToList();

                var templateMeta = await _templateFetcherService.GetTemplateByNameAsync(businessId, templateName, includeButtons: true);
                if (templateMeta == null)
                {
                    Log.Error("❌ Could not fetch template metadata for {Template}.", templateName);
                    return ResponseResult.ErrorInfo("Template metadata not found.");
                }

                if (templateParams.Count != templateMeta.PlaceholderCount)
                {
                    Log.Warning("⚠️ Template expects {Expected} body parameters but received {Actual}.",
                        templateMeta.PlaceholderCount, templateParams.Count);
                }

                int successCount = 0, failureCount = 0;

                foreach (var recipient in campaign.Recipients)
                {
                    if (recipient?.Contact == null)
                    {
                        Log.Warning("⚠️ Skipping recipient: recipient or contact is null. Recipient ID: {RecipientId}", recipient?.Id);
                        continue;
                    }

                    Log.Information("📨 Preparing to send to {Phone}", recipient.Contact.PhoneNumber);

                    var components = BuildImageTemplateComponents(templateParams, imageUrl, buttons, templateMeta);

                    var payload = new
                    {
                        messaging_product = "whatsapp",
                        to = recipient.Contact.PhoneNumber,
                        type = "template",
                        template = new
                        {
                            name = templateName,
                            language = new { code = "en_US" },
                            components = components
                        }
                    };

                    Log.Debug("📦 Final WhatsApp Payload:\n{Payload}", JsonConvert.SerializeObject(payload, Formatting.Indented));

                    var sendResult = await _messageEngineService.SendToWhatsAppAsync(payload, businessId);
                    Log.Information("📬 Send result: {Result}", JsonConvert.SerializeObject(sendResult));

                    var messageLog = new MessageLog
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        CampaignId = campaign.Id,
                        ContactId = recipient.ContactId,
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        MessageContent = campaign.MessageTemplate ?? templateName,
                        MediaUrl = imageUrl,
                        Status = sendResult.Success ? "Sent" : "Failed",
                        MessageId = sendResult.MessageId,
                        ErrorMessage = sendResult.ErrorMessage,
                        RawResponse = sendResult.RawResponse,
                        CreatedAt = DateTime.UtcNow,
                        SentAt = sendResult.Success ? DateTime.UtcNow : null
                    };

                    await _context.MessageLogs.AddAsync(messageLog);
                    Log.Information("📥 MessageLog saved for {Recipient}", recipient.Contact.PhoneNumber);

                    await _context.CampaignSendLogs.AddAsync(new CampaignSendLog
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaign.Id,
                        BusinessId = businessId,
                        ContactId = recipient.ContactId,
                        RecipientId = recipient.Id,
                        MessageBody = campaign.MessageBody ?? templateName,
                        TemplateId = templateName,
                        SendStatus = sendResult.Success ? "Sent" : "Failed",
                        MessageLogId = messageLog.Id,
                        MessageId = sendResult.MessageId,
                        CreatedAt = DateTime.UtcNow,
                        SentAt = DateTime.UtcNow,
                        CreatedBy = campaign.CreatedBy
                    });

                    Log.Information("🗃️ CampaignSendLog saved for recipient {Recipient}", recipient.Id);

                    if (sendResult.Success) successCount++;
                    else failureCount++;
                }

                Log.Information("💾 Saving all DB changes...");
                await _context.SaveChangesAsync();
                Log.Information("✅ All saved successfully.");

                return ResponseResult.SuccessInfo($"📤 Sent to {successCount} contacts. ❌ Failed for {failureCount}.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error while sending image template campaign");
                return ResponseResult.ErrorInfo("🚨 Unexpected error while sending campaign.", ex.ToString());
            }
        }

        private List<object> BuildImageTemplateComponents(List<string> templateParams, string? imageUrl, List<CampaignButton>? buttonList, TemplateMetadataDto templateMeta)
        {
            var components = new List<object>();

            // ✅ 1. Header image
            if (!string.IsNullOrWhiteSpace(imageUrl) && templateMeta.HasImageHeader)
            {
                components.Add(new
                {
                    type = "header",
                    parameters = new[]
                    {
                new
                {
                    type = "image",
                    image = new { link = imageUrl }
                }
            }
                });
            }

            // ✅ 2. Body parameters
            if (templateParams != null && templateParams.Count > 0)
            {
                components.Add(new
                {
                    type = "body",
                    parameters = templateParams.Select(p => new
                    {
                        type = "text",
                        text = p
                    }).ToArray()
                });
            }
            else if (templateMeta.PlaceholderCount > 0)
            {
                Log.Warning("⚠️ Body params missing but template expects {Count} placeholders.", templateMeta.PlaceholderCount);
            }

            // ✅ 3. Buttons with logic to exclude parameters for static values
            if (buttonList != null && buttonList.Any())
            {
                for (int i = 0; i < buttonList.Count && i < templateMeta.ButtonParams.Count; i++)
                {
                    var btn = buttonList[i];
                    var meta = templateMeta.ButtonParams[i];

                    string index = i.ToString();
                    string subtype = meta.SubType?.ToLower() ?? "url";
                    string? value = btn.Value?.Trim();
                    string? metaParam = meta.ParameterValue?.Trim();

                    var buttonPayload = new Dictionary<string, object>
            {
                { "type", "button" },
                { "sub_type", subtype },
                { "index", index }
            };

                    // 🔍 Determine if this is a dynamic param (contains {{}})
                    bool isDynamic = metaParam != null && metaParam.Contains("{{");

                    // ✅ Only add parameters for dynamic types
                    if (isDynamic && !string.IsNullOrWhiteSpace(value))
                    {
                        var paramType = subtype switch
                        {
                            "url" => "text",
                            "copy_code" => "coupon_code",
                            "phone_number" => "phone_number",
                            "flow" => "flow_id",
                            _ => "text"
                        };

                        buttonPayload["parameters"] = new[]
                        {
                    new Dictionary<string, object>
                    {
                        { "type", paramType },
                        { paramType, value }
                    }
                };
                    }
                    else
                    {
                        Log.Information("ℹ️ Skipping parameters for static button '{Title}' ({SubType})", btn.Title, subtype);
                    }

                    components.Add(buttonPayload);
                }
            }

            return components;
        }

        #endregion
    }

}

``n
--- file: xbytechat-api/Features/CampaignModule/Services/ICampaignRecipientService.cs  (sha256:a2bb5bdb9f8a87dc2436bac017a79dc02ec48bdc1fd425cb6c701807234d4dd3)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignModule.DTOs;

namespace xbytechat.api.Features.CampaignModule.Services
{
    public interface ICampaignRecipientService
    {
        Task<CampaignRecipientDto> GetByIdAsync(Guid id);
        Task<List<CampaignRecipientDto>> GetByCampaignIdAsync(Guid campaignId);

        Task<bool> UpdateStatusAsync(Guid recipientId, string newStatus);
        Task<bool> TrackReplyAsync(Guid recipientId, string replyText);
        Task<List<CampaignRecipientDto>> SearchRecipientsAsync(string status = null, string keyword = null);

        Task AssignContactsToCampaignAsync(Guid campaignId, List<Guid> contactIds);
    }
}


``n
--- file: xbytechat-api/Features/CampaignModule/Services/ICampaignService.cs  (sha256:3f7e9d437d20cfd11c29d59b006d22a3c7c2b82f1f9af986a537fbf8941c6a4e)
`$lang
using System;
using System.Threading.Tasks;
using System.Collections.Generic;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Shared;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.Helpers;
using xbytechat.api.Features.CampaignModule.Models;

namespace xbytechat.api.Features.CampaignModule.Services
{
    public interface ICampaignService
    {
        /// 🆕 Create a new campaign with recipients
        Task<Guid?> CreateTextCampaignAsync(CampaignCreateDto dto, Guid businessId, string createdBy);

        /// ✏️ Update an existing draft campaign
        Task<bool> UpdateCampaignAsync(Guid id, CampaignCreateDto dto);

        /// 🗑️ Soft-delete a draft campaign
        Task<bool> DeleteCampaignAsync(Guid id);

        /// 📋 Get all campaigns for the business
        Task<List<CampaignSummaryDto>> GetAllCampaignsAsync(Guid businessId);

        /// 📄 Get paginated campaigns
        Task<PaginatedResponse<CampaignSummaryDto>> GetPaginatedCampaignsAsync(Guid businessId, PaginatedRequest request);
        /// 🚀 Trigger campaign send flow (template message to all recipients)
        Task<bool> SendCampaignAsync(Guid campaignId, string ipAddress, string userAgent);
        Task<Guid> CreateImageCampaignAsync(Guid businessId, CampaignCreateDto dto, string createdBy);
        Task<List<CampaignSummaryDto>> GetAllCampaignsAsync(Guid businessId, string? type = null);
        Task<List<ContactDto>> GetRecipientsByCampaignIdAsync(Guid campaignId, Guid businessId);
        Task<bool> RemoveRecipientAsync(Guid businessId, Guid campaignId, Guid contactId);
        Task<CampaignDto?> GetCampaignByIdAsync(Guid campaignId, Guid businessId);
        Task<bool> AssignContactsToCampaignAsync(Guid campaignId, Guid businessId, List<Guid> contactIds);

        Task<ResponseResult> SendTemplateCampaignAsync(Guid campaignId);

        Task<ResponseResult> SendTemplateCampaignWithTypeDetectionAsync(Guid campaignId);

        Task<ResponseResult> SendTextTemplateCampaignAsync(Campaign campaign);
        Task<ResponseResult> SendImageTemplateCampaignAsync(Campaign campaign);


    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Controllers/CampaignAnalyticsController.cs  (sha256:6c7bbdd6a0b01a9ec8cbb26be5139c16e41469243bda8101faa7cf042887338f)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using System.Security.Claims;
using xbytechat.api.Features.CampaignTracking.Services;

namespace xbytechat.api.Features.CampaignTracking.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class CampaignAnalyticsController : ControllerBase
    {
        private readonly ICampaignAnalyticsService _campaignAnalyticsService;

        public CampaignAnalyticsController(ICampaignAnalyticsService campaignAnalyticsService)
        {
            _campaignAnalyticsService = campaignAnalyticsService;
        }

        [HttpGet("status-dashboard")]
        //public async Task<IActionResult> GetStatusDashboard()
        //{
        //    var businessIdString = User.FindFirstValue("BusinessId");
        //    if (!Guid.TryParse(businessIdString, out var businessId))
        //    {
        //        return Unauthorized("Invalid business identifier.");
        //    }
        //    var result = await _campaignAnalyticsService.GetStatusDashboardAsync(businessId);
        //    return Ok(result);
        //}

        [HttpGet("top-campaigns")]
        public async Task<IActionResult> GetTopCampaigns([FromQuery] int count = 5)
        {
            var businessIdString = User.FindFirstValue("BusinessId");
            if (!Guid.TryParse(businessIdString, out var businessId))
            {
                return Unauthorized("Invalid business identifier.");
            }
            var result = await _campaignAnalyticsService.GetTopCampaignsAsync(businessId, count);
            return Ok(result);
        }
    }
}
``n
--- file: xbytechat-api/Features/CampaignTracking/Controllers/CampaignRetryController.cs  (sha256:b45bb8993a8de233fd24dbbfa69ed1d48a2e48d062fe36e81feb3a4384bed5d2)
`$lang
using Microsoft.AspNetCore.Mvc;
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.Services;

namespace xbytechat.api.Features.CampaignTracking.Controllers
{
    [ApiController]
    [Route("api/campaign-retry")]
    public class CampaignRetryController : ControllerBase
    {
        private readonly ICampaignRetryService _retryService;

        public CampaignRetryController(ICampaignRetryService retryService)
        {
            _retryService = retryService;
        }

        // 🔁 Retry a single failed log
        // Endpoint: POST /api/campaign-retry/{logId}/retry
        [HttpPost("{logId}/retry")]
        public async Task<IActionResult> RetrySingle(Guid logId)
        {
            var success = await _retryService.RetrySingleAsync(logId);
            if (!success)
                return BadRequest(new { message = "Retry failed or not allowed for this log." });

            return Ok(new { success = true, message = "Retry completed." });
        }

        // 🔁 Retry all failed logs in a campaign
        // Endpoint: POST /api/campaign-retry/campaign/{campaignId}/retry-all
        [HttpPost("campaign/{campaignId}/retry-all")]
        public async Task<IActionResult> RetryAllInCampaign(Guid campaignId)
        {
            var retriedCount = await _retryService.RetryFailedInCampaignAsync(campaignId);
            return Ok(new { success = true, retriedCount });
        }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Controllers/CampaignSendLogController.cs  (sha256:bc0f07e7012784757cf4cd0d58115aa69c521a5c518e227a771bc254f68db896)
`$lang
using Microsoft.AspNetCore.Mvc;
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.DTOs;
using xbytechat.api.Features.CampaignTracking.Services;

namespace xbytechat.api.Features.CampaignTracking.Controllers
{
    [ApiController]
    [Route("api/campaign-logs")]
    public class CampaignSendLogController : ControllerBase
    {
        private readonly ICampaignSendLogService _logService;
        private readonly ICampaignRetryService _retryService;

        public CampaignSendLogController(
            ICampaignSendLogService logService,
            ICampaignRetryService retryService
        )
        {
            _logService = logService;
            _retryService = retryService;
        }

        [HttpGet("campaign/{campaignId}")]
        public async Task<IActionResult> GetLogsByCampaign(Guid campaignId)
        {
            var logs = await _logService.GetLogsByCampaignIdAsync(campaignId);
            return Ok(logs);
        }

        [HttpGet("campaign/{campaignId}/contact/{contactId}")]
        public async Task<IActionResult> GetLogsForContact(Guid campaignId, Guid contactId)
        {
            var logs = await _logService.GetLogsForContactAsync(campaignId, contactId);
            return Ok(logs);
        }

        [HttpPost]
        public async Task<IActionResult> AddSendLog([FromBody] CampaignSendLogDto dto)
        {
            var ipAddress = HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";
            var userAgent = Request.Headers["User-Agent"].ToString() ?? "unknown";

            var result = await _logService.AddSendLogAsync(dto, ipAddress, userAgent);
            if (!result)
                return BadRequest(new { message = "Failed to add send log" });

            return Ok(new { success = true });
        }

        [HttpPut("{logId}/status")]
        public async Task<IActionResult> UpdateDeliveryStatus(Guid logId, [FromBody] DeliveryStatusUpdateDto dto)
        {
            var result = await _logService.UpdateDeliveryStatusAsync(logId, dto.Status, dto.DeliveredAt, dto.ReadAt);
            if (!result)
                return NotFound(new { message = "Log not found" });

            return Ok(new { success = true });
        }

        [HttpPut("{logId}/track-click")]
        public async Task<IActionResult> TrackClick(Guid logId, [FromBody] ClickTrackDto dto)
        {
            var result = await _logService.TrackClickAsync(logId, dto.ClickType);
            if (!result)
                return NotFound(new { message = "Log not found" });

            return Ok(new { success = true });
        }

        // ✅ FIXED: Retry a single log using correct interface method
        [HttpPost("{logId}/retry")]
        public async Task<IActionResult> RetrySingle(Guid logId)
        {
            var result = await _retryService.RetrySingleAsync(logId);
            if (!result)
                return BadRequest(new { message = "Retry failed" });

            return Ok(new { success = true });
        }

        // ✅ FIXED: Retry all failed logs using correct interface method
        [HttpPost("campaign/{campaignId}/retry-all")]
        public async Task<IActionResult> RetryAll(Guid campaignId)
        {
            var result = await _retryService.RetryFailedInCampaignAsync(campaignId);
            return Ok(new { success = true, retried = result });
        }
        // ✅ FIXED: Get summary of campaign logs as per Campaign ID
        [HttpGet("campaign/{campaignId}/summary")]
        public async Task<IActionResult> GetCampaignSummary(Guid campaignId)
        {
            var summary = await _logService.GetCampaignSummaryAsync(campaignId);
            return Ok(summary);
        }

    }

    public class DeliveryStatusUpdateDto
    {
        public string Status { get; set; }
        public DateTime? DeliveredAt { get; set; }
        public DateTime? ReadAt { get; set; }
    }

    public class ClickTrackDto
    {
        public string ClickType { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/DTOs/CampaignLogSummaryDto.cs  (sha256:41bd053931f58ad0a1eb056cadbe46d553f949ab070ac3454d6bb05d1662e6c1)
`$lang
namespace xbytechat.api.Features.CampaignTracking.DTOs
{
    public class CampaignLogSummaryDto
    {
        public int TotalSent { get; set; }
        public int FailedCount { get; set; }
        public int ClickedCount { get; set; }
        public DateTime? LastSentAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/DTOs/CampaignSendLogDto.cs  (sha256:42c34ffaad27eea7cfade390bdbd9220b2abbf7095b92a61d1d3d52e57226306)
`$lang
using System;

namespace xbytechat.api.Features.CampaignTracking.DTOs
{
    public class CampaignSendLogDto
    {
        public Guid Id { get; set; }

        // 🔗 Relationships
        public Guid CampaignId { get; set; }
        public Guid ContactId { get; set; }
        public string ContactName { get; set; }
        public string ContactPhone { get; set; }

        // 📤 Message Info
        public Guid RecipientId { get; set; }
        public string MessageBody { get; set; }
        public string? TemplateId { get; set; }
        public string? SendStatus { get; set; }
        public string? ErrorMessage { get; set; }

        // 🕒 Timestamps
        public DateTime CreatedAt { get; set; }
        public DateTime? SentAt { get; set; }
        public DateTime? DeliveredAt { get; set; }
        public DateTime? ReadAt { get; set; }

        // 🌐 Metadata
        public string? SourceChannel { get; set; }
        public string? IpAddress { get; set; }
        public string? DeviceInfo { get; set; }
        public string? MacAddress { get; set; }

        // ✅ Enriched metadata
        public string? DeviceType { get; set; }
        public string? Browser { get; set; }
        public string? Country { get; set; }
        public string? City { get; set; }

        // 📈 Click Tracking
        public bool IsClicked { get; set; }
        public DateTime? ClickedAt { get; set; }
        public string? ClickType { get; set; }

        // 🔁 Retry Info
        public string? RetryStatus { get; set; }     // Pending, Retried, Skipped
        public int RetryCount { get; set; }
        public DateTime? LastRetryAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/DTOs/CampaignStatusDashboardDto.cs  (sha256:21979b3b1de98ab2567e6485c9c0e4684b848735d36743226caaca66504e9b7b)
`$lang
namespace xbytechat.api.Features.CampaignTracking.DTOs
{
    public class CampaignStatusDashboardDto
    {
        public Guid CampaignId { get; set; }

        // 📊 Overall Stats
        public int TotalRecipients { get; set; }
        public int SentCount { get; set; }
        public int DeliveredCount { get; set; }
        public int ReadCount { get; set; }
        public int FailedCount { get; set; }

        // 🕒 Delivery Timing (optional but insightful)
        public DateTime? FirstSentAt { get; set; }
        public DateTime? LastSentAt { get; set; }
        public DateTime? FirstReadAt { get; set; }
        public DateTime? LastReadAt { get; set; }

        // 📉 Delivery Rates
        public double DeliveryRate => TotalRecipients == 0 ? 0 : (double)DeliveredCount / TotalRecipients * 100;
        public double ReadRate => TotalRecipients == 0 ? 0 : (double)ReadCount / TotalRecipients * 100;
        public double FailureRate => TotalRecipients == 0 ? 0 : (double)FailedCount / TotalRecipients * 100;
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/DTOs/TopCampaignDto.cs  (sha256:deebf224725de4a79f8363405623b0761fed9b776ec86cc8d6a9b05c5f79940e)
`$lang
namespace xbytechat.api.Features.CampaignTracking.DTOs
{
    public class TopCampaignDto
    {
        public Guid CampaignId { get; set; }
        public string CampaignName { get; set; }
        public double ReadRate { get; set; }
        public double ClickThroughRate { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Models/CampaignSendLog.cs  (sha256:a19d5f0ad994f72337ad52ffeba0a1d94314d6f673b090bdc329093bdbcdfba6)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignModule.Models;

namespace xbytechat.api.Features.CampaignTracking.Models
{
    public class CampaignSendLog
    {
        [Key]
        public Guid Id { get; set; }

        public string? MessageId { get; set; } // Unique WAMID from WhatsApp
        // 🔗 Foreign Keys
        [Required]
        public Guid CampaignId { get; set; }
        public Campaign? Campaign { get; set; }

        [Required]
        public Guid ContactId { get; set; }

        [Required]
        public Guid RecipientId { get; set; }

        // 📩 Message Info
        [Required]
        public string MessageBody { get; set; } = "";

        public string? TemplateId { get; set; }
        public string? SendStatus { get; set; }
        public string? ErrorMessage { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public string? CreatedBy { get; set; }

        public DateTime? SentAt { get; set; }
        public DateTime? DeliveredAt { get; set; }
        public DateTime? ReadAt { get; set; }

        // 🌐 Metadata
        public string? IpAddress { get; set; }
        public string? DeviceInfo { get; set; }
        public string? MacAddress { get; set; }
        public string? SourceChannel { get; set; }

        // ✅ UX-Derived
        public string? DeviceType { get; set; }
        public string? Browser { get; set; }
        public string? Country { get; set; }
        public string? City { get; set; }

        // 📊 Click Tracking
        public bool IsClicked { get; set; } = false;
        public DateTime? ClickedAt { get; set; }
        public string? ClickType { get; set; }

        // 🔁 Retry Tracking (💡 New)
        public int RetryCount { get; set; } = 0;                 // Number of retry attempts
        public DateTime? LastRetryAt { get; set; }               // When retry last happened
        public string? LastRetryStatus { get; set; }             // Success / Failed
        public bool AllowRetry { get; set; } = true;             // Flag to enable/disable retry

        // 👁 Navigation
      
        public Contact? Contact { get; set; }
        public CampaignRecipient? Recipient { get; set; }


        // 🔗 MessageLog reference (optional)
        public Guid? MessageLogId { get; set; }
        public MessageLog? MessageLog { get; set; }

        public Guid BusinessId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Services/CampaignAnalyticsService.cs  (sha256:508462378daa1f45360929c4affbf43b7644d4ad8f799674980452efdc934474)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.CampaignTracking.DTOs;
using xbytechat.api.Features.CampaignTracking.Models;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    

    public class CampaignAnalyticsService : ICampaignAnalyticsService
    {
        private readonly AppDbContext _context;

        public CampaignAnalyticsService(AppDbContext context)
        {
            _context = context;
            //_context = context;
        }

        public async Task<CampaignStatusDashboardDto?> GetCampaignStatsAsync(Guid campaignId)
        {
            var logs = await _context.CampaignSendLogs
                .Where(l => l.CampaignId == campaignId)
                .ToListAsync();

            if (!logs.Any()) return null;

            return new CampaignStatusDashboardDto
            {
                CampaignId = campaignId,
                TotalRecipients = logs.Count,
                SentCount = logs.Count(l => l.SendStatus == "Sent"),
                DeliveredCount = logs.Count(l => l.SendStatus == "Delivered"),
                ReadCount = logs.Count(l => l.SendStatus == "Read"),
                FailedCount = logs.Count(l => l.SendStatus == "Failed"),
                FirstSentAt = logs.Min(l => l.SentAt),
                LastSentAt = logs.Max(l => l.SentAt),
                FirstReadAt = logs.Min(l => l.ReadAt),
                LastReadAt = logs.Max(l => l.ReadAt)
            };
        }

        //public async Task<CampaignStatusDashboardDto> GetStatusDashboardAsync(Guid businessId)
        //{
        //    var stats = await _context.CampaignSendLogs
        //        .Where(log => log.BusinessId == businessId)
        //        .GroupBy(log => 1) // Group by a constant to aggregate all rows
        //        .Select(g => new
        //        {
        //            TotalSent = g.Count(),
        //            TotalDelivered = g.Count(l => l.DeliveredAt != null),
        //            TotalRead = g.Count(l => l.ReadAt != null),
        //            TotalClicked = g.Count(l => l.ClickedAt != null),
        //            TotalFailed = g.Count(l => l.Status == "failed")
        //        })
        //        .FirstOrDefaultAsync();

        //    if (stats == null)
        //    {
        //        return new CampaignStatusDashboardDto(); // Return empty DTO if no logs found
        //    }

        //    //return new CampaignStatusDashboardDto
        //    //{
        //    //    TotalSent = stats.TotalSent,
        //    //    TotalDelivered = stats.TotalDelivered,
        //    //    TotalRead = stats.TotalRead,
        //    //    TotalClicked = stats.TotalClicked,
        //    //    TotalFailed = stats.TotalFailed,
        //    //    DeliveryRate = stats.TotalSent > 0 ? Math.Round((double)stats.TotalDelivered / stats.TotalSent * 100, 2) : 0,
        //    //    ReadRate = stats.TotalDelivered > 0 ? Math.Round((double)stats.TotalRead / stats.TotalDelivered * 100, 2) : 0,
        //    //    ClickRate = stats.TotalDelivered > 0 ? Math.Round((double)stats.TotalClicked / stats.TotalDelivered * 100, 2) : 0
        //    //};
        //}

        public async Task<IEnumerable<TopCampaignDto>> GetTopCampaignsAsync(Guid businessId, int count = 5)
        {
            var campaignStats = await _context.CampaignSendLogs
                .Where(log => log.BusinessId == businessId)
                .GroupBy(log => log.CampaignId)
                .Select(group => new
                {
                    CampaignId = group.Key,
                    TotalSent = group.Count(),
                    TotalRead = group.Count(l => l.ReadAt != null),
                    TotalClicked = group.Count(l => l.ClickedAt != null)
                })
                .Where(s => s.TotalSent > 0)
                .OrderByDescending(s => (double)s.TotalClicked / s.TotalSent)
                .Take(count)
                .ToListAsync();

            if (!campaignStats.Any())
            {
                return new List<TopCampaignDto>();
            }

            var campaignIds = campaignStats.Select(s => s.CampaignId).ToList();
            var campaigns = await _context.Campaigns
                .Where(c => campaignIds.Contains(c.Id))
                .ToDictionaryAsync(c => c.Id, c => c.Name);

            return campaignStats.Select(s => new TopCampaignDto
            {
                CampaignId = s.CampaignId,
                CampaignName = campaigns.GetValueOrDefault(s.CampaignId, "Unnamed Campaign"),
                ReadRate = s.TotalSent > 0 ? Math.Round(((double)s.TotalRead / s.TotalSent) * 100, 2) : 0,
                ClickThroughRate = s.TotalSent > 0 ? Math.Round(((double)s.TotalClicked / s.TotalSent) * 100, 2) : 0
            });
        }
    }
}


``n
--- file: xbytechat-api/Features/CampaignTracking/Services/CampaignRetryService.cs  (sha256:c006d284f3bc500e9eb4d5b0191ac34ccdd5643bc4742c18b5af20ec13334116)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api;
using xbytechat.api.Features.CampaignTracking.Models;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public class CampaignRetryService : ICampaignRetryService
    {
        private readonly AppDbContext _context;

        public CampaignRetryService(AppDbContext context)
        {
            _context = context;
        }

        // ✅ Public method: Retry a single failed log
        public async Task<bool> RetrySingleAsync(Guid logId)
        {
            return await RetrySendLogAsync(logId);
        }

        // ✅ Public method: Retry all failed logs in a campaign
        public async Task<int> RetryFailedInCampaignAsync(Guid campaignId)
        {
            return await RetryAllFailedInCampaignAsync(campaignId);
        }

        // 🔁 Private: Retry a specific log
        private async Task<bool> RetrySendLogAsync(Guid logId)
        {
            var log = await _context.CampaignSendLogs.FirstOrDefaultAsync(x => x.Id == logId);

            if (log == null || log.SendStatus != "Failed" || !log.AllowRetry)
                return false;

            // 🔄 Simulate re-send (replace with actual IMessageService.SendAsync later)
            bool sent = SimulateSendMessage(log);

            log.RetryCount += 1;
            log.LastRetryAt = DateTime.UtcNow;
            log.LastRetryStatus = sent ? "Sent" : "Failed";
            log.SendStatus = sent ? "Sent" : "Failed";
            log.ErrorMessage = sent ? null : "Mock failure on retry";

            await _context.SaveChangesAsync();
            return sent;
        }

        // 🔁 Private: Retry all failed logs in a given campaign
        private async Task<int> RetryAllFailedInCampaignAsync(Guid campaignId)
        {
            var failedLogs = await _context.CampaignSendLogs
                .Where(log => log.CampaignId == campaignId && log.SendStatus == "Failed" && log.AllowRetry)
                .ToListAsync();

            int successCount = 0;

            foreach (var log in failedLogs)
            {
                bool sent = SimulateSendMessage(log);

                log.RetryCount += 1;
                log.LastRetryAt = DateTime.UtcNow;
                log.LastRetryStatus = sent ? "Sent" : "Failed";
                log.SendStatus = sent ? "Sent" : "Failed";
                log.ErrorMessage = sent ? null : "Mock failure on retry";

                if (sent) successCount++;
            }

            await _context.SaveChangesAsync();
            return successCount;
        }

        // 🔧 Simulated send (replace with actual WhatsApp message logic)
        private bool SimulateSendMessage(CampaignSendLog log)
        {
            return new Random().NextDouble() < 0.9; // 90% success rate
        }
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Services/CampaignSendLogEnricher.cs  (sha256:6d1155127869663e221b9c1a80e5dce49dd32c3d57d218d8157691ed3bc8edeb)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.Models;
using System;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public class CampaignSendLogEnricher : ICampaignSendLogEnricher
    {
        public async Task EnrichAsync(CampaignSendLog log, string userAgent, string ipAddress)
        {
            // 🧠 Device Detection (simplified for now)
            log.DeviceInfo = userAgent;

            // 🌍 IP Lookup - Mocked for now
            if (!string.IsNullOrWhiteSpace(ipAddress))
            {
                log.IpAddress = ipAddress;
                log.SourceChannel = "API"; // Example: mark origin
                // Future: Use IPinfo or GeoLite2 for full location enrichment
            }

            // ⌛ Simulate async task for compatibility
            await Task.CompletedTask;
        }
    }
}


``n
--- file: xbytechat-api/Features/CampaignTracking/Services/CampaignSendLogService.cs  (sha256:17a9852f8e2cd9ddf34b0ebdf64d080aa53e811211b11d89d94b2376fabc0ae3)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api;
using xbytechat.api.Features.CampaignTracking.DTOs;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.CampaignTracking.Services;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public class CampaignSendLogService : ICampaignSendLogService
    {
        private readonly AppDbContext _context;
        private readonly ICampaignSendLogEnricher _enricher;

        public CampaignSendLogService(AppDbContext context, ICampaignSendLogEnricher enricher)
        {
            _context = context;
            _enricher = enricher;
        }

        // 📊 Get all send logs for a given campaign
        public async Task<List<CampaignSendLogDto>> GetLogsByCampaignIdAsync(Guid campaignId)
        {
            return await _context.CampaignSendLogs
                .Where(log => log.CampaignId == campaignId)
                .Include(log => log.Contact)
                .Select(log => new CampaignSendLogDto
                {
                    Id = log.Id,
                    CampaignId = log.CampaignId,
                    ContactId = log.ContactId,
                    ContactName = log.Contact != null ? log.Contact.Name : "N/A",
                    ContactPhone = log.Contact != null ? log.Contact.PhoneNumber : "-",
                    MessageBody = log.MessageBody,
                    TemplateId = log.TemplateId,
                    SendStatus = log.SendStatus,
                    ErrorMessage = log.ErrorMessage,
                    CreatedAt = log.CreatedAt,
                    SentAt = log.SentAt,
                    DeliveredAt = log.DeliveredAt,
                    ReadAt = log.ReadAt,
                    IpAddress = log.IpAddress,
                    DeviceInfo = log.DeviceInfo,
                    MacAddress = log.MacAddress,
                    SourceChannel = log.SourceChannel,
                    IsClicked = log.IsClicked,
                    ClickedAt = log.ClickedAt,
                    ClickType = log.ClickType
                })
                .ToListAsync();
        }

        // 📍 Get logs for a specific contact in a campaign
        public async Task<List<CampaignSendLogDto>> GetLogsForContactAsync(Guid campaignId, Guid contactId)
        {
            return await _context.CampaignSendLogs
                .Where(log => log.CampaignId == campaignId && log.ContactId == contactId)
                .Select(log => new CampaignSendLogDto
                {
                    Id = log.Id,
                    CampaignId = log.CampaignId,
                    ContactId = log.ContactId,
                    MessageBody = log.MessageBody,
                    TemplateId = log.TemplateId,
                    SendStatus = log.SendStatus,
                    ErrorMessage = log.ErrorMessage,
                    CreatedAt = log.CreatedAt,
                    SentAt = log.SentAt,
                    DeliveredAt = log.DeliveredAt,
                    ReadAt = log.ReadAt,
                    IpAddress = log.IpAddress,
                    DeviceInfo = log.DeviceInfo,
                    MacAddress = log.MacAddress,
                    SourceChannel = log.SourceChannel,
                    IsClicked = log.IsClicked,
                    ClickedAt = log.ClickedAt,
                    ClickType = log.ClickType
                })
                .ToListAsync();
        }

        // 🆕 Create a new send log (with enrichment)
        public async Task<bool> AddSendLogAsync(CampaignSendLogDto dto, string ipAddress, string userAgent)
        {
            var log = new CampaignSendLog
            {
                Id = Guid.NewGuid(),
                CampaignId = dto.CampaignId,
                ContactId = dto.ContactId,
                MessageBody = dto.MessageBody,
                TemplateId = dto.TemplateId,
                SendStatus = dto.SendStatus,
                ErrorMessage = dto.ErrorMessage,
                CreatedAt = DateTime.UtcNow,
                SentAt = dto.SentAt,
                DeliveredAt = dto.DeliveredAt,
                ReadAt = dto.ReadAt,
                SourceChannel = dto.SourceChannel,
                IsClicked = dto.IsClicked,
                ClickedAt = dto.ClickedAt,
                ClickType = dto.ClickType,
                RecipientId = dto.RecipientId
            };

            // ✅ Use enrichment service
            await _enricher.EnrichAsync(log, userAgent, ipAddress);

            _context.CampaignSendLogs.Add(log);
            await _context.SaveChangesAsync();
            return true;
        }

        // 📨 Update delivery or read status
        public async Task<bool> UpdateDeliveryStatusAsync(Guid logId, string status, DateTime? deliveredAt, DateTime? readAt)
        {
            var log = await _context.CampaignSendLogs.FirstOrDefaultAsync(l => l.Id == logId);
            if (log == null) return false;

            log.SendStatus = status;
            log.DeliveredAt = deliveredAt ?? log.DeliveredAt;
            log.ReadAt = readAt ?? log.ReadAt;

            await _context.SaveChangesAsync();
            return true;
        }

        // 📈 Track click (CTA)
        public async Task<bool> TrackClickAsync(Guid logId, string clickType)
        {
            var log = await _context.CampaignSendLogs.FirstOrDefaultAsync(l => l.Id == logId);
            if (log == null) return false;

            log.IsClicked = true;
            log.ClickedAt = DateTime.UtcNow;
            log.ClickType = clickType;

            await _context.SaveChangesAsync();
            return true;
        }

        // 📊 Get summary of campaign logs
        public async Task<CampaignLogSummaryDto> GetCampaignSummaryAsync(Guid campaignId)
        {
            var logs = await _context.CampaignSendLogs
                .Where(l => l.CampaignId == campaignId)
                .ToListAsync();

            return new CampaignLogSummaryDto
            {
                TotalSent = logs.Count,
                FailedCount = logs.Count(l => l.SendStatus == "Failed"),
                ClickedCount = logs.Count(l => l.IsClicked),
                LastSentAt = logs.Max(l => l.SentAt)
            };
        }


    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Services/ICampaignAnalyticsService.cs  (sha256:c4c188f0eba3b537c076a7fc42ef62094de1ced491abcaecb619097e40debb8b)
`$lang
using xbytechat.api.Features.CampaignTracking.DTOs;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public interface ICampaignAnalyticsService
    {
       // Task<CampaignStatusDashboardDto> GetStatusDashboardAsync(Guid businessId);
        Task<IEnumerable<TopCampaignDto>> GetTopCampaignsAsync(Guid businessId, int count = 5);
        Task<CampaignStatusDashboardDto?> GetCampaignStatsAsync(Guid campaignId);
    }
}
``n
--- file: xbytechat-api/Features/CampaignTracking/Services/ICampaignRetryService.cs  (sha256:1211609bf9f58a20712fb625fd9e5691ba959d0f12ddde94e3d869cdf1cd9088)
`$lang
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public interface ICampaignRetryService
    {

        // Retry a single failed message log by its ID.
        // will be used when user clicks "Retry Now" on a log row.
        Task<bool> RetrySingleAsync(Guid logId);


        // Retry all failed messages in a campaign where retry is allowed.
        // will support "Retry All Failed" button from Campaign logs.
        Task<int> RetryFailedInCampaignAsync(Guid campaignId);
    }
}

``n
--- file: xbytechat-api/Features/CampaignTracking/Services/ICampaignSendLogEnricher.cs  (sha256:9204a2182522e06e53fe6beb21100820231943995d044f01feb200bdcaa521de)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.Models;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public interface ICampaignSendLogEnricher
    {
        Task EnrichAsync(CampaignSendLog log, string userAgent, string ipAddress);
    }
}


``n
--- file: xbytechat-api/Features/CampaignTracking/Services/ICampaignSendLogService.cs  (sha256:0e28d9721d3fa93d26567c1671562fba640dadfd8b09b2b2c10500d613373eb4)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.DTOs;

namespace xbytechat.api.Features.CampaignTracking.Services
{
    public interface ICampaignSendLogService
    {
        // 📊 Get all logs for a specific campaign
        Task<List<CampaignSendLogDto>> GetLogsByCampaignIdAsync(Guid campaignId);

        // 📍 Get logs for a specific contact in a campaign
        Task<List<CampaignSendLogDto>> GetLogsForContactAsync(Guid campaignId, Guid contactId);

        // 🆕 Add a new send log entry with enrichment (IP, User-Agent)
        Task<bool> AddSendLogAsync(CampaignSendLogDto dto, string ipAddress, string userAgent);

        // 📨 Update delivery or read status
        Task<bool> UpdateDeliveryStatusAsync(Guid logId, string status, DateTime? deliveredAt, DateTime? readAt);

        // 📈 Track CTA click (e.g., BuyNow, ViewDetails)
        Task<bool> TrackClickAsync(Guid logId, string clickType);
        // 📊 Get summary of campaign logs
        Task<CampaignLogSummaryDto> GetCampaignSummaryAsync(Guid campaignId);

    }
}

``n
--- file: xbytechat-api/Features/Catalog/Controllers/CatalogDashboardController.cs  (sha256:f9186d5de3a12145a3d7a2411736c6510ca02a7b70409ebdcaaa0de5172c0370)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Features.Catalog.Services;
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Catalog.Controllers
{
    [ApiController]
    [Route("api/catalog-dashboard")]
    public class CatalogDashboardController : ControllerBase
    {
        private readonly ICatalogDashboardService _dashboardService;

        public CatalogDashboardController(ICatalogDashboardService dashboardService)
        {
            _dashboardService = dashboardService;
        }

        [HttpGet("summary")]
        public async Task<ActionResult<CatalogDashboardSummaryDto>> GetSummary([FromQuery] Guid businessId)
        {
            var summary = await _dashboardService.GetDashboardSummaryAsync(businessId);
            return Ok(summary);
        }

        [HttpGet("top-products")]
        public async Task<IActionResult> GetTopClickedProducts([FromQuery] Guid businessId, [FromQuery] int topN = 5)
        {
            var topProducts = await _dashboardService.GetTopClickedProductsAsync(businessId, topN);
            return Ok(topProducts);
        }
        [HttpGet("cta-summary")]
        public async Task<IActionResult> GetCtaJourneySummary([FromQuery] Guid businessId)
        {
            var stats = await _dashboardService.GetCtaJourneyStatsAsync(businessId);
            return Ok(stats);
        }
        [HttpGet("product-cta-breakdown")]
        public async Task<IActionResult> GetProductCtaBreakdown([FromQuery] Guid businessId)
        {
            var breakdown = await _dashboardService.GetProductCtaBreakdownAsync(businessId);
            return Ok(breakdown);
        }

    }
}
``n
--- file: xbytechat-api/Features/Catalog/Controllers/CatalogTrackingController.cs  (sha256:85581ce69ed9dbbad069ca060c3e8a2c356ec348d74d860ed2ed1905c46f9514)
`$lang
using Microsoft.AspNetCore.Mvc;
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Features.Catalog.Services;
using xbytechat.api.Helpers;
using Microsoft.Extensions.Logging;

namespace xbytechat.api.Features.Catalog.Controllers
{
    [ApiController]
    [Route("api/catalog-tracking")]
    public class CatalogTrackingController : ControllerBase
    {
        private readonly ICatalogTrackingService _trackingService;
        private readonly ILogger<CatalogTrackingController> _logger;

        public CatalogTrackingController(
            ICatalogTrackingService trackingService,
            ILogger<CatalogTrackingController> logger)
        {
            _trackingService = trackingService;
            _logger = logger;
        }

        [HttpPost("log-click")]
        public async Task<IActionResult> LogClick([FromBody] CatalogClickLogDto dto)
        {
            var result = await _trackingService.LogClickAsync(dto);

            if (!result.Success)
            {
                _logger.LogWarning("❌ Catalog click log failed: {Msg}", result.Message);
                return BadRequest(result);
            }

            return StatusCode(201, result);
        }

        [HttpGet("recent")]
        public async Task<IActionResult> GetRecentLogs([FromQuery] int limit = 5)
        {
            var result = await _trackingService.GetRecentLogsAsync(limit);

            if (!result.Success)
            {
                _logger.LogError("❌ Failed to fetch recent logs: {Error}", result.ErrorMessage);
                return StatusCode(500, result);
            }

            return Ok(result);
        }
    }
}

``n
--- file: xbytechat-api/Features/Catalog/Controllers/ProductController.cs  (sha256:96a44de270bbb3d5a3b88cc161908c14045b78ca5adab88fb776640f55de1a1b)
`$lang
// 📄 File: Features/Catalog/Controllers/ProductController.cs

using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Features.Catalog.Services;
using xbytechat.api.Helpers;
using System;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Middleware.Attributes;

namespace xbytechat.api.Features.Catalog.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ProductController : ControllerBase
    {
        private readonly IProductService _productService;

        public ProductController(IProductService productService)
        {
            _productService = productService;
        }

        // ✅ GET /api/product?businessId=...
        [HttpGet]
        [RequirePermission("ViewCatalog")]
        public async Task<IActionResult> GetAll([FromQuery] Guid businessId)
        {
            if (businessId == Guid.Empty)
                return BadRequest(ResponseResult.ErrorInfo("BusinessId is required."));

            var result = await _productService.GetProductsByBusinessIdAsync(businessId);
            return Ok(result);
        }

        // ✅ POST /api/product
        [HttpPost]
        [RequirePermission("ManageCatalog")]
        public async Task<IActionResult> Create([FromBody] CreateProductDto dto)
        {
            if (!ModelState.IsValid)
            {
                var errors = ModelState.Values
                    .SelectMany(v => v.Errors)
                    .Select(e => e.ErrorMessage)
                    .ToList();

                var errorString = string.Join("; ", errors);
                return BadRequest(ResponseResult.ErrorInfo("Invalid product data.", errorString));
            }

            var result = await _productService.AddProductAsync(dto);
            if (!result.Success)
                return BadRequest(result);

            return StatusCode(201, result);
        }

        // ✅ DELETE /api/product/{id}?businessId=...
        [HttpDelete("{id}")]
        [RequirePermission("ManageCatalog")]
        public async Task<IActionResult> Delete(Guid id, [FromQuery] Guid businessId)
        {
            if (businessId == Guid.Empty)
                return BadRequest(ResponseResult.ErrorInfo("BusinessId is required."));

            var result = await _productService.RemoveProductAsync(id, businessId);
            if (!result.Success)
                return BadRequest(result);

            return Ok(result);
        }

        // ✅ PUT /api/product/{id}
        [HttpPut("{id}")]
        [RequirePermission("ManageCatalog")]
        public async Task<IActionResult> Update(Guid id, [FromBody] UpdateProductDto dto)
        {
            if (id != dto.Id)
                return BadRequest(ResponseResult.ErrorInfo("ID mismatch between route and body."));

            var result = await _productService.UpdateProductAsync(dto);
            if (!result.Success)
                return BadRequest(result);

            return Ok(result);
        }
    }
}

``n
--- file: xbytechat-api/Features/Catalog/DTOs/CatalogClickLogDto.cs  (sha256:901cea612e459695f97b806841df45393d04066624affedbfd85cc9d7d3899ce)
`$lang
namespace xbytechat.api.Features.Catalog.DTOs
{
    public class CatalogClickLogDto
    {
        public Guid BusinessId { get; set; }
        public Guid? ContactId { get; set; }  // ✅ Add this
        public Guid? ProductId { get; set; }

        public string? UserId { get; set; }
        public string? UserName { get; set; }
        public string? UserPhone { get; set; }

        public string? BotId { get; set; }
        public string? CategoryBrowsed { get; set; }
        public string? ProductBrowsed { get; set; }
        public string? CTAJourney { get; set; }
        public Guid? MessageLogId { get; set; }      // ✅ ADD THIS FIELD
        public string? RefMessageId { get; set; }

        public string TemplateId { get; set; }
        public string ButtonText { get; set; }

        // 🧠 Optional: Used for A/B tracking and analytics
        public string? PlanSnapshot { get; set; }

        public string? Source { get; set; } // ✅ Add this
    }
}

``n
--- file: xbytechat-api/Features/Catalog/DTOs/CatalogDashboardSummaryDto.cs  (sha256:31e171cf2d8c5bc006b770f4be2a968db3300aaad51072555faecd119e0e0e07)
`$lang
namespace xbytechat.api.Features.Catalog.DTOs
{
    public class CatalogDashboardSummaryDto
    {
        // Engagement Metrics
        public int TotalMessagesSent { get; set; }
        public int? UniqueCustomersMessaged { get; set; }
        public int? ProductClicks { get; set; }

        // Catalog Overview
        public int? ActiveProducts { get; set; }
        public int? ProductsSharedViaWhatsApp { get; set; }

        // Lead Intelligence
        public int? RepeatClickers { get; set; }
        public int? NewClickersToday { get; set; }

        // Timestamps
        public DateTime? LastCatalogClickAt { get; set; }
        public DateTime? LastMessageSentAt { get; set; }
    }
}
``n
--- file: xbytechat-api/Features/Catalog/DTOs/CreateProductDto.cs  (sha256:8605a9900a0537d7cec14264a91a4a4432debcdaafb06cff99b177460bd47233)
`$lang
// File: Features/Catalog/DTOs/CreateProductDto.cs

namespace xbytechat.api.Features.Catalog.DTOs
{
    public class CreateProductDto
    {
        public Guid BusinessId { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public string Currency { get; set; } = "INR";
        public string ImageUrl { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/Catalog/DTOs/CtaJourneyStatsDto.cs  (sha256:ca4efb6e222da04add4d8f9892be95a16ae180b34e53eec32d300c471ea503bd)
`$lang
namespace xbytechat.api.Features.Catalog.DTOs
{
    public class CtaJourneyStatsDto
    {
        public string CTAJourney { get; set; }
        public int ClickCount { get; set; }
    }
}
``n
--- file: xbytechat-api/Features/Catalog/DTOs/ProductCtaBreakdownDto.cs  (sha256:a94adfe171430503ede80ebb733fc9983f3fe1eae04b4a5a4ed6eb14d354bc10)
`$lang
namespace xbytechat.api.Features.Catalog.DTOs
{
    public class ProductCtaBreakdownDto
    {
        public Guid ProductId { get; set; }
        public string ProductName { get; set; }
        public string CTAJourney { get; set; }
        public int ClickCount { get; set; }
    }
}
``n
--- file: xbytechat-api/Features/Catalog/DTOs/ProductDto.cs  (sha256:9351e6b36ce1f707bd46bb92652331f1751b150a9d062ecfd31572a0998d59b7)
`$lang
// File: Features/Catalog/DTOs/ProductDto.cs

namespace xbytechat.api.Features.Catalog.DTOs
{
    public class ProductDto
    {
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public string Currency { get; set; } = "INR";
        public string ImageUrl { get; set; } = string.Empty;
        public bool IsActive { get; set; } = true;
    }
}

``n
--- file: xbytechat-api/Features/Catalog/DTOs/TopProductDto.cs  (sha256:464918c2b2d66c5710042f7d26d7b64fc8f4fb0380f12e7c756a0d248e613684)
`$lang
namespace xbytechat.api.Features.Catalog.DTOs
{
    public class TopProductDto
    {
        public Guid ProductId { get; set; }
        public string ProductName { get; set; }
        public int ClickCount { get; set; }
    }
}
``n
--- file: xbytechat-api/Features/Catalog/DTOs/UpdateProductDto.cs  (sha256:3d2fa63b4ce50da54504b1efa60375305ee53bd12498eb5c359bec2f13aeb11c)
`$lang
// File: Features/Catalog/DTOs/UpdateProductDto.cs

namespace xbytechat.api.Features.Catalog.DTOs
{
    public class UpdateProductDto
    {
        public Guid Id { get; set; }
        public Guid BusinessId { get; set; }

        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public string Currency { get; set; } = "INR";
        public string ImageUrl { get; set; } = string.Empty;
    }
}


``n
--- file: xbytechat-api/Features/Catalog/Models/CatalogClickLog.cs  (sha256:04b5faf86ec274241aa075f5ba6309899ae07f9c0074d1a34285b4f7c96b437d)
`$lang
namespace xbytechat.api.Features.Catalog.Models
{
    public class CatalogClickLog
    {
        public Guid Id { get; set; }

        // 🔗 Business & Product Info
        public Guid BusinessId { get; set; }
        public Guid? ProductId { get; set; }

        // 👤 Customer Info
        public string? UserId { get; set; }
        public string? UserName { get; set; }
        public string? UserPhone { get; set; }

        // 🤖 Bot / Messaging Context
        public string? BotId { get; set; }

        // 🛍️ Browsing Context
        public string? CategoryBrowsed { get; set; }
        public string? ProductBrowsed { get; set; }

        // 🔘 CTA Clicked
        public string? CTAJourney { get; set; }
        public string TemplateId { get; set; }
        public string RefMessageId { get; set; }
        public string ButtonText { get; set; }

        // 🕒 Meta
        public DateTime? ClickedAt { get; set; } = DateTime.UtcNow;

        // ✅ CRM / Campaign / Analytics
        public Guid? CampaignSendLogId { get; set; }
        public Guid? ContactId { get; set; }
        public bool FollowUpSent { get; set; } = false;
        public string? LastInteractionType { get; set; }
        public Guid? MessageLogId { get; set; }
        public string? PlanSnapshot { get; set; }

        // 🆕 [New Additions for CTA Campaign Tracking]
        public Guid? CtaId { get; set; }             // Link to CTA definition
        public Guid? CampaignId { get; set; }        // Link to campaign (if any)
        public string Source { get; set; } = "catalog"; // "catalog", "campaign", "auto-reply"
    }
}

``n
--- file: xbytechat-api/Features/Catalog/Models/Product.cs  (sha256:428554206c02d4602a873704a1e49c995a274f4633e0f32d8c0991c4eea72a31)
`$lang
// File: Features/Catalog/Models/Product.cs

using System;

namespace xbytechat.api.Features.Catalog.Models
{
    public class Product
    {
        public Guid Id { get; set; }

        // 🔗 Foreign Key - Business/Owner
        public Guid BusinessId { get; set; }

        // 📦 Core Product Info
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public string Currency { get; set; } = "INR";
        public string ImageUrl { get; set; } = string.Empty;

        // ✅ Visibility & State
        public bool IsActive { get; set; } = true;

        // 📅 Metadata
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public int TotalClicks { get; set; } = 0; // Total CTA clicks tracked
        public DateTime? LastClickedAt { get; set; } // Last time a user clicked CTA for this product
        public string? MostClickedCTA { get; set; } // Button text with highest click count (e.g., "Buy Now")

    }
}

``n
--- file: xbytechat-api/Features/Catalog/Services/CatalogDashboardService.cs  (sha256:3303616ebf70e99e2e646759834c707405060cc1b22ceb5f743dfa1d8af50198)
`$lang
using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Hosting.Server;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Catalog.DTOs;
using static System.Runtime.InteropServices.JavaScript.JSType;

namespace xbytechat.api.Features.Catalog.Services
{
    public class CatalogDashboardService : ICatalogDashboardService
    {
        private readonly AppDbContext _context;

        public CatalogDashboardService(AppDbContext context)
        {
            _context = context;
        }

       
        public async Task<CatalogDashboardSummaryDto> GetDashboardSummaryAsync(Guid businessId)
        {
            var today = DateTime.UtcNow.Date;

            var totalMessagesSent = await _context.MessageLogs
                .CountAsync(m => m.BusinessId == businessId);

            var uniqueCustomersMessaged = await _context.MessageLogs
                .Where(m => m.BusinessId == businessId)
                .Select(m => m.RecipientNumber)
                .Distinct()
                .CountAsync();

            var productClicks = await _context.CatalogClickLogs
                .CountAsync(c => c.BusinessId == businessId && c.ProductId != null);

            var activeProducts = await _context.Products
                .CountAsync(p => p.BusinessId == businessId);

            var productsSharedViaWhatsapp = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId && c.ProductId != null)
                .Select(c => c.ProductId)
                .Distinct()
                .CountAsync();

            var repeatClickers = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId)
                .GroupBy(c => c.UserPhone)
                .CountAsync(g => g.Count() > 1);

            var newClickersToday = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId && c.ClickedAt.Value.Date == today)
                .Select(c => c.UserPhone)
                .Distinct()
                .CountAsync();
            //        var newClickersToday = _context.CatalogClickLogs
            //.Where(c => c.BusinessId == businessId)
            //.ToList() // now it's LINQ to Objects
            //        .Where(c => c.ClickedAt?.Date == today)
            //        .Select(c => c.UserPhone)
            //        .Distinct()
            //.Count();
            //        But if your data is large, the first(server-side filtering) is the better choice.

            var lastCatalogClickAt = await _context.CatalogClickLogs
    .Where(c => c.BusinessId == businessId)
    .MaxAsync(c => (DateTime?)c.ClickedAt);

            var lastMessageSentAt = await _context.MessageLogs
                .Where(m => m.BusinessId == businessId)
                .MaxAsync(m => (DateTime?)m.SentAt);

            return new CatalogDashboardSummaryDto
            {
                TotalMessagesSent = totalMessagesSent,
                UniqueCustomersMessaged = uniqueCustomersMessaged,
                ProductClicks = productClicks,
                ActiveProducts = activeProducts,
                ProductsSharedViaWhatsApp = productsSharedViaWhatsapp,
                RepeatClickers = repeatClickers,
                NewClickersToday = newClickersToday,
                LastCatalogClickAt = lastCatalogClickAt,
                LastMessageSentAt = lastMessageSentAt
            };
        }

        public async Task<List<TopProductDto>> GetTopClickedProductsAsync(Guid businessId, int topN = 5)
        {
            var topProducts = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId && c.ProductId != null)
                .GroupBy(c => c.ProductId)
                .Select(g => new
                {
                    ProductId = g.Key,
                    ClickCount = g.Count()
                })
                .OrderByDescending(x => x.ClickCount)
                .Take(topN)
                .ToListAsync();

            // Now fetch product names to join with clicks
            var productIds = topProducts.Select(x => x.ProductId).ToList();

            var products = await _context.Products
                .Where(p => productIds.Contains(p.Id))
                .ToDictionaryAsync(p => p.Id, p => p.Name);

            return topProducts.Select(x => new TopProductDto
            {
                ProductId = x.ProductId.Value,
                ProductName = products.ContainsKey(x.ProductId.Value) ? products[x.ProductId.Value] : "Unknown",
                ClickCount = x.ClickCount
            }).ToList();
        }
        public async Task<List<CtaJourneyStatsDto>> GetCtaJourneyStatsAsync(Guid businessId)
        {
            var stats = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId && !string.IsNullOrEmpty(c.CTAJourney))
                .GroupBy(c => c.CTAJourney)
                .Select(g => new CtaJourneyStatsDto
                {
                    CTAJourney = g.Key,
                    ClickCount = g.Count()
                })
                .OrderByDescending(x => x.ClickCount)
                .ToListAsync();

            return stats;
        }
        public async Task<List<ProductCtaBreakdownDto>> GetProductCtaBreakdownAsync(Guid businessId)
        {
            var groupedClicks = await _context.CatalogClickLogs
                .Where(c => c.BusinessId == businessId && c.ProductId != null && !string.IsNullOrEmpty(c.CTAJourney))
                .GroupBy(c => new { c.ProductId, c.CTAJourney })
                .Select(g => new
                {
                    ProductId = g.Key.ProductId.Value,
                    CTAJourney = g.Key.CTAJourney,
                    ClickCount = g.Count()
                })
                .ToListAsync();

            // Fetch product names for all involved productIds
            var productIds = groupedClicks.Select(g => g.ProductId).Distinct().ToList();

            var productNames = await _context.Products
                .Where(p => productIds.Contains(p.Id))
                .ToDictionaryAsync(p => p.Id, p => p.Name);

            var result = groupedClicks.Select(g => new ProductCtaBreakdownDto
            {
                ProductId = g.ProductId,
                ProductName = productNames.ContainsKey(g.ProductId) ? productNames[g.ProductId] : "Unknown",
                CTAJourney = g.CTAJourney,
                ClickCount = g.ClickCount
            }).ToList();

            return result;
        }

    }
}
``n
--- file: xbytechat-api/Features/Catalog/Services/CatalogTrackingService.cs  (sha256:79e5e44c45d327c3c4f281e9f60fe09baac547c05995c848a954edd66d3f349d)
`$lang
using Microsoft.EntityFrameworkCore;
using Serilog;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Features.Catalog.Models;
using xbytechat.api.Helpers;
using xbytechat.api.Models;
using xbytechat.api.Services.Messages.Interfaces;
using xbytechat.api.Features.xbTimeline.Services;
using xbytechat.api.Features.PlanManagement.Models;

namespace xbytechat.api.Features.Catalog.Services
{
    public class CatalogTrackingService : ICatalogTrackingService
    {
        private readonly AppDbContext _context;
        private readonly IMessageService _messageService;
        private readonly ILeadTimelineService _leadTimelineService;

        public CatalogTrackingService(
            AppDbContext context,
            IMessageService messageService,
            ILeadTimelineService leadTimelineService)
        {
            _context = context;
            _messageService = messageService;
            _leadTimelineService = leadTimelineService;
        }

        public async Task<ResponseResult> LogClickAsync(CatalogClickLogDto dto)
        {
            if (dto == null || dto.BusinessId == Guid.Empty || string.IsNullOrWhiteSpace(dto.UserPhone))
            {
                Log.Warning("❌ Invalid catalog click log attempt: missing businessId or userPhone.");
                return ResponseResult.ErrorInfo("Required fields are missing (businessId, userPhone).");
            }

            try
            {
                Guid? campaignSendLogId = null;
                Guid? contactId = null;
                bool followUpSent = false;

                // STEP 1: Link campaign log via RefMessageId if available
                if (!string.IsNullOrWhiteSpace(dto.RefMessageId))
                {
                    var sendLog = await _context.CampaignSendLogs
                        .FirstOrDefaultAsync(x => x.MessageId == dto.RefMessageId);

                    if (sendLog != null)
                    {
                        sendLog.IsClicked = true;
                        sendLog.ClickedAt = DateTime.UtcNow;
                        sendLog.ClickType = dto.CTAJourney ?? dto.ButtonText;
                        campaignSendLogId = sendLog.Id;
                    }
                }

                // STEP 2: Link or Create CRM Contact
                if (!string.IsNullOrWhiteSpace(dto.UserPhone))
                {
                    var contact = await _context.Contacts
                        .FirstOrDefaultAsync(c => c.PhoneNumber == dto.UserPhone && c.BusinessId == dto.BusinessId);

                    if (contact == null)
                    {
                        contact = new Contact
                        {
                            Id = Guid.NewGuid(),
                            Name = dto.UserName ?? "Lead",
                            PhoneNumber = dto.UserPhone,
                            BusinessId = dto.BusinessId,
                            CreatedAt = DateTime.UtcNow
                        };
                        _context.Contacts.Add(contact);
                        await _context.SaveChangesAsync();
                    }

                    contactId = contact.Id;

                    // STEP 3: Auto follow-up if plan allows
                    var business = await _context.Businesses
                        .AsNoTracking()
                        .FirstOrDefaultAsync(b => b.Id == dto.BusinessId);

                    if (business?.BusinessPlanInfo?.Plan == PlanType.Advanced)
                    {
                        var message = $"Hi {contact.Name ?? "there"}, how can I help you?";
                        await _messageService.SendFollowUpAsync(contact.PhoneNumber, message);
                        followUpSent = true;
                    }
                }

                // STEP 4: Save the click with all linked data
                var log = new CatalogClickLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    ProductId = dto.ProductId,
                    UserId = dto.UserId,
                    UserName = dto.UserName,
                    UserPhone = dto.UserPhone,
                    BotId = dto.BotId,
                    CategoryBrowsed = dto.CategoryBrowsed,
                    ProductBrowsed = dto.ProductBrowsed,
                    CTAJourney = dto.CTAJourney,
                    TemplateId = dto.TemplateId,
                    ButtonText = dto.ButtonText,
                    RefMessageId = dto.RefMessageId,
                    ClickedAt = DateTime.UtcNow,
                    CampaignSendLogId = campaignSendLogId,
                    ContactId = contactId,
                    FollowUpSent = followUpSent,
                    LastInteractionType = "Clicked",
                    PlanSnapshot = dto.PlanSnapshot
                };

                _context.CatalogClickLogs.Add(log);
                await _context.SaveChangesAsync();

                // STEP 5: Save into LeadTimeline (no await error)
                await _leadTimelineService.AddFromCatalogClickAsync(log);

                Log.Information("📊 Catalog click tracked: {BusinessId}, {UserPhone}, {CTA}", dto.BusinessId, dto.UserPhone, dto.CTAJourney);
                return ResponseResult.SuccessInfo("✅ Click tracked successfully.", log.Id);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to log catalog click");
                return ResponseResult.ErrorInfo("❌ Error while tracking catalog click.", ex.Message);
            }
        }

        public async Task<ResponseResult> GetRecentLogsAsync(int limit)
        {
            try
            {
                var logs = await _context.CatalogClickLogs
                    .OrderByDescending(x => x.ClickedAt)
                    .Take(limit)
                    .ToListAsync();

                return ResponseResult.SuccessInfo("Recent logs fetched.", logs);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to fetch recent catalog click logs");
                return ResponseResult.ErrorInfo("Failed to fetch logs.", ex.Message);
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/Catalog/Services/ICatalogDashboardService.cs  (sha256:9cac16574ec18c7343c13d49a28395b9ab04bf296e8d7b910b05d1cc88378a7d)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.DTOs;
namespace xbytechat.api.Features.Catalog.Services
{
    public interface ICatalogDashboardService
    {
        Task<CatalogDashboardSummaryDto> GetDashboardSummaryAsync(Guid businessId);
        Task<List<TopProductDto>> GetTopClickedProductsAsync(Guid businessId, int topN = 5);
        Task<List<CtaJourneyStatsDto>> GetCtaJourneyStatsAsync(Guid businessId);
        Task<List<ProductCtaBreakdownDto>> GetProductCtaBreakdownAsync(Guid businessId);

    }
}
``n
--- file: xbytechat-api/Features/Catalog/Services/ICatalogTrackingService.cs  (sha256:b9ea119f807697f7e52cbea8b7c3aa4320c2ffe23326d076d1d1f0f9a2f12310)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.Catalog.Services
{
    public interface ICatalogTrackingService
    {
        Task<ResponseResult> LogClickAsync(CatalogClickLogDto dto);
        Task<ResponseResult> GetRecentLogsAsync(int limit);
    }
}

``n
--- file: xbytechat-api/Features/Catalog/Services/IProductService.cs  (sha256:23245f8c5da029c4146e515732f03b3e815636c1fddfec0f38a3a26355bdc1b1)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.Catalog.Services
{
    public interface IProductService
    {
        Task<ResponseResult> AddProductAsync(CreateProductDto dto);
        Task<ResponseResult> RemoveProductAsync(Guid id, Guid businessId);
        Task<ResponseResult> UpdateProductAsync(UpdateProductDto dto);
        Task<ResponseResult> GetProductsByBusinessIdAsync(Guid businessId);
    }
}

``n
--- file: xbytechat-api/Features/Catalog/Services/ProductService.cs  (sha256:b42253a9398257b4f84555e31c4423127d843bd60b73560f7730b71433d17fd0)
`$lang
using Microsoft.EntityFrameworkCore;
using Serilog;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.DTOs;
using xbytechat.api.Features.Catalog.Models;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.Catalog.Services
{
    public class ProductService : IProductService
    {
        private readonly AppDbContext _context;

        public ProductService(AppDbContext context)
        {
            _context = context;
        }

        public async Task<ResponseResult> AddProductAsync(CreateProductDto dto)
        {
            try
            {
                var exists = await _context.Products
                    .AnyAsync(p => p.BusinessId == dto.BusinessId && p.Name == dto.Name);

                if (exists)
                {
                    Log.Warning("❌ Duplicate product add attempt: {ProductName} for BusinessId: {BusinessId}", dto.Name, dto.BusinessId);
                    return ResponseResult.ErrorInfo("Product with this name already exists.");
                }

                var newProduct = new Product
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    Name = dto.Name,
                    Description = dto.Description,
                    Price = dto.Price,
                    Currency = dto.Currency,
                    ImageUrl = dto.ImageUrl,
                    IsActive = true,
                    CreatedAt = DateTime.UtcNow
                };

                await _context.Products.AddAsync(newProduct);
                await _context.SaveChangesAsync();

                Log.Information("✅ Product created: {ProductName} ({ProductId})", dto.Name, newProduct.Id);
                return ResponseResult.SuccessInfo("✅ Product added successfully.", newProduct.Id);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to add product: {ProductName}", dto.Name);
                return ResponseResult.ErrorInfo("Failed to add product.", ex.Message);
            }
        }

        public async Task<ResponseResult> RemoveProductAsync(Guid id, Guid businessId)
        {
            try
            {
                var product = await _context.Products
                    .FirstOrDefaultAsync(p => p.Id == id && p.BusinessId == businessId);

                if (product == null)
                {
                    Log.Warning("❌ Attempted to delete non-existent product: {ProductId}", id);
                    return ResponseResult.ErrorInfo("Product not found.");
                }

                _context.Products.Remove(product);
                await _context.SaveChangesAsync();

                Log.Information("🗑️ Product deleted: {ProductId}", id);
                return ResponseResult.SuccessInfo("🗑️ Product deleted.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to delete product: {ProductId}", id);
                return ResponseResult.ErrorInfo("Failed to delete product.", ex.Message);
            }
        }

        public async Task<ResponseResult> UpdateProductAsync(UpdateProductDto dto)
        {
            try
            {
                var product = await _context.Products
                    .FirstOrDefaultAsync(p => p.Id == dto.Id && p.BusinessId == dto.BusinessId);

                if (product == null)
                {
                    Log.Warning("❌ Attempted to update non-existent product: {ProductId}", dto.Id);
                    return ResponseResult.ErrorInfo("Product not found.");
                }

                product.Name = dto.Name;
                product.Description = dto.Description;
                product.Price = dto.Price;
                product.Currency = dto.Currency;
                product.ImageUrl = dto.ImageUrl;

                await _context.SaveChangesAsync();

                Log.Information("✅ Product updated: {ProductId}", dto.Id);
                return ResponseResult.SuccessInfo("✅ Product updated.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to update product: {ProductId}", dto.Id);
                return ResponseResult.ErrorInfo("Failed to update product.", ex.Message);
            }
        }

        public async Task<ResponseResult> GetProductsByBusinessIdAsync(Guid businessId)
        {
            try
            {
                var products = await _context.Products
                    .Where(p => p.BusinessId == businessId && p.IsActive)
                    .Select(p => new ProductDto
                    {
                        Id = p.Id,
                        BusinessId = p.BusinessId,
                        Name = p.Name,
                        Description = p.Description,
                        Price = p.Price,
                        Currency = p.Currency,
                        ImageUrl = p.ImageUrl,
                        IsActive = p.IsActive
                    })
                    .ToListAsync();

                return ResponseResult.SuccessInfo("Products fetched.", products);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to fetch products for BusinessId: {BusinessId}", businessId);
                return ResponseResult.ErrorInfo("Failed to fetch products.", ex.Message);
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/CrmAnalytics/Controllers/CrmAnalyticsController.cs  (sha256:9148ea0201bfa24665b2fc92339cec7f58019baa66443aba80189bc1a4c9c833)
`$lang
using Microsoft.AspNetCore.Mvc;
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.CrmAnalytics.Services;
using xbytechat.api.Shared;
using System.Security.Claims;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.CrmAnalytics.Controllers
{
    /// <summary>
    /// Handles CRM analytics summary and trends.
    /// </summary>
    [ApiController]
    [Route("api/crm")]
    public class CrmAnalyticsController : ControllerBase
    {
        private readonly ICrmAnalyticsService _crmAnalyticsService;

        public CrmAnalyticsController(ICrmAnalyticsService crmAnalyticsService)
        {
            _crmAnalyticsService = crmAnalyticsService;
        }

        /// <summary>
        /// Returns dashboard summary stats for the CRM.
        /// </summary>
        [HttpGet("summary")]
        public async Task<IActionResult> GetSummary()
        {
            var businessId = GetBusinessIdFromContext();
            var result = await _crmAnalyticsService.GetSummaryAsync(businessId);
            return Ok(ResponseResult.SuccessInfo("📊 CRM analytics loaded successfully.", result));
        }

        /// <summary>
        /// Returns contacts-added-over-time trend for graph.
        /// </summary>
        [HttpGet("trends/contacts")]
        public async Task<IActionResult> GetContactTrends()
        {
            var businessId = GetBusinessIdFromContext();
            var result = await _crmAnalyticsService.GetContactTrendsAsync(businessId);
            return Ok(ResponseResult.SuccessInfo("📈 Contact trends loaded successfully.", result));
        }

        /// <summary>
        /// Extracts the businessId (Guid) from current user claims.
        /// </summary>
        private Guid GetBusinessIdFromContext()
        {
            return Guid.TryParse(HttpContext.User.FindFirst("BusinessId")?.Value, out var id)
                ? id
                : Guid.Empty;
        }
    }
}

``n
--- file: xbytechat-api/Features/CrmAnalytics/DTOs/ContactTrendsDto.cs  (sha256:132d9271e14f9c3f2a65c9241917f67bc8129c91c7050c86a67df545c68419bc)
`$lang
namespace xbytechat.api.Features.CrmAnalytics.DTOs
{
    /// <summary>
    /// Represents the number of contacts added on a specific date.
    /// Used for trend charting on the CRM dashboard.
    /// </summary>
    public class ContactTrendsDto
    {
        public string Date { get; set; } // Format: yyyy-MM-dd
        public int Count { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CrmAnalytics/DTOs/CrmAnalyticsSummaryDto.cs  (sha256:73027ff6ddc0b680b03714267bbf642053cdc28f2d97c16b593a3321186ab9d9)
`$lang
namespace xbytechat.api.Features.CrmAnalytics.DTOs
{
    public class CrmAnalyticsSummaryDto
    {
        public int TotalContacts { get; set; }
        public int TaggedContacts { get; set; }
        public int ActiveReminders { get; set; }
        public int CompletedReminders { get; set; }
        public int TotalNotes { get; set; }
        public int LeadsWithTimeline { get; set; }
        public int NewContactsToday { get; set; }
        public int NotesAddedToday { get; set; }
        public DateTime? LastContactAddedAt { get; set; }
        public DateTime? LastReminderCompletedAt { get; set; }
    }
}


``n
--- file: xbytechat-api/Features/CrmAnalytics/Services/CrmAnalyticsService.cs  (sha256:8fae1f725576dc5f6402559df557282ba8991f65bb324b614a65b4e9225167c5)
`$lang
using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.CrmAnalytics.DTOs;
using xbytechat.api.Features.CrmAnalytics.Services;

namespace xbytechat.api.Features.CrmAnalytics.Services
{
    /// <summary>
    /// Provides implementation for CRM analytics calculations.
    /// Gathers contact, tag, note, and reminder metrics for the dashboard.
    /// </summary>
    public class CrmAnalyticsService : ICrmAnalyticsService
    {
        private readonly AppDbContext _context;

        public CrmAnalyticsService(AppDbContext context)
        {
            _context = context;
        }

        /// <summary>
        /// Generates a summarized snapshot of CRM data for the given business.
        /// </summary>
        /// <param name="businessId">The unique ID of the business</param>
        /// <returns>CrmAnalyticsSummaryDto containing insights</returns>
        public async Task<CrmAnalyticsSummaryDto> GetSummaryAsync(Guid businessId)
        {
            var today = DateTime.UtcNow.Date;

            var totalContacts = await _context.Contacts
                .CountAsync(c => c.BusinessId == businessId);

            var taggedContacts = await _context.Contacts
                .Where(c => c.BusinessId == businessId && c.Tags.Any())
                .CountAsync();

            var activeReminders = await _context.Reminders
                .CountAsync(r => r.BusinessId == businessId && r.Status == "Pending");

            var completedReminders = await _context.Reminders
                .CountAsync(r => r.BusinessId == businessId && r.Status == "Completed");

            var totalNotes = await _context.Notes
                .CountAsync(n => n.BusinessId == businessId);

            var leadsWithTimeline = await _context.LeadTimelines
                .Where(t => t.BusinessId == businessId)
                .Select(t => t.ContactId)
                .Distinct()
                .CountAsync();

            var newContactsToday = await _context.Contacts
                .CountAsync(c => c.BusinessId == businessId && c.CreatedAt.Date == today);

            var notesAddedToday = await _context.Notes
                .CountAsync(n => n.BusinessId == businessId && n.CreatedAt.Date == today);

            var lastContactAddedAt = await _context.Contacts
                .Where(c => c.BusinessId == businessId)
                .OrderByDescending(c => c.CreatedAt)
                .Select(c => (DateTime?)c.CreatedAt)
                .FirstOrDefaultAsync();

            var lastReminderCompletedAt = await _context.Reminders
                .Where(r => r.BusinessId == businessId && r.Status == "Completed")
                .OrderByDescending(r => r.CompletedAt)
                .Select(r => (DateTime?)r.CompletedAt)
                .FirstOrDefaultAsync();

            return new CrmAnalyticsSummaryDto
            {
                TotalContacts = totalContacts,
                TaggedContacts = taggedContacts,
                ActiveReminders = activeReminders,
                CompletedReminders = completedReminders,
                TotalNotes = totalNotes,
                LeadsWithTimeline = leadsWithTimeline,
                NewContactsToday = newContactsToday,
                NotesAddedToday = notesAddedToday,
                LastContactAddedAt = lastContactAddedAt,
                LastReminderCompletedAt = lastReminderCompletedAt
            };
        }
        public async Task<List<ContactTrendsDto>> GetContactTrendsAsync(Guid businessId)
        {
            var trends = await _context.Contacts
                .Where(c => c.BusinessId == businessId)
                .GroupBy(c => c.CreatedAt.Date)
                .OrderBy(g => g.Key)
                .Select(g => new ContactTrendsDto
                {
                    Date = g.Key.ToString("yyyy-MM-dd"),
                    Count = g.Count()
                })
                .ToListAsync();

            return trends;
        }

    }
}

``n
--- file: xbytechat-api/Features/CrmAnalytics/Services/ICrmAnalyticsService.cs  (sha256:24d70810ed26415792ab48592900090d8d1b7682d926e46f4bdc4595b24c5659)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.CrmAnalytics.DTOs;

namespace xbytechat.api.Features.CrmAnalytics.Services
{
    /// <summary>
    /// Defines the contract for CRM Analytics services.
    /// Handles lead-level analytics, summary metrics, and dashboard insights.
    /// </summary>
    public interface ICrmAnalyticsService
    {
        /// <summary>
        /// Returns a summarized view of CRM statistics for a specific business.
        /// This is used to power the CRM analytics dashboard.
        /// </summary>
        /// <param name="businessId">The unique identifier of the business (tenant).</param>
        /// <returns>A summary DTO containing contact, tag, note, and reminder insights.</returns>
        Task<CrmAnalyticsSummaryDto> GetSummaryAsync(Guid businessId);
        Task<List<ContactTrendsDto>> GetContactTrendsAsync(Guid businessId);

    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Controllers/CTAFlowController.cs  (sha256:34b48884230fe58496bf32d324af8a7e69d506ecb82c14917bf48ea328079922)
`$lang
// 📄 File: Features/CTAFlowBuilder/Controllers/CTAFlowController.cs
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Serilog;
using xbytechat.api.Features.CTAFlowBuilder.DTOs;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Features.CTAFlowBuilder.Services;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Features.Tracking.Services;
using xbytechat.api.Helpers;


namespace xbytechat.api.Features.CTAFlowBuilder.Controllers
{
    [ApiController]
    [Route("api/cta-flow")]
    public class CTAFlowController : ControllerBase
    {
        private readonly ICTAFlowService _flowService;
        private readonly IMessageEngineService _messageEngineService;
        private readonly ITrackingService _trackingService;
        public CTAFlowController(ICTAFlowService flowService, IMessageEngineService messageEngineService, ITrackingService trackingService)
        {
            _flowService = flowService;
            _messageEngineService = messageEngineService;
            _trackingService = trackingService;
        }

        [HttpPost("create")]
        public async Task<IActionResult> CreateFlow([FromBody] CreateFlowDto dto)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            var createdBy = User.FindFirst("name")?.Value ?? "system";

            if (string.IsNullOrWhiteSpace(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid or missing businessId claim.");

            var id = await _flowService.CreateFlowWithStepsAsync(dto, businessId, createdBy);
            return Ok(new { flowId = id });
        }

        [HttpPost("publish")]
        public async Task<IActionResult> PublishFlow([FromBody] List<FlowStepDto> steps)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            var createdBy = User.FindFirst("name")?.Value ?? "system";

            if (string.IsNullOrWhiteSpace(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid or missing businessId claim.");

            var result = await _flowService.PublishFlowAsync(businessId, steps, createdBy);
            if (!result.Success)
                return BadRequest(result.Message);

            return Ok("✅ Flow published successfully.");
        }

        [HttpGet("current")]
        public async Task<IActionResult> GetFlow()
        {
            var businessIdHeader = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdHeader, out var businessId))
                return BadRequest("❌ Invalid or missing BusinessId header.");

            var flow = await _flowService.GetFlowByBusinessAsync(businessId);

            // ✅ Always return 200 even if flow is null
            return Ok(flow);
        }

        [HttpGet("draft")]
        public async Task<IActionResult> GetDraftFlow()
        {
            var businessIdHeader = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdHeader, out var businessId))
                return BadRequest("❌ Invalid or missing BusinessId header.");

            var draft = await _flowService.GetDraftFlowByBusinessAsync(businessId);
            if (draft == null)
                return NotFound("❌ No draft flow found.");

            return Ok(draft);
        }

        [HttpGet("by-id/{id}")]
        public async Task<IActionResult> GetFlowById(Guid id)
        {
            var flow = await _flowService.GetVisualFlowByIdAsync(id);
            if (flow == null) return NotFound("❌ Flow not found");
            return Ok(flow);
        }

        //[HttpGet("match")]
        //public async Task<IActionResult> MatchButton([FromQuery] string text, [FromQuery] string type)
        //{
        //    var businessId = Guid.Parse(User.FindFirst("businessId")?.Value);

        //    var step = await _flowService.MatchStepByButtonAsync(businessId, text, type, currentTemplateName,);
        //    if (step == null)
        //        return NotFound("❌ No matching step found.");

        //    return Ok(new
        //    {
        //        step.TemplateToSend,
        //        step.TriggerButtonText,
        //        step.TriggerButtonType
        //    });
        //}

        [HttpGet("match")]
        public async Task<IActionResult> MatchButton(
    [FromQuery] string text,
    [FromQuery] string type,
    [FromQuery] string currentTemplateName,
    [FromQuery] Guid? campaignId) // Optional
        {
            var businessId = Guid.Parse(User.FindFirst("businessId")?.Value!);

            var step = await _flowService.MatchStepByButtonAsync(
                businessId,
                text,
                type,
                currentTemplateName,
                campaignId
            );

            if (step == null)
                return NotFound("❌ No matching step found.");

            return Ok(new
            {
                step.TemplateToSend,
                step.TriggerButtonText,
                step.TriggerButtonType
            });
        }

        [HttpPost("save-visual")]
        public async Task<IActionResult> SaveVisualFlow([FromBody] SaveVisualFlowDto dto)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            var createdBy = User.FindFirst("name")?.Value ?? "system";

            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            Log.Information("📦 Saving CTA Flow: {FlowName} by {User}", dto.FlowName, createdBy);

            var result = await _flowService.SaveVisualFlowAsync(dto, businessId, createdBy);
            if (!result.Success)
            {
                Log.Error("❌ Failed to save flow. Error: {Error}. DTO: {@Dto}", result.ErrorMessage, dto);
                return StatusCode(500, new
                {
                    message = "❌ Failed to save flow",
                    error = result.ErrorMessage,
                    // skipped = result.SkippedNodes ?? 0
                });
            }

            return Ok(new
            {
                message = "✅ Flow saved successfully"
            });
        }

        [HttpDelete("delete/{id}")]
        public async Task<IActionResult> DeleteFlow(Guid id)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var result = await _flowService.DeleteFlowAsync(id, businessId);

            return result.Success
                ? Ok(new { message = result.Message })
                : BadRequest(new { message = result.Message });
        }
        [HttpGet("all-published")]
        public async Task<IActionResult> GetPublishedFlows()
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var flows = await _flowService.GetAllPublishedFlowsAsync(businessId);
            return Ok(flows);
        }
        [HttpGet("all-draft")]
        public async Task<IActionResult> GetAllDraftFlows()
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var flows = await _flowService.GetAllDraftFlowsAsync(businessId);
            return Ok(flows);
        }

        [HttpPost("execute-visual")]
        public async Task<IActionResult> ExecuteVisualFlowAsync(
            [FromQuery] Guid nextStepId,
            [FromQuery] Guid trackingLogId)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var result = await _flowService.ExecuteVisualFlowAsync(businessId, nextStepId, trackingLogId);
            if (result.Success)
                return Ok(result);
            else
                return BadRequest(result);
        }

        [HttpPost("create-config")]
        public async Task<IActionResult> CreateConfigFlow([FromBody] CreateFlowDto dto)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            var createdBy = User.FindFirst("name")?.Value ?? "system";

            if (string.IsNullOrWhiteSpace(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid or missing businessId claim.");

            try
            {
                var id = await _flowService.CreateFlowWithStepsAsync(dto, businessId, createdBy);

                return Ok(new
                {
                    flowId = id,
                    message = "✅ Flow config created successfully."
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new
                {
                    error = "❌ Failed to create flow config.",
                    details = ex.Message
                });
            }
        }

    }
}
``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/CreateFlowDto.cs  (sha256:c23400a06816a2adc8886fa8d20dd77f12b8b93f993b5a772d81cb12d6612a1f)
`$lang
// 📄 File: xbytechat.api/Features/CTAFlowBuilder/DTOs/CreateFlowDto.cs
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class CreateFlowDto
    {
        public string FlowName { get; set; } = string.Empty;
        public List<FlowStepDto> Steps { get; set; } = new();
        public bool IsPublished { get; set; } = false; // ✅ NEW: Draft vs Published
    }

    public class FlowStepDto
    {
        public string TriggerButtonText { get; set; } = string.Empty;
        public string TriggerButtonType { get; set; } = string.Empty;
        public string TemplateToSend { get; set; } = string.Empty;
        public int StepOrder { get; set; }
        public List<ButtonLinkDto> ButtonLinks { get; set; } = new();
    }

    public class ButtonLinkDto
    {
        public string ButtonText { get; set; } = string.Empty;
        public Guid NextStepId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/CTAButtonClickDto.cs  (sha256:da355d853887193eb1d2b3e3fafcf076e6df764f0220cbf10f5c050d42b91df6)
`$lang
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class CTAButtonClickDto
    {
        [Required]
        public string ButtonText { get; set; } = string.Empty;

        [Required]
        public string ButtonType { get; set; } = "cta"; // e.g., "quick_reply", "url", etc.

        [Required]
        public string RecipientNumber { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/CTAFlowExecutionRequest.cs  (sha256:43fc0e1c1674d188b1a5385539f1314176ff81449d4547ea6665df9909a223bb)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class CTAFlowExecutionRequest
    {
        public string ButtonText { get; set; } = string.Empty;
        public string ButtonType { get; set; } = "cta";
        public string RecipientNumber { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/FlowEdgeDto.cs  (sha256:27e76e22a8aba502d5727d9959bec58ea011d2a1f0d4388a141bfa8108043eea)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class FlowEdgeDto
    {
        public string FromNodeId { get; set; } = string.Empty;
        public string ToNodeId { get; set; } = string.Empty;
        public string? SourceHandle { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/FlowNodeDto.cs  (sha256:5b1f9625b329b229575e5859cfacacaa1520238bff1573e6a34b34c4c85120b3)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class FlowNodeDto
    {
        public string Id { get; set; } = string.Empty;

        public string TemplateName { get; set; } = string.Empty;
        public string? TemplateType { get; set; } // ✅ e.g., "image_template", "text_template"
        public string MessageBody { get; set; } = string.Empty;
        public string? TriggerButtonText { get; set; }
        public string? TriggerButtonType { get; set; }
        public float PositionX { get; set; }
        public float PositionY { get; set; }

        public string? RequiredTag { get; set; }         
        public string? RequiredSource { get; set; }      
        public List<LinkButtonDto> Buttons { get; set; } = new();
        //(for flow trigger mapping)
        // ✅ NEW: ReactFlow expects this structure
        public PositionDto Position => new PositionDto
        {
            x = PositionX,
            y = PositionY
        };
        public class PositionDto
        {
            public float x { get; set; }
            public float y { get; set; }
        }
    }
}


``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/LinkButtonDto.cs  (sha256:8949ae08a8a3c33a84886e9c0696379b17a6d894bf887f390ac7f0125a785bf5)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class LinkButtonDto
    {
        public string Text { get; set; } = string.Empty;

        public string? Type { get; set; } // 🔥 e.g., "URL", "QUICK_REPLY"
        public string? SubType { get; set; } // 🔥 e.g., "STATIC", "DYNAMIC"
        public string? Value { get; set; } // 🔥 the parameter or url or payload

        public string? TargetNodeId { get; set; } // 🔄 used for flow linking
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/SaveVisualFlowDto.cs  (sha256:7de59d222a97efeaf9dc23dea2ef351d852087539cec12e7c946b02e11f1bd21)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class SaveVisualFlowDto
    {
        public string FlowName { get; set; } = string.Empty;
        public bool IsPublished { get; set; }

        public List<FlowNodeDto> Nodes { get; set; } = new();
        public List<FlowEdgeDto> Edges { get; set; } = new();
        public Guid? CampaignId { get; set; } // ✅ Add this line
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/VisualFlowLoadDto.cs  (sha256:10bfe378ffd4c8fb74a0746f2abafec88897072e7a974d680396bde281aaf4af)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class VisualFlowLoadDto
    {
        public string FlowName { get; set; } = string.Empty;
        public List<FlowNodeDto> Nodes { get; set; } = new();
        public List<FlowEdgeDto> Edges { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/DTOs/VisualFlowSummaryDto.cs  (sha256:70dcedd3219a474a4b38927e0f0fd4ff3e21ba16632d409f146a9d0d60d685a5)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.DTOs
{
    public class VisualFlowSummaryDto
    {
        public Guid Id { get; set; }
        public string FlowName { get; set; } = string.Empty;
        public bool IsPublished { get; set; }
        public DateTime CreatedAt { get; set; }
    }

}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Models/CTAFlowClickLog.cs  (sha256:ecbd408e613e8ef88e2bb39fdf60bc188163e209d8242317203dfb2bff8cebb8)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.Models
{
    public class CTAFlowClickLog
    {
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Models/CTAFlowConfig.cs  (sha256:3f05a1457051adfc7e66c759040348f1288066c7abcf4c570c0b2fd5c98da19e)
`$lang
// 📄 File: xbytechat.api/Features/CTAFlowBuilder/Models/CTAFlowConfig.cs
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using System.Text.Json.Serialization;

namespace xbytechat.api.Features.CTAFlowBuilder.Models
{
    /// <summary>
    /// Represents a complete flow configuration for a business, such as "Interested Journey".
    /// </summary>
    public class CTAFlowConfig
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        [MaxLength(100)]
        public string FlowName { get; set; } = string.Empty;

        public bool IsActive { get; set; } = true;

        public bool IsPublished { get; set; } = false; // ✅ NEW: Support draft/published

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public string? CreatedBy { get; set; }
        public DateTime? UpdatedAt { get; set; }  // ✅ Add this line

        // 🔁 Navigation to steps
        public ICollection<CTAFlowStep> Steps { get; set; } = new List<CTAFlowStep>();
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Models/CTAFlowStep.cs  (sha256:1469836c27765675fb8f7ea910ffabd76fdc9ec583c0e3e3c0f9a986f6fb83db)
`$lang
// 📄 File: Features/CTAFlowBuilder/Models/CTAFlowStep.cs
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.CTAFlowBuilder.Models
{
    /// <summary>
    /// Represents a single step in a CTA flow, triggered by a button.
    /// </summary>
    public class CTAFlowStep
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid CTAFlowConfigId { get; set; }

        [ForeignKey(nameof(CTAFlowConfigId))]
        public CTAFlowConfig Flow { get; set; } = null!;

        public string TriggerButtonText { get; set; } = string.Empty;

        public string TriggerButtonType { get; set; } = "cta"; // e.g., "quick_reply"

        public string TemplateToSend { get; set; } = string.Empty;

        public int StepOrder { get; set; }

        public string? RequiredTag { get; set; }        // e.g., "interested"
        public string? RequiredSource { get; set; }     // e.g., "ads", "qr", "manual"

        // 🔀 Multiple buttons linking to different steps
        public List<FlowButtonLink> ButtonLinks { get; set; } = new();

        public float? PositionX { get; set; }
        public float? PositionY { get; set; }
        public string? TemplateType { get; set; }


    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Models/FlowButtonLink.cs  (sha256:2765de4d4c1bc355e6487c9d13628a9bdaa79ed4134a4e15f70874b1e91d673b)
`$lang
namespace xbytechat.api.Features.CTAFlowBuilder.Models
{
    public class FlowButtonLink
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public string ButtonText { get; set; } = string.Empty;
        public Guid? NextStepId { get; set; }
        // ✅ NEW FIELDS FOR FUTURE AUTOMATION
        public string ButtonType { get; set; } = "QUICK_REPLY";    // e.g., URL, QUICK_REPLY, FLOW
        public string ButtonSubType { get; set; } = "";            // Optional: e.g., "Catalog", "PricingCTA"
        public string ButtonValue { get; set; } = "";              // e.g., URL or deep link

        // Optional FK back to Step if needed
        public Guid CTAFlowStepId { get; set; }
        public CTAFlowStep? Step { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Models/FlowExecutionLog.cs  (sha256:4795bd092f585ec5ca9f33e869dcc93c8e681b341e9b1ad92b1e8ad93b6133d2)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.CTAFlowBuilder.Models
{
    /// <summary>
    /// Logs when a visual flow step is executed (useful for analytics, debugging, audit).
    /// </summary>
    public class FlowExecutionLog
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        public Guid StepId { get; set; }
        public string StepName { get; set; } = string.Empty;

        public Guid? FlowId { get; set; }

        public Guid? TrackingLogId { get; set; }

        public string? ContactPhone { get; set; }

        public string? TriggeredByButton { get; set; }

        public string? TemplateName { get; set; }

        public string? TemplateType { get; set; }

        public bool Success { get; set; }

        public string? ErrorMessage { get; set; }

        public string? RawResponse { get; set; }

        public DateTime ExecutedAt { get; set; } = DateTime.UtcNow;

       
    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Services/CTAFlowService.cs  (sha256:038c3b5ef822e2ea370a1631e012995f06f1eba95d49429efa435ab669a5022b)
`$lang
// 📄 File: Features/CTAFlowBuilder/Services/CTAFlowService.cs
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Serilog;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CTAFlowBuilder.DTOs;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Helpers;
using xbytechat.api.WhatsAppSettings.DTOs;
using xbytechat_api.WhatsAppSettings.Services;

namespace xbytechat.api.Features.CTAFlowBuilder.Services
{
    public class CTAFlowService : ICTAFlowService
    {
        private readonly AppDbContext _context;
        private readonly IMessageEngineService _messageEngineService;
        private readonly IWhatsAppTemplateFetcherService _templateFetcherService;

        public CTAFlowService(AppDbContext context, IMessageEngineService messageEngineService,
            IWhatsAppTemplateFetcherService templateFetcherService
            )
        {
            _context = context;
            _messageEngineService = messageEngineService;
            _templateFetcherService = templateFetcherService;
        }

        public async Task<Guid> CreateFlowWithStepsAsync(CreateFlowDto dto, Guid businessId, string createdBy)
        {
            var flow = new CTAFlowConfig
            {
                Id = Guid.NewGuid(),
                FlowName = dto.FlowName,
                BusinessId = businessId,
                CreatedAt = DateTime.UtcNow,
                CreatedBy = createdBy,
                IsPublished = dto.IsPublished
            };

            foreach (var stepDto in dto.Steps)
            {
                var step = new CTAFlowStep
                {
                    Id = Guid.NewGuid(),
                    CTAFlowConfigId = flow.Id,
                    TriggerButtonText = stepDto.TriggerButtonText,
                    TriggerButtonType = stepDto.TriggerButtonType,
                    TemplateToSend = stepDto.TemplateToSend,
                    StepOrder = stepDto.StepOrder,
                    ButtonLinks = stepDto.ButtonLinks?.Select(link => new FlowButtonLink
                    {
                        ButtonText = link.ButtonText,
                        NextStepId = link.NextStepId
                    }).ToList() ?? new List<FlowButtonLink>()
                };

                flow.Steps.Add(step);
            }

            _context.CTAFlowConfigs.Add(flow);
            await _context.SaveChangesAsync();

            return flow.Id;
        }

        public async Task<CTAFlowConfig?> GetFlowByBusinessAsync(Guid businessId)
        {
            return await _context.CTAFlowConfigs
                .Include(f => f.Steps.OrderBy(s => s.StepOrder))
                .Where(f => f.BusinessId == businessId && f.IsActive && f.IsPublished)
                .FirstOrDefaultAsync();
        }

        public async Task<CTAFlowConfig?> GetDraftFlowByBusinessAsync(Guid businessId)
        {
            return await _context.CTAFlowConfigs
                .Include(f => f.Steps)
                    .ThenInclude(s => s.ButtonLinks)
                .Where(f => f.BusinessId == businessId && f.IsPublished == false)
                .OrderByDescending(f => f.CreatedAt)
                .FirstOrDefaultAsync();
        }



        public async Task<List<CTAFlowStep>> GetStepsForFlowAsync(Guid flowId)
        {
            return await _context.CTAFlowSteps
                .Where(s => s.CTAFlowConfigId == flowId)
                .OrderBy(s => s.StepOrder)
                .ToListAsync();
        }

        public async Task<CTAFlowStep?> MatchStepByButtonAsync(
            Guid businessId,
            string buttonText,
            string buttonType,
            string TemplateName,
            Guid? campaignId = null)
        {
            var normalizedButtonText = buttonText?.Trim().ToLower() ?? "";
            var normalizedButtonType = buttonType?.Trim().ToLower() ?? "";
            var normalizedTemplateName = TemplateName?.Trim().ToLower() ?? "";

            // 1️⃣ Try campaign-specific override
            if (campaignId.HasValue)
            {
                var overrideStep = await _context.CampaignFlowOverrides
                    .Where(o =>
                        o.CampaignId == campaignId &&
                        o.ButtonText.ToLower() == normalizedButtonText &&
                        o.TemplateName.ToLower() == normalizedTemplateName)
                    .FirstOrDefaultAsync();

                if (overrideStep != null)
                {
                    var overrideTemplate = overrideStep.OverrideNextTemplate?.ToLower();

                    var matched = await _context.CTAFlowSteps
                        .Include(s => s.Flow)
                        .FirstOrDefaultAsync(s => s.TemplateToSend.ToLower() == overrideTemplate);

                    if (matched != null)
                    {
                        Log.Information("🔁 Override matched: Template '{Template}' → Step '{StepId}'", overrideStep.OverrideNextTemplate, matched.Id);
                        return matched;
                    }

                    Log.Warning("⚠️ Override found for button '{Button}' but no matching step for template '{Template}'", normalizedButtonText, overrideStep.OverrideNextTemplate);
                }

                else
                {
                    Log.Information("🟡 No campaign override found for button '{Button}' on template '{Template}'", normalizedButtonText, normalizedTemplateName);
                }
            }

            // 2️⃣ Fallback to standard flow logic
            var fallbackStep = await _context.CTAFlowSteps
                .Include(s => s.Flow)
                .Where(s =>
                    s.Flow.BusinessId == businessId &&
                    s.Flow.IsActive &&
                    s.Flow.IsPublished &&
                    s.TriggerButtonText.ToLower() == normalizedButtonText &&
                    s.TriggerButtonType.ToLower() == normalizedButtonType)
                .FirstOrDefaultAsync();

            if (fallbackStep != null)
            {
                Log.Information("✅ Fallback flow step matched: StepId = {StepId}, Flow = {FlowName}", fallbackStep.Id, fallbackStep.Flow?.FlowName);
            }
            else
            {
                Log.Warning("❌ No fallback step matched for button '{ButtonText}' of type '{ButtonType}' in BusinessId: {BusinessId}", normalizedButtonText, normalizedButtonType, businessId);
            }

            return fallbackStep;
        }



        public async Task<ResponseResult> PublishFlowAsync(Guid businessId, List<FlowStepDto> steps, string createdBy)
        {
            try
            {
                // 🔥 1. Remove existing published flow for this business
                var existingFlows = await _context.CTAFlowConfigs
                    .Where(f => f.BusinessId == businessId && f.IsPublished)
                    .ToListAsync();

                if (existingFlows.Any())
                {
                    _context.CTAFlowConfigs.RemoveRange(existingFlows);
                }

                // 🌱 2. Create new flow config
                var flowConfig = new CTAFlowConfig
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    FlowName = "Published Flow - " + DateTime.UtcNow.ToString("yyyyMMdd-HHmm"),
                    IsPublished = true,
                    IsActive = true,
                    CreatedBy = createdBy,
                    CreatedAt = DateTime.UtcNow,
                    Steps = new List<CTAFlowStep>()
                };

                // 🔁 3. Convert each step DTO to model
                foreach (var stepDto in steps)
                {
                    var step = new CTAFlowStep
                    {
                        Id = Guid.NewGuid(),
                        CTAFlowConfigId = flowConfig.Id,
                        TriggerButtonText = stepDto.TriggerButtonText,
                        TriggerButtonType = stepDto.TriggerButtonType,
                        TemplateToSend = stepDto.TemplateToSend,
                        StepOrder = stepDto.StepOrder,
                        ButtonLinks = stepDto.ButtonLinks.Select(bl => new FlowButtonLink
                        {
                            Id = Guid.NewGuid(),
                            ButtonText = bl.ButtonText,
                            NextStepId = bl.NextStepId,
                        }).ToList()
                    };

                    flowConfig.Steps.Add(step);
                }

                // 💾 4. Save to DB
                await _context.CTAFlowConfigs.AddAsync(flowConfig);
                await _context.SaveChangesAsync();

                return ResponseResult.SuccessInfo("✅ Flow published successfully.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error while publishing CTA flow.");
                return ResponseResult.ErrorInfo("❌ Could not publish flow.");
            }
        }
        public async Task<ResponseResult> SaveVisualFlowAsync(SaveVisualFlowDto dto, Guid businessId, string createdBy)
        {
            try
            {
                Log.Information("🧠 SaveVisualFlow started | FlowName: {FlowName} | BusinessId: {BusinessId}", dto.FlowName, businessId);

                if (dto.Nodes == null || !dto.Nodes.Any())
                {
                    Log.Warning("❌ No nodes found in flow. Aborting save.");
                    return ResponseResult.ErrorInfo("❌ Cannot save an empty flow. Please add at least one step.");
                }

                var existing = await _context.CTAFlowConfigs
                    .FirstOrDefaultAsync(f => f.FlowName == dto.FlowName && f.BusinessId == businessId);

                if (existing == null)
                {
                    existing = new CTAFlowConfig
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        FlowName = dto.FlowName,
                        CreatedBy = createdBy,
                        CreatedAt = DateTime.UtcNow,
                        UpdatedAt = DateTime.UtcNow,
                        IsActive = true,
                        IsPublished = dto.IsPublished
                    };
                    _context.CTAFlowConfigs.Add(existing);
                    Log.Information("✅ New FlowConfig created with ID: {Id}", existing.Id);
                }
                else
                {
                    var oldSteps = await _context.CTAFlowSteps
                        .Where(s => s.CTAFlowConfigId == existing.Id)
                        .Include(s => s.ButtonLinks)
                        .ToListAsync();

                    foreach (var step in oldSteps)
                        _context.FlowButtonLinks.RemoveRange(step.ButtonLinks);

                    _context.CTAFlowSteps.RemoveRange(oldSteps);
                    existing.IsPublished = dto.IsPublished;
                    existing.UpdatedAt = DateTime.UtcNow;
                }

                var stepMap = new Dictionary<string, CTAFlowStep>();

                foreach (var (node, index) in dto.Nodes.Select((n, i) => (n, i)))
                {
                    if (string.IsNullOrWhiteSpace(node.Id))
                        continue;

                    var step = new CTAFlowStep
                    {
                        Id = Guid.NewGuid(),
                        CTAFlowConfigId = existing.Id,
                        StepOrder = index,
                        TemplateToSend = node.TemplateName,
                        TemplateType = node.TemplateType ?? "UNKNOWN",
                        TriggerButtonText = node.TriggerButtonText ?? "",
                        TriggerButtonType = node.TriggerButtonType ?? "cta",
                        PositionX = node.PositionX == 0 ? Random.Shared.Next(100, 600) : node.PositionX,
                        PositionY = node.PositionY == 0 ? Random.Shared.Next(100, 400) : node.PositionY,
                        ButtonLinks = new List<FlowButtonLink>()
                    };

                    stepMap[node.Id] = step;
                    _context.CTAFlowSteps.Add(step);
                }

                foreach (var edge in dto.Edges)
                {
                    if (!stepMap.TryGetValue(edge.FromNodeId, out var fromStep) ||
                        !stepMap.TryGetValue(edge.ToNodeId, out var toStep))
                        continue;

                    var sourceNode = dto.Nodes.FirstOrDefault(n => n.Id == edge.FromNodeId);
                    var button = sourceNode?.Buttons?.FirstOrDefault(b => b.Text == edge.SourceHandle);
                    var fallbackText = edge.SourceHandle ?? "[unnamed]";

                    var link = new FlowButtonLink
                    {
                        Id = Guid.NewGuid(),
                        CTAFlowStepId = fromStep.Id,
                        ButtonText = fallbackText,
                        ButtonType = button?.Type ?? "QUICK_REPLY",
                        ButtonSubType = button?.SubType ?? "",
                        ButtonValue = button?.Value ?? "",
                        NextStepId = toStep.Id
                    };

                    _context.FlowButtonLinks.Add(link); // ✅ Force EF to track this link properly
                    fromStep.ButtonLinks.Add(link);     // ✅ Optional if navigation is used

                    toStep.TriggerButtonText = fallbackText;
                    toStep.TriggerButtonType = button?.Type ?? "quick_reply";
                }

                await _context.SaveChangesAsync();

                Log.Information("✅ Flow '{Flow}' saved | Steps: {StepCount} | Links: {LinkCount}",
                    dto.FlowName, stepMap.Count, stepMap.Values.Sum(s => s.ButtonLinks.Count));

                return ResponseResult.SuccessInfo("✅ Flow saved successfully.");
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception while saving flow");
                return ResponseResult.ErrorInfo("❌ Internal error while saving flow.");
            }
        }

        public async Task<SaveVisualFlowDto?> GetVisualFlowByIdAsync(Guid flowId)
        {
            var flow = await _context.CTAFlowConfigs
                .Include(c => c.Steps)
                    .ThenInclude(s => s.ButtonLinks)
                .FirstOrDefaultAsync(c => c.Id == flowId && c.IsActive);

            if (flow == null) return null;

            var businessId = flow.BusinessId;

            // ✅ Pre-fetch templates from Meta
            var templateMap = new Dictionary<string, TemplateMetadataDto>();

            foreach (var step in flow.Steps)
            {
                if (!string.IsNullOrWhiteSpace(step.TemplateToSend) && !templateMap.ContainsKey(step.TemplateToSend))
                {
                    try
                    {
                        var template = await _templateFetcherService.GetTemplateByNameAsync(
                            businessId,
                            step.TemplateToSend,
                            includeButtons: true
                        );

                        if (template != null)
                            templateMap[step.TemplateToSend] = template;
                    }
                    catch (Exception ex)
                    {
                        Log.Warning(ex, "⚠️ Failed to fetch template from Meta for {Template}", step.TemplateToSend);
                    }
                }
            }

            // ✅ Map into ReactFlow-compatible structure
            var nodes = flow.Steps.Select(step =>
            {
                var template = templateMap.GetValueOrDefault(step.TemplateToSend);

                return new FlowNodeDto
                {
                    Id = step.Id.ToString(),
                    TemplateName = step.TemplateToSend,
                    MessageBody = template?.Body ?? "Message body preview...",
                    TriggerButtonText = step.TriggerButtonText,
                    TriggerButtonType = step.TriggerButtonType,
                    PositionX = step.PositionX ?? 100,
                    PositionY = step.PositionY ?? 100,

                    // ✅ NEW: Include conditional logic
                    RequiredTag = step.RequiredTag,
                    RequiredSource = step.RequiredSource,

                    Buttons = step.ButtonLinks.Select(link => new LinkButtonDto
                    {
                        Text = link.ButtonText,
                        TargetNodeId = link.NextStepId.ToString()
                    }).ToList()
                             .Concat((template?.ButtonParams ?? new List<ButtonMetadataDto>())
                                 .Where(btn => !step.ButtonLinks.Any(bl => bl.ButtonText == btn.Text))
                                 .Select(btn => new LinkButtonDto
                                 {
                                     Text = btn.Text,
                                     TargetNodeId = null
                                 })).ToList()
                };

            }).ToList();

            return new SaveVisualFlowDto
            {
                FlowName = flow.FlowName,
                IsPublished = flow.IsPublished,
                Nodes = nodes,
                Edges = flow.Steps
                        .SelectMany(step =>
                            step.ButtonLinks.Select(link => new FlowEdgeDto
                            {
                                FromNodeId = step.Id.ToString(),
                                ToNodeId = link.NextStepId.ToString(),
                                SourceHandle = link.ButtonText // ✅ important
                            })
                        ).ToList()

            };
        }


        public async Task<ResponseResult> DeleteFlowAsync(Guid id, Guid businessId)
        {
            var flow = await _context.CTAFlowConfigs
                .Where(f => f.Id == id && f.BusinessId == businessId)
                .FirstOrDefaultAsync();

            if (flow == null)
                return ResponseResult.ErrorInfo("❌ Flow not found or does not belong to you.");

            _context.CTAFlowConfigs.Remove(flow);
            await _context.SaveChangesAsync();

            return ResponseResult.SuccessInfo("✅ Flow deleted successfully.");
        }
        public async Task<List<VisualFlowSummaryDto>> GetAllPublishedFlowsAsync(Guid businessId)
        {
            return await _context.CTAFlowConfigs
                .Where(f => f.BusinessId == businessId && f.IsPublished)
                .OrderByDescending(f => f.CreatedAt)
                .Select(f => new VisualFlowSummaryDto
                {
                    Id = f.Id,
                    FlowName = f.FlowName,
                    IsPublished = f.IsPublished,
                    CreatedAt = f.CreatedAt
                })
                .ToListAsync();
        }

        public async Task<List<VisualFlowSummaryDto>> GetAllDraftFlowsAsync(Guid businessId)
        {
            return await _context.CTAFlowConfigs
                .Where(f => f.BusinessId == businessId && !f.IsPublished && f.IsActive)
                .OrderByDescending(f => f.CreatedAt)
                .Select(f => new VisualFlowSummaryDto
                {
                    Id = f.Id,
                    FlowName = f.FlowName,
                    CreatedAt = f.CreatedAt,
                    IsPublished = f.IsPublished
                })
                .ToListAsync();
        }

        public async Task<ResponseResult> ExecuteFollowUpStepAsync(Guid businessId, CTAFlowStep? currentStep, string recipientNumber)
        {
            // Log.Information("🚀 Executing follow-up for BusinessId: {BusinessId}, CurrentStepId: {StepId}", businessId);
            if (currentStep == null)
            {
                Log.Warning("⚠️ Cannot execute follow-up. Current step is null.");
                return ResponseResult.ErrorInfo("Current step not found.");
            }

            // 🧠 Step: Look through all button links for a valid NextStepId
            var nextLink = currentStep.ButtonLinks.FirstOrDefault(link => link.NextStepId != null);

            if (nextLink == null)
            {
                Log.Information("ℹ️ No NextStepId defined in any ButtonLinks for StepId: {StepId}", currentStep.Id);
                return ResponseResult.SuccessInfo("No follow-up step to execute.");
            }

            // 🔍 Fetch the next step using new logic (via CTAFlowConfig + Steps)
            // 1️⃣ Try to resolve with smart condition check
            var followUpStep = await GetChainedStepAsync(businessId, nextLink.NextStepId, null, null);

            if (followUpStep == null)
            {
                Log.Warning("❌ Follow-up step skipped due to condition mismatch → StepId: {StepId}", nextLink.NextStepId);

                // 2️⃣ Optional fallback: Try same flow → Any step without conditions
                var flow = await _context.CTAFlowConfigs
                    .Include(f => f.Steps)
                    .FirstOrDefaultAsync(f => f.BusinessId == businessId && f.IsPublished);

                followUpStep = flow?.Steps
                    .Where(s => string.IsNullOrEmpty(s.RequiredTag) && string.IsNullOrEmpty(s.RequiredSource))
                    .OrderBy(s => s.StepOrder)
                    .FirstOrDefault();

                if (followUpStep != null)
                {
                    Log.Information("🔁 Fallback step selected → StepId: {StepId}, Template: {Template}",
                        followUpStep.Id, followUpStep.TemplateToSend);
                }
                else
                {
                    Log.Warning("🚫 No suitable fallback found in flow. Skipping follow-up.");
                    return ResponseResult.SuccessInfo("No matching follow-up step based on user context.");
                }
            }


            // 📨 Send the follow-up message using the TemplateToSend field
            try
            {
                var template = followUpStep.TemplateToSend;

                Log.Information("📤 Sending follow-up message → Template: {Template}, To: {Recipient}", template, recipientNumber);

                // 🧪 Replace this with actual message engine call
                var sendDto = new SimpleTemplateMessageDto
                {
                    RecipientNumber = recipientNumber,
                    TemplateName = template,
                    TemplateParameters = new List<string>() // Add dynamic params later if needed
                };

                var sendResult = await _messageEngineService
     .SendTemplateMessageSimpleAsync(businessId, sendDto);

                if (!sendResult.Success)
                {
                    Log.Warning("❌ Follow-up message send failed → {Template}", template);
                    return ResponseResult.ErrorInfo("Follow-up send failed.", sendResult.ErrorMessage);
                }


                return ResponseResult.SuccessInfo($"Follow-up message sent using template: {template}", null, sendResult.RawResponse);

            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error sending follow-up message for StepId: {StepId}", followUpStep.Id);
                return ResponseResult.ErrorInfo("Failed to send follow-up.");
            }
        }
        //public async Task<CTAFlowStep?> GetChainedStepAsync(Guid businessId, Guid? nextStepId)
        //{
        //    // 🧠 If there's no next step to look up, just return null
        //    if (nextStepId == null)
        //    {
        //        Log.Information("ℹ️ No NextStepId provided — skipping follow-up.");
        //        return null;
        //    }

        //    try
        //    {
        //        // 🧲 Step 1: Find the flow that contains the step and belongs to the business
        //        var flow = await _context.CTAFlowConfigs
        //            .Include(f => f.Steps)
        //            .FirstOrDefaultAsync(f =>
        //                f.BusinessId == businessId &&
        //                f.Steps.Any(s => s.Id == nextStepId));

        //        if (flow == null)
        //        {
        //            Log.Warning("⚠️ No flow found containing NextStepId: {NextStepId} for business: {BusinessId}", nextStepId, businessId);
        //            return null;
        //        }

        //        // 🔁 Step 2: Extract the matching step from the flow's step list
        //        var followUpStep = flow.Steps.FirstOrDefault(s => s.Id == nextStepId);

        //        if (followUpStep == null)
        //        {
        //            Log.Warning("❌ NextStepId matched in flow but not found in step list: {NextStepId}", nextStepId);
        //            return null;
        //        }

        //        Log.Information("✅ Follow-up step found → StepId: {StepId}, Template: {Template}", followUpStep.Id, followUpStep.TemplateToSend);
        //        return followUpStep;
        //    }
        //    catch (Exception ex)
        //    {
        //        Log.Error(ex, "❌ Exception while fetching chained step for NextStepId: {NextStepId}", nextStepId);
        //        throw;
        //    }
        //}
        // ✅ Interface-compatible method (required by ICTAFlowService)
        public Task<CTAFlowStep?> GetChainedStepAsync(Guid businessId, Guid? nextStepId)
        {
            return GetChainedStepAsync(businessId, nextStepId, null, null); // Forward to full logic
        }

        // ✅ Extended logic with condition check (Tag + Source)
        public async Task<CTAFlowStep?> GetChainedStepAsync(
            Guid businessId,
            Guid? nextStepId,
            TrackingLog? trackingLog = null,
            Contact? contact = null)
        {
            if (nextStepId == null)
            {
                Log.Information("ℹ️ No NextStepId provided — skipping follow-up.");
                return null;
            }

            try
            {
                var flow = await _context.CTAFlowConfigs
                    .Include(f => f.Steps)
                    .FirstOrDefaultAsync(f =>
                        f.BusinessId == businessId &&
                        f.Steps.Any(s => s.Id == nextStepId));

                if (flow == null)
                {
                    Log.Warning("⚠️ No flow found containing NextStepId: {NextStepId} for business: {BusinessId}", nextStepId, businessId);
                    return null;
                }

                var followUpStep = flow.Steps.FirstOrDefault(s => s.Id == nextStepId);

                if (followUpStep == null)
                {
                    Log.Warning("❌ Step matched in flow but not found in step list: {NextStepId}", nextStepId);
                    return null;
                }

                // ✅ Check RequiredTag / Source match
                if (trackingLog != null)
                {
                    var isMatch = StepMatchingHelper.IsStepMatched(followUpStep, trackingLog, contact);

                    if (!isMatch)
                    {
                        Log.Information("🚫 Step {StepId} skipped due to condition mismatch [Tag: {Tag}, Source: {Source}]",
                            followUpStep.Id, followUpStep.RequiredTag, followUpStep.RequiredSource);
                        return null;
                    }
                }

                Log.Information("✅ Follow-up step found and matched → StepId: {StepId}, Template: {Template}",
                    followUpStep.Id, followUpStep.TemplateToSend);

                return followUpStep;
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception while fetching chained step for NextStepId: {NextStepId}", nextStepId);
                throw;
            }
        }

        // ✅ Optional helper for resolving from TrackingLogId
        public async Task<CTAFlowStep?> GetChainedStepWithContextAsync(
            Guid businessId,
            Guid? nextStepId,
            Guid? trackingLogId)
        {
            var log = await _context.TrackingLogs
                .Include(l => l.Contact)
                    .ThenInclude(c => c.ContactTags)
                        .ThenInclude(ct => ct.Tag)
                .FirstOrDefaultAsync(l => l.Id == trackingLogId);

            return await GetChainedStepAsync(businessId, nextStepId, log, log?.Contact);
        }

        public async Task<ResponseResult> ExecuteVisualFlowAsync(Guid businessId, Guid startStepId, Guid trackingLogId)
        {
            try
            {
                Log.Information("🚦 Executing Visual Flow → StepId: {StepId} | TrackingLogId: {TrackingLogId}", startStepId, trackingLogId);

                var log = await _context.TrackingLogs
                    .Include(l => l.Contact)
                        .ThenInclude(c => c.ContactTags)
                            .ThenInclude(ct => ct.Tag)
                    .FirstOrDefaultAsync(l => l.Id == trackingLogId);

                if (log == null)
                {
                    Log.Warning("❌ TrackingLog not found for ID: {TrackingLogId}", trackingLogId);
                    return ResponseResult.ErrorInfo("Tracking log not found.");
                }

                var step = await GetChainedStepAsync(businessId, startStepId, log, log?.Contact);

                if (step == null)
                {
                    Log.Warning("❌ No flow step matched or conditions failed → StepId: {StepId}", startStepId);
                    return ResponseResult.ErrorInfo("Step conditions not satisfied.");
                }

                ResponseResult sendResult;

                switch (step.TemplateType?.ToLower())
                {
                    case "image_template":
                        var imageDto = new ImageTemplateMessageDto
                        {
                            BusinessId = businessId,
                            RecipientNumber = log.ContactPhone ?? "",
                            TemplateName = step.TemplateToSend,
                            LanguageCode = "en_US"
                        };
                        sendResult = await _messageEngineService.SendImageTemplateMessageAsync(imageDto, businessId);
                        break;

                    case "text_template":
                    default:
                        var textDto = new SimpleTemplateMessageDto
                        {
                            RecipientNumber = log.ContactPhone ?? "",
                            TemplateName = step.TemplateToSend,
                            TemplateParameters = new()
                        };
                        sendResult = await _messageEngineService.SendTemplateMessageSimpleAsync(businessId, textDto);
                        break;

                }

                // ✅ Save FlowExecutionLog
                var executionLog = new FlowExecutionLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    StepId = step.Id,
                    FlowId = step.CTAFlowConfigId,
                    TrackingLogId = trackingLogId,
                    ContactPhone = log.ContactPhone,
                    TriggeredByButton = step.TriggerButtonText,
                    TemplateName = step.TemplateToSend,
                    TemplateType = step.TemplateType,
                    Success = sendResult.Success,
                    ErrorMessage = sendResult.ErrorMessage,
                    RawResponse = sendResult.RawResponse,
                    ExecutedAt = DateTime.UtcNow
                };

                _context.FlowExecutionLogs.Add(executionLog);
                await _context.SaveChangesAsync();

                if (sendResult.Success)
                {
                    Log.Information("✅ Flow step executed → Template: {Template} sent to {To}", step.TemplateToSend, log.ContactPhone);
                }
                else
                {
                    Log.Warning("❌ Failed to send template from flow → {Reason}", sendResult.ErrorMessage);
                }

                return ResponseResult.SuccessInfo($"Flow step executed. Sent: {sendResult.Success}", null, sendResult.RawResponse);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception during ExecuteVisualFlowAsync()");
                return ResponseResult.ErrorInfo("Internal error during flow execution.");
            }
        }


    }
}

``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Services/ICTAFlowService.cs  (sha256:3b6373da378998c305a07f641d68d3e2a9c18666f9a8e2389758c5925162038b)
`$lang
using xbytechat.api.Features.CTAFlowBuilder.DTOs;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.CTAFlowBuilder.Services
{
    public interface ICTAFlowService
    {
        // ✅ Used for flow creation and saving
        Task<Guid> CreateFlowWithStepsAsync(CreateFlowDto dto, Guid businessId, string createdBy);
        Task<ResponseResult> SaveVisualFlowAsync(SaveVisualFlowDto dto, Guid businessId, string createdBy);

        // ✅ Load flows
        Task<CTAFlowConfig?> GetFlowByBusinessAsync(Guid businessId);
        Task<CTAFlowConfig?> GetDraftFlowByBusinessAsync(Guid businessId);
        Task<List<VisualFlowSummaryDto>> GetAllPublishedFlowsAsync(Guid businessId);
        Task<List<VisualFlowSummaryDto>> GetAllDraftFlowsAsync(Guid businessId);

        // ✅ Load and manage flow steps
        Task<List<CTAFlowStep>> GetStepsForFlowAsync(Guid flowId);

        //Task<CTAFlowStep?> MatchStepByButtonAsync(Guid businessId, string buttonText, string buttonType);
        Task<CTAFlowStep?> MatchStepByButtonAsync(Guid businessId, string buttonText,string buttonType,string currentTemplateName,Guid? campaignId = null);


        Task<CTAFlowStep?> GetChainedStepAsync(Guid businessId, Guid? nextStepId);
        Task<CTAFlowStep?> GetChainedStepWithContextAsync(Guid businessId, Guid? nextStepId, Guid? trackingLogId);
        // ✅ Runtime logic
        Task<ResponseResult> ExecuteFollowUpStepAsync(Guid businessId, CTAFlowStep? currentStep, string recipientNumber);

        // ✅ Flow management
        Task<ResponseResult> PublishFlowAsync(Guid businessId, List<FlowStepDto> steps, string createdBy);
        Task<ResponseResult> DeleteFlowAsync(Guid id, Guid businessId);

        // ✅ Editor loading (visual builder)
        Task<SaveVisualFlowDto?> GetVisualFlowByIdAsync(Guid id);

        Task<ResponseResult> ExecuteVisualFlowAsync(Guid businessId, Guid startStepId, Guid trackingLogId);

    }
}



``n
--- file: xbytechat-api/Features/CTAFlowBuilder/Services/StepMatchingHelper.cs  (sha256:3353c5195c81af5b7a26a5a7f648e6dc4504f54633d408220670d2dba65a5888)
`$lang
using Serilog;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Features.Tracking.Models;

namespace xbytechat.api.Features.CTAFlowBuilder.Services
{
    public static class StepMatchingHelper
    {
        public static bool IsStepMatched(CTAFlowStep step, TrackingLog log, Contact? contact)
        {
            if (!string.IsNullOrWhiteSpace(step.RequiredSource) &&
                !string.Equals(step.RequiredSource, log.SourceType, StringComparison.OrdinalIgnoreCase))
            {
                Log.Information("🚫 Step [{StepId}] skipped: RequiredSource '{Required}' ≠ ClickedSource '{Actual}'",
                    step.Id, step.RequiredSource, log.SourceType);
                return false;
            }

            if (!string.IsNullOrWhiteSpace(step.RequiredTag))
            {
                if (contact == null || contact.ContactTags == null || !contact.ContactTags.Any())
                {
                    Log.Information("🚫 Step [{StepId}] skipped: Contact or Tags missing (RequiredTag: {RequiredTag})",
                        step.Id, step.RequiredTag);
                    return false;
                }

                var hasTag = contact.ContactTags.Any(ct =>
                    string.Equals(ct.Tag.Name, step.RequiredTag, StringComparison.OrdinalIgnoreCase));

                if (!hasTag)
                {
                    var contactTags = string.Join(", ", contact.ContactTags.Select(ct => ct.Tag.Name));
                    Log.Information("🚫 Step [{StepId}] skipped: Contact tags [{Tags}] do not include RequiredTag '{Required}'",
                        step.Id, contactTags, step.RequiredTag);
                    return false;
                }
            }

            return true;
        }

    }
}

``n
--- file: xbytechat-api/Features/CTAManagement/Controllers/CTAManagementController.cs  (sha256:3d06022ca06d6b4e214bf6e571b79d311da0902eeadebddc1f7d48c18a1ecb99)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.CTAManagement.DTOs;
using xbytechat.api.Features.CTAManagement.Services;

namespace xbytechat.api.Features.CTAManagement.Controllers
{
    [ApiController]
    [Route("api/ctamanagement")]
    [Authorize] // ✅ Ensures only authenticated users can access
    public class CTAManagementController : ControllerBase
    {
        private readonly ICTAManagementService _ctaService;

        public CTAManagementController(ICTAManagementService ctaService)
        {
            _ctaService = ctaService;
        }

        // ✅ GET: api/ctamanagement/get-all
        [HttpGet("get-all")]
        public async Task<IActionResult> GetAll()
        {
            var data = await _ctaService.GetAllAsync();
            return Ok(data);
        }

        // 📌 GET: api/ctamanagement/get/{id}
        [HttpGet("get/{id}")]
        public async Task<IActionResult> GetById(Guid id)
        {
            var result = await _ctaService.GetByIdAsync(id);
            return result == null ? NotFound("CTA not found") : Ok(result);
        }

        // ✅ POST: api/ctamanagement/create
        [HttpPost("create")]
        public async Task<IActionResult> Create([FromBody] CTADefinitionDto dto)
        {
            if (!ModelState.IsValid)
                return BadRequest("❌ Invalid CTA payload.");

            var success = await _ctaService.AddAsync(dto);
            return success
                ? Ok(new { message = "✅ CTA created." })
                : StatusCode(500, "❌ Failed to create CTA.");
        }

        // ✏️ PUT: api/ctamanagement/update/{id}
        [HttpPut("update/{id}")]
        public async Task<IActionResult> Update(Guid id, [FromBody] CTADefinitionDto dto)
        {
            if (!ModelState.IsValid)
                return BadRequest("❌ Invalid CTA payload.");

            var success = await _ctaService.UpdateAsync(id, dto);
            return success
                ? Ok(new { message = "✅ CTA updated." })
                : NotFound("CTA not found or update failed.");
        }

        // 🗑️ DELETE: api/ctamanagement/delete/{id}
        [HttpDelete("delete/{id}")]
        public async Task<IActionResult> Delete(Guid id)
        {
            var success = await _ctaService.DeleteAsync(id);
            return success
                ? Ok(new { message = "✅ CTA deleted (soft)." })
                : NotFound("CTA not found or delete failed.");
        }
    }
}

``n
--- file: xbytechat-api/Features/CTAManagement/DTOs/CTADefinitionDto.cs  (sha256:1472d3694a4cebf363c3a632675fe61b8646f610f7a96a2687286bfb47d8eacf)
`$lang
namespace xbytechat.api.Features.CTAManagement.DTOs
{
    public class CTADefinitionDto
    {
        public Guid Id { get; set; }

        public string Title { get; set; } = string.Empty; // 🏷️ CTA label (e.g., "Buy Now")

        public string ButtonText { get; set; } = string.Empty; // 💬 Visible button label (e.g., "Buy Now")

        public string ButtonType { get; set; } = "url"; // 🔘 Expected values: "url", "quick_reply", etc.

        public string TargetUrl { get; set; } = string.Empty; // 🌐 Redirect or action target

        public string? Description { get; set; } // 📝 Optional description (for context/tooltip)

        public bool IsActive { get; set; } = true;
    }
}

``n
--- file: xbytechat-api/Features/CTAManagement/Models/CTADefinition.cs  (sha256:96216798bd31e2098b9a2ba43dac62e067f7062f5e5c36bb318a8dab2f74da38)
`$lang
using System;

namespace xbytechat.api.Features.CTAManagement.Models
{
    public class CTADefinition
    {
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; } // 🔗 Business that owns this CTA

        public string Title { get; set; } = string.Empty; // 🏷️ CTA label/title, e.g., "Buy Now"

        public string ButtonText { get; set; } = string.Empty; // 💬 Visible button label

        public string ButtonType { get; set; } = "url"; // 🔘 Options: "url", "quick_reply", etc.

        public string TargetUrl { get; set; } = string.Empty; // 🌐 Action URL or value (depending on type)

        public string Description { get; set; } = string.Empty; // 📝 Optional additional context

        public bool IsActive { get; set; } = true;

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public DateTime? UpdatedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/CTAManagement/Services/CTAManagementService.cs  (sha256:a9388986726208c45f05afa2bd4ed3c74b33d7d79eb0e5863b7256e061ba4081)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.CTAManagement.DTOs;
using xbytechat.api.Features.CTAManagement.Models;

namespace xbytechat.api.Features.CTAManagement.Services
{
    public class CTAManagementService : ICTAManagementService
    {
        private readonly AppDbContext _dbContext;
        private readonly IHttpContextAccessor _httpContextAccessor;

        public CTAManagementService(AppDbContext dbContext, IHttpContextAccessor httpContextAccessor)
        {
            _dbContext = dbContext;
            _httpContextAccessor = httpContextAccessor;
        }

        // 🔄 Get all active CTAs for the current business
        public async Task<List<CTADefinitionDto>> GetAllAsync()
        {
            var businessId = GetBusinessIdFromClaims();

            return await _dbContext.CTADefinitions
                .Where(c => c.IsActive && c.BusinessId == businessId)
                .Select(c => new CTADefinitionDto
                {
                    Id = c.Id,
                    Title = c.Title,
                    ButtonText = c.ButtonText,
                    ButtonType = c.ButtonType,
                    TargetUrl = c.TargetUrl,
                    Description = c.Description,
                    IsActive = c.IsActive
                }).ToListAsync();
        }

        // ✅ Add new CTA
        public async Task<bool> AddAsync(CTADefinitionDto dto)
        {
            var businessId = GetBusinessIdFromClaims();

            var cta = new CTADefinition
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                Title = dto.Title,
                ButtonText = dto.ButtonText,
                ButtonType = dto.ButtonType,
                TargetUrl = dto.TargetUrl,
                Description = dto.Description ?? "",
                IsActive = true,
                CreatedAt = DateTime.UtcNow
            };

            await _dbContext.CTADefinitions.AddAsync(cta);
            await _dbContext.SaveChangesAsync();
            return true;
        }

        // 📌 Get CTA by ID
        public async Task<CTADefinitionDto?> GetByIdAsync(Guid id)
        {
            var businessId = GetBusinessIdFromClaims();

            var cta = await _dbContext.CTADefinitions
                .FirstOrDefaultAsync(c => c.Id == id && c.IsActive && c.BusinessId == businessId);

            if (cta == null) return null;

            return new CTADefinitionDto
            {
                Id = cta.Id,
                Title = cta.Title,
                ButtonText = cta.ButtonText,
                ButtonType = cta.ButtonType,
                TargetUrl = cta.TargetUrl,
                Description = cta.Description,
                IsActive = cta.IsActive
            };
        }


        // ✏️ Update CTA
        public async Task<bool> UpdateAsync(Guid id, CTADefinitionDto dto)
        {
            var cta = await _dbContext.CTADefinitions.FindAsync(id);
            if (cta == null) return false;

            var businessId = GetBusinessIdFromClaims();
            if (cta.BusinessId != businessId) throw new UnauthorizedAccessException("Unauthorized to modify this CTA.");

            cta.Title = dto.Title;
            cta.ButtonText = dto.ButtonText;
            cta.ButtonType = dto.ButtonType;
            cta.TargetUrl = dto.TargetUrl;
            cta.Description = dto.Description ?? "";
            cta.IsActive = dto.IsActive;
            cta.UpdatedAt = DateTime.UtcNow;

            await _dbContext.SaveChangesAsync();
            return true;
        }

        // 🗑️ Soft Delete CTA
        public async Task<bool> DeleteAsync(Guid id)
        {
            var cta = await _dbContext.CTADefinitions.FindAsync(id);
            if (cta == null) return false;

            var businessId = GetBusinessIdFromClaims();
            if (cta.BusinessId != businessId) throw new UnauthorizedAccessException("Unauthorized to delete this CTA.");

            cta.IsActive = false;
            cta.UpdatedAt = DateTime.UtcNow;

            await _dbContext.SaveChangesAsync();
            return true;
        }

        // 🔐 Reusable method to extract BusinessId
        private Guid GetBusinessIdFromClaims()
        {
            var claim = _httpContextAccessor.HttpContext?.User?.FindFirst("businessId");
            if (claim == null || string.IsNullOrWhiteSpace(claim.Value) || !Guid.TryParse(claim.Value, out var businessId))
                throw new UnauthorizedAccessException("❌ Invalid or missing BusinessId claim.");

            return businessId;
        }

    }
}

``n
--- file: xbytechat-api/Features/CTAManagement/Services/ICTAManagementService.cs  (sha256:f05abf40bdd4a593e8c8f8980c288884dc5701a5c9ba29261588816002758bcd)
`$lang
using xbytechat.api.Features.CTAManagement.DTOs;

namespace xbytechat.api.Features.CTAManagement.Services
{
    public interface ICTAManagementService
    {
        /// <summary>Returns all active CTAs for the current business.</summary>
        Task<List<CTADefinitionDto>> GetAllAsync();

        /// <summary>Returns a single CTA by ID (if exists).</summary>
        Task<CTADefinitionDto?> GetByIdAsync(Guid id);

        /// <summary>Adds a new CTA for the logged-in business.</summary>
        Task<bool> AddAsync(CTADefinitionDto dto);

        /// <summary>Updates an existing CTA if it belongs to the business.</summary>
        Task<bool> UpdateAsync(Guid id, CTADefinitionDto dto);

        /// <summary>Soft deletes (deactivates) a CTA entry.</summary>
        Task<bool> DeleteAsync(Guid id);
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/Controllers/FeatureAccessController.cs  (sha256:9647f14c41db42003160442c67b7f3a6c51b43423ae7bc44ac9c7fcb9be67772)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using System.Security.Claims;
using xbytechat.api;
using FeatureAccessEntity = xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess;

// If your entity namespace is different, adjust this using:
using xbytechat.api.Features.FeatureAccessModule.Models;

namespace xbytechat.api.Features.FeatureAccessModule.Controllers
{
    [ApiController]
    [Route("api/feature-access")]
    [Authorize]
    public class FeatureAccessController : ControllerBase
    {
        private readonly AppDbContext _db;

        public FeatureAccessController(AppDbContext db)
        {
            _db = db;
        }

        // DTOs to match your frontend shape
        public class FeatureMeDto
        {
            public string featureCode { get; set; } = "";
            public bool isAvailableInPlan { get; set; }
            public bool? isOverridden { get; set; } // null = not overridden
        }

        public class BusinessFeatureDto
        {
            public string featureName { get; set; } = "";
            public bool isEnabled { get; set; }
        }

        /// <summary>
        /// Returns features for the current user, merged from plan + per-business overrides
        /// Shape: [{ featureCode, isAvailableInPlan, isOverridden }]
        /// </summary>
        [HttpGet("me")]
        public async Task<IActionResult> GetMyFeatureAccess()
        {
            var user = HttpContext.User;
            if (user?.Identity is not { IsAuthenticated: true })
                return Unauthorized();

            var role = (user.FindFirst("role")?.Value ?? user.FindFirst(ClaimTypes.Role)?.Value ?? "business").ToLower();
            var plan = (user.FindFirst("plan")?.Value ?? "basic").ToLower();

            Guid businessId = Guid.Empty;
            _ = Guid.TryParse(user.FindFirst("businessId")?.Value, out businessId);

            // Superadmin: grant all known features
            if (role == "superadmin")
            {
                var allNames = await _db.FeatureAccess
                    .AsNoTracking()
                    .Select(f => f.FeatureName)
                    .Distinct()
                    .ToListAsync();

                var super = allNames.Select(name => new FeatureMeDto
                {
                    featureCode = name,
                    isAvailableInPlan = true,
                    isOverridden = true
                });

                return Ok(super);
            }

            // Load plan-level features (same entity type as DbSet)
            var planRows = await _db.FeatureAccess
                .AsNoTracking()
                .Where(f => f.Plan.ToLower() == plan)
                .ToListAsync();

            // Load business overrides using SAME type; avoid ternary type-mismatch
            List<FeatureAccessEntity> overrideRows;
            if (businessId == Guid.Empty)
            {
                overrideRows = new();
            }
            else
            {
                overrideRows = await _db.FeatureAccess
                    .AsNoTracking()
                    .Where(f => f.BusinessId == businessId)
                    .ToListAsync();
            }

            // Build base from plan, then apply overrides
            var map = new Dictionary<string, FeatureMeDto>(StringComparer.OrdinalIgnoreCase);

            foreach (var p in planRows)
            {
                if (!map.ContainsKey(p.FeatureName))
                {
                    map[p.FeatureName] = new FeatureMeDto
                    {
                        featureCode = p.FeatureName,
                        isAvailableInPlan = p.IsEnabled,
                        isOverridden = null
                    };
                }
                else
                {
                    map[p.FeatureName].isAvailableInPlan = p.IsEnabled;
                }
            }

            foreach (var o in overrideRows)
            {
                if (!map.ContainsKey(o.FeatureName))
                {
                    map[o.FeatureName] = new FeatureMeDto
                    {
                        featureCode = o.FeatureName,
                        isAvailableInPlan = false,
                        isOverridden = o.IsEnabled
                    };
                }
                else
                {
                    map[o.FeatureName].isOverridden = o.IsEnabled;
                }
            }

            return Ok(map.Values.ToArray());
        }

        /// <summary>
        /// Returns all features for a business (used by useAllFeatureAccess/useFeatureAccess hooks)
        /// Shape: [{ featureName, isEnabled }]
        /// </summary>
        [HttpGet("business/{businessId:guid}")]
        public async Task<IActionResult> GetBusinessFeatureAccess([FromRoute] Guid businessId)
        {
            // (Optional) enforce tenant isolation:
            // var currentBiz = HttpContext.User.FindFirst("businessId")?.Value;
            // if (!Guid.TryParse(currentBiz, out var bizFromToken) || bizFromToken != businessId)
            //     return Forbid();

            var rows = await _db.FeatureAccess
                .Where(f => f.BusinessId == businessId)
                .Select(f => new BusinessFeatureDto
                {
                    featureName = f.FeatureName,
                    isEnabled = f.IsEnabled
                })
                .ToListAsync();

            return Ok(rows);
        }
    }
}


//using Microsoft.AspNetCore.Authorization;
//using Microsoft.AspNetCore.Mvc;
//using Serilog;
//using xbytechat.api.Features.FeatureAccess.DTOs;
//using xbytechat.api.Features.FeatureAccessModule.DTOs;
//using xbytechat.api.Features.FeatureAccessModule.Services;
//using xbytechat.api.Shared;
//using System;

//namespace xbytechat.api.Features.FeatureAccessModule.Controllers
//{
//    [ApiController]
//    [Route("api/feature-access")]
//    public class FeatureAccessController : ControllerBase
//    {
//        private readonly IFeatureAccessService _featureAccessService;
//        private readonly IFeatureAccessEvaluator _accessEvaluator;
//        private readonly ILogger<FeatureAccessController> _logger;

//        public FeatureAccessController(
//            IFeatureAccessService featureAccessService,
//            IFeatureAccessEvaluator accessEvaluator,
//            ILogger<FeatureAccessController> logger)
//        {
//            _featureAccessService = featureAccessService;
//            _accessEvaluator = accessEvaluator;
//            _logger = logger;
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpGet]
//        public async Task<ActionResult<IEnumerable<FeatureAccessDto>>> GetAll()
//        {
//            var result = await _featureAccessService.GetAllAsync();
//            return Ok(result);
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpGet("business/{businessId}")]
//        public async Task<ActionResult<IEnumerable<FeatureAccessDto>>> GetByBusinessId(Guid businessId)
//        {
//            var result = await _featureAccessService.GetByBusinessIdAsync(businessId);
//            return Ok(result);
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpGet("{id}")]
//        public async Task<ActionResult<FeatureAccessDto>> Get(Guid id)
//        {
//            var item = await _featureAccessService.GetAsync(id);
//            return item == null ? NotFound() : Ok(item);
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpPost]
//        public async Task<ActionResult<FeatureAccessDto>> Create(FeatureAccessDto dto)
//        {
//            var created = await _featureAccessService.CreateAsync(dto);
//            return CreatedAtAction(nameof(Get), new { id = created.Id }, created);
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpPut("{id}")]
//        public async Task<ActionResult<FeatureAccessDto>> Update(Guid id, FeatureAccessDto dto)
//        {
//            var updated = await _featureAccessService.UpdateAsync(id, dto);
//            return Ok(updated);
//        }

//        [Authorize(Roles = "superadmin")]
//        [HttpDelete("{id}")]
//        public async Task<IActionResult> Delete(Guid id)
//        {
//            var success = await _featureAccessService.DeleteAsync(id);
//            return success ? NoContent() : NotFound();
//        }

//        // ✅ Unified endpoint for both SuperAdmin and Business users
//        // Accepts businessId as optional (route or query)
//        [Authorize]
//        [HttpGet("available/{businessId?}")]
//        public async Task<ActionResult<Dictionary<string, bool>>> GetAvailableFeatures(string businessId = null)
//        {
//            try
//            {
//                var role = User.FindFirst("role")?.Value?.ToLowerInvariant() ?? "";
//                var result = new Dictionary<string, bool>();
//                var allFeatures = new[] { "CRM", "Campaigns", "Catalog", "CatalogInsights", "AdminPanel", "FlowBuilder", "Messaging", "FlowInsights", "CTAFlow", "CRMInsights" };

//                _logger.LogInformation("🔍 Feature access check - Role: {Role}, BusinessId: {BusinessId}", role, businessId);

//                // ✅ Superadmin: Full access to all features
//                if (role == "superadmin")
//                {
//                    foreach (var feature in allFeatures)
//                        result[feature] = true;

//                    _logger.LogInformation("Superadmin detected. All features enabled.");
//                    return Ok(result);
//                }

//                // ✅ Business: Must have valid businessId, else 400
//                if (role == "business")
//                {
//                    if (string.IsNullOrWhiteSpace(businessId) || !Guid.TryParse(businessId, out var parsedBusinessId))
//                    {
//                        _logger.LogWarning("Feature access attempted with missing or invalid businessId by business user.");
//                        return BadRequest("Valid businessId is required for business users.");
//                    }

//                    foreach (var feature in allFeatures)
//                    {
//                        bool isAllowed = await _accessEvaluator.CanUseAsync(parsedBusinessId, feature);
//                        result[feature] = isAllowed;
//                    }

//                    _logger.LogInformation("Feature set calculated for businessId={BusinessId}", businessId);
//                    return Ok(result);
//                }

//                // ❌ Unknown/unsupported role
//                _logger.LogWarning("Access attempt with unsupported role: {Role}", role);
//                return Forbid("Role not permitted.");
//            }
//            catch (Exception ex)
//            {
//                _logger.LogError(ex, "🔥 Error in GetAvailableFeatures for businessId={BusinessId}", businessId);
//                return StatusCode(500, "Feature access calculation failed.");
//            }
//        }

//        [Authorize]
//        [HttpGet("feature-toggle-view")]
//        public async Task<IActionResult> GetToggleView()
//        {
//            try
//            {
//                Guid businessId;
//                try
//                {
//                    businessId = User.GetBusinessId();
//                }
//                catch (UnauthorizedAccessException ex)
//                {
//                    return Unauthorized(ex.Message);
//                }

//                var plan = User.FindFirst("plan")?.Value ?? "";
//                var features = await _featureAccessService.GetToggleViewAsync(businessId, plan);

//                return Ok(new
//                {
//                    success = true,
//                    data = features
//                });
//            }
//            catch (Exception ex)
//            {
//                _logger.LogError(ex, "🔥 Error in GetToggleView");
//                return StatusCode(500, "Failed to fetch feature toggle view.");
//            }
//        }

//        [Authorize]
//        [HttpPatch("{featureCode}")]
//        public async Task<IActionResult> ToggleFeatureAccess(string featureCode, [FromBody] FeatureTogglePatchDto dto)
//        {
//            try
//            {
//                var businessId = User.GetBusinessId();
//                await _featureAccessService.ToggleFeatureAsync(businessId, featureCode, dto.IsEnabled);
//                return Ok(new { success = true });
//            }
//            catch (Exception ex)
//            {
//                _logger.LogError(ex, "🔥 Error toggling feature access for code={FeatureCode}", featureCode);
//                return StatusCode(500, "Failed to toggle feature.");
//            }
//        }

//        [Authorize]
//        [HttpGet("user-permissions")]
//        public async Task<IActionResult> GetAllUserPermissions()
//        {
//            try
//            {
//                var businessId = User.GetBusinessId();
//                var users = await _featureAccessService.GetAllUserPermissionsAsync(businessId);
//                return Ok(new { success = true, data = users });
//            }
//            catch (Exception ex)
//            {
//                _logger.LogError(ex, "🔥 Error fetching user permissions");
//                return StatusCode(500, "Failed to fetch user permissions.");
//            }
//        }

//        // ✅ Used by frontend guards like <FeatureGuard>
//        [Authorize]
//        [HttpGet("me")]
//        public async Task<ActionResult<List<FeatureStatusDto>>> GetMyFeatures()
//        {
//            try
//            {
//                //var businessIdStr = User.FindFirst("BusinessId")?.Value;
//                //if (!Guid.TryParse(businessIdStr, out var businessId))
//                //    return Unauthorized("BusinessId not found");
//                var businessIdStr = User.Claims.FirstOrDefault(c => c.Type.Equals("businessId", StringComparison.OrdinalIgnoreCase))?.Value;
//                if (!Guid.TryParse(businessIdStr, out var businessId))
//                {
//                    return Unauthorized();
//                }

//                var features = await _featureAccessService.GetFeaturesForCurrentUserAsync(businessId);
//                foreach (var claim in User.Claims)
//                {
//                    Console.WriteLine($"[{claim.Type}] = {claim.Value}");
//                }

//                return Ok(features);

//            }
//            catch (Exception ex)
//            {
//                _logger.LogError(ex, "🔥 Error fetching current user's features");
//                return StatusCode(500, "Failed to fetch features.");
//            }
//        }
//    }
//}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/FeatureAccessDto.cs  (sha256:c418561ae9075f32902a032190e2252c7eab385bbdf1028ddd5748f0190df6de)
`$lang
using System;

namespace xbytechat.api.Features.FeatureAccessModule.DTOs
{
    public class FeatureAccessDto
    {
        public Guid Id { get; set; }

        public Guid BusinessId { get; set; }

        public string FeatureName { get; set; } = string.Empty;

        public bool IsEnabled { get; set; }

        public string? Notes { get; set; }

        public DateTime CreatedAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/FeatureMetadataDto.cs  (sha256:958bb8308ae62a666fd659a66327d6b5cb0a7a66659e4048df206994ea3e9aec)
`$lang
// 📄 Features/FeatureAccessModule/DTOs/FeatureMetadataDto.cs
namespace xbytechat.api.Features.FeatureAccessModule.DTOs
{
    public class FeatureMetadataDto
    {
        public string FeatureCode { get; set; } = string.Empty;
        public string Group { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/FeatureStatusDto.cs  (sha256:36dfe2add0ad58f4e5f9e0d572e43bf68a42cc95b17f5654cacb1e7596e9715a)
`$lang
namespace xbytechat.api.Features.FeatureAccess.DTOs;

public class FeatureStatusDto
{
    public string FeatureCode { get; set; } = string.Empty;
    public bool IsAvailableInPlan { get; set; }
    public bool? IsOverridden { get; set; }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/FeatureTogglePatchDto.cs  (sha256:4663d2df320001525fb2b9ff9847b149f77677557a22efbaa7c455ed8ac3c483)
`$lang
namespace xbytechat.api.Features.FeatureAccessModule.DTOs
{
    public class FeatureTogglePatchDto
    {
        public bool IsEnabled { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/FeatureToggleViewDto.cs  (sha256:cc966666d4e050d9d16f7bab7d10f8c059305fc24a84ea7bd2642eb9a4375e8b)
`$lang
public class FeatureToggleViewDto
{
    public string FeatureCode { get; set; } = string.Empty;
    public string Group { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;

    public bool IsAvailableInPlan { get; set; }     // From PlanManager
    public bool? IsOverridden { get; set; }         // null if no override
    public bool IsActive => IsOverridden ?? IsAvailableInPlan;
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/DTOs/UserFeatureAccessDto.cs  (sha256:24a59738ee2f1924903a6e14ecf5ed5a1ce6cbb0269b34013438b37502c2efa9)
`$lang
namespace xbytechat.api.Features.FeatureAccessModule.DTOs
{
    public class UserFeatureAccessDto
    {
        public Guid Id { get; set; }
        public string FullName { get; set; } = "";
        public string Email { get; set; } = "";
        public string Role { get; set; } = "";
        public List<FeaturePermissionDto> Permissions { get; set; } = new();
    }

    public class FeaturePermissionDto
    {
        public string FeatureName { get; set; } = "";
        public bool IsEnabled { get; set; }
    }
}
``n
--- file: xbytechat-api/Features/FeatureAccessModule/Models/FeatureAccess.cs  (sha256:53331121064e4c1559420eb6de1770eb6788b85b404505420f11d5c0bb6b8fe6)
`$lang
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.FeatureAccessModule.Models
{
    [Table("FeatureAccess")]
    public class FeatureAccess
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        [MaxLength(50)]
        public string FeatureName { get; set; } // e.g. "CRM", "Campaigns", "Catalog"
        [MaxLength(200)]
        public string Description { get; set; } = string.Empty;
        [Required]
        public bool IsEnabled { get; set; } // ✅ true = allow, false = restrict

        public string? Notes { get; set; } // Optional: reason or context

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        [MaxLength(50)]
        public string Group { get; set; } = string.Empty;
        public string? Plan { get; set; } // e.g. "basic", "smart", "advanced"

    }
}
``n
--- file: xbytechat-api/Features/FeatureAccessModule/Models/FeatureMaster.cs  (sha256:dcf5048b433abe18e2d52542d30fd81664a62f97176fe4ae583ce8218dfb002c)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.FeatureAccessModule.Models
{
    [Table("FeatureMaster")]
    public class FeatureMaster
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        [MaxLength(100)]
        public string FeatureCode { get; set; } = string.Empty; // e.g. "crm", "catalog"

        [Required]
        [MaxLength(100)]
        public string DisplayName { get; set; } = string.Empty; // e.g. "CRM", "Catalog"

        [MaxLength(250)]
        public string Description { get; set; } = string.Empty;

        [MaxLength(50)]
        public string Group { get; set; } = string.Empty; // Optional grouping like "CRM", "Messaging"

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/Models/UserFeatureAccess.cs  (sha256:894b0a6020dffcbe46247fd5412ef98ab890a641144d089aa7c9c7aa351d0f9b)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.FeatureAccessModule.Models
{
    [Table("UserFeatureAccess")]
    public class UserFeatureAccess
    {
        [Key]
        public Guid Id { get; set; }
        public Guid BusinessId { get; set; }
        [Required]
        public Guid UserId { get; set; }

        [Required]
        [MaxLength(50)]
        public string FeatureName { get; set; } = string.Empty;

        [Required]
        public bool IsEnabled { get; set; }

        public string? Notes { get; set; }

        public Guid? ModifiedByUserId { get; set; }  // Who applied this override
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/Services/FeatureAccessEvaluator.cs  (sha256:b7ad7ecdc58db9f75f5793f8fb207db8b7127f878b4d51a7144c6a71e1c2dd48)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.PlanManagement.Models;
using xbytechat.api.Models.BusinessModel;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.FeatureAccessModule.Services
{
    public class FeatureAccessEvaluator : IFeatureAccessEvaluator
    {
        private readonly AppDbContext _db;
        private readonly ILogger<FeatureAccessEvaluator> _logger;

        public FeatureAccessEvaluator(AppDbContext db, ILogger<FeatureAccessEvaluator> logger)
        {
            _db = db;
            _logger = logger;
        }

        public async Task<bool> CanUseAsync(Guid businessId, string featureCode, Guid? userId)
        {
            var business = await _db.Businesses
                .Include(b => b.BusinessPlanInfo)
                .FirstOrDefaultAsync(b => b.Id == businessId);

            if (business == null || business.BusinessPlanInfo == null)
                return false;

            var planEnum = business.BusinessPlanInfo.Plan;
            var planName = Enum.GetName(typeof(PlanType), planEnum)?.ToLower();

            var planFeatures = new Dictionary<string, bool>(StringComparer.OrdinalIgnoreCase)
            {
                ["crm"] = planName == "smart" || planName == "advanced",
                ["campaigns"] = planName == "advanced",
                ["catalog"] = true,
                ["automation"] = planName == "smart" || planName == "advanced"
            };

            return planFeatures.TryGetValue(featureCode.ToLower(), out var allowed) && allowed;
        }

    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/Services/FeatureAccessService.cs  (sha256:7968f3a0ef26fa05305fef477338950b8cb824aea9785d56b5d500ef3c376921)
`$lang
using Microsoft.EntityFrameworkCore;
using Serilog;
using xbytechat.api.Features.FeatureAccess.DTOs;
using xbytechat.api.Features.FeatureAccessModule.DTOs;
using xbytechat.api.Features.FeatureAccessModule.Models;
using xbytechat.api.Features.PlanManagement.Services;

namespace xbytechat.api.Features.FeatureAccessModule.Services
{
    public class FeatureAccessService : IFeatureAccessService
    {
        private readonly AppDbContext _context;
        private readonly IPlanManager _planManager;
        private readonly ILogger<FeatureAccessService> _logger;

        public FeatureAccessService(AppDbContext context, IPlanManager planManager, ILogger<FeatureAccessService> logger)
        {
            _context = context;
            _planManager = planManager;
            _logger = logger;
        }

        public async Task<IEnumerable<FeatureAccessDto>> GetAllAsync()
        {
            return await _context.FeatureAccess
                .Select(f => new FeatureAccessDto
                {
                    Id = f.Id,
                    BusinessId = f.BusinessId,
                    FeatureName = f.FeatureName,
                    IsEnabled = f.IsEnabled,
                    Notes = f.Notes,
                    CreatedAt = f.CreatedAt
                })
                .ToListAsync();
        }

        public async Task<IEnumerable<FeatureAccessDto>> GetByBusinessIdAsync(Guid businessId)
        {
            return await _context.FeatureAccess
                .Where(f => f.BusinessId == businessId)
                .Select(f => new FeatureAccessDto
                {
                    Id = f.Id,
                    BusinessId = f.BusinessId,
                    FeatureName = f.FeatureName,
                    IsEnabled = f.IsEnabled,
                    Notes = f.Notes,
                    CreatedAt = f.CreatedAt
                })
                .ToListAsync();
        }

        public async Task<FeatureAccessDto?> GetAsync(Guid id)
        {
            var entity = await _context.FeatureAccess.FindAsync(id);
            if (entity == null) return null;

            return new FeatureAccessDto
            {
                Id = entity.Id,
                BusinessId = entity.BusinessId,
                FeatureName = entity.FeatureName,
                IsEnabled = entity.IsEnabled,
                Notes = entity.Notes,
                CreatedAt = entity.CreatedAt
            };
        }

        public async Task<FeatureAccessDto> CreateAsync(FeatureAccessDto dto)
        {
            var entity = new  xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess
            {
                Id = Guid.NewGuid(),
                BusinessId = dto.BusinessId,
                FeatureName = dto.FeatureName,
                IsEnabled = dto.IsEnabled,
                Notes = dto.Notes,
                CreatedAt = DateTime.UtcNow
            };

            _context.FeatureAccess.Add(entity);
            await _context.SaveChangesAsync();

            dto.Id = entity.Id;
            dto.CreatedAt = entity.CreatedAt;
            return dto;
        }

        public async Task<FeatureAccessDto> UpdateAsync(Guid id, FeatureAccessDto dto)
        {
            var entity = await _context.FeatureAccess.FindAsync(id);
            if (entity == null)
                throw new Exception("FeatureAccess not found");

            entity.FeatureName = dto.FeatureName;
            entity.IsEnabled = dto.IsEnabled;
            entity.Notes = dto.Notes;

            await _context.SaveChangesAsync();

            return dto;
        }

        public async Task<bool> DeleteAsync(Guid id)
        {
            var entity = await _context.FeatureAccess.FindAsync(id);
            if (entity == null) return false;

            _context.FeatureAccess.Remove(entity);
            await _context.SaveChangesAsync();
            return true;
        }

        public async Task<List<FeatureToggleViewDto>> GetToggleViewAsync(Guid businessId, string plan)
        {
            var allFeatures = await _context.FeatureAccess.ToListAsync();

            var planAccessMap = _planManager.GetPlanFeatureMap(plan); // e.g., Dictionary<string, bool>

            var userOverrides = await _context.UserFeatureAccess
                .Where(x => x.BusinessId == businessId)
                .ToDictionaryAsync(x => x.FeatureName, x => x.IsEnabled);

            var result = allFeatures.Select(f => new FeatureToggleViewDto
            {
                FeatureCode = f.FeatureName,
                Group = f.Group,
                Description = f.Description,
                IsAvailableInPlan = planAccessMap.ContainsKey(f.FeatureName),
                IsOverridden = userOverrides.TryGetValue(f.FeatureName, out var val) ? val : null
            }).ToList();

            return result;
        }

        public async Task ToggleFeatureAsync(Guid businessId, string featureCode, bool isEnabled)
        {
            try
            {
                var existing = await _context.UserFeatureAccess
                    .FirstOrDefaultAsync(f => f.BusinessId == businessId && f.FeatureName == featureCode);

                if (existing != null)
                {
                    existing.IsEnabled = isEnabled;
                    _context.UserFeatureAccess.Update(existing);
                }
                else
                {
                    var newAccess = new UserFeatureAccess
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        FeatureName = featureCode,
                        IsEnabled = isEnabled,
                        CreatedAt = DateTime.UtcNow
                    };
                    await _context.UserFeatureAccess.AddAsync(newAccess);
                }

                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Failed to toggle feature {FeatureCode} for business {BusinessId}", featureCode, businessId);
                throw;
            }
        }

        public async Task<List<FeatureStatusDto>> GetFeaturesForCurrentUserAsync(Guid businessId)
        {
            var business = await _context.Businesses
                .Include(b => b.BusinessPlanInfo)
                .FirstOrDefaultAsync(b => b.Id == businessId);

            if (business == null)
            {
                _logger.LogError("❌ Business not found for feature access: {BusinessId}", businessId);
                return new List<FeatureStatusDto>();
            }

            var planName = business.BusinessPlanInfo?.Plan.ToString() ?? "basic"; // Fallback to basic
            _logger.LogInformation("📦 Resolved plan for Business {BusinessId}: {Plan}", businessId, planName);

            var planFeatureMap = _planManager.GetPlanFeatureMap(planName);

            var overrides = await _context.FeatureAccess
                .Where(f => f.BusinessId == businessId)
                .ToDictionaryAsync(f => f.FeatureName, f => (bool?)f.IsEnabled);
            foreach (var kv in overrides)
                _logger.LogInformation($"🔧 Feature override: {kv.Key} = {kv.Value}");
            var allFeatures = planFeatureMap.Keys
                .Union(overrides.Keys)
                .Distinct();

            return allFeatures.Select(f => new FeatureStatusDto
            {
                FeatureCode = f,
                IsAvailableInPlan = planFeatureMap.ContainsKey(f),
                IsOverridden = overrides.ContainsKey(f) ? overrides[f] : null
            }).ToList();
        }

        public async Task<List<UserFeatureAccessDto>> GetAllUserPermissionsAsync(Guid businessId)
        {
            var users = await _context.Users
             .Where(u => u.BusinessId == businessId)
             .Select(u => new UserFeatureAccessDto
             {
                 Id = u.Id,
                 FullName = u.Name, // ✅ Fixed
                 Email = u.Email,
                 Role = u.Role.Name, // ✅ Assuming you want role name string
                 Permissions = _context.UserFeatureAccess
                     .Where(p => p.BusinessId == businessId && p.UserId == u.Id)
                     .Select(p => new FeaturePermissionDto
                     {
                         FeatureName = p.FeatureName,
                         IsEnabled = p.IsEnabled
                     })
                     .ToList()
             }).ToListAsync();


            return users;
        }
        public async Task<Dictionary<string, bool>> GetFeatureMapByBusinessIdAsync(Guid businessId)
        {
            return await _context.FeatureAccess
                .Where(f => f.BusinessId == businessId)
                .ToDictionaryAsync(f => f.FeatureName.ToLower(), f => f.IsEnabled);
        }
        public async Task<Dictionary<string, bool>> GetAllFeatureCodesAsync()
        {
            return await _context.FeatureMasters
                .Select(f => f.FeatureCode.ToLower())
                .Distinct()
                .ToDictionaryAsync(k => k, v => true);
        }


    }
}



``n
--- file: xbytechat-api/Features/FeatureAccessModule/Services/IFeatureAccessEvaluator.cs  (sha256:88c0088b68d4137df4f0a836e48d8eb52d62af12950c913661d78b31e6c5afec)
`$lang
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.FeatureAccessModule.Services
{
    public interface IFeatureAccessEvaluator
    {
        //Task<bool> CanUseAsync(Guid businessId, string featureName);
        Task<bool> CanUseAsync(Guid businessId, string featureName, Guid? userId = null);

    }
}

``n
--- file: xbytechat-api/Features/FeatureAccessModule/Services/IFeatureAccessService.cs  (sha256:6b328b62d7d5356015dc30688fa072e890cac87e55a5c8a12b1e605b05a744f3)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.FeatureAccess.DTOs;
using xbytechat.api.Features.FeatureAccessModule.DTOs;

namespace xbytechat.api.Features.FeatureAccessModule.Services
{
    public interface IFeatureAccessService
    {
        Task<IEnumerable<FeatureAccessDto>> GetAllAsync();
        Task<IEnumerable<FeatureAccessDto>> GetByBusinessIdAsync(Guid businessId);
        Task<FeatureAccessDto?> GetAsync(Guid id);
        Task<FeatureAccessDto> CreateAsync(FeatureAccessDto dto);
        Task<FeatureAccessDto> UpdateAsync(Guid id, FeatureAccessDto dto);
        Task<bool> DeleteAsync(Guid id);

        Task<List<FeatureToggleViewDto>> GetToggleViewAsync(Guid businessId, string plan);
        Task ToggleFeatureAsync(Guid businessId, string featureCode, bool isEnabled);
        Task<List<FeatureStatusDto>> GetFeaturesForCurrentUserAsync(Guid businessId);
        Task<List<UserFeatureAccessDto>> GetAllUserPermissionsAsync(Guid businessId);
        Task<Dictionary<string, bool>> GetFeatureMapByBusinessIdAsync(Guid businessId);
        Task<Dictionary<string, bool>> GetAllFeatureCodesAsync();
    }
}

``n
--- file: xbytechat-api/Features/FlowAnalytics/Controllers/FlowAnalyticsController.cs  (sha256:18a260235767524c70c33a6a49f8929060e94415ee98ff743590d207242020e3)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.FlowAnalytics.Services;

namespace xbytechat.api.Features.FlowAnalytics.Controllers
{
    [ApiController]
    [Route("api/flow-analytics")]
    public class FlowAnalyticsController : ControllerBase
    {
        private readonly IFlowAnalyticsService _analyticsService;

        public FlowAnalyticsController(IFlowAnalyticsService analyticsService)
        {
            _analyticsService = analyticsService;
        }

        // ✅ GET /api/flow-analytics/summary
        [HttpGet("summary")]
        [Authorize]
        public async Task<IActionResult> GetSummary()
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;

            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var result = await _analyticsService.GetAnalyticsSummaryAsync(businessId);
            return Ok(result);
        }

        // ✅ GET /api/flow-analytics/most-triggered-steps
        [HttpGet("most-triggered-steps")]
        [Authorize]
        public async Task<IActionResult> GetMostTriggeredSteps()
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;

            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var data = await _analyticsService.GetMostTriggeredStepsAsync(businessId);
            return Ok(data);
        }

        // ✅ GET /api/flow-analytics/step-journey-breakdown?startDate=...&endDate=...
        [HttpGet("step-journey-breakdown")]
        [Authorize]
        public async Task<IActionResult> GetStepJourneyBreakdown([FromQuery] DateTime? startDate, [FromQuery] DateTime? endDate)
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;

            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid business ID");

            var data = await _analyticsService.GetStepJourneyBreakdownAsync(businessId, startDate, endDate);
            return Ok(data);
        }
    }
}

``n
--- file: xbytechat-api/Features/FlowAnalytics/DTOs/FlowAnalyticsStepJourneyDto.cs  (sha256:25c17b6d295eb4faf667e982e2878b32a18af8a759791962286f17eec9163f6f)
`$lang
namespace xbytechat.api.Features.FlowAnalytics.DTOs
{
    public class FlowAnalyticsStepJourneyDto
    {
        public Guid StepId { get; set; }

        public string TemplateName { get; set; } = string.Empty;

        public int TotalReached { get; set; }

        public int ClickedNext { get; set; }

        public Guid? NextStepId { get; set; }

        // ✅ Auto-calculated: number of users who dropped off at this step
        public int DropOff => TotalReached - ClickedNext;

        // ✅ Auto-calculated: percentage of users who clicked "next"
        public double ConversionRate =>
            TotalReached == 0 ? 0 : Math.Round((double)ClickedNext / TotalReached * 100, 2);

        // ✅ Optional: percentage of users who dropped off
        public double DropOffRate =>
            TotalReached == 0 ? 0 : Math.Round((double)DropOff / TotalReached * 100, 2);
    }
}

``n
--- file: xbytechat-api/Features/FlowAnalytics/DTOs/FlowAnalyticsSummaryDto.cs  (sha256:5298f0c920ce53f68b8113de057d804750e1a3afd39d3a24e965ae120275118a)
`$lang
namespace xbytechat.api.Features.FlowAnalytics.DTOs
{
    public class FlowAnalyticsSummaryDto
    {
        public int TotalExecutions { get; set; }
        public int UniqueContacts { get; set; }
        public string TopStepTriggered { get; set; } = "N/A";
        public int TopStepCount { get; set; }
        public DateTime? LastExecutedAt { get; set; }
    }
}


``n
--- file: xbytechat-api/Features/FlowAnalytics/DTOs/FlowStepAnalyticsDto.cs  (sha256:538b4b71cb5a0a82ee36ec0147c0014d4f6570b635eb2ce711cb7e8de3119a09)
`$lang
namespace xbytechat.api.Features.FlowAnalytics.DTOs
{
    public class FlowStepAnalyticsDto
    {
        public Guid StepId { get; set; }
        public string TemplateName { get; set; } = string.Empty;
        public int TotalReached { get; set; }
        public int ClickedNext { get; set; }
        public int DropOff => TotalReached - ClickedNext;
        public Guid? NextStepId { get; set; }
        public DateTime ExecutedAtUtc { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/FlowAnalytics/DTOs/MostTriggeredStepDto.cs  (sha256:18dc2f8497fae7508358e8556503db073d057061d1892fed2882208fa6653588)
`$lang
namespace xbytechat.api.Features.FlowAnalytics.DTOs
{
    public class MostTriggeredStepDto
    {
        public Guid StepId { get; set; }
        public string StepName { get; set; } = string.Empty;
        public int TriggerCount { get; set; }
        public DateTime? LastTriggeredAt { get; set; }
    }

}

``n
--- file: xbytechat-api/Features/FlowAnalytics/Services/FlowAnalyticsService.cs  (sha256:b832767451b9f0161f931082a45a698407bf4cfaa6c5077edef8a2f6d30385cb)
`$lang
using Microsoft.EntityFrameworkCore;
using Serilog;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.CTAFlowBuilder.Models;
using xbytechat.api.Features.FlowAnalytics.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.FlowAnalytics.Services
{
    public class FlowAnalyticsService : IFlowAnalyticsService
    {
        private readonly AppDbContext _context;

        public FlowAnalyticsService(AppDbContext context)
        {
            _context = context;
        }

        // ✅ Summary cards (executions, unique contacts, top step)
        public async Task<FlowAnalyticsSummaryDto> GetAnalyticsSummaryAsync(Guid businessId)
        {
            try
            {
                Log.Information("📊 Generating Flow Analytics Summary for BusinessId: {BusinessId}", businessId);

                var recentExecutions = await _context.FlowExecutionLogs
                    .Where(e => e.BusinessId == businessId)
                    .ToListAsync();

                var totalExecutions = recentExecutions.Count;
                var uniqueContacts = recentExecutions.Select(e => e.ContactPhone).Distinct().Count();
                var mostTriggeredStep = recentExecutions
                    .GroupBy(e => e.StepName)
                    .OrderByDescending(g => g.Count())
                    .Select(g => new { Step = g.Key, Count = g.Count() })
                    .FirstOrDefault();

                return new FlowAnalyticsSummaryDto
                {
                    TotalExecutions = totalExecutions,
                    UniqueContacts = uniqueContacts,
                    TopStepTriggered = mostTriggeredStep?.Step ?? "N/A",
                    TopStepCount = mostTriggeredStep?.Count ?? 0,
                    LastExecutedAt = recentExecutions
                        .OrderByDescending(e => e.ExecutedAt)
                        .FirstOrDefault()?.ExecutedAt
                };
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to generate flow analytics summary");
                return new FlowAnalyticsSummaryDto();
            }
        }

        // ✅ Top triggered steps leaderboard
        public async Task<List<MostTriggeredStepDto>> GetMostTriggeredStepsAsync(Guid businessId)
        {
            return await _context.FlowExecutionLogs
                .Where(e => e.BusinessId == businessId)
                .GroupBy(e => new { e.StepId, e.StepName })
                .Select(g => new MostTriggeredStepDto
                {
                    StepId = g.Key.StepId,
                    StepName = g.Key.StepName,
                    TriggerCount = g.Count(),
                    LastTriggeredAt = g.Max(e => e.ExecutedAt)
                })
                .OrderByDescending(x => x.TriggerCount)
                .Take(5)
                .ToListAsync();
        }

        // ✅ Step-by-step journey breakdown (with date filter)
        public async Task<List<FlowAnalyticsStepJourneyDto>> GetStepJourneyBreakdownAsync(Guid businessId, DateTime? startDate, DateTime? endDate)
        {
            var query = _context.FlowExecutionLogs
                .Where(e => e.BusinessId == businessId);

            if (startDate.HasValue)
                query = query.Where(e => e.ExecutedAt >= startDate.Value.Date);

            if (endDate.HasValue)
                query = query.Where(e => e.ExecutedAt <= endDate.Value.Date.AddDays(1).AddTicks(-1));

            var logs = await query.ToListAsync();

            // Group by StepId
            var grouped = logs
                .GroupBy(e => new { e.StepId, e.TemplateName, e.TriggeredByButton, e.FlowId })
                .Select(g => new
                {
                    StepId = g.Key.StepId,
                    TemplateName = g.Key.TemplateName,
                    TotalReached = g.Count(),
                    ClickedNext = logs.Count(x =>
                        x.TriggeredByButton != null &&
                        x.FlowId == g.Key.FlowId &&
                        x.StepId != g.Key.StepId &&
                        x.TriggeredByButton == g.Key.TriggeredByButton
                    ),
                    FlowId = g.Key.FlowId,
                    TriggeredByButton = g.Key.TriggeredByButton
                })
                .ToList();

            // Build final breakdown
            var breakdown = grouped.Select(g => new FlowAnalyticsStepJourneyDto
            {
                StepId = g.StepId,
                TemplateName = g.TemplateName,
                TotalReached = g.TotalReached,
                ClickedNext = g.ClickedNext,
              //  DropOff = g.TotalReached - g.ClickedNext,
                NextStepId = _context.FlowButtonLinks
                    .Where(bl =>
                        bl.CTAFlowStepId == g.StepId &&
                        bl.ButtonText == g.TriggeredByButton)
                    .Select(bl => bl.NextStepId)
                    .FirstOrDefault()
            }).ToList();

            return breakdown;
        }
    }
}

``n
--- file: xbytechat-api/Features/FlowAnalytics/Services/IFlowAnalyticsService.cs  (sha256:65a623c78188e9581eee608e1e5e53404f8431fb317139d50a4caadd86b074ae)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.FlowAnalytics.DTOs;

namespace xbytechat.api.Features.FlowAnalytics.Services
{
    public interface IFlowAnalyticsService
    {
        Task<FlowAnalyticsSummaryDto> GetAnalyticsSummaryAsync(Guid businessId);
        Task<List<MostTriggeredStepDto>> GetMostTriggeredStepsAsync(Guid businessId);
        Task<List<FlowAnalyticsStepJourneyDto>> GetStepJourneyBreakdownAsync(Guid businessId, DateTime? startDate, DateTime? endDate);

    }
}

``n
--- file: xbytechat-api/Features/Inbox/Controllers/InboxController.cs  (sha256:309176361f2834ed7c983d99dc96ebb6b7298e35e99a528c40c981257176063a)
`$lang
using Microsoft.AspNetCore.Mvc;
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Inbox.DTOs;
using xbytechat.api.Features.Inbox.Services;
using xbytechat.api.Helpers;
using Microsoft.AspNetCore.Authorization;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.Inbox.Controllers
{
    [ApiController]
    [Route("api/inbox")]
    public class InboxController : ControllerBase
    {
        private readonly IInboxService _inboxService;

        public InboxController(IInboxService inboxService)
        {
            _inboxService = inboxService;
        }

        /// <summary>
        /// Send a new message from UI or system.
        /// </summary>
        [HttpPost("send")]
        public async Task<IActionResult> SendMessage([FromBody] InboxMessageDto dto)
        {
            if (dto == null || string.IsNullOrWhiteSpace(dto.MessageBody))
                return BadRequest("Message content is required.");

            var result = await _inboxService.SaveOutgoingMessageAsync(dto);
            return Ok(result);
        }

        /// <summary>
        /// Receive a message from external source (e.g., WhatsApp webhook).
        /// </summary>
        [HttpPost("receive")]
        public async Task<IActionResult> ReceiveMessage([FromBody] InboxMessageDto dto)
        {
            if (dto == null || string.IsNullOrWhiteSpace(dto.MessageBody))
                return BadRequest("Incoming message content is required.");

            var result = await _inboxService.SaveIncomingMessageAsync(dto);
            return Ok(result);
        }

        /// <summary>
        /// Fetch message history between agent and customer using business token + contactId.
        /// </summary>
        [HttpGet("messages")]
        public async Task<IActionResult> GetMessagesByContact([FromQuery] Guid contactId)
        {
            if (contactId == Guid.Empty)
                return BadRequest("ContactId is required.");

            var businessId = User.GetBusinessId();
            var messages = await _inboxService.GetMessagesByContactAsync(businessId, contactId);
            return Ok(messages);
        }

        /// <summary>
        /// Fetch full conversation between agent (userPhone) and customer (contactPhone).
        /// </summary>
        [HttpGet("conversation")]
        public async Task<IActionResult> GetConversation(
            [FromQuery] Guid businessId,
            [FromQuery] string userPhone,
            [FromQuery] string contactPhone)
        {
            if (businessId == Guid.Empty || string.IsNullOrWhiteSpace(userPhone) || string.IsNullOrWhiteSpace(contactPhone))
                return BadRequest("Invalid input.");

            var messages = await _inboxService.GetConversationAsync(businessId, userPhone, contactPhone);
            return Ok(messages);
        }

        //[HttpGet("unread-counts")]
        //public async Task<IActionResult> GetUnreadCounts()
        //{
        //    var businessId = User.GetBusinessId();
        //    var counts = await _inboxService.GetUnreadMessageCountsAsync(businessId);
        //    return Ok(counts);
        //}

        [HttpPost("mark-read")]
        public async Task<IActionResult> MarkMessagesAsRead([FromQuery] Guid contactId)
        {
            if (contactId == Guid.Empty)
                return BadRequest("ContactId is required.");

            var businessId = User.GetBusinessId();
            await _inboxService.MarkMessagesAsReadAsync(businessId, contactId);
            return Ok();
        }
        [HttpGet("unread-counts")]
        public async Task<IActionResult> GetUnreadCounts()
        {
            var userId = User.GetUserId();
            var businessId = User.GetBusinessId();

            var counts = await _inboxService.GetUnreadCountsForUserAsync(businessId, userId);
            return Ok(counts);
        }

    }
}

``n
--- file: xbytechat-api/Features/Inbox/DTOs/InboxMessageDto.cs  (sha256:aef9beda43a0dc4f1c619514c3289f6c68a6daf10fe5cdd46ad13c474be29c0b)
`$lang
// 📄 File: Features/Inbox/DTOs/InboxMessageDto.cs
using System;

namespace xbytechat.api.Features.Inbox.DTOs
{
    public class InboxMessageDto
    {
        public Guid BusinessId { get; set; }
        public string RecipientPhone { get; set; }
        public string MessageBody { get; set; }
        public Guid? ContactId { get; set; }
        public Guid? CTAFlowStepId { get; set; }
        public Guid? CTAFlowConfigId { get; set; }
        public Guid? CampaignId { get; set; }
        public string? CampaignName { get; set; }       // 🆕 To show in chat bubble
        public string? RenderedBody { get; set; }

        public bool IsIncoming { get; set; }            // 🆕 Needed for bubble side
        public string Status { get; set; }              // 🆕 For message ticks
        public DateTime SentAt { get; set; }            // 🆕 For timestamp
    }
}

``n
--- file: xbytechat-api/Features/Inbox/DTOs/SendInboxMessageDto.cs  (sha256:1ad0e0e61748e9f9e1fab32e1fe533c57a6c8d586694e55aa5b531359804de90)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat.api.Features.Inbox.DTOs
{
    /// <summary>
    /// DTO sent from frontend when a user sends a new message.
    /// </summary>
    public class SendInboxMessageDto
    {
        [Required]
        public Guid ContactId { get; set; }

        [Required]
        public string MessageBody { get; set; }

        public string? MediaUrl { get; set; } // Optional image or file
    }
}

``n
--- file: xbytechat-api/Features/Inbox/DTOs/SendMessageInputDto.cs  (sha256:3c76bd2b5ce839064134b72aa2114c14c73a98109c680671f5e7c463867f221a)
`$lang
namespace xbytechat.api.Features.Inbox.DTOs
{
    public class SendMessageInputDto
    {
        public Guid ContactId { get; set; } // 🔁 REMOVE the "?" (nullable) unless needed
        public string Message { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/Inbox/DTOs/TextOnlyMessageSendDto.cs  (sha256:2d322145a5e6410decb150b108c7d74a656201d9be027b99b02d1c261b4ed4fc)
`$lang
namespace xbytechat.api.Features.Inbox.DTOs
{
    public class TextOnlyMessageSendDto
    {
        public Guid BusinessId { get; set; }

        public string RecipientNumber { get; set; }

        public string TextContent { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Hubs/InboxHub.cs  (sha256:2457d506ef6f58ed908e2183358c0506f59e9404b1d8fdb8ae97553d266a5206)
`$lang
// 📄 xbytechat.api/Features/Inbox/InboxHub.cs

using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.SignalR;
using xbytechat.api.Features.Inbox.DTOs;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Shared;
using xbytechat.api.Models;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Inbox.Models;

namespace xbytechat.api.Features.Inbox.Hubs
{
    [Authorize]
    public class InboxHub : Hub
    {
        private readonly AppDbContext _db;
        private readonly IMessageEngineService _messageService;

        public InboxHub(AppDbContext db, IMessageEngineService messageService)
        {
            _db = db;
            _messageService = messageService;
        }

        public override async Task OnConnectedAsync()
        {
            var businessId = Context.User.GetBusinessId();
            var groupName = $"business_{businessId}";

            await Groups.AddToGroupAsync(Context.ConnectionId, groupName);
            Console.WriteLine($"✅ Connected to group: {groupName}");

            await base.OnConnectedAsync();
        }

        public async Task SendMessageToContact(SendMessageInputDto dto)
        {
            Console.WriteLine("📩 Raw DTO payload:");
            Console.WriteLine($"ContactId: {dto.ContactId}, Message: {dto.Message}");

            if (dto.ContactId == null || string.IsNullOrWhiteSpace(dto.Message))
            {
                Console.WriteLine("❌ Invalid contact or empty message.");
                return;
            }

            var businessId = Context.User.GetBusinessId();
            var userId = Context.User.GetUserId();

            // ✅ Lookup recipient phone number from Contact table
            var contact = await _db.Contacts
                .Where(c => c.BusinessId == businessId && c.Id == dto.ContactId)
                .FirstOrDefaultAsync();

            if (contact == null || string.IsNullOrWhiteSpace(contact.PhoneNumber))
            {
                Console.WriteLine($"❌ Contact not found or missing phone number. ContactId: {dto.ContactId}");
                await Clients.Caller.SendAsync("ReceiveInboxMessage", new
                {
                    contactId = dto.ContactId,
                    message = dto.Message,
                    from = userId,
                    status = "Failed",
                    error = "Invalid contact"
                   
                });
                return;
            }

            // ✅ Prepare DTO for WhatsApp sending
            var sendDto = new TextMessageSendDto
            {
                BusinessId = businessId,
                ContactId = dto.ContactId,
                RecipientNumber = contact.PhoneNumber,
                TextContent = dto.Message
            };

            // 🚀 Send via WhatsApp API and save to MessageLogs
            var result = await _messageService.SendTextDirectAsync(sendDto);

            // ✅ Construct unified message payload
            var inboxMessage = new
            {
                contactId = dto.ContactId,
                message = dto.Message,
                from = userId,
                status = result.Success ? "Sent" : "Failed",
                sentAt = DateTime.UtcNow,
                logId = result.LogId,
                senderId = userId,
                isIncoming = false
            };

            // ✅ Notify sender only
            await Clients.Caller.SendAsync("ReceiveInboxMessage", inboxMessage);

            // ✅ Notify others in group (for unread update)
            var groupName = $"business_{businessId}";
            await Clients.GroupExcept(groupName, Context.ConnectionId)
                .SendAsync("ReceiveInboxMessage", inboxMessage);
        }

   
        public async Task MarkAsRead(Guid contactId)
        {
            Console.WriteLine($"🟢 MarkAsRead triggered for ContactId: {contactId}");
            var userId = Context.User?.GetUserId();
            var businessId = Context.User?.GetBusinessId();

            if (userId == null || businessId == null || businessId == Guid.Empty)
                return;

            var userGuid = userId.Value;
            var businessGuid = businessId.Value;
            var now = DateTime.UtcNow;

            // ✅ Insert or Update ContactRead
            var readEntry = await _db.ContactReads
                .FirstOrDefaultAsync(r => r.ContactId == contactId && r.UserId == userGuid);

            if (readEntry == null)
            {
                Console.WriteLine("📥 New ContactRead will be added.");
                _db.ContactReads.Add(new ContactRead
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessGuid,
                    ContactId = contactId,
                    UserId = userGuid,
                    LastReadAt = now
                });
            }
            else
            {
                Console.WriteLine($"🔄 Updating LastReadAt for contact {contactId}");
                readEntry.LastReadAt = now;
            }

            await _db.SaveChangesAsync();
            Console.WriteLine("💾 ContactReads saved successfully.");
            // ✅ Step 1: Get message logs (DB)
            var allMessages = await _db.MessageLogs
                .Where(m => m.BusinessId == businessGuid && m.IsIncoming && m.ContactId != null)
                .ToListAsync();

            // ✅ Step 2: Get contactReads (DB)
            var contactReads = await _db.ContactReads
                .Where(r => r.UserId == userGuid)
                .ToDictionaryAsync(r => r.ContactId, r => r.LastReadAt);

            // ✅ Step 3: Now calculate unread counts in-memory (C# LINQ)
            var unreadCounts = allMessages
                .GroupBy(m => m.ContactId!.Value)
                .ToDictionary(
                    g => g.Key,
                    g => g.Count(m =>
                        !contactReads.ContainsKey(g.Key) ||
                        (m.SentAt ?? m.CreatedAt) > contactReads[g.Key])
                );

            // ✅ Push real-time update to user
            await Clients.User(userGuid.ToString())
                .SendAsync("UnreadCountChanged", unreadCounts);
        }


    }
}


``n
--- file: xbytechat-api/Features/Inbox/Models/ChatSessionState.cs  (sha256:fa6184f30e1715455ee5b84ae75264c5cc2d46ed4f1721014141ed9036dfda64)
`$lang
namespace xbytechat.api.Features.Inbox.Models
{
    public class ChatSessionState
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }

        public string Mode { get; set; } = "automation"; // values: "automation" | "agent"
        public DateTime LastUpdatedAt { get; set; } = DateTime.UtcNow;

        // Optional: track who switched the mode
        public string? UpdatedBy { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Models/ContactRead.cs  (sha256:aa4dd9980bc6485cf1c4981bf7dfff84f32dcfbacc6c9dbc3be4ba0429c065c6)
`$lang
using System;

namespace xbytechat.api.Features.Inbox.Models
{
    public class ContactRead
    {
        public Guid Id { get; set; }

        // 🔗 FK to Contact
        public Guid ContactId { get; set; }

        // 🔗 FK to User (Agent)
        public Guid UserId { get; set; }

        // 📅 Last time this agent opened this contact's chat
        public DateTime LastReadAt { get; set; } = DateTime.UtcNow;

        public Guid BusinessId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Repositories/IInboxRepository.cs  (sha256:d057575abdee0fe95972b5dcfafa6e7637884f526bb108c43b06bbb1b2d2a5bd)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Inbox.Repositories
{
    public interface IInboxRepository
    {
        Task<List<MessageLog>> GetConversationAsync(Guid businessId, string userPhone, string contactPhone, int limit = 50);
        Task<MessageLog?> GetLastMessageAsync(Guid businessId, string userPhone, string contactPhone);
        Task AddMessageAsync(MessageLog message);
        Task SaveChangesAsync();
        Task<List<MessageLog>> GetMessagesByContactIdAsync(Guid businessId, Guid contactId);
        Task<Dictionary<Guid, int>> GetUnreadMessageCountsAsync(Guid businessId);
        Task MarkMessagesAsReadAsync(Guid businessId, Guid contactId);
        Task<Dictionary<Guid, int>> GetUnreadCountsForUserAsync(Guid businessId, Guid userId);


    }
}

``n
--- file: xbytechat-api/Features/Inbox/Repositories/InboxRepository.cs  (sha256:06153117fc580e3c5239560868ec16dd5f41d963a159eec8ad96f569afa9bb29)
`$lang
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Inbox.Repositories
{
    public class InboxRepository : IInboxRepository
    {
        private readonly AppDbContext _context;

        public InboxRepository(AppDbContext context)
        {
            _context = context;
        }

        public async Task<List<MessageLog>> GetConversationAsync(Guid businessId, string userPhone, string contactPhone, int limit = 50)
        {
            return await _context.MessageLogs
                .Where(m => m.BusinessId == businessId &&
                            ((m.RecipientNumber == contactPhone && m.IsIncoming == false) ||
                             (m.RecipientNumber == userPhone && m.IsIncoming == true)))
                .OrderByDescending(m => m.CreatedAt)
                .Take(limit)
                .ToListAsync();
        }

        public async Task<MessageLog?> GetLastMessageAsync(Guid businessId, string userPhone, string contactPhone)
        {
            return await _context.MessageLogs
                .Where(m => m.BusinessId == businessId &&
                            ((m.RecipientNumber == contactPhone && m.IsIncoming == false) ||
                             (m.RecipientNumber == userPhone && m.IsIncoming == true)))
                .OrderByDescending(m => m.CreatedAt)
                .FirstOrDefaultAsync();
        }

        public async Task AddMessageAsync(MessageLog message)
        {
            await _context.MessageLogs.AddAsync(message);
        }

        public async Task SaveChangesAsync()
        {
            await _context.SaveChangesAsync();
        }
        public async Task<List<MessageLog>> GetMessagesByContactIdAsync(Guid businessId, Guid contactId)
        {
            return await _context.MessageLogs
                 .Include(m => m.SourceCampaign)
                .Where(m => m.BusinessId == businessId && m.ContactId == contactId)
                .OrderBy(m => m.CreatedAt)
                .ToListAsync();
        }

        public async Task<Dictionary<Guid, int>> GetUnreadMessageCountsAsync(Guid businessId)
        {
            return await _context.MessageLogs
                .Where(m => m.BusinessId == businessId &&
                            m.IsIncoming &&
                            m.Status != "Read" &&
                            m.ContactId != null) // ✅ ensure not null
                .GroupBy(m => m.ContactId!.Value) // ✅ safe cast to Guid
                .Select(g => new { ContactId = g.Key, Count = g.Count() })
                .ToDictionaryAsync(x => x.ContactId, x => x.Count);
        }
        public async Task MarkMessagesAsReadAsync(Guid businessId, Guid contactId)
        {
            var unreadMessages = await _context.MessageLogs
                .Where(m => m.BusinessId == businessId &&
                            m.ContactId == contactId &&
                            m.IsIncoming &&
                            m.Status != "Read")
                .ToListAsync(); 
            foreach (var msg in unreadMessages)
                msg.Status = "Read";

            await _context.SaveChangesAsync();
        }
        public async Task<Dictionary<Guid, int>> GetUnreadCountsForUserAsync(Guid businessId, Guid userId)
        {
                    var contactReads = await _context.ContactReads
             .Where(r => r.UserId == userId)
             .ToDictionaryAsync(r => r.ContactId, r => r.LastReadAt);

            // 🟢 Fetch from DB first (no logic yet)
            var allMessages = await _context.MessageLogs
                .Where(m => m.BusinessId == businessId && m.IsIncoming && m.ContactId != null)
                .ToListAsync();

            // 🧠 Now calculate in memory
            var unreadCounts = allMessages
                .GroupBy(m => m.ContactId!.Value)
                .ToDictionary(
                    g => g.Key,
                    g => g.Count(m =>
                        !contactReads.ContainsKey(g.Key) ||
                        (m.SentAt ?? m.CreatedAt) > contactReads[g.Key])
                );


            return unreadCounts;
        }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/AgentAssignmentService.cs  (sha256:de9062b213ba63cb8695f407ede5c9e8d52a589e0dc1c7a4c5c79fd243389e4e)
`$lang
using System;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;

namespace xbytechat.api.Features.Inbox.Services
{
    public class AgentAssignmentService : IAgentAssignmentService
    {
        private readonly ILogger<AgentAssignmentService> _logger;

        public AgentAssignmentService(ILogger<AgentAssignmentService> logger)
        {
            _logger = logger;
        }

        public Task<bool> IsAgentAvailableAsync(Guid businessId)
        {
            // 🔧 TODO: Replace with real logic based on your agent pool
            _logger.LogInformation("Checking if agent is available for business {BusinessId}", businessId);
            return Task.FromResult(true); // Assume always available for MVP
        }

        public Task AssignAgentToContactAsync(Guid businessId, Guid contactId)
        {
            // 🔧 TODO: Save agent-contact assignment to DB or notify a human agent
            _logger.LogInformation("Assigning agent to contact {ContactId} for business {BusinessId}", contactId, businessId);
            return Task.CompletedTask;
        }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/ChatSessionStateService.cs  (sha256:5c6672bd07d87501ca9d46e38085cbec03455bae6cc943c8b8df505a7c73808e)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.AutoReplyBuilder.Models;
using xbytechat.api.Features.Inbox.Models;

namespace xbytechat.api.Features.Inbox.Services
{
    public class ChatSessionStateService : IChatSessionStateService
    {
        private readonly AppDbContext _db;

        public ChatSessionStateService(AppDbContext db)
        {
            _db = db;
        }

        // ✅ Returns current chat mode: "agent" or "auto"
        public async Task<string> GetChatModeAsync(Guid businessId, Guid contactId)
        {
            var session = await _db.ChatSessionStates
                .FirstOrDefaultAsync(s => s.BusinessId == businessId && s.ContactId == contactId);

            return session?.Mode ?? "auto"; // Default to auto
        }

        // ✅ Switches to agent mode
        public async Task SwitchToAgentModeAsync(Guid businessId, Guid contactId)
        {
            await UpsertChatModeAsync(businessId, contactId, "agent");
        }

        // ✅ Switches to automation mode
        public async Task SwitchToAutomationModeAsync(Guid businessId, Guid contactId)
        {
            await UpsertChatModeAsync(businessId, contactId, "auto");
        }

        // ✅ Shared logic to insert or update session state
        private async Task UpsertChatModeAsync(Guid businessId, Guid contactId, string mode)
        {
            var existing = await _db.ChatSessionStates
                .FirstOrDefaultAsync(s => s.BusinessId == businessId && s.ContactId == contactId);

            if (existing != null)
            {
                existing.Mode = mode;
                existing.LastUpdatedAt = DateTime.UtcNow;
            }
            else
            {
                _db.ChatSessionStates.Add(new ChatSessionState
                {
                    BusinessId = businessId,
                    ContactId = contactId,
                    Mode = mode,
                    LastUpdatedAt = DateTime.UtcNow
                });
            }

            await _db.SaveChangesAsync();
        }

        public async Task SetChatModeAsync(Guid businessId, Guid contactId, string mode)
        {
            var state = await _db.ChatSessionStates
                .FirstOrDefaultAsync(x => x.BusinessId == businessId && x.ContactId == contactId);

            if (state == null)
            {
                // Insert new if not exists
                state = new ChatSessionState
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    ContactId = contactId,
                    Mode = mode,
                    LastUpdatedAt = DateTime.UtcNow
                };
                _db.ChatSessionStates.Add(state);
            }
            else
            {
                state.Mode = mode;
                state.LastUpdatedAt = DateTime.UtcNow;
            }

            await _db.SaveChangesAsync();
        }
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/IAgentAssignmentService.cs  (sha256:1eae6f670d61efc4cd6f430a93cf7188c26a6d521ae49cd50ab926aa5bc027ee)
`$lang
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Inbox.Services
{
    public interface IAgentAssignmentService
    {
        Task<bool> IsAgentAvailableAsync(Guid businessId);
        Task AssignAgentToContactAsync(Guid businessId, Guid contactId);
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/IChatSessionStateService.cs  (sha256:3ade6df9341ebca2e5a478331e57315273317bc803a529a4e068cccc323f1693)
`$lang
namespace xbytechat.api.Features.Inbox.Services
{
    public interface IChatSessionStateService
    {
        Task<string> GetChatModeAsync(Guid businessId, Guid contactId);
        Task SwitchToAgentModeAsync(Guid businessId, Guid contactId);
        Task SwitchToAutomationModeAsync(Guid businessId, Guid contactId);
        Task SetChatModeAsync(Guid businessId, Guid contactId, string mode);
    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/IInboxService.cs  (sha256:58b2b14fb055263d0f08348900a55c5cbd62c16609e1b4ba082beb34a84efc49)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.Inbox.DTOs;
using xbytechat.api.Features.MessageManagement.DTOs;

namespace xbytechat.api.Features.Inbox.Services
{
    public interface IInboxService
    {
        Task<List<MessageLog>> GetConversationAsync(Guid businessId, string userPhone, string contactPhone, int limit = 50);
        Task<MessageLog> SaveIncomingMessageAsync(InboxMessageDto dto);
        Task<MessageLog> SaveOutgoingMessageAsync(InboxMessageDto dto);
        Task<List<MessageLogDto>> GetMessagesByContactAsync(Guid businessId, Guid contactId);
        Task<Dictionary<Guid, int>> GetUnreadMessageCountsAsync(Guid businessId);
        Task MarkMessagesAsReadAsync(Guid businessId, Guid contactId);

        Task<Dictionary<Guid, int>> GetUnreadCountsForUserAsync(Guid businessId, Guid userId);

    }
}

``n
--- file: xbytechat-api/Features/Inbox/Services/InboxService.cs  (sha256:8bbfdb66619466ec1c134351db9fc8b8fd32a8d30a45da7c3d142e41f17ae8f7)
`$lang
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.Inbox.DTOs;
using xbytechat.api.Features.Inbox.Repositories;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.Inbox.Services
{
    public class InboxService : IInboxService
    {
        private readonly IInboxRepository _repository;

        public InboxService(IInboxRepository repository)
        {
            _repository = repository;
        }

        public async Task<List<MessageLog>> GetConversationAsync(Guid businessId, string userPhone, string contactPhone, int limit = 50)
        {
            return await _repository.GetConversationAsync(businessId, userPhone, contactPhone, limit);
        }

        public async Task<MessageLog> SaveIncomingMessageAsync(InboxMessageDto dto)
        {
            var message = new MessageLog
            {
                Id = Guid.NewGuid(),
                BusinessId = dto.BusinessId,
                RecipientNumber = dto.RecipientPhone,
                MessageContent = dto.MessageBody,
                IsIncoming = true,
                CreatedAt = DateTime.UtcNow,
                ContactId = dto.ContactId,
                CTAFlowStepId = dto.CTAFlowStepId,
                CTAFlowConfigId = dto.CTAFlowConfigId,
                CampaignId = dto.CampaignId,
                RenderedBody = dto.RenderedBody
            };

            await _repository.AddMessageAsync(message);
            await _repository.SaveChangesAsync();

            return message;
        }

        public async Task<MessageLog> SaveOutgoingMessageAsync(InboxMessageDto dto)
        {
            var message = new MessageLog
            {
                Id = Guid.NewGuid(),
                BusinessId = dto.BusinessId,
                RecipientNumber = dto.RecipientPhone,
                MessageContent = dto.MessageBody,
                IsIncoming = false,
                CreatedAt = DateTime.UtcNow,
                ContactId = dto.ContactId,
                CTAFlowStepId = dto.CTAFlowStepId,
                CTAFlowConfigId = dto.CTAFlowConfigId,
                CampaignId = dto.CampaignId,
                RenderedBody = dto.RenderedBody
            };

            await _repository.AddMessageAsync(message);
            await _repository.SaveChangesAsync();

            return message;
        }
   
        public async Task<List<MessageLogDto>> GetMessagesByContactAsync(Guid businessId, Guid contactId)
        {
            var messages = await _repository.GetMessagesByContactIdAsync(businessId, contactId);

            return messages.Select(m => new MessageLogDto
            {
                Id = m.Id,
                ContactId = m.ContactId,
                RecipientNumber = m.RecipientNumber, // ✅ optional but helpful
                MessageContent = m.MessageContent,
                CreatedAt = m.CreatedAt,
                IsIncoming = m.IsIncoming,
                RenderedBody = m.RenderedBody,
                CampaignId = m.CampaignId,
                CampaignName = m.SourceCampaign?.Name, // ✅ ✅ This is crucial
                CTAFlowConfigId = m.CTAFlowConfigId,
                CTAFlowStepId = m.CTAFlowStepId
            }).ToList();
        }


        public async Task<Dictionary<Guid, int>> GetUnreadMessageCountsAsync(Guid businessId)
        {
            return await _repository.GetUnreadMessageCountsAsync(businessId);
        }
        public async Task MarkMessagesAsReadAsync(Guid businessId, Guid contactId)
        {
            await _repository.MarkMessagesAsReadAsync(businessId, contactId);
        }
        public async Task<Dictionary<Guid, int>> GetUnreadCountsForUserAsync(Guid businessId, Guid userId)
        {
            return await _repository.GetUnreadCountsForUserAsync(businessId, userId);
        }


    }
}

``n
--- file: xbytechat-api/Features/Inbox/SignalR/NameUserIdProvider.cs  (sha256:177581fc6482f75de65f8a7db7a93d17a7d887e148d35eb77ca640d9df0e311f)
`$lang
using Microsoft.AspNetCore.SignalR;
using System.Security.Claims;

namespace xbytechat.api.SignalR
{
    public class NameUserIdProvider : IUserIdProvider
    {
        public string? GetUserId(HubConnectionContext connection)
        {
            return connection.User?.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        }
    }
}

``n
--- file: xbytechat-api/Features/MessageManagement/Controllers/MessageStatusController.cs  (sha256:b0d7d3e99be2a95698a0e358da794c0d0f53a81c7f38846322df111c19fd0fbb)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.MessageManagement.Services;

namespace xbytechat.api.Features.MessageManagement.Controllers
{
    [ApiController]
    [Route("api/message-status")]
    public class MessageStatusController : ControllerBase
    {
        private readonly IMessageStatusService _service;
        private readonly ILogger<MessageStatusController> _logger;
        private readonly AppDbContext _context;
        private readonly IConfiguration _config;
        public MessageStatusController(
    IMessageStatusService service,
    ILogger<MessageStatusController> logger,
    AppDbContext context,
    IConfiguration config)
        {
            _service = service;
            _logger = logger;
            _context = context;
            _config = config;
        }

        // ✅ STEP 1: Webhook Verification (GET)
        [HttpGet("webhook")]
        public IActionResult VerifyWebhook([FromQuery(Name = "hub.mode")] string mode,
                                    [FromQuery(Name = "hub.verify_token")] string token,
                                    [FromQuery(Name = "hub.challenge")] string challenge)
        {
            //var VERIFY_TOKEN = _config["WhatsApp:MetaToken"]; // ✅ pulled from config

            if (mode == "subscribe" && token == "xbytechat-secret-token")
            {
                _logger.LogInformation("✅ Webhook verified.");
                return Ok(challenge);
            }

            _logger.LogWarning("❌ Webhook verification failed.");
            return Forbid();
        }


        // ✅ STEP 2: Webhook Payload (POST)
        [HttpPost("webhook")]
        public async Task<IActionResult> ReceiveStatus([FromBody] WebhookStatusDto dto)
        {
            if (dto == null || dto.statuses == null || dto.statuses.Count == 0)
            {
                _logger.LogWarning("⚠️ Invalid webhook payload received.");
                return BadRequest("Invalid payload");
            }

            await _service.LogWebhookStatusAsync(dto);
            _logger.LogInformation("✅ Webhook status processed successfully.");

            return Ok(new { success = true });
        }

        // ✅ STEP 3: Frontend UI (GET Logs)
        [HttpGet]
        public async Task<IActionResult> GetStatusLogs([FromQuery] Guid businessId)
        {
            var logs = await _context.MessageStatusLogs
                .Where(x => x.BusinessId == businessId)
                .OrderByDescending(x => x.CreatedAt)
                .Take(100)
                .Select(x => new
                {
                    x.MessageId,
                    x.RecipientNumber,
                    x.Status,
                    x.SentAt,
                    x.DeliveredAt,
                    x.ReadAt,
                    x.ErrorMessage,
                    x.TemplateCategory,
                    x.MessageType
                })
                .ToListAsync();

            return Ok(new { success = true, data = logs });
        }
    }
}

``n
--- file: xbytechat-api/Features/MessageManagement/DTOs/MessageLogDto.cs  (sha256:c0f207826b70160db8814aaf2e5fcf92174c9b5b7d0904bf27f60163fb2ca516)
`$lang
using System;

namespace xbytechat.api.Features.MessageManagement.DTOs
{
    public class MessageLogDto
    {
        public Guid Id { get; set; }
        public Guid? ContactId { get; set; }
        public string RecipientNumber { get; set; }
        public string MessageContent { get; set; }
        public bool IsIncoming { get; set; }
        public DateTime CreatedAt { get; set; }
        public string? RenderedBody { get; set; }
        public Guid? CampaignId { get; set; }
        public string? CampaignName { get; set; }
        public Guid? CTAFlowStepId { get; set; }
        public Guid? CTAFlowConfigId { get; set; }
    }
}


``n
--- file: xbytechat-api/Features/MessageManagement/DTOs/WebhookStatusDto.cs  (sha256:aeb1bd281f5cc025fcc6c5a2a924daf3078c9e774d3fad3860626f871caad053)
`$lang
namespace xbytechat.api.Features.MessageManagement.DTOs
{
    public class WebhookStatusDto
    {
        public List<StatusObject> statuses { get; set; }
    }

    public class StatusObject
    {
        public string id { get; set; }                     // Message ID (WAMID)
        public string status { get; set; }                 // sent, delivered, read, failed
        public long timestamp { get; set; }                // UNIX timestamp
        public string recipient_id { get; set; }           // Phone number
        public ConversationInfo conversation { get; set; }
        public PricingInfo pricing { get; set; }
        public List<ErrorInfo>? errors { get; set; }
    }

    public class ConversationInfo
    {
        public string id { get; set; }
        public Origin origin { get; set; }
    }

    public class Origin
    {
        public string type { get; set; }                   // marketing, utility, etc.
    }

    public class PricingInfo
    {
        public bool billable { get; set; }
        public string pricing_model { get; set; }
        public string category { get; set; }               // Template category
    }

    public class ErrorInfo
    {
        public int code { get; set; }
        public string title { get; set; }
        public string details { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/MessageManagement/Models/MessageStatusLog.cs  (sha256:3e0a8a53cdfb329873018f1c8d6d53c03ef5c6be3e10247853ed67761cafbb4f)
`$lang
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.AuthModule.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.BusinessModule.Models;


namespace xbytechat.api.Features.MessageManagement.DTOs
{
    public class MessageStatusLog
    {
        [Key]
        public Guid Id { get; set; }

        // 🔗 Who is it for
        public string RecipientNumber { get; set; }
        public string? CustomerProfileName { get; set; }

        // 📩 WhatsApp Message Info
       // [ForeignKey(nameof(Message))]
        public string? MessageId { get; set; } // WAMID

       // public MessageLog? Message { get; set; }
        public string Status { get; set; }
        public string MessageType { get; set; }

        // 🧾 Template Info
        public string? TemplateName { get; set; }
        public string? TemplateCategory { get; set; }

        // 🧠 Analytics/Reporting
        public string Channel { get; set; } = "whatsapp";
        public bool IsSessionOpen { get; set; }
        public long? MetaTimestamp { get; set; }

        // 🕒 Timestamps
        public DateTime? SentAt { get; set; }
        public DateTime? DeliveredAt { get; set; }
        public DateTime? ReadAt { get; set; }

        // ❌ Error Tracking
        public string? ErrorMessage { get; set; }
        public int? ErrorCode { get; set; }

        // 🔍 Raw Log (for audit/debug)
        public string? RawPayload { get; set; }

        // 🔗 Foreign Keys
        public Guid? CampaignId { get; set; }
        public Campaign? Campaign { get; set; }

        public Guid? BusinessId { get; set; }
        public Business? Business { get; set; }

        public Guid? UserId { get; set; }
        public User? User { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        // ✅ Navigation using alternate key (WAMID)


    }
}

``n
--- file: xbytechat-api/Features/MessageManagement/Services/IMessageStatusService.cs  (sha256:cca96e16b96ab978d9e4c344d9a12a8377da0c701b18ea3e5e1bb981d1d6578a)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.MessageManagement.DTOs;

namespace xbytechat.api.Features.MessageManagement.Services
{
    public interface IMessageStatusService
    {
        Task LogWebhookStatusAsync(WebhookStatusDto dto);

    }
}

``n
--- file: xbytechat-api/Features/MessageManagement/Services/MessageStatusService.cs  (sha256:f68c41d4a80e28d1b1de9da188c8b43c756b495494588de6fd11c8275d59a544)
`$lang
using System;
using System.Threading.Tasks;
using System.Collections.Generic;
using Microsoft.Extensions.Logging;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.MessageManagement.Services;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Models.BusinessModel;
using xbytechat.api.AuthModule.Models;
using Microsoft.EntityFrameworkCore;

namespace xbytechat.api.Features.MessageManagement.Services
{
    public class MessageStatusService : IMessageStatusService
    {
        private readonly AppDbContext _context;
        private readonly ILogger<MessageStatusService> _logger;

        public MessageStatusService(AppDbContext context, ILogger<MessageStatusService> logger)
        {
            _context = context;
            _logger = logger;
        }

        public async Task LogWebhookStatusAsync(WebhookStatusDto dto)
        {
            foreach (var status in dto.statuses)
            {
                var log = new MessageStatusLog
                {
                    Id = Guid.NewGuid(),
                    MessageId = status.id,
                    Status = status.status.ToLower(),
                    RecipientNumber = status.recipient_id,
                    MetaTimestamp = status.timestamp,
                    TemplateCategory = status?.pricing?.category,
                    MessageType = status?.conversation?.origin?.type ?? "session",
                    Channel = "whatsapp",
                    CreatedAt = DateTime.UtcNow,
                    RawPayload = System.Text.Json.JsonSerializer.Serialize(status)
                };

                var statusTime = DateTimeOffset.FromUnixTimeSeconds(status.timestamp).UtcDateTime;

                switch (status.status.ToLower())
                {
                    case "sent": log.SentAt = statusTime; break;
                    case "delivered": log.DeliveredAt = statusTime; break;
                    case "read": log.ReadAt = statusTime; break;
                }

                if (status.errors != null && status.errors.Count > 0)
                {
                    log.ErrorMessage = status.errors[0].details;
                    log.ErrorCode = status.errors[0].code;
                }

                await _context.MessageStatusLogs.AddAsync(log);
            }

            // ⛑️ Wrap in try-catch and log full inner exception
            try
            {
                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError("❌ SaveChangesAsync failed: " + ex.Message);
                _logger.LogError("❌ Inner exception: " + ex.InnerException?.Message);
                throw;
            }
        }

    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/Controllers/MessageEngineController.cs  (sha256:5bb38763d87308f4e4eca04c070150bb16bf85c0669dea83188183286c2906ae)
`$lang
using Microsoft.AspNetCore.Mvc;
using System.Security.Claims;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.ReportingModule.Services;
using xbytechat.api.Helpers;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.MessagesEngine.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class MessageEngineController : ControllerBase
    {
        private readonly IMessageEngineService _messageEngineService;
        private readonly IMessageAnalyticsService _messageAnalyticsServiceervice;


        public MessageEngineController(IMessageEngineService messageService,IMessageAnalyticsService messageAnalyticsService)
        {
            _messageEngineService = messageService;
            _messageAnalyticsServiceervice = messageAnalyticsService;
        }
        [HttpPost("send-text")]
        public async Task<IActionResult> SendTextMessage([FromBody] TextMessageSendDto dto)
        {
            if (!ModelState.IsValid)
                return BadRequest(ResponseResult.ErrorInfo("❌ Invalid text message payload."));

            try
            {
                var result = await _messageEngineService.SendTextDirectAsync(dto); // 👈 New direct method

                return result.Success
                    ? Ok(result)
                    : BadRequest(ResponseResult.ErrorInfo(result.Message, result.RawResponse));
            }
            catch (Exception ex)
            {
                Console.WriteLine($"❌ Exception while sending text message: {ex.Message}");
                return StatusCode(500, ResponseResult.ErrorInfo("🚨 Server error while sending text message.", ex.ToString()));
            }
        }


        [HttpPost("send-template-simple")]
        public async Task<IActionResult> SendTemplateMessageSimple([FromBody] SimpleTemplateMessageDto dto)
        {
            if (!ModelState.IsValid)
                return BadRequest(ResponseResult.ErrorInfo("❌ Invalid template message request."));

            try
            {
                var businessIdClaim = User.FindFirst("businessId")?.Value;
                if (!Guid.TryParse(businessIdClaim, out Guid businessId))
                    return Unauthorized(ResponseResult.ErrorInfo("❌ Business ID not found in token."));

                var result = await _messageEngineService.SendTemplateMessageSimpleAsync(businessId, dto);

                return result.Success
                    ? Ok(result)
                    : BadRequest(ResponseResult.ErrorInfo(result.Message ?? "❌ Failed to send template.", result.RawResponse));
            }
            catch (Exception ex)
            {
                Console.WriteLine($"❌ Exception while sending template: {ex.Message}");
                return StatusCode(500, ResponseResult.ErrorInfo("🚨 Server error while sending template.", ex.ToString()));
            }
        }

       
        [HttpPost("send-image-campaign/{campaignId}")]
        public async Task<IActionResult> SendImageCampaign(Guid campaignId)
        {
            try
            {
                var businessId = UserClaimHelper.GetBusinessId(User); // ✅ from
                                                                      // claims
                var userName = UserClaimHelper.GetUserName(User);     // for logging (if needed)

                var result = await _messageEngineService.SendImageCampaignAsync(campaignId, businessId, userName);

                return result.Success
                    ? Ok(result)
                    : BadRequest(result);
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Error while sending image campaign: " + ex.Message);
                return StatusCode(500, ResponseResult.ErrorInfo("Server error while sending campaign.", ex.ToString()));
            }
        }
        public static class UserClaimHelper
        {
            public static Guid GetBusinessId(ClaimsPrincipal user)
            {
                var claim = user.Claims.FirstOrDefault(c => c.Type == "businessId");
                return claim != null ? Guid.Parse(claim.Value) : Guid.Empty;
            }

            public static string GetUserName(ClaimsPrincipal user)
            {
                return user?.Identity?.Name ?? "Unknown";
            }
        }

        //[HttpPost("send-image-template")]
        //public async Task<IActionResult> SendImageTemplateMessage([FromBody] ImageTemplateMessageDto dto)
        //{
        //    if (string.IsNullOrWhiteSpace(dto.RecipientNumber) || string.IsNullOrWhiteSpace(dto.TemplateName))
        //        return BadRequest(new { message = "RecipientNumber and TemplateName are required." });

        //    var result = await _messageEngineService.SendImageTemplateMessageAsync(dto);

        //    if (result.Success)
        //        return Ok(new { message = result.Message, raw = result.RawResponse });

        //    return BadRequest(new { message = result.Message, raw = result.RawResponse });
        //}
        //[HttpPost("send-image-template")]
        //public async Task<IActionResult> SendImageTemplateMessage([FromBody] ImageTemplateMessageDto dto)
        //{
        //    // Extract BusinessId from claims (assuming it's saved as "BusinessId" claim)
        //    var businessIdClaim = User.Claims.FirstOrDefault(c => c.Type == "BusinessId")?.Value;
        //    if (string.IsNullOrEmpty(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))
        //        return Unauthorized(new { message = "BusinessId not found in user claims." });

        //    // Pass businessId explicitly to the service
        //    var result = await _messageEngineService.SendImageTemplateMessageAsync(dto, businessId);

        //    if (result.Success)
        //        return Ok(new { message = result.Message, raw = result.RawResponse });

        //    return BadRequest(new { message = result.Message, raw = result.RawResponse });
        //}
        [HttpPost("send-image-template")]
        public async Task<IActionResult> SendImageTemplateMessage([FromBody] ImageTemplateMessageDto dto)
        {
            Guid businessId;
            try
            {
                businessId = User.GetBusinessId(); // Uses your extension method!
            }
            catch (UnauthorizedAccessException ex)
            {
                return Unauthorized(new { message = ex.Message });
            }

            var result = await _messageEngineService.SendImageTemplateMessageAsync(dto, businessId);

            if (result.Success)
                return Ok(new { message = result.Message, raw = result.RawResponse });

            return BadRequest(new { message = result.Message, raw = result.RawResponse });
        }

        [HttpGet("recent")]
        public async Task<IActionResult> GetRecentLogs([FromQuery] int limit = 20)
        {
            var businessId = User.GetBusinessId();
            var logs = await _messageAnalyticsServiceervice.GetRecentLogsAsync(businessId, limit);
            return Ok(new { success = true, data = logs });
        }



    }
}
``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/AutoSendTemplateMessageDto.cs  (sha256:99519bdaed8df38337d3485148cfc53b4972c2616ebb386417321455ad582576)
`$lang
namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    public class AutoSendTemplateMessageDto
    {
        public Guid BusinessId { get; set; }
        public Guid ContactId { get; set; }
        public string PhoneNumber { get; set; }
        public Guid TemplateId { get; set; }
        public string TemplateName { get; set; }
        public Dictionary<string, string> Placeholders { get; set; } = new();
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/CtaButtonDto.cs  (sha256:60ecf5aa33d787f635ef05f11c48b8f9f6a11d48b2d7322f7f2ef575b91f9657)
`$lang
namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    public class CtaButtonDto
    {
        public string Title { get; set; } = string.Empty; // e.g., "Buy Now", "View Details"
        public string Type { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/ImageTemplateMessageDto.cs  (sha256:97564675c3c457ff71f51a241ad4cbca69ec60eaab2b81b81c14fb2360ae34f0)
`$lang
using xbytechat.api.Features.CampaignModule.DTOs;

public class ImageTemplateMessageDto
{
    public Guid BusinessId { get; set; }
    public string RecipientNumber { get; set; }
    public string TemplateName { get; set; }
    public string LanguageCode { get; set; } = "en_US";
    public string HeaderImageUrl { get; set; }
    public List<string> TemplateParameters { get; set; } = new();
    public List<CampaignButtonDto> ButtonParameters { get; set; } = new();

    // ✅ Add these two for flow tracking
    public Guid? CTAFlowConfigId { get; set; }
    public Guid? CTAFlowStepId { get; set; }
    public string? TemplateBody { get; set; }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/MessageTypeEnum.cs  (sha256:d3120f117dc16b8ab9901ba3726defab664b2a9b4a5414eff586e7e27f55062a)
`$lang
using System.Text.Json.Serialization;

namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    [JsonConverter(typeof(JsonStringEnumConverter))] // Enables string parsing in JSON
    public enum MessageTypeEnum
    {
        Text,
        Image,
        Template,
        Cta
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/SendMessageDto.cs  (sha256:1c45c09fda3fbb66ba843912c7617fe09447ec841b82f4b0f5c2a08cf8341fc1)
`$lang
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.Features.MessagesEngine.DTOs.Validation;

namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    [ValidateMessageDto] // ✅ Custom validator will enforce conditional field rules
    public class SendMessageDto
    {
        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        [Phone]
        public string RecipientNumber { get; set; } = string.Empty;

        [Required]
        public MessageTypeEnum MessageType { get; set; }

        // 📝 Text Message
        public string? TextContent { get; set; }

        // 🖼️ Image Message
        public string? MediaUrl { get; set; }

        // 📋 Template Message
        public string? TemplateName { get; set; }
        public Dictionary<string, string>? TemplateParameters { get; set; }

        // 🛒 CTA Message
        public List<CtaButtonDto>? CtaButtons { get; set; }

        // ✅ Required: this was missing [Optional but needed for CTA/Template message sending]
        public List<string>? ButtonParams { get; set; }

        // 📊 Optional Metadata
        public Guid? CampaignId { get; set; }
        public Guid? CTAFlowConfigId { get; set; }
        public Guid? CTAFlowStepId { get; set; }

        public string? SourceModule { get; set; }
        public string? CustomerId { get; set; }
        public string? CustomerName { get; set; }
        public string? CustomerPhone { get; set; }
        public string? BotId { get; set; }
        public string? RefMessageId { get; set; }
        public string? CTATriggeredFrom { get; set; }
        public DateTime? ScheduledAt { get; set; }

        // ✅ Add these two for flow tracking
        public string? TemplateBody { get; set; }  // 🔥 Used to render actual message body from placeholders

    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/SendTemplateMessageSimpleDto.cs  (sha256:00dc74bb6a1b396bab6fcd63f93454cfd59671260c4da8b0afd8754e83e10ce8)
`$lang
namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    public class SendTemplateMessageSimpleDto
    {
        public Guid BusinessId { get; set; }
        public string RecipientNumber { get; set; }
        public string TemplateName { get; set; }
        public List<string> TemplateParameters { get; set; } = new();
        // ✅ Add these two for flow tracking
        public Guid? CTAFlowConfigId { get; set; }
        public Guid? CTAFlowStepId { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/SimpleTemplateMessageDto.cs  (sha256:13b09ae3db26e3770de01db13a5f5dabff0f7e5b09c9ed73dc44272e47699ac2)
`$lang
using System;
using System.Collections.Generic;

namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    public class SimpleTemplateMessageDto
    {
        //public Guid BusinessId { get; set; }

        public string RecipientNumber { get; set; }

        public string TemplateName { get; set; }

        public List<string> TemplateParameters { get; set; } = new();
        public bool HasStaticButtons { get; set; } = false;

        // ✅ Add these two for flow tracking
        public Guid? CTAFlowConfigId { get; set; }
        public Guid? CTAFlowStepId { get; set; }
        public string? TemplateBody { get; set; }  // 🔥 Used to render actual message body from placeholders

    }
}


``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/TemplateForUIResponseDto.cs  (sha256:9b7be7ee8b48ca30422fe6b4ee2eb6af563f79ae7abad04aaaab9fdb4658612b)
`$lang
using xbytechat.api.WhatsAppSettings.DTOs;

public class TemplateForUIResponseDto
{
    public string Name { get; set; }
    public string Language { get; set; }
    public string Body { get; set; }

    // ✅ Correct naming for frontend
    public int ParametersCount { get; set; }

    public List<ButtonMetadataDto> ButtonParams { get; set; }
    public bool HasImageHeader { get; set; } // 🆕 Used to detect image templates

}

``n
--- file: xbytechat-api/Features/MessagesEngine/DTOs/TextMessageSendDto.cs  (sha256:7b96b59a33cc5ad7c6b1d5d926ecb2a851478863db2de77661a8b2ae5409e90a)
`$lang
namespace xbytechat.api.Features.MessagesEngine.DTOs
{
    public class TextMessageSendDto
    {
        public Guid BusinessId { get; set; }

        public string RecipientNumber { get; set; }

        public string TextContent { get; set; }

        public Guid ContactId { get; set; }

        // ✅ NEW: Optional source indicator (e.g., "campaign", "auto-reply", etc.)
        public string? Source { get; set; }

        // ✅ NEW: Optional message ID for campaign tracing
        public string? MessageId { get; set; }


    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/CtaMessagePayloadBuilder.cs  (sha256:f23794fdb8775eff63c5d249f23e74b7ff5e4497daa7b255ce94693b3ba9a6f7)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public class CtaMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(SendMessageDto dto)
        {
            return new
            {
                messaging_product = "whatsapp",
                to = dto.RecipientNumber,
                type = "interactive",
                interactive = new
                {
                    type = "button",
                    body = new { text = dto.TextContent },
                    action = new
                    {
                        buttons = dto.CtaButtons?.Select(b => new
                        {
                            type = "reply",
                            reply = new
                            {
                                id = b.Value,
                                title = b.Title
                            }
                        }).ToList()
                    }
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/ImageMessagePayloadBuilder.cs  (sha256:1400148a9ed0b32af7ece6c87b111a1407feda0f5b651819257c5b740bb01106)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public class ImageMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(SendMessageDto dto)
        {
            return new
            {
                messaging_product = "whatsapp",
                to = dto.RecipientNumber,
                type = "image",
                image = new
                {
                    link = dto.MediaUrl
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/IWhatsAppPayloadBuilder.cs  (sha256:89d6b688ba597eb931cd71401717698a692f3e3b645a02d60c1d73dae24731d3)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public interface IWhatsAppPayloadBuilder
    {
        object BuildPayload(SendMessageDto dto);
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/MessagePayloadBuilder.cs  (sha256:5f3fdb0eec9de51853f33783973029ee43bf803491c0679c460374e2816f0d01)
`$lang
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Shared.utility;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public static class MessagePayloadBuilder
    {
        /// <summary>
        /// Builds a WhatsApp template message payload for image header + buttons.
        /// </summary>
        public static object BuildImageTemplatePayload(
            string templateName,
            string languageCode,
            string recipientNumber,
            List<string> templateParams,
            string? imageUrl,
            List<CampaignButton>? buttons
        )
        {
            var components = new List<object>();

            // ✅ Body with template params
            if (templateParams != null && templateParams.Any())
            {
                components.Add(new
                {
                    type = "body",
                    parameters = templateParams.Select(p => new { type = "text", text = p }).ToArray()
                });
            }

            // ✅ Header image if present
            if (!string.IsNullOrWhiteSpace(imageUrl))
            {
                components.Add(new
                {
                    type = "header",
                    parameters = new[]
                    {
                    new { type = "image", image = new { link = imageUrl } }
                }
                });
            }

            // ✅ CTA buttons
            if (buttons != null && buttons.Any())
            {
                var buttonComponents = buttons
                    .OrderBy(b => b.Position)
                    .Take(3)
                    .Select((btn, index) => new
                    {
                        type = "button",
                        sub_type = btn.Type, // "url" or "phone_number"
                        index = index.ToString(),
                        parameters = new[]
                        {
                        new { type = "text", text = btn.Value }
                        }
                    });

                components.AddRange(buttonComponents);
            }

            // ✅ Final WhatsApp Template Payload
            return new
            {
                messaging_product = "whatsapp",
                to = recipientNumber,
                type = "template",
                template = new
                {
                    name = templateName,
                    language = new { code = languageCode },
                    components = components
                }
            };
        }
    }

}
``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/TemplateMessagePayloadBuilder.cs  (sha256:9f758fa90c76d160a238d286c153202e8e74f4de2261287d81cd8838f5ca8b40)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public class TemplateMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(SendMessageDto dto)
        {
            var components = new List<object>();

            // ✅ BODY PARAMETERS: Insert dynamic values into the template body
            // WhatsApp expects these to be in order ({{1}}, {{2}}, etc.)
            if (dto.TemplateParameters == null || dto.TemplateParameters.Count == 0)
                return ResponseResult.ErrorInfo("❌ Missing template parameters.");
            if (dto.TemplateParameters != null && dto.TemplateParameters.Any())
                {
                var bodyParams = dto.TemplateParameters
                    .OrderBy(kvp => int.Parse(kvp.Key.Trim('{', '}'))) // 🔢 Extract and sort by index
                    .Select(kvp => new
                    {
                        type = "text",
                        text = kvp.Value
                    }).ToArray();

                components.Add(new
                {
                    type = "body",
                    parameters = bodyParams
                });
            }

            // ✅ BUTTON PARAMETERS: For templates with dynamic URL buttons (index-based)
            if (dto.ButtonParams != null && dto.ButtonParams.Any())
            {
                for (int i = 0; i < dto.ButtonParams.Count; i++)
                {
                    components.Add(new
                    {
                        type = "button",
                        sub_type = "url",
                        index = i.ToString(), // WhatsApp requires index as a string
                        parameters = new[]
                        {
                            new
                            {
                                type = "text",
                                text = dto.ButtonParams[i]
                            }
                        }
                    });
                }
            }

            // ✅ FINAL WHATSAPP TEMPLATE PAYLOAD
            var payload = new
            {
                messaging_product = "whatsapp",
                to = dto.RecipientNumber,
                type = "template",
                template = new
                {
                    name = dto.TemplateName,
                    language = new { code = "en_US" },
                    components = components
                }
            };

            // 🪵 Debug log for developer console (optional)
            Console.WriteLine("📦 Built WhatsApp Template Payload:");
            Console.WriteLine(System.Text.Json.JsonSerializer.Serialize(payload, new System.Text.Json.JsonSerializerOptions
            {
                WriteIndented = true
            }));

            return payload;
        }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/TemplateStaticButtonPayloadBuilder.cs  (sha256:68979e5fa2d53ce3fa319c20377ca2022bf9e46b7244c817fb53f84594392f72)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public class TemplateStaticButtonPayloadBuilder
    {
        public static object Build(SendTemplateMessageSimpleDto dto)
        {
            var components = new List<object>();

            // ✅ Add Body Params
            if (dto.TemplateParameters != null && dto.TemplateParameters.Any())
            {
                components.Add(new
                {
                    type = "body",
                    parameters = dto.TemplateParameters.Select(p => new
                    {
                        type = "text",
                        text = p
                    }).ToArray()
                });
            }

            // ⚠️ DO NOT add button components for static buttons
            // Meta will render them automatically if template has static buttons defined
            // You can later add logic here for dynamic buttons if needed

            return new
            {
                messaging_product = "whatsapp",
                to = dto.RecipientNumber,
                type = "template",
                template = new
                {
                    name = dto.TemplateName,
                    language = new { code = "en_US" },
                    components = components
                }
            };
        }
    }
}


``n
--- file: xbytechat-api/Features/MessagesEngine/PayloadBuilders/TextMessagePayloadBuilder.cs  (sha256:abc17e5a60e2f58ba07c610db126262040f598a15aca27d2f85d52afc2fb4766)
`$lang
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.PayloadBuilders
{
    public class TextMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(SendMessageDto dto)
        {
            return new
            {
                messaging_product = "whatsapp",
                to = dto.RecipientNumber,
                type = "text",
                text = new
                {
                    body = dto.TextContent
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/Services/IMessageEngineService.cs  (sha256:9e3238790374a70a6f1e9205036a372269dbce950e53bb2efd44aa2156b579c2)
`$lang
// ✅ Step 1: Final interface
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Helpers;
using System.Threading.Tasks;
using System.IO.Pipelines;
using xbytechat.api.Features.MessageManagement.DTOs;

namespace xbytechat.api.Features.MessagesEngine.Services
{
    public interface IMessageEngineService
    {

        Task<ResponseResult> SendTemplateMessageAsync(SendMessageDto dto); //
        Task<ResponseResult> SendTextDirectAsync(TextMessageSendDto dto);
        Task<ResponseResult> SendAutomationReply(TextMessageSendDto dto);
        Task<ResponseResult> SendTemplateMessageSimpleAsync(Guid businessId,SimpleTemplateMessageDto dto);
        Task<ResponseResult> SendImageCampaignAsync(Guid campaignId, Guid businessId, string triggeredBy);
        //Task<ResponseResult> SendImageTemplateMessageAsync(ImageTemplateMessageDto dto);
        Task<ResponseResult> SendImageTemplateMessageAsync(ImageTemplateMessageDto dto, Guid businessId);
        Task<ResponseResult> SendToWhatsAppAsync(object payload, Guid businessId);
        //Task<IEnumerable<MessageLogDto>> GetLogsByBusinessIdAsync(Guid businessId);

    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/Services/ITemplateMessageSender.cs  (sha256:8da7dff35e83f585fcca22a680aaed11b677d5d033a41d582124f899ed1660ff)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Shared;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.MessagesEngine.Services
{
    public interface ITemplateMessageSender
    {
        /// <summary>
        /// Sends a template message to a single contact (used in AutoReply/Flows).
        /// </summary>
        Task<ResponseResult> SendTemplateMessageToContactAsync(
            Guid businessId,
            Contact contact,
            string templateName,
            List<string> templateParams,
            string? imageUrl = null,
            List<CampaignButton>? buttons = null,
            string? source = null,
            Guid? refMessageId = null
        );

        Task<ResponseResult> SendTemplateCampaignAsync(Campaign campaign);
    }
}


``n
--- file: xbytechat-api/Features/MessagesEngine/Services/MessageEngineService.cs  (sha256:144892e8c37ae636bd916ca7dd76eb8303f7a028d6c7d16373d9bc9d35246ae6)
`$lang
using Newtonsoft.Json;
using Microsoft.EntityFrameworkCore;
using System.Net.Http.Headers;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.PayloadBuilders;
using xbytechat.api.Features.PlanManagement.Services;
using xbytechat.api.Helpers;
using xbytechat.api.Shared;
using xbytechat.api;
using xbytechat_api.WhatsAppSettings.Models;
using System.Text;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignTracking.Models;
using System.IO.Pipelines;
using System.Net.Http;
using xbytechat.api.Shared.utility;
//using System.Text.Json;
using Microsoft.AspNetCore.SignalR;
using xbytechat.api.Features.Inbox;
using xbytechat.api.Features.Inbox.Hubs;
using System.Text.Json;
using xbytechat.api.Features.Webhooks.Services.Resolvers;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.ReportingModule.DTOs;


namespace xbytechat.api.Features.MessagesEngine.Services
{
    public class MessageEngineService : IMessageEngineService
    {
        private readonly AppDbContext _db;
        private readonly HttpClient _http;
        private readonly TextMessagePayloadBuilder _textBuilder;
        private readonly ImageMessagePayloadBuilder _imageBuilder;
        private readonly TemplateMessagePayloadBuilder _templateBuilder;
        private readonly CtaMessagePayloadBuilder _ctaBuilder;
        private readonly IPlanManager _planManager;
        private readonly IHubContext<InboxHub> _hubContext;
        private readonly IMessageIdResolver _messageIdResolver;
        private readonly IHttpContextAccessor _httpContextAccessor;
        private readonly IContactService _contactService;
        // 🔄 Basic cache for WhatsApp settings to reduce DB load
        private static readonly Dictionary<Guid, (WhatsAppSettingEntity setting, DateTime expiresAt)> _settingsCache = new();

        public MessageEngineService(
            AppDbContext db,
            HttpClient http,
            TextMessagePayloadBuilder textBuilder,
            ImageMessagePayloadBuilder imageBuilder,
            TemplateMessagePayloadBuilder templateBuilder,
            CtaMessagePayloadBuilder ctaBuilder,
            IPlanManager planManager, IHubContext<InboxHub> hubContext, IMessageIdResolver messageIdResolver, IHttpContextAccessor httpContextAccessor,
            IContactService contactService
            )
        {
            _db = db;
            _http = http;
            _textBuilder = textBuilder;
            _imageBuilder = imageBuilder;
            _templateBuilder = templateBuilder;
            _ctaBuilder = ctaBuilder;
            _planManager = planManager;
            _hubContext = hubContext;
            _messageIdResolver = messageIdResolver;
            _httpContextAccessor = httpContextAccessor;
            _contactService = contactService;
               
        }

        public async Task<ResponseResult> SendToWhatsAppAsync(object payload, Guid businessId)
        {
            var settings = await GetBusinessWhatsAppSettingsAsync(businessId);
            var token = settings.ApiToken;
            var phoneId = settings.PhoneNumberId;
            var baseUrl = settings.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0";
            var url = $"{baseUrl}/{phoneId}/messages";

            var request = new HttpRequestMessage(HttpMethod.Post, url)
            {
                Content = new StringContent(JsonConvert.SerializeObject(payload), Encoding.UTF8, "application/json")
            };

            request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", token);

            Console.WriteLine("🚀 Final Payload:");
            Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

            var response = await _http.SendAsync(request);
            // 🌐 Status
            Console.WriteLine($"Status: {(int)response.StatusCode} {response.ReasonPhrase}");

            // 📋 Headers
            Console.WriteLine("Headers:");
            foreach (var header in response.Headers)
            {
                Console.WriteLine($"{header.Key}: {string.Join(", ", header.Value)}");
            }
            foreach (var header in response.Content.Headers)
            {
                Console.WriteLine($"{header.Key}: {string.Join(", ", header.Value)}");
            }
            // 📦 Body (content)
            var body = await response.Content.ReadAsStringAsync();

            // ❌ Handle token errors or failure
            if (!response.IsSuccessStatusCode)
            {
                if (body.Contains("invalid_token") || body.Contains("Error validating access token"))
                {
                    return ResponseResult.ErrorInfo(
                        "❌ WhatsApp token has expired. Please update your token.",
                        "Access token expired",
                        body
                    );
                }

                return ResponseResult.ErrorInfo(
                    "❌ WhatsApp API returned an error.",
                    "API returned error",
                    body
                );
            }

            // ✅ Parse WAMID safely
            string? wamid = null;
            try
            {
                dynamic parsed = JsonConvert.DeserializeObject<dynamic>(body);
                wamid = parsed?.messages?[0]?.id;
            }
            catch (Exception ex)
            {
                Console.WriteLine("⚠️ Failed to parse WAMID: " + ex.Message);
            }

            // ✅ Use object initializer style
            var result = ResponseResult.SuccessInfo("✅ Message sent successfully", data: null, raw: body);
            result.MessageId = wamid;
            return result;
        }
        public async Task<ResponseResult> SendTemplateMessageAsync(SendMessageDto dto)
        {
            try
            {
                Console.WriteLine($"📨 Sending template message to {dto.RecipientNumber} via BusinessId {dto.BusinessId}");

                // ✅ Validate message type
                if (dto.MessageType != MessageTypeEnum.Template)
                    return ResponseResult.ErrorInfo("Only template messages are supported in this method.");

                // ✅ Quota check
                var quotaCheck = await _planManager.CheckQuotaBeforeSendingAsync(dto.BusinessId);
                if (!quotaCheck.Success)
                {
                    Console.WriteLine($"❌ Quota check failed: {quotaCheck.Message}");
                    return quotaCheck;
                }

                // ✅ Build payload
                var payload = _templateBuilder.BuildPayload(dto);
                Console.WriteLine("🔧 Built WhatsApp payload:");
                Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

                // 🚀 Send to WhatsApp API
                var sendResult = await SendToWhatsAppAsync(payload, dto.BusinessId);
                Console.WriteLine("✅ WhatsApp API response:");
                Console.WriteLine(JsonConvert.SerializeObject(sendResult, Formatting.Indented));

                // ✅ Build the rendered body before saving
                var resolvedBody = TemplateParameterHelper.FillPlaceholders(
                    dto.TemplateBody ?? "",
                    dto.TemplateParameters?.Values.ToList() ?? new List<string>()
                );

                // 📝 Log success
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName ?? "N/A",
                    RenderedBody = resolvedBody,
                    MediaUrl = null,
                    Status = "Sent",
                    ErrorMessage = null,
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    CTAFlowConfigId = dto.CTAFlowConfigId,
                    CTAFlowStepId = dto.CTAFlowStepId,
                };

                await _db.MessageLogs.AddAsync(log);

                // 📉 Decrement remaining quota
                var planInfo = await _db.BusinessPlanInfos
                    .FirstOrDefaultAsync(p => p.BusinessId == dto.BusinessId);

                if (planInfo != null && planInfo.RemainingMessages > 0)
                {
                    planInfo.RemainingMessages -= 1;
                    planInfo.UpdatedAt = DateTime.UtcNow;
                }

                await _db.SaveChangesAsync();

                // 📡 Send real-time message to SignalR group
                await _hubContext.Clients
                    .Group($"business_{dto.BusinessId}")
                    .SendAsync("ReceiveMessage", new
                    {
                        Id = log.Id,
                        RecipientNumber = log.RecipientNumber,
                        MessageContent = log.RenderedBody,
                        MediaUrl = log.MediaUrl,
                        Status = log.Status,
                        CreatedAt = log.CreatedAt,
                        SentAt = log.SentAt
                    });

                return ResponseResult.SuccessInfo("✅ Template message sent successfully.", sendResult, log.RawResponse);
            }
            catch (Exception ex)
            {
                var errorId = Guid.NewGuid();
                var fullError = $"🧨 Error ID: {errorId}\n{ex}";

                Console.WriteLine(fullError);

                await _db.MessageLogs.AddAsync(new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName ?? "N/A",
                    RenderedBody = TemplateParameterHelper.FillPlaceholders(
                        dto.TemplateBody ?? "",
                        dto.TemplateParameters?.Values.ToList() ?? new List<string>()
                    ),
                    Status = "Failed",
                    ErrorMessage = ex.Message,
                    RawResponse = ex.ToString(),
                    CreatedAt = DateTime.UtcNow
                });

                await _db.SaveChangesAsync();

                return ResponseResult.ErrorInfo(
                    $"❌ Exception occurred while sending template message. [Ref: {errorId}]",
                    ex.ToString()
                );
            }
        }

        private async Task<WhatsAppSettingEntity> GetBusinessWhatsAppSettingsAsync(Guid businessId)
        {
            if (_settingsCache.TryGetValue(businessId, out var cached) && cached.expiresAt > DateTime.UtcNow)
                return cached.setting;

            var business = await _db.Businesses
                .Include(b => b.WhatsAppSettings)
                .FirstOrDefaultAsync(b => b.Id == businessId);

            if (business == null || business.WhatsAppSettings == null)
                throw new Exception("WhatsApp settings not found.");

            _settingsCache[businessId] = (business.WhatsAppSettings, DateTime.UtcNow.AddMinutes(5));
            return business.WhatsAppSettings;
        }

           public async Task<ResponseResult> SendTextDirectAsync(TextMessageSendDto dto)
        {
            try
            {
                 //✅ Resolve business ID from context
                var businessId = _httpContextAccessor.HttpContext?.User?.GetBusinessId()
                     ?? throw new UnauthorizedAccessException("❌ Cannot resolve BusinessId from context.");


                // 🔍 Optionally associate with Contact
                Guid? contactId = null;
                try
                {
                    var contact = await _contactService.FindOrCreateAsync(businessId, dto.RecipientNumber);
                    contactId = contact.Id;
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"⚠️ Failed to resolve or create contact: {ex.Message}");
                }

                // ✅ Step 1: Build WhatsApp payload
                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = dto.RecipientNumber,
                    type = "text",
                    text = new
                    {
                        preview_url = false,
                        body = dto.TextContent
                    }
                };

                Console.WriteLine("✅ WhatsApp Text Payload:");
                Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

                // ✅ Step 2: Send to WhatsApp
                var sendResult = await SendToWhatsAppAsync(payload, businessId);

                // ✅ Step 3: Extract MessageId from response
                string? messageId = null;
                var raw = sendResult?.RawResponse;

                if (!string.IsNullOrWhiteSpace(raw))
                {
                    try
                    {
                        if (raw.TrimStart().StartsWith("{"))
                        {
                            var parsed = JsonDocument.Parse(raw);
                            if (parsed.RootElement.TryGetProperty("messages", out var messages) && messages.GetArrayLength() > 0)
                            {
                                messageId = messages[0].GetProperty("id").GetString();
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"⚠️ JSON parsing failed: {ex.Message} | Raw: {raw}");
                    }
                }

                // ✅ Step 4: Save MessageLog
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TextContent,
                    RenderedBody = dto.TextContent,
                    ContactId = contactId,
                    MediaUrl = null,
                    Status = "Sent",
                    ErrorMessage = null,
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    MessageId = messageId
                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                // ✅ Step 5: Optional campaign log mapping
                Guid? campaignSendLogId = null;
                if (dto.Source == "campaign" && !string.IsNullOrEmpty(messageId))
                {
                    try
                    {
                        campaignSendLogId = await _messageIdResolver.ResolveCampaignSendLogIdAsync(messageId);
                        Console.WriteLine($"📦 CampaignSendLog resolved: {campaignSendLogId}");
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"⚠️ Failed to resolve campaign log for {messageId}: {ex.Message}");
                    }
                }

                // ✅ Step 6: Return structured result
                return new ResponseResult
                {
                    Success = true,
                    Message = "✅ Text message sent successfully.",
                    Data = new
                    {
                        Success = true,
                        MessageId = messageId,
                        LogId = log.Id,
                        CampaignSendLogId = campaignSendLogId
                    },
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    MessageId = messageId,
                    LogId = log.Id
                };
            }
            catch (Exception ex)
            {
                Console.WriteLine($"❌ Exception in SendTextDirectAsync: {ex.Message}");

                // ❌ Log failed attempt with partial context
                try
                {
                    var businessId = _httpContextAccessor.HttpContext?.User?.GetBusinessId()
                               ?? throw new UnauthorizedAccessException("❌ Cannot resolve BusinessId in failure path.");

                    await _db.MessageLogs.AddAsync(new MessageLog
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        RecipientNumber = dto.RecipientNumber,
                        MessageContent = dto.TextContent,
                        Status = "Failed",
                        ErrorMessage = ex.Message,
                        CreatedAt = DateTime.UtcNow
                    });

                    await _db.SaveChangesAsync();
                }
                catch (Exception logEx)
                {
                    Console.WriteLine($"❌ Failed to log failure to DB: {logEx.Message}");
                }

                return ResponseResult.ErrorInfo("❌ Failed to send text message.", ex.ToString());
            }
        }
        public async Task<ResponseResult> SendAutomationReply(TextMessageSendDto dto)
        {
            try
            {
                // ✅ Resolve business ID from DTO or claims
                var businessId = (dto.BusinessId != Guid.Empty)
                    ? dto.BusinessId
                    : _httpContextAccessor.HttpContext?.User?.GetBusinessId()
                      ?? throw new UnauthorizedAccessException("❌ Cannot resolve BusinessId from context or DTO.");

                // 🔍 Optionally associate with Contact
                Guid? contactId = null;
                try
                {
                    var contact = await _contactService.FindOrCreateAsync(businessId, dto.RecipientNumber);
                    contactId = contact.Id;
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"⚠️ Failed to resolve or create contact: {ex.Message}");
                }

                // ✅ Step 1: Build WhatsApp payload
                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = dto.RecipientNumber,
                    type = "text",
                    text = new
                    {
                        preview_url = false,
                        body = dto.TextContent
                    }
                };

                Console.WriteLine("✅ WhatsApp Text Payload:");
                Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

                // ✅ Step 2: Send to WhatsApp
                var sendResult = await SendToWhatsAppAsync(payload, businessId);

                // ✅ Step 3: Extract MessageId from response
                string? messageId = null;
                var raw = sendResult?.RawResponse;

                if (!string.IsNullOrWhiteSpace(raw))
                {
                    try
                    {
                        if (raw.TrimStart().StartsWith("{"))
                        {
                            var parsed = JsonDocument.Parse(raw);
                            if (parsed.RootElement.TryGetProperty("messages", out var messages) && messages.GetArrayLength() > 0)
                            {
                                messageId = messages[0].GetProperty("id").GetString();
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"⚠️ JSON parsing failed: {ex.Message} | Raw: {raw}");
                    }
                }

                // ✅ Step 4: Save MessageLog
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TextContent,
                    RenderedBody = dto.TextContent,
                    ContactId = contactId,
                    MediaUrl = null,
                    Status = "Sent",
                    ErrorMessage = null,
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    MessageId = messageId
                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                // ✅ Step 5: Optional campaign log mapping
                Guid? campaignSendLogId = null;
                if (dto.Source == "campaign" && !string.IsNullOrEmpty(messageId))
                {
                    try
                    {
                        campaignSendLogId = await _messageIdResolver.ResolveCampaignSendLogIdAsync(messageId);
                        Console.WriteLine($"📦 CampaignSendLog resolved: {campaignSendLogId}");
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"⚠️ Failed to resolve campaign log for {messageId}: {ex.Message}");
                    }
                }

                // ✅ Step 6: Return structured result
                return new ResponseResult
                {
                    Success = true,
                    Message = "✅ Text message sent successfully.",
                    Data = new
                    {
                        Success = true,
                        MessageId = messageId,
                        LogId = log.Id,
                        CampaignSendLogId = campaignSendLogId
                    },
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    MessageId = messageId,
                    LogId = log.Id
                };
            }
            catch (Exception ex)
            {
                Console.WriteLine($"❌ Exception in SendAutomationReply: {ex.Message}");

                // ❌ Log failed attempt with partial context
                try
                {
                    var businessId = (dto.BusinessId != Guid.Empty)
                        ? dto.BusinessId
                        : _httpContextAccessor.HttpContext?.User?.GetBusinessId()
                          ?? throw new UnauthorizedAccessException("❌ Cannot resolve BusinessId in failure path.");

                    await _db.MessageLogs.AddAsync(new MessageLog
                    {
                        Id = Guid.NewGuid(),
                        BusinessId = businessId,
                        RecipientNumber = dto.RecipientNumber,
                        MessageContent = dto.TextContent,
                        Status = "Failed",
                        ErrorMessage = ex.Message,
                        CreatedAt = DateTime.UtcNow
                    });

                    await _db.SaveChangesAsync();
                }
                catch (Exception logEx)
                {
                    Console.WriteLine($"❌ Failed to log failure to DB: {logEx.Message}");
                }

                return ResponseResult.ErrorInfo("❌ Failed to send text message.", ex.ToString());
            }
        }


        //public async Task<ResponseResult> SendTemplateMessageSimpleAsync(SimpleTemplateMessageDto dto)
        //{
        //    try
        //    {
        //        // ✅ Build WhatsApp template payload with body only
        //        var payload = new
        //        {
        //            messaging_product = "whatsapp",
        //            to = dto.RecipientNumber,
        //            type = "template",
        //            template = new
        //            {
        //                name = dto.TemplateName,
        //                language = new { code = "en_US" },
        //                components = new[]
        //                {
        //            new
        //            {
        //                type = "body",
        //                parameters = dto.TemplateParameters.Select(p => new
        //                {
        //                    type = "text",
        //                    text = p
        //                }).ToArray()
        //            }
        //        }
        //            }
        //        };

        //        Console.WriteLine("📦 Template Payload (no buttons):");
        //        Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

        //        var sendResult = await SendToWhatsAppAsync(payload, dto.BusinessId);

        //        // ✅ Log success
        //        var log = new MessageLog
        //        {
        //            Id = Guid.NewGuid(),
        //            BusinessId = dto.BusinessId,
        //            RecipientNumber = dto.RecipientNumber,
        //            MessageContent = dto.TemplateName,
        //            RenderedBody = TemplateParameterHelper.FillPlaceholders(dto.TemplateBody ?? "", dto.TemplateParameters),

        //            MediaUrl = null,
        //            Status = "Sent", 
        //            ErrorMessage = null,
        //            RawResponse = JsonConvert.SerializeObject(sendResult),
        //            CreatedAt = DateTime.UtcNow,
        //            SentAt = DateTime.UtcNow,
        //            CTAFlowConfigId = dto.CTAFlowConfigId,
        //            CTAFlowStepId = dto.CTAFlowStepId,

        //        };

        //        await _db.MessageLogs.AddAsync(log);
        //        await _db.SaveChangesAsync();

        //        return ResponseResult.SuccessInfo("✅ Template sent successfully.", sendResult, log.RawResponse);
        //    }
        //    catch (Exception ex)
        //    {
        //        // ❌ Log failure
        //        // ❌ Log failure
        //        await _db.MessageLogs.AddAsync(new MessageLog
        //        {
        //            Id = Guid.NewGuid(),
        //            BusinessId = dto.BusinessId,
        //            RecipientNumber = dto.RecipientNumber,
        //            MessageContent = dto.TemplateName,

        //            RenderedBody = TemplateParameterHelper.FillPlaceholders(dto.TemplateBody ?? "", dto.TemplateParameters), // ✅ Add this
        //            Status = "Failed",
        //            ErrorMessage = ex.Message,
        //            CreatedAt = DateTime.UtcNow,
        //            CTAFlowConfigId = dto.CTAFlowConfigId,
        //            CTAFlowStepId = dto.CTAFlowStepId,
        //        });


        //        await _db.SaveChangesAsync();

        //        return ResponseResult.ErrorInfo("❌ Error sending template.", ex.ToString());
        //    }
        //}

        public async Task<ResponseResult> SendTemplateMessageSimpleAsync(Guid businessId, SimpleTemplateMessageDto dto)
        {
            try
            {
                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = dto.RecipientNumber,
                    type = "template",
                    template = new
                    {
                        name = dto.TemplateName,
                        language = new { code = "en_US" },
                        components = new[]
                        {
                    new
                    {
                        type = "body",
                        parameters = dto.TemplateParameters.Select(p => new
                        {
                            type = "text",
                            text = p
                        }).ToArray()
                    }
                }
                    }
                };

                var sendResult = await SendToWhatsAppAsync(payload, businessId);

                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName,
                    RenderedBody = TemplateParameterHelper.FillPlaceholders(dto.TemplateBody ?? "", dto.TemplateParameters),
                    Status = "Sent",
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    SentAt = DateTime.UtcNow,
                    CreatedAt = DateTime.UtcNow
                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                return ResponseResult.SuccessInfo("✅ Template sent successfully.", sendResult);
            }
            catch (Exception ex)
            {
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName,
                    RenderedBody = TemplateParameterHelper.FillPlaceholders(dto.TemplateBody ?? "", dto.TemplateParameters),
                    Status = "Failed",
                    ErrorMessage = ex.Message,
                    CreatedAt = DateTime.UtcNow
                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                return ResponseResult.ErrorInfo("❌ Template send failed", ex.Message);
            }
        }

        public async Task<ResponseResult> SendImageCampaignAsync(Guid campaignId, Guid businessId, string sentBy)
        {
            try
            {
                var campaign = await _db.Campaigns
                    .Include(c => c.MultiButtons)
                    .FirstOrDefaultAsync(c => c.Id == campaignId && c.BusinessId == businessId);

                if (campaign == null)
                    return ResponseResult.ErrorInfo("❌ Campaign not found or unauthorized.");

                var recipients = await _db.CampaignRecipients
                    .Include(r => r.Contact)
                    .Where(r => r.CampaignId == campaignId && r.BusinessId == businessId)
                    .ToListAsync();

                if (recipients.Count == 0)
                    return ResponseResult.ErrorInfo("⚠️ No recipients assigned to this campaign.");

                // ✅ Early Validation (Avoid WhatsApp 400 errors)
                if (string.IsNullOrWhiteSpace(campaign.ImageCaption))
                    return ResponseResult.ErrorInfo("❌ Campaign caption (ImageCaption) is required.");

                var validButtons = campaign.MultiButtons
                    ?.Where(b => !string.IsNullOrWhiteSpace(b.Title))
                    .Select(b => new CtaButtonDto
                    {
                        Title = b.Title,
                        Value = b.Value
                    })
                    .ToList();

                if (validButtons == null || validButtons.Count == 0)
                    return ResponseResult.ErrorInfo("❌ At least one CTA button with a valid title is required.");

                int successCount = 0, failCount = 0;

                foreach (var recipient in recipients)
                {
                    if (recipient.Contact == null || string.IsNullOrWhiteSpace(recipient.Contact.PhoneNumber))
                    {
                        Console.WriteLine($"⚠️ Skipping invalid contact: {recipient.Id}");
                        failCount++;
                        continue;
                    }

                    var dto = new SendMessageDto
                    {
                        BusinessId = businessId,
                        RecipientNumber = recipient.Contact.PhoneNumber,
                        MessageType = MessageTypeEnum.Image,
                        MediaUrl = campaign.ImageUrl,
                        TextContent = campaign.MessageTemplate,
                        CtaButtons = validButtons,

                        // Tracking metadata
                        CampaignId = campaign.Id,
                        SourceModule = "image-campaign",
                        CustomerId = recipient.Contact.Id.ToString(),
                        CustomerName = recipient.Contact.Name,
                        CustomerPhone = recipient.Contact.PhoneNumber,
                        CTATriggeredFrom = "campaign"


                    };

                    var result = await SendImageWithCtaAsync(dto); // Central engine

                    var sendLog = new CampaignSendLog
                    {
                        Id = Guid.NewGuid(),
                        CampaignId = campaign.Id,
                        ContactId = recipient.Contact.Id,
                        RecipientId = recipient.Id,
                        MessageLogId = result?.LogId,
                        SendStatus = result.Success ? "Sent" : "Failed",
                        SentAt = DateTime.UtcNow,
                        CreatedBy = sentBy,
                        BusinessId = businessId,
                    };

                    await _db.CampaignSendLogs.AddAsync(sendLog);

                    if (result.Success) successCount++;
                    else failCount++;
                }

                await _db.SaveChangesAsync();

                return ResponseResult.SuccessInfo(
                    $"✅ Campaign sent.\n📤 Success: {successCount}, ❌ Failed: {failCount}"
                );
            }
            catch (Exception ex)
            {
                Console.WriteLine($"❌ Error sending image campaign: {ex.Message}");
                return ResponseResult.ErrorInfo("❌ Unexpected error while sending image campaign.", ex.ToString());
            }
        }
                   
        public async Task<ResponseResult> SendImageWithCtaAsync(SendMessageDto dto)
        {
            try
            {
                Console.WriteLine($"📤 Sending image+CTA to {dto.RecipientNumber}");

                // ✅ Early validation: TextContent and at least one button
                if (string.IsNullOrWhiteSpace(dto.TextContent))
                    return ResponseResult.ErrorInfo("❌ Image message caption (TextContent) cannot be empty.");

                var validButtons = dto.CtaButtons?
                    .Where(b => !string.IsNullOrWhiteSpace(b.Title))
                    .Take(3)
                    .Select((btn, index) => new
                    {
                        type = "reply",
                        reply = new
                        {
                            id = $"btn_{index + 1}_{Guid.NewGuid().ToString("N").Substring(0, 8)}",
                            title = btn.Title
                        }
                    }).ToList();

                if (validButtons == null || validButtons.Count == 0)
                    return ResponseResult.ErrorInfo("❌ At least one CTA button with a valid title is required.");

                // 🧱 Build the payload
                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = dto.RecipientNumber,
                    type = "interactive",
                    interactive = new
                    {
                        type = "button",
                        body = new { text = dto.TextContent },
                        action = new
                        {
                            buttons = validButtons
                        }
                    },
                    image = string.IsNullOrWhiteSpace(dto.MediaUrl) ? null : new
                    {
                        link = dto.MediaUrl
                    }
                };

                Console.WriteLine("📦 Final payload:");
                Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

                // 🔁 Send to WhatsApp
                var sendResult = await SendToWhatsAppAsync(payload, dto.BusinessId);
                var rawJson = JsonConvert.SerializeObject(sendResult);

                // 📝 Log to DB
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TextContent ?? "[Image with CTA]",
                    RenderedBody = dto.TextContent ?? "",
                    MediaUrl = dto.MediaUrl,
                    Status = "Sent",
                    RawResponse = rawJson,
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    CTAFlowConfigId = dto.CTAFlowConfigId,
                    CTAFlowStepId = dto.CTAFlowStepId,
                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                var response = ResponseResult.SuccessInfo("✅ Image+CTA message sent.", null, rawJson);
                response.MessageId = log.Id.ToString();
                response.LogId = log.Id;
                return response;
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Exception in SendImageWithCtaAsync: " + ex.Message);

                await _db.MessageLogs.AddAsync(new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TextContent ?? "[Image CTA Failed]",
                    RenderedBody = dto.TextContent ?? "[Failed image CTA]",
                    Status = "Failed",
                    ErrorMessage = ex.Message,
                    RawResponse = ex.ToString(),
                    CreatedAt = DateTime.UtcNow,
                    CTAFlowConfigId = dto.CTAFlowConfigId,
                    CTAFlowStepId = dto.CTAFlowStepId,
                });

                await _db.SaveChangesAsync();

                return ResponseResult.ErrorInfo("❌ Failed to send image+CTA.", ex.ToString());
            }
        }

        //public async Task<ResponseResult> SendImageTemplateMessageAsync(ImageTemplateMessageDto dto)
        public async Task<ResponseResult> SendImageTemplateMessageAsync(ImageTemplateMessageDto dto, Guid businessId)
        {
            try
            {
                List<object> components = new List<object>();

                // ✅ Header (Image) component — optional
                if (!string.IsNullOrWhiteSpace(dto.HeaderImageUrl))
                {
                    components.Add(new
                    {
                        type = "header",
                        parameters = new[]
                        {
                    new
                    {
                        type = "image",
                        image = new
                        {
                            link = dto.HeaderImageUrl
                        }
                    }
                }
                    });
                }

                // ✅ Body (Template Parameters)
                components.Add(new
                {
                    type = "body",
                    parameters = dto.TemplateParameters.Select(p => new
                    {
                        type = "text",
                        text = p
                    }).ToArray()
                });

                // ✅ Buttons — dynamic (up to 3), skip invalid entries
                for (int i = 0; i < dto.ButtonParameters.Count && i < 3; i++)
                {
                    var btn = dto.ButtonParameters[i];
                    string subType = btn.ButtonType?.ToLower();

                    // 🛑 Skip if ButtonType or TargetUrl is missing
                    if (string.IsNullOrWhiteSpace(subType) || string.IsNullOrWhiteSpace(btn.TargetUrl))
                        continue;

                    var button = new Dictionary<string, object>
                    {
                        ["type"] = "button",
                        ["sub_type"] = subType,
                        ["index"] = i.ToString()
                    };

                    // 🧠 Add required parameters based on button subtype
                    if (subType == "quick_reply")
                    {
                        button["parameters"] = new[]
                        {
                    new
                    {
                        type = "payload",
                        payload = btn.TargetUrl
                    }
                };
                    }
                    else if (subType == "url")
                    {
                        button["parameters"] = new[]
                        {
                    new
                    {
                        type = "text",
                        text = btn.TargetUrl
                    }
                };
                    }
                    // ✅ Do not add parameters for phone/call type

                    components.Add(button);
                }

                // ✅ Final Payload
                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = dto.RecipientNumber,
                    type = "template",
                    template = new
                    {
                        name = dto.TemplateName,
                        language = new
                        {
                            code = dto.LanguageCode ?? "en_US"
                        },
                        components = components
                    }
                };

                Console.WriteLine("📦 Sending Image Template Payload:");
                Console.WriteLine(JsonConvert.SerializeObject(payload, Formatting.Indented));

                // ✅ Send to WhatsApp API
                object sendResult = await SendToWhatsAppAsync(payload, businessId);
                // ✅ Prepare rendered body (new)
                var renderedBody = TemplateParameterHelper.FillPlaceholders(
                    dto.TemplateBody ?? "",
                    dto.TemplateParameters ?? new List<string>()
                );

                // ✅ Save log on success
                var log = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName,
                    MediaUrl = dto.HeaderImageUrl,
                    Status = "Sent",
                    ErrorMessage = null,
                    RawResponse = JsonConvert.SerializeObject(sendResult),
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    CTAFlowConfigId = dto.CTAFlowConfigId,
                    CTAFlowStepId = dto.CTAFlowStepId,


                };

                await _db.MessageLogs.AddAsync(log);
                await _db.SaveChangesAsync();

                return ResponseResult.SuccessInfo("✅ Image template sent successfully.", sendResult, log.RawResponse);
            }
            catch (Exception ex)
            {
                // 🛑 Log failure
                await _db.MessageLogs.AddAsync(new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto.TemplateName,
                    RenderedBody = TemplateParameterHelper.FillPlaceholders(dto.TemplateBody ?? "", dto.TemplateParameters),

                    MediaUrl = dto.HeaderImageUrl,
                    Status = "Failed",
                    ErrorMessage = ex.Message,
                    CreatedAt = DateTime.UtcNow,
                    CTAFlowConfigId = dto.CTAFlowConfigId,
                    CTAFlowStepId = dto.CTAFlowStepId,
                });

                await _db.SaveChangesAsync();
                return ResponseResult.ErrorInfo("❌ Error sending image template.", ex.ToString());
            }
        }
        public async Task<IEnumerable<RecentMessageLogDto>> GetLogsByBusinessIdAsync(Guid businessId)
        {
            var logs = await _db.MessageLogs
                .Where(m => m.BusinessId == businessId)
                .OrderByDescending(m => m.CreatedAt)
                .Take(1000)
                .Select(m => new RecentMessageLogDto
                {
                    Id = m.Id,
                    RecipientNumber = m.RecipientNumber,
                    MessageContent = m.MessageContent,
                    Status = m.Status,
                    CreatedAt = m.CreatedAt,
                    SentAt = m.SentAt,
                    ErrorMessage = m.ErrorMessage
                })
                .ToListAsync();

            return logs;
        }
    }

}


``n
--- file: xbytechat-api/Features/MessagesEngine/Services/TemplateMessageSender.cs  (sha256:9316938182f43c5081969d0f706bb900ddb510f07296c4b88099304f15ea4caf)
`$lang
// 📄 File: Features/MessagesEngine/Services/TemplateMessageSender.cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Helpers;
using xbytechat.api.Shared;
using xbytechat.api.Shared.utility;
using xbytechat.api.WhatsAppSettings.DTOs;
using xbytechat_api.WhatsAppSettings.Services;

namespace xbytechat.api.Features.MessagesEngine.Services
{
    public class TemplateMessageSender : ITemplateMessageSender
    {
        private readonly AppDbContext _db;
        private readonly HttpClient _httpClient;
        private readonly ILogger<TemplateMessageSender> _logger;
        private readonly IWhatsAppTemplateFetcherService _templateService;

        public TemplateMessageSender(
            AppDbContext db,
            HttpClient httpClient,
            ILogger<TemplateMessageSender> logger,
            IWhatsAppTemplateFetcherService templateService)
        {
            _db = db;
            _httpClient = httpClient;
            _logger = logger;
            _templateService = templateService;
        }

        public async Task<ResponseResult> SendTemplateMessageToContactAsync(
            Guid businessId,
            Contact contact,
            string templateName,
            List<string> templateParams,
            string? imageUrl = null,
            List<CampaignButton>? buttons = null,
            string? source = null,
            Guid? refMessageId = null)
        {
            var setting = await _db.WhatsAppSettings.FirstOrDefaultAsync(s => s.BusinessId == businessId && s.IsActive);
            if (setting == null)
                return ResponseResult.ErrorInfo("WhatsApp settings not found for this business.");

            var template = await _templateService.GetTemplateByNameAsync(businessId, templateName, includeButtons: true);
            if (template == null)
                return ResponseResult.ErrorInfo("Template not found or invalid.");

            var payload = new Dictionary<string, object>
            {
                ["messaging_product"] = "whatsapp",
                ["to"] = contact.PhoneNumber,
                ["type"] = "template",
                ["template"] = new
                {
                    name = template.Name,
                    language = new { code = template.Language },
                    components = BuildTemplateComponents(template, templateParams, imageUrl, buttons)
                }
            };

            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", setting.ApiToken);
            var json = JsonSerializer.Serialize(payload);
            var response = await _httpClient.PostAsync(
                $"{setting.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0"}/{setting.PhoneNumberId}/messages",
                new StringContent(json, Encoding.UTF8, "application/json"));

            var responseBody = await response.Content.ReadAsStringAsync();
            var status = response.IsSuccessStatusCode ? "Sent" : "Failed";

            await _db.MessageLogs.AddAsync(new MessageLog
            {
                Id = Guid.NewGuid(),
                BusinessId = businessId,
                ContactId = contact.Id,
                MessageContent = template.Name,
                MediaUrl = imageUrl,
                Status = status,
                RawResponse = responseBody,
                ErrorMessage = response.IsSuccessStatusCode ? null : responseBody,
                Source = source,
                RefMessageId = refMessageId,
                CreatedAt = DateTime.UtcNow,
                SentAt = DateTime.UtcNow
            });

            await _db.SaveChangesAsync();
            return response.IsSuccessStatusCode
                ? ResponseResult.SuccessInfo("✅ Message sent successfully", null, responseBody)
                : ResponseResult.ErrorInfo("❌ Message failed", null, responseBody);

        }

        public async Task<ResponseResult> SendTemplateCampaignAsync(Campaign campaign)
        {
            if (campaign == null || campaign.IsDeleted)
                return ResponseResult.ErrorInfo("Invalid or deleted campaign.");

            var contacts = await _db.CampaignRecipients
                .Include(r => r.Contact)
                .Where(r => r.CampaignId == campaign.Id && r.Contact != null)
                .ToListAsync();

            if (!contacts.Any())
                return ResponseResult.ErrorInfo("No contacts found for this campaign.");

            var templateName = campaign.TemplateId;
            var templateParams = TemplateParameterHelper.ParseTemplateParams(campaign.TemplateParameters);
            var templateMeta = await _templateService.GetTemplateByNameAsync(campaign.BusinessId, templateName, includeButtons: true);

            if (templateMeta == null)
                return ResponseResult.ErrorInfo("Template metadata not found.");

            int success = 0, failed = 0;

            foreach (var r in contacts)
            {
                var result = await SendTemplateMessageToContactAsync(
                    campaign.BusinessId,
                    r.Contact,
                    templateName,
                    templateParams,
                    campaign.ImageUrl,
                    campaign.MultiButtons?.ToList(),
                    source: "campaign",
                    refMessageId: campaign.Id);

                await _db.CampaignSendLogs.AddAsync(new CampaignSendLog
                {
                    Id = Guid.NewGuid(),
                    CampaignId = campaign.Id,
                    ContactId = r.ContactId,
                    RecipientId = r.Id,
                    MessageBody = campaign.MessageBody ?? templateName,
                    TemplateId = templateName,
                    SendStatus = result.Success ? "Sent" : "Failed",
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    CreatedBy = campaign.CreatedBy
                });

                if (result.Success) success++;
                else failed++;
            }

            await _db.SaveChangesAsync();
            return ResponseResult.SuccessInfo($"📤 Sent to {success}, ❌ Failed for {failed}.");
        }

        private List<object> BuildTemplateComponents(
            TemplateMetadataDto template,
            List<string> paramsList,
            string? imageUrl,
            List<CampaignButton>? buttons)
        {
            var components = new List<object>();

            if (template.HasImageHeader && !string.IsNullOrWhiteSpace(imageUrl))
            {
                components.Add(new
                {
                    type = "header",
                    parameters = new[] { new { type = "image", image = new { link = imageUrl } } }
                });
            }

            if (paramsList.Any())
            {
                components.Add(new
                {
                    type = "body",
                    parameters = paramsList.Select(p => new { type = "text", text = p }).ToList()
                });
            }

            if (buttons != null && buttons.Any())
            {
                for (int i = 0; i < buttons.Count; i++)
                {
                    var btn = buttons[i];
                    components.Add(new
                    {
                        type = "button",
                        sub_type = btn.Type?.ToLower() == "url" ? "url" : "quick_reply",
                        index = i.ToString(),
                        parameters = new[] {
                            new {
                                type = "text",
                                text = btn.Value ?? btn.Title
                            }
                        }
                    });
                }
            }

            return components;
        }
    }
}

``n
--- file: xbytechat-api/Features/MessagesEngine/Validators/ValidateMessageDtoAttribute.cs  (sha256:9b7355295c8cecdf6c4416a324d05f0910b3ff67e99fd35e04e397f715096a9b)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using xbytechat.api.Features.MessagesEngine.DTOs;

namespace xbytechat.api.Features.MessagesEngine.DTOs.Validation
{
    [AttributeUsage(AttributeTargets.Class, AllowMultiple = false)]
    public class ValidateMessageDtoAttribute : ValidationAttribute
    {
        protected override ValidationResult? IsValid(object? value, ValidationContext validationContext)
        {
            if (value is not SendMessageDto dto)
                return ValidationResult.Success;

            switch (dto.MessageType)
            {
                case MessageTypeEnum.Text:
                    if (string.IsNullOrWhiteSpace(dto.TextContent))
                        return new ValidationResult("TextContent is required for text messages.", new[] { nameof(dto.TextContent) });
                    break;

                case MessageTypeEnum.Image:
                    if (string.IsNullOrWhiteSpace(dto.MediaUrl))
                        return new ValidationResult("MediaUrl is required for image messages.", new[] { nameof(dto.MediaUrl) });
                    break;

                case MessageTypeEnum.Template:
                    if (string.IsNullOrWhiteSpace(dto.TemplateName))
                        return new ValidationResult("TemplateName is required for template messages.", new[] { nameof(dto.TemplateName) });
                    break;

                case MessageTypeEnum.Cta:
                    if (dto.CtaButtons == null || dto.CtaButtons.Count == 0)
                        return new ValidationResult("CtaButtons is required for CTA messages.", new[] { nameof(dto.CtaButtons) });
                    break;
            }

            return ValidationResult.Success;
        }
    }
}

``n
--- file: xbytechat-api/Features/PlanManagement/Models/BusinessPlanInfo.cs  (sha256:4a8d4603750b0630eec386cbb831948aaa2cc2f5872d4e1b178da2b9a6952bc7)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.PlanManagement.Models;

namespace xbytechat.api.Models.BusinessModel
{
    public class BusinessPlanInfo
    {
        [Key]
        public Guid Id { get; set; } = Guid.NewGuid();

        // 🔗 Foreign key to Business
        [Required]
        public Guid BusinessId { get; set; }

        [ForeignKey(nameof(BusinessId))]
        public Business Business { get; set; }

        // 📦 Plan Management
        [Required]
        public PlanType Plan { get; set; } = PlanType.Trial; // Default Trial

        [Required]
        public int TotalMonthlyQuota { get; set; } = 100; // Default Trial Messages

        [Required]
        public int RemainingMessages { get; set; } = 100;

        public DateTime QuotaResetDate { get; set; } = DateTime.UtcNow.AddMonths(1);

        // 💰 Wallet Management (optional)
        public decimal WalletBalance { get; set; } = 0.00m;

        // 📅 Timestamps
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
        public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/PlanManagement/Models/PlanFeature.cs  (sha256:af8483d1a28e7555f8111b552d2730fd4ef167d9ba562bebb508328248b01a12)
`$lang
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace xbytechat.api.Features.PlanManagement.Models
{
    [Table("PlanFeatureMatrix")]
    public class PlanFeatureMatrix
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        [MaxLength(20)]
        public string PlanName { get; set; } = string.Empty;  // "Basic", "Smart", "Advance"

        [Required]
        [MaxLength(50)]
        public string FeatureName { get; set; } = string.Empty; // "Contacts", "Catalog", etc.

        [Required]
        public bool IsEnabled { get; set; }  // Default state for this plan-feature pair
    }
}

``n
--- file: xbytechat-api/Features/PlanManagement/Models/PlanType.cs  (sha256:52170542c11ff0a0e52b9f16289446106038cd266cd602169980aa1d684672ea)
`$lang
namespace xbytechat.api.Features.PlanManagement.Models
{
    public enum PlanType
    {
       
        Basic = 0,
        Smart = 1,
        Advanced = 2,
            Trial = 3,
    }
}

``n
--- file: xbytechat-api/Features/PlanManagement/Services/IPlanManager.cs  (sha256:69cb77d9f587d971ee0cc96bf3fa399d9982294045981db84e714050dc242d85)
`$lang
using xbytechat.api.Helpers;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.PlanManagement.Services
{
    public interface IPlanManager
    {
        /// <summary>
        /// Checks if business has enough quota to send a message.
        /// </summary>
        Task<ResponseResult> CheckQuotaBeforeSendingAsync(Guid businessId);
        Dictionary<string, bool> GetPlanFeatureMap(string plan);
    }
}

``n
--- file: xbytechat-api/Features/PlanManagement/Services/PlanManager.cs  (sha256:0d93116ee8bd77194569c6739adad49911359cad9bd6f1919bae85f130027871)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.PlanManagement.Models;
using xbytechat.api.Helpers;
using xbytechat.api.Models.BusinessModel;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.PlanManagement.Services
{
    public class PlanManager : IPlanManager
    {
        private readonly AppDbContext _db;

        public PlanManager(AppDbContext db)
        {
            _db = db;
        }

        public async Task<ResponseResult> CheckQuotaBeforeSendingAsync(Guid businessId)
        {
            var business = await _db.Businesses.FirstOrDefaultAsync(b => b.Id == businessId);

            if (business == null)
                return ResponseResult.ErrorInfo("Business not found.", "Invalid business ID");
            if (business?.BusinessPlanInfo?.RemainingMessages <= 0)
            {
                var msg = business?.BusinessPlanInfo?.Plan == PlanType.Trial
                    ? "Trial limit reached. Please upgrade your plan."
                    : "Monthly quota exhausted. Please upgrade or wait for reset.";

                return ResponseResult.ErrorInfo(msg, "Quota limit exceeded");
            }

            return ResponseResult.SuccessInfo("Quota check passed.");
        }

        public Dictionary<string, bool> GetPlanFeatureMap(string plan)
        {
            // Example map — replace with real logic if needed
            if (plan == "Basic")
                return new Dictionary<string, bool>
            {
                { "CATALOG", true },
                { "MESSAGE_SEND", false },
                { "CRM_NOTES", false }
            };

            if (plan == "Advanced")
                return new Dictionary<string, bool>
            {
                { "CATALOG", true },
                { "MESSAGE_SEND", true },
                { "CRM_NOTES", true },
                { "CRM_TAGS", true }
            };

            // Fallback plan
            return new Dictionary<string, bool>();
        }

    }
}

``n
--- file: xbytechat-api/Features/ReportingModule/Controllers/MessageAnalyticsController.cs  (sha256:37e850b94dae6b33e4c44fb129fe331ae8a36706c9e377dee456c03d4a6e57f7)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.ReportingModule.Services;
using xbytechat.api.Shared;


namespace xbytechat.api.Features.ReportingModule.Controllers
{
    [ApiController]
    [Route("api/reporting/messages")]
    public class MessageAnalyticsController : ControllerBase
    {
        private readonly IMessageAnalyticsService _service;

        public MessageAnalyticsController(IMessageAnalyticsService service)
        {
            _service = service;
        }

        [HttpGet("recent")]
        public async Task<IActionResult> GetRecentLogs([FromQuery] int limit = 20)
        {
            var businessId = User.GetBusinessId(); // 🔒 assumes claims extension
            var logs = await _service.GetRecentLogsAsync(businessId, limit);
            return Ok(new { success = true, data = logs });
        }
        [HttpGet("history")]
        public async Task<IActionResult> GetPaginatedLogs([FromQuery] PaginatedRequest request)
        {
            var businessId = User.GetBusinessId(); // 🔐 via claims
            var result = await _service.GetPaginatedLogsAsync(businessId, request);
            return Ok(new { success = true, data = result });
        }

    }
}
``n
--- file: xbytechat-api/Features/ReportingModule/DTOs/DirectMessageLogFilterDto.cs  (sha256:e8f948d0367820dd6dce43d8c057e8bfe7a65889ab2eb6361f062de66d36922b)
`$lang
namespace xbytechat.api.Features.ReportingModule.DTOs
{
    public class DirectMessageLogFilterDto

    {
        public int Page { get; set; } = 1;
        public int PageSize { get; set; } = 10;
        public string? Status { get; set; }
        public string? Search { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/ReportingModule/DTOs/RecentMessageLogDto.cs  (sha256:f86a239c42fefe2d63c5087c403a7c2cc1e2eea942cc1443bd03495783bbb2f4)
`$lang
// 📄 File: Features/ReportingModule/DTOs/RecentMessageLogDto.cs
using System;

namespace xbytechat.api.Features.ReportingModule.DTOs
{
    public class RecentMessageLogDto
    {
        public Guid Id { get; set; }
        public string RecipientNumber { get; set; }
        public string MessageContent { get; set; }
        public DateTime CreatedAt { get; set; }
        public DateTime? SentAt { get; set; }             
        public Guid? CampaignId { get; set; }
        public string? Status { get; set; }
        public string? ErrorMessage { get; set; }         
    }
}


``n
--- file: xbytechat-api/Features/ReportingModule/Services/IMessageAnalyticsService.cs  (sha256:08c8fb19a092bb252492d04c2114547e4ca4a5725875accb403182551c8229f4)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.ReportingModule.DTOs;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.ReportingModule.Services
{
    public interface IMessageAnalyticsService
    {
        Task<List<RecentMessageLogDto>> GetRecentLogsAsync(Guid businessId, int limit);
        Task<PaginatedResponse<RecentMessageLogDto>> GetPaginatedLogsAsync(Guid businessId, PaginatedRequest request);
    }
}


``n
--- file: xbytechat-api/Features/ReportingModule/Services/MessageAnalyticsService.cs  (sha256:3a87316fa63b4890a5bc35b2d867a96a2a7d73e8aea0e52ff6854e89c4245b7a)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.ReportingModule.DTOs;
using xbytechat.api.Shared;

namespace xbytechat.api.Features.ReportingModule.Services
{
    public class MessageAnalyticsService : IMessageAnalyticsService
    {
        private readonly AppDbContext _context;

        public MessageAnalyticsService(AppDbContext context)
        {
            _context = context;
        }

        public async Task<List<RecentMessageLogDto>> GetRecentLogsAsync(Guid businessId, int limit)
        {
            return await _context.MessageLogs
                .Where(x => x.BusinessId == businessId)
                .OrderByDescending(x => x.CreatedAt)
                .Take(limit)
                .Select(x => new RecentMessageLogDto
                {
                    Id = x.Id,
                    RecipientNumber = x.RecipientNumber,
                    MessageContent = x.MessageContent,
                    CreatedAt = x.CreatedAt,
                    CampaignId = x.CampaignId,
                    Status = x.Status,
                    SentAt = x.SentAt,
                })
                .ToListAsync();
        }

        public async Task<PaginatedResponse<RecentMessageLogDto>> GetPaginatedLogsAsync(Guid businessId, PaginatedRequest request)
        {
            var query = _context.MessageLogs
                .Where(x => x.BusinessId == businessId);

            if (!string.IsNullOrEmpty(request.Status))
                query = query.Where(x => x.Status == request.Status);

            if (!string.IsNullOrEmpty(request.Search))
                query = query.Where(x =>
                    x.RecipientNumber.Contains(request.Search) ||
                    x.MessageContent.Contains(request.Search));

            var totalCount = await query.CountAsync();

            var items = await query
                .OrderByDescending(x => x.CreatedAt)
                .Skip((request.Page - 1) * request.PageSize)
                .Take(request.PageSize)
                .Select(x => new RecentMessageLogDto
                {
                    Id = x.Id,
                    RecipientNumber = x.RecipientNumber,
                    MessageContent = x.MessageContent,
                    CreatedAt = x.CreatedAt,
                    CampaignId = x.CampaignId,
                    Status = x.Status,
                    SentAt = x.SentAt,
                })
                .ToListAsync();

            return new PaginatedResponse<RecentMessageLogDto>
            {
                Items = items,
                TotalCount = totalCount,
                Page = request.Page,
                PageSize = request.PageSize
            };
        }

    }
}


``n
--- file: xbytechat-api/Features/TemplatesModule/Controllers/TemplatesController.cs  (sha256:b7014e9c08b5d3cf85e8dbd5edf632bc51e34a2acac661dbb3109dcd259edf4c)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.TemplateModule.Services;

namespace xbytechat.api.Features.TemplateModule.Controllers
{
    [ApiController]
    [Route("api/templates")]
    public class TemplatesController : ControllerBase
    {
        private readonly IWhatsAppTemplateService _templateService;
        private readonly ILogger<TemplatesController> _logger;

        public TemplatesController(IWhatsAppTemplateService templateService, ILogger<TemplatesController> logger)
        {
            _templateService = templateService;
            _logger = logger;
        }

        /// <summary>
        /// Fetches WhatsApp template metadata (name, language, body, placeholders)
        /// </summary>
        [HttpGet("metadata")]
        public async Task<IActionResult> GetTemplates()
        {
            try
            {
                var templates = await _templateService.FetchTemplatesAsync();
                return Ok(new
                {
                    success = true,
                    templates
                });
            }
            catch (Exception ex)
            {
                _logger.LogError("Error fetching template metadata: " + ex.Message);
                return StatusCode(500, new
                {
                    success = false,
                    message = "❌ Failed to retrieve template metadata",
                    error = ex.Message
                });
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/TemplatesModule/Services/IWhatsAppTemplateService.cs  (sha256:2ed5f5891246b4fec02e29892760c3d033e76572488701c525fd801763f742a9)
`$lang
using xbytechat.api.WhatsAppSettings.DTOs;

namespace xbytechat.api.Features.TemplateModule.Services
{
    public interface IWhatsAppTemplateService
    {
        Task<List<TemplateMetadataDto>> FetchTemplatesAsync();
    }
}

``n
--- file: xbytechat-api/Features/TemplatesModule/Services/WhatsAppTemplateService.cs  (sha256:ee70376834e701f63425a69d50a4ea5d02170321edf828fe7fd2bd5d100bf3a1)
`$lang
using Microsoft.Extensions.Configuration;
using Newtonsoft.Json;
using xbytechat.api.WhatsAppSettings.DTOs;

namespace xbytechat.api.Features.TemplateModule.Services
{
    public class WhatsAppTemplateService : IWhatsAppTemplateService
    {
        private readonly HttpClient _httpClient;
        private readonly IConfiguration _config;
        private readonly ILogger<WhatsAppTemplateService> _logger;

        public WhatsAppTemplateService(HttpClient httpClient, IConfiguration config, ILogger<WhatsAppTemplateService> logger)
        {
            _httpClient = httpClient;
            _config = config;
            _logger = logger;
        }

        public async Task<List<TemplateMetadataDto>> FetchTemplatesAsync()
        {
            var wabaId = _config["WhatsApp:WABA_ID"];
            var token = _config["WhatsApp:apiToken"];
            var url = $"https://graph.facebook.com/v18.0/{wabaId}/message_templates";

            var templates = new List<TemplateMetadataDto>();

            try
            {
                _httpClient.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
                var response = await _httpClient.GetAsync(url);
                var json = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                {
                    _logger.LogError("Failed to fetch WhatsApp templates: " + json);
                    return templates;
                }

                var parsed = JsonConvert.DeserializeObject<dynamic>(json);

                foreach (var tpl in parsed.data)
                {
                    string name = tpl.name;
                    string language = tpl.language ?? "en_US";
                    string body = "";

                    foreach (var component in tpl.components)
                    {
                        if (component.type == "BODY")
                        {
                            body = component.text;
                            break;
                        }
                    }

                    // Count {{placeholders}}
                    var placeholderCount = System.Text.RegularExpressions.Regex.Matches(body, "{{(.*?)}}").Count;

                    templates.Add(new TemplateMetadataDto
                    {
                        Name = name,
                        Language = language,
                        Body = body,
                        PlaceholderCount = placeholderCount
                    });
                }

                return templates;
            }
            catch (Exception ex)
            {
                _logger.LogError("Error while fetching templates from Meta: " + ex.Message);
                return templates;
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/Tracking/Controllers/TrackingController.cs  (sha256:eff454d0f22519fc547f7489d9205cb738600a0d241003c5f0ac3f38694b517a)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Serilog;
using System;
using System.Linq;
using System.Threading.Tasks;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Features.Tracking.Services;
using xbytechat.api.Shared.TrackingUtils;

namespace xbytechat.api.Features.Tracking.Controllers
{
    [ApiController]
    [Route("api/tracking")]
    public class TrackingController : ControllerBase
    {
        private readonly ITrackingService _tracker;

        public TrackingController(ITrackingService tracker)
        {
            _tracker = tracker;
        }
        #region "Tracking Logs"
        //       [HttpGet("redirect")]
        //       public async Task<IActionResult> TrackAndRedirect(
        //                                        [FromQuery] string src,
        //                                        [FromQuery] Guid id,
        //                                        [FromQuery] string btn,
        //                                        [FromQuery] string? to = null,
        //                                        [FromQuery] string? type = null,
        //                                        [FromQuery] Guid? msg = null,
        //                                        [FromQuery] Guid? contact = null,
        //                                        [FromQuery] string? phone = null,
        //                                        [FromQuery] string? session = null,
        //                                        [FromQuery] string? thread = null
        //)
        //       {
        //           var userAgent = Request.Headers["User-Agent"].FirstOrDefault() ?? "unknown";
        //           var ipAddress = Request.Headers["X-Forwarded-For"].FirstOrDefault()
        //                        ?? HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";

        //           var country = await GeoHelper.GetCountryFromIP(ipAddress);
        //           var deviceType = DeviceHelper.GetDeviceType(userAgent);

        //           var businessIdClaim = User.FindFirst("businessId")?.Value;
        //           if (!Guid.TryParse(businessIdClaim, out var businessId))
        //               return Unauthorized("Invalid business context");

        //           var dto = new TrackingLogDto
        //           {
        //               BusinessId = businessId,// Guid.Empty, // TODO: Replace with actual business lookup if available
        //               ContactId = contact,
        //               ContactPhone = phone,
        //               SourceType = src,
        //               SourceId = id,
        //               ButtonText = btn,
        //               CTAType = type ?? btn,
        //               MessageId = msg?.ToString(),
        //               SessionId = session,
        //               ThreadId = thread,
        //               ClickedAt = DateTime.UtcNow,
        //               IPAddress = ipAddress,
        //               Browser = userAgent,
        //               DeviceType = deviceType,
        //               Country = country,
        //               ClickedVia = "web"
        //           };

        //           await _tracker.LogCTAClickAsync(dto);

        //           if (string.IsNullOrWhiteSpace(to))
        //               return BadRequest("Missing redirect target.");

        //           var decodedUrl = Uri.UnescapeDataString(to);
        //           return Redirect(decodedUrl);
        //       }

        #endregion

        //        [HttpGet("redirect")]
        //        public async Task<IActionResult> TrackAndRedirect(
        //            [FromQuery] string src,
        //            [FromQuery] Guid id,
        //            [FromQuery] string btn,
        //            [FromQuery] string? to = null,
        //            [FromQuery] string? type = null,
        //            [FromQuery] Guid? msg = null,
        //            [FromQuery] Guid? contact = null,
        //            [FromQuery] string? phone = null,
        //            [FromQuery] string? session = null,
        //            [FromQuery] string? thread = null
        //)
        //        {
        //            var userAgent = Request.Headers["User-Agent"].FirstOrDefault() ?? "unknown";
        //            var ipAddress = Request.Headers["X-Forwarded-For"].FirstOrDefault()
        //                         ?? HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";

        //            var country = await GeoHelper.GetCountryFromIP(ipAddress);
        //            var deviceType = DeviceHelper.GetDeviceType(userAgent);

        //            // 🔍 1. Attempt to extract businessId from claims
        //            var businessIdClaim = User.FindFirst("businessId")?.Value;
        //            var hasBusinessId = Guid.TryParse(businessIdClaim, out var businessId);

        //            // 🧠 2. Create base DTO
        //            var dto = new TrackingLogDto
        //            {
        //                BusinessId = hasBusinessId ? businessId : Guid.Empty, // fallback — will enrich later
        //                ContactId = contact,
        //                ContactPhone = phone,
        //                SourceType = src,
        //                SourceId = id,
        //                ButtonText = btn,
        //                CTAType = type ?? btn,
        //                MessageId = msg?.ToString(),
        //                SessionId = session,
        //                ThreadId = thread,
        //                ClickedAt = DateTime.UtcNow,
        //                IPAddress = ipAddress,
        //                Browser = userAgent,
        //                DeviceType = deviceType,
        //                Country = country,
        //                ClickedVia = "web"
        //            };

        //            // 🔁 3. Fallback enrichment from MessageLog
        //            if (msg.HasValue)
        //            {
        //                var messageLog = await _context.MessageLogs
        //                    .AsNoTracking()
        //                    .FirstOrDefaultAsync(m => m.Id == msg.Value || m.MessageId == msg.ToString());

        //                if (messageLog != null)
        //                {
        //                    // 🧩 Backfill missing fields if needed
        //                    dto.BusinessId = dto.BusinessId == Guid.Empty ? messageLog.BusinessId : dto.BusinessId;
        //                    dto.ContactId ??= messageLog.ContactId;
        //                    dto.CampaignId ??= messageLog.CampaignId;
        //                    dto.MessageLogId ??= messageLog.Id;
        //                }
        //            }

        //            // 🔁 4. Fallback from CampaignSendLog (if SourceType is "campaign")
        //            if (src == "campaign" && msg.HasValue && dto.CampaignId == null)
        //            {
        //                var sendLog = await _context.CampaignSendLogs
        //                    .AsNoTracking()
        //                    .FirstOrDefaultAsync(c => c.MessageId == msg.ToString());

        //                if (sendLog != null)
        //                {
        //                    dto.BusinessId = dto.BusinessId == Guid.Empty ? sendLog.BusinessId : dto.BusinessId;
        //                    dto.ContactId ??= sendLog.ContactId;
        //                    dto.CampaignId ??= sendLog.CampaignId;
        //                    dto.CampaignSendLogId ??= sendLog.Id;
        //                }
        //            }

        //            // ✅ 5. Final safety check
        //            if (dto.BusinessId == Guid.Empty)
        //            {
        //                Log.Warning("⚠️ TrackingLog DTO missing valid BusinessId. msg={@msg}", msg);
        //                return Unauthorized("Business context missing or invalid.");
        //            }

        //            // 💾 6. Save to database
        //            await _tracker.LogCTAClickAsync(dto);

        //            // 🌐 7. Redirect to final URL
        //            if (string.IsNullOrWhiteSpace(to))
        //                return BadRequest("Missing redirect target.");

        //            var decodedUrl = Uri.UnescapeDataString(to);
        //            return Redirect(decodedUrl);
        //        }
        [HttpGet("redirect")]
        public async Task<IActionResult> TrackAndRedirect([FromQuery] string src, [FromQuery] Guid id,
            [FromQuery] string btn, [FromQuery] string? to = null, [FromQuery] string? type = null,
            [FromQuery] Guid? msg = null, [FromQuery] Guid? contact = null, [FromQuery] string? phone = null,
            [FromQuery] string? session = null, [FromQuery] string? thread = null)
        {
            var userAgent = Request.Headers["User-Agent"].FirstOrDefault() ?? "unknown";
            var ipAddress = Request.Headers["X-Forwarded-For"].FirstOrDefault()
                         ?? HttpContext.Connection.RemoteIpAddress?.ToString() ?? "unknown";

            var country = await GeoHelper.GetCountryFromIP(ipAddress);
            var deviceType = DeviceHelper.GetDeviceType(userAgent);

            var businessIdClaim = User.FindFirst("businessId")?.Value;
            var hasBusinessId = Guid.TryParse(businessIdClaim, out var businessId);

            var dto = new TrackingLogDto
            {
                BusinessId = hasBusinessId ? businessId : Guid.Empty,
                ContactId = contact,
                ContactPhone = phone,
                SourceType = src,
                SourceId = id,
                ButtonText = btn,
                CTAType = type ?? btn,
                MessageId = msg?.ToString(),
                SessionId = session,
                ThreadId = thread,
                ClickedAt = DateTime.UtcNow,
                IPAddress = ipAddress,
                Browser = userAgent,
                DeviceType = deviceType,
                Country = country,
                ClickedVia = "web"
            };

            var result = await _tracker.LogCTAClickWithEnrichmentAsync(dto);
            if (!result.Success)
                return Unauthorized(result.Message);

            if (string.IsNullOrWhiteSpace(to))
                return BadRequest("Missing redirect target.");

            return Redirect(Uri.UnescapeDataString(to));
        }

        [HttpGet("logs/{id}/details")]
        public async Task<IActionResult> GetLogDetails(Guid id)
        {
            var result = await _tracker.GetLogDetailsAsync(id);
            if (result == null)
                return NotFound("Tracking log not found");

            return Ok(result);
        }
        [HttpGet("flow-clicks")]
       
        public async Task<IActionResult> GetFlowClickLogs()
        {
            var businessIdClaim = User.FindFirst("businessId")?.Value;
            if (!Guid.TryParse(businessIdClaim, out var businessId))
                return BadRequest("❌ Invalid or missing business ID");

            var logs = await _tracker.GetFlowClickLogsAsync(businessId);

            var dtoList = logs.Select(x => new
            {
                x.Id,
                x.StepId,
                x.ContactPhone,
                x.ButtonText,
                x.TemplateId,
                x.FollowUpSent,
                x.ClickedAt
            });

            return Ok(dtoList);
        }
    }
}
``n
--- file: xbytechat-api/Features/Tracking/Controllers/TrackingViewerController.cs  (sha256:6dfeff85fe69af455c90c7ae2ad1fd0614866359c0eaee39cf101ca67b819507)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api;

namespace xbytechat.api.Features.Tracking.Controllers
{
    [ApiController]
    [Route("api/tracking/logs")]
    public class TrackingViewerController : ControllerBase
    {
        private readonly AppDbContext _context;

        public TrackingViewerController(AppDbContext context)
        {
            _context = context;
        }

        [HttpGet]
        public async Task<IActionResult> GetAll([FromQuery] Guid? campaignId = null)
        {
            var query = _context.TrackingLogs
                .Include(t => t.Campaign) // Optional
                .Include(t => t.Contact)  // Optional
                .OrderByDescending(t => t.ClickedAt)
                .AsQueryable();

            if (campaignId.HasValue)
                query = query.Where(t => t.CampaignId == campaignId);

            var results = await query
                .Select(t => new
                {
                    t.Id,
                    t.ContactPhone,
                    ContactName = t.Contact != null ? t.Contact.Name : "(N/A)",
                    t.ButtonText,
                    t.CTAType,
                    t.SourceType,
                    t.ClickedAt,
                    t.DeviceType,
                    t.Country,
                    CampaignName = t.Campaign != null ? t.Campaign.Name : "(Unknown)"
                })
                .ToListAsync();

            return Ok(new { success = true, data = results });
        }
    }
}


``n
--- file: xbytechat-api/Features/Tracking/DTOs/TrackingLogDetailsDto.cs  (sha256:e27d7a86aea38ec1fef0aaf6d4d6c208e2481cfaf7033c57fa8da1c81d2c693c)
`$lang
using xbytechat.api.CRM.Dtos;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.MessageManagement.DTOs;

namespace xbytechat.api.Features.Tracking.DTOs
{
    public class TrackingLogDetailsDto
    {
        public TrackingLogDto Tracking { get; set; } = new();
        public ContactDto? Contact { get; set; }
        public CampaignDto? Campaign { get; set; }
        public MessageLogDto? MessageLog { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Tracking/DTOs/TrackingLogDto.cs  (sha256:bae94801851bba1bbeb94d60e81f2d20efd13b86be1391265098462d82a3c762)
`$lang
using System;

namespace xbytechat.api.Features.Tracking.DTOs
{
    public class TrackingLogDto
    {
        // 🧩 Multi-Tenant Isolation
        public Guid BusinessId { get; set; }

        // 👤 CRM Linkage
        public Guid? ContactId { get; set; }
        public string? ContactPhone { get; set; }

        // 🔗 Source Info
        public string SourceType { get; set; } = string.Empty; // e.g. "campaign", "reminder", "bot"
        public Guid? SourceId { get; set; }

        // 🔘 CTA Info
        public string? ButtonText { get; set; }
        public string? CTAType { get; set; }

        // 📨 Message Context
        public string? MessageId { get; set; }
        public string? TemplateId { get; set; }
        public Guid? MessageLogId { get; set; }

        // 🧠 Meta / Behaviour
        public string? ClickedVia { get; set; }
        public string? Referrer { get; set; }
        public DateTime? ClickedAt { get; set; } = DateTime.UtcNow;
        // 📡 Tracking
        public string? IPAddress { get; set; }
        public string? Browser { get; set; }
        public string? DeviceType { get; set; }
        public string? Country { get; set; }
        public string? City { get; set; }

        // 🔖 Session context
        public string? SessionId { get; set; }
        public string? ThreadId { get; set; }

        public Guid? CampaignId { get; set; }
        public Guid? CampaignSendLogId { get; set; }

        public string RawJson { get; set; } = string.Empty; // used in queue method
        public DateTime EnqueuedAt { get; set; } // used in queue method
        public string? NextStepMatched { get; set; } // ✅ Add this if not already there

        public string? TemplateName { get; set; } // ✅ Needed for follow-up matcher


    }
}

``n
--- file: xbytechat-api/Features/Tracking/Models/TrackingLog.cs  (sha256:ce8da394901366ef9d5d9b32a338d7a49d6b8d06eb1f911e89e02296506b4281)
`$lang
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.Tracking.Models;
namespace xbytechat.api.Features.Tracking.Models
{
    public class TrackingLog
    {
        public Guid Id { get; set; } = Guid.NewGuid();

        // 🧩 Multi-Tenant Isolation
        public Guid BusinessId { get; set; }

        // 👤 CRM Linkage
        public Guid? ContactId { get; set; }
        public string? ContactPhone { get; set; }
        public Contact? Contact { get; set; } // ✅ NEW

        // 🔗 Source Info
        public string SourceType { get; set; } = string.Empty;
        public Guid? SourceId { get; set; }

        public Guid? CampaignId { get; set; }
        public Campaign? Campaign { get; set; } // ✅ NEW

        public Guid? CampaignSendLogId { get; set; }
        public CampaignSendLog? CampaignSendLog { get; set; } // ✅ Optional

        // 🔘 Button Info
        public string? ButtonText { get; set; }
        public string? CTAType { get; set; }

        // 📨 Message Context
        public string? MessageId { get; set; }
        public string? TemplateId { get; set; }
        public Guid? MessageLogId { get; set; }
        public MessageLog? MessageLog { get; set; } // ✅ Optional

        // 🧠 Meta / Behaviour
        public string? ClickedVia { get; set; }
        public string? Referrer { get; set; }

        // 🕒 Audit Trail
        public DateTime ClickedAt { get; set; } = DateTime.UtcNow;
        public string? IPAddress { get; set; }
        public string? DeviceType { get; set; }
        public string? Browser { get; set; }
        public string? Country { get; set; }
        public string? City { get; set; }

        // 🔖 Follow-up & Analytics
        public bool FollowUpSent { get; set; } = false;
        public string? LastInteractionType { get; set; }

        // 🧵 Journey Tracking
        public Guid? SessionId { get; set; }
        public Guid? ThreadId { get; set; }
        public Guid? StepId { get; set; } // ✅ Link to CTAFlowStep for CTA Flow tracking

       //  public string? NextStepMatched { get; set; } // Logs which template system resolved
    }
}

``n
--- file: xbytechat-api/Features/Tracking/Services/ITrackingService.cs  (sha256:7331e4a2b1fb44932573c4ed055613cc4ae21dcd9ec54bc25210c57cd340737c)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.Tracking.Services
{
    public interface ITrackingService
    {
        Task LogCTAClickAsync(TrackingLogDto dto);
        Task<TrackingLogDetailsDto?> GetLogDetailsAsync(Guid logId);
        Task<ResponseResult> LogCTAClickWithEnrichmentAsync(TrackingLogDto dto);
        Task<List<TrackingLog>> GetFlowClickLogsAsync(Guid businessId);
    }
}

``n
--- file: xbytechat-api/Features/Tracking/Services/TrackingService.cs  (sha256:90d3f4b3c6a0d5d10d83300d0c3ed58fc81149c2dec145768cfafe2886dccb0b)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Shared.TrackingUtils;
using Serilog;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.Features.CampaignModule.DTOs;
using AutoMapper;
using xbytechat.api.Features.MessageManagement.DTOs;
using xbytechat.api.Helpers;
using xbytechat.api.Features.CampaignTracking.Models;

namespace xbytechat.api.Features.Tracking.Services
{
    public class TrackingService : ITrackingService
    {
        private readonly AppDbContext _context;
        private readonly IMapper _mapper;
        public TrackingService(AppDbContext context, IMapper mapper)
        {
            _context = context;
            _mapper = mapper;
        }


        public async Task<ResponseResult> LogCTAClickWithEnrichmentAsync(TrackingLogDto dto)
        {
            try
            {
                // 🧠 1. Try enrich from MessageLog (if msg ID provided)
                if (!string.IsNullOrEmpty(dto.MessageId))
                {
                    var messageLog = await _context.MessageLogs
                        .FirstOrDefaultAsync(m => m.MessageId == dto.MessageId || m.Id.ToString() == dto.MessageId);

                    if (messageLog != null)
                    {
                        dto.BusinessId = dto.BusinessId == Guid.Empty ? messageLog.BusinessId : dto.BusinessId;
                        dto.ContactId ??= messageLog.ContactId;
                        dto.CampaignId ??= messageLog.CampaignId;
                        dto.MessageLogId ??= messageLog.Id;
                    }
                }

                // 🧩 2. Enrich from CampaignSendLog if sourceType = campaign
                CampaignSendLog? sendLog = null;

                if (dto.SourceType == "campaign")
                {
                    if (!string.IsNullOrEmpty(dto.MessageId))
                    {
                        sendLog = await _context.CampaignSendLogs
                            .Include(c => c.Recipient)
                            .FirstOrDefaultAsync(c => c.MessageId == dto.MessageId);
                    }

                    if (sendLog == null && dto.CampaignId != null)
                    {
                        sendLog = await _context.CampaignSendLogs
                            .Include(c => c.Recipient)
                            .Where(c => c.CampaignId == dto.CampaignId)
                            .OrderByDescending(c => c.CreatedAt)
                            .FirstOrDefaultAsync();
                    }

                    if (sendLog != null)
                    {
                        dto.BusinessId = dto.BusinessId == Guid.Empty
                            ? sendLog.Recipient?.BusinessId ?? Guid.Empty
                            : dto.BusinessId;

                        dto.ContactId ??= sendLog.ContactId;
                        dto.CampaignId ??= sendLog.CampaignId;
                        dto.CampaignSendLogId ??= sendLog.Id;

                        // ✅ Update campaign send log click details
                        sendLog.IsClicked = true;
                        sendLog.ClickedAt = dto.ClickedAt ?? DateTime.UtcNow;
                        sendLog.ClickType = dto.ButtonText;

                        await _context.SaveChangesAsync();
                    }
                }

                // ✅ 3. Validate business context
                if (dto.BusinessId == Guid.Empty)
                {
                    Log.Warning("❌ TrackingLog failed: No BusinessId available for click.");
                    return ResponseResult.ErrorInfo("Business context is missing.");
                }

                // 💾 4. Save tracking log (inline instead of separate method)
                var trackingLog = new TrackingLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    ContactId = dto.ContactId,
                    ContactPhone = dto.ContactPhone,
                    SourceType = dto.SourceType,
                    SourceId = dto.SourceId,
                    ButtonText = dto.ButtonText,
                    CTAType = dto.CTAType,
                    MessageId = dto.MessageId,
                    TemplateId = dto.TemplateId,
                    MessageLogId = dto.MessageLogId,
                    ClickedVia = dto.ClickedVia ?? "web",
                    Referrer = dto.Referrer,
                    ClickedAt = dto.ClickedAt ?? DateTime.UtcNow,
                    IPAddress = dto.IPAddress,
                    DeviceType = dto.DeviceType,
                    Browser = dto.Browser,
                    Country = dto.Country,
                    City = dto.City,
                    FollowUpSent = false,
                    LastInteractionType = "Clicked",
                    SessionId = Guid.TryParse(dto.SessionId, out var sid) ? sid : (Guid?)null,
                    ThreadId = Guid.TryParse(dto.ThreadId, out var tid) ? tid : (Guid?)null,
                    CampaignId = dto.CampaignId,
                    CampaignSendLogId = dto.CampaignSendLogId
                };

                await _context.TrackingLogs.AddAsync(trackingLog);
                await _context.SaveChangesAsync();

                // ✅ Return the TrackingLog.Id in the response
                return ResponseResult.SuccessInfo("CTA click tracked successfully.", trackingLog.Id);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Exception during CTA tracking enrichment");
                return ResponseResult.ErrorInfo("Exception during tracking: " + ex.Message);
            }
        }

        public async Task LogCTAClickAsync(TrackingLogDto dto)
        {
            try
            {
                var log = new TrackingLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    ContactId = dto.ContactId,
                    ContactPhone = dto.ContactPhone,
                    SourceType = dto.SourceType,
                    SourceId = dto.SourceId,
                    ButtonText = dto.ButtonText,
                    CTAType = dto.CTAType,
                    MessageId = dto.MessageId,
                    TemplateId = dto.TemplateId,
                    MessageLogId = dto.MessageLogId,
                    ClickedVia = dto.ClickedVia ?? "web",
                    Referrer = dto.Referrer,
                    ClickedAt = dto.ClickedAt ?? DateTime.UtcNow,
                    IPAddress = dto.IPAddress,
                    DeviceType = dto.DeviceType,
                    Browser = dto.Browser,
                    Country = dto.Country,
                    City = dto.City,
                    FollowUpSent = false,
                    LastInteractionType = "Clicked",
                    SessionId = Guid.TryParse(dto.SessionId, out var sid) ? sid : (Guid?)null,
                    ThreadId = Guid.TryParse(dto.ThreadId, out var tid) ? tid : (Guid?)null,
                    CampaignId = dto.CampaignId,
                    CampaignSendLogId = dto.CampaignSendLogId
                };

                await _context.TrackingLogs.AddAsync(log);
                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to log CTA click");
            }
        }
        public async Task<TrackingLogDetailsDto?> GetLogDetailsAsync(Guid logId)
        {
            var tracking = await _context.TrackingLogs
                .AsNoTracking()
                .FirstOrDefaultAsync(x => x.Id == logId);

            if (tracking == null)
                return null;

            var contact = tracking.ContactId != null
                ? await _context.Contacts.AsNoTracking().FirstOrDefaultAsync(c => c.Id == tracking.ContactId)
                : null;

            var campaign = tracking.CampaignId != null
                ? await _context.Campaigns.AsNoTracking().FirstOrDefaultAsync(c => c.Id == tracking.CampaignId)
                : null;

            var messageLog = tracking.MessageLogId != null
                ? await _context.MessageLogs.AsNoTracking().FirstOrDefaultAsync(m => m.Id == tracking.MessageLogId)
                : null;

            return new TrackingLogDetailsDto
            {
                Tracking = _mapper.Map<TrackingLogDto>(tracking),
                Contact = contact != null ? _mapper.Map<ContactDto>(contact) : null,
                Campaign = campaign != null ? _mapper.Map<CampaignDto>(campaign) : null,
                MessageLog = messageLog != null ? _mapper.Map<MessageLogDto>(messageLog) : null
            };
        }
        public async Task<List<TrackingLog>> GetFlowClickLogsAsync(Guid businessId)
        {
            return await _context.TrackingLogs
                .Where(x => x.BusinessId == businessId && x.SourceType == "cta-flow")
                .OrderByDescending(x => x.ClickedAt)
                .ToListAsync();
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/BackgroundWorkers/WebhookAutoCleanupWorker.cs  (sha256:5149c73a4fbcb11d9e501321407b1c7ae7ee660b8f7d612eca136b528f0467f2)
`$lang
using xbytechat.api.Features.Webhooks.Services;

namespace xbytechat.api.Features.Webhooks.BackgroundWorkers
{
    public class WebhookAutoCleanupWorker : BackgroundService
    {
        private readonly ILogger<WebhookAutoCleanupWorker> _logger;
        private readonly IServiceProvider _services;

        public WebhookAutoCleanupWorker(IServiceProvider services, ILogger<WebhookAutoCleanupWorker> logger)
        {
            _services = services;
            _logger = logger;
        }

        protected override async Task ExecuteAsync(CancellationToken stoppingToken)
        {
            while (!stoppingToken.IsCancellationRequested)
            {
                using var scope = _services.CreateScope();
                var maintenanceService = scope.ServiceProvider.GetRequiredService<IMaintenanceService>();

                if (await maintenanceService.IsAutoCleanupEnabledAsync())
                {
                    var count = await maintenanceService.RunCleanupAsync();
                    _logger.LogInformation($"🧹 Auto-cleaned {count} old webhook logs.");
                }

                await Task.Delay(TimeSpan.FromHours(12), stoppingToken);
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/BackgroundWorkers/WebhookQueueWorker.cs  (sha256:4a0dbbf63a7e5e5dbdea08790538d449d81f91e4234da7a4b8acedf0ff744b25)
`$lang
using System.Text.Json;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
using xbytechat.api.Features.Webhooks.Services;
using xbytechat.api.Features.Webhooks.DTOs;

public class WebhookQueueWorker : BackgroundService
{
    private readonly IWebhookQueueService _queueService;
    private readonly IServiceScopeFactory _scopeFactory;
    private readonly ILogger<WebhookQueueWorker> _logger;

    public WebhookQueueWorker(
        IWebhookQueueService queueService,
        IServiceScopeFactory scopeFactory,
        ILogger<WebhookQueueWorker> logger)
    {
        _queueService = queueService;
        _scopeFactory = scopeFactory;
        _logger = logger;
    }

    protected override async Task ExecuteAsync(CancellationToken stoppingToken)
    {
        _logger.LogInformation("🚀 Webhook Queue Worker started.");

        while (!stoppingToken.IsCancellationRequested)
        {
            try
            {
                var payload = await _queueService.DequeueAsync(stoppingToken);
                var clonedPayload = payload.Clone(); // ✅ Avoid disposal issue

                using var scope = _scopeFactory.CreateScope();

                // 🔄 Resolve scoped dependencies
                var dispatcher = scope.ServiceProvider.GetRequiredService<IWhatsAppWebhookDispatcher>();
                var failureLogger = scope.ServiceProvider.GetRequiredService<IFailedWebhookLogService>();

                // 🚀 Dispatch
                await dispatcher.DispatchAsync(clonedPayload);
            }
            catch (OperationCanceledException)
            {
                _logger.LogInformation("🛑 Graceful shutdown requested.");
                break;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Error while processing webhook payload.");

                try
                {
                    using var scope = _scopeFactory.CreateScope();
                    var failureLogger = scope.ServiceProvider.GetRequiredService<IFailedWebhookLogService>();

                    var fallback = new FailedWebhookLogDto
                    {
                        SourceModule = "WebhookQueueWorker",
                        FailureType = "DispatchError",
                        ErrorMessage = ex.Message,
                       // RawJson = ex.Data["payload"]?.ToString() ?? "(unavailable)",
                        RawJson = ex.Data["payload"]?.ToString() ?? "{}",
                        CreatedAt = DateTime.UtcNow
                    };

                    await failureLogger.LogFailureAsync(fallback);
                }
                catch (Exception innerEx)
                {
                    _logger.LogError(innerEx, "⚠️ Failed to log to FailedWebhookLogs table.");
                }
            }
        }

        _logger.LogInformation("🛑 Webhook Queue Worker stopped.");
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Controllers/FailedWebhookLogsController.cs  (sha256:f16ada5c238d2293688a73b0c4428da7f91567d1ca100da1809f0b95ea65c2fc)
`$lang
using Microsoft.AspNetCore.Mvc;
using xbytechat.api.Features.Tracking.Services;
using xbytechat.api.Features.Tracking.Models;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Webhooks.Services;

namespace xbytechat.api.Features.Tracking.Controllers
{
    [ApiController]
    [Route("api/failed-webhooks")]
    public class FailedWebhookLogsController : ControllerBase
    {
        private readonly IFailedWebhookLogService _service;

        public FailedWebhookLogsController(IFailedWebhookLogService service)
        {
            _service = service;
        }

        [HttpGet]
        public async Task<IActionResult> GetAllAsync()
        {
            var logs = await _service.GetAllAsync();
            return Ok(logs);
        }

        [HttpGet("{id}")]
        public async Task<IActionResult> GetById(Guid id)
        {
            var log = await _service.GetByIdAsync(id);
            if (log == null)
                return NotFound();

            return Ok(log);
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Controllers/MaintenanceController.cs  (sha256:2936737cca434f20b27184b1885f94a5a90a6a94453b29dc0a597b264cc6325d)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Webhooks.Models;
using xbytechat.api.Features.Webhooks.Services;

namespace xbytechat.api.Features.Webhooks.Controllers
{
    [ApiController]
    [Route("api/webhooks")]
    public class MaintenanceController : ControllerBase
    {
        private readonly AppDbContext _context;
        private readonly IMaintenanceService _maintenance;

        public MaintenanceController(AppDbContext context, IMaintenanceService maintenance)
        {
            _context = context;
            _maintenance = maintenance;
        }

        // ✅ Injected Test Log for Dev Testing
        [HttpPost("inject-test-log")]
        public async Task<IActionResult> InjectTestLog()
        {
            var testLog = new FailedWebhookLog
            {
                SourceModule = "WebhookQueueWorker",
                FailureType = "DispatchError",
                ErrorMessage = "🧪 Simulated webhook dispatch failure for testing.",
                RawJson = "{\"sample\":\"test_payload\",\"reason\":\"unit_test\"}",
                CreatedAt = DateTime.UtcNow
            };

            _context.FailedWebhookLogs.Add(testLog);
            await _context.SaveChangesAsync();

            return Ok(new { message = "✅ Injected test log successfully." });
        }

        // ✅ Manual Cleanup Trigger
        [HttpPost("cleanup-now")]
        public async Task<IActionResult> CleanupNow()
        {
            var cutoff = DateTime.UtcNow.AddDays(-7);
            var oldLogs = await _context.FailedWebhookLogs
                .Where(x => x.CreatedAt < cutoff)
                .ToListAsync();

            if (!oldLogs.Any())
                return Ok(new { message = "✅ No logs to delete." });

            _context.FailedWebhookLogs.RemoveRange(oldLogs);
            await _context.SaveChangesAsync();

            return Ok(new { message = $"✅ Deleted {oldLogs.Count} old logs." });
        }

        // ✅ Count of all failed logs
        [HttpGet("failed/count")]
        public async Task<IActionResult> GetFailedCount()
        {
            var count = await _context.FailedWebhookLogs.CountAsync();
            return Ok(count);
        }

        // ✅ Cleanup Setting Status
             [HttpGet("settings")]
        public async Task<IActionResult> GetCleanupStatus()
        {
            var enabled = await _maintenance.IsAutoCleanupEnabledAsync();
            var lastRun = await _maintenance.GetLastCleanupTimeAsync();

            return Ok(new
            {
                enabled,
                lastCleanupAt = lastRun
            });
        }

        // ✅ Enable Auto Cleanup
        [HttpPost("enable-cleanup")]
        public async Task<IActionResult> EnableCleanup()
        {
            await _maintenance.EnableAutoCleanupAsync();
            return Ok(new { message = "✅ Auto-cleanup enabled." });
        }

        // ✅ Disable Auto Cleanup
        [HttpPost("disable-cleanup")]
        public async Task<IActionResult> DisableCleanup()
        {
            await _maintenance.DisableAutoCleanupAsync();
            return Ok(new { message = "✅ Auto-cleanup disabled." });
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Controllers/WebhookTestController.cs  (sha256:d3d3ac0e403d42baaa151d62e86135b71a0116ed7231d86c04b87bbd4ae6ac61)
`$lang
using Microsoft.AspNetCore.Mvc;
using System.Text.Json;
using xbytechat.api.Features.Webhooks.Services;

namespace xbytechat.api.Features.Webhooks.Controllers
{
    [ApiController]
    [Route("api/webhooks/test")]
    public class WebhookTestController : ControllerBase
    {
        private readonly IWebhookQueueService _queue;

        public WebhookTestController(IWebhookQueueService queue)
        {
            _queue = queue;
        }

        [HttpPost("simulate-failure")]
        public IActionResult SimulateWebhookFailure()
        {
            var fakePayload = new
            {
                entry = new[]
                {
                    new
                    {
                        changes = new[]
                        {
                            new
                            {
                                value = new
                                {
                                    // This will cause dispatcher to throw due to invalid structure
                                    unexpected = "🧪 Simulated bad structure"
                                }
                            }
                        }
                    }
                }
            };

            var json = JsonSerializer.Serialize(fakePayload);
            var element = JsonDocument.Parse(json).RootElement;

            _queue.Enqueue(element);

            return Ok(new
            {
                message = "✅ Test payload enqueued to simulate failure.",
                enqueued = true
            });
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Controllers/WhatsAppWebhookController.cs  (sha256:d25c1bf6870c1712f3270bf8e478e741c09e7d32497bb0f3e64885e8e5c6c7ec)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System.Text.Json;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Webhooks.Services;

namespace xbytechat.api.Features.Webhooks.Controllers
{
    [ApiController]
    [Route("api/webhooks/whatsapp")]
    public class WhatsAppWebhookController : ControllerBase
    {
        private readonly ILogger<WhatsAppWebhookController> _logger;
        private readonly IConfiguration _config;
        private readonly AppDbContext _context;
        private readonly IWhatsAppWebhookService _webhookService;
        private readonly IWebhookQueueService _queue;
            public WhatsAppWebhookController(ILogger<WhatsAppWebhookController> logger,
            IConfiguration config, AppDbContext context, IWhatsAppWebhookService webhookService, IWebhookQueueService queue)
        {
            _logger = logger;
            _config = config;
            _context = context;
            _webhookService = webhookService;
            _queue = queue;
        }

        // ✅ Step 1: Meta verification endpoint (GET)
        // Meta calls this to verify your webhook with hub.verify_token and expects you to return hub.challenge
        [HttpGet]
        public IActionResult VerifyWebhook(
            [FromQuery(Name = "hub.mode")] string mode,
            [FromQuery(Name = "hub.verify_token")] string token,
            [FromQuery(Name = "hub.challenge")] string challenge)
        {
            // 🔐 Load your secret token from config or environment
            var expectedToken = _config["WhatsApp:MetaToken"];

            if (mode == "subscribe" && token == expectedToken)
            {
                _logger.LogInformation("✅ WhatsApp webhook verified successfully.");
                return Ok(challenge); // Meta expects a 200 OK with the challenge value
            }

            _logger.LogWarning("❌ WhatsApp webhook verification failed.");
            return Forbid("Token mismatch.");
        }

     
        [HttpPost]
        public IActionResult HandleStatus([FromBody] JsonElement payload)
        {
            _logger.LogWarning("📥 Webhook received at controller:\n" + payload.ToString());

            try
            {
                var cloned = payload.Clone(); // Important to clone here
                _queue.Enqueue(cloned);

                _logger.LogInformation("📥 Webhook payload enqueued successfully.");
                return Ok(new { received = true });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to enqueue WhatsApp webhook payload.");
                return StatusCode(500, new { error = "Webhook queue failed" });
            }
        }


    }
}

``n
--- file: xbytechat-api/Features/Webhooks/DTOs/FailedWebhookLogDto.cs  (sha256:6b14d817a983f7eb6626a70cc5aceedd50b164ce0e0282dcf155a1d6eb4b5a51)
`$lang
using System;

namespace xbytechat.api.Features.Webhooks.DTOs
{
    public class FailedWebhookLogDto
    {
        public string? ErrorMessage { get; set; }
        public string? SourceModule { get; set; }
        public string? FailureType { get; set; }
        public string RawJson { get; set; } = string.Empty;
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Models/FailedWebhookLog.cs  (sha256:549e466af9a80b67809dd9e25d2bf5b9b5991ce11754225bda46dac4df1e6da6)
`$lang
using System;

namespace xbytechat.api.Features.Webhooks.Models
{
    public class FailedWebhookLog
    {
        public Guid Id { get; set; } = Guid.NewGuid();

        // 🧠 Debug Metadata
        public string? ErrorMessage { get; set; }
        public string? SourceModule { get; set; } // e.g., StatusProcessor, ClickProcessor
        public string? FailureType { get; set; }  // e.g., JSON_PARSE_ERROR, DB_LOOKUP_FAILED

        // 📦 Raw Data Snapshot
        public string RawJson { get; set; } = string.Empty;

        // 🕒 Timeline
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Models/WebhookSettings.cs  (sha256:c0eeeaa5e14f839b159f28d337450f595c7604994690c66fa7df82a56c6a3093)
`$lang
namespace xbytechat.api.Features.Webhooks.Models
{
    public class WebhookSettings
    {
        public Guid Id { get; set; } = Guid.NewGuid();
        public bool AutoCleanupEnabled { get; set; } = true;
        public DateTime? LastCleanupAt { get; set; }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/FailedWebhookLogCleanupService.cs  (sha256:68f4211391a24a94d3096c5cd71fbd6cbd0fed0211dd2929b92b1780ffd02fc8)
`$lang
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
using System;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;

namespace xbytechat.api.Features.Webhooks.Services
{
    public class FailedWebhookLogCleanupService : BackgroundService
    {
        private readonly ILogger<FailedWebhookLogCleanupService> _logger;
        private readonly IServiceProvider _services;
        private readonly TimeSpan _interval = TimeSpan.FromHours(24); // daily run

        public FailedWebhookLogCleanupService(ILogger<FailedWebhookLogCleanupService> logger, IServiceProvider services)
        {
            _logger = logger;
            _services = services;
        }

        protected override async Task ExecuteAsync(CancellationToken stoppingToken)
        {
            _logger.LogInformation("🧹 FailedWebhookLogCleanupService started.");

            while (!stoppingToken.IsCancellationRequested)
            {
                try
                {
                    using var scope = _services.CreateScope();
                    var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();

                    var cutoff = DateTime.UtcNow.AddDays(-7);
                    var oldLogs = await db.FailedWebhookLogs
                        .Where(x => x.CreatedAt < cutoff)
                        .ToListAsync(stoppingToken);

                    if (oldLogs.Any())
                    {
                        db.FailedWebhookLogs.RemoveRange(oldLogs);
                        await db.SaveChangesAsync(stoppingToken);
                        _logger.LogInformation("🧹 Deleted {Count} old failed webhook logs.", oldLogs.Count);
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogError(ex, "❌ Failed to clean up old webhook logs.");
                }

                await Task.Delay(_interval, stoppingToken); // wait before next cleanup
            }

            _logger.LogInformation("🛑 FailedWebhookLogCleanupService stopped.");
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/FailedWebhookLogService.cs  (sha256:3da6a5ad043773f7684b6ea9bc208441cbc36a7e53f01eacdd7c17848118c2af)
`$lang
using System;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using xbytechat.api.Features.Webhooks.DTOs;
using xbytechat.api.Features.Webhooks.Models;

namespace xbytechat.api.Features.Webhooks.Services
{
    public class FailedWebhookLogService : IFailedWebhookLogService
    {
        private readonly AppDbContext _context;
        private readonly ILogger<FailedWebhookLogService> _logger;

        public FailedWebhookLogService(AppDbContext context, ILogger<FailedWebhookLogService> logger)
        {
            _context = context;
            _logger = logger;
        }

        public async Task LogFailureAsync(FailedWebhookLogDto dto)
        {
            try
            {
                var log = new FailedWebhookLog
                {
                    ErrorMessage = dto.ErrorMessage,
                    SourceModule = dto.SourceModule,
                    FailureType = dto.FailureType,
                    RawJson = dto.RawJson,
                    CreatedAt = dto.CreatedAt
                };

                await _context.FailedWebhookLogs.AddAsync(log);
                await _context.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to persist webhook error log");
            }
        }

        public async Task<List<FailedWebhookLog>> GetAllAsync()
        {
            return await _context.FailedWebhookLogs
                .OrderByDescending(x => x.CreatedAt)
                .Take(100) // prevent DB overload
                .ToListAsync();
        }

        public async Task<FailedWebhookLog?> GetByIdAsync(Guid id)
        {
            return await _context.FailedWebhookLogs.FindAsync(id);
        }

    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/IFailedWebhookLogService.cs  (sha256:9366c7a087317049e7dee346a65f7ea81a76fe95fb98fe21ca457e0ed5db6a7c)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.Webhooks.DTOs;
using xbytechat.api.Features.Webhooks.Models;

namespace xbytechat.api.Features.Webhooks.Services
{
    public interface IFailedWebhookLogService
    {
        Task LogFailureAsync(FailedWebhookLogDto dto);
        Task<List<FailedWebhookLog>> GetAllAsync();
        Task<FailedWebhookLog?> GetByIdAsync(Guid id);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/IMaintenanceService.cs  (sha256:76ef1df941e3536bbdce5e7213554b593e6431592ba6527334cf274c78357e26)
`$lang
namespace xbytechat.api.Features.Webhooks.Services
{
    public interface IMaintenanceService
    {
        Task<bool> IsAutoCleanupEnabledAsync();
        Task EnableAutoCleanupAsync();
        Task DisableAutoCleanupAsync();
        Task<DateTime?> GetLastCleanupTimeAsync();
        Task<int> RunCleanupAsync();
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/IWebhookQueueService.cs  (sha256:34e2e37f5ba5da57159852cecd9adde2f085640e1eb55a67116b5381ffa2e4b0)
`$lang
using System.Text.Json;
using xbytechat.api.Features.Tracking.DTOs;

namespace xbytechat.api.Features.Webhooks.Services
{
    public interface IWebhookQueueService
    {
        void Enqueue(JsonElement payload);
        ValueTask<JsonElement> DequeueAsync(CancellationToken cancellationToken);
        int GetQueueLength();
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/IWhatsAppWebhookDispatcher.cs  (sha256:844865d879bca5e59aa9d82cf7fabfb3ac241233391ca0544922a8902eed4a88)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services
{
    public interface IWhatsAppWebhookDispatcher
    {
        Task DispatchAsync(JsonElement payload);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/IWhatsAppWebhookService.cs  (sha256:79f51c796e3319918315cd6043f985b763534fbb19a8357713d2c01aaf385112)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services
{
    public interface IWhatsAppWebhookService
    {
        Task ProcessStatusUpdateAsync(JsonElement payload);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/MaintenanceService .cs  (sha256:c8c7e803e34fb97d2edfbaaf824d332f8de8b1483327e364e63d68dd0082a20e)
`$lang
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Features.Webhooks.Models;

namespace xbytechat.api.Features.Webhooks.Services
{
    public class MaintenanceService : IMaintenanceService
    {
        private readonly AppDbContext _context;

        public MaintenanceService(AppDbContext context)
        {
            _context = context;
        }

        public async Task<bool> IsAutoCleanupEnabledAsync()
        {
            var setting = await _context.WebhookSettings
                .AsNoTracking()
                .FirstOrDefaultAsync();

            return setting?.AutoCleanupEnabled ?? false;
        }

        public async Task<DateTime?> GetLastCleanupTimeAsync()
        {
            return await _context.WebhookSettings
                .AsNoTracking()
                .Select(s => s.LastCleanupAt)
                .FirstOrDefaultAsync();
        }

        public async Task EnableAutoCleanupAsync()
        {
            var setting = await GetOrCreateAsync();
            setting.AutoCleanupEnabled = true;
            await _context.SaveChangesAsync();
        }

        public async Task DisableAutoCleanupAsync()
        {
            var setting = await GetOrCreateAsync();
            setting.AutoCleanupEnabled = false;
            await _context.SaveChangesAsync();
        }

        public async Task<int> RunCleanupAsync()
        {
            var threshold = DateTime.UtcNow.AddDays(-7);
            var oldLogs = await _context.FailedWebhookLogs
                .Where(l => l.CreatedAt < threshold)
                .ToListAsync();

            if (oldLogs.Any())
                _context.FailedWebhookLogs.RemoveRange(oldLogs);

            var setting = await GetOrCreateAsync();
            setting.LastCleanupAt = DateTime.UtcNow;

            await _context.SaveChangesAsync();
            return oldLogs.Count;
        }

        private async Task<WebhookSettings> GetOrCreateAsync()
        {
            var setting = await _context.WebhookSettings.FirstOrDefaultAsync();
            if (setting == null)
            {
                setting = new WebhookSettings
                {
                    AutoCleanupEnabled = false,
                    LastCleanupAt = null
                };
                _context.WebhookSettings.Add(setting);
                await _context.SaveChangesAsync();
            }
            return setting;
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/ClickWebhookProcessor.cs  (sha256:0887fd0dd55ee4fa7ceaae2f534d1b7b0fbdb99dd3814e8a861f68c1b9145c3b)
`$lang
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System;
using System.IO.Pipelines;
using System.Text.Json;
using System.Threading.Tasks;
using xbytechat.api;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.CTAFlowBuilder.Services;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Features.Tracking.Services;
using xbytechat.api.Features.Webhooks.Services.Resolvers;
using xbytechat.api.Helpers;
using xbytechat.api.Shared.TrackingUtils;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public class ClickWebhookProcessor : IClickWebhookProcessor
    {
        private readonly ILogger<ClickWebhookProcessor> _logger;
        private readonly IMessageIdResolver _messageIdResolver;
        private readonly ITrackingService _trackingService;
        private readonly AppDbContext _context;
        private readonly IMessageEngineService _messageEngine;
        private readonly ICTAFlowService _flowService;

        public ClickWebhookProcessor(
            ILogger<ClickWebhookProcessor> logger,
            IMessageIdResolver messageIdResolver,
            ITrackingService trackingService,
            AppDbContext context,
            IMessageEngineService messageEngine,
            ICTAFlowService flowService)
        {
            _logger = logger;
            _messageIdResolver = messageIdResolver;
            _trackingService = trackingService;
            _context = context;
            _messageEngine = messageEngine;
            _flowService = flowService;
        }


        //public async Task ProcessClickAsync(JsonElement value)
        //{
        //    _logger.LogWarning("📥 [ENTERED CLICK PROCESSOR]");

        //    try
        //    {
        //        _logger.LogWarning("📥 [DEBUG] Click processor entered with value: " + value.ToString());

        //        if (!value.TryGetProperty("messages", out var messages)) return;
        //        var message = messages[0];

        //        if (message.GetProperty("type").GetString() != "button") return;

        //        var clickMessageId = message.GetProperty("id").GetString();
        //        var originalMessageId = message.GetProperty("context").GetProperty("id").GetString();
        //        var from = message.GetProperty("from").GetString();
        //        var buttonText = message.GetProperty("button").GetProperty("text").GetString()?.Trim().ToLower();

        //        _logger.LogInformation("🖱️ Button Click ␦ From: {From}, ClickMsgId: {ClickId}, OriginalMsgId: {OrigId}, Text: {Text}",
        //            from, clickMessageId, originalMessageId, buttonText);

        //        Guid businessId = Guid.Empty;
        //        Guid? contactId = null;
        //        string contactPhone = from;
        //        Guid? campaignId = null;
        //        Guid? sendLogId = null;
        //        string sourceType = "catalog";
        //        Guid? sourceId = null;

        //        // 1️⃣ Try CampaignSendLog
        //        var campaignLog = await _context.CampaignSendLogs
        //            .Include(l => l.Campaign)
        //            .Include(l => l.Contact)
        //            .FirstOrDefaultAsync(l => l.MessageId == originalMessageId);

        //        if (campaignLog != null)
        //        {
        //            _logger.LogInformation("📊 CampaignSendLog matched via context.id");

        //            businessId = campaignLog.Campaign?.BusinessId ?? Guid.Empty;
        //            contactId = campaignLog.ContactId;
        //            contactPhone = campaignLog.Contact?.PhoneNumber ?? from;
        //            campaignId = campaignLog.CampaignId;
        //            sendLogId = campaignLog.Id;
        //            sourceType = "campaign";
        //            sourceId = campaignLog.CampaignId;

        //            // 🔁 Auto Follow-Up
        //            if (buttonText == "interested" &&
        //                !string.IsNullOrWhiteSpace(campaignLog.Campaign?.FollowUpTemplateId))
        //            {
        //                var followUpDto = new SimpleTemplateMessageDto
        //                {
        //                    BusinessId = businessId,
        //                    RecipientNumber = contactPhone,
        //                    TemplateName = campaignLog.Campaign.FollowUpTemplateId,
        //                    TemplateParameters = new() // Phase 1 → no variables
        //                };

        //                var result = await _messageEngine.SendTemplateMessageSimpleAsync(followUpDto);
        //                _logger.LogInformation(result.Success
        //                    ? "✅ Follow-up message sent successfully."
        //                    : $"❌ Follow-up failed: {result.Message}");
        //            }
        //        }
        //        else
        //        {
        //            _logger.LogWarning("⚠️ CampaignSendLog not found. Trying fallback to MessageLogs.");

        //            var log = await _context.MessageLogs
        //                .FirstOrDefaultAsync(m =>
        //                    m.MessageId == originalMessageId ||
        //                    m.Id.ToString() == originalMessageId ||
        //                    m.RawResponse.Contains(originalMessageId));

        //            if (log != null)
        //            {
        //                businessId = log.BusinessId;
        //                contactId = log.ContactId;
        //                contactPhone = log.RecipientNumber ?? from;
        //                sourceType = "flow";
        //                _logger.LogInformation("✅ Fallback matched MessageLog. BusinessId: {BusinessId}", businessId);
        //            }
        //            else
        //            {
        //                _logger.LogWarning("❌ Fallback to MessageLogs failed. No message found for: {OriginalId}", originalMessageId);
        //            }
        //        }

        //        if (businessId == Guid.Empty)
        //        {
        //            _logger.LogWarning("❌ TrackingLog failed: No BusinessId available for click.");
        //            return;
        //        }

        //        // 2️⃣ Save Tracking
        //        var dto = new TrackingLogDto
        //        {
        //            BusinessId = businessId,
        //            CampaignId = campaignId,
        //            CampaignSendLogId = sendLogId,
        //            ContactId = contactId,
        //            ContactPhone = contactPhone,
        //            MessageId = originalMessageId,
        //            MessageLogId = null,
        //            SourceType = sourceType,
        //            SourceId = sourceId,
        //            ButtonText = buttonText,
        //            CTAType = buttonText,
        //            ClickedVia = "webhook",
        //            ClickedAt = DateTime.UtcNow,
        //            Browser = "WhatsApp",
        //            IPAddress = "webhook",
        //            DeviceType = DeviceHelper.GetDeviceType("WhatsApp"),
        //            Country = await GeoHelper.GetCountryFromIP("webhook"),
        //            RawJson = value.ToString()
        //        };

        //        var resultLog = await _trackingService.LogCTAClickWithEnrichmentAsync(dto);
        //        _logger.LogInformation("📥 Tracking Result: {Result}", resultLog?.Message ?? "N/A");

        //        // 3️⃣ Match Flow → Trigger Next Step (if any)
        //        try
        //        {
        //            if (!string.IsNullOrWhiteSpace(dto.ButtonText))
        //            {
        //                var matchedStep = await _flowService.MatchStepByButtonAsync(
        //                    businessId,
        //                    dto.ButtonText.Trim().ToLower(),
        //                    "quick_reply",
        //                    campaignLog?.Campaign?.MessageTemplate ?? "",  // currentTemplateName
        //                    campaignId
        //                );

        //                if (matchedStep != null)
        //                {
        //                    ResponseResult sendResult;

        //                    switch (matchedStep.TemplateType?.ToLower())
        //                    {
        //                        case "image_template":
        //                            var imageDto = new ImageTemplateMessageDto
        //                            {
        //                                BusinessId = businessId,
        //                                RecipientNumber = contactPhone,
        //                                TemplateName = matchedStep.TemplateToSend,
        //                                LanguageCode = "en_US"
        //                            };
        //                            sendResult = await _messageEngine.SendImageTemplateMessageAsync(imageDto);
        //                            break;

        //                        case "text_template":
        //                            var textDto = new SimpleTemplateMessageDto
        //                            {
        //                                BusinessId = businessId,
        //                                RecipientNumber = contactPhone,
        //                                TemplateName = matchedStep.TemplateToSend,
        //                                TemplateParameters = new() // Phase 1 = No placeholders
        //                            };
        //                            sendResult = await _messageEngine.SendTemplateMessageSimpleAsync(textDto);
        //                            break;

        //                        default:
        //                            _logger.LogWarning("❌ Unsupported template type in flow step: {Type}", matchedStep.TemplateType);
        //                            return;
        //                    }

        //                    if (sendResult.Success)
        //                    {
        //                        _logger.LogInformation("⚡ CTA Flow matched! Sent template: {Template}", matchedStep.TemplateToSend);
        //                    }
        //                    else
        //                    {
        //                        _logger.LogWarning("❌ Failed to send matched CTA template: {Message}", sendResult.Message);
        //                    }
        //                }
        //                else
        //                {
        //                    _logger.LogInformation("🟡 No CTA Flow matched for button: {Text}", dto.ButtonText);
        //                }
        //            }
        //        }
        //        catch (Exception flowEx)
        //        {
        //            _logger.LogError(flowEx, "❌ CTA Flow trigger failed.");
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        _logger.LogError(ex, "❌ Failed to process button click.");
        //    }
        //}

        public async Task ProcessClickAsync(JsonElement value)
        {
            _logger.LogWarning("📥 [ENTERED CLICK PROCESSOR]");

            try
            {
                if (!value.TryGetProperty("messages", out var messages)) return;
                var message = messages[0];

                if (message.GetProperty("type").GetString() != "button") return;

                var clickMessageId = message.GetProperty("id").GetString();
                var originalMessageId = message.GetProperty("context").GetProperty("id").GetString();
                var from = message.GetProperty("from").GetString();
                var buttonText = message.GetProperty("button").GetProperty("text").GetString()?.Trim();

                _logger.LogInformation("🖱️ Button Click → From: {From}, ClickId: {ClickId}, OrigMsgId: {OrigId}, Text: {Text}",
                    from, clickMessageId, originalMessageId, buttonText);

                Guid businessId = Guid.Empty;
                Guid? contactId = null;
                string contactPhone = from;
                Guid? campaignId = null;
                Guid? sendLogId = null;
                string sourceType = "catalog";
                Guid? sourceId = null;

                // 1️⃣ Try CampaignSendLog
                var campaignLog = await _context.CampaignSendLogs
                    .Include(l => l.Campaign)
                    .Include(l => l.Contact)
                    .FirstOrDefaultAsync(l => l.MessageId == originalMessageId);

                if (campaignLog != null)
                {
                    _logger.LogInformation("📊 CampaignSendLog matched via context.id");

                    businessId = campaignLog.Campaign?.BusinessId ?? Guid.Empty;
                    contactId = campaignLog.ContactId;
                    contactPhone = campaignLog.Contact?.PhoneNumber ?? from;
                    campaignId = campaignLog.CampaignId;
                    sendLogId = campaignLog.Id;
                    sourceType = "campaign";
                    sourceId = campaignLog.CampaignId;
                }
                else
                {
                    var log = await _context.MessageLogs
                        .FirstOrDefaultAsync(m =>
                            m.MessageId == originalMessageId ||
                            m.Id.ToString() == originalMessageId ||
                            m.RawResponse.Contains(originalMessageId));

                    if (log != null)
                    {
                        businessId = log.BusinessId;
                        contactId = log.ContactId;
                        contactPhone = log.RecipientNumber ?? from;
                        sourceType = "flow";
                        _logger.LogInformation("✅ Fallback matched MessageLog. BusinessId: {BusinessId}", businessId);
                    }
                }

                if (businessId == Guid.Empty)
                {
                    _logger.LogWarning("❌ TrackingLog failed: No BusinessId available.");
                    return;
                }

                // 2️⃣ Save Click Log with enrichment
                var dto = new TrackingLogDto
                {
                    BusinessId = businessId,
                    CampaignId = campaignId,
                    CampaignSendLogId = sendLogId,
                    ContactId = contactId,
                    ContactPhone = contactPhone,
                    MessageId = originalMessageId,
                    MessageLogId = null,
                    SourceType = sourceType,
                    SourceId = sourceId,
                    ButtonText = buttonText,
                    CTAType = buttonText,
                    ClickedVia = "webhook",
                    ClickedAt = DateTime.UtcNow,
                    Browser = "WhatsApp",
                    IPAddress = "webhook",
                    DeviceType = DeviceHelper.GetDeviceType("WhatsApp"),
                    Country = await GeoHelper.GetCountryFromIP("webhook"),
                    RawJson = value.ToString()
                };

                var resultLog = await _trackingService.LogCTAClickWithEnrichmentAsync(dto);
                _logger.LogInformation("📥 Click Tracked → Result: {Msg}", resultLog?.Message ?? "N/A");

                // ✅ Extract TrackingLog.Id from result
                if (resultLog?.Success != true || resultLog.Data is not Guid trackingLogId)
                {
                    _logger.LogWarning("⚠️ Skipping flow execution: Tracking ID not found.");
                    return;
                }

                // 3️⃣ Match Flow Step and trigger flow
                if (!string.IsNullOrWhiteSpace(dto.ButtonText))
                {
                    var matchedStep = await _flowService.MatchStepByButtonAsync(
                        businessId,
                        dto.ButtonText.Trim(),
                        "quick_reply",
                        campaignLog?.Campaign?.MessageTemplate ?? "",
                        campaignId
                    );

                    if (matchedStep != null)
                    {
                        _logger.LogInformation("🔁 Matched CTA Step → {StepId}", matchedStep.Id);

                        await _flowService.ExecuteVisualFlowAsync(
                            businessId,
                            matchedStep.Id,
                            trackingLogId
                        );

                        _logger.LogInformation("⚡ Visual flow triggered via CTA click.");
                    }
                    else
                    {
                        _logger.LogInformation("🟡 No visual flow matched for this button: {Text}", dto.ButtonText);
                    }
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to process CTA button click.");
            }
        }

    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/IClickWebhookProcessor.cs  (sha256:5c42427d1e6c36dd122b3a10412eb70d7c412baf00ce54a614491a5b1590afeb)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public interface IClickWebhookProcessor
    {
        Task ProcessClickAsync(JsonElement value);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/IInboundMessageProcessor.cs  (sha256:ec5496c7810122c99affe09fa17861d6d0c371457d9284e0ba58be6a93ea60f2)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public interface IInboundMessageProcessor
    {
        Task ProcessChatAsync(JsonElement value);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/InboundMessageProcessor.cs  (sha256:4d185e53ba4a52cd2439e23dc136aab36f4f7469c5399dd644247fdfd5631ae9)
`$lang
using System;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.AspNetCore.SignalR;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using xbytechat.api;
using xbytechat.api.Features.Inbox.DTOs;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.Inbox.Hubs;
using Microsoft.Extensions.DependencyInjection;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.Features.AutoReplyBuilder.Services;
using xbytechat.api.Features.Inbox.Services;
using xbytechat.api.Features.MessagesEngine.DTOs;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.CRM.Services;
using xbytechat.api.Features.Automation.Services;


namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public class InboundMessageProcessor : IInboundMessageProcessor
    {
        private readonly AppDbContext _context;
        private readonly IHubContext<InboxHub> _hubContext;
        private readonly ILogger<InboundMessageProcessor> _logger;
        private readonly IInboxService _inboxService;
        private readonly IServiceScopeFactory _serviceScopeFactory;
        public InboundMessageProcessor(
            AppDbContext context,
            IHubContext<InboxHub> hubContext,
            ILogger<InboundMessageProcessor> logger,
            IInboxService inboxService,
            IServiceScopeFactory serviceScopeFactory)
        {
            _context = context;
            _hubContext = hubContext;
            _logger = logger;
            _inboxService = inboxService;
            _serviceScopeFactory = serviceScopeFactory;
        }



        
        public async Task ProcessChatAsync(JsonElement value)
        {
            try
            {
                using var scope = _serviceScopeFactory.CreateScope();
                var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();
                var contactService = scope.ServiceProvider.GetRequiredService<IContactService>();
                var chatSessionStateService = scope.ServiceProvider.GetRequiredService<IChatSessionStateService>();
                var automationService = scope.ServiceProvider.GetRequiredService<IAutomationService>();
                var logger = scope.ServiceProvider.GetRequiredService<ILogger<InboundMessageProcessor>>();

                // ✅ 1. Extract WhatsApp metadata and message
                var msg = value.GetProperty("messages")[0];
                var contactPhone = msg.GetProperty("from").GetString()!;
                var content = msg.GetProperty("text").GetProperty("body").GetString();
                var businessNumber = value.GetProperty("metadata").GetProperty("display_phone_number").GetString()!;

                // ✅ 2. Resolve business by WhatsApp number
                var business = await db.Businesses
                    .Include(b => b.WhatsAppSettings)
                    .FirstOrDefaultAsync(b => b.WhatsAppSettings.WhatsAppBusinessNumber == businessNumber);

                if (business == null)
                {
                    logger.LogWarning("❌ Business not found for WhatsApp number: {Number}", businessNumber);
                    return;
                }

                var businessId = business.Id;

                // ✅ 3. Find or create contact
                var contact = await contactService.FindOrCreateAsync(businessId, contactPhone);
                if (contact == null)
                {
                    logger.LogWarning("❌ Could not resolve contact for phone: {Phone}", contactPhone);
                    return;
                }

                // ✅ 4. Check chat mode (skip inbox sync if not agent)
                var mode = await chatSessionStateService.GetChatModeAsync(businessId, contact.Id);
                var isAgentMode = mode == "agent";

                // ✅ 5. Log incoming message
                var messageLog = new MessageLog
                {
                    Id = Guid.NewGuid(),
                    BusinessId = businessId,
                    ContactId = contact.Id,
                    RecipientNumber = contactPhone,
                    MessageContent = content,
                    Status = "received",
                    CreatedAt = DateTime.UtcNow,
                    SentAt = DateTime.UtcNow,
                    IsIncoming = true
                };

                db.MessageLogs.Add(messageLog);
                await db.SaveChangesAsync();

                // ✅ 6. Try to trigger automation by keyword
                try
                {
                    var triggerKeyword = content.Trim().ToLower();
                    var handled = await automationService.TryRunFlowByKeywordAsync(
                        businessId,
                        triggerKeyword,
                        contact.PhoneNumber,
                        sourceChannel: "whatsapp",
                        industryTag: "default"
                    );

                    if (!handled)
                    {
                        logger.LogInformation("🕵️ No automation flow matched keyword: {Keyword}", triggerKeyword);
                    }
                }
                catch (Exception ex)
                {
                    logger.LogError(ex, "❌ Automation flow execution failed.");
                }

                // ✅ 7. Only sync to inbox if chat mode is agent
                if (isAgentMode)
                {
                    var inboxService = scope.ServiceProvider.GetRequiredService<IInboxService>();
                    await inboxService.SaveIncomingMessageAsync(new InboxMessageDto
                    {
                        BusinessId = businessId,
                        ContactId = contact.Id,
                        RecipientPhone = contact.PhoneNumber,
                        MessageBody = messageLog.MessageContent,
                        IsIncoming = true,
                        Status = messageLog.Status,
                        SentAt = messageLog.CreatedAt
                    });

                    logger.LogInformation("📥 Message synced to inbox for contact {Phone}", contactPhone);
                }
                else
                {
                    logger.LogInformation("🚫 Skipping inbox sync: chat mode is not 'agent'");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to process inbound WhatsApp chat.");
            }
        }


    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/IStatusWebhookProcessor.cs  (sha256:b1e65faf4d0e1fe42cb9f0ca594f5e67270ea101fb1aabf768ab89da63aba838)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public interface IStatusWebhookProcessor
    {
        Task ProcessStatusUpdateAsync(JsonElement payload);

    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/ITemplateWebhookProcessor.cs  (sha256:6f04b24d675a88073c59204ed241e4744205e80e8d488dd464550a6105c45b7a)
`$lang
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public interface ITemplateWebhookProcessor
    {
        Task ProcessTemplateUpdateAsync(JsonElement payload);
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/StatusWebhookProcessor.cs  (sha256:2ed51eba7ff737266deb3c2aa5a4276c3e6afed2ee2da7472bd02e8e695ed4b9)
`$lang
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System;
using System.Text.Json;
using System.Threading.Tasks;
using xbytechat.api.Features.CampaignTracking.Models;
using xbytechat.api.Features.Webhooks.Services.Resolvers;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public class StatusWebhookProcessor : IStatusWebhookProcessor
    {
        private readonly AppDbContext _context;
        private readonly ILogger<StatusWebhookProcessor> _logger;
        private readonly IMessageIdResolver _messageIdResolver; // ✅ Injected resolver

        public StatusWebhookProcessor(
            AppDbContext context,
            ILogger<StatusWebhookProcessor> logger,
            IMessageIdResolver messageIdResolver) // ✅ Accept resolver in constructor
        {
            _context = context;
            _logger = logger;
            _messageIdResolver = messageIdResolver;
        }

        // 🔄 Extract statuses from the payload and route them to log resolver
        public async Task ProcessAsync(JsonElement value)
        {
            if (!value.TryGetProperty("statuses", out var statuses))
            {
                _logger.LogWarning("⚠️ 'statuses' field missing in webhook payload.");
                return;
            }

            foreach (var status in statuses.EnumerateArray())
            {
                var messageId = status.GetProperty("id").GetString();
                var statusText = status.GetProperty("status").GetString();
                //var timestamp = status.TryGetProperty("timestamp", out var ts) ? ts.GetInt64() : 0;
                //var timestamp = status.TryGetProperty("timestamp", out var ts) ? ts.GetInt64() : 0;

                long timestamp = 0;

                if (status.TryGetProperty("timestamp", out var ts))
                {
                    if (ts.ValueKind == JsonValueKind.String && long.TryParse(ts.GetString(), out var parsed))
                    {
                        timestamp = parsed;
                    }
                    else if (ts.ValueKind == JsonValueKind.Number)
                    {
                        timestamp = ts.GetInt64();
                    }
                }

                var time = DateTimeOffset.FromUnixTimeSeconds(timestamp).UtcDateTime;
                _logger.LogDebug("🕓 Parsed timestamp: {0} from raw type: {1}", timestamp, ts.ValueKind);
                // ✅ Resolve the correct CampaignSendLog ID using the new resolver
                var logId = await _messageIdResolver.ResolveCampaignSendLogIdAsync(messageId);

                if (logId == null)
                {
                    _logger.LogWarning($"⚠️ No matching CampaignSendLog for MessageId: {messageId}");
                    continue;
                }

                // 🔍 Now load the row by resolved ID
                var log = await _context.CampaignSendLogs.FirstOrDefaultAsync(l => l.Id == logId.Value);
                if (log != null)
                {
                    log.SendStatus = statusText switch
                    {
                        "sent" => "Sent",
                        "delivered" => "Delivered",
                        "read" => "Read",
                        _ => log.SendStatus
                    };

                    if (statusText == "delivered") log.DeliveredAt = time;
                    if (statusText == "read") log.ReadAt = time;

                    await _context.SaveChangesAsync();
                    _logger.LogInformation($"✅ CampaignSendLog updated for MessageId: {messageId} → {statusText}");
                }
            }
        }

        // 🔁 Entry point from webhook dispatcher
        public async Task ProcessStatusUpdateAsync(JsonElement payload)
        {
            _logger.LogWarning("🔍 Incoming timestamp raw value: {0}", payload.ToString());
            var entry = payload.GetProperty("entry")[0];
            var changes = entry.GetProperty("changes")[0];
            var value = changes.GetProperty("value");

            await ProcessAsync(value); // ✅ Unified internal call
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Processors/TemplateWebhookProcessor.cs  (sha256:0dbe7873fcf7b84d3a4fb9d78bda6689d86cbfd4d9fd50ce1d98029aaaef0558)
`$lang
using System;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;

namespace xbytechat.api.Features.Webhooks.Services.Processors
{
    public class TemplateWebhookProcessor : ITemplateWebhookProcessor
    {
        private readonly ILogger<TemplateWebhookProcessor> _logger;

        public TemplateWebhookProcessor(ILogger<TemplateWebhookProcessor> logger)
        {
            _logger = logger;
        }

        public async Task ProcessTemplateUpdateAsync(JsonElement payload)
        {
            try
            {
                var entry = payload.GetProperty("entry")[0];
                var changes = entry.GetProperty("changes")[0];
                var value = changes.GetProperty("value");

                var eventType = value.GetProperty("event").GetString();
                var templateId = value.TryGetProperty("message_template_id", out var idProp)
                                 ? idProp.GetString() : "(unknown)";

                _logger.LogInformation($"🧾 Template Event Received: {eventType} for ID: {templateId}");

                // 🧠 You can store in DB or show in admin logs in the future

                await Task.CompletedTask;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Failed to process template webhook update.");
            }
        }
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Resolvers/IMessageIdResolver.cs  (sha256:a9129664eb60ff771e1f4895a51f74dd7277f7693c9a9638cab9363dc4618baa)
`$lang
using System;
using System.Threading.Tasks;

namespace xbytechat.api.Features.Webhooks.Services.Resolvers
{
    public interface IMessageIdResolver
    {
        Task<Guid?> ResolveCampaignSendLogIdAsync(string messageId);
        Task<Guid?> ResolveMessageLogIdAsync(string messageId);
        Task<Guid?> ResolveBusinessIdByMessageIdAsync(string messageId);

    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/Resolvers/MessageIdResolver.cs  (sha256:34280daacb42fd65daf76845f254009aff42867432c235250272bb6fc6676084)
`$lang
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;
using System;
using System.Threading.Tasks;
using xbytechat.api;

namespace xbytechat.api.Features.Webhooks.Services.Resolvers
{
    public class MessageIdResolver : IMessageIdResolver
    {
        private readonly AppDbContext _context;
        private readonly ILogger<MessageIdResolver> _logger;

        public MessageIdResolver(AppDbContext context, ILogger<MessageIdResolver> logger)
        {
            _context = context;
            _logger = logger;
        }

        public async Task<Guid?> ResolveCampaignSendLogIdAsync(string messageId)
        {
            var log = await _context.CampaignSendLogs
                                .FirstOrDefaultAsync(l => l.MessageId == messageId);

            if (log == null)
            {
                _logger.LogWarning("⚠️ CampaignSendLog not found for MessageId: {MessageId}", messageId);
                return null;
            }

            return log.Id;
        }

        public async Task<Guid?> ResolveMessageLogIdAsync(string messageId)
        {
            var log = await _context.MessageLogs
                .AsNoTracking()
                .FirstOrDefaultAsync(l => l.MessageId == messageId);

            if (log == null)
            {
                _logger.LogWarning("⚠️ MessageLog not found for MessageId: {MessageId}", messageId);
                return null;
            }

            return log.Id;
        }

        public async Task<Guid?> ResolveBusinessIdByMessageIdAsync(string messageId)
        {
            var log = await _context.MessageLogs
                .AsNoTracking()
                .FirstOrDefaultAsync(l => l.MessageId == messageId);

            if (log == null)
            {
                _logger.LogWarning("⚠️ MessageLog not found for MessageId: {MessageId}", messageId);
                return null;
            }

            return log.BusinessId;
        }

    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/WebhookQueueService.cs  (sha256:5de062949cd3197e00bf3971292ea36c2014849de597b6cc077673c464a02286)
`$lang
using System.Text.Json;
using System.Threading.Channels;

namespace xbytechat.api.Features.Webhooks.Services
{
    public class WebhookQueueService : IWebhookQueueService
    {
        private readonly Channel<JsonElement> _queue;

        public WebhookQueueService()
        {
            var options = new BoundedChannelOptions(5000)
            {
                FullMode = BoundedChannelFullMode.Wait,
                SingleReader = true,
                SingleWriter = false
            };

            _queue = Channel.CreateBounded<JsonElement>(options);
        }

        public void Enqueue(JsonElement item)
        {
            if (!_queue.Writer.TryWrite(item))
            {
                throw new InvalidOperationException("⚠️ Webhook queue is full.");
            }
        }

        public async ValueTask<JsonElement> DequeueAsync(CancellationToken cancellationToken)
        {
            return await _queue.Reader.ReadAsync(cancellationToken);
        }

        public int GetQueueLength() => _queue.Reader.Count;
    }
}

``n
--- file: xbytechat-api/Features/Webhooks/Services/WhatsAppWebhookDispatcher.cs  (sha256:9b49d77f9faaa3791a6a92f988ad2269e92a283fc91898ef5e885ed90fbbd586)
`$lang
using System;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using xbytechat.api.Features.Webhooks.Services.Processors;
using static System.Net.Mime.MediaTypeNames;

namespace xbytechat.api.Features.Webhooks.Services
{
    /// <summary>
    /// Central dispatcher for WhatsApp webhook events.
    /// Routes payloads to the appropriate processor based on payload type.
    /// </summary>
    public class WhatsAppWebhookDispatcher : IWhatsAppWebhookDispatcher
    {
        private readonly IStatusWebhookProcessor _statusProcessor;
        private readonly ITemplateWebhookProcessor _templateProcessor;
        private readonly ILogger<WhatsAppWebhookDispatcher> _logger;
        private readonly IClickWebhookProcessor _clickProcessor;
        private readonly IInboundMessageProcessor _inboundMessageProcessor;
        public WhatsAppWebhookDispatcher(
            IStatusWebhookProcessor statusProcessor,
            ITemplateWebhookProcessor templateProcessor,
            ILogger<WhatsAppWebhookDispatcher> logger,
            IClickWebhookProcessor clickProcessor,
            IInboundMessageProcessor inboundMessageProcessor)
        {
            _statusProcessor = statusProcessor;
            _templateProcessor = templateProcessor;
            _logger = logger;
            _clickProcessor = clickProcessor;
            _inboundMessageProcessor = inboundMessageProcessor;
        }


        //public async Task DispatchAsync(JsonElement payload)
        //{
        //    //throw new Exception("🧪 Simulated webhook dispatch failure for testing.");
        //    _logger.LogWarning("📦 Dispatcher Raw Payload:\n" + payload.ToString());
        //    try
        //    {
        //        if (!payload.TryGetProperty("entry", out var entries)) return;

        //        foreach (var entry in entries.EnumerateArray())
        //        {
        //            if (!entry.TryGetProperty("changes", out var changes)) continue;

        //            foreach (var change in changes.EnumerateArray())
        //            {
        //                if (!change.TryGetProperty("value", out var value)) continue;

        //                // 📨 Status Updates
        //                if (value.TryGetProperty("statuses", out _))
        //                {
        //                    _logger.LogInformation("📦 Routing to Status Processor");
        //                    await _statusProcessor.ProcessStatusUpdateAsync(payload);
        //                    continue;
        //                }

        //                // 🧾 Template Events
        //                if (value.TryGetProperty("event", out var eventType)
        //                    && eventType.GetString()?.StartsWith("template_") == true)
        //                {
        //                    _logger.LogInformation("📦 Routing to Template Processor");
        //                    await _templateProcessor.ProcessTemplateUpdateAsync(payload);
        //                    continue;
        //                }

        //                // 🎯 Click Events
        //                if (value.TryGetProperty("messages", out var messages)
        //                    && messages.GetArrayLength() > 0
        //                    && messages[0].TryGetProperty("type", out var type)
        //                    && type.GetString() == "button")
        //                {
        //                    _logger.LogInformation("👉 Routing to Click Processor");
        //                    await _clickProcessor.ProcessClickAsync(value);
        //                    continue;
        //                }
        //                // 📥 Inbound text/image/audio messages from customer
        //                if (value.TryGetProperty("messages", out var messages) &&
        //                    messages.GetArrayLength() > 0 &&
        //                    messages[0].TryGetProperty("type", out var typeProp))
        //                {
        //                    var type = typeProp.GetString();

        //                    if (type is "text" or "image" or "audio")
        //                    {
        //                        _logger.LogInformation("💬 Routing to InboundMessageProcessor (type: {Type})", type);
        //                        await _inboundProcessor.ProcessAsync(value);
        //                        continue;
        //                    }
        //                }

        //                _logger.LogWarning("⚠️ No matching event processor found.");
        //            }
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        _logger.LogError(ex, "❌ Dispatcher failed to process WhatsApp webhook.");
        //    }
        //}

        public async Task DispatchAsync(JsonElement payload)
        {
            //clickMessages for button clicks
            // inboundMessages for text / image / audio

            _logger.LogWarning("📦 Dispatcher Raw Payload:\n" + payload.ToString());

            try
            {
                if (!payload.TryGetProperty("entry", out var entries)) return;

                foreach (var entry in entries.EnumerateArray())
                {
                    if (!entry.TryGetProperty("changes", out var changes)) continue;

                    foreach (var change in changes.EnumerateArray())
                    {
                        if (!change.TryGetProperty("value", out var value)) continue;

                        // 📨 Status Updates
                        if (value.TryGetProperty("statuses", out _))
                        {
                            _logger.LogInformation("📦 Routing to Status Processor");
                            await _statusProcessor.ProcessStatusUpdateAsync(payload);
                            continue;
                        }

                        // 🧾 Template Events
                        if (value.TryGetProperty("event", out var eventType)
                            && eventType.GetString()?.StartsWith("template_") == true)
                        {
                            _logger.LogInformation("📦 Routing to Template Processor");
                            await _templateProcessor.ProcessTemplateUpdateAsync(payload);
                            continue;
                        }

                        // 🎯 Click Events (button type)
                        if (value.TryGetProperty("messages", out var clickMessages)
                            && clickMessages.GetArrayLength() > 0
                            && clickMessages[0].TryGetProperty("type", out var clickType)
                            && clickType.GetString() == "button")
                        {
                            _logger.LogInformation("👉 Routing to Click Processor");
                            await _clickProcessor.ProcessClickAsync(value);
                            continue;
                        }

                        // 💬 Inbound Messages (text/image/audio)
                        if (value.TryGetProperty("messages", out var inboundMessages)
                            && inboundMessages.GetArrayLength() > 0
                            && inboundMessages[0].TryGetProperty("type", out var inboundType))
                        {
                            var type = inboundType.GetString();

                            if (type is "text" or "image" or "audio")
                            {
                                _logger.LogInformation("💬 Routing to InboundMessageProcessor (type: {Type})", type);
                                await _inboundMessageProcessor.ProcessChatAsync(value);
                                continue;
                            }
                        }

                        _logger.LogWarning("⚠️ No matching event processor found.");
                    }
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Dispatcher failed to process WhatsApp webhook.");
            }
        }

    }
}


``n
--- file: xbytechat-api/Features/Webhooks/Services/WhatsAppWebhookService.cs  (sha256:1eab721a5c07db54368581314d45a8dfb105e5d301d1dd25be6883950deaad02)
`$lang
using System;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;

namespace xbytechat.api.Features.Webhooks.Services
{
    public class WhatsAppWebhookService : IWhatsAppWebhookService
    {
        private readonly AppDbContext _context;
        private readonly ILogger<WhatsAppWebhookService> _logger;

        public WhatsAppWebhookService(AppDbContext context, ILogger<WhatsAppWebhookService> logger)
        {
            _context = context;
            _logger = logger;
        }
        public async Task ProcessStatusUpdateAsync(JsonElement payload)
        {
            _logger.LogInformation("📦 Processing Webhook Status:\n" +
                JsonSerializer.Serialize(payload, new JsonSerializerOptions { WriteIndented = true }));

            if (!payload.TryGetProperty("entry", out var entries))
            {
                _logger.LogWarning("⚠️ Payload missing 'entry' property.");
                return;
            }

            foreach (var entry in entries.EnumerateArray())
            {
                if (!entry.TryGetProperty("changes", out var changes)) continue;

                foreach (var change in changes.EnumerateArray())
                {
                    if (!change.TryGetProperty("value", out var value)) continue;

                    if (!value.TryGetProperty("statuses", out var statuses)) continue;

                    foreach (var status in statuses.EnumerateArray())
                    {
                        string? messageId = status.TryGetProperty("id", out var idProp) ? idProp.GetString() : null;
                        string? statusText = status.TryGetProperty("status", out var statusProp) ? statusProp.GetString() : null;
                        long timestamp = status.TryGetProperty("timestamp", out var tsProp) && tsProp.ValueKind == JsonValueKind.String
                                         && long.TryParse(tsProp.GetString(), out var parsedTs)
                                         ? parsedTs
                                         : (tsProp.ValueKind == JsonValueKind.Number ? tsProp.GetInt64() : 0);

                        if (string.IsNullOrEmpty(messageId) || string.IsNullOrEmpty(statusText))
                        {
                            _logger.LogWarning("⚠️ Missing messageId or statusText in webhook payload.");
                            continue;
                        }

                        var log = await _context.CampaignSendLogs
                            //.AsNoTracking()
                            .FirstOrDefaultAsync(l => l.MessageId == messageId);

                        if (log != null)
                        {
                            var time = DateTimeOffset.FromUnixTimeSeconds(timestamp).UtcDateTime;

                            //log.SendStatus = statusText switch
                            //{
                            //    "sent" => "Sent",
                            //    "delivered" => "Delivered",
                            //    "read" => "Read",
                            //    _ => log.SendStatus
                            //};

                            //if (statusText == "delivered") log.DeliveredAt = time;
                            //if (statusText == "read") log.ReadAt = time;

                            //await _context.SaveChangesAsync();
                            // 🔁 Avoid redundant updates
                            var newStatus = statusText switch
                            {
                                "sent" => "Sent",
                                "delivered" => "Delivered",
                                "read" => "Read",
                                _ => null
                            };

                            bool isUpdated = false;

                            if (!string.IsNullOrEmpty(newStatus) && log.SendStatus != newStatus)
                            {
                                log.SendStatus = newStatus;
                                isUpdated = true;
                            }

                            if (statusText == "delivered" && log.DeliveredAt == null)
                            {
                                log.DeliveredAt = time;
                                isUpdated = true;
                            }

                            if (statusText == "read" && log.ReadAt == null)
                            {
                                log.ReadAt = time;
                                isUpdated = true;
                            }

                            if (isUpdated)
                            {
                                await _context.SaveChangesAsync();
                                _logger.LogInformation($"✅ Log updated for MessageId: {messageId} → {newStatus}");
                            }
                            else
                            {
                                _logger.LogInformation($"🔁 Duplicate status '{statusText}' skipped for MessageId: {messageId}");
                            }

                            _logger.LogInformation($"✅ Log updated for MessageId: {messageId} → {statusText}");
                        }
                        else
                        {
                            _logger.LogWarning($"⚠️ No matching CampaignSendLog for MessageId: {messageId}");
                        }
                    }
                }
            }
        }

    }
}

``n
--- file: xbytechat-api/Features/WhatsAppIntegration/Controllers/WhatsAppTemplateController.cs  (sha256:7cee6e94d95a99b2c7b15eb9567b21bea75fb9efd058d6c2a00fba7585616dc8)
`$lang

using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Configuration;
using System.Net.Http;
using System.Threading.Tasks;
using Newtonsoft.Json;
using System.Net.Http.Headers;
using Newtonsoft.Json.Linq;

namespace xbytechat.api.Features.WhatsAppIntegration.Controllers
{
    [ApiController]
    [Route("api/whatsapp")]
    public class WhatsAppTemplateController : ControllerBase
    {
        private readonly IConfiguration _config;

        public WhatsAppTemplateController(IConfiguration config)
        {
            _config = config;
        }

        [HttpGet]
        public async Task<IActionResult> GetTemplates()
        {
            var wabaId = _config["WhatsApp:WABA_ID"];
            var apiToken = _config["WhatsApp:apiToken"];
            var url = $"https://graph.facebook.com/v22.0/{wabaId}/message_templates";

            using var client = new HttpClient();
            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", apiToken);

            try
            {
                var response = await client.GetAsync(url);
                var json = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                    return StatusCode((int)response.StatusCode, new { success = false, error = json });

                var root = JsonConvert.DeserializeObject<JObject>(json);
                var templatesRaw = root["data"] as JArray;

                if (templatesRaw == null)
                    return BadRequest(new { success = false, error = "Meta API did not return data array." });

                var templates = new List<object>();

                foreach (var tpl in templatesRaw)
                {
                    string name = tpl["name"]?.ToString() ?? "";
                    string language = tpl["language"]?.ToString() ?? "en_US";

                    string bodyText = "";
                    var components = tpl["components"] as JArray;

                    if (components != null)
                    {
                        foreach (var comp in components)
                        {
                            if (comp["type"]?.ToString() == "BODY")
                            {
                                bodyText = comp["text"]?.ToString() ?? "";
                                break;
                            }
                        }
                    }

                    templates.Add(new
                    {
                        name,
                        language,
                        body = bodyText
                    });
                }

                return Ok(new { success = true, templates });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, error = ex.Message });
            }
        }

    }
}



``n
--- file: xbytechat-api/Features/WhatsAppIntegration/DTOs/WhatsAppTemplateDto.cs  (sha256:66133a62d929f35f6f56d4d6c3c9a872e14788627c9645fa41aa6eee13290993)
`$lang
namespace xbytechat.api.Features.WhatsAppIntegration.DTOs
{
    public class WhatsAppTemplateDto
    {
    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Controllers/LeadTimelineController.cs  (sha256:2bf2b77897c9f322069f976352984cc8a0a0d25514e1e411e2e2393e3ccba3f0)
`$lang
using Microsoft.AspNetCore.Mvc;
using Serilog;
using xbytechat.api.Features.xbTimeline.Services;
using xbytechat.api.Features.xbTimelines.DTOs;

namespace xbytechat.api.Features.xbTimelines.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class LeadTimelineController : ControllerBase
    {
        private readonly ILeadTimelineService _timelineService;

        public LeadTimelineController(ILeadTimelineService timelineService)
        {
            _timelineService = timelineService;
        }

        [HttpPost]
        public async Task<IActionResult> AddTimelineEntry([FromBody] LeadTimelineDto dto)
        {
            try
            {
                if (!ModelState.IsValid)
                    return BadRequest(ModelState);

                var result = await _timelineService.AddTimelineEntryAsync(dto);

                Log.Information("✅ Timeline entry created for ContactId: {ContactId}", dto.ContactId);

                return Ok(result);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to add timeline entry for ContactId: {ContactId}", dto.ContactId);
                throw;
            }
        }

        [HttpGet("contact/{contactId}")]
        public async Task<IActionResult> GetTimeline(Guid contactId)
        {
            try
            {
                var timeline = await _timelineService.GetTimelineByContactIdAsync(contactId);

                Log.Information("📄 Retrieved {Count} entries for ContactId: {ContactId}", timeline.Count, contactId);

                return Ok(timeline);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to get timeline for ContactId: {ContactId}", contactId);
                throw;
            }
        }

        [HttpGet]
        public async Task<IActionResult> GetAll()
        {
            var timelines = await _timelineService.GetAllTimelinesAsync();
            return Ok(timelines);
        }
    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/DTOs/CampaignTimelineLogDto.cs  (sha256:b279e39522b2d36effd77fe29c36653ca83b93c6cc9a1281d1ed6b3e596b96e3)
`$lang
public class CampaignTimelineLogDto
{
    public Guid ContactId { get; set; }
    public Guid BusinessId { get; set; }   // ✅ Needed for timeline insertion
    public Guid CampaignId { get; set; }
    public string CampaignName { get; set; } = string.Empty; // ✅ Safe default to avoid null issues
    public DateTime? Timestamp { get; set; } // optional
}


``n
--- file: xbytechat-api/Features/xbTimelines/DTOs/CRMTimelineLogDto.cs  (sha256:e6ce11c00e1130226359d24f7c9da23fe4fc68c6e725c5a449ed10a345378269)
`$lang
using System;

namespace xbytechat.api.Features.xbTimelines.DTOs
{
    public class CRMTimelineLogDto
    {
        public Guid ContactId { get; set; }
        public Guid BusinessId { get; set; }
        public string EventType { get; set; }  // 🧩 Example: "NoteAdded", "ReminderSet", "TagApplied"
        public string Description { get; set; }
        public Guid? ReferenceId { get; set; }  // 🆔 Related NoteId, ReminderId, TagId (optional)
        public string CreatedBy { get; set; }
        public string? Category { get; set; } = "CRM";  // 📂 Default category: CRM
        public DateTime? Timestamp { get; set; }  // ⏰ Custom time if needed (else CreatedAt = now)
    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/DTOs/LeadTimelineDto.cs  (sha256:b4692f6cebba16abcb7dc7450172517334a4832fce8e02d3c4273da2d001f2c8)
`$lang
using System;

namespace xbytechat.api.Features.xbTimelines.DTOs
{
    public class LeadTimelineDto
    {
        public Guid ContactId { get; set; }
        public string ContactName { get; set; } 
        public string ContactNumber { get; set; } 
        public string EventType { get; set; }
        public string Description { get; set; }
        public string? Data { get; set; }
        public Guid? ReferenceId { get; set; }
        public bool IsSystemGenerated { get; set; } = false;
        public string CreatedBy { get; set; }
        public string? Source { get; set; }
        public string? Category { get; set; }
        public DateTime CreatedAt { get; set; }

    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Mappers/LeadTimelineMapper.cs  (sha256:de301765ab3465a422c99453aab98cf7b40ec5177358642af08c2d5ec36ead4a)
`$lang
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.xbTimelines.Models;

namespace xbytechat.api.Features.xbTimelines.Mappers
{
    public static class LeadTimelineMapper
    {
        public static LeadTimelineDto ToDto(Models.LeadTimeline entry)
        {
            if (entry == null) return null;

            return new LeadTimelineDto
            {
                ContactId = entry.ContactId,
                ContactName = entry.Contact?.Name,                // ✅ Enriched from navigation
                ContactNumber = entry.Contact?.PhoneNumber,       // ✅ Enriched from navigation
                EventType = entry.EventType,
                Description = entry.Description,
                Data = entry.Data,
                ReferenceId = entry.ReferenceId,
                IsSystemGenerated = entry.IsSystemGenerated,
                CreatedBy = entry.CreatedBy,
                Source = entry.Source,
                Category = entry.Category,
                // ✅ CreatedAt is intentionally excluded from DTO
            };
        }

        // Optional for create/update, include only necessary fields
        public static Models.LeadTimeline ToModel(LeadTimelineDto dto)
        {
            if (dto == null) return null;

            return new Models.LeadTimeline
            {
                ContactId = dto.ContactId,
                EventType = dto.EventType,
                Description = dto.Description,
                Data = dto.Data,
                ReferenceId = dto.ReferenceId,
                IsSystemGenerated = dto.IsSystemGenerated,
                CreatedBy = dto.CreatedBy,
                Source = dto.Source,
                Category = dto.Category,
                CreatedAt = DateTime.UtcNow // ✅ Always use UTC when creating
            };
        }
    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Models/LeadTimeline.cs  (sha256:deaadfd25e7f565dc0456a66a61612baa9aea7a7dc297feca882d2108906413f)
`$lang
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.BusinessModule.Models;

namespace xbytechat.api.Features.xbTimelines.Models
{
    public class LeadTimeline
    {
        public int Id { get; set; }
        public Guid ContactId { get; set; }
        public Guid BusinessId { get; set; }
        public Business Business { get; set; }  // optional

        public Contact Contact { get; set; } // 🆕 Navigation property

        public string EventType { get; set; }

        public string Description { get; set; }
        public string? Data { get; set; }
        public Guid? ReferenceId { get; set; }           // ✅ New
        public bool IsSystemGenerated { get; set; } = false;  // ✅ New
        public string CreatedBy { get; set; }
        public string? Source { get; set; }
        public string? Category { get; set; }
        public DateTime CreatedAt { get; set; }

        public string? CTAType { get; set; } // e.g., "BuyNow", "PriceCheck", "ConfirmReminder"
        public string? CTASourceType { get; set; } // e.g., "catalog", "campaign", "reminder"
        public Guid? CTASourceId { get; set; } // ID of the source object (productId, reminderId)

    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Services/ILeadTimelineService.cs  (sha256:4bff375276ef500fcbd0288211c9a8438d983b063537b2995a6fc98a8eba1148)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.Features.Catalog.Models;
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.xbTimelines.Models;
using xbytechat.api.Helpers;

namespace xbytechat.api.Features.xbTimeline.Services
{
    public interface ILeadTimelineService
    {
        Task<LeadTimeline> AddTimelineEntryAsync(LeadTimelineDto dto);
        Task<List<LeadTimeline>> GetTimelineByContactIdAsync(Guid contactId);
        Task<List<LeadTimelineDto>> GetAllTimelinesAsync();
        Task AddFromCatalogClickAsync(CatalogClickLog log);
        Task<ResponseResult> LogCampaignSendAsync(CampaignTimelineLogDto dto);

    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Services/ITimelineService.cs  (sha256:3e8a236b7ce0a2af07bc27014910b7fbd77a83c78e8ceebe38c99bab96d183e4)
`$lang
using System.Threading.Tasks;
using xbytechat.api.Features.xbTimelines.DTOs;

namespace xbytechat.api.Features.xbTimelines.Services
{
    public interface ITimelineService
    {
        // Already existing methods...

        // 🆕 CRM related methods
        Task<bool> LogNoteAddedAsync(CRMTimelineLogDto dto);
        Task<bool> LogReminderSetAsync(CRMTimelineLogDto dto);
        Task<bool> LogTagAppliedAsync(CRMTimelineLogDto dto);
    }
}

``n
--- file: xbytechat-api/Features/xbTimelines/Services/LeadTimelineService.cs  (sha256:cf0715e549aeb3e6288ceb6cb82177dea0441d9953e64e6aca44f13ed2a19083)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using Serilog;
using xbytechat.api.Features.xbTimelines.Models;
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.Catalog.Models;
using static xbytechat.api.Features.BusinessModule.Models.Business;
using System.Text.Json;
using xbytechat.api.Helpers;
using xbytechat.api.Features.PlanManagement.Models;


namespace xbytechat.api.Features.xbTimeline.Services
{
    public class LeadTimelineService : ILeadTimelineService
    {
        private readonly AppDbContext _context;
       

        public LeadTimelineService(AppDbContext context )
        {
            _context = context;
        
        }

        public async Task<LeadTimeline> AddTimelineEntryAsync(LeadTimelineDto dto)
        {
            try
            {
                var entry = new LeadTimeline
                {
                    ContactId = dto.ContactId,
                    EventType = dto.EventType,
                    Description = dto.Description,
                    Data = dto.Data,
                    ReferenceId = dto.ReferenceId,
                    IsSystemGenerated = dto.IsSystemGenerated,
                    CreatedBy = dto.CreatedBy,
                    Source = dto.Source,
                    Category = dto.Category,
                    CreatedAt = DateTime.UtcNow
                };

                _context.LeadTimelines.Add(entry);
                await _context.SaveChangesAsync();

                Log.Information("✅ Timeline entry added for ContactId: {ContactId}", dto.ContactId);

                return entry;
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error adding timeline entry for ContactId: {ContactId}", dto.ContactId);
                throw; // Let global middleware handle this
            }
        }

        public async Task<List<LeadTimeline>> GetTimelineByContactIdAsync(Guid contactId)
        {
            try
            {
                var results = await _context.LeadTimelines
                    .Where(x => x.ContactId == contactId)
                    .OrderByDescending(x => x.CreatedAt)
                    .ToListAsync();

                Log.Information("📄 Fetched {Count} timeline entries for ContactId: {ContactId}", results.Count, contactId);

                return results;
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to fetch timeline for ContactId: {ContactId}", contactId);
                throw;
            }
        }

        public async Task<List<LeadTimelineDto>> GetAllTimelinesAsync()
        {
            try
            {
                var entries = await _context.LeadTimelines
                    .Include(t => t.Contact) // for Contact Name/Phone
                    .OrderByDescending(e => e.CreatedAt)
                    .ToListAsync();

                var dtoList = entries.Select(entry => new LeadTimelineDto
                {
                    ContactId = entry.ContactId,
                    EventType = entry.EventType,
                    Description = entry.Description,
                    Data = entry.Data,
                    ReferenceId = entry.ReferenceId,
                    CreatedAt = entry.CreatedAt,
                    CreatedBy = entry.CreatedBy,
                    Source = entry.Source,
                    Category = entry.Category,
                    IsSystemGenerated = entry.IsSystemGenerated,
                    ContactName = entry.Contact?.Name,
                    ContactNumber = entry.Contact?.PhoneNumber
                }).ToList();

                Log.Information("📄 Loaded {Count} total timeline entries", dtoList.Count);
                return dtoList;
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Failed to fetch all timeline entries");
                throw;
            }
        }
        public async Task AddFromCatalogClickAsync(CatalogClickLog log)
        {
            if (log == null)
            {
                Log.Warning("CatalogClickLog is null. Skipping timeline creation.");
                return;
            }

            try
            {
                var business = await _context.Businesses
                    .AsNoTracking()
                    .FirstOrDefaultAsync(b => b.Id == log.BusinessId);

                if (business == null)
                {
                    Log.Warning("Business not found for ID: {BusinessId}. Skipping timeline creation.", log.BusinessId);
                    return;
                }

                // if (business.Plan == PlanType.Advanced)
                if (business?.BusinessPlanInfo?.Plan == PlanType.Advanced)
                {
                    Log.Information("Timeline skipped for Basic Plan - BusinessId: {BusinessId}", business.Id);
                    return;
                }


                var description = $"{log.ProductBrowsed} | {log.CTAJourney}";

                var timelineEntry = new LeadTimeline
                {
                    BusinessId = log.BusinessId,
                    ContactId = log.ContactId ?? Guid.Empty,
                    EventType = "CatalogCTA",
                    Description = description,
                    Data = JsonSerializer.Serialize(log),
                    ReferenceId = null,
                    CreatedBy = "system",
                    IsSystemGenerated = true,
                    Source = "Catalog",
                    Category = log.CategoryBrowsed,
                    CreatedAt = DateTime.UtcNow
                };

                _context.LeadTimelines.Add(timelineEntry);
                await _context.SaveChangesAsync();

                Log.Information("📈 Timeline entry created from CatalogClick for UserId: {UserId}", log.UserId);
            }
            catch (Exception ex)
            {
                Log.Error(ex, "❌ Error creating timeline entry from CatalogClick for UserId: {UserId}", log.UserId);
                // Safe swallow
            }
        }

        public async Task<ResponseResult> LogCampaignSendAsync(CampaignTimelineLogDto dto)
        {
            try
            {
                var timeline = new LeadTimeline
                {
                    ContactId = dto.ContactId,
                    BusinessId = dto.BusinessId,
                    EventType = "CampaignSend",
                    Description = $"Campaign '{dto.CampaignName}' was sent.", // ✅ Timeline me readable text
                    ReferenceId = dto.CampaignId, // ✅ Linking to campaign record
                    IsSystemGenerated = false,    // ✅ Default (campaign sending is manual action)
                    CreatedBy = "system",         // ✅ Or actual user email if needed later
                    Source = "CampaignModule",    // ✅ Source field for clarity
                    Category = "Messaging",       // ✅ Logical grouping
                    CreatedAt = dto.Timestamp ?? DateTime.UtcNow // ✅ Use given Timestamp or fallback to now
                };

                _context.LeadTimelines.Add(timeline);
                await _context.SaveChangesAsync();

                return ResponseResult.SuccessInfo("✅ Campaign send event logged into timeline.");
            }
            catch (Exception ex)
            {
                return ResponseResult.ErrorInfo("❌ Failed to log campaign send event: " + ex.Message);
            }
        }


    }


}


``n
--- file: xbytechat-api/Features/xbTimelines/Services/TimelineService.cs  (sha256:34982b110dddb7a0afcac7582aa0c8dfc2d85810317956df389aaf17bd1a0a1f)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat.api.Features.xbTimelines.DTOs;
using xbytechat.api.Features.xbTimelines.Models;

namespace xbytechat.api.Features.xbTimelines.Services
{
    public class TimelineService : ITimelineService
    {
        private readonly AppDbContext _context;

        public TimelineService(AppDbContext context)
        {
            _context = context;
        }

        // 🧩 Log Note Added into Timeline
        public async Task<bool> LogNoteAddedAsync(CRMTimelineLogDto dto)
        {
            try
            {
                var timeline = new LeadTimeline
                {
                    ContactId = dto.ContactId,
                    BusinessId = dto.BusinessId,
                    EventType = "NoteAdded",
                    Description = dto.Description,
                    ReferenceId = dto.ReferenceId,
                    CreatedBy = dto.CreatedBy,
                    Source = "CRM",
                    Category = dto.Category ?? "CRM",
                    CreatedAt = dto.Timestamp ?? DateTime.UtcNow,
                    IsSystemGenerated = false
                };

                _context.LeadTimelines.Add(timeline);
                await _context.SaveChangesAsync();
                return true;
            }
            catch
            {
                return false;
            }
        }

        // ⏰ Log Reminder Set into Timeline
        public async Task<bool> LogReminderSetAsync(CRMTimelineLogDto dto)
        {
            try
            {
                var timeline = new LeadTimeline
                {
                    ContactId = dto.ContactId,
                    BusinessId = dto.BusinessId,
                    EventType = "ReminderSet",
                    Description = dto.Description,
                    ReferenceId = dto.ReferenceId,
                    CreatedBy = dto.CreatedBy,
                    Source = "CRM",
                    Category = dto.Category ?? "CRM",
                    CreatedAt = dto.Timestamp ?? DateTime.UtcNow,
                    IsSystemGenerated = false
                };

                _context.LeadTimelines.Add(timeline);
                await _context.SaveChangesAsync();
                return true;
            }
            catch
            {
                return false;
            }
        }

        // 🏷️ Log Tag Applied into Timeline
        public async Task<bool> LogTagAppliedAsync(CRMTimelineLogDto dto)
        {
            try
            {
                var timeline = new LeadTimeline
                {
                    ContactId = dto.ContactId,
                    BusinessId = dto.BusinessId,
                    EventType = "TagApplied",
                    Description = dto.Description,
                    ReferenceId = dto.ReferenceId,
                    CreatedBy = dto.CreatedBy,
                    Source = "CRM",
                    Category = dto.Category ?? "CRM",
                    CreatedAt = dto.Timestamp ?? DateTime.UtcNow,
                    IsSystemGenerated = false
                };

                _context.LeadTimelines.Add(timeline);
                await _context.SaveChangesAsync();
                return true;
            }
            catch
            {
                return false;
            }
        }
    }
}

``n
--- file: xbytechat-api/Middlewares/GlobalExceptionMiddleware.cs  (sha256:81f92c798910995fdc5e81622269bc30f14971bf74da00e5b27af3bfe4a04a79)
`$lang
using System.Net;
using Serilog;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.Extensions.Logging;
using Microsoft.AspNetCore.Hosting;

public class GlobalExceptionMiddleware
{
    private readonly RequestDelegate _next;
    private readonly ILogger<GlobalExceptionMiddleware> _logger;
    private readonly IWebHostEnvironment _env;

    public GlobalExceptionMiddleware(RequestDelegate next, ILogger<GlobalExceptionMiddleware> logger, IWebHostEnvironment env)
    {
        _next = next;
        _logger = logger;
        _env = env;
    }
    public class ErrorResponse
    {
        public int StatusCode { get; set; }
        public string Message { get; set; }
        public string? StackTrace { get; set; }
        public string Path { get; set; }
    }

    public async Task Invoke(HttpContext context)
    {
        try
        {
            await _next(context);
        }
        catch (Exception ex)
        {
            Log.Error(ex, "❌ An unhandled exception occurred");

            // 🚩 Prevent double-write/headers-already-sent error!
            if (context.Response.HasStarted)
            {
                _logger.LogError("Response has already started, unable to write error response for path: {Path}", context.Request.Path);
                return;
            }

            context.Response.ContentType = "application/json";
            context.Response.StatusCode = (int)HttpStatusCode.InternalServerError;

            var response = new ErrorResponse
            {
                StatusCode = context.Response.StatusCode,
                Message = ex.Message,
                StackTrace = _env.IsDevelopment() ? ex.StackTrace : null,
                Path = context.Request.Path
            };
            await context.Response.WriteAsJsonAsync(response);
        }
    }
}


//using System.Net;
//using Serilog;
//using System.Net;
//using System.Threading.Tasks;
//using Microsoft.AspNetCore.Http;
//using Microsoft.Extensions.Logging;
//using Microsoft.AspNetCore.Hosting;

//public class GlobalExceptionMiddleware
//{
//    private readonly RequestDelegate _next;
//    private readonly ILogger<GlobalExceptionMiddleware> _logger;
//    private readonly IWebHostEnvironment _env;

//    public GlobalExceptionMiddleware(RequestDelegate next, ILogger<GlobalExceptionMiddleware> logger, IWebHostEnvironment env)
//    {
//        _next = next;
//        _logger = logger;
//        _env = env;
//    }
//    public class ErrorResponse
//    {
//        public int StatusCode { get; set; }
//        public string Message { get; set; }
//        public string? StackTrace { get; set; }
//        public string Path { get; set; }
//    }

//    public async Task Invoke(HttpContext context)
//    {
//        try
//        {
//            await _next(context);
//        }
//        catch (Exception ex)
//        {
//            Log.Error(ex, "❌ An unhandled exception occurred");

//            context.Response.ContentType = "application/json";
//            context.Response.StatusCode = (int)HttpStatusCode.InternalServerError;

//            var response = new ErrorResponse
//            {
//                StatusCode = context.Response.StatusCode,
//                Message = ex.Message,
//                StackTrace = _env.IsDevelopment() ? ex.StackTrace : null,
//                Path = context.Request.Path
//            };
//            await context.Response.WriteAsJsonAsync(response);
//        }
//    }

//}

``n
--- file: xbytechat-api/Middlewares/JwtErrorHandlingMiddleware.cs  (sha256:d35104606ec5c8b08c106f2499d4962349d1c9c99465f0772fe1a92366cdcfac)
`$lang
using Microsoft.AspNetCore.Http;
using System.Net;
using System.Text.Json;
using Microsoft.IdentityModel.Tokens;

namespace xbytechat.api.Middlewares
{
    public class JwtErrorHandlingMiddleware
    {
        private readonly RequestDelegate _next;

        public JwtErrorHandlingMiddleware(RequestDelegate next)
        {
            _next = next;
        }

        public async Task Invoke(HttpContext context)
        {
            try
            {
                await _next(context); // Proceed to next middleware
            }
            catch (SecurityTokenExpiredException)
            {
                context.Response.StatusCode = (int)HttpStatusCode.Unauthorized;
                context.Response.ContentType = "application/json";

                var response = new
                {
                    success = false,
                    message = "❌ Token expired. Please login again."
                };

                await context.Response.WriteAsync(JsonSerializer.Serialize(response));
            }
            catch (SecurityTokenException ex)
            {
                context.Response.StatusCode = (int)HttpStatusCode.Unauthorized;
                context.Response.ContentType = "application/json";

                var response = new
                {
                    success = false,
                    message = $"❌ Token invalid: {ex.Message}"
                };

                await context.Response.WriteAsync(JsonSerializer.Serialize(response));
            }
            catch (Exception)
            {
                // Pass unhandled exceptions to global exception middleware
                throw;
            }
        }
    }

    // Extension method for clean registration
    public static class JwtErrorHandlingMiddlewareExtensions
    {
        public static IApplicationBuilder UseJwtErrorHandling(this IApplicationBuilder builder)
        {
            return builder.UseMiddleware<JwtErrorHandlingMiddleware>();
        }
    }
}

``n
--- file: xbytechat-api/Middlewares/RequirePermissionAttribute.cs  (sha256:a6d3aaceba78295b73d29b3f7b0c72837f08e7f8cb0004a15f1f77f1066dc3c2)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using System;
using System.Linq;
using System.Security.Claims;

namespace xbytechat.api.Middleware.Attributes
{
    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, AllowMultiple = true)]
    public class RequirePermissionAttribute : Attribute, IAuthorizationFilter
    {
        private readonly string _requiredPermission;

        public RequirePermissionAttribute(string requiredPermission)
        {
            _requiredPermission = requiredPermission;
        }

        public void OnAuthorization(AuthorizationFilterContext context)
        {
            var user = context.HttpContext.User;

            if (!user.Identity.IsAuthenticated)
            {
                context.Result = new UnauthorizedResult();
                return;
            }

            var permissionsClaim = user.Claims.FirstOrDefault(c => c.Type == "permissions")?.Value;

            if (permissionsClaim == null || !permissionsClaim.Split(',').Contains(_requiredPermission))
            {
                context.Result = new ForbidResult();
            }
        }
    }
}


``n
--- file: xbytechat-api/Middlewares/RequirePlanAttribute.cs  (sha256:3e7d8fc23618708b9d4ae5351012eb53f013b2ab0f579426c3d4c9091ed06251)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using System;
using System.Linq;

namespace xbytechat.api.Middlewares
{
    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, AllowMultiple = true)]
    public class RequirePlanAttribute : Attribute, IAuthorizationFilter
    {
        private readonly string[] _allowedPlans;

        public RequirePlanAttribute(params string[] allowedPlans)
        {
            _allowedPlans = allowedPlans;
        }

        public void OnAuthorization(AuthorizationFilterContext context)
        {
            var plan = context.HttpContext.User.FindFirst("plan")?.Value?.ToLowerInvariant();
            if (string.IsNullOrEmpty(plan) || !_allowedPlans.Any(p => p.ToLowerInvariant() == plan))
            {
                context.Result = new ForbidResult(); // 403 Forbidden
            }
        }
    }
}

``n
--- file: xbytechat-api/Middlewares/RequireRoleAttribute.cs  (sha256:b8ca70695e176a36191713cb6b179e1f5097d9077227a77b8658f86392b98b6b)
`$lang
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using System;
using System.Linq;

namespace xbytechat.api.Middlewares
{
    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, AllowMultiple = true)]
    public class RequireRoleAttribute : Attribute, IAuthorizationFilter
    {
        private readonly string[] _roles;

        public RequireRoleAttribute(params string[] roles)
        {
            _roles = roles;
        }

        public void OnAuthorization(AuthorizationFilterContext context)
        {
            var role = context.HttpContext.User.FindFirst("role")?.Value?.ToLowerInvariant();
            if (string.IsNullOrEmpty(role) || !_roles.Any(r => r.ToLowerInvariant() == role))
            {
                context.Result = new ForbidResult(); // 403 Forbidden
            }
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250617162332_Initial.cs  (sha256:7998b36675fd84a0f596d341050d3e4761c48c8480a617364e4471ef8056378f)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class Initial : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "AuditLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    PerformedByUserId = table.Column<Guid>(type: "uuid", nullable: false),
                    PerformedByUserName = table.Column<string>(type: "text", nullable: true),
                    RoleAtTime = table.Column<string>(type: "text", nullable: true),
                    ActionType = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    IPAddress = table.Column<string>(type: "text", nullable: true),
                    UserAgent = table.Column<string>(type: "text", nullable: true),
                    Location = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AuditLogs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "AutoReplyFlows",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    NodesJson = table.Column<string>(type: "text", nullable: false),
                    EdgesJson = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    TriggerKeyword = table.Column<string>(type: "text", nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutoReplyFlows", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "AutoReplyLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    TriggerKeyword = table.Column<string>(type: "text", nullable: false),
                    TriggerType = table.Column<string>(type: "text", nullable: false),
                    ReplyContent = table.Column<string>(type: "text", nullable: false),
                    FlowName = table.Column<string>(type: "text", nullable: true),
                    MessageLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    TriggeredAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutoReplyLogs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Businesses",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    CompanyName = table.Column<string>(type: "text", nullable: true),
                    BusinessName = table.Column<string>(type: "text", nullable: false),
                    BusinessEmail = table.Column<string>(type: "text", nullable: false),
                    RepresentativeName = table.Column<string>(type: "text", nullable: true),
                    CreatedByPartnerId = table.Column<Guid>(type: "uuid", nullable: true),
                    Phone = table.Column<string>(type: "text", nullable: true),
                    CompanyPhone = table.Column<string>(type: "text", nullable: true),
                    Website = table.Column<string>(type: "text", nullable: true),
                    Address = table.Column<string>(type: "text", nullable: true),
                    Industry = table.Column<string>(type: "text", nullable: true),
                    LogoUrl = table.Column<string>(type: "text", nullable: true),
                    Status = table.Column<int>(type: "integer", nullable: false),
                    Tags = table.Column<string>(type: "text", nullable: true),
                    Source = table.Column<string>(type: "text", nullable: true),
                    Notes = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: true),
                    IsApproved = table.Column<bool>(type: "boolean", nullable: false),
                    ApprovedBy = table.Column<string>(type: "text", nullable: true),
                    ApprovedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    LastLoginAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    IsDeleted = table.Column<bool>(type: "boolean", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    DeletedBy = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Businesses", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "CatalogClickLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ProductId = table.Column<Guid>(type: "uuid", nullable: true),
                    UserId = table.Column<string>(type: "text", nullable: true),
                    UserName = table.Column<string>(type: "text", nullable: true),
                    UserPhone = table.Column<string>(type: "text", nullable: true),
                    BotId = table.Column<string>(type: "text", nullable: true),
                    CategoryBrowsed = table.Column<string>(type: "text", nullable: true),
                    ProductBrowsed = table.Column<string>(type: "text", nullable: true),
                    CTAJourney = table.Column<string>(type: "text", nullable: true),
                    TemplateId = table.Column<string>(type: "text", nullable: false),
                    RefMessageId = table.Column<string>(type: "text", nullable: false),
                    ButtonText = table.Column<string>(type: "text", nullable: false),
                    ClickedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    CampaignSendLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: true),
                    FollowUpSent = table.Column<bool>(type: "boolean", nullable: false),
                    LastInteractionType = table.Column<string>(type: "text", nullable: true),
                    MessageLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    PlanSnapshot = table.Column<string>(type: "text", nullable: true),
                    CtaId = table.Column<Guid>(type: "uuid", nullable: true),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    Source = table.Column<string>(type: "text", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CatalogClickLogs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ChatSessionStates",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    Mode = table.Column<string>(type: "text", nullable: false),
                    LastUpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedBy = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ChatSessionStates", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ContactReads",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    UserId = table.Column<Guid>(type: "uuid", nullable: false),
                    LastReadAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ContactReads", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "CTADefinitions",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Title = table.Column<string>(type: "text", nullable: false),
                    ButtonText = table.Column<string>(type: "text", nullable: false),
                    ButtonType = table.Column<string>(type: "text", nullable: false),
                    TargetUrl = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CTADefinitions", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "CTAFlowConfigs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    FlowName = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    IsPublished = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: true),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CTAFlowConfigs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "FailedWebhookLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ErrorMessage = table.Column<string>(type: "text", nullable: true),
                    SourceModule = table.Column<string>(type: "text", nullable: true),
                    FailureType = table.Column<string>(type: "text", nullable: true),
                    RawJson = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FailedWebhookLogs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "FlowExecutionLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    StepId = table.Column<Guid>(type: "uuid", nullable: false),
                    StepName = table.Column<string>(type: "text", nullable: false),
                    FlowId = table.Column<Guid>(type: "uuid", nullable: true),
                    TrackingLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    ContactPhone = table.Column<string>(type: "text", nullable: true),
                    TriggeredByButton = table.Column<string>(type: "text", nullable: true),
                    TemplateName = table.Column<string>(type: "text", nullable: true),
                    TemplateType = table.Column<string>(type: "text", nullable: true),
                    Success = table.Column<bool>(type: "boolean", nullable: false),
                    ErrorMessage = table.Column<string>(type: "text", nullable: true),
                    RawResponse = table.Column<string>(type: "text", nullable: true),
                    ExecutedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FlowExecutionLogs", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Notes",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: true),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: true),
                    Title = table.Column<string>(type: "text", nullable: false),
                    Content = table.Column<string>(type: "text", nullable: false),
                    Source = table.Column<string>(type: "text", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: false),
                    IsPinned = table.Column<bool>(type: "boolean", nullable: false),
                    IsInternal = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    EditedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Notes", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Permissions",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    Code = table.Column<string>(type: "text", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Group = table.Column<string>(type: "text", nullable: true),
                    Description = table.Column<string>(type: "text", nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Permissions", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Products",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: false),
                    Price = table.Column<decimal>(type: "numeric", nullable: false),
                    Currency = table.Column<string>(type: "text", nullable: false),
                    ImageUrl = table.Column<string>(type: "text", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    TotalClicks = table.Column<int>(type: "integer", nullable: false),
                    LastClickedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    MostClickedCTA = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Products", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Reminders",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    Title = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    DueAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    Status = table.Column<string>(type: "text", nullable: false),
                    ReminderType = table.Column<string>(type: "text", nullable: true),
                    Priority = table.Column<int>(type: "integer", nullable: true),
                    IsRecurring = table.Column<bool>(type: "boolean", nullable: false),
                    RecurrencePattern = table.Column<string>(type: "text", nullable: true),
                    SendWhatsappNotification = table.Column<bool>(type: "boolean", nullable: false),
                    LinkedCampaign = table.Column<string>(type: "text", nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    CompletedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    LastCTAType = table.Column<string>(type: "text", nullable: true),
                    LastClickedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    FollowUpSent = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Reminders", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Roles",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    IsSystemDefined = table.Column<bool>(type: "boolean", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Roles", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Tags",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    ColorHex = table.Column<string>(type: "text", nullable: true),
                    Category = table.Column<string>(type: "text", nullable: true),
                    Notes = table.Column<string>(type: "text", nullable: true),
                    IsSystemTag = table.Column<bool>(type: "boolean", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    LastUsedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Tags", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "WebhookSettings",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    AutoCleanupEnabled = table.Column<bool>(type: "boolean", nullable: false),
                    LastCleanupAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_WebhookSettings", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "AutoReplyFlowEdges",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    FlowId = table.Column<Guid>(type: "uuid", nullable: false),
                    SourceNodeId = table.Column<string>(type: "text", nullable: false),
                    TargetNodeId = table.Column<string>(type: "text", nullable: false),
                    SourceHandle = table.Column<string>(type: "text", nullable: true),
                    TargetHandle = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutoReplyFlowEdges", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AutoReplyFlowEdges_AutoReplyFlows_FlowId",
                        column: x => x.FlowId,
                        principalTable: "AutoReplyFlows",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AutoReplyFlowNodes",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    FlowId = table.Column<Guid>(type: "uuid", nullable: false),
                    NodeType = table.Column<string>(type: "text", nullable: false),
                    Label = table.Column<string>(type: "text", nullable: false),
                    ConfigJson = table.Column<string>(type: "text", nullable: false),
                    Position_X = table.Column<double>(type: "double precision", nullable: false),
                    Position_Y = table.Column<double>(type: "double precision", nullable: false),
                    Order = table.Column<int>(type: "integer", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutoReplyFlowNodes", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AutoReplyFlowNodes_AutoReplyFlows_FlowId",
                        column: x => x.FlowId,
                        principalTable: "AutoReplyFlows",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "AutoReplyRules",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    TriggerKeyword = table.Column<string>(type: "text", nullable: false),
                    ReplyMessage = table.Column<string>(type: "text", nullable: false),
                    MediaUrl = table.Column<string>(type: "text", nullable: true),
                    Priority = table.Column<int>(type: "integer", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    FlowName = table.Column<string>(type: "text", nullable: true),
                    FlowId = table.Column<Guid>(type: "uuid", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutoReplyRules", x => x.Id);
                    table.ForeignKey(
                        name: "FK_AutoReplyRules_AutoReplyFlows_FlowId",
                        column: x => x.FlowId,
                        principalTable: "AutoReplyFlows",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "BusinessPlanInfos",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Plan = table.Column<int>(type: "integer", nullable: false),
                    TotalMonthlyQuota = table.Column<int>(type: "integer", nullable: false),
                    RemainingMessages = table.Column<int>(type: "integer", nullable: false),
                    QuotaResetDate = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    WalletBalance = table.Column<decimal>(type: "numeric", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_BusinessPlanInfos", x => x.Id);
                    table.ForeignKey(
                        name: "FK_BusinessPlanInfos_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Contacts",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: false),
                    PhoneNumber = table.Column<string>(type: "character varying(20)", maxLength: 20, nullable: false),
                    Email = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: true),
                    LeadSource = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: true),
                    Tags = table.Column<string>(type: "character varying(200)", maxLength: 200, nullable: true),
                    LastContactedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    NextFollowUpAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    Notes = table.Column<string>(type: "character varying(500)", maxLength: 500, nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    LastCTAInteraction = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    LastCTAType = table.Column<string>(type: "text", nullable: true),
                    LastClickedProductId = table.Column<Guid>(type: "uuid", nullable: true),
                    IsAutomationPaused = table.Column<bool>(type: "boolean", nullable: false),
                    AssignedAgentId = table.Column<Guid>(type: "uuid", nullable: true),
                    IsFavorite = table.Column<bool>(type: "boolean", nullable: false),
                    IsArchived = table.Column<bool>(type: "boolean", nullable: false),
                    Group = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Contacts", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Contacts_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "WhatsAppSettings",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ApiUrl = table.Column<string>(type: "character varying(500)", maxLength: 500, nullable: false),
                    ApiToken = table.Column<string>(type: "character varying(1000)", maxLength: 1000, nullable: false),
                    WhatsAppBusinessNumber = table.Column<string>(type: "character varying(20)", maxLength: 20, nullable: false),
                    PhoneNumberId = table.Column<string>(type: "text", nullable: true),
                    WabaId = table.Column<string>(type: "text", nullable: true),
                    SenderDisplayName = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_WhatsAppSettings", x => x.Id);
                    table.ForeignKey(
                        name: "FK_WhatsAppSettings_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Campaigns",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    SourceCampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    Name = table.Column<string>(type: "text", nullable: false),
                    MessageTemplate = table.Column<string>(type: "text", nullable: false),
                    TemplateId = table.Column<string>(type: "text", nullable: true),
                    MessageBody = table.Column<string>(type: "text", nullable: true),
                    FollowUpTemplateId = table.Column<string>(type: "text", nullable: true),
                    CampaignType = table.Column<string>(type: "text", nullable: true),
                    CtaId = table.Column<Guid>(type: "uuid", nullable: true),
                    ScheduledAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    Status = table.Column<string>(type: "text", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    IsDeleted = table.Column<bool>(type: "boolean", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    DeletedBy = table.Column<string>(type: "text", nullable: true),
                    ImageUrl = table.Column<string>(type: "text", nullable: true),
                    ImageCaption = table.Column<string>(type: "text", nullable: true),
                    TemplateParameters = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Campaigns", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Campaigns_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Campaigns_CTADefinitions_CtaId",
                        column: x => x.CtaId,
                        principalTable: "CTADefinitions",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Campaigns_Campaigns_SourceCampaignId",
                        column: x => x.SourceCampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "CTAFlowSteps",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    CTAFlowConfigId = table.Column<Guid>(type: "uuid", nullable: false),
                    TriggerButtonText = table.Column<string>(type: "text", nullable: false),
                    TriggerButtonType = table.Column<string>(type: "text", nullable: false),
                    TemplateToSend = table.Column<string>(type: "text", nullable: false),
                    StepOrder = table.Column<int>(type: "integer", nullable: false),
                    RequiredTag = table.Column<string>(type: "text", nullable: true),
                    RequiredSource = table.Column<string>(type: "text", nullable: true),
                    PositionX = table.Column<float>(type: "real", nullable: true),
                    PositionY = table.Column<float>(type: "real", nullable: true),
                    TemplateType = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CTAFlowSteps", x => x.Id);
                    table.ForeignKey(
                        name: "FK_CTAFlowSteps_CTAFlowConfigs_CTAFlowConfigId",
                        column: x => x.CTAFlowConfigId,
                        principalTable: "CTAFlowConfigs",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "RolePermissions",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    RoleId = table.Column<Guid>(type: "uuid", nullable: false),
                    PermissionId = table.Column<Guid>(type: "uuid", nullable: false),
                    AssignedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    AssignedBy = table.Column<string>(type: "text", nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    IsRevoked = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_RolePermissions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_RolePermissions_Permissions_PermissionId",
                        column: x => x.PermissionId,
                        principalTable: "Permissions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_RolePermissions_Roles_RoleId",
                        column: x => x.RoleId,
                        principalTable: "Roles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Users",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: true),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Email = table.Column<string>(type: "text", nullable: false),
                    PasswordHash = table.Column<string>(type: "text", nullable: false),
                    RoleId = table.Column<Guid>(type: "uuid", nullable: true),
                    Status = table.Column<string>(type: "text", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    IsDeleted = table.Column<bool>(type: "boolean", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Users", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Users_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Users_Roles_RoleId",
                        column: x => x.RoleId,
                        principalTable: "Roles",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "ContactTags",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    TagId = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    AssignedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    AssignedBy = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ContactTags", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ContactTags_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_ContactTags_Tags_TagId",
                        column: x => x.TagId,
                        principalTable: "Tags",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "LeadTimelines",
                columns: table => new
                {
                    Id = table.Column<int>(type: "integer", nullable: false)
                        .Annotation("Npgsql:ValueGenerationStrategy", NpgsqlValueGenerationStrategy.IdentityByDefaultColumn),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    EventType = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: false),
                    Data = table.Column<string>(type: "text", nullable: true),
                    ReferenceId = table.Column<Guid>(type: "uuid", nullable: true),
                    IsSystemGenerated = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: false),
                    Source = table.Column<string>(type: "text", nullable: true),
                    Category = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    CTAType = table.Column<string>(type: "text", nullable: true),
                    CTASourceType = table.Column<string>(type: "text", nullable: true),
                    CTASourceId = table.Column<Guid>(type: "uuid", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_LeadTimelines", x => x.Id);
                    table.ForeignKey(
                        name: "FK_LeadTimelines_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_LeadTimelines_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "CampaignButtons",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: false),
                    Title = table.Column<string>(type: "text", nullable: false),
                    Type = table.Column<string>(type: "text", nullable: false),
                    Value = table.Column<string>(type: "text", nullable: false),
                    Position = table.Column<int>(type: "integer", nullable: false),
                    IsFromTemplate = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CampaignButtons", x => x.Id);
                    table.ForeignKey(
                        name: "FK_CampaignButtons_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "CampaignFlowOverrides",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: false),
                    TemplateName = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: false),
                    ButtonText = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: false),
                    OverrideNextTemplate = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CampaignFlowOverrides", x => x.Id);
                    table.ForeignKey(
                        name: "FK_CampaignFlowOverrides_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "CampaignRecipients",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    Status = table.Column<string>(type: "text", nullable: false),
                    SentAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    BotId = table.Column<string>(type: "text", nullable: true),
                    MessagePreview = table.Column<string>(type: "text", nullable: true),
                    ClickedCTA = table.Column<string>(type: "text", nullable: true),
                    CategoryBrowsed = table.Column<string>(type: "text", nullable: true),
                    ProductBrowsed = table.Column<string>(type: "text", nullable: true),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    IsAutoTagged = table.Column<bool>(type: "boolean", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CampaignRecipients", x => x.Id);
                    table.ForeignKey(
                        name: "FK_CampaignRecipients_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_CampaignRecipients_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_CampaignRecipients_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "MessageLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    MessageId = table.Column<string>(type: "text", nullable: true),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    RecipientNumber = table.Column<string>(type: "text", nullable: false),
                    MessageContent = table.Column<string>(type: "text", nullable: false),
                    MediaUrl = table.Column<string>(type: "text", nullable: true),
                    Status = table.Column<string>(type: "text", nullable: false),
                    ErrorMessage = table.Column<string>(type: "text", nullable: true),
                    RawResponse = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    SentAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: true),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    CTAFlowConfigId = table.Column<Guid>(type: "uuid", nullable: true),
                    CTAFlowStepId = table.Column<Guid>(type: "uuid", nullable: true),
                    IsIncoming = table.Column<bool>(type: "boolean", nullable: false),
                    RenderedBody = table.Column<string>(type: "text", nullable: true),
                    RefMessageId = table.Column<Guid>(type: "uuid", nullable: true),
                    Source = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_MessageLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_MessageLogs_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_MessageLogs_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_MessageLogs_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "FlowButtonLinks",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    ButtonText = table.Column<string>(type: "text", nullable: false),
                    NextStepId = table.Column<Guid>(type: "uuid", nullable: true),
                    ButtonType = table.Column<string>(type: "text", nullable: false),
                    ButtonSubType = table.Column<string>(type: "text", nullable: false),
                    ButtonValue = table.Column<string>(type: "text", nullable: false),
                    CTAFlowStepId = table.Column<Guid>(type: "uuid", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FlowButtonLinks", x => x.Id);
                    table.ForeignKey(
                        name: "FK_FlowButtonLinks_CTAFlowSteps_CTAFlowStepId",
                        column: x => x.CTAFlowStepId,
                        principalTable: "CTAFlowSteps",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "MessageStatusLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    RecipientNumber = table.Column<string>(type: "text", nullable: false),
                    CustomerProfileName = table.Column<string>(type: "text", nullable: true),
                    MessageId = table.Column<string>(type: "text", nullable: true),
                    Status = table.Column<string>(type: "text", nullable: false),
                    MessageType = table.Column<string>(type: "text", nullable: false),
                    TemplateName = table.Column<string>(type: "text", nullable: true),
                    TemplateCategory = table.Column<string>(type: "text", nullable: true),
                    Channel = table.Column<string>(type: "text", nullable: false),
                    IsSessionOpen = table.Column<bool>(type: "boolean", nullable: false),
                    MetaTimestamp = table.Column<long>(type: "bigint", nullable: true),
                    SentAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    DeliveredAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    ReadAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    ErrorMessage = table.Column<string>(type: "text", nullable: true),
                    ErrorCode = table.Column<int>(type: "integer", nullable: true),
                    RawPayload = table.Column<string>(type: "text", nullable: true),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: true),
                    UserId = table.Column<Guid>(type: "uuid", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_MessageStatusLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_MessageStatusLogs_Businesses_BusinessId",
                        column: x => x.BusinessId,
                        principalTable: "Businesses",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_MessageStatusLogs_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_MessageStatusLogs_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "UserPermissions",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    UserId = table.Column<Guid>(type: "uuid", nullable: false),
                    PermissionId = table.Column<Guid>(type: "uuid", nullable: false),
                    IsGranted = table.Column<bool>(type: "boolean", nullable: false),
                    AssignedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    AssignedBy = table.Column<string>(type: "text", nullable: true),
                    IsRevoked = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_UserPermissions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_UserPermissions_Permissions_PermissionId",
                        column: x => x.PermissionId,
                        principalTable: "Permissions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_UserPermissions_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "CampaignSendLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    MessageId = table.Column<string>(type: "text", nullable: true),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: false),
                    RecipientId = table.Column<Guid>(type: "uuid", nullable: false),
                    MessageBody = table.Column<string>(type: "text", nullable: false),
                    TemplateId = table.Column<string>(type: "text", nullable: true),
                    SendStatus = table.Column<string>(type: "text", nullable: true),
                    ErrorMessage = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    CreatedBy = table.Column<string>(type: "text", nullable: true),
                    SentAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    DeliveredAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    ReadAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    IpAddress = table.Column<string>(type: "text", nullable: true),
                    DeviceInfo = table.Column<string>(type: "text", nullable: true),
                    MacAddress = table.Column<string>(type: "text", nullable: true),
                    SourceChannel = table.Column<string>(type: "text", nullable: true),
                    DeviceType = table.Column<string>(type: "text", nullable: true),
                    Browser = table.Column<string>(type: "text", nullable: true),
                    Country = table.Column<string>(type: "text", nullable: true),
                    City = table.Column<string>(type: "text", nullable: true),
                    IsClicked = table.Column<bool>(type: "boolean", nullable: false),
                    ClickedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    ClickType = table.Column<string>(type: "text", nullable: true),
                    RetryCount = table.Column<int>(type: "integer", nullable: false),
                    LastRetryAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: true),
                    LastRetryStatus = table.Column<string>(type: "text", nullable: true),
                    AllowRetry = table.Column<bool>(type: "boolean", nullable: false),
                    MessageLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    UserId = table.Column<Guid>(type: "uuid", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_CampaignSendLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_CampaignSendLogs_CampaignRecipients_RecipientId",
                        column: x => x.RecipientId,
                        principalTable: "CampaignRecipients",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_CampaignSendLogs_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_CampaignSendLogs_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_CampaignSendLogs_MessageLogs_MessageLogId",
                        column: x => x.MessageLogId,
                        principalTable: "MessageLogs",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_CampaignSendLogs_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "TrackingLogs",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    ContactId = table.Column<Guid>(type: "uuid", nullable: true),
                    ContactPhone = table.Column<string>(type: "text", nullable: true),
                    SourceType = table.Column<string>(type: "text", nullable: false),
                    SourceId = table.Column<Guid>(type: "uuid", nullable: true),
                    CampaignId = table.Column<Guid>(type: "uuid", nullable: true),
                    CampaignSendLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    ButtonText = table.Column<string>(type: "text", nullable: true),
                    CTAType = table.Column<string>(type: "text", nullable: true),
                    MessageId = table.Column<string>(type: "text", nullable: true),
                    TemplateId = table.Column<string>(type: "text", nullable: true),
                    MessageLogId = table.Column<Guid>(type: "uuid", nullable: true),
                    ClickedVia = table.Column<string>(type: "text", nullable: true),
                    Referrer = table.Column<string>(type: "text", nullable: true),
                    ClickedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    IPAddress = table.Column<string>(type: "text", nullable: true),
                    DeviceType = table.Column<string>(type: "text", nullable: true),
                    Browser = table.Column<string>(type: "text", nullable: true),
                    Country = table.Column<string>(type: "text", nullable: true),
                    City = table.Column<string>(type: "text", nullable: true),
                    FollowUpSent = table.Column<bool>(type: "boolean", nullable: false),
                    LastInteractionType = table.Column<string>(type: "text", nullable: true),
                    SessionId = table.Column<Guid>(type: "uuid", nullable: true),
                    ThreadId = table.Column<Guid>(type: "uuid", nullable: true),
                    StepId = table.Column<Guid>(type: "uuid", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_TrackingLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_TrackingLogs_CampaignSendLogs_CampaignSendLogId",
                        column: x => x.CampaignSendLogId,
                        principalTable: "CampaignSendLogs",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_TrackingLogs_Campaigns_CampaignId",
                        column: x => x.CampaignId,
                        principalTable: "Campaigns",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_TrackingLogs_Contacts_ContactId",
                        column: x => x.ContactId,
                        principalTable: "Contacts",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_TrackingLogs_MessageLogs_MessageLogId",
                        column: x => x.MessageLogId,
                        principalTable: "MessageLogs",
                        principalColumn: "Id");
                });

            migrationBuilder.InsertData(
                table: "Permissions",
                columns: new[] { "Id", "Code", "CreatedAt", "Description", "Group", "IsActive", "Name" },
                values: new object[,]
                {
                    { new Guid("30000000-0000-0000-0000-000000000000"), "dashboard.view", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1701), "Permission for dashboard.view", null, true, "dashboard.view" },
                    { new Guid("30000000-0000-0000-0000-000000000001"), "campaign.view", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1712), "Permission for campaign.view", null, true, "campaign.view" },
                    { new Guid("30000000-0000-0000-0000-000000000002"), "campaign.create", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1716), "Permission for campaign.create", null, true, "campaign.create" },
                    { new Guid("30000000-0000-0000-0000-000000000003"), "campaign.delete", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1719), "Permission for campaign.delete", null, true, "campaign.delete" },
                    { new Guid("30000000-0000-0000-0000-000000000004"), "product.view", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1722), "Permission for product.view", null, true, "product.view" },
                    { new Guid("30000000-0000-0000-0000-000000000005"), "product.create", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1727), "Permission for product.create", null, true, "product.create" },
                    { new Guid("30000000-0000-0000-0000-000000000006"), "product.delete", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1730), "Permission for product.delete", null, true, "product.delete" },
                    { new Guid("30000000-0000-0000-0000-000000000007"), "contacts.view", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1734), "Permission for contacts.view", null, true, "contacts.view" },
                    { new Guid("30000000-0000-0000-0000-000000000008"), "tags.edit", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1737), "Permission for tags.edit", null, true, "tags.edit" },
                    { new Guid("30000000-0000-0000-0000-000000000009"), "admin.business.approve", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1753), "Permission for admin.business.approve", null, true, "admin.business.approve" },
                    { new Guid("30000000-0000-0000-0000-000000000010"), "admin.logs.view", new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1757), "Permission for admin.logs.view", null, true, "admin.logs.view" }
                });

            migrationBuilder.InsertData(
                table: "Roles",
                columns: new[] { "Id", "CreatedAt", "Description", "IsActive", "IsSystemDefined", "Name" },
                values: new object[,]
                {
                    { new Guid("00000000-0000-0000-0000-000000000001"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(852), "Super Admin", true, false, "admin" },
                    { new Guid("00000000-0000-0000-0000-000000000002"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(856), "Business Partner", true, false, "partner" },
                    { new Guid("00000000-0000-0000-0000-000000000003"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(858), "Reseller Partner", true, false, "reseller" },
                    { new Guid("00000000-0000-0000-0000-000000000004"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(860), "Business Owner", true, false, "business" },
                    { new Guid("00000000-0000-0000-0000-000000000005"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(862), "Staff", true, false, "staff" }
                });

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("079e80c6-323c-4a08-94a2-51bd604f4929"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2209), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("37eabfd6-e9f8-498f-8532-d7dd7a3b80d7"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2225), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3b9748e5-b4e1-4d9d-a962-71caa9954a8b"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2202), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3c4ce25c-0e01-417e-9449-eb52371f8166"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2257), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("47f15563-8f8a-4072-8654-c8b497de1ee6"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2248), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("55ec2d92-e5c7-4bf0-9fe9-3e2125e972b6"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2217), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6a15f715-fffc-4731-aedc-c905efaa8f37"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2213), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7dbca6d5-8cb2-44ef-a4b8-4c74bbe632bd"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2186), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("818c1856-92a1-4791-bf0e-3f4b9d19a694"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2253), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("925fabe1-5550-4418-9b2b-2e841f8fd598"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2192), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b4438d9f-0f6c-4d90-8876-f8e5f44277ce"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2271), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c37fb295-55f6-4864-bce6-15fef6a141b4"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2281), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("e1f27aa9-0113-4c6c-92ee-dad1416bfc20"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2221), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e97935dc-a48a-4b8f-9cf6-985a2838e269"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2285), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("eebb40df-29d7-48cb-991c-97bc78fde2fa"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2234), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f085246d-dd95-4ef7-9c6b-03079155e299"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2156), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fae4e29c-e7a3-41e7-a591-e54220d55e51"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2167), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.CreateIndex(
                name: "IX_AutoReplyFlowEdges_FlowId",
                table: "AutoReplyFlowEdges",
                column: "FlowId");

            migrationBuilder.CreateIndex(
                name: "IX_AutoReplyFlowNodes_FlowId",
                table: "AutoReplyFlowNodes",
                column: "FlowId");

            migrationBuilder.CreateIndex(
                name: "IX_AutoReplyRules_FlowId",
                table: "AutoReplyRules",
                column: "FlowId");

            migrationBuilder.CreateIndex(
                name: "IX_BusinessPlanInfos_BusinessId",
                table: "BusinessPlanInfos",
                column: "BusinessId",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_CampaignButtons_CampaignId",
                table: "CampaignButtons",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignFlowOverrides_CampaignId",
                table: "CampaignFlowOverrides",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignRecipients_BusinessId",
                table: "CampaignRecipients",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignRecipients_CampaignId",
                table: "CampaignRecipients",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignRecipients_ContactId",
                table: "CampaignRecipients",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_Campaigns_BusinessId",
                table: "Campaigns",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_Campaigns_CtaId",
                table: "Campaigns",
                column: "CtaId");

            migrationBuilder.CreateIndex(
                name: "IX_Campaigns_SourceCampaignId",
                table: "Campaigns",
                column: "SourceCampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignSendLogs_CampaignId",
                table: "CampaignSendLogs",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignSendLogs_ContactId",
                table: "CampaignSendLogs",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignSendLogs_MessageLogId",
                table: "CampaignSendLogs",
                column: "MessageLogId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignSendLogs_RecipientId",
                table: "CampaignSendLogs",
                column: "RecipientId");

            migrationBuilder.CreateIndex(
                name: "IX_CampaignSendLogs_UserId",
                table: "CampaignSendLogs",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_ContactReads_ContactId_UserId",
                table: "ContactReads",
                columns: new[] { "ContactId", "UserId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_Contacts_BusinessId",
                table: "Contacts",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_ContactTags_ContactId",
                table: "ContactTags",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_ContactTags_TagId",
                table: "ContactTags",
                column: "TagId");

            migrationBuilder.CreateIndex(
                name: "IX_CTAFlowSteps_CTAFlowConfigId",
                table: "CTAFlowSteps",
                column: "CTAFlowConfigId");

            migrationBuilder.CreateIndex(
                name: "IX_FlowButtonLinks_CTAFlowStepId",
                table: "FlowButtonLinks",
                column: "CTAFlowStepId");

            migrationBuilder.CreateIndex(
                name: "IX_LeadTimelines_BusinessId",
                table: "LeadTimelines",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_LeadTimelines_ContactId",
                table: "LeadTimelines",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageLogs_BusinessId",
                table: "MessageLogs",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageLogs_CampaignId",
                table: "MessageLogs",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageLogs_ContactId",
                table: "MessageLogs",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageStatusLogs_BusinessId",
                table: "MessageStatusLogs",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageStatusLogs_CampaignId",
                table: "MessageStatusLogs",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageStatusLogs_UserId",
                table: "MessageStatusLogs",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_RolePermissions_PermissionId",
                table: "RolePermissions",
                column: "PermissionId");

            migrationBuilder.CreateIndex(
                name: "IX_RolePermissions_RoleId",
                table: "RolePermissions",
                column: "RoleId");

            migrationBuilder.CreateIndex(
                name: "IX_TrackingLogs_CampaignId",
                table: "TrackingLogs",
                column: "CampaignId");

            migrationBuilder.CreateIndex(
                name: "IX_TrackingLogs_CampaignSendLogId",
                table: "TrackingLogs",
                column: "CampaignSendLogId");

            migrationBuilder.CreateIndex(
                name: "IX_TrackingLogs_ContactId",
                table: "TrackingLogs",
                column: "ContactId");

            migrationBuilder.CreateIndex(
                name: "IX_TrackingLogs_MessageLogId",
                table: "TrackingLogs",
                column: "MessageLogId");

            migrationBuilder.CreateIndex(
                name: "IX_UserPermissions_PermissionId",
                table: "UserPermissions",
                column: "PermissionId");

            migrationBuilder.CreateIndex(
                name: "IX_UserPermissions_UserId",
                table: "UserPermissions",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_Users_BusinessId",
                table: "Users",
                column: "BusinessId");

            migrationBuilder.CreateIndex(
                name: "IX_Users_RoleId",
                table: "Users",
                column: "RoleId");

            migrationBuilder.CreateIndex(
                name: "IX_WhatsAppSettings_BusinessId",
                table: "WhatsAppSettings",
                column: "BusinessId",
                unique: true);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "AuditLogs");

            migrationBuilder.DropTable(
                name: "AutoReplyFlowEdges");

            migrationBuilder.DropTable(
                name: "AutoReplyFlowNodes");

            migrationBuilder.DropTable(
                name: "AutoReplyLogs");

            migrationBuilder.DropTable(
                name: "AutoReplyRules");

            migrationBuilder.DropTable(
                name: "BusinessPlanInfos");

            migrationBuilder.DropTable(
                name: "CampaignButtons");

            migrationBuilder.DropTable(
                name: "CampaignFlowOverrides");

            migrationBuilder.DropTable(
                name: "CatalogClickLogs");

            migrationBuilder.DropTable(
                name: "ChatSessionStates");

            migrationBuilder.DropTable(
                name: "ContactReads");

            migrationBuilder.DropTable(
                name: "ContactTags");

            migrationBuilder.DropTable(
                name: "FailedWebhookLogs");

            migrationBuilder.DropTable(
                name: "FlowButtonLinks");

            migrationBuilder.DropTable(
                name: "FlowExecutionLogs");

            migrationBuilder.DropTable(
                name: "LeadTimelines");

            migrationBuilder.DropTable(
                name: "MessageStatusLogs");

            migrationBuilder.DropTable(
                name: "Notes");

            migrationBuilder.DropTable(
                name: "Products");

            migrationBuilder.DropTable(
                name: "Reminders");

            migrationBuilder.DropTable(
                name: "RolePermissions");

            migrationBuilder.DropTable(
                name: "TrackingLogs");

            migrationBuilder.DropTable(
                name: "UserPermissions");

            migrationBuilder.DropTable(
                name: "WebhookSettings");

            migrationBuilder.DropTable(
                name: "WhatsAppSettings");

            migrationBuilder.DropTable(
                name: "AutoReplyFlows");

            migrationBuilder.DropTable(
                name: "Tags");

            migrationBuilder.DropTable(
                name: "CTAFlowSteps");

            migrationBuilder.DropTable(
                name: "CampaignSendLogs");

            migrationBuilder.DropTable(
                name: "Permissions");

            migrationBuilder.DropTable(
                name: "CTAFlowConfigs");

            migrationBuilder.DropTable(
                name: "CampaignRecipients");

            migrationBuilder.DropTable(
                name: "MessageLogs");

            migrationBuilder.DropTable(
                name: "Users");

            migrationBuilder.DropTable(
                name: "Campaigns");

            migrationBuilder.DropTable(
                name: "Contacts");

            migrationBuilder.DropTable(
                name: "Roles");

            migrationBuilder.DropTable(
                name: "CTADefinitions");

            migrationBuilder.DropTable(
                name: "Businesses");
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250617162332_Initial.Designer.cs  (sha256:1fd0680f6b8ba8f6472ed3f4bd55b54427ef6a138ef5b0f371aaa2be5c060f3b)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250617162332_Initial")]
    partial class Initial
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1701),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1712),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1716),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1719),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1722),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1727),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1730),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1734),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1737),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1753),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1757),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(852),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(856),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(858),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(860),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(862),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("f085246d-dd95-4ef7-9c6b-03079155e299"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2156),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("fae4e29c-e7a3-41e7-a591-e54220d55e51"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2167),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("7dbca6d5-8cb2-44ef-a4b8-4c74bbe632bd"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2186),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("925fabe1-5550-4418-9b2b-2e841f8fd598"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2192),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3b9748e5-b4e1-4d9d-a962-71caa9954a8b"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2202),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("079e80c6-323c-4a08-94a2-51bd604f4929"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2209),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("6a15f715-fffc-4731-aedc-c905efaa8f37"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2213),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("55ec2d92-e5c7-4bf0-9fe9-3e2125e972b6"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2217),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e1f27aa9-0113-4c6c-92ee-dad1416bfc20"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2221),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("37eabfd6-e9f8-498f-8532-d7dd7a3b80d7"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2225),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("eebb40df-29d7-48cb-991c-97bc78fde2fa"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2234),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("47f15563-8f8a-4072-8654-c8b497de1ee6"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2248),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("818c1856-92a1-4791-bf0e-3f4b9d19a694"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2253),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("3c4ce25c-0e01-417e-9449-eb52371f8166"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2257),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("b4438d9f-0f6c-4d90-8876-f8e5f44277ce"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2271),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("c37fb295-55f6-4864-bce6-15fef6a141b4"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2281),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("e97935dc-a48a-4b8f-9cf6-985a2838e269"),
                            AssignedAt = new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2285),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Models.BusinessModel.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618065214_AddIsActiveToContact.cs  (sha256:697f220f114e1035d49caecdf1172cbf96e733310f01ae29f4f443605796a99e)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddIsActiveToContact : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("079e80c6-323c-4a08-94a2-51bd604f4929"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("37eabfd6-e9f8-498f-8532-d7dd7a3b80d7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3b9748e5-b4e1-4d9d-a962-71caa9954a8b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3c4ce25c-0e01-417e-9449-eb52371f8166"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("47f15563-8f8a-4072-8654-c8b497de1ee6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("55ec2d92-e5c7-4bf0-9fe9-3e2125e972b6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6a15f715-fffc-4731-aedc-c905efaa8f37"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7dbca6d5-8cb2-44ef-a4b8-4c74bbe632bd"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("818c1856-92a1-4791-bf0e-3f4b9d19a694"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("925fabe1-5550-4418-9b2b-2e841f8fd598"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b4438d9f-0f6c-4d90-8876-f8e5f44277ce"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c37fb295-55f6-4864-bce6-15fef6a141b4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e1f27aa9-0113-4c6c-92ee-dad1416bfc20"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e97935dc-a48a-4b8f-9cf6-985a2838e269"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eebb40df-29d7-48cb-991c-97bc78fde2fa"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f085246d-dd95-4ef7-9c6b-03079155e299"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fae4e29c-e7a3-41e7-a591-e54220d55e51"));

            migrationBuilder.AddColumn<bool>(
                name: "IsActive",
                table: "Contacts",
                type: "boolean",
                nullable: false,
                defaultValue: false);

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8447));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8456));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8459));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8460));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8462));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8465));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8467));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8468));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8470));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8478));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8550));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("02764f80-8341-4f65-9ba0-4a9a82c3d02c"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9295), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("1ad951a6-4970-42e7-94b1-5b96729f870d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9298), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("1ca2458f-1612-464a-9bcc-1c133f15053b"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9250), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("24e2cfbb-0475-407a-aed2-436393a916e4"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9254), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2aa6096a-a2e5-430a-a871-b9d93358204d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9257), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("30bbab7e-d3ca-4113-928a-ce20506fb542"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9270), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("33993d87-cdc5-44b7-bbdd-8285317b7a68"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9247), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6485bf8f-a5cc-48a0-8a30-0b5f0742387a"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9288), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("7dbef1b0-e4f0-4e02-87e1-43e9a1612515"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9244), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("82df3d2a-da23-44d4-9b14-5d61bcf4de91"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8861), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("88d10a1c-6dc1-4bf1-aab7-6be6f4962c4d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9220), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("954fd0fe-c5fe-4f83-81b3-8a3ae1ec1015"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9278), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("aa51357f-8f50-4c23-a15e-f2a446a70db8"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8849), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d9d64c9b-37f4-4d59-b835-288a424c40cb"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8865), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dbdb282e-add5-46fd-ad64-3545858ecae9"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8857), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e41905a0-52b8-48a4-87dc-36e8b21f9937"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9274), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("fa3591be-aeee-47ee-aeb7-983b168ab174"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9230), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7870));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7871));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7872));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7873));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7874));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("02764f80-8341-4f65-9ba0-4a9a82c3d02c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1ad951a6-4970-42e7-94b1-5b96729f870d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1ca2458f-1612-464a-9bcc-1c133f15053b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("24e2cfbb-0475-407a-aed2-436393a916e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2aa6096a-a2e5-430a-a871-b9d93358204d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30bbab7e-d3ca-4113-928a-ce20506fb542"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("33993d87-cdc5-44b7-bbdd-8285317b7a68"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6485bf8f-a5cc-48a0-8a30-0b5f0742387a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7dbef1b0-e4f0-4e02-87e1-43e9a1612515"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("82df3d2a-da23-44d4-9b14-5d61bcf4de91"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("88d10a1c-6dc1-4bf1-aab7-6be6f4962c4d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("954fd0fe-c5fe-4f83-81b3-8a3ae1ec1015"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa51357f-8f50-4c23-a15e-f2a446a70db8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d9d64c9b-37f4-4d59-b835-288a424c40cb"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dbdb282e-add5-46fd-ad64-3545858ecae9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e41905a0-52b8-48a4-87dc-36e8b21f9937"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fa3591be-aeee-47ee-aeb7-983b168ab174"));

            migrationBuilder.DropColumn(
                name: "IsActive",
                table: "Contacts");

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1701));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1712));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1716));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1719));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1722));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1727));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1730));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1734));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1737));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1753));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(1757));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("079e80c6-323c-4a08-94a2-51bd604f4929"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2209), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("37eabfd6-e9f8-498f-8532-d7dd7a3b80d7"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2225), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3b9748e5-b4e1-4d9d-a962-71caa9954a8b"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2202), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3c4ce25c-0e01-417e-9449-eb52371f8166"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2257), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("47f15563-8f8a-4072-8654-c8b497de1ee6"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2248), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("55ec2d92-e5c7-4bf0-9fe9-3e2125e972b6"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2217), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6a15f715-fffc-4731-aedc-c905efaa8f37"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2213), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7dbca6d5-8cb2-44ef-a4b8-4c74bbe632bd"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2186), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("818c1856-92a1-4791-bf0e-3f4b9d19a694"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2253), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("925fabe1-5550-4418-9b2b-2e841f8fd598"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2192), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b4438d9f-0f6c-4d90-8876-f8e5f44277ce"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2271), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c37fb295-55f6-4864-bce6-15fef6a141b4"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2281), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("e1f27aa9-0113-4c6c-92ee-dad1416bfc20"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2221), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e97935dc-a48a-4b8f-9cf6-985a2838e269"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2285), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("eebb40df-29d7-48cb-991c-97bc78fde2fa"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2234), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f085246d-dd95-4ef7-9c6b-03079155e299"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2156), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fae4e29c-e7a3-41e7-a591-e54220d55e51"), new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(2167), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(852));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(856));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(858));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(860));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 17, 16, 23, 31, 798, DateTimeKind.Utc).AddTicks(862));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618065214_AddIsActiveToContact.Designer.cs  (sha256:f7eba5549553ae4a4edc8bc2c8a486f67bf3ebfa66836c46bf949d8394bb2d77)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250618065214_AddIsActiveToContact")]
    partial class AddIsActiveToContact
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8447),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8456),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8459),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8460),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8462),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8465),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8467),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8468),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8470),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8478),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8550),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7870),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7871),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7872),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7873),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7874),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("aa51357f-8f50-4c23-a15e-f2a446a70db8"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8849),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("dbdb282e-add5-46fd-ad64-3545858ecae9"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8857),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("82df3d2a-da23-44d4-9b14-5d61bcf4de91"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8861),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d9d64c9b-37f4-4d59-b835-288a424c40cb"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8865),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("88d10a1c-6dc1-4bf1-aab7-6be6f4962c4d"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9220),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("fa3591be-aeee-47ee-aeb7-983b168ab174"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9230),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("7dbef1b0-e4f0-4e02-87e1-43e9a1612515"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9244),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("33993d87-cdc5-44b7-bbdd-8285317b7a68"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9247),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("1ca2458f-1612-464a-9bcc-1c133f15053b"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9250),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("24e2cfbb-0475-407a-aed2-436393a916e4"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9254),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2aa6096a-a2e5-430a-a871-b9d93358204d"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9257),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("30bbab7e-d3ca-4113-928a-ce20506fb542"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9270),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("e41905a0-52b8-48a4-87dc-36e8b21f9937"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9274),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("954fd0fe-c5fe-4f83-81b3-8a3ae1ec1015"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9278),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("6485bf8f-a5cc-48a0-8a30-0b5f0742387a"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9288),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("02764f80-8341-4f65-9ba0-4a9a82c3d02c"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9295),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("1ad951a6-4970-42e7-94b1-5b96729f870d"),
                            AssignedAt = new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9298),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618085616_AddPlanAndPermissionsTables.cs  (sha256:5ce1d945fb389700bc5aa141a5216e712bd3f4bb37029225b012638d8adceb29)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddPlanAndPermissionsTables : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("02764f80-8341-4f65-9ba0-4a9a82c3d02c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1ad951a6-4970-42e7-94b1-5b96729f870d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1ca2458f-1612-464a-9bcc-1c133f15053b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("24e2cfbb-0475-407a-aed2-436393a916e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2aa6096a-a2e5-430a-a871-b9d93358204d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30bbab7e-d3ca-4113-928a-ce20506fb542"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("33993d87-cdc5-44b7-bbdd-8285317b7a68"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6485bf8f-a5cc-48a0-8a30-0b5f0742387a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7dbef1b0-e4f0-4e02-87e1-43e9a1612515"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("82df3d2a-da23-44d4-9b14-5d61bcf4de91"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("88d10a1c-6dc1-4bf1-aab7-6be6f4962c4d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("954fd0fe-c5fe-4f83-81b3-8a3ae1ec1015"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa51357f-8f50-4c23-a15e-f2a446a70db8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d9d64c9b-37f4-4d59-b835-288a424c40cb"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dbdb282e-add5-46fd-ad64-3545858ecae9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e41905a0-52b8-48a4-87dc-36e8b21f9937"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fa3591be-aeee-47ee-aeb7-983b168ab174"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6488));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6499));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6503));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6505));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6509));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6513));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6516));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6518));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6522));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6536));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6540));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("003843fd-8c1e-48ca-b835-204f1bd45d70"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7100), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("14e55de6-27a2-4628-936b-b69ba64abda9"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7153), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2564bb32-540e-454a-b685-b7f24c341fa7"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7115), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("39cdceb8-6001-45db-aeea-c39f35f9b6ac"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7068), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("46549846-d2a6-47d1-8166-203b5b8c9033"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7167), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("613a89f2-84ba-462a-8c70-8749baf7f5cf"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7138), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("63c8311f-bd99-4511-8832-d2290f88f672"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7095), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6555c2bd-fc8d-4f45-abb2-c92de944216e"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7074), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6ab149de-62f7-4207-8a09-5e49252b1635"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7120), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6f3808e5-4643-448a-8ea6-672acab61a4b"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7162), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("91c81b3d-49f0-4ccb-b9fc-4afb84755e05"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7105), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aa2fcb6f-93b6-42b5-af4a-bcaf1da0e724"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7134), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("b06e50ad-f1ff-4f90-b44d-c440be8dc23c"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7084), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("bef317da-6e28-43f1-99c9-d1e7d7734ccf"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7090), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d361b7d0-0308-4e2c-b12b-0715b7a86887"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6976), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dcfb4546-1ec5-4842-af11-0e127094e50b"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7142), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("ea9e2321-7062-4390-97dc-a6f0cfd92988"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7000), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4969));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4973));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4974));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4976));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4978));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("003843fd-8c1e-48ca-b835-204f1bd45d70"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("14e55de6-27a2-4628-936b-b69ba64abda9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2564bb32-540e-454a-b685-b7f24c341fa7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("39cdceb8-6001-45db-aeea-c39f35f9b6ac"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("46549846-d2a6-47d1-8166-203b5b8c9033"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("613a89f2-84ba-462a-8c70-8749baf7f5cf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("63c8311f-bd99-4511-8832-d2290f88f672"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6555c2bd-fc8d-4f45-abb2-c92de944216e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6ab149de-62f7-4207-8a09-5e49252b1635"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6f3808e5-4643-448a-8ea6-672acab61a4b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("91c81b3d-49f0-4ccb-b9fc-4afb84755e05"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa2fcb6f-93b6-42b5-af4a-bcaf1da0e724"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b06e50ad-f1ff-4f90-b44d-c440be8dc23c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("bef317da-6e28-43f1-99c9-d1e7d7734ccf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d361b7d0-0308-4e2c-b12b-0715b7a86887"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcfb4546-1ec5-4842-af11-0e127094e50b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ea9e2321-7062-4390-97dc-a6f0cfd92988"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8447));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8456));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8459));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8460));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8462));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8465));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8467));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8468));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8470));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8478));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8550));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("02764f80-8341-4f65-9ba0-4a9a82c3d02c"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9295), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("1ad951a6-4970-42e7-94b1-5b96729f870d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9298), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("1ca2458f-1612-464a-9bcc-1c133f15053b"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9250), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("24e2cfbb-0475-407a-aed2-436393a916e4"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9254), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2aa6096a-a2e5-430a-a871-b9d93358204d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9257), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("30bbab7e-d3ca-4113-928a-ce20506fb542"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9270), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("33993d87-cdc5-44b7-bbdd-8285317b7a68"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9247), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6485bf8f-a5cc-48a0-8a30-0b5f0742387a"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9288), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("7dbef1b0-e4f0-4e02-87e1-43e9a1612515"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9244), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("82df3d2a-da23-44d4-9b14-5d61bcf4de91"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8861), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("88d10a1c-6dc1-4bf1-aab7-6be6f4962c4d"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9220), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("954fd0fe-c5fe-4f83-81b3-8a3ae1ec1015"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9278), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("aa51357f-8f50-4c23-a15e-f2a446a70db8"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8849), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d9d64c9b-37f4-4d59-b835-288a424c40cb"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8865), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dbdb282e-add5-46fd-ad64-3545858ecae9"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(8857), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e41905a0-52b8-48a4-87dc-36e8b21f9937"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9274), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("fa3591be-aeee-47ee-aeb7-983b168ab174"), new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(9230), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7870));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7871));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7872));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7873));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 6, 52, 13, 690, DateTimeKind.Utc).AddTicks(7874));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618085616_AddPlanAndPermissionsTables.Designer.cs  (sha256:c5eab867f34f3c1e2cebf2ee4e3fe18f16eb9df377def70992e3ee36e3e1df83)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250618085616_AddPlanAndPermissionsTables")]
    partial class AddPlanAndPermissionsTables
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6488),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6499),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6503),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6505),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6509),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6513),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6516),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6518),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6522),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6536),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6540),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4969),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4973),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4974),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4976),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4978),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("d361b7d0-0308-4e2c-b12b-0715b7a86887"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6976),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("ea9e2321-7062-4390-97dc-a6f0cfd92988"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7000),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("39cdceb8-6001-45db-aeea-c39f35f9b6ac"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7068),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("6555c2bd-fc8d-4f45-abb2-c92de944216e"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7074),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b06e50ad-f1ff-4f90-b44d-c440be8dc23c"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7084),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("bef317da-6e28-43f1-99c9-d1e7d7734ccf"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7090),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("63c8311f-bd99-4511-8832-d2290f88f672"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7095),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("003843fd-8c1e-48ca-b835-204f1bd45d70"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7100),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("91c81b3d-49f0-4ccb-b9fc-4afb84755e05"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7105),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2564bb32-540e-454a-b685-b7f24c341fa7"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7115),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("6ab149de-62f7-4207-8a09-5e49252b1635"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7120),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("aa2fcb6f-93b6-42b5-af4a-bcaf1da0e724"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7134),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("613a89f2-84ba-462a-8c70-8749baf7f5cf"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7138),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("dcfb4546-1ec5-4842-af11-0e127094e50b"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7142),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("14e55de6-27a2-4628-936b-b69ba64abda9"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7153),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("6f3808e5-4643-448a-8ea6-672acab61a4b"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7162),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("46549846-d2a6-47d1-8166-203b5b8c9033"),
                            AssignedAt = new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7167),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618113519_AddFeatureAccessControlTable.cs  (sha256:1c5bd08f0b97cd0c14fafef4b88d8fd04594c521ca86df7c9970949c0bc9917e)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddFeatureAccessControlTable : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("003843fd-8c1e-48ca-b835-204f1bd45d70"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("14e55de6-27a2-4628-936b-b69ba64abda9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2564bb32-540e-454a-b685-b7f24c341fa7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("39cdceb8-6001-45db-aeea-c39f35f9b6ac"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("46549846-d2a6-47d1-8166-203b5b8c9033"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("613a89f2-84ba-462a-8c70-8749baf7f5cf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("63c8311f-bd99-4511-8832-d2290f88f672"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6555c2bd-fc8d-4f45-abb2-c92de944216e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6ab149de-62f7-4207-8a09-5e49252b1635"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6f3808e5-4643-448a-8ea6-672acab61a4b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("91c81b3d-49f0-4ccb-b9fc-4afb84755e05"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa2fcb6f-93b6-42b5-af4a-bcaf1da0e724"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b06e50ad-f1ff-4f90-b44d-c440be8dc23c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("bef317da-6e28-43f1-99c9-d1e7d7734ccf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d361b7d0-0308-4e2c-b12b-0715b7a86887"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcfb4546-1ec5-4842-af11-0e127094e50b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ea9e2321-7062-4390-97dc-a6f0cfd92988"));

            migrationBuilder.CreateTable(
                name: "Plans",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    Code = table.Column<string>(type: "text", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    Description = table.Column<string>(type: "text", nullable: true),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Plans", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "PlanPermissions",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    PlanId = table.Column<Guid>(type: "uuid", nullable: false),
                    PermissionId = table.Column<Guid>(type: "uuid", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    AssignedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    AssignedBy = table.Column<string>(type: "text", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PlanPermissions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_PlanPermissions_Permissions_PermissionId",
                        column: x => x.PermissionId,
                        principalTable: "Permissions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_PlanPermissions_Plans_PlanId",
                        column: x => x.PlanId,
                        principalTable: "Plans",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7359));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7374));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7380));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7384));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7389));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7396));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7400));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7405));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7410));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7432));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7437));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("03816e54-47a3-467d-8c88-e43ea4536e05"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8144), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("341fb820-6b52-4174-9662-3b214e82e6e3"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8207), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3c392691-3438-4a20-b045-7df862eafc67"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8229), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3df6dae8-231e-4d76-82e2-2884cc481a43"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8214), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4d721807-27c2-4739-accb-9f31089a94c2"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8263), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("50f07690-d640-4399-b443-e340aee9d3a0"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8127), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("56e6eda1-6ed4-4b00-9a1d-53ee6d41e251"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8221), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7df4604b-fe0e-4f58-8622-9ca6cca4e079"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8314), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("86dc236f-b269-46af-bf2d-823f9ab40ce2"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8184), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("88838163-0483-46a7-a5dd-db80abc6c5c6"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8255), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("abeb1282-e95e-4b1d-b1dd-62104642ebc4"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8336), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("be5dd8e3-2c78-46b6-af9c-ee91c9390de5"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8175), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cb57d18f-d96a-4634-a65e-edbe6c34ae73"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8162), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cbd3bd8a-2761-449b-80fd-16ec9c4b56f3"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8269), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("e0cd0f85-44d7-49d8-b1a1-ad7d400ed458"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8236), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e8a60265-2301-4d75-906b-488c01fc1b00"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8329), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("eef2747c-b46d-452a-82a1-55e1005b9baa"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8154), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6272));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6275));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6278));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6280));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6282));

            migrationBuilder.CreateIndex(
                name: "IX_PlanPermissions_PermissionId",
                table: "PlanPermissions",
                column: "PermissionId");

            migrationBuilder.CreateIndex(
                name: "IX_PlanPermissions_PlanId",
                table: "PlanPermissions",
                column: "PlanId");
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "PlanPermissions");

            migrationBuilder.DropTable(
                name: "Plans");

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("03816e54-47a3-467d-8c88-e43ea4536e05"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("341fb820-6b52-4174-9662-3b214e82e6e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3c392691-3438-4a20-b045-7df862eafc67"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3df6dae8-231e-4d76-82e2-2884cc481a43"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4d721807-27c2-4739-accb-9f31089a94c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("50f07690-d640-4399-b443-e340aee9d3a0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("56e6eda1-6ed4-4b00-9a1d-53ee6d41e251"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7df4604b-fe0e-4f58-8622-9ca6cca4e079"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("86dc236f-b269-46af-bf2d-823f9ab40ce2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("88838163-0483-46a7-a5dd-db80abc6c5c6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("abeb1282-e95e-4b1d-b1dd-62104642ebc4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("be5dd8e3-2c78-46b6-af9c-ee91c9390de5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cb57d18f-d96a-4634-a65e-edbe6c34ae73"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cbd3bd8a-2761-449b-80fd-16ec9c4b56f3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0cd0f85-44d7-49d8-b1a1-ad7d400ed458"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e8a60265-2301-4d75-906b-488c01fc1b00"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eef2747c-b46d-452a-82a1-55e1005b9baa"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6488));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6499));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6503));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6505));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6509));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6513));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6516));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6518));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6522));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6536));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6540));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("003843fd-8c1e-48ca-b835-204f1bd45d70"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7100), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("14e55de6-27a2-4628-936b-b69ba64abda9"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7153), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2564bb32-540e-454a-b685-b7f24c341fa7"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7115), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("39cdceb8-6001-45db-aeea-c39f35f9b6ac"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7068), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("46549846-d2a6-47d1-8166-203b5b8c9033"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7167), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("613a89f2-84ba-462a-8c70-8749baf7f5cf"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7138), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("63c8311f-bd99-4511-8832-d2290f88f672"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7095), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6555c2bd-fc8d-4f45-abb2-c92de944216e"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7074), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6ab149de-62f7-4207-8a09-5e49252b1635"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7120), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6f3808e5-4643-448a-8ea6-672acab61a4b"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7162), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("91c81b3d-49f0-4ccb-b9fc-4afb84755e05"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7105), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aa2fcb6f-93b6-42b5-af4a-bcaf1da0e724"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7134), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("b06e50ad-f1ff-4f90-b44d-c440be8dc23c"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7084), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("bef317da-6e28-43f1-99c9-d1e7d7734ccf"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7090), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d361b7d0-0308-4e2c-b12b-0715b7a86887"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(6976), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dcfb4546-1ec5-4842-af11-0e127094e50b"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7142), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("ea9e2321-7062-4390-97dc-a6f0cfd92988"), new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(7000), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4969));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4973));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4974));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4976));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 8, 56, 15, 175, DateTimeKind.Utc).AddTicks(4978));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250618113519_AddFeatureAccessControlTable.Designer.cs  (sha256:4243c5eb4591029867b024d9123ab6f484b6db66f1b69548bbdf9dec6b9975ee)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250618113519_AddFeatureAccessControlTable")]
    partial class AddFeatureAccessControlTable
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7359),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7374),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7380),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7384),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7389),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7396),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7400),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7405),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7410),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7432),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7437),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6272),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6275),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6278),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6280),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6282),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("50f07690-d640-4399-b443-e340aee9d3a0"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8127),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("03816e54-47a3-467d-8c88-e43ea4536e05"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8144),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("eef2747c-b46d-452a-82a1-55e1005b9baa"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8154),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("cb57d18f-d96a-4634-a65e-edbe6c34ae73"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8162),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("be5dd8e3-2c78-46b6-af9c-ee91c9390de5"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8175),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("86dc236f-b269-46af-bf2d-823f9ab40ce2"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8184),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("341fb820-6b52-4174-9662-3b214e82e6e3"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8207),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3df6dae8-231e-4d76-82e2-2884cc481a43"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8214),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("56e6eda1-6ed4-4b00-9a1d-53ee6d41e251"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8221),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3c392691-3438-4a20-b045-7df862eafc67"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8229),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e0cd0f85-44d7-49d8-b1a1-ad7d400ed458"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8236),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("88838163-0483-46a7-a5dd-db80abc6c5c6"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8255),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("4d721807-27c2-4739-accb-9f31089a94c2"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8263),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("cbd3bd8a-2761-449b-80fd-16ec9c4b56f3"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8269),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("7df4604b-fe0e-4f58-8622-9ca6cca4e079"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8314),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("e8a60265-2301-4d75-906b-488c01fc1b00"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8329),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("abeb1282-e95e-4b1d-b1dd-62104642ebc4"),
                            AssignedAt = new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8336),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619125213_AddPlanFeatureMatrix.cs  (sha256:606f6af95559c9750988b257d930510db81746c00fff89c0c78f93740caf3fd3)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddPlanFeatureMatrix : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("03816e54-47a3-467d-8c88-e43ea4536e05"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("341fb820-6b52-4174-9662-3b214e82e6e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3c392691-3438-4a20-b045-7df862eafc67"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3df6dae8-231e-4d76-82e2-2884cc481a43"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4d721807-27c2-4739-accb-9f31089a94c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("50f07690-d640-4399-b443-e340aee9d3a0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("56e6eda1-6ed4-4b00-9a1d-53ee6d41e251"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7df4604b-fe0e-4f58-8622-9ca6cca4e079"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("86dc236f-b269-46af-bf2d-823f9ab40ce2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("88838163-0483-46a7-a5dd-db80abc6c5c6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("abeb1282-e95e-4b1d-b1dd-62104642ebc4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("be5dd8e3-2c78-46b6-af9c-ee91c9390de5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cb57d18f-d96a-4634-a65e-edbe6c34ae73"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cbd3bd8a-2761-449b-80fd-16ec9c4b56f3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0cd0f85-44d7-49d8-b1a1-ad7d400ed458"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e8a60265-2301-4d75-906b-488c01fc1b00"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eef2747c-b46d-452a-82a1-55e1005b9baa"));

            migrationBuilder.CreateTable(
                name: "FeatureAccess",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    FeatureName = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: false),
                    IsEnabled = table.Column<bool>(type: "boolean", nullable: false),
                    Notes = table.Column<string>(type: "text", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FeatureAccess", x => x.Id);
                });

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5976));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5986));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5989));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5993));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5996));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6001));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6003));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6007));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6011));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6024));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6028));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("04458866-2ef9-4687-bfec-4198044108a5"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6468), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("118fff52-3cdc-4147-a9ee-43a793d8fb75"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6616), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("30f9753b-4f86-46e3-9ecd-5296dafc2e22"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6529), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("30f9766a-dd91-4cbb-b18f-687fd63ec978"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6487), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("31893be4-65b2-4891-b4f0-5f510b257752"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6629), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("32a1772e-104a-4df9-91cc-21147553a2f2"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6491), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("33aa695f-30d9-4b7f-972f-c53e47d44472"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6449), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4ba699b2-f51b-481b-bc33-e1440f46f7f4"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6534), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("80e010d0-9eb8-44dc-9b2d-d92112209731"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6514), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8328b691-55fe-4a99-81fd-6e8a97c34c39"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6538), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("857ce948-a586-4443-a932-37839f780841"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6480), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8f64dac3-89ca-4d79-b83d-f983c96ed0e3"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6503), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a64cc25f-9b4f-4484-9fec-4e16d43c82b3"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6637), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("dcd4151c-a419-4554-b864-4051acc33ae8"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6496), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e0b7aab9-8202-43e7-ba87-b4ddc393df56"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6458), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f8d37bcf-3b68-4e47-ad19-53716fead29a"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6463), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f9aeccd1-91d1-4509-9f8d-303684423c1b"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6509), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4405));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4408));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4410));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4411));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4413));

            migrationBuilder.CreateIndex(
                name: "IX_FeatureAccess_BusinessId_FeatureName",
                table: "FeatureAccess",
                columns: new[] { "BusinessId", "FeatureName" },
                unique: true);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "FeatureAccess");

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("04458866-2ef9-4687-bfec-4198044108a5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("118fff52-3cdc-4147-a9ee-43a793d8fb75"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30f9753b-4f86-46e3-9ecd-5296dafc2e22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30f9766a-dd91-4cbb-b18f-687fd63ec978"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31893be4-65b2-4891-b4f0-5f510b257752"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("32a1772e-104a-4df9-91cc-21147553a2f2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("33aa695f-30d9-4b7f-972f-c53e47d44472"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4ba699b2-f51b-481b-bc33-e1440f46f7f4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("80e010d0-9eb8-44dc-9b2d-d92112209731"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8328b691-55fe-4a99-81fd-6e8a97c34c39"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("857ce948-a586-4443-a932-37839f780841"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8f64dac3-89ca-4d79-b83d-f983c96ed0e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a64cc25f-9b4f-4484-9fec-4e16d43c82b3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcd4151c-a419-4554-b864-4051acc33ae8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0b7aab9-8202-43e7-ba87-b4ddc393df56"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f8d37bcf-3b68-4e47-ad19-53716fead29a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f9aeccd1-91d1-4509-9f8d-303684423c1b"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7359));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7374));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7380));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7384));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7389));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7396));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7400));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7405));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7410));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7432));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(7437));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("03816e54-47a3-467d-8c88-e43ea4536e05"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8144), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("341fb820-6b52-4174-9662-3b214e82e6e3"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8207), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3c392691-3438-4a20-b045-7df862eafc67"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8229), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3df6dae8-231e-4d76-82e2-2884cc481a43"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8214), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4d721807-27c2-4739-accb-9f31089a94c2"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8263), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("50f07690-d640-4399-b443-e340aee9d3a0"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8127), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("56e6eda1-6ed4-4b00-9a1d-53ee6d41e251"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8221), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7df4604b-fe0e-4f58-8622-9ca6cca4e079"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8314), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("86dc236f-b269-46af-bf2d-823f9ab40ce2"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8184), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("88838163-0483-46a7-a5dd-db80abc6c5c6"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8255), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("abeb1282-e95e-4b1d-b1dd-62104642ebc4"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8336), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("be5dd8e3-2c78-46b6-af9c-ee91c9390de5"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8175), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cb57d18f-d96a-4634-a65e-edbe6c34ae73"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8162), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cbd3bd8a-2761-449b-80fd-16ec9c4b56f3"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8269), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("e0cd0f85-44d7-49d8-b1a1-ad7d400ed458"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8236), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e8a60265-2301-4d75-906b-488c01fc1b00"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8329), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("eef2747c-b46d-452a-82a1-55e1005b9baa"), new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(8154), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6272));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6275));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6278));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6280));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 18, 11, 35, 17, 880, DateTimeKind.Utc).AddTicks(6282));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619125213_AddPlanFeatureMatrix.Designer.cs  (sha256:e32ff38af51a88f2477a3340772800a15e06d4395bd76c3c98182695dc67d7f0)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250619125213_AddPlanFeatureMatrix")]
    partial class AddPlanFeatureMatrix
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5976),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5986),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5989),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5993),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5996),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6001),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6003),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6007),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6011),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6024),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6028),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4405),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4408),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4410),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4411),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4413),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("33aa695f-30d9-4b7f-972f-c53e47d44472"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6449),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e0b7aab9-8202-43e7-ba87-b4ddc393df56"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6458),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("f8d37bcf-3b68-4e47-ad19-53716fead29a"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6463),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("04458866-2ef9-4687-bfec-4198044108a5"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6468),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("857ce948-a586-4443-a932-37839f780841"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6480),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("30f9766a-dd91-4cbb-b18f-687fd63ec978"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6487),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("32a1772e-104a-4df9-91cc-21147553a2f2"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6491),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("dcd4151c-a419-4554-b864-4051acc33ae8"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6496),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("8f64dac3-89ca-4d79-b83d-f983c96ed0e3"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6503),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("f9aeccd1-91d1-4509-9f8d-303684423c1b"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6509),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("80e010d0-9eb8-44dc-9b2d-d92112209731"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6514),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("30f9753b-4f86-46e3-9ecd-5296dafc2e22"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6529),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("4ba699b2-f51b-481b-bc33-e1440f46f7f4"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6534),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("8328b691-55fe-4a99-81fd-6e8a97c34c39"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6538),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("118fff52-3cdc-4147-a9ee-43a793d8fb75"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6616),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("31893be4-65b2-4891-b4f0-5f510b257752"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6629),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("a64cc25f-9b4f-4484-9fec-4e16d43c82b3"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6637),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619125804_AddUserFeatureAccessTable.cs  (sha256:02e06ec9d126a93ddb57534ff950596bf52f606b01c2deaa9f30d1d3be9385e6)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddUserFeatureAccessTable : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("04458866-2ef9-4687-bfec-4198044108a5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("118fff52-3cdc-4147-a9ee-43a793d8fb75"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30f9753b-4f86-46e3-9ecd-5296dafc2e22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("30f9766a-dd91-4cbb-b18f-687fd63ec978"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31893be4-65b2-4891-b4f0-5f510b257752"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("32a1772e-104a-4df9-91cc-21147553a2f2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("33aa695f-30d9-4b7f-972f-c53e47d44472"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4ba699b2-f51b-481b-bc33-e1440f46f7f4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("80e010d0-9eb8-44dc-9b2d-d92112209731"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8328b691-55fe-4a99-81fd-6e8a97c34c39"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("857ce948-a586-4443-a932-37839f780841"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8f64dac3-89ca-4d79-b83d-f983c96ed0e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a64cc25f-9b4f-4484-9fec-4e16d43c82b3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcd4151c-a419-4554-b864-4051acc33ae8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0b7aab9-8202-43e7-ba87-b4ddc393df56"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f8d37bcf-3b68-4e47-ad19-53716fead29a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f9aeccd1-91d1-4509-9f8d-303684423c1b"));

            migrationBuilder.CreateTable(
                name: "PlanFeatureMatrix",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    PlanName = table.Column<string>(type: "character varying(20)", maxLength: 20, nullable: false),
                    FeatureName = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: false),
                    IsEnabled = table.Column<bool>(type: "boolean", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PlanFeatureMatrix", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "UserFeatureAccess",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    UserId = table.Column<Guid>(type: "uuid", nullable: false),
                    FeatureName = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: false),
                    IsEnabled = table.Column<bool>(type: "boolean", nullable: false),
                    Notes = table.Column<string>(type: "text", nullable: true),
                    ModifiedByUserId = table.Column<Guid>(type: "uuid", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_UserFeatureAccess", x => x.Id);
                });

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1484));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1496));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1500));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1504));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1507));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1513));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1516));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1520));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1524));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1544));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1547));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("096be258-50ae-4078-b0b8-c26a084fd724"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1993), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("0fd99a93-afb1-4c95-bd45-6cac60d66c95"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2113), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("252166cd-7af1-4e13-9307-d49d67174ca0"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2084), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("3ac31a18-ad13-4c36-b48b-809df1accbea"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1987), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3ae5fc4a-1802-4e1d-88e1-1a18ec723c68"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2003), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3b73270a-83ea-4035-bc71-afcd2712b655"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2069), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4a1d7dea-8658-4b83-ab55-3fa7d44acfca"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2123), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("58bc10ee-9c29-43f1-91ae-b47c230c074c"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2129), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("5974390a-3569-4e81-844a-eef6252ef7e4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1966), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("81b8d4c8-6ce9-45b4-8edf-420e9e7cc508"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2065), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("ab889393-3213-491e-9a14-22ed8d5e2ec9"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2093), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("cf24b7f5-1cd6-4a11-ae7d-6cf51ef639b4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1934), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d93c4342-cb14-4ca7-a8f5-8b48689cb9d5"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1961), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e6bbb9ea-c7c5-46ec-a174-89321cb049f4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2058), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e7be4659-3d78-46ee-ada0-d8daf6dfc315"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1998), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("eaea5537-8ed7-4503-aa6e-e7d5e8cff0bb"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1955), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f793d715-08c4-4660-bb72-79c135d915fa"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2099), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(346));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(350));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(352));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(354));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(356));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "PlanFeatureMatrix");

            migrationBuilder.DropTable(
                name: "UserFeatureAccess");

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("096be258-50ae-4078-b0b8-c26a084fd724"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0fd99a93-afb1-4c95-bd45-6cac60d66c95"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("252166cd-7af1-4e13-9307-d49d67174ca0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3ac31a18-ad13-4c36-b48b-809df1accbea"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3ae5fc4a-1802-4e1d-88e1-1a18ec723c68"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3b73270a-83ea-4035-bc71-afcd2712b655"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4a1d7dea-8658-4b83-ab55-3fa7d44acfca"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("58bc10ee-9c29-43f1-91ae-b47c230c074c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5974390a-3569-4e81-844a-eef6252ef7e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("81b8d4c8-6ce9-45b4-8edf-420e9e7cc508"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ab889393-3213-491e-9a14-22ed8d5e2ec9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf24b7f5-1cd6-4a11-ae7d-6cf51ef639b4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d93c4342-cb14-4ca7-a8f5-8b48689cb9d5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e6bbb9ea-c7c5-46ec-a174-89321cb049f4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e7be4659-3d78-46ee-ada0-d8daf6dfc315"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eaea5537-8ed7-4503-aa6e-e7d5e8cff0bb"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f793d715-08c4-4660-bb72-79c135d915fa"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5976));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5986));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5989));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5993));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(5996));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6001));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6003));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6007));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6011));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6024));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6028));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("04458866-2ef9-4687-bfec-4198044108a5"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6468), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("118fff52-3cdc-4147-a9ee-43a793d8fb75"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6616), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("30f9753b-4f86-46e3-9ecd-5296dafc2e22"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6529), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("30f9766a-dd91-4cbb-b18f-687fd63ec978"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6487), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("31893be4-65b2-4891-b4f0-5f510b257752"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6629), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("32a1772e-104a-4df9-91cc-21147553a2f2"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6491), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("33aa695f-30d9-4b7f-972f-c53e47d44472"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6449), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4ba699b2-f51b-481b-bc33-e1440f46f7f4"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6534), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("80e010d0-9eb8-44dc-9b2d-d92112209731"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6514), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8328b691-55fe-4a99-81fd-6e8a97c34c39"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6538), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("857ce948-a586-4443-a932-37839f780841"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6480), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8f64dac3-89ca-4d79-b83d-f983c96ed0e3"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6503), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a64cc25f-9b4f-4484-9fec-4e16d43c82b3"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6637), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("dcd4151c-a419-4554-b864-4051acc33ae8"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6496), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e0b7aab9-8202-43e7-ba87-b4ddc393df56"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6458), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f8d37bcf-3b68-4e47-ad19-53716fead29a"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6463), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f9aeccd1-91d1-4509-9f8d-303684423c1b"), new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(6509), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4405));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4408));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4410));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4411));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 52, 12, 620, DateTimeKind.Utc).AddTicks(4413));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619125804_AddUserFeatureAccessTable.Designer.cs  (sha256:1d005047673d716dd27c18c687f8ab3ebdb72c7a26a3529ddd81185f88de0866)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250619125804_AddUserFeatureAccessTable")]
    partial class AddUserFeatureAccessTable
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1484),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1496),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1500),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1504),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1507),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1513),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1516),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1520),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1524),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1544),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1547),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(346),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(350),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(352),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(354),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(356),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("cf24b7f5-1cd6-4a11-ae7d-6cf51ef639b4"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1934),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("eaea5537-8ed7-4503-aa6e-e7d5e8cff0bb"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1955),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d93c4342-cb14-4ca7-a8f5-8b48689cb9d5"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1961),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("5974390a-3569-4e81-844a-eef6252ef7e4"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1966),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3ac31a18-ad13-4c36-b48b-809df1accbea"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1987),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("096be258-50ae-4078-b0b8-c26a084fd724"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1993),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e7be4659-3d78-46ee-ada0-d8daf6dfc315"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1998),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3ae5fc4a-1802-4e1d-88e1-1a18ec723c68"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2003),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e6bbb9ea-c7c5-46ec-a174-89321cb049f4"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2058),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("81b8d4c8-6ce9-45b4-8edf-420e9e7cc508"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2065),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3b73270a-83ea-4035-bc71-afcd2712b655"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2069),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("252166cd-7af1-4e13-9307-d49d67174ca0"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2084),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("ab889393-3213-491e-9a14-22ed8d5e2ec9"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2093),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("f793d715-08c4-4660-bb72-79c135d915fa"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2099),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("0fd99a93-afb1-4c95-bd45-6cac60d66c95"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2113),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("4a1d7dea-8658-4b83-ab55-3fa7d44acfca"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2123),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("58bc10ee-9c29-43f1-91ae-b47c230c074c"),
                            AssignedAt = new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2129),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeature", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619130505_UPdateTablePlanFeatureMatrix.cs  (sha256:26fb8a69ab1324e31227be87f39d8da48d2968e30881e1e63d1492a99e9a00cc)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class UPdateTablePlanFeatureMatrix : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("096be258-50ae-4078-b0b8-c26a084fd724"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0fd99a93-afb1-4c95-bd45-6cac60d66c95"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("252166cd-7af1-4e13-9307-d49d67174ca0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3ac31a18-ad13-4c36-b48b-809df1accbea"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3ae5fc4a-1802-4e1d-88e1-1a18ec723c68"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3b73270a-83ea-4035-bc71-afcd2712b655"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4a1d7dea-8658-4b83-ab55-3fa7d44acfca"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("58bc10ee-9c29-43f1-91ae-b47c230c074c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5974390a-3569-4e81-844a-eef6252ef7e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("81b8d4c8-6ce9-45b4-8edf-420e9e7cc508"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ab889393-3213-491e-9a14-22ed8d5e2ec9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf24b7f5-1cd6-4a11-ae7d-6cf51ef639b4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d93c4342-cb14-4ca7-a8f5-8b48689cb9d5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e6bbb9ea-c7c5-46ec-a174-89321cb049f4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e7be4659-3d78-46ee-ada0-d8daf6dfc315"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eaea5537-8ed7-4503-aa6e-e7d5e8cff0bb"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f793d715-08c4-4660-bb72-79c135d915fa"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4701));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4709));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4712));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4715));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4717));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4721));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4724));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4726));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4729));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4744));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4747));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("07503bb5-f5a3-48e0-916c-6310c7e132d6"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5306), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("0c898220-4231-4723-9bbf-304fe6447cd0"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5272), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("0e6bd3b2-5056-4cc3-97fd-a11e4e1e4a3e"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5212), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1198345c-c96c-44d4-9602-3d5382ea69c2"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5226), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2af188d1-7bd2-4eda-bc94-aea97e80d16e"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5260), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3a30a452-7f8c-4d6a-92f0-971393a2b3c5"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5255), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4283079b-7d1f-4184-bd9d-5341d110b461"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5279), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("7504e744-8b7a-4422-8cc2-287e3d771041"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5310), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("7f7bc705-2d45-43cc-815c-a8889a123721"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5295), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("9e2c8d5b-dc26-449d-b0bd-be663e09e61c"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5235), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a3f6f36e-4aa6-4a3f-ba9b-3205bc918f14"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5253), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b25ff30e-10d9-4b9d-bf52-30c92e49d3a7"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5263), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c8729359-8505-47ca-b4fc-5e80ce84e4c7"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5203), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cd29166e-6d07-4f88-bcac-b52eba3e40c8"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5231), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cdcd8d38-dbbc-49ee-a39d-026fa25f1eea"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5195), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e837feae-a731-4ab4-98d0-5441b93ed285"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5217), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("ff6899d1-69ff-4245-949c-2446bcf28ff4"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5276), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3868));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3871));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3872));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3874));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3875));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("07503bb5-f5a3-48e0-916c-6310c7e132d6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0c898220-4231-4723-9bbf-304fe6447cd0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0e6bd3b2-5056-4cc3-97fd-a11e4e1e4a3e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1198345c-c96c-44d4-9602-3d5382ea69c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2af188d1-7bd2-4eda-bc94-aea97e80d16e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3a30a452-7f8c-4d6a-92f0-971393a2b3c5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4283079b-7d1f-4184-bd9d-5341d110b461"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7504e744-8b7a-4422-8cc2-287e3d771041"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7f7bc705-2d45-43cc-815c-a8889a123721"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("9e2c8d5b-dc26-449d-b0bd-be663e09e61c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a3f6f36e-4aa6-4a3f-ba9b-3205bc918f14"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b25ff30e-10d9-4b9d-bf52-30c92e49d3a7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c8729359-8505-47ca-b4fc-5e80ce84e4c7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cd29166e-6d07-4f88-bcac-b52eba3e40c8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cdcd8d38-dbbc-49ee-a39d-026fa25f1eea"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e837feae-a731-4ab4-98d0-5441b93ed285"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ff6899d1-69ff-4245-949c-2446bcf28ff4"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1484));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1496));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1500));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1504));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1507));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1513));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1516));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1520));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1524));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1544));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1547));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("096be258-50ae-4078-b0b8-c26a084fd724"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1993), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("0fd99a93-afb1-4c95-bd45-6cac60d66c95"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2113), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("252166cd-7af1-4e13-9307-d49d67174ca0"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2084), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("3ac31a18-ad13-4c36-b48b-809df1accbea"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1987), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3ae5fc4a-1802-4e1d-88e1-1a18ec723c68"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2003), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3b73270a-83ea-4035-bc71-afcd2712b655"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2069), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4a1d7dea-8658-4b83-ab55-3fa7d44acfca"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2123), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("58bc10ee-9c29-43f1-91ae-b47c230c074c"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2129), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("5974390a-3569-4e81-844a-eef6252ef7e4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1966), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("81b8d4c8-6ce9-45b4-8edf-420e9e7cc508"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2065), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("ab889393-3213-491e-9a14-22ed8d5e2ec9"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2093), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("cf24b7f5-1cd6-4a11-ae7d-6cf51ef639b4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1934), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d93c4342-cb14-4ca7-a8f5-8b48689cb9d5"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1961), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e6bbb9ea-c7c5-46ec-a174-89321cb049f4"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2058), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e7be4659-3d78-46ee-ada0-d8daf6dfc315"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1998), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("eaea5537-8ed7-4503-aa6e-e7d5e8cff0bb"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(1955), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f793d715-08c4-4660-bb72-79c135d915fa"), new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(2099), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(346));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(350));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(352));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(354));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 12, 58, 3, 278, DateTimeKind.Utc).AddTicks(356));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250619130505_UPdateTablePlanFeatureMatrix.Designer.cs  (sha256:0938cd34750cea2adf124f72405261071a3460ad56f8e416f2503f446cb8620a)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250619130505_UPdateTablePlanFeatureMatrix")]
    partial class UPdateTablePlanFeatureMatrix
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4701),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4709),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4712),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4715),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4717),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4721),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4724),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4726),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4729),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4744),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4747),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3868),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3871),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3872),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3874),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3875),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("cdcd8d38-dbbc-49ee-a39d-026fa25f1eea"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5195),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("c8729359-8505-47ca-b4fc-5e80ce84e4c7"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5203),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("0e6bd3b2-5056-4cc3-97fd-a11e4e1e4a3e"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5212),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e837feae-a731-4ab4-98d0-5441b93ed285"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5217),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("1198345c-c96c-44d4-9602-3d5382ea69c2"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5226),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("cd29166e-6d07-4f88-bcac-b52eba3e40c8"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5231),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("9e2c8d5b-dc26-449d-b0bd-be663e09e61c"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5235),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a3f6f36e-4aa6-4a3f-ba9b-3205bc918f14"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5253),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3a30a452-7f8c-4d6a-92f0-971393a2b3c5"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5255),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2af188d1-7bd2-4eda-bc94-aea97e80d16e"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5260),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b25ff30e-10d9-4b9d-bf52-30c92e49d3a7"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5263),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("0c898220-4231-4723-9bbf-304fe6447cd0"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5272),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("ff6899d1-69ff-4245-949c-2446bcf28ff4"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5276),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("4283079b-7d1f-4184-bd9d-5341d110b461"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5279),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("7f7bc705-2d45-43cc-815c-a8889a123721"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5295),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("07503bb5-f5a3-48e0-916c-6310c7e132d6"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5306),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("7504e744-8b7a-4422-8cc2-287e3d771041"),
                            AssignedAt = new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5310),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250621073612_AddRefreshTokenSupport.cs  (sha256:065b07a1fa59c36ea7f823fd687444d54a87d3b9406fb6b9cad4f5eb9fadbfb1)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddRefreshTokenSupport : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("07503bb5-f5a3-48e0-916c-6310c7e132d6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0c898220-4231-4723-9bbf-304fe6447cd0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0e6bd3b2-5056-4cc3-97fd-a11e4e1e4a3e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1198345c-c96c-44d4-9602-3d5382ea69c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2af188d1-7bd2-4eda-bc94-aea97e80d16e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3a30a452-7f8c-4d6a-92f0-971393a2b3c5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4283079b-7d1f-4184-bd9d-5341d110b461"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7504e744-8b7a-4422-8cc2-287e3d771041"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7f7bc705-2d45-43cc-815c-a8889a123721"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("9e2c8d5b-dc26-449d-b0bd-be663e09e61c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a3f6f36e-4aa6-4a3f-ba9b-3205bc918f14"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b25ff30e-10d9-4b9d-bf52-30c92e49d3a7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c8729359-8505-47ca-b4fc-5e80ce84e4c7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cd29166e-6d07-4f88-bcac-b52eba3e40c8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cdcd8d38-dbbc-49ee-a39d-026fa25f1eea"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e837feae-a731-4ab4-98d0-5441b93ed285"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ff6899d1-69ff-4245-949c-2446bcf28ff4"));

            migrationBuilder.AddColumn<string>(
                name: "RefreshToken",
                table: "Users",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<DateTime>(
                name: "RefreshTokenExpiry",
                table: "Users",
                type: "timestamp with time zone",
                nullable: true);

            migrationBuilder.AddColumn<Guid>(
                name: "BusinessId",
                table: "UserFeatureAccess",
                type: "uuid",
                nullable: false,
                defaultValue: new Guid("00000000-0000-0000-0000-000000000000"));

            migrationBuilder.AddColumn<string>(
                name: "Description",
                table: "FeatureAccess",
                type: "character varying(200)",
                maxLength: 200,
                nullable: false,
                defaultValue: "");

            migrationBuilder.AddColumn<string>(
                name: "Group",
                table: "FeatureAccess",
                type: "character varying(50)",
                maxLength: 50,
                nullable: false,
                defaultValue: "");

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9532));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9542));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9545));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9547));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9550));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9554));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9609));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9612));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9616));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9629));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9631));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("0574c0c9-3f81-428d-af3a-d2a90fb35b8e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(111), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("08344dd6-c032-4918-a5ed-145f085617e0"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(101), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2dc90489-89ac-4877-b0df-869a7bf893ed"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(31), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3313278a-881c-4bb0-932f-adb0ef4f960e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(106), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("389c40b7-c1a8-4933-9b22-7a13099641e6"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(134), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("3f057e7a-e29b-4ca9-932b-6f5700c26eda"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(85), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("623c923e-ed8a-40e1-bdf2-75beadd7c3fd"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(77), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6fd53fe6-6790-4c93-9193-e40732e38797"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(137), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("76b5616e-cf3f-4a28-b434-a75380fa86a5"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(89), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7eae3e11-c8fb-4870-a688-1eb0b69f3fe6"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(52), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("90235fca-ea3a-4d87-9843-8120d6a248aa"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(56), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a3ff4e6d-c3db-47d0-8d5a-dc05a868bd21"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(23), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b5fa27ec-9cba-4d9e-9e7b-1914c6a1be5c"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(35), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b60da824-36e3-40c6-9dcc-254786b056d7"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(73), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c7ceb1c9-1bcf-41fc-8be3-5bb894ecd502"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(126), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("f50a2419-dcfa-42e1-9b5f-feed5cb19d55"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(39), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fc083ff6-22d7-45ff-a2ea-db995bf3634e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(81), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8739));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8742));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8744));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8745));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8747));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0574c0c9-3f81-428d-af3a-d2a90fb35b8e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("08344dd6-c032-4918-a5ed-145f085617e0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2dc90489-89ac-4877-b0df-869a7bf893ed"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3313278a-881c-4bb0-932f-adb0ef4f960e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("389c40b7-c1a8-4933-9b22-7a13099641e6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3f057e7a-e29b-4ca9-932b-6f5700c26eda"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("623c923e-ed8a-40e1-bdf2-75beadd7c3fd"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6fd53fe6-6790-4c93-9193-e40732e38797"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("76b5616e-cf3f-4a28-b434-a75380fa86a5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7eae3e11-c8fb-4870-a688-1eb0b69f3fe6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("90235fca-ea3a-4d87-9843-8120d6a248aa"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a3ff4e6d-c3db-47d0-8d5a-dc05a868bd21"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b5fa27ec-9cba-4d9e-9e7b-1914c6a1be5c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b60da824-36e3-40c6-9dcc-254786b056d7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c7ceb1c9-1bcf-41fc-8be3-5bb894ecd502"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f50a2419-dcfa-42e1-9b5f-feed5cb19d55"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fc083ff6-22d7-45ff-a2ea-db995bf3634e"));

            migrationBuilder.DropColumn(
                name: "RefreshToken",
                table: "Users");

            migrationBuilder.DropColumn(
                name: "RefreshTokenExpiry",
                table: "Users");

            migrationBuilder.DropColumn(
                name: "BusinessId",
                table: "UserFeatureAccess");

            migrationBuilder.DropColumn(
                name: "Description",
                table: "FeatureAccess");

            migrationBuilder.DropColumn(
                name: "Group",
                table: "FeatureAccess");

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4701));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4709));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4712));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4715));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4717));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4721));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4724));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4726));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4729));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4744));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(4747));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("07503bb5-f5a3-48e0-916c-6310c7e132d6"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5306), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("0c898220-4231-4723-9bbf-304fe6447cd0"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5272), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("0e6bd3b2-5056-4cc3-97fd-a11e4e1e4a3e"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5212), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1198345c-c96c-44d4-9602-3d5382ea69c2"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5226), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2af188d1-7bd2-4eda-bc94-aea97e80d16e"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5260), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3a30a452-7f8c-4d6a-92f0-971393a2b3c5"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5255), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4283079b-7d1f-4184-bd9d-5341d110b461"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5279), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("7504e744-8b7a-4422-8cc2-287e3d771041"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5310), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("7f7bc705-2d45-43cc-815c-a8889a123721"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5295), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("9e2c8d5b-dc26-449d-b0bd-be663e09e61c"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5235), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a3f6f36e-4aa6-4a3f-ba9b-3205bc918f14"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5253), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b25ff30e-10d9-4b9d-bf52-30c92e49d3a7"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5263), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c8729359-8505-47ca-b4fc-5e80ce84e4c7"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5203), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cd29166e-6d07-4f88-bcac-b52eba3e40c8"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5231), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cdcd8d38-dbbc-49ee-a39d-026fa25f1eea"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5195), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e837feae-a731-4ab4-98d0-5441b93ed285"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5217), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("ff6899d1-69ff-4245-949c-2446bcf28ff4"), new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(5276), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3868));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3871));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3872));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3874));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 19, 13, 5, 4, 368, DateTimeKind.Utc).AddTicks(3875));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250621073612_AddRefreshTokenSupport.Designer.cs  (sha256:3e1cb9fe47d7cc3e37406238cefff003bae5a6da8a73301c61c851a9d79b09aa)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250621073612_AddRefreshTokenSupport")]
    partial class AddRefreshTokenSupport
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9532),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9542),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9545),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9547),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9550),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9554),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9609),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9612),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9616),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9629),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9631),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8739),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8742),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8744),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8745),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8747),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("a3ff4e6d-c3db-47d0-8d5a-dc05a868bd21"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(23),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2dc90489-89ac-4877-b0df-869a7bf893ed"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(31),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b5fa27ec-9cba-4d9e-9e7b-1914c6a1be5c"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(35),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("f50a2419-dcfa-42e1-9b5f-feed5cb19d55"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(39),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("7eae3e11-c8fb-4870-a688-1eb0b69f3fe6"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(52),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("90235fca-ea3a-4d87-9843-8120d6a248aa"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(56),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b60da824-36e3-40c6-9dcc-254786b056d7"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(73),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("623c923e-ed8a-40e1-bdf2-75beadd7c3fd"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(77),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("fc083ff6-22d7-45ff-a2ea-db995bf3634e"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(81),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3f057e7a-e29b-4ca9-932b-6f5700c26eda"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(85),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("76b5616e-cf3f-4a28-b434-a75380fa86a5"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(89),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("08344dd6-c032-4918-a5ed-145f085617e0"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(101),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("3313278a-881c-4bb0-932f-adb0ef4f960e"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(106),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("0574c0c9-3f81-428d-af3a-d2a90fb35b8e"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(111),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("c7ceb1c9-1bcf-41fc-8be3-5bb894ecd502"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(126),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("389c40b7-c1a8-4933-9b22-7a13099641e6"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(134),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("6fd53fe6-6790-4c93-9193-e40732e38797"),
                            AssignedAt = new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(137),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250622062351_AddFeatureMasterTable.cs  (sha256:30dc91ef63aed3159b2f601d4197e1313317b0a35d0d2cb3076fc138078fd469)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddFeatureMasterTable : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0574c0c9-3f81-428d-af3a-d2a90fb35b8e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("08344dd6-c032-4918-a5ed-145f085617e0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2dc90489-89ac-4877-b0df-869a7bf893ed"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3313278a-881c-4bb0-932f-adb0ef4f960e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("389c40b7-c1a8-4933-9b22-7a13099641e6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3f057e7a-e29b-4ca9-932b-6f5700c26eda"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("623c923e-ed8a-40e1-bdf2-75beadd7c3fd"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("6fd53fe6-6790-4c93-9193-e40732e38797"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("76b5616e-cf3f-4a28-b434-a75380fa86a5"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7eae3e11-c8fb-4870-a688-1eb0b69f3fe6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("90235fca-ea3a-4d87-9843-8120d6a248aa"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a3ff4e6d-c3db-47d0-8d5a-dc05a868bd21"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b5fa27ec-9cba-4d9e-9e7b-1914c6a1be5c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b60da824-36e3-40c6-9dcc-254786b056d7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c7ceb1c9-1bcf-41fc-8be3-5bb894ecd502"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f50a2419-dcfa-42e1-9b5f-feed5cb19d55"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fc083ff6-22d7-45ff-a2ea-db995bf3634e"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3162));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3176));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3183));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3189));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3195));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3317));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3323));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3328));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3334));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3353));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3359));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("06eeda5f-6a80-43f6-ad18-0ffa7de3b82d"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4016), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1d69a371-aa3a-4c5c-8f89-854b77861a08"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3988), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1f98a6c6-dfa6-4199-b997-9a88a3592f93"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3935), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2647805a-3461-4fd0-9dc4-2b73e06ab436"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4103), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("31077fc3-8326-4a70-88e5-d02f4909b523"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3975), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("351db354-aa0a-4250-ab44-9c1ca3df05d4"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4047), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("410a4982-9970-411e-9fcd-a10403a66018"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4127), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("4f4dfc5f-13db-4287-bc1d-4800e5d08fe7"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4039), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5a665b77-9472-41fc-87af-75a7c1718a3e"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4023), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("84e7384c-5e71-4c66-9d29-97c299d806b8"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4066), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("aeab94b3-1bb2-470b-868d-8f25c69fce36"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4119), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("aedf4756-e1d0-4c34-bd96-dc58bff5e0a0"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3967), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c3855b1f-c41e-4807-bf68-1bbc24414225"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4073), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c65530da-5647-4dcb-b556-91b548ed188f"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4085), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("e71628db-a572-49ae-8898-695d0c7c6b22"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3959), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e89d8afd-00bd-4450-88d8-1ffbaf616163"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4009), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("eaca9399-e841-42eb-806c-e94fca09d80d"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4031), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2073));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2077));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2079));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2081));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2084));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("06eeda5f-6a80-43f6-ad18-0ffa7de3b82d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1d69a371-aa3a-4c5c-8f89-854b77861a08"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1f98a6c6-dfa6-4199-b997-9a88a3592f93"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2647805a-3461-4fd0-9dc4-2b73e06ab436"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31077fc3-8326-4a70-88e5-d02f4909b523"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("351db354-aa0a-4250-ab44-9c1ca3df05d4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("410a4982-9970-411e-9fcd-a10403a66018"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4f4dfc5f-13db-4287-bc1d-4800e5d08fe7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5a665b77-9472-41fc-87af-75a7c1718a3e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("84e7384c-5e71-4c66-9d29-97c299d806b8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aeab94b3-1bb2-470b-868d-8f25c69fce36"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aedf4756-e1d0-4c34-bd96-dc58bff5e0a0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c3855b1f-c41e-4807-bf68-1bbc24414225"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c65530da-5647-4dcb-b556-91b548ed188f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e71628db-a572-49ae-8898-695d0c7c6b22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e89d8afd-00bd-4450-88d8-1ffbaf616163"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eaca9399-e841-42eb-806c-e94fca09d80d"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9532));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9542));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9545));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9547));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9550));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9554));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9609));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9612));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9616));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9629));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(9631));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("0574c0c9-3f81-428d-af3a-d2a90fb35b8e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(111), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("08344dd6-c032-4918-a5ed-145f085617e0"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(101), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2dc90489-89ac-4877-b0df-869a7bf893ed"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(31), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3313278a-881c-4bb0-932f-adb0ef4f960e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(106), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("389c40b7-c1a8-4933-9b22-7a13099641e6"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(134), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("3f057e7a-e29b-4ca9-932b-6f5700c26eda"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(85), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("623c923e-ed8a-40e1-bdf2-75beadd7c3fd"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(77), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("6fd53fe6-6790-4c93-9193-e40732e38797"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(137), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("76b5616e-cf3f-4a28-b434-a75380fa86a5"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(89), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7eae3e11-c8fb-4870-a688-1eb0b69f3fe6"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(52), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("90235fca-ea3a-4d87-9843-8120d6a248aa"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(56), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a3ff4e6d-c3db-47d0-8d5a-dc05a868bd21"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(23), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b5fa27ec-9cba-4d9e-9e7b-1914c6a1be5c"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(35), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b60da824-36e3-40c6-9dcc-254786b056d7"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(73), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c7ceb1c9-1bcf-41fc-8be3-5bb894ecd502"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(126), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("f50a2419-dcfa-42e1-9b5f-feed5cb19d55"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(39), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fc083ff6-22d7-45ff-a2ea-db995bf3634e"), new DateTime(2025, 6, 21, 7, 36, 11, 863, DateTimeKind.Utc).AddTicks(81), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8739));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8742));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8744));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8745));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 21, 7, 36, 11, 862, DateTimeKind.Utc).AddTicks(8747));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250622062351_AddFeatureMasterTable.Designer.cs  (sha256:eb50fe2b8e9ada145b09111e222e0ab73671be87f94f403a093c10b4aa39fd2d)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250622062351_AddFeatureMasterTable")]
    partial class AddFeatureMasterTable
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3162),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3176),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3183),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3189),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3195),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3317),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3323),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3328),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3334),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3353),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3359),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2073),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2077),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2079),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2081),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2084),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("1f98a6c6-dfa6-4199-b997-9a88a3592f93"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3935),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e71628db-a572-49ae-8898-695d0c7c6b22"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3959),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("aedf4756-e1d0-4c34-bd96-dc58bff5e0a0"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3967),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("31077fc3-8326-4a70-88e5-d02f4909b523"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3975),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("1d69a371-aa3a-4c5c-8f89-854b77861a08"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3988),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e89d8afd-00bd-4450-88d8-1ffbaf616163"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4009),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("06eeda5f-6a80-43f6-ad18-0ffa7de3b82d"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4016),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("5a665b77-9472-41fc-87af-75a7c1718a3e"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4023),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("eaca9399-e841-42eb-806c-e94fca09d80d"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4031),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("4f4dfc5f-13db-4287-bc1d-4800e5d08fe7"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4039),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("351db354-aa0a-4250-ab44-9c1ca3df05d4"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4047),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("84e7384c-5e71-4c66-9d29-97c299d806b8"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4066),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("c3855b1f-c41e-4807-bf68-1bbc24414225"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4073),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("c65530da-5647-4dcb-b556-91b548ed188f"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4085),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("2647805a-3461-4fd0-9dc4-2b73e06ab436"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4103),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("aeab94b3-1bb2-470b-868d-8f25c69fce36"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4119),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("410a4982-9970-411e-9fcd-a10403a66018"),
                            AssignedAt = new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4127),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250622070448_AddFeatureMasterTable1.cs  (sha256:ba6e08ea0f83d3c2e9a29f4d014397fe5f7af02b32990f80ca4d318b7bc74f34)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddFeatureMasterTable1 : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("06eeda5f-6a80-43f6-ad18-0ffa7de3b82d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1d69a371-aa3a-4c5c-8f89-854b77861a08"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1f98a6c6-dfa6-4199-b997-9a88a3592f93"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2647805a-3461-4fd0-9dc4-2b73e06ab436"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31077fc3-8326-4a70-88e5-d02f4909b523"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("351db354-aa0a-4250-ab44-9c1ca3df05d4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("410a4982-9970-411e-9fcd-a10403a66018"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4f4dfc5f-13db-4287-bc1d-4800e5d08fe7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5a665b77-9472-41fc-87af-75a7c1718a3e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("84e7384c-5e71-4c66-9d29-97c299d806b8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aeab94b3-1bb2-470b-868d-8f25c69fce36"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aedf4756-e1d0-4c34-bd96-dc58bff5e0a0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c3855b1f-c41e-4807-bf68-1bbc24414225"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c65530da-5647-4dcb-b556-91b548ed188f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e71628db-a572-49ae-8898-695d0c7c6b22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e89d8afd-00bd-4450-88d8-1ffbaf616163"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("eaca9399-e841-42eb-806c-e94fca09d80d"));

            migrationBuilder.AddColumn<string>(
                name: "Plan",
                table: "FeatureAccess",
                type: "text",
                nullable: true);

            migrationBuilder.CreateTable(
                name: "FeatureMaster",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    FeatureCode = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: false),
                    DisplayName = table.Column<string>(type: "character varying(100)", maxLength: 100, nullable: false),
                    Description = table.Column<string>(type: "character varying(250)", maxLength: 250, nullable: false),
                    Group = table.Column<string>(type: "character varying(50)", maxLength: 50, nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FeatureMaster", x => x.Id);
                });

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2832));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2845));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2849));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2852));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2855));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2859));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2862));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2865));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2868));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2991));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2995));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("1418e3c7-df29-4ae2-aa27-2ef426f1933c"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4384), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("1c5228fa-c7cd-407a-9933-0f09eb3a554f"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4367), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1e5a3b00-04aa-49ab-8174-6ddacb25726d"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4405), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("24262200-285e-4aa6-a065-4c5a49ddc8ac"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4389), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("41d4a538-2ca3-4e67-a336-c52b22fb9b0a"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4324), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("56e48877-6772-4be4-a827-63bc8f5242c2"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4393), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("8bd44ca4-27ea-41d4-835b-8659095ad6c8"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4318), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a8aea059-6ff2-42ad-a155-219ce78916b3"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4361), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a98dfe68-3b7f-4a68-b5a8-8e931896206b"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4349), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("bb77f0eb-50a9-49b0-9f29-154872e2970d"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4422), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("c574e6a2-495c-41cf-8aa4-5f9760d83baf"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4371), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cab676a7-df99-4eaa-bb3d-dfdec1e7ac39"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4344), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cf233a37-a64c-4ae2-aeb1-bf5c4bd642e3"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4354), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d18e4159-67dd-490b-9dd1-fb5685e5073a"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4338), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dcb05ff3-470d-43d9-8af9-0324c2eba91c"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4415), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("dd3a681f-d5f5-47bb-be92-44f360fce9f7"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4308), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fadff09e-9b6a-44e6-9e1a-07cc6a9c3722"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4327), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1619));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1622));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1624));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1626));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1627));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "FeatureMaster");

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1418e3c7-df29-4ae2-aa27-2ef426f1933c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1c5228fa-c7cd-407a-9933-0f09eb3a554f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1e5a3b00-04aa-49ab-8174-6ddacb25726d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("24262200-285e-4aa6-a065-4c5a49ddc8ac"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("41d4a538-2ca3-4e67-a336-c52b22fb9b0a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("56e48877-6772-4be4-a827-63bc8f5242c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8bd44ca4-27ea-41d4-835b-8659095ad6c8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a8aea059-6ff2-42ad-a155-219ce78916b3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a98dfe68-3b7f-4a68-b5a8-8e931896206b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("bb77f0eb-50a9-49b0-9f29-154872e2970d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c574e6a2-495c-41cf-8aa4-5f9760d83baf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cab676a7-df99-4eaa-bb3d-dfdec1e7ac39"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf233a37-a64c-4ae2-aeb1-bf5c4bd642e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d18e4159-67dd-490b-9dd1-fb5685e5073a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcb05ff3-470d-43d9-8af9-0324c2eba91c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dd3a681f-d5f5-47bb-be92-44f360fce9f7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fadff09e-9b6a-44e6-9e1a-07cc6a9c3722"));

            migrationBuilder.DropColumn(
                name: "Plan",
                table: "FeatureAccess");

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3162));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3176));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3183));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3189));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3195));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3317));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3323));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3328));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3334));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3353));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3359));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("06eeda5f-6a80-43f6-ad18-0ffa7de3b82d"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4016), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1d69a371-aa3a-4c5c-8f89-854b77861a08"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3988), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1f98a6c6-dfa6-4199-b997-9a88a3592f93"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3935), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2647805a-3461-4fd0-9dc4-2b73e06ab436"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4103), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("31077fc3-8326-4a70-88e5-d02f4909b523"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3975), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("351db354-aa0a-4250-ab44-9c1ca3df05d4"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4047), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("410a4982-9970-411e-9fcd-a10403a66018"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4127), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("4f4dfc5f-13db-4287-bc1d-4800e5d08fe7"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4039), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5a665b77-9472-41fc-87af-75a7c1718a3e"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4023), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("84e7384c-5e71-4c66-9d29-97c299d806b8"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4066), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("aeab94b3-1bb2-470b-868d-8f25c69fce36"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4119), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("aedf4756-e1d0-4c34-bd96-dc58bff5e0a0"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3967), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("c3855b1f-c41e-4807-bf68-1bbc24414225"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4073), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c65530da-5647-4dcb-b556-91b548ed188f"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4085), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("e71628db-a572-49ae-8898-695d0c7c6b22"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(3959), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e89d8afd-00bd-4450-88d8-1ffbaf616163"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4009), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("eaca9399-e841-42eb-806c-e94fca09d80d"), new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(4031), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2073));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2077));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2079));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2081));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 6, 23, 49, 975, DateTimeKind.Utc).AddTicks(2084));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250622070448_AddFeatureMasterTable1.Designer.cs  (sha256:a32c0a8ac92ef9119974d0dc0f71d57f21a2987d1f115f23cc9a75beed01168b)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250622070448_AddFeatureMasterTable1")]
    partial class AddFeatureMasterTable1
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2832),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2845),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2849),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2852),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2855),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2859),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2862),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2865),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2868),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2991),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2995),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1619),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1622),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1624),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1626),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1627),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("dd3a681f-d5f5-47bb-be92-44f360fce9f7"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4308),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("8bd44ca4-27ea-41d4-835b-8659095ad6c8"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4318),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("41d4a538-2ca3-4e67-a336-c52b22fb9b0a"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4324),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("fadff09e-9b6a-44e6-9e1a-07cc6a9c3722"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4327),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d18e4159-67dd-490b-9dd1-fb5685e5073a"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4338),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("cab676a7-df99-4eaa-bb3d-dfdec1e7ac39"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4344),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a98dfe68-3b7f-4a68-b5a8-8e931896206b"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4349),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("cf233a37-a64c-4ae2-aeb1-bf5c4bd642e3"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4354),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a8aea059-6ff2-42ad-a155-219ce78916b3"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4361),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("1c5228fa-c7cd-407a-9933-0f09eb3a554f"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4367),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("c574e6a2-495c-41cf-8aa4-5f9760d83baf"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4371),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("1418e3c7-df29-4ae2-aa27-2ef426f1933c"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4384),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("24262200-285e-4aa6-a065-4c5a49ddc8ac"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4389),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("56e48877-6772-4be4-a827-63bc8f5242c2"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4393),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("1e5a3b00-04aa-49ab-8174-6ddacb25726d"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4405),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("dcb05ff3-470d-43d9-8af9-0324c2eba91c"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4415),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("bb77f0eb-50a9-49b0-9f29-154872e2970d"),
                            AssignedAt = new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4422),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250704093133_AddIndustryToAutoReplyRule.cs  (sha256:5b67fe185444f3f1fc33ace7b1f05914d882d2387f37d1379f5c7911cb7b44f8)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddIndustryToAutoReplyRule : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1418e3c7-df29-4ae2-aa27-2ef426f1933c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1c5228fa-c7cd-407a-9933-0f09eb3a554f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("1e5a3b00-04aa-49ab-8174-6ddacb25726d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("24262200-285e-4aa6-a065-4c5a49ddc8ac"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("41d4a538-2ca3-4e67-a336-c52b22fb9b0a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("56e48877-6772-4be4-a827-63bc8f5242c2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8bd44ca4-27ea-41d4-835b-8659095ad6c8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a8aea059-6ff2-42ad-a155-219ce78916b3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a98dfe68-3b7f-4a68-b5a8-8e931896206b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("bb77f0eb-50a9-49b0-9f29-154872e2970d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c574e6a2-495c-41cf-8aa4-5f9760d83baf"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cab676a7-df99-4eaa-bb3d-dfdec1e7ac39"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf233a37-a64c-4ae2-aeb1-bf5c4bd642e3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d18e4159-67dd-490b-9dd1-fb5685e5073a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dcb05ff3-470d-43d9-8af9-0324c2eba91c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dd3a681f-d5f5-47bb-be92-44f360fce9f7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("fadff09e-9b6a-44e6-9e1a-07cc6a9c3722"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2785));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2793));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2796));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2798));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2801));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2805));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2807));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2810));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2813));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2816));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2819));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("08e81e86-af2e-44e7-aa98-96ddbb265fd4"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3320), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("104a4dec-d683-4af5-b817-5d89b2ae09c0"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3282), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("170baea8-4ee1-433c-ae9a-bc9cb7db938f"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3303), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2fb759a5-ff0d-417f-bb97-bd4483b70a22"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3296), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("31bd93dc-41dc-4409-8d30-b1c5996624f9"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3268), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("37991ff4-bae2-408a-9a00-028fadc69810"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3286), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3bb13eca-7657-4609-ae59-15ef6b008b29"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3271), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4ad7df90-e52f-4dc5-aef8-1a7c0c70e673"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3259), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5633443a-4b94-4adf-af7b-7c59c990c42d"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3306), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("665cf6fe-9022-4367-8474-90954e49b350"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3247), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("697a8ab6-5898-4ed6-8114-611f34ddc7e8"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3300), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("943e78ee-02dc-495e-a212-b3f037b742c7"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3251), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a64bfba6-28df-42e4-94f0-c14a37c081b7"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3237), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a71bc075-0ae0-4903-b0bd-3c5e834eb092"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3314), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("a8768168-5817-4ec6-8558-72508caf72d8"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3255), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cf227764-e3bc-4c10-a73a-f104c99b5fc2"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3263), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d585ad3d-c3bc-4d6a-ad03-15bb1bcc61c1"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3277), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2138));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2139));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2141));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2142));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2143));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("08e81e86-af2e-44e7-aa98-96ddbb265fd4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("104a4dec-d683-4af5-b817-5d89b2ae09c0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("170baea8-4ee1-433c-ae9a-bc9cb7db938f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2fb759a5-ff0d-417f-bb97-bd4483b70a22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31bd93dc-41dc-4409-8d30-b1c5996624f9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("37991ff4-bae2-408a-9a00-028fadc69810"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3bb13eca-7657-4609-ae59-15ef6b008b29"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4ad7df90-e52f-4dc5-aef8-1a7c0c70e673"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5633443a-4b94-4adf-af7b-7c59c990c42d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("665cf6fe-9022-4367-8474-90954e49b350"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("697a8ab6-5898-4ed6-8114-611f34ddc7e8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("943e78ee-02dc-495e-a212-b3f037b742c7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a64bfba6-28df-42e4-94f0-c14a37c081b7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a71bc075-0ae0-4903-b0bd-3c5e834eb092"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a8768168-5817-4ec6-8558-72508caf72d8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf227764-e3bc-4c10-a73a-f104c99b5fc2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d585ad3d-c3bc-4d6a-ad03-15bb1bcc61c1"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2832));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2845));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2849));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2852));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2855));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2859));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2862));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2865));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2868));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2991));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(2995));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("1418e3c7-df29-4ae2-aa27-2ef426f1933c"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4384), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("1c5228fa-c7cd-407a-9933-0f09eb3a554f"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4367), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("1e5a3b00-04aa-49ab-8174-6ddacb25726d"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4405), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("24262200-285e-4aa6-a065-4c5a49ddc8ac"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4389), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("41d4a538-2ca3-4e67-a336-c52b22fb9b0a"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4324), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("56e48877-6772-4be4-a827-63bc8f5242c2"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4393), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("8bd44ca4-27ea-41d4-835b-8659095ad6c8"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4318), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a8aea059-6ff2-42ad-a155-219ce78916b3"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4361), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a98dfe68-3b7f-4a68-b5a8-8e931896206b"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4349), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("bb77f0eb-50a9-49b0-9f29-154872e2970d"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4422), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("c574e6a2-495c-41cf-8aa4-5f9760d83baf"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4371), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cab676a7-df99-4eaa-bb3d-dfdec1e7ac39"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4344), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cf233a37-a64c-4ae2-aeb1-bf5c4bd642e3"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4354), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d18e4159-67dd-490b-9dd1-fb5685e5073a"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4338), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dcb05ff3-470d-43d9-8af9-0324c2eba91c"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4415), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("dd3a681f-d5f5-47bb-be92-44f360fce9f7"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4308), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("fadff09e-9b6a-44e6-9e1a-07cc6a9c3722"), new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(4327), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1619));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1622));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1624));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1626));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 6, 22, 7, 4, 47, 251, DateTimeKind.Utc).AddTicks(1627));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250704093133_AddIndustryToAutoReplyRule.Designer.cs  (sha256:7e213ed137dc4a0a61961478314d5feb46f59aaaefc9716e5d8630d42a5289e9)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250704093133_AddIndustryToAutoReplyRule")]
    partial class AddIndustryToAutoReplyRule
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2785),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2793),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2796),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2798),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2801),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2805),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2807),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2810),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2813),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2816),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2819),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2138),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2139),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2141),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2142),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2143),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("a64bfba6-28df-42e4-94f0-c14a37c081b7"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3237),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("665cf6fe-9022-4367-8474-90954e49b350"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3247),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("943e78ee-02dc-495e-a212-b3f037b742c7"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3251),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a8768168-5817-4ec6-8558-72508caf72d8"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3255),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("4ad7df90-e52f-4dc5-aef8-1a7c0c70e673"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3259),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("cf227764-e3bc-4c10-a73a-f104c99b5fc2"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3263),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("31bd93dc-41dc-4409-8d30-b1c5996624f9"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3268),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3bb13eca-7657-4609-ae59-15ef6b008b29"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3271),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d585ad3d-c3bc-4d6a-ad03-15bb1bcc61c1"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3277),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("104a4dec-d683-4af5-b817-5d89b2ae09c0"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3282),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("37991ff4-bae2-408a-9a00-028fadc69810"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3286),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2fb759a5-ff0d-417f-bb97-bd4483b70a22"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3296),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("697a8ab6-5898-4ed6-8114-611f34ddc7e8"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3300),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("170baea8-4ee1-433c-ae9a-bc9cb7db938f"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3303),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("5633443a-4b94-4adf-af7b-7c59c990c42d"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3306),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("a71bc075-0ae0-4903-b0bd-3c5e834eb092"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3314),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("08e81e86-af2e-44e7-aa98-96ddbb265fd4"),
                            AssignedAt = new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3320),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250704155618_AddAutomationFlowModel.cs  (sha256:892c88528842503eaf5b927354fff640d5fa2349990248aeaf4979d6a1513b77)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class AddAutomationFlowModel : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("08e81e86-af2e-44e7-aa98-96ddbb265fd4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("104a4dec-d683-4af5-b817-5d89b2ae09c0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("170baea8-4ee1-433c-ae9a-bc9cb7db938f"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2fb759a5-ff0d-417f-bb97-bd4483b70a22"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31bd93dc-41dc-4409-8d30-b1c5996624f9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("37991ff4-bae2-408a-9a00-028fadc69810"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3bb13eca-7657-4609-ae59-15ef6b008b29"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4ad7df90-e52f-4dc5-aef8-1a7c0c70e673"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5633443a-4b94-4adf-af7b-7c59c990c42d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("665cf6fe-9022-4367-8474-90954e49b350"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("697a8ab6-5898-4ed6-8114-611f34ddc7e8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("943e78ee-02dc-495e-a212-b3f037b742c7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a64bfba6-28df-42e4-94f0-c14a37c081b7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a71bc075-0ae0-4903-b0bd-3c5e834eb092"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a8768168-5817-4ec6-8558-72508caf72d8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cf227764-e3bc-4c10-a73a-f104c99b5fc2"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d585ad3d-c3bc-4d6a-ad03-15bb1bcc61c1"));

            migrationBuilder.AddColumn<string>(
                name: "IndustryTag",
                table: "AutoReplyRules",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<string>(
                name: "SourceChannel",
                table: "AutoReplyRules",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<string>(
                name: "IndustryTag",
                table: "AutoReplyFlows",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<bool>(
                name: "IsDefaultTemplate",
                table: "AutoReplyFlows",
                type: "boolean",
                nullable: false,
                defaultValue: false);

            migrationBuilder.AddColumn<string>(
                name: "Keyword",
                table: "AutoReplyFlows",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<string>(
                name: "UseCase",
                table: "AutoReplyFlows",
                type: "text",
                nullable: true);

            migrationBuilder.AddColumn<string>(
                name: "NodeName",
                table: "AutoReplyFlowNodes",
                type: "text",
                nullable: true);

            migrationBuilder.CreateTable(
                name: "AutomationFlows",
                columns: table => new
                {
                    Id = table.Column<Guid>(type: "uuid", nullable: false),
                    BusinessId = table.Column<Guid>(type: "uuid", nullable: false),
                    Name = table.Column<string>(type: "text", nullable: false),
                    TriggerKeyword = table.Column<string>(type: "text", nullable: false),
                    NodesJson = table.Column<string>(type: "text", nullable: false),
                    EdgesJson = table.Column<string>(type: "text", nullable: false),
                    IsActive = table.Column<bool>(type: "boolean", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "timestamp with time zone", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AutomationFlows", x => x.Id);
                });

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4986));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4993));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4995));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4997));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4999));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5001));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5003));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5004));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5056));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5059));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5061));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("02972145-3fb4-4821-b138-55529fc14140"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5405), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2741a9c5-759a-4d7d-bd75-19b39830fb1d"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5373), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2f815ab0-7114-4d1e-8c11-928a7a1ff3e1"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5443), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("31551594-28e8-4307-9ff4-c88c90b8e41e"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5411), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3d68c643-c06a-4d8e-906d-67e431fb8dae"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5425), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("418cb051-994a-4227-8191-91f333d022c4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5432), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("4559c220-b214-4867-a5ef-420dfd537530"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5377), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4a7c82bd-282e-4d7f-b06e-942961c578e4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5429), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("4fe0af17-0bce-4ad8-a006-682780ce8e75"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5402), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7f139177-7fec-4f69-ba2a-bff27989f456"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5414), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8f8abd40-9e1c-46d5-af37-3e718062b56b"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5446), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("aaff6051-9a29-4693-8587-ec86d1713328"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5366), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aec7e2bc-bf4c-4a5a-805a-a081da6fc861"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5437), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c6128b15-63a3-4cad-97ca-50d153cd97b9"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5384), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dda31ae1-dfd6-42e4-9d47-8de18e30e67c"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5381), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e7332033-fb8e-4ee9-8486-fbc8698c37f8"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5408), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f6fdc533-cf5c-43c3-9906-8437105d0df4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5387), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4408));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4409));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4411));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4412));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4413));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "AutomationFlows");

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("02972145-3fb4-4821-b138-55529fc14140"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2741a9c5-759a-4d7d-bd75-19b39830fb1d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2f815ab0-7114-4d1e-8c11-928a7a1ff3e1"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31551594-28e8-4307-9ff4-c88c90b8e41e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3d68c643-c06a-4d8e-906d-67e431fb8dae"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("418cb051-994a-4227-8191-91f333d022c4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4559c220-b214-4867-a5ef-420dfd537530"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4a7c82bd-282e-4d7f-b06e-942961c578e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4fe0af17-0bce-4ad8-a006-682780ce8e75"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7f139177-7fec-4f69-ba2a-bff27989f456"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8f8abd40-9e1c-46d5-af37-3e718062b56b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aaff6051-9a29-4693-8587-ec86d1713328"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aec7e2bc-bf4c-4a5a-805a-a081da6fc861"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c6128b15-63a3-4cad-97ca-50d153cd97b9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dda31ae1-dfd6-42e4-9d47-8de18e30e67c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e7332033-fb8e-4ee9-8486-fbc8698c37f8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f6fdc533-cf5c-43c3-9906-8437105d0df4"));

            migrationBuilder.DropColumn(
                name: "IndustryTag",
                table: "AutoReplyRules");

            migrationBuilder.DropColumn(
                name: "SourceChannel",
                table: "AutoReplyRules");

            migrationBuilder.DropColumn(
                name: "IndustryTag",
                table: "AutoReplyFlows");

            migrationBuilder.DropColumn(
                name: "IsDefaultTemplate",
                table: "AutoReplyFlows");

            migrationBuilder.DropColumn(
                name: "Keyword",
                table: "AutoReplyFlows");

            migrationBuilder.DropColumn(
                name: "UseCase",
                table: "AutoReplyFlows");

            migrationBuilder.DropColumn(
                name: "NodeName",
                table: "AutoReplyFlowNodes");

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2785));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2793));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2796));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2798));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2801));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2805));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2807));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2810));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2813));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2816));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2819));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("08e81e86-af2e-44e7-aa98-96ddbb265fd4"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3320), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("104a4dec-d683-4af5-b817-5d89b2ae09c0"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3282), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("170baea8-4ee1-433c-ae9a-bc9cb7db938f"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3303), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("2fb759a5-ff0d-417f-bb97-bd4483b70a22"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3296), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("31bd93dc-41dc-4409-8d30-b1c5996624f9"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3268), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("37991ff4-bae2-408a-9a00-028fadc69810"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3286), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3bb13eca-7657-4609-ae59-15ef6b008b29"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3271), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4ad7df90-e52f-4dc5-aef8-1a7c0c70e673"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3259), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5633443a-4b94-4adf-af7b-7c59c990c42d"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3306), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("665cf6fe-9022-4367-8474-90954e49b350"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3247), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("697a8ab6-5898-4ed6-8114-611f34ddc7e8"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3300), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("943e78ee-02dc-495e-a212-b3f037b742c7"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3251), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a64bfba6-28df-42e4-94f0-c14a37c081b7"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3237), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a71bc075-0ae0-4903-b0bd-3c5e834eb092"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3314), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("a8768168-5817-4ec6-8558-72508caf72d8"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3255), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("cf227764-e3bc-4c10-a73a-f104c99b5fc2"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3263), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d585ad3d-c3bc-4d6a-ad03-15bb1bcc61c1"), new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(3277), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2138));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2139));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2141));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2142));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 9, 31, 32, 982, DateTimeKind.Utc).AddTicks(2143));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250704155618_AddAutomationFlowModel.Designer.cs  (sha256:b8f7a4b51f080f25a92bc0e3f70d8474de458062056f4790acc9cde013814dea)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250704155618_AddAutomationFlowModel")]
    partial class AddAutomationFlowModel
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.15")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4986),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4993),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4995),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4997),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4999),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5001),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5003),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5004),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5056),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5059),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5061),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4408),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4409),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4411),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4412),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4413),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("aaff6051-9a29-4693-8587-ec86d1713328"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5366),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2741a9c5-759a-4d7d-bd75-19b39830fb1d"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5373),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("4559c220-b214-4867-a5ef-420dfd537530"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5377),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("dda31ae1-dfd6-42e4-9d47-8de18e30e67c"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5381),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("c6128b15-63a3-4cad-97ca-50d153cd97b9"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5384),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("f6fdc533-cf5c-43c3-9906-8437105d0df4"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5387),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("4fe0af17-0bce-4ad8-a006-682780ce8e75"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5402),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("02972145-3fb4-4821-b138-55529fc14140"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5405),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e7332033-fb8e-4ee9-8486-fbc8698c37f8"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5408),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("31551594-28e8-4307-9ff4-c88c90b8e41e"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5411),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("7f139177-7fec-4f69-ba2a-bff27989f456"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5414),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("3d68c643-c06a-4d8e-906d-67e431fb8dae"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5425),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("4a7c82bd-282e-4d7f-b06e-942961c578e4"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5429),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("418cb051-994a-4227-8191-91f333d022c4"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5432),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("aec7e2bc-bf4c-4a5a-805a-a081da6fc861"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5437),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("2f815ab0-7114-4d1e-8c11-928a7a1ff3e1"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5443),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("8f8abd40-9e1c-46d5-af37-3e718062b56b"),
                            AssignedAt = new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5446),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDefaultTemplate")
                        .HasColumnType("boolean");

                    b.Property<string>("Keyword")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.Property<string>("UseCase")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeName")
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.Automation.Models.AutomationFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutomationFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250806080314_InitialCreate.cs  (sha256:d9d8254c7a056048f1942ee9091271abfc51d3db0ef12cfa4b1312d30ab1348e)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class InitialCreate : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("02972145-3fb4-4821-b138-55529fc14140"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2741a9c5-759a-4d7d-bd75-19b39830fb1d"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2f815ab0-7114-4d1e-8c11-928a7a1ff3e1"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("31551594-28e8-4307-9ff4-c88c90b8e41e"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("3d68c643-c06a-4d8e-906d-67e431fb8dae"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("418cb051-994a-4227-8191-91f333d022c4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4559c220-b214-4867-a5ef-420dfd537530"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4a7c82bd-282e-4d7f-b06e-942961c578e4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("4fe0af17-0bce-4ad8-a006-682780ce8e75"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("7f139177-7fec-4f69-ba2a-bff27989f456"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8f8abd40-9e1c-46d5-af37-3e718062b56b"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aaff6051-9a29-4693-8587-ec86d1713328"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aec7e2bc-bf4c-4a5a-805a-a081da6fc861"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("c6128b15-63a3-4cad-97ca-50d153cd97b9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("dda31ae1-dfd6-42e4-9d47-8de18e30e67c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e7332033-fb8e-4ee9-8486-fbc8698c37f8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f6fdc533-cf5c-43c3-9906-8437105d0df4"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5111));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5118));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5120));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5122));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5124));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5127));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5130));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5132));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5135));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5138));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5179));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("0478c3a5-283b-442d-a51d-909c2b0172d3"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5559), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("0759059d-e71d-4198-b3b9-58d12c8200f9"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5539), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("15b8aca8-7fb9-4e9f-8f59-9e88bd26b0ec"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5524), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("18c92b80-4c5e-4d54-b364-8b3953000241"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5515), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("251c0b3d-3bb2-4e11-a64f-190d457306d0"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5509), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("40fe8966-eefb-43ef-b8ca-677f107d33dc"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5535), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5f2a715d-4a83-4669-b42c-1df495d349b8"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5554), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("65ffa364-2c5a-45e0-af28-5a1730dc9d94"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5551), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("8ce09038-350b-4f34-9467-38ba611c61bd"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5569), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("8e58d8a5-dc1f-4fb9-9198-f868ae63fc70"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5542), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a471818e-7c64-4c7f-869c-545938ad9217"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5533), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aa7bf421-9fdc-4a77-b822-29b6a5a1c131"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5518), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("af77b30e-d9b4-4052-b378-4b862fe1a86c"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5512), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b30d4433-c4b8-4131-8072-bb52a720f964"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5572), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("cddcfa62-e4bb-4433-83fa-42bce5951025"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5499), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e0e5dc1c-9235-4fa8-863d-8a57c01e8a24"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5522), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f6933ae2-c83d-4652-bdd6-559684858967"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5557), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3900));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3902));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3904));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3905));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3906));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0478c3a5-283b-442d-a51d-909c2b0172d3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0759059d-e71d-4198-b3b9-58d12c8200f9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("15b8aca8-7fb9-4e9f-8f59-9e88bd26b0ec"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("18c92b80-4c5e-4d54-b364-8b3953000241"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("251c0b3d-3bb2-4e11-a64f-190d457306d0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("40fe8966-eefb-43ef-b8ca-677f107d33dc"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5f2a715d-4a83-4669-b42c-1df495d349b8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("65ffa364-2c5a-45e0-af28-5a1730dc9d94"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8ce09038-350b-4f34-9467-38ba611c61bd"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8e58d8a5-dc1f-4fb9-9198-f868ae63fc70"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a471818e-7c64-4c7f-869c-545938ad9217"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa7bf421-9fdc-4a77-b822-29b6a5a1c131"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("af77b30e-d9b4-4052-b378-4b862fe1a86c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b30d4433-c4b8-4131-8072-bb52a720f964"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cddcfa62-e4bb-4433-83fa-42bce5951025"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0e5dc1c-9235-4fa8-863d-8a57c01e8a24"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f6933ae2-c83d-4652-bdd6-559684858967"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4986));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4993));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4995));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4997));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4999));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5001));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5003));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5004));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5056));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5059));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5061));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("02972145-3fb4-4821-b138-55529fc14140"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5405), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2741a9c5-759a-4d7d-bd75-19b39830fb1d"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5373), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2f815ab0-7114-4d1e-8c11-928a7a1ff3e1"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5443), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("31551594-28e8-4307-9ff4-c88c90b8e41e"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5411), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("3d68c643-c06a-4d8e-906d-67e431fb8dae"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5425), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("418cb051-994a-4227-8191-91f333d022c4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5432), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("4559c220-b214-4867-a5ef-420dfd537530"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5377), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("4a7c82bd-282e-4d7f-b06e-942961c578e4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5429), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("4fe0af17-0bce-4ad8-a006-682780ce8e75"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5402), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("7f139177-7fec-4f69-ba2a-bff27989f456"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5414), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8f8abd40-9e1c-46d5-af37-3e718062b56b"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5446), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("aaff6051-9a29-4693-8587-ec86d1713328"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5366), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aec7e2bc-bf4c-4a5a-805a-a081da6fc861"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5437), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("c6128b15-63a3-4cad-97ca-50d153cd97b9"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5384), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("dda31ae1-dfd6-42e4-9d47-8de18e30e67c"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5381), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e7332033-fb8e-4ee9-8486-fbc8698c37f8"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5408), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f6fdc533-cf5c-43c3-9906-8437105d0df4"), new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(5387), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4408));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4409));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4411));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4412));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 7, 4, 15, 56, 17, 413, DateTimeKind.Utc).AddTicks(4413));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250806080314_InitialCreate.Designer.cs  (sha256:e1fd133edf1d3a46177b12b8ebddc4ea836c8b51500e81b51214549e563fd6a4)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250806080314_InitialCreate")]
    partial class InitialCreate
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.18")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5111),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5118),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5120),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5122),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5124),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5127),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5130),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5132),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5135),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5138),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5179),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3900),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3902),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3904),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3905),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3906),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("cddcfa62-e4bb-4433-83fa-42bce5951025"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5499),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("251c0b3d-3bb2-4e11-a64f-190d457306d0"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5509),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("af77b30e-d9b4-4052-b378-4b862fe1a86c"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5512),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("18c92b80-4c5e-4d54-b364-8b3953000241"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5515),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("aa7bf421-9fdc-4a77-b822-29b6a5a1c131"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5518),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("e0e5dc1c-9235-4fa8-863d-8a57c01e8a24"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5522),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("15b8aca8-7fb9-4e9f-8f59-9e88bd26b0ec"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5524),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a471818e-7c64-4c7f-869c-545938ad9217"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5533),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("40fe8966-eefb-43ef-b8ca-677f107d33dc"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5535),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("0759059d-e71d-4198-b3b9-58d12c8200f9"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5539),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("8e58d8a5-dc1f-4fb9-9198-f868ae63fc70"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5542),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("65ffa364-2c5a-45e0-af28-5a1730dc9d94"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5551),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("5f2a715d-4a83-4669-b42c-1df495d349b8"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5554),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("f6933ae2-c83d-4652-bdd6-559684858967"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5557),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("0478c3a5-283b-442d-a51d-909c2b0172d3"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5559),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("8ce09038-350b-4f34-9467-38ba611c61bd"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5569),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("b30d4433-c4b8-4131-8072-bb52a720f964"),
                            AssignedAt = new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5572),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDefaultTemplate")
                        .HasColumnType("boolean");

                    b.Property<string>("Keyword")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.Property<string>("UseCase")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeName")
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.Automation.Models.AutomationFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutomationFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250810122422_InitialCreateToNeon.cs  (sha256:131eb9d73dd1caaf33417e037972b4aef280ce4575cf1492ec96b05cf99d2e0d)
`$lang
using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace xbytechat.api.Migrations
{
    /// <inheritdoc />
    public partial class InitialCreateToNeon : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0478c3a5-283b-442d-a51d-909c2b0172d3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("0759059d-e71d-4198-b3b9-58d12c8200f9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("15b8aca8-7fb9-4e9f-8f59-9e88bd26b0ec"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("18c92b80-4c5e-4d54-b364-8b3953000241"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("251c0b3d-3bb2-4e11-a64f-190d457306d0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("40fe8966-eefb-43ef-b8ca-677f107d33dc"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("5f2a715d-4a83-4669-b42c-1df495d349b8"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("65ffa364-2c5a-45e0-af28-5a1730dc9d94"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8ce09038-350b-4f34-9467-38ba611c61bd"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8e58d8a5-dc1f-4fb9-9198-f868ae63fc70"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a471818e-7c64-4c7f-869c-545938ad9217"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("aa7bf421-9fdc-4a77-b822-29b6a5a1c131"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("af77b30e-d9b4-4052-b378-4b862fe1a86c"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b30d4433-c4b8-4131-8072-bb52a720f964"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("cddcfa62-e4bb-4433-83fa-42bce5951025"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("e0e5dc1c-9235-4fa8-863d-8a57c01e8a24"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("f6933ae2-c83d-4652-bdd6-559684858967"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8372));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8380));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8382));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8385));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8387));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8390));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8392));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8394));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8397));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8400));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8401));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("077411e5-1f1b-4e94-90b9-febb503d955a"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8718), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("106019ac-e3ba-47c5-aa3d-3de8459189f7"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8783), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("2cd29bd3-f812-435e-bfa4-dcbe753c8a0a"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8787), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("348b34f4-6d0a-4505-a7f9-f67a64e867f6"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8820), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("43751848-5176-482e-8854-cfe0c1fe1476"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8725), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("48b591be-65f7-451f-b719-f327dada5ad4"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8705), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8730c3e3-5f76-4acd-bba1-619e983d37d4"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8700), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("8988065d-f1a5-4e5c-aff1-36b30317c807"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8810), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("89b52866-c0a4-4988-aee5-e5afb670f1db"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8807), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("9695b1ca-cf9e-4ba8-b608-25ba5ed6c578"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8802), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("9efa0b93-4944-4e5c-b8a8-7d85661a26a3"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8805), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("a47785b3-34d7-43e2-a1ab-b9e91e987dfa"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8792), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b2178c98-9d0e-45f1-9e60-47f9763367e9"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8714), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b85669b0-d5f9-4b87-8a5b-617120e76679"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8817), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("ccd710e6-baf8-414e-b3ce-fdba41bb9692"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8776), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("d2a22e67-99a2-4f6c-b042-38c9647d0ea0"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8780), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("da299567-1c2c-4912-977f-70a7a102ffb4"), new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8721), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7678));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7680));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7681));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7682));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7684));
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("077411e5-1f1b-4e94-90b9-febb503d955a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("106019ac-e3ba-47c5-aa3d-3de8459189f7"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("2cd29bd3-f812-435e-bfa4-dcbe753c8a0a"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("348b34f4-6d0a-4505-a7f9-f67a64e867f6"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("43751848-5176-482e-8854-cfe0c1fe1476"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("48b591be-65f7-451f-b719-f327dada5ad4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8730c3e3-5f76-4acd-bba1-619e983d37d4"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("8988065d-f1a5-4e5c-aff1-36b30317c807"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("89b52866-c0a4-4988-aee5-e5afb670f1db"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("9695b1ca-cf9e-4ba8-b608-25ba5ed6c578"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("9efa0b93-4944-4e5c-b8a8-7d85661a26a3"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("a47785b3-34d7-43e2-a1ab-b9e91e987dfa"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b2178c98-9d0e-45f1-9e60-47f9763367e9"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("b85669b0-d5f9-4b87-8a5b-617120e76679"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("ccd710e6-baf8-414e-b3ce-fdba41bb9692"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("d2a22e67-99a2-4f6c-b042-38c9647d0ea0"));

            migrationBuilder.DeleteData(
                table: "RolePermissions",
                keyColumn: "Id",
                keyValue: new Guid("da299567-1c2c-4912-977f-70a7a102ffb4"));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000000"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5111));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5118));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5120));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5122));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5124));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5127));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000006"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5130));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000007"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5132));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000008"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5135));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000009"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5138));

            migrationBuilder.UpdateData(
                table: "Permissions",
                keyColumn: "Id",
                keyValue: new Guid("30000000-0000-0000-0000-000000000010"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5179));

            migrationBuilder.InsertData(
                table: "RolePermissions",
                columns: new[] { "Id", "AssignedAt", "AssignedBy", "IsActive", "IsRevoked", "PermissionId", "RoleId" },
                values: new object[,]
                {
                    { new Guid("0478c3a5-283b-442d-a51d-909c2b0172d3"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5559), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("0759059d-e71d-4198-b3b9-58d12c8200f9"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5539), null, true, false, new Guid("30000000-0000-0000-0000-000000000009"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("15b8aca8-7fb9-4e9f-8f59-9e88bd26b0ec"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5524), null, true, false, new Guid("30000000-0000-0000-0000-000000000006"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("18c92b80-4c5e-4d54-b364-8b3953000241"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5515), null, true, false, new Guid("30000000-0000-0000-0000-000000000003"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("251c0b3d-3bb2-4e11-a64f-190d457306d0"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5509), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("40fe8966-eefb-43ef-b8ca-677f107d33dc"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5535), null, true, false, new Guid("30000000-0000-0000-0000-000000000008"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("5f2a715d-4a83-4669-b42c-1df495d349b8"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5554), null, true, false, new Guid("30000000-0000-0000-0000-000000000001"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("65ffa364-2c5a-45e0-af28-5a1730dc9d94"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5551), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000004") },
                    { new Guid("8ce09038-350b-4f34-9467-38ba611c61bd"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5569), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("8e58d8a5-dc1f-4fb9-9198-f868ae63fc70"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5542), null, true, false, new Guid("30000000-0000-0000-0000-000000000010"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("a471818e-7c64-4c7f-869c-545938ad9217"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5533), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("aa7bf421-9fdc-4a77-b822-29b6a5a1c131"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5518), null, true, false, new Guid("30000000-0000-0000-0000-000000000004"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("af77b30e-d9b4-4052-b378-4b862fe1a86c"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5512), null, true, false, new Guid("30000000-0000-0000-0000-000000000002"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("b30d4433-c4b8-4131-8072-bb52a720f964"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5572), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000005") },
                    { new Guid("cddcfa62-e4bb-4433-83fa-42bce5951025"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5499), null, true, false, new Guid("30000000-0000-0000-0000-000000000000"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("e0e5dc1c-9235-4fa8-863d-8a57c01e8a24"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5522), null, true, false, new Guid("30000000-0000-0000-0000-000000000005"), new Guid("00000000-0000-0000-0000-000000000001") },
                    { new Guid("f6933ae2-c83d-4652-bdd6-559684858967"), new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(5557), null, true, false, new Guid("30000000-0000-0000-0000-000000000007"), new Guid("00000000-0000-0000-0000-000000000004") }
                });

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000001"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3900));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000002"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3902));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000003"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3904));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000004"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3905));

            migrationBuilder.UpdateData(
                table: "Roles",
                keyColumn: "Id",
                keyValue: new Guid("00000000-0000-0000-0000-000000000005"),
                column: "CreatedAt",
                value: new DateTime(2025, 8, 6, 8, 3, 13, 784, DateTimeKind.Utc).AddTicks(3906));
        }
    }
}

``n
--- file: xbytechat-api/Migrations/20250810122422_InitialCreateToNeon.Designer.cs  (sha256:b6ad3c4f18b9393d7e38325a2a5719edaf0b70256efb0db28c6a20d03ef8544c)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    [Migration("20250810122422_InitialCreateToNeon")]
    partial class InitialCreateToNeon
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.18")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8372),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8380),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8382),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8385),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8387),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8390),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8392),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8394),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8397),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8400),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8401),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7678),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7680),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7681),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7682),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7684),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("8730c3e3-5f76-4acd-bba1-619e983d37d4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8700),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("48b591be-65f7-451f-b719-f327dada5ad4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8705),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b2178c98-9d0e-45f1-9e60-47f9763367e9"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8714),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("077411e5-1f1b-4e94-90b9-febb503d955a"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8718),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("da299567-1c2c-4912-977f-70a7a102ffb4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8721),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("43751848-5176-482e-8854-cfe0c1fe1476"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8725),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("ccd710e6-baf8-414e-b3ce-fdba41bb9692"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8776),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d2a22e67-99a2-4f6c-b042-38c9647d0ea0"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8780),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("106019ac-e3ba-47c5-aa3d-3de8459189f7"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8783),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2cd29bd3-f812-435e-bfa4-dcbe753c8a0a"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8787),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a47785b3-34d7-43e2-a1ab-b9e91e987dfa"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8792),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("9695b1ca-cf9e-4ba8-b608-25ba5ed6c578"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8802),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("9efa0b93-4944-4e5c-b8a8-7d85661a26a3"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8805),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("89b52866-c0a4-4988-aee5-e5afb670f1db"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8807),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("8988065d-f1a5-4e5c-aff1-36b30317c807"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8810),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("b85669b0-d5f9-4b87-8a5b-617120e76679"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8817),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("348b34f4-6d0a-4505-a7f9-f67a64e867f6"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8820),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDefaultTemplate")
                        .HasColumnType("boolean");

                    b.Property<string>("Keyword")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.Property<string>("UseCase")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeName")
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.Automation.Models.AutomationFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutomationFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Migrations/AppDbContextModelSnapshot.cs  (sha256:349e367cabd2c25a11dab71d3c96436aa9bb09e5afda148eda59667e869a933d)
`$lang
// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;
using xbytechat.api;

#nullable disable

namespace xbytechat.api.Migrations
{
    [DbContext(typeof(AppDbContext))]
    partial class AppDbContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.18")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("TagId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId");

                    b.HasIndex("TagId");

                    b.ToTable("ContactTags");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<string>("MessageContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("RefMessageId")
                        .HasColumnType("uuid");

                    b.Property<string>("RenderedBody")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("MessageLogs");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("RefreshToken")
                        .HasColumnType("text");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("RoleId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("RoleId");

                    b.ToTable("Users");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("AssignedAgentId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Email")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsAutomationPaused")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCTAInteraction")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("LastClickedProductId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("LastContactedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LeadSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("NextFollowUpAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Notes")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<string>("PhoneNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.Property<string>("Tags")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.ToTable("Contacts");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Note", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsInternal")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("boolean");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Notes");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Reminder", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<DateTime>("DueAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRecurring")
                        .HasColumnType("boolean");

                    b.Property<string>("LastCTAType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LinkedCampaign")
                        .HasColumnType("text");

                    b.Property<int?>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("RecurrencePattern")
                        .HasColumnType("text");

                    b.Property<string>("ReminderType")
                        .HasColumnType("text");

                    b.Property<bool>("SendWhatsappNotification")
                        .HasColumnType("boolean");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("Reminders");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<string>("ColorHex")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemTag")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Tags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("Group")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Permissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000000"),
                            Code = "dashboard.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8372),
                            Description = "Permission for dashboard.view",
                            IsActive = true,
                            Name = "dashboard.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000001"),
                            Code = "campaign.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8380),
                            Description = "Permission for campaign.view",
                            IsActive = true,
                            Name = "campaign.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000002"),
                            Code = "campaign.create",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8382),
                            Description = "Permission for campaign.create",
                            IsActive = true,
                            Name = "campaign.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000003"),
                            Code = "campaign.delete",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8385),
                            Description = "Permission for campaign.delete",
                            IsActive = true,
                            Name = "campaign.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000004"),
                            Code = "product.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8387),
                            Description = "Permission for product.view",
                            IsActive = true,
                            Name = "product.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000005"),
                            Code = "product.create",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8390),
                            Description = "Permission for product.create",
                            IsActive = true,
                            Name = "product.create"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000006"),
                            Code = "product.delete",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8392),
                            Description = "Permission for product.delete",
                            IsActive = true,
                            Name = "product.delete"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000007"),
                            Code = "contacts.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8394),
                            Description = "Permission for contacts.view",
                            IsActive = true,
                            Name = "contacts.view"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000008"),
                            Code = "tags.edit",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8397),
                            Description = "Permission for tags.edit",
                            IsActive = true,
                            Name = "tags.edit"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000009"),
                            Code = "admin.business.approve",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8400),
                            Description = "Permission for admin.business.approve",
                            IsActive = true,
                            Name = "admin.business.approve"
                        },
                        new
                        {
                            Id = new Guid("30000000-0000-0000-0000-000000000010"),
                            Code = "admin.logs.view",
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8401),
                            Description = "Permission for admin.logs.view",
                            IsActive = true,
                            Name = "admin.logs.view"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Code")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Plans");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("PlanId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("PlanId");

                    b.ToTable("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsSystemDefined")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Roles");

                    b.HasData(
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000001"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7678),
                            Description = "Super Admin",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "admin"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000002"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7680),
                            Description = "Business Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "partner"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000003"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7681),
                            Description = "Reseller Partner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "reseller"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000004"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7682),
                            Description = "Business Owner",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "business"
                        },
                        new
                        {
                            Id = new Guid("00000000-0000-0000-0000-000000000005"),
                            CreatedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(7684),
                            Description = "Staff",
                            IsActive = true,
                            IsSystemDefined = false,
                            Name = "staff"
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("RoleId");

                    b.ToTable("RolePermissions");

                    b.HasData(
                        new
                        {
                            Id = new Guid("8730c3e3-5f76-4acd-bba1-619e983d37d4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8700),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("48b591be-65f7-451f-b719-f327dada5ad4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8705),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("b2178c98-9d0e-45f1-9e60-47f9763367e9"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8714),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000002"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("077411e5-1f1b-4e94-90b9-febb503d955a"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8718),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000003"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("da299567-1c2c-4912-977f-70a7a102ffb4"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8721),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("43751848-5176-482e-8854-cfe0c1fe1476"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8725),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000005"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("ccd710e6-baf8-414e-b3ce-fdba41bb9692"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8776),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000006"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("d2a22e67-99a2-4f6c-b042-38c9647d0ea0"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8780),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("106019ac-e3ba-47c5-aa3d-3de8459189f7"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8783),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000008"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("2cd29bd3-f812-435e-bfa4-dcbe753c8a0a"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8787),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000009"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("a47785b3-34d7-43e2-a1ab-b9e91e987dfa"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8792),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000010"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000001")
                        },
                        new
                        {
                            Id = new Guid("9695b1ca-cf9e-4ba8-b608-25ba5ed6c578"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8802),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("9efa0b93-4944-4e5c-b8a8-7d85661a26a3"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8805),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000001"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("89b52866-c0a4-4988-aee5-e5afb670f1db"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8807),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("8988065d-f1a5-4e5c-aff1-36b30317c807"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8810),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000004"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000004")
                        },
                        new
                        {
                            Id = new Guid("b85669b0-d5f9-4b87-8a5b-617120e76679"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8817),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000000"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        },
                        new
                        {
                            Id = new Guid("348b34f4-6d0a-4505-a7f9-f67a64e867f6"),
                            AssignedAt = new DateTime(2025, 8, 10, 12, 24, 21, 784, DateTimeKind.Utc).AddTicks(8820),
                            IsActive = true,
                            IsRevoked = false,
                            PermissionId = new Guid("30000000-0000-0000-0000-000000000007"),
                            RoleId = new Guid("00000000-0000-0000-0000-000000000005")
                        });
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("AssignedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("AssignedBy")
                        .HasColumnType("text");

                    b.Property<bool>("IsGranted")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsRevoked")
                        .HasColumnType("boolean");

                    b.Property<Guid>("PermissionId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("PermissionId");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AuditTrail.Models.AuditLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActionType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .HasColumnType("text");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("Location")
                        .HasColumnType("text");

                    b.Property<Guid>("PerformedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("PerformedByUserName")
                        .HasColumnType("text");

                    b.Property<string>("RoleAtTime")
                        .HasColumnType("text");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AuditLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDefaultTemplate")
                        .HasColumnType("boolean");

                    b.Property<string>("Keyword")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .HasColumnType("text");

                    b.Property<string>("UseCase")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceHandle")
                        .HasColumnType("text");

                    b.Property<string>("SourceNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TargetHandle")
                        .HasColumnType("text");

                    b.Property<string>("TargetNodeId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowEdges");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ConfigJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("Label")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodeName")
                        .HasColumnType("text");

                    b.Property<string>("NodeType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<int>("Order")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyFlowNodes");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("ReplyContent")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("TriggeredAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutoReplyLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("FlowName")
                        .HasColumnType("text");

                    b.Property<string>("IndustryTag")
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("MediaUrl")
                        .HasColumnType("text");

                    b.Property<int>("Priority")
                        .HasColumnType("integer");

                    b.Property<string>("ReplyMessage")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("FlowId");

                    b.ToTable("AutoReplyRules");
                });

            modelBuilder.Entity("xbytechat.api.Features.Automation.Models.AutomationFlow", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("EdgesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("NodesJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerKeyword")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("AutomationFlows");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Address")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ApprovedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ApprovedBy")
                        .HasColumnType("text");

                    b.Property<string>("BusinessEmail")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("BusinessName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CompanyName")
                        .HasColumnType("text");

                    b.Property<string>("CompanyPhone")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CreatedByPartnerId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("Industry")
                        .HasColumnType("text");

                    b.Property<bool>("IsApproved")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LogoUrl")
                        .HasColumnType("text");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Phone")
                        .HasColumnType("text");

                    b.Property<string>("RepresentativeName")
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.Property<int>("Status")
                        .HasColumnType("integer");

                    b.Property<string>("Tags")
                        .HasColumnType("text");

                    b.Property<string>("Website")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("Businesses");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("FlowName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<bool>("IsPublished")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTAFlowConfigs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CTAFlowConfigId")
                        .HasColumnType("uuid");

                    b.Property<float?>("PositionX")
                        .HasColumnType("real");

                    b.Property<float?>("PositionY")
                        .HasColumnType("real");

                    b.Property<string>("RequiredSource")
                        .HasColumnType("text");

                    b.Property<string>("RequiredTag")
                        .HasColumnType("text");

                    b.Property<int>("StepOrder")
                        .HasColumnType("integer");

                    b.Property<string>("TemplateToSend")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TriggerButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowConfigId");

                    b.ToTable("CTAFlowSteps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonSubType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonValue")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid>("CTAFlowStepId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("NextStepId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CTAFlowStepId");

                    b.ToTable("FlowButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowExecutionLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<DateTime>("ExecutedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("FlowId")
                        .HasColumnType("uuid");

                    b.Property<string>("RawResponse")
                        .HasColumnType("text");

                    b.Property<Guid>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("StepName")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("Success")
                        .HasColumnType("boolean");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<string>("TemplateType")
                        .HasColumnType("text");

                    b.Property<Guid?>("TrackingLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("TriggeredByButton")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FlowExecutionLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAManagement.Models.CTADefinition", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ButtonType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("TargetUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("CTADefinitions");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CampaignType")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeletedBy")
                        .HasColumnType("text");

                    b.Property<string>("FollowUpTemplateId")
                        .HasColumnType("text");

                    b.Property<string>("ImageCaption")
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .HasColumnType("text");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageBody")
                        .HasColumnType("text");

                    b.Property<string>("MessageTemplate")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("ScheduledAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("SourceCampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<string>("TemplateParameters")
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CtaId");

                    b.HasIndex("SourceCampaignId");

                    b.ToTable("Campaigns");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsFromTemplate")
                        .HasColumnType("boolean");

                    b.Property<int>("Position")
                        .HasColumnType("integer");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Type")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignButtons");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<string>("OverrideNextTemplate")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.ToTable("CampaignFlowOverrides");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<string>("ClickedCTA")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<bool>("IsAutoTagged")
                        .HasColumnType("boolean");

                    b.Property<string>("MessagePreview")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.ToTable("CampaignRecipients");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AllowRetry")
                        .HasColumnType("boolean");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<string>("ClickType")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("DeviceInfo")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("IpAddress")
                        .HasColumnType("text");

                    b.Property<bool>("IsClicked")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastRetryAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("LastRetryStatus")
                        .HasColumnType("text");

                    b.Property<string>("MacAddress")
                        .HasColumnType("text");

                    b.Property<string>("MessageBody")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("RecipientId")
                        .HasColumnType("uuid");

                    b.Property<int>("RetryCount")
                        .HasColumnType("integer");

                    b.Property<string>("SendStatus")
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("SourceChannel")
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.HasIndex("RecipientId");

                    b.HasIndex("UserId");

                    b.ToTable("CampaignSendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.CatalogClickLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("BotId")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("CTAJourney")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("CategoryBrowsed")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CtaId")
                        .HasColumnType("uuid");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("PlanSnapshot")
                        .HasColumnType("text");

                    b.Property<string>("ProductBrowsed")
                        .HasColumnType("text");

                    b.Property<Guid?>("ProductId")
                        .HasColumnType("uuid");

                    b.Property<string>("RefMessageId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Source")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateId")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UserId")
                        .HasColumnType("text");

                    b.Property<string>("UserName")
                        .HasColumnType("text");

                    b.Property<string>("UserPhone")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("CatalogClickLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Catalog.Models.Product", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Currency")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("ImageUrl")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("MostClickedCTA")
                        .HasColumnType("text");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<decimal>("Price")
                        .HasColumnType("numeric");

                    b.Property<int>("TotalClicks")
                        .HasColumnType("integer");

                    b.HasKey("Id");

                    b.ToTable("Products");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<string>("Plan")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId", "FeatureName")
                        .IsUnique();

                    b.ToTable("FeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.FeatureMaster", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(250)
                        .HasColumnType("character varying(250)");

                    b.Property<string>("DisplayName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("FeatureCode")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<string>("Group")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.HasKey("Id");

                    b.ToTable("FeatureMaster");
                });

            modelBuilder.Entity("xbytechat.api.Features.FeatureAccessModule.Models.UserFeatureAccess", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ModifiedByUserId")
                        .HasColumnType("uuid");

                    b.Property<string>("Notes")
                        .HasColumnType("text");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.ToTable("UserFeatureAccess");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ChatSessionState", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastUpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("UpdatedBy")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("ChatSessionStates");
                });

            modelBuilder.Entity("xbytechat.api.Features.Inbox.Models.ContactRead", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("LastReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<Guid>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("ContactId", "UserId")
                        .IsUnique();

                    b.ToTable("ContactReads");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid?>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<string>("Channel")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CustomerProfileName")
                        .HasColumnType("text");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int?>("ErrorCode")
                        .HasColumnType("integer");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<bool>("IsSessionOpen")
                        .HasColumnType("boolean");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<string>("MessageType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<long?>("MetaTimestamp")
                        .HasColumnType("bigint");

                    b.Property<string>("RawPayload")
                        .HasColumnType("text");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("RecipientNumber")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<DateTime?>("SentAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("TemplateCategory")
                        .HasColumnType("text");

                    b.Property<string>("TemplateName")
                        .HasColumnType("text");

                    b.Property<Guid?>("UserId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("CampaignId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageStatusLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.PlanManagement.Models.PlanFeatureMatrix", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("FeatureName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)");

                    b.Property<bool>("IsEnabled")
                        .HasColumnType("boolean");

                    b.Property<string>("PlanName")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.ToTable("PlanFeatureMatrix");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Browser")
                        .HasColumnType("text");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonText")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<Guid?>("CampaignId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CampaignSendLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("City")
                        .HasColumnType("text");

                    b.Property<DateTime>("ClickedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ClickedVia")
                        .HasColumnType("text");

                    b.Property<Guid?>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<string>("ContactPhone")
                        .HasColumnType("text");

                    b.Property<string>("Country")
                        .HasColumnType("text");

                    b.Property<string>("DeviceType")
                        .HasColumnType("text");

                    b.Property<bool>("FollowUpSent")
                        .HasColumnType("boolean");

                    b.Property<string>("IPAddress")
                        .HasColumnType("text");

                    b.Property<string>("LastInteractionType")
                        .HasColumnType("text");

                    b.Property<string>("MessageId")
                        .HasColumnType("text");

                    b.Property<Guid?>("MessageLogId")
                        .HasColumnType("uuid");

                    b.Property<string>("Referrer")
                        .HasColumnType("text");

                    b.Property<Guid?>("SessionId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("SourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("SourceType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<Guid?>("StepId")
                        .HasColumnType("uuid");

                    b.Property<string>("TemplateId")
                        .HasColumnType("text");

                    b.Property<Guid?>("ThreadId")
                        .HasColumnType("uuid");

                    b.HasKey("Id");

                    b.HasIndex("CampaignId");

                    b.HasIndex("CampaignSendLogId");

                    b.HasIndex("ContactId");

                    b.HasIndex("MessageLogId");

                    b.ToTable("TrackingLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.FailedWebhookLog", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text");

                    b.Property<string>("FailureType")
                        .HasColumnType("text");

                    b.Property<string>("RawJson")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("SourceModule")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.ToTable("FailedWebhookLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.Webhooks.Models.WebhookSettings", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AutoCleanupEnabled")
                        .HasColumnType("boolean");

                    b.Property<DateTime?>("LastCleanupAt")
                        .HasColumnType("timestamp with time zone");

                    b.HasKey("Id");

                    b.ToTable("WebhookSettings");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer");

                    NpgsqlPropertyBuilderExtensions.UseIdentityByDefaultColumn(b.Property<int>("Id"));

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<Guid?>("CTASourceId")
                        .HasColumnType("uuid");

                    b.Property<string>("CTASourceType")
                        .HasColumnType("text");

                    b.Property<string>("CTAType")
                        .HasColumnType("text");

                    b.Property<string>("Category")
                        .HasColumnType("text");

                    b.Property<Guid>("ContactId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("CreatedBy")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("Data")
                        .HasColumnType("text");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasColumnType("text");

                    b.Property<bool>("IsSystemGenerated")
                        .HasColumnType("boolean");

                    b.Property<Guid?>("ReferenceId")
                        .HasColumnType("uuid");

                    b.Property<string>("Source")
                        .HasColumnType("text");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId");

                    b.HasIndex("ContactId");

                    b.ToTable("LeadTimelines");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("Plan")
                        .HasColumnType("integer");

                    b.Property<DateTime>("QuotaResetDate")
                        .HasColumnType("timestamp with time zone");

                    b.Property<int>("RemainingMessages")
                        .HasColumnType("integer");

                    b.Property<int>("TotalMonthlyQuota")
                        .HasColumnType("integer");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<decimal>("WalletBalance")
                        .HasColumnType("numeric");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("BusinessPlanInfos");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ApiToken")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)");

                    b.Property<string>("ApiUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)");

                    b.Property<Guid>("BusinessId")
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<bool>("IsActive")
                        .HasColumnType("boolean");

                    b.Property<string>("PhoneNumberId")
                        .HasColumnType("text");

                    b.Property<string>("SenderDisplayName")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone");

                    b.Property<string>("WabaId")
                        .HasColumnType("text");

                    b.Property<string>("WhatsAppBusinessNumber")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)");

                    b.HasKey("Id");

                    b.HasIndex("BusinessId")
                        .IsUnique();

                    b.ToTable("WhatsAppSettings");
                });

            modelBuilder.Entity("ContactTag", b =>
                {
                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany("ContactTags")
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Tag", "Tag")
                        .WithMany("ContactTags")
                        .HasForeignKey("TagId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Contact");

                    b.Navigation("Tag");
                });

            modelBuilder.Entity("MessageLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany("MessageLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.Navigation("Business");

                    b.Navigation("Contact");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Users")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("Users")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Business");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.PlanPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany()
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Plan", "Plan")
                        .WithMany("PlanPermissions")
                        .HasForeignKey("PlanId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Plan");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.RolePermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("RolePermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Role", "Role")
                        .WithMany("RolePermissions")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("Role");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.UserPermission", b =>
                {
                    b.HasOne("xbytechat.api.Features.AccessControl.Models.Permission", "Permission")
                        .WithMany("UserPermissions")
                        .HasForeignKey("PermissionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("UserPermissions")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Permission");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowEdge", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyFlowNode", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.OwnsOne("xbytechat.api.Features.AutoReplyBuilder.Models.Position", "Position", b1 =>
                        {
                            b1.Property<Guid>("AutoReplyFlowNodeId")
                                .HasColumnType("uuid");

                            b1.Property<double>("X")
                                .HasColumnType("double precision");

                            b1.Property<double>("Y")
                                .HasColumnType("double precision");

                            b1.HasKey("AutoReplyFlowNodeId");

                            b1.ToTable("AutoReplyFlowNodes");

                            b1.WithOwner()
                                .HasForeignKey("AutoReplyFlowNodeId");
                        });

                    b.Navigation("Flow");

                    b.Navigation("Position")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.AutoReplyBuilder.Models.AutoReplyRule", b =>
                {
                    b.HasOne("xbytechat.api.Features.AutoReplyBuilder.Flows.Models.AutoReplyFlow", "Flow")
                        .WithMany()
                        .HasForeignKey("FlowId");

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", "Flow")
                        .WithMany("Steps")
                        .HasForeignKey("CTAFlowConfigId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Flow");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.FlowButtonLink", b =>
                {
                    b.HasOne("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", "Step")
                        .WithMany("ButtonLinks")
                        .HasForeignKey("CTAFlowStepId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Step");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("Campaigns")
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CTAManagement.Models.CTADefinition", "Cta")
                        .WithMany()
                        .HasForeignKey("CtaId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "SourceCampaign")
                        .WithMany()
                        .HasForeignKey("SourceCampaignId");

                    b.Navigation("Business");

                    b.Navigation("Cta");

                    b.Navigation("SourceCampaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignButton", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MultiButtons")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignFlowOverride", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Campaign");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("Recipients")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("SendLogs")
                        .HasForeignKey("CampaignId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", "Recipient")
                        .WithMany("SendLogs")
                        .HasForeignKey("RecipientId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.AuthModule.Models.User", null)
                        .WithMany("SendLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Campaign");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");

                    b.Navigation("Recipient");
                });

            modelBuilder.Entity("xbytechat.api.Features.MessageManagement.DTOs.MessageStatusLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("BusinessId");

                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.AuthModule.Models.User", "User")
                        .WithMany("MessageStatusLogs")
                        .HasForeignKey("UserId");

                    b.Navigation("Business");

                    b.Navigation("Campaign");

                    b.Navigation("User");
                });

            modelBuilder.Entity("xbytechat.api.Features.Tracking.Models.TrackingLog", b =>
                {
                    b.HasOne("xbytechat.api.Features.CampaignModule.Models.Campaign", "Campaign")
                        .WithMany()
                        .HasForeignKey("CampaignId");

                    b.HasOne("xbytechat.api.Features.CampaignTracking.Models.CampaignSendLog", "CampaignSendLog")
                        .WithMany()
                        .HasForeignKey("CampaignSendLogId");

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId");

                    b.HasOne("MessageLog", "MessageLog")
                        .WithMany()
                        .HasForeignKey("MessageLogId");

                    b.Navigation("Campaign");

                    b.Navigation("CampaignSendLog");

                    b.Navigation("Contact");

                    b.Navigation("MessageLog");
                });

            modelBuilder.Entity("xbytechat.api.Features.xbTimelines.Models.LeadTimeline", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithMany()
                        .HasForeignKey("BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("xbytechat.api.CRM.Models.Contact", "Contact")
                        .WithMany()
                        .HasForeignKey("ContactId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");

                    b.Navigation("Contact");
                });

            modelBuilder.Entity("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", "Business")
                        .WithOne("BusinessPlanInfo")
                        .HasForeignKey("xbytechat.api.Models.BusinessModel.BusinessPlanInfo", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Business");
                });

            modelBuilder.Entity("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", b =>
                {
                    b.HasOne("xbytechat.api.Features.BusinessModule.Models.Business", null)
                        .WithOne("WhatsAppSettings")
                        .HasForeignKey("xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity", "BusinessId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.AuthModule.Models.User", b =>
                {
                    b.Navigation("MessageStatusLogs");

                    b.Navigation("SendLogs");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Contact", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.CRM.Models.Tag", b =>
                {
                    b.Navigation("ContactTags");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Permission", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("UserPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Plan", b =>
                {
                    b.Navigation("PlanPermissions");
                });

            modelBuilder.Entity("xbytechat.api.Features.AccessControl.Models.Role", b =>
                {
                    b.Navigation("RolePermissions");

                    b.Navigation("Users");
                });

            modelBuilder.Entity("xbytechat.api.Features.BusinessModule.Models.Business", b =>
                {
                    b.Navigation("BusinessPlanInfo");

                    b.Navigation("Campaigns");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("Users");

                    b.Navigation("WhatsAppSettings")
                        .IsRequired();
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowConfig", b =>
                {
                    b.Navigation("Steps");
                });

            modelBuilder.Entity("xbytechat.api.Features.CTAFlowBuilder.Models.CTAFlowStep", b =>
                {
                    b.Navigation("ButtonLinks");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.Campaign", b =>
                {
                    b.Navigation("MessageLogs");

                    b.Navigation("MessageStatusLogs");

                    b.Navigation("MultiButtons");

                    b.Navigation("Recipients");

                    b.Navigation("SendLogs");
                });

            modelBuilder.Entity("xbytechat.api.Features.CampaignModule.Models.CampaignRecipient", b =>
                {
                    b.Navigation("SendLogs");
                });
#pragma warning restore 612, 618
        }
    }
}

``n
--- file: xbytechat-api/Models/MessagesModel/MessageLog.cs  (sha256:45d9f23504249cda4ca6119267f52c07de4eb971f9d0ec72465331ce4b38865d)
`$lang
using System;
using System.Collections.Generic;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.BusinessModule.Models;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.Features.MessageManagement.DTOs;

public class MessageLog
{
    public Guid Id { get; set; }

    public string? MessageId { get; set; } // WAMID from WhatsApp — alternate key
   // public ICollection<MessageStatusLog> StatusUpdates { get; set; } = new List<MessageStatusLog>();

    // 🔗 FK to Business
    public Guid BusinessId { get; set; }
    public Business Business { get; set; }

    // 📨 Message Info
    public string RecipientNumber { get; set; }
    public string MessageContent { get; set; }
    public string? MediaUrl { get; set; }

    // 🧾 Status Info
    public string Status { get; set; } = "Queued";
    public string? ErrorMessage { get; set; }
    public string? RawResponse { get; set; }

    // 🕒 Timestamps
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime? SentAt { get; set; }

    // 🔗 Contact (optional)
    public Guid? ContactId { get; set; }
    public Contact? Contact { get; set; }

    // 🔗 Campaign (optional)
    public Guid? CampaignId { get; set; }

    // 🔗 CTA Flow Tracking
    public Guid? CTAFlowConfigId { get; set; }  // Which visual flow config this message belongs to
    public Guid? CTAFlowStepId { get; set; }    // Which flow step (template) this message originated from
    public Campaign? SourceCampaign { get; set; } // renamed from "Campaign" to avoid name conflict

    public bool IsIncoming { get; set; }

    public string? RenderedBody { get; set; } // actual resolved message with parameters

    public Guid? RefMessageId { get; set; }
    public string? Source { get; set; } // e.g., "campaign", "flow", "manual"
}

``n
--- file: xbytechat-api/Models/WhatsAppResult.cs  (sha256:cd627fc7d90a4da1360bb14f8be3109068a83b746a1b782f257095f68ea5279d)
`$lang
namespace xbytechat.api.Models
{
    public class WhatsAppResult
    {
        public bool Success { get; set; }
        public string? ErrorMessage { get; set; }
        public string? RawResponse { get; set; }
    }
}

``n
--- file: xbytechat-api/PayloadBuilders/ImageMessagePayloadBuilder.cs  (sha256:71c13746d4e6cc70735324c5c2c755b80e4c7d032e71a97969c3efe007aa68ae)
`$lang
using xbytechat.api.DTOs.Messages;

namespace xbytechat.api.PayloadBuilders
{
    /// <summary>
    /// Builds payload for sending image messages with media URL.
    /// </summary>
    public class ImageMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(BaseMessageDto dto)
        {
            var imageDto = dto as ImageMessageDto;

            return new
            {
                messaging_product = "whatsapp",
                to = imageDto.RecipientNumber,
                type = "image",
                image = new
                {
                    link = imageDto.MediaUrl
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/PayloadBuilders/IWhatsAppPayloadBuilder.cs  (sha256:2a2ff0592129a93fea8aa20df5fe1e8454dbfbe1640d5a1e15963af93dcd7922)
`$lang
namespace xbytechat.api.PayloadBuilders
{
    using xbytechat.api.DTOs.Messages;

    public interface IWhatsAppPayloadBuilder
    {
        object BuildPayload(BaseMessageDto dto);
    }
}

``n
--- file: xbytechat-api/PayloadBuilders/TemplateMessagePayloadBuilder.cs  (sha256:70f39daad2789c61f03ade184abdf96a43221189b751178dfa1955c123b5f884)
`$lang
using xbytechat.api.DTOs.Messages;

namespace xbytechat.api.PayloadBuilders
{
    public class TemplateMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(BaseMessageDto dto)
        {
            var templateDto = dto as TemplateMessageDto;
            if (templateDto == null)
                throw new InvalidCastException("DTO is not of type TemplateMessageDto.");

            var components = new List<object>();

            // 🧠 Body parameters
            if (templateDto.TemplateParameters != null && templateDto.TemplateParameters.Any())
            {
                components.Add(new
                {
                    type = "body",
                    parameters = templateDto.TemplateParameters.Select(p => new
                    {
                        type = "text",
                        text = p
                    }).ToList()
                });
            }

            // ✅ Add button placeholders (Meta requires them for static buttons too)
            components.Add(new
            {
                type = "button",
                sub_type = "url",
                index = "0",
                parameters = new object[] { }  // 👈 no parameters if static URL
            });

            components.Add(new
            {
                type = "button",
                sub_type = "phone_number",
                index = "1",
                parameters = new object[] { }  // 👈 no parameters if static phone
            });

            return new
            {
                messaging_product = "whatsapp",
                to = templateDto.RecipientNumber,
                type = "template",
                template = new
                {
                    name = templateDto.TemplateName,
                    language = new
                    {
                        code = templateDto.LanguageCode ?? "en_US"
                    },
                    components
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/PayloadBuilders/TextMessagePayloadBuilder.cs  (sha256:ce8e2e75c7865d9b08bebb267ceb84f7cdd0e77bd971c609576979b02726a590)
`$lang
// File: PayloadBuilders/TextMessagePayloadBuilder.cs
using xbytechat.api.DTOs.Messages;

namespace xbytechat.api.PayloadBuilders
{
    public class TextMessagePayloadBuilder : IWhatsAppPayloadBuilder
    {
        public object BuildPayload(BaseMessageDto dto)
        {
            var textDto = dto as TextMessageDto;

            if (textDto == null)
                throw new InvalidCastException("DTO is not of type TextMessageDto.");

            return new
            {
                messaging_product = "whatsapp",
                to = textDto.RecipientNumber,
                type = "text",
                text = new
                {
                    body = textDto.MessageContent
                }
            };
        }
    }
}

``n
--- file: xbytechat-api/Program.cs  (sha256:cbd0b2091feaea5ac7bc6b40d472b50be5e0b5f60c434bf95ab08444581385b4)
`$lang
using FluentValidation;
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.EntityFrameworkCore;
using Microsoft.IdentityModel.Tokens;
using Serilog;
using Serilog.Exceptions;
using System.Text;
using System.Text.Json;
using System.Text.Json.Serialization;
using xbytechat.api;
using xbytechat.api.AuthModule.Services;
using xbytechat.api.CRM.Interfaces;
using xbytechat.api.CRM.Services;
using xbytechat.api.Features.AccessControl.Services;
using xbytechat.api.Features.AuditTrail.Services;
using xbytechat.api.Features.CampaignModule.Services;
using xbytechat.api.Features.CampaignTracking.Services;
using xbytechat.api.Features.Catalog.Services;
using xbytechat.api.Features.MessageManagement.Services;
using xbytechat.api.Features.MessagesEngine.PayloadBuilders;
using xbytechat.api.Features.MessagesEngine.Services;
using xbytechat.api.Features.PlanManagement.Services;
using xbytechat.api.Features.TemplateModule.Services;
using xbytechat.api.Features.Webhooks.Services;
using xbytechat.api.Features.Webhooks.Services.Processors;
using xbytechat.api.Features.Webhooks.Services.Resolvers;
using xbytechat.api.Features.xbTimeline.Services;
using xbytechat.api.Features.xbTimelines.Services;
using xbytechat.api.Helpers;
using xbytechat.api.Middlewares;
using xbytechat.api.PayloadBuilders;
using xbytechat.api.Repositories.Implementations;
using xbytechat.api.Repositories.Interfaces;
using xbytechat.api.Services;
using xbytechat.api.Services.Messages.Implementations;
using xbytechat.api.Services.Messages.Interfaces;
using xbytechat_api.WhatsAppSettings.Services;
using xbytechat_api.WhatsAppSettings.Validators;
using EnginePayloadBuilders = xbytechat.api.Features.MessagesEngine.PayloadBuilders;
using xbytechat.api.Features.CTAManagement.Services;
using xbytechat.api.Features.Tracking.Services;
using xbytechat.api.Features.Webhooks.BackgroundWorkers;
using xbytechat.api.Features.CTAFlowBuilder.Services;
using xbytechat.api.Features.FlowAnalytics.Services;
using xbytechat.api.Features.Inbox.Repositories;
using xbytechat.api.Features.Inbox.Services;
using xbytechat.api.Features.Inbox.Hubs;
using Microsoft.AspNetCore.SignalR;
using xbytechat.api.SignalR;
using xbytechat.api.Features.AutoReplyBuilder.Repositories;
using xbytechat.api.Features.AutoReplyBuilder.Services;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;
using xbytechat.api.Features.AutoReplyBuilder.Flows.Services;
using xbytechat.api.Features.BusinessModule.Services;
using xbytechat.api.Features.FeatureAccessModule.Services;
using xbytechat.api.Features.ReportingModule.Services;
using xbytechat.api.Features.Automation.Repositories;
using xbytechat.api.Features.Automation.Services;
using Npgsql;
using System.Net;

var builder = WebApplication.CreateBuilder(args);

#region 🔷 Serilog Configuration
Log.Logger = new LoggerConfiguration()
    .Enrich.WithExceptionDetails()
    .Enrich.FromLogContext()
    .MinimumLevel.Information()
    .WriteTo.Console()
    .WriteTo.File("logs/log-.txt", rollingInterval: RollingInterval.Day)
    .CreateLogger();
builder.Host.UseSerilog();
#endregion

#region 🔷 Database Setup (PostgreSQL)
var connStr = builder.Configuration.GetConnectionString("DefaultConnection");
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(connStr).EnableSensitiveDataLogging()
);
Console.WriteLine($"[DEBUG] Using Connection String: {connStr}");
#endregion

#region 🔷 Generic Repository Pattern
builder.Services.AddScoped(typeof(IGenericRepository<>), typeof(GenericRepository<>));
#endregion

#region 🔷 Core Modules (Business/Auth)
builder.Services.AddScoped<IBusinessService, BusinessService>();
builder.Services.AddScoped<IAuthService, AuthService>();
builder.Services.AddScoped<IJwtTokenService, JwtTokenService>();
#endregion

#region 🔷 Messaging Services & WhatsApp
builder.Services.AddScoped<IMessageEngineService, MessageEngineService>();
builder.Services.AddHttpClient<IMessageService, MessageService>();
builder.Services.AddScoped<WhatsAppService>();
builder.Services.AddScoped<IMessageStatusService, MessageStatusService>();
builder.Services.AddScoped<ITemplateMessageSender, TemplateMessageSender>();
#endregion

#region 🔷 Payload Builders
builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TextMessagePayloadBuilder>();
builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.ImageMessagePayloadBuilder>();
builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TemplateMessagePayloadBuilder>();
#endregion

#region 🔷 Catalog & CRM Modules
builder.Services.AddScoped<IProductService, ProductService>();
builder.Services.AddScoped<ICatalogTrackingService, CatalogTrackingService>();
builder.Services.AddScoped<ICatalogDashboardService, CatalogDashboardService>();
builder.Services.AddScoped<IContactService, ContactService>();
builder.Services.AddScoped<ITagService, TagService>();
builder.Services.AddScoped<IReminderService, ReminderService>();
builder.Services.AddScoped<INoteService, NoteService>();
builder.Services.AddScoped<ITimelineService, TimelineService>();
#endregion

#region 🔷 Campaign Management
builder.Services.AddScoped<ICampaignService, CampaignService>();
builder.Services.AddScoped<ICampaignSendLogService, CampaignSendLogService>();
builder.Services.AddScoped<ICampaignSendLogEnricher, CampaignSendLogEnricher>();
builder.Services.AddScoped<ICampaignAnalyticsService, CampaignAnalyticsService>();
builder.Services.AddScoped<ICampaignRetryService, CampaignRetryService>();
builder.Services.AddHttpClient<IWhatsAppTemplateService, WhatsAppTemplateService>();
builder.Services.AddScoped<ICampaignRecipientService, CampaignRecipientService>();
#endregion

#region 🔷 Webhook Management
builder.Services.AddScoped<IWhatsAppWebhookService, WhatsAppWebhookService>();
builder.Services.AddScoped<IWhatsAppWebhookDispatcher, WhatsAppWebhookDispatcher>();
builder.Services.AddScoped<IStatusWebhookProcessor, StatusWebhookProcessor>();
builder.Services.AddScoped<ITemplateWebhookProcessor, TemplateWebhookProcessor>();
builder.Services.AddScoped<IMessageIdResolver, MessageIdResolver>();
builder.Services.AddScoped<IClickWebhookProcessor, ClickWebhookProcessor>();
builder.Services.AddScoped<ILeadTimelineService, LeadTimelineService>();
builder.Services.AddScoped<IFailedWebhookLogService, FailedWebhookLogService>();
builder.Services.AddSingleton<IWebhookQueueService, WebhookQueueService>();
builder.Services.AddHostedService<WebhookQueueWorker>();
builder.Services.AddHostedService<FailedWebhookLogCleanupService>();
builder.Services.AddScoped<IMaintenanceService, MaintenanceService>();
builder.Services.AddHostedService<WebhookAutoCleanupWorker>();
#endregion

#region 🔷 Access Control & Permission
builder.Services.AddScoped<IAccessControlService, AccessControlService>();
builder.Services.AddScoped<IFeatureAccessEvaluator, FeatureAccessEvaluator>();
builder.Services.AddScoped<IFeatureAccessService, FeatureAccessService>();
#endregion

#region 🔷 Tracking
builder.Services.AddScoped<ITrackingService, TrackingService>();
builder.Services.AddScoped<IMessageAnalyticsService, MessageAnalyticsService>();
#endregion

#region 🔷 Flow Builder
builder.Services.AddScoped<ICTAFlowService, CTAFlowService>();
#endregion

#region 🔷 Audit Trail Logging
builder.Services.AddHttpContextAccessor();
builder.Services.AddScoped<IAuditLogService, AuditLogService>();
#endregion

#region 🔷 WhatsApp settings
builder.Services.AddScoped<IWhatsAppSettingsService, WhatsAppSettingsService>();
builder.Services.AddValidatorsFromAssemblyContaining<SaveWhatsAppSettingValidator>();
builder.Services.AddHttpClient<IMessageEngineService, MessageEngineService>();
builder.Services.AddScoped<IWhatsAppTemplateFetcherService, WhatsAppTemplateFetcherService>();
builder.Services.AddScoped<EnginePayloadBuilders.TextMessagePayloadBuilder>();
builder.Services.AddScoped<EnginePayloadBuilders.ImageMessagePayloadBuilder>();
builder.Services.AddScoped<EnginePayloadBuilders.TemplateMessagePayloadBuilder>();
builder.Services.AddScoped<EnginePayloadBuilders.CtaMessagePayloadBuilder>();
builder.Services.AddScoped<IPlanManager, PlanManager>();
builder.Services.AddScoped<ICTAManagementService, CTAManagementService>();
#endregion

#region 🔷 Inbox
builder.Services.AddScoped<IFlowAnalyticsService, FlowAnalyticsService>();
builder.Services.AddScoped<IInboxService, InboxService>();
builder.Services.AddScoped<IInboundMessageProcessor, InboundMessageProcessor>();
builder.Services.AddScoped<IInboxRepository, InboxRepository>();
#endregion

#region 🔷 AutoReplyBuilder Module
builder.Services.AddScoped<IAutoReplyRepository, AutoReplyRepository>();
builder.Services.AddScoped<IAutoReplyService, AutoReplyService>();
builder.Services.AddScoped<IAutoReplyFlowRepository, AutoReplyFlowRepository>();
builder.Services.AddScoped<IAutoReplyFlowService, AutoReplyFlowService>();
builder.Services.AddScoped<IAutoReplyRuntimeService, AutoReplyRuntimeService>();
builder.Services.AddScoped<IChatSessionStateService, ChatSessionStateService>();
builder.Services.AddScoped<IAgentAssignmentService, AgentAssignmentService>();
#endregion

#region 🔷 Automation Module
builder.Services.AddScoped<IAutomationFlowRepository, AutomationFlowRepository>();
builder.Services.AddScoped<IAutomationRunner, AutomationRunner>();
builder.Services.AddScoped<IAutomationService, AutomationService>();
#endregion

#region 🔐 JWT Authentication (Bearer token only, no cookies)
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        var jwtSettings = builder.Configuration.GetSection("JwtSettings");

        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = jwtSettings["Issuer"],
            ValidAudience = jwtSettings["Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(jwtSettings["SecretKey"])),
            ClockSkew = TimeSpan.Zero
        };

        options.Events = new JwtBearerEvents
        {
            OnAuthenticationFailed = context =>
            {
                if (context.Exception is SecurityTokenExpiredException)
                {
                    context.Response.StatusCode = 401;
                    context.Response.ContentType = "application/json";
                    return context.Response.WriteAsync("{\"success\":false,\"message\":\"❌ Token expired. Please login again.\"}");
                }
                return Task.CompletedTask;
            }
        };
    });

builder.Services.AddAuthorization();
#endregion

#region 🌐 CORS Setup (Bearer mode, no credentials)
//var allowedOrigins = builder.Configuration.GetSection("Cors:AllowedOrigins").Get<string[]>();
// 🌐 Read allowed origins (array or single string) + log them
//var allowedOrigins = builder.Configuration.GetSection("Cors:AllowedOrigins").Get<string[]>();
//if (allowedOrigins == null || allowedOrigins.Length == 0)
//{
//    var raw = builder.Configuration["Cors:AllowedOrigins"]; // supports single string or comma/semicolon list
//    if (!string.IsNullOrWhiteSpace(raw))
//        allowedOrigins = raw.Split(new[] { ',', ';', ' ' }, StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
//}
//Console.WriteLine("[CORS] Allowed origins => " + string.Join(", ", allowedOrigins ?? Array.Empty<string>()));
var allowedOrigins = builder.Configuration.GetSection("Cors:AllowedOrigins").Get<string[]>();
if (allowedOrigins == null || allowedOrigins.Length == 0)
{
    var raw = builder.Configuration["Cors:AllowedOrigins"];
    if (!string.IsNullOrWhiteSpace(raw))
        allowedOrigins = raw.Split(new[] { ',', ';', ' ' }, StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
}
Console.WriteLine("[CORS] Allowed origins => " + string.Join(", ", allowedOrigins ?? Array.Empty<string>()));

builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowFrontend", policy =>
    {
        policy
            .WithOrigins(allowedOrigins ?? Array.Empty<string>())
            .AllowAnyHeader()
            .AllowAnyMethod();
    });
});
#endregion

#region ✅ MVC + Swagger + Middleware
builder.Services.AddControllers()
    .AddJsonOptions(opts =>
    {
        opts.JsonSerializerOptions.Converters.Add(new JsonStringEnumConverter(JsonNamingPolicy.CamelCase));
    });

builder.Services.AddEndpointsApiExplorer();

builder.Services.AddSwaggerGen(options =>
{
    options.SwaggerDoc("v1", new Microsoft.OpenApi.Models.OpenApiInfo
    {
        Title = "xByteChat API",
        Version = "v1",
        Description = "API documentation for xByteChat project"
    });
});
#endregion

builder.Services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());

#region SignalR
builder.Services.AddSignalR();
builder.Services.AddSingleton<IUserIdProvider, NameUserIdProvider>();
#endregion

var app = builder.Build();

app.MapGet("/api/debug/cors", () => Results.Ok(new
{
    Allowed = app.Services.GetRequiredService<IConfiguration>()
              .GetSection("Cors:AllowedOrigins").Get<string[]>()
}));
app.MapGet("/api/debug/db", async (AppDbContext db) => {
    try { await db.Database.OpenConnectionAsync(); await db.Database.CloseConnectionAsync(); return Results.Ok("ok"); }
    catch (Exception ex) { return Results.Problem(ex.Message); }
});
app.MapGet("/api/debug/conn", (IConfiguration cfg) =>
{
    var cs = cfg.GetConnectionString("DefaultConnection") ?? "";
    var b = new NpgsqlConnectionStringBuilder(cs);
    return Results.Ok(new
    {
        host = b.Host,
        port = b.Port,
        database = b.Database,
        username = b.Username,
        sslmode = b.SslMode.ToString(),
        hasPassword = !string.IsNullOrEmpty(b.Password)
    });
});
// Try DNS resolution of the DB host that /api/debug/conn reports
app.MapGet("/api/debug/dns", (IConfiguration cfg) =>
{
    var cs = cfg.GetConnectionString("DefaultConnection") ?? "";
    var b = new NpgsqlConnectionStringBuilder(cs);
    try
    {
        var ips = Dns.GetHostAddresses(b.Host);
        return Results.Ok(new { host = b.Host, addresses = ips.Select(i => i.ToString()).ToArray() });
    }
    catch (Exception ex)
    {
        return Results.Problem($"DNS failed for host '{b.Host}': {ex.Message}");
    }
});

#region 🌐 Middleware Pipeline Setup
AuditLoggingHelper.Configure(app.Services);

app.UseMiddleware<GlobalExceptionMiddleware>();

if (app.Environment.IsDevelopment())
{
    // Dev-specific configs
}

app.UseSwagger();
app.UseSwaggerUI();

app.UseHsts();
app.UseHttpsRedirection();

// Security headers
app.Use(async (context, next) =>
{
    context.Response.Headers["X-Content-Type-Options"] = "nosniff";
    context.Response.Headers["X-Frame-Options"] = "DENY";
    context.Response.Headers["X-XSS-Protection"] = "1; mode=block";
    context.Response.Headers["Referrer-Policy"] = "strict-origin-when-cross-origin";
    context.Response.Headers["Permissions-Policy"] = "geolocation=(), microphone=(), camera=()";
    await next();
});

app.UseRouting();
app.UseCors("AllowFrontend");

app.UseAuthentication();
app.UseAuthorization();

app.MapControllers();
app.MapHub<InboxHub>("/hubs/inbox");

app.Run();
#endregion



//using FluentValidation;;
//using Microsoft.AspNetCore.Authentication.JwtBearer;
//using Microsoft.EntityFrameworkCore;
//using Microsoft.IdentityModel.Tokens;
//using Serilog;
//using Serilog.Exceptions;
//using System.Text;
//using System.Text.Json;
//using System.Text.Json.Serialization;
//using xbytechat.api;
//using xbytechat.api.AuthModule.Services;
//using xbytechat.api.CRM.Interfaces;
//using xbytechat.api.CRM.Services;
//using xbytechat.api.Features.AccessControl.Services;
//using xbytechat.api.Features.AuditTrail.Services;
//using xbytechat.api.Features.CampaignModule.Services;
//using xbytechat.api.Features.CampaignTracking.Services;
//using xbytechat.api.Features.Catalog.Services;
//using xbytechat.api.Features.MessageManagement.Services;
//using xbytechat.api.Features.MessagesEngine.PayloadBuilders;
//using xbytechat.api.Features.MessagesEngine.Services;
//using xbytechat.api.Features.PlanManagement.Services;
//using xbytechat.api.Features.TemplateModule.Services;
//using xbytechat.api.Features.Webhooks.Services;
//using xbytechat.api.Features.Webhooks.Services.Processors;
//using xbytechat.api.Features.Webhooks.Services.Resolvers;
//using xbytechat.api.Features.xbTimeline.Services;
//using xbytechat.api.Features.xbTimelines.Services;
//using xbytechat.api.Helpers;
//using xbytechat.api.Middlewares;
//using xbytechat.api.PayloadBuilders;
//using xbytechat.api.Repositories.Implementations;
//using xbytechat.api.Repositories.Interfaces;
//using xbytechat.api.Services;
//using xbytechat.api.Services.Messages.Implementations;
//using xbytechat.api.Services.Messages.Interfaces;
//using xbytechat_api.WhatsAppSettings.Services;
//using xbytechat_api.WhatsAppSettings.Validators;
//using EnginePayloadBuilders = xbytechat.api.Features.MessagesEngine.PayloadBuilders;
//using xbytechat.api.Features.CTAManagement.Services;
//using xbytechat.api.Features.Tracking.Services;
//using xbytechat.api.Features.Webhooks.BackgroundWorkers;
//using xbytechat.api.Features.CTAFlowBuilder.Services;
//using xbytechat.api.Features.FlowAnalytics.Services;
//using xbytechat.api.Features.Inbox.Repositories;
//using xbytechat.api.Features.Inbox.Services;
//using xbytechat.api.Features.Inbox.Hubs;
//using Microsoft.AspNetCore.SignalR;
//using xbytechat.api.SignalR;
//using xbytechat.api.Features.AutoReplyBuilder.Repositories;
//using xbytechat.api.Features.AutoReplyBuilder.Services;
//using xbytechat.api.Features.AutoReplyBuilder.Flows.Repositories;
//using xbytechat.api.Features.AutoReplyBuilder.Flows.Services;
//using xbytechat.api.Features.BusinessModule.Services;
//using xbytechat.api.Features.FeatureAccessModule.Services;
//using xbytechat.api.Features.ReportingModule.Services;
//using xbytechat.api.Features.Automation.Repositories;
//using xbytechat.api.Features.Automation.Services;


//var builder = WebApplication.CreateBuilder(args);

//#region 🔷 Serilog Configuration
//Log.Logger = new LoggerConfiguration()
//    .Enrich.WithExceptionDetails()
//    .Enrich.FromLogContext()
//    .MinimumLevel.Information()
//    .WriteTo.Console()
//    .WriteTo.File("logs/log-.txt", rollingInterval: RollingInterval.Day)
//    .CreateLogger();
//builder.Host.UseSerilog();
//#endregion

////#region 🔷 Database Setup (PostgreSQL)
////var connStr = builder.Services.AddDbContext<AppDbContext>(options =>
////    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")).EnableSensitiveDataLogging());
////Console.WriteLine($"[DEBUG] Using Connection String: {connStr}");
////#endregion
//#region Database Setup (PostgreSQL)
//var connStr = builder.Configuration.GetConnectionString("DefaultConnection");  // Get actual string
//builder.Services.AddDbContext<AppDbContext>(options =>
//    options.UseNpgsql(connStr).EnableSensitiveDataLogging()
//);
//Console.WriteLine($"[DEBUG] Using Connection String: {connStr}"); // This prints the REAL connection string
//#endregion

//#region 🔷 Generic Repository Pattern
//builder.Services.AddScoped(typeof(IGenericRepository<>), typeof(GenericRepository<>));
//#endregion

//#region 🔷 Core Modules (Business/Auth)
//builder.Services.AddScoped<IBusinessService, BusinessService>();
//builder.Services.AddScoped<IAuthService, AuthService>();
//builder.Services.AddScoped<IJwtTokenService, JwtTokenService>();
//#endregion

//#region 🔷 Messaging Services & WhatsApp
//builder.Services.AddScoped<IMessageEngineService, MessageEngineService>(); // New

//builder.Services.AddHttpClient<IMessageService, MessageService>();
//builder.Services.AddScoped<WhatsAppService>();
//builder.Services.AddScoped<IMessageStatusService, MessageStatusService>();
//builder.Services.AddScoped<ITemplateMessageSender, TemplateMessageSender>();
//#endregion

//#region 🔷 Payload Builders
//builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TextMessagePayloadBuilder>();
//builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.ImageMessagePayloadBuilder>();
//builder.Services.AddScoped<xbytechat.api.PayloadBuilders.IWhatsAppPayloadBuilder, xbytechat.api.PayloadBuilders.TemplateMessagePayloadBuilder>();
//#endregion

//#region 🔷 Catalog & CRM Modules
//builder.Services.AddScoped<IProductService, ProductService>();
//builder.Services.AddScoped<ICatalogTrackingService, CatalogTrackingService>();
//builder.Services.AddScoped<ICatalogDashboardService, CatalogDashboardService>();
//builder.Services.AddScoped<IContactService, ContactService>();
//builder.Services.AddScoped<ITagService, TagService>();
//builder.Services.AddScoped<IReminderService, ReminderService>();
//builder.Services.AddScoped<INoteService, NoteService>();
//builder.Services.AddScoped<ITimelineService, TimelineService>();

//#endregion

//#region 🔷 Campaign Management
//builder.Services.AddScoped<ICampaignService, CampaignService>();
//builder.Services.AddScoped<ICampaignSendLogService, CampaignSendLogService>();
//builder.Services.AddScoped<ICampaignSendLogEnricher, CampaignSendLogEnricher>();
//builder.Services.AddScoped<ICampaignAnalyticsService, CampaignAnalyticsService>();

//builder.Services.AddScoped<ICampaignRetryService, CampaignRetryService>();
//builder.Services.AddHttpClient<IWhatsAppTemplateService, WhatsAppTemplateService>();
//builder.Services.AddScoped<ICampaignAnalyticsService, CampaignAnalyticsService>();
//builder.Services.AddScoped<ICampaignRecipientService, CampaignRecipientService>();

//#endregion

//#region 🔷 Webhook Management
//builder.Services.AddScoped<IWhatsAppWebhookService, WhatsAppWebhookService>();
//builder.Services.AddScoped<IWhatsAppWebhookDispatcher, WhatsAppWebhookDispatcher>();
//builder.Services.AddScoped<IStatusWebhookProcessor, StatusWebhookProcessor>();
//builder.Services.AddScoped<ITemplateWebhookProcessor, TemplateWebhookProcessor>();
//builder.Services.AddScoped<IMessageIdResolver, MessageIdResolver>();
//builder.Services.AddScoped<IClickWebhookProcessor, ClickWebhookProcessor>();
//builder.Services.AddScoped<ILeadTimelineService, LeadTimelineService>();
//builder.Services.AddScoped<IFailedWebhookLogService, FailedWebhookLogService>();
//builder.Services.AddSingleton<IWebhookQueueService, WebhookQueueService>();
//builder.Services.AddHostedService<WebhookQueueWorker>();
//builder.Services.AddHostedService<FailedWebhookLogCleanupService>();
//builder.Services.AddScoped<IMaintenanceService, MaintenanceService>();
//builder.Services.AddHostedService<WebhookAutoCleanupWorker>();

//#endregion

//#region 🔷 Access Control & Permission
//builder.Services.AddScoped<IAccessControlService, AccessControlService>();
//builder.Services.AddScoped<IFeatureAccessEvaluator, FeatureAccessEvaluator>();
//builder.Services.AddScoped<IFeatureAccessService, FeatureAccessService>();
//#endregion

//#region 🔷 Tracking 
//builder.Services.AddScoped<ITrackingService, TrackingService>();
//builder.Services.AddScoped<IMessageAnalyticsService, MessageAnalyticsService>();

//#endregion
//#region 🔷 Flow Builder 
//builder.Services.AddScoped<ICTAFlowService, CTAFlowService>();

//#endregion
//#region 🔷 Audit Trail Logging
//builder.Services.AddHttpContextAccessor(); // For Audit + Cookies
//builder.Services.AddScoped<IAuditLogService, AuditLogService>();


//#endregion
//#region 🔷 WhatsApp settings
//builder.Services.AddScoped<IWhatsAppSettingsService, WhatsAppSettingsService>();
//builder.Services.AddValidatorsFromAssemblyContaining<SaveWhatsAppSettingValidator>();
//builder.Services.AddHttpClient<IMessageEngineService, MessageEngineService>();
//builder.Services.AddScoped<IWhatsAppTemplateFetcherService, WhatsAppTemplateFetcherService>();

//// ✅ Force DI to use correct class from MessagesEngine.PayloadBuilders
//builder.Services.AddScoped<EnginePayloadBuilders.TextMessagePayloadBuilder>();
//builder.Services.AddScoped<EnginePayloadBuilders.ImageMessagePayloadBuilder>();
//builder.Services.AddScoped<EnginePayloadBuilders.TemplateMessagePayloadBuilder>();
//builder.Services.AddScoped<EnginePayloadBuilders.CtaMessagePayloadBuilder>();
//builder.Services.AddScoped<IPlanManager, PlanManager>();
//builder.Services.AddScoped<ICTAManagementService, CTAManagementService>();


//#endregion
//#region 🔷 Inbox 
//builder.Services.AddScoped<IFlowAnalyticsService, FlowAnalyticsService>();
//builder.Services.AddScoped<IInboxService, InboxService>();
//builder.Services.AddScoped<IInboundMessageProcessor, InboundMessageProcessor>();
//builder.Services.AddScoped<IInboxRepository, InboxRepository>();
//#endregion 

//// AutoReplyBuilder Module
//builder.Services.AddScoped<IAutoReplyRepository, AutoReplyRepository>();
//builder.Services.AddScoped<IAutoReplyService, AutoReplyService>();
//builder.Services.AddScoped<IAutoReplyFlowRepository, AutoReplyFlowRepository>();
//builder.Services.AddScoped<IAutoReplyFlowService, AutoReplyFlowService>();
//builder.Services.AddScoped<IAutoReplyRuntimeService, AutoReplyRuntimeService>();
//builder.Services.AddScoped<IChatSessionStateService, ChatSessionStateService>();
//builder.Services.AddScoped<IAgentAssignmentService, AgentAssignmentService>();

//// 🧠 Automation Module - Dependency Injection
//builder.Services.AddScoped<IAutomationFlowRepository, AutomationFlowRepository>();
//builder.Services.AddScoped<IAutomationRunner, AutomationRunner>();
//builder.Services.AddScoped<IAutomationService, AutomationService>();


//#region 🔐 JWT Authentication (Token + Cookie Based)
//#region 🔐 JWT Authentication (Secure Cookie + Expiry Handling)
//builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
//    .AddJwtBearer(options =>
//    {
//        var jwtSettings = builder.Configuration.GetSection("JwtSettings");

//        options.TokenValidationParameters = new TokenValidationParameters
//        {
//            ValidateIssuer = true,
//            ValidateAudience = true,
//            ValidateLifetime = true,
//            ValidateIssuerSigningKey = true,
//            ValidIssuer = jwtSettings["Issuer"],
//            ValidAudience = jwtSettings["Audience"],
//            IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(jwtSettings["SecretKey"])),
//            ClockSkew = TimeSpan.Zero // No token grace period
//        };

//        options.Events = new JwtBearerEvents
//        {
//            OnMessageReceived = context =>
//            {
//                var token = context.Request.Cookies["xbyte_token"];
//                if (!string.IsNullOrEmpty(token))
//                {
//                    context.Token = token;
//                }
//                return Task.CompletedTask;
//            },
//            OnAuthenticationFailed = context =>
//            {
//                if (context.Exception is SecurityTokenExpiredException)
//                {
//                    context.Response.StatusCode = 401;
//                    context.Response.ContentType = "application/json";
//                    return context.Response.WriteAsync("{\"success\":false,\"message\":\"❌ Token expired. Please login again.\"}");
//                }
//                return Task.CompletedTask;
//            }
//        };
//    });



//builder.Services.AddAuthorization();
//#endregion
//#endregion
//#region 🌐 CORS Setup (Secure Cookie-Compatible)

//var allowedOrigins = builder.Configuration.GetSection("Cors:AllowedOrigins").Get<string[]>();

//builder.Services.AddCors(options =>
//{
//    options.AddPolicy("AllowFrontend", policy =>
//    {
//        policy
//            .WithOrigins(allowedOrigins ?? Array.Empty<string>())
//            .AllowAnyHeader()
//            .AllowAnyMethod()
//            .AllowCredentials();
//    });
//});
////builder.Services.AddCors(options =>
////{
////    options.AddPolicy("AllowFrontend", policy =>
////    {
////        policy.WithOrigins("busiorbit-ui-c0dbc0crazd6bae4.centralindia-01.azurewebsites.net") // ✅ React dev URL
////              .AllowAnyHeader()
////              .AllowAnyMethod()
////              .AllowCredentials(); // ✅ Needed for httpOnly cookie
////    });
////});
//#endregion

//#region ✅ MVC + Swagger + Middleware
//builder.Services.AddControllers()
//    .AddJsonOptions(opts =>
//    {
//        opts.JsonSerializerOptions.Converters.Add(new JsonStringEnumConverter(JsonNamingPolicy.CamelCase));
//    });

//builder.Services.AddEndpointsApiExplorer();
////builder.Services.AddSwaggerGen(

////    );
//try
//{
//    builder.Services.AddSwaggerGen(options =>
//{
//    options.SwaggerDoc("v1", new Microsoft.OpenApi.Models.OpenApiInfo
//    {
//        Title = "xByteChat API",
//        Version = "v1",
//        Description = "API documentation for xByteChat project"
//    });

//    // Optional: include XML comments if enabled
//    var xmlFile = $"{System.Reflection.Assembly.GetExecutingAssembly().GetName().Name}.xml";
//    var xmlPath = Path.Combine(AppContext.BaseDirectory, xmlFile);
//    if (File.Exists(xmlPath))
//        options.IncludeXmlComments(xmlPath);
//});
//}
//catch (Exception ex)
//{
//    Console.WriteLine("⚠️ Swagger registration failed: " + ex.Message);
//}
//#endregion
//builder.Services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());
//#region ✅ For output in visual studio code
//builder.Logging.ClearProviders();         // Clear default log providers
//builder.Logging.AddConsole();             // Add console logging

//#region SignalR
//builder.Services.AddSignalR();
//builder.Services.AddSingleton<IUserIdProvider, NameUserIdProvider>();


//#endregion
//var app = builder.Build();

//#region 🌐 Middleware Pipeline Setup
//AuditLoggingHelper.Configure(app.Services);

//app.UseMiddleware<GlobalExceptionMiddleware>();
///*/*app.UseMiddleware<JwtErrorHandlingMiddleware>();*/// ✅ Handle JWT Expired errors
//#endregion
//if (app.Environment.IsDevelopment())
//{

//}
//app.UseSwagger();
//app.UseSwaggerUI();
//app.UseHttpsRedirection();
//// ✅ Secure CORS policy applied BEFORE auth
//app.Use(async (context, next) =>
//{
//    context.Response.Headers["X-Content-Type-Options"] = "nosniff";
//    context.Response.Headers["X-Frame-Options"] = "DENY";
//    context.Response.Headers["X-XSS-Protection"] = "1; mode=block";
//    context.Response.Headers["Referrer-Policy"] = "strict-origin-when-cross-origin";
//    context.Response.Headers["Permissions-Policy"] = "geolocation=(), microphone=(), camera=()";
//    await next();
//});
//app.UseCors("AllowFrontend");

//app.UseAuthentication();
//app.UseAuthorization();

//app.MapControllers();
//app.MapHub<InboxHub>("/hubs/inbox");
//app.Run();
//#endregion






``n
--- file: xbytechat-api/Properties/launchSettings.json  (sha256:3374c65b7338b8a459db1242f356b2dd07d3dfd4cded988482a8f34fbe64e62e)
`$lang
{
  "$schema": "http://json.schemastore.org/launchsettings.json",
  "iisSettings": {
    "windowsAuthentication": false,
    "anonymousAuthentication": true,
    "iisExpress": {
      "applicationUrl": "http://localhost:18939",
      "sslPort": 44375
    }
  },
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "http://localhost:5295;http://localhost:7113",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "launchUrl": "swagger",
      "applicationUrl": "http://localhost:7113;http://localhost:5295",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "IIS Express": {
      "commandName": "IISExpress",
      "launchBrowser": true,
      "launchUrl": "swagger",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}

``n
--- file: xbytechat-api/RepositoriesGen/Implementations/GenericRepository.cs  (sha256:68fdbced75094ad69adcf2073501cec37b1745f7b4d6206826d6aedc33fe0a46)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.Repositories.Interfaces;

namespace xbytechat.api.Repositories.Implementations
{
    public class GenericRepository<T> : IGenericRepository<T> where T : class
    {
        private readonly AppDbContext _context;
        private readonly DbSet<T> _dbSet;

        public GenericRepository(AppDbContext context)
        {
            _context = context;
            _dbSet = _context.Set<T>();
        }

        public async Task<IEnumerable<T>> GetAllAsync()
        {
            return await _dbSet.ToListAsync();
        }

        public async Task<T?> FindByIdAsync(Guid id)
        {
            return await _dbSet.FindAsync(id);
        }

        public async Task AddAsync(T entity)
        {
            await _dbSet.AddAsync(entity);
        }

        public void Update(T entity)
        {
            _dbSet.Update(entity);
        }

        public void Delete(T entity)
        {
            _dbSet.Remove(entity);
        }

        public async Task<T?> FirstOrDefaultAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.FirstOrDefaultAsync(predicate);
        }

        public async Task<IEnumerable<T>> FindAllAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.Where(predicate).ToListAsync();
        }

        public async Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate)
        {
            return await _dbSet.AnyAsync(predicate);
        }

        public async Task SaveAsync()
        {
            await _context.SaveChangesAsync();
        }

        public async Task<List<T>> WhereAsync(Expression<Func<T, bool>> predicate)
        {
            return await _context.Set<T>().Where(predicate).ToListAsync();
        }

        // ✅ NEW: Enables .Include(), .ThenInclude(), etc.
        public IQueryable<T> AsQueryable()
        {
            return _dbSet.AsQueryable();
        }
    }
}

``n
--- file: xbytechat-api/RepositoriesGen/Interfaces/IGenericRepository.cs  (sha256:dce9a4518c5e6db0da8996246969bbc864c23c5ec0eeb93ac053cc16a33bc920)
`$lang
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Threading.Tasks;

namespace xbytechat.api.Repositories.Interfaces
{
    public interface IGenericRepository<T> where T : class
    {
        // 🔍 Basic Reads
        Task<IEnumerable<T>> GetAllAsync();
        Task<T?> FindByIdAsync(Guid id);
        Task<T?> FirstOrDefaultAsync(Expression<Func<T, bool>> predicate);
        Task<IEnumerable<T>> FindAllAsync(Expression<Func<T, bool>> predicate);

        // 🔐 Checks
        Task<bool> ExistsAsync(Expression<Func<T, bool>> predicate);

        // ✍️ Commands
        Task AddAsync(T entity);
        void Update(T entity);
        void Delete(T entity);
        Task SaveAsync();

        Task<List<T>> WhereAsync(Expression<Func<T, bool>> predicate);

        // ✅ New: Supports advanced LINQ operations like Include()
        IQueryable<T> AsQueryable();
    }
}

``n
--- file: xbytechat-api/Services/MessageModule/Implementations/MessageService.cs  (sha256:4a9530274bcc8a60c09a984dfd7c120424ee9f5b32a1d430a4f393b0ebd5d45c)
`$lang
using System.Text;
using System.Net.Http.Headers;
using Newtonsoft.Json;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Helpers;
using xbytechat.api.Models;
using xbytechat.api.PayloadBuilders;
using xbytechat.api.Repositories.Interfaces;
using xbytechat.api.Services.Messages.Interfaces;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.EntityFrameworkCore;
using xbytechat.api.CRM.Models;

namespace xbytechat.api.Services.Messages.Implementations
{
    public class MessageService : IMessageService
    {
        private readonly AppDbContext _dbContext;
        private readonly HttpClient _httpClient;
        private readonly IConfiguration _config;
        private readonly IGenericRepository<MessageLog> _messageLogRepo;
        private readonly Dictionary<string, IWhatsAppPayloadBuilder> _payloadBuilders;
        private readonly ILogger<MessageService> _logger;

        public MessageService(
            AppDbContext dbContext,
            HttpClient httpClient,
            IConfiguration config,
            IGenericRepository<MessageLog> messageLogRepo,
            IEnumerable<IWhatsAppPayloadBuilder> builders,
            ILogger<MessageService> logger)
        {
            _dbContext = dbContext;
            _httpClient = httpClient;
            _config = config;
            _messageLogRepo = messageLogRepo;
            _logger = logger;

            _payloadBuilders = builders.ToDictionary(
                b => b.GetType().Name.Replace("MessagePayloadBuilder", "").ToLower(),
                b => b
            );
        }

        public async Task SendFollowUpAsync(string recipientNumber, string messageContent)
        {
            var dto = new TextMessageDto
            {
                RecipientNumber = recipientNumber,
                MessageContent = messageContent,
                BusinessId = Guid.Empty // Optional: Set dynamically if needed
            };

            await SendMessageAsync(dto); // ✅ You already have this method
        }


        public async Task<SendResultExtended> SendMessageAsync(BaseMessageDto dto)
        {
            var messageType = dto.GetType().Name.Replace("MessageDto", "").ToLower();

            // 🧠 Get the right builder (e.g., for text, image)
            if (!_payloadBuilders.TryGetValue(messageType, out var builder))
            {
                return new SendResultExtended
                {
                    Success = false,
                    Message = "❌ Unsupported message type: " + messageType
                };
            }

            var apiUrl = _config["WhatsApp:ApiUrl"];
            var apiToken = _config["WhatsApp:apiToken"];
            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", apiToken);

            var payload = builder.BuildPayload(dto);
            var json = JsonConvert.SerializeObject(payload);
            var content = new StringContent(json, Encoding.UTF8, "application/json");

            _logger.LogInformation("📦 Sending Payload: {Payload}", json);

            try


            {
                // 🛠️ Log the payload for debugging
                _logger.LogInformation("📤 Final WhatsApp Payload:\n" + JsonConvert.SerializeObject(payload, Formatting.Indented));

                var response = await _httpClient.PostAsync(apiUrl, content);
                var rawResponse = await response.Content.ReadAsStringAsync();

                string? messageId = null;

                // 🧾 Try extracting messageId (WAMID) from response
                if (response.IsSuccessStatusCode)
                {
                    try
                    {
                        var jsonObj = JsonConvert.DeserializeObject<dynamic>(rawResponse);
                        messageId = jsonObj?.messages?[0]?.id;
                    }
                    catch (Exception ex)
                    {
                        _logger.LogWarning("✅ Message sent but failed to parse WAMID: " + ex.Message);
                    }
                }

                // 📝 Log message for tracking
                var log = new MessageLog
                {
                    BusinessId = dto.BusinessId,
                    RecipientNumber = dto.RecipientNumber,
                    MessageContent = dto is TextMessageDto textDto && !string.IsNullOrEmpty(textDto.MessageContent)
                        ? textDto.MessageContent
                        : "[Empty or Non-Text]",
                    MediaUrl = (dto as ImageMessageDto)?.MediaUrl,
                    Status = response.IsSuccessStatusCode ? "Sent" : "Failed",
                    ErrorMessage = response.IsSuccessStatusCode ? null : response.ReasonPhrase,
                    RawResponse = rawResponse,
                    SentAt = DateTime.UtcNow,
                    MessageId = messageId
                };

                await _messageLogRepo.AddAsync(log);
                await _messageLogRepo.SaveAsync();

                return new SendResultExtended
                {
                    Success = response.IsSuccessStatusCode,
                    Message = response.IsSuccessStatusCode ? "✅ Message sent successfully" : "❌ Failed to send message",
                    MessageId = messageId,
                    RawResponse = rawResponse,
                    MessageLogId = log.Id
                };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Exception during message send");

                return new SendResultExtended
                {
                    Success = false,
                    Message = "❌ Exception while sending",
                    ErrorMessage = ex.Message
                };
            }
        }
        public async Task<SendResultExtended> SendInteractiveMessageAsync(string recipientPhone, string bodyText, List<string> buttons)
        {
            var apiUrl = _config["WhatsApp:ApiUrl"];
            var apiToken = _config["WhatsApp:apiToken"];

            _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", apiToken);

            var payload = new
            {
                messaging_product = "whatsapp",
                to = recipientPhone,
                type = "interactive",
                interactive = new
                {
                    type = "button",
                    body = new { text = bodyText },
                    action = new
                    {
                        buttons = buttons.Select((text, index) => new
                        {
                            type = "reply",
                            reply = new
                            {
                                id = $"cta_{index + 1}",
                                title = text
                            }
                        }).ToList()
                    }
                }
            };

            var json = JsonConvert.SerializeObject(payload);
            var content = new StringContent(json, Encoding.UTF8, "application/json");

            _logger.LogInformation("🚀 Sending CTA Message: " + json);

            try
            {
                var response = await _httpClient.PostAsync(apiUrl, content);
                var rawResponse = await response.Content.ReadAsStringAsync();
                // Message send here successfully 
                string? messageId = null;
                if (response.IsSuccessStatusCode)
                {
                    try
                    {
                        dynamic jsonObj = JsonConvert.DeserializeObject<dynamic>(rawResponse);
                        messageId = jsonObj?.messages?[0]?.id;
                    }
                    catch (Exception ex)
                    {
                        _logger.LogWarning("⚠️ Sent, but failed to parse messageId: " + ex.Message);
                    }
                }

                // Log to MessageLogs table (optional: use a dummy entry)

                var log = new MessageLog
                {

                    //BusinessId = Guid.Parse("put-a-valid-business-guid-here"), //Guid.Empty, // set properly if you want to track
                    BusinessId = Guid.TryParse("45262049-0127-4658-93e1-b3ffea645f4f", out var parsedId)
    ? parsedId
    : throw new FormatException("❌ Invalid GUID format used for BusinessId."),
                    RecipientNumber = recipientPhone,
                    MessageContent = bodyText,
                    Status = response.IsSuccessStatusCode ? "Sent" : "Failed",
                    ErrorMessage = response.IsSuccessStatusCode ? null : response.ReasonPhrase,
                    RawResponse = rawResponse,
                    SentAt = DateTime.UtcNow,
                    MessageId = messageId
                };

                await _messageLogRepo.AddAsync(log);
                await _messageLogRepo.SaveAsync();

                return new SendResultExtended
                {
                    Success = response.IsSuccessStatusCode,
                    Message = response.IsSuccessStatusCode ? "✅ CTA message sent" : "❌ Failed to send CTA",
                    MessageId = messageId,
                    RawResponse = rawResponse,
                    MessageLogId = log.Id
                };
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Exception while sending CTA");

                return new SendResultExtended
                {
                    Success = false,
                    Message = "❌ Exception while sending CTA",
                    ErrorMessage = ex.InnerException?.Message ?? ex.Message // ✅ this is critical
                };
            }

        }

    }
}






``n
--- file: xbytechat-api/Services/MessageModule/Interfaces/IMessageService.cs  (sha256:7592cb1c94c37bab95a7c1a34fbc22e00b2fa0428bc1a23a4c2626a437314c30)
`$lang
using System.Threading.Tasks;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Helpers;

namespace xbytechat.api.Services.Messages.Interfaces
{
    public interface IMessageService
    {
        /// <summary>
        /// Sends a message of any supported type (Text, Image, Template).
        /// </summary>
        /// <param name="dto">Base DTO representing message details.</param>
        /// <returns>Standardized result with status, error info, and raw response.</returns>
        Task<SendResultExtended> SendMessageAsync(BaseMessageDto dto);
        //Task<SendResultExtended> SendBulkMessagesAsync(BulkMessageDto dto);
        Task SendFollowUpAsync(string recipientNumber, string messageContent);
        Task<SendResultExtended> SendInteractiveMessageAsync(string recipientPhone, string bodyText, List<string> buttons);


    }
}

``n
--- file: xbytechat-api/Services/WhatsAppService.cs  (sha256:239db95488943944c9836125a53c4ede14522f2bc4914748e07350d86cc0051f)
`$lang
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;
using Microsoft.Extensions.Configuration;
using xbytechat.api.Models;

namespace xbytechat.api.Services
{
    public class WhatsAppService
    {
        private readonly HttpClient _httpClient;
        private readonly string _whatsAppToken;
        private readonly string _whatsAppPhoneId;

        public WhatsAppService(IConfiguration configuration)
        {
            _httpClient = new HttpClient();

            _whatsAppToken = configuration["WhatsApp:apiToken"];
            _whatsAppPhoneId = configuration["WhatsApp:PhoneNumberId"];

            if (string.IsNullOrEmpty(_whatsAppToken))
                Console.WriteLine("❌ Token is NULL or EMPTY from config!");

            if (string.IsNullOrEmpty(_whatsAppPhoneId))
                Console.WriteLine("❌ Phone ID is NULL or EMPTY from config!");
        }

        public async Task<WhatsAppResult> SendMessageAsync(string recipientPhone, string messageText)
        {
            try
            {
                Console.WriteLine("👉 Preparing to send WhatsApp message...");
                var url = $"https://graph.facebook.com/v22.0/{_whatsAppPhoneId}/messages";

                var payload = new
                {
                    messaging_product = "whatsapp",
                    to = recipientPhone,
                    type = "text",
                    text = new { body = messageText }
                };

                var json = JsonSerializer.Serialize(payload);
                var content = new StringContent(json, Encoding.UTF8, "application/json");

                _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", _whatsAppToken);

                var response = await _httpClient.PostAsync(url, content);
                var responseBody = await response.Content.ReadAsStringAsync();

                Console.WriteLine($"✅ Status: {response.StatusCode}");
                Console.WriteLine($"📥 Response: {responseBody}");

                if (response.IsSuccessStatusCode)
                {
                    return new WhatsAppResult { Success = true, RawResponse = responseBody };
                }
                else
                {
                    return new WhatsAppResult
                    {
                        Success = false,
                        ErrorMessage = $"Meta API Error: {response.StatusCode}",
                        RawResponse = responseBody
                    };
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine("❌ Exception while sending:");
                Console.WriteLine(ex.Message);

                return new WhatsAppResult
                {
                    Success = false,
                    ErrorMessage = ex.Message
                };
            }
        }

    }
}

``n
--- file: xbytechat-api/Shared/AutoMapperProfile.cs  (sha256:989f0b9b654be427f90cea952c56afc87d0c6b647e71bae60f9694b4e21bacf2)
`$lang
using AutoMapper;
using xbytechat.api.CRM.Dtos;
using xbytechat.api.CRM.Models;
using xbytechat.api.Features.CampaignModule.DTOs;
using xbytechat.api.Features.CampaignModule.Models;
using xbytechat.api.DTOs.Messages;
using xbytechat.api.Features.Tracking.DTOs;
using xbytechat.api.Features.Tracking.Models;
using xbytechat.api.Features.MessageManagement.DTOs;

namespace xbytechat.api.Shared
{
    public class AutoMapperProfile : Profile
    {
        public AutoMapperProfile()
        {
            CreateMap<Contact, ContactDto>();
            CreateMap<Campaign, CampaignDto>();
            CreateMap<MessageLog, MessageLogDto>();
            CreateMap<TrackingLog, TrackingLogDto>();
        }
    }
}

``n
--- file: xbytechat-api/Shared/ClaimsBusinessDetails.cs  (sha256:c2e6949a61ef96fc2c06636f297b8d8d033f3f29fa5d7b57230743db945ed0a2)
`$lang
using System;
using System.Security.Claims;

namespace xbytechat.api.Shared
{
    public static class ClaimsBusinessDetails
    {
        public static Guid GetBusinessId(this ClaimsPrincipal user)
        {
            var businessIdClaim = user.FindFirst("businessId")?.Value; // lowercase only!
            if (string.IsNullOrEmpty(businessIdClaim) || !Guid.TryParse(businessIdClaim, out var businessId))
                throw new UnauthorizedAccessException("Invalid or missing businessId in token.");
            return businessId;
        }

        public static Guid GetUserId(this ClaimsPrincipal user)
        {
            var userIdClaim = user.FindFirst(ClaimTypes.NameIdentifier)?.Value;
            if (string.IsNullOrEmpty(userIdClaim) || !Guid.TryParse(userIdClaim, out var userId))
                throw new UnauthorizedAccessException("Invalid or missing userId in token.");
            return userId;
        }
    }
}

``n
--- file: xbytechat-api/Shared/PaginatedRequest.cs  (sha256:af6fceb743c7fcb6bbb984e08b2bb8e696a447e38e61b6fc85a7b9dd48a0fb04)
`$lang
namespace xbytechat.api.Shared
{
    public class PaginatedRequest
    {
        public int Page { get; set; } = 1;       // Page number (1-based)
        public int PageSize { get; set; } = 10;  // Items per page

        // Optional filter (can be extended later)
        public string? Status { get; set; }
        public string? Search { get; set; }
    }
}


``n
--- file: xbytechat-api/Shared/PaginatedResponse.cs  (sha256:d59aca9b4129006df5c4ec39b4e6793672e9493f4581e7963b6c215465d1b113)
`$lang
using System.Collections.Generic;

namespace xbytechat.api.Shared
{
    public class PaginatedResponse<T>
    {
        public List<T> Items { get; set; } = new();
        public int TotalCount { get; set; }
        public int Page { get; set; }
        public int PageSize { get; set; }
    }
}

``n
--- file: xbytechat-api/Shared/TrackingUtils/DeviceHelper.cs  (sha256:70ad5b3deb3b07358a3ce61a514b3a9c3f4bb78007752bd0f4106ef8a3f27b32)
`$lang
// File: Features/CTATracking/Utils/DeviceHelper.cs

namespace xbytechat.api.Shared.TrackingUtils
{
    public static class DeviceHelper
    {
        public static string GetDeviceType(string userAgent)
        {
            if (string.IsNullOrEmpty(userAgent)) return "Unknown";

            userAgent = userAgent.ToLower();

            if (userAgent.Contains("mobile") || userAgent.Contains("android") || userAgent.Contains("iphone"))
                return "Mobile";

            if (userAgent.Contains("ipad") || userAgent.Contains("tablet"))
                return "Tablet";

            if (userAgent.Contains("windows") || userAgent.Contains("macintosh"))
                return "Desktop";

            return "Unknown";
        }
    }
}

``n
--- file: xbytechat-api/Shared/TrackingUtils/GeoHelper.cs  (sha256:359da4b5f8939751d00d9137b41774e466af302ccaf60e203c1b0f0827a9eafd)
`$lang
// File: Features/CTATracking/Utils/GeoHelper.cs

using System.Net.Http;
using System.Text.Json;
using System.Threading.Tasks;

namespace xbytechat.api.Shared.TrackingUtils
{
    public static class GeoHelper
    {
        public static async Task<string> GetCountryFromIP(string ipAddress)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(ipAddress) || ipAddress == "::1")
                    return "Localhost";

                using var client = new HttpClient();
                var response = await client.GetStringAsync($"https://ipapi.co/{ipAddress}/json/");

                var doc = JsonDocument.Parse(response);
                if (doc.RootElement.TryGetProperty("country_name", out var countryProp))
                    return countryProp.GetString() ?? "Unknown";
            }
            catch
            {
                // fallback
            }

            return "Unknown";
        }
    }
}

``n
--- file: xbytechat-api/Shared/TrackingUtils/TrackingUrlBuilder.cs  (sha256:d944abb54aa2863bcad184f9d8bbd42d683f5d0b0b07474ea3f26903e7cc13d5)
`$lang
using System;
using System.Web;

namespace xbytechat.api.Shared.TrackingUtils
{
    public static class TrackingUrlBuilder
    {
        public static string BuildTrackingUrl(
            Guid businessId,
            string sourceType,
            Guid sourceId,
            string buttonText,
            string redirectUrl,
            Guid? messageId = null,
            Guid? contactId = null,
            string contactPhone = null,
            string sessionId = null,
            string threadId = null)
        {
            var query = HttpUtility.ParseQueryString(string.Empty);
            query["src"] = sourceType;
            query["id"] = sourceId.ToString();
            query["btn"] = buttonText;
            query["to"] = redirectUrl;
            query["type"] = buttonText;
            if (messageId != null) query["msg"] = messageId.ToString();
            if (contactId != null) query["contact"] = contactId.ToString();
            if (!string.IsNullOrEmpty(contactPhone)) query["phone"] = contactPhone;
            if (!string.IsNullOrEmpty(sessionId)) query["session"] = sessionId;
            if (!string.IsNullOrEmpty(threadId)) query["thread"] = threadId;

            var baseUrl = Environment.GetEnvironmentVariable("API_BASE_URL") ?? "https://yourdomain.com";
            return $"{baseUrl}/api/tracking/redirect?{query}";
        }
    }
}

``n
--- file: xbytechat-api/Shared/utility/TemplateParameterHelper.cs  (sha256:51753bdf8ce7b9964913d5a501bee92803cf58d23cc315def80b8c69561dfbe1)
`$lang
using Newtonsoft.Json;
using System.Text.RegularExpressions;

namespace xbytechat.api.Shared.utility
{
    public static class TemplateParameterHelper
    {
        // ✅ Used when parsing stored JSON parameters
        public static List<string> ParseTemplateParams(string? jsonString)
        {
            if (string.IsNullOrWhiteSpace(jsonString)) return new List<string>();
            try
            {
                return JsonConvert.DeserializeObject<List<string>>(jsonString) ?? new List<string>();
            }
            catch
            {
                return new List<string>();
            }
        }

        // ✅ NEW: Fills {{1}}, {{2}} with parameter values
        public static string FillPlaceholders(string template, List<string> parameters)
        {
            if (string.IsNullOrWhiteSpace(template) || parameters == null || parameters.Count == 0)
                return template;

            // Replace {{1}}, {{2}} ... with values
            return Regex.Replace(template, @"\{\{(\d+)\}\}", match =>
            {
                var index = int.Parse(match.Groups[1].Value) - 1;
                return index >= 0 && index < parameters.Count ? parameters[index] : match.Value;
            });
        }
    }
}

``n
--- file: xbytechat-api/Validators/MessageTypeValidator.cs  (sha256:a9accea936700f5fa40d270dffc11079bdce7a4ede1f30f968b41436460b80b2)
`$lang
namespace xbytechat.api.Validators
{
    /// <summary>
    /// Centralized validator for supported message types (text, image, template, etc.)
    /// </summary>
    public static class MessageTypeValidator
    {
        private static readonly HashSet<string> SupportedTypes = new()
        {
            "text", "image", "template"
        };

        /// <summary>
        /// Checks whether a messageType is supported.
        /// </summary>
        public static bool IsValid(string? messageType)
        {
            return !string.IsNullOrWhiteSpace(messageType) &&
                   SupportedTypes.Contains(messageType.ToLower());
        }

        /// <summary>
        /// Returns all supported message types.
        /// </summary>
        public static IEnumerable<string> GetSupportedTypes()
        {
            return SupportedTypes;
        }
    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Controllers/WhatsAppSettingsController.cs  (sha256:6afee1d3a9680e97d33644eb9415cbdfdd9b34d14f56727d201f7621d46bddd0)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using System;
using System.Linq;
using System.Security.Claims;
using System.Threading.Tasks;
using xbytechat.api.Shared;
using xbytechat_api.WhatsAppSettings.DTOs;
using xbytechat_api.WhatsAppSettings.Services;

namespace xbytechat_api.WhatsAppSettings.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [Authorize]
    public class WhatsAppSettingsController : ControllerBase
    {
        private readonly IWhatsAppSettingsService _whatsAppSettingsService;
        private readonly ILogger<WhatsAppSettingsController> _logger;

        public WhatsAppSettingsController(
            IWhatsAppSettingsService whatsAppSettingsService,
            ILogger<WhatsAppSettingsController> logger)
        {
            _whatsAppSettingsService = whatsAppSettingsService;
            _logger = logger;
        }

        [HttpPut("update")]
        public async Task<IActionResult> UpdateSetting([FromBody] SaveWhatsAppSettingDto dto)
        {
            _logger.LogInformation("🔧 [UpdateSetting] Request received for WhatsApp settings update.");

            if (!ModelState.IsValid)
            {
                var validationErrors = ModelState
                    .Where(e => e.Value.Errors.Count > 0)
                    .Select(e => new
                    {
                        Field = e.Key,
                        Errors = e.Value.Errors.Select(x => x.ErrorMessage)
                    });

                _logger.LogWarning("❌ [UpdateSetting] Validation failed: {@Errors}", validationErrors);
                return BadRequest(new { message = "❌ Invalid input.", errors = validationErrors });
            }

            Guid businessId;
            try
            {
                businessId = User.GetBusinessId(); // ✅ Cleaner using your helper
                dto.BusinessId = businessId;
            }
            catch (UnauthorizedAccessException ex)
            {
                _logger.LogWarning("❌ [UpdateSetting] BusinessId claim missing or invalid: {Message}", ex.Message);
                return Unauthorized(new { message = "❌ BusinessId missing or invalid in token." });
            }

            if (string.IsNullOrWhiteSpace(dto.ApiToken) || string.IsNullOrWhiteSpace(dto.PhoneNumberId))
            {
                _logger.LogWarning("❌ [UpdateSetting] Missing ApiToken or PhoneNumberId.");
                return BadRequest(new { message = "❌ API Token and Phone Number ID are required." });
            }

            try
            {
                _logger.LogInformation("💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId={BusinessId}.", businessId);
                await _whatsAppSettingsService.SaveOrUpdateSettingAsync(dto);
                _logger.LogInformation("✅ [UpdateSetting] WhatsApp settings updated successfully.");
                return Ok(new { message = "✅ WhatsApp settings saved/updated successfully." });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ [UpdateSetting] Exception occurred while saving settings.");
                return StatusCode(500, new { message = "❌ Error while saving settings.", details = ex.Message });
            }
        }

        [HttpGet("me")]
        public async Task<IActionResult> GetMySettings()
        {
  
            var businessId = User.GetBusinessId();
            var setting = await _whatsAppSettingsService.GetSettingsByBusinessIdAsync(businessId);
            if (setting == null)
                return NotFound(new { message = "❌ WhatsApp settings not found." });

            return Ok(setting);
        }

        [HttpGet("{businessId}")]
        public async Task<IActionResult> GetSetting(Guid businessId)
        {
            if (businessId == Guid.Empty)
                return BadRequest(new { message = "❌ Invalid businessId." });

            var setting = await _whatsAppSettingsService.GetSettingsByBusinessIdAsync(businessId);
            if (setting == null)
                return NotFound(new { message = "❌ WhatsApp settings not found." });

            return Ok(setting);
        }
        //[HttpPost("test-connection")]
        //public async Task<IActionResult> TestConnection([FromBody] SaveWhatsAppSettingDto dto)
        //{
        //    if (string.IsNullOrWhiteSpace(dto.ApiToken) || string.IsNullOrWhiteSpace(dto.ApiUrl))
        //        return BadRequest(new { message = "❌ API Token and API URL are required for testing connection." });

        //    try
        //    {
        //        var result = await _whatsAppSettingsService.TestConnectionAsync(dto);
        //        return Ok(new { message = result });
        //    }
        //    catch (Exception ex)
        //    {
        //        return StatusCode(500, new { message = "❌ Test connection failed.", details = ex.Message });
        //    }
        //}
        [HttpPost("test-connection")]
        public async Task<IActionResult> TestConnection([FromBody] SaveWhatsAppSettingDto dto)
        {
            if (string.IsNullOrWhiteSpace(dto.ApiToken) || string.IsNullOrWhiteSpace(dto.ApiUrl))
                return BadRequest(new { message = "❌ API Token and API URL are required for testing connection." });

            try
            {
                var result = await _whatsAppSettingsService.TestConnectionAsync(dto);
                return Ok(new { message = result });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { message = "❌ Test connection failed.", details = ex.Message });
            }
        }

        [HttpDelete("delete")]
        public async Task<IActionResult> DeleteSetting()
        {
            var businessIdStr = User.FindFirst("BusinessId")?.Value;
            if (!Guid.TryParse(businessIdStr, out var businessId))
                return Unauthorized(new { message = "❌ BusinessId missing or invalid in token." });

            var result = await _whatsAppSettingsService.DeleteSettingsAsync(businessId);
            if (!result)
                return NotFound(new { message = "❌ No WhatsApp settings found to delete." });

            return Ok(new { message = "🗑️ WhatsApp settings deleted successfully." });
        }
    }
}


//using Microsoft.AspNetCore.Mvc;
//using System;
//using System.Threading.Tasks;
//using xbytechat_api.WhatsAppSettings.DTOs;
//using xbytechat_api.WhatsAppSettings.Services;

//namespace xbytechat_api.WhatsAppSettings.Controllers
//{
//    [ApiController]
//    [Route("api/[controller]")]
//    public class WhatsAppSettingsController : ControllerBase
//    {
//        private readonly IWhatsAppSettingsService _whatsAppSettingsService;

//        public WhatsAppSettingsController(IWhatsAppSettingsService whatsAppSettingsService)
//        {
//            _whatsAppSettingsService = whatsAppSettingsService;
//        }


//        [HttpPut("update")]
//        public async Task<IActionResult> UpdateSetting([FromBody] SaveWhatsAppSettingDto dto)
//        {
//            if (!ModelState.IsValid)
//                return BadRequest(new { message = "❌ Invalid input.", errors = ModelState });

//            if (string.IsNullOrWhiteSpace(dto.ApiToken) || string.IsNullOrWhiteSpace(dto.PhoneNumberId))
//                return BadRequest(new { message = "❌ API Token and Phone Number ID are required." });

//            try
//            {
//                await _whatsAppSettingsService.SaveOrUpdateSettingAsync(dto);
//                return Ok(new { message = "✅ WhatsApp settings saved/updated successfully." });
//            }
//            catch (Exception ex)
//            {
//                return StatusCode(500, new { message = "❌ Error while saving settings.", details = ex.Message });
//            }
//        }

//        /// <summary>
//        /// Get WhatsApp Settings by BusinessId
//        /// </summary>
//        [HttpGet("{businessId}")]
//        public async Task<IActionResult> GetSetting(Guid businessId)
//        {
//            if (businessId == Guid.Empty)
//                return BadRequest(new { message = "❌ Invalid businessId." });

//            var setting = await _whatsAppSettingsService.GetSettingsByBusinessIdAsync(businessId);
//            if (setting == null)
//                return NotFound(new { message = "❌ WhatsApp settings not found." });

//            return Ok(setting);
//        }

//        /// <summary>
//        /// Test WhatsApp Connection (API URL + Token)
//        /// </summary>
//        [HttpPost("test-connection")]
//        public async Task<IActionResult> TestConnection([FromBody] SaveWhatsAppSettingDto dto)
//        {
//            if (string.IsNullOrWhiteSpace(dto.ApiToken) || string.IsNullOrWhiteSpace(dto.ApiUrl))
//                return BadRequest(new { message = "❌ API Token and API URL are required for testing connection." });

//            try
//            {
//                var result = await _whatsAppSettingsService.TestConnectionAsync(dto);
//                return Ok(new { message = result });
//            }
//            catch (Exception ex)
//            {
//                return StatusCode(500, new { message = "❌ Test connection failed.", details = ex.Message });
//            }
//        }

//        /// <summary>
//        /// Delete WhatsApp Settings for a Business
//        /// </summary>
//        [HttpDelete("delete/{businessId}")]
//        public async Task<IActionResult> DeleteSetting(Guid businessId)
//        {
//            if (businessId == Guid.Empty)
//                return BadRequest(new { message = "❌ Invalid businessId." });

//            var result = await _whatsAppSettingsService.DeleteSettingsAsync(businessId);
//            if (!result)
//                return NotFound(new { message = "❌ No WhatsApp settings found to delete." });

//            return Ok(new { message = "🗑️ WhatsApp settings deleted successfully." });
//        }
//    }
//}

``n
--- file: xbytechat-api/WhatsAppSettings/Controllers/WhatsAppTemplateFetcherController.cs  (sha256:6a64af207ecc08df8ddba5f9b04afb58816cc87a04c8e74ad693655fe5fab584)
`$lang
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using xbytechat_api.WhatsAppSettings.Services;

namespace xbytechat_api.WhatsAppSettings.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class WhatsAppTemplateFetcherController : ControllerBase
    {
        private readonly IWhatsAppTemplateFetcherService _templateFetcherService;

        public WhatsAppTemplateFetcherController(IWhatsAppTemplateFetcherService templateFetcherService)
        {
            _templateFetcherService = templateFetcherService;
        }

        [HttpGet("get-template/{businessId}")]
        [Authorize] // ✅ Optional: Require authentication if your project uses JWT auth
        public async Task<IActionResult> FetchTemplates(Guid businessId)
        {
            if (businessId == Guid.Empty)
                return BadRequest(new { message = "❌ Invalid BusinessId." });

            var templates = await _templateFetcherService.FetchTemplatesAsync(businessId); // comment this line to stop fetch template as per businessid
            //var templates = await _templateFetcherService.FetchAllTemplatesAsync(); // comment this line to stop fetch template as per businessid

            return Ok(new
            {
                success = true,
                templates = templates
            });
        }
        [HttpGet("get-template-all")]
        public async Task<IActionResult> GetAllTemplatesAsync()
        {
            try
            {
                var templates = await _templateFetcherService.FetchAllTemplatesAsync();
                return Ok(new { success = true, templates });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new
                {
                    success = false,
                    message = "Error fetching templates",
                    detail = ex.Message
                });
            }
        }

        [HttpGet("get-template-by-name")]
        public async Task<IActionResult> GetTemplateByName([FromQuery] string name)
        {
            var businessId = Guid.Parse(User.FindFirst("businessId")?.Value);
            var template = await _templateFetcherService.GetTemplateByNameAsync(businessId, name, true);
            return template == null ? NotFound() : Ok(template);
        }
        [HttpGet("get-by-name/{businessId}/{templateName}")]
        public async Task<IActionResult> GetByName(Guid businessId, string templateName, [FromQuery] bool includeButtons = true)
        {
            if (businessId == Guid.Empty || string.IsNullOrWhiteSpace(templateName))
                return BadRequest(new { success = false, message = "❌ Missing or invalid parameters." });

            var template = await _templateFetcherService.GetTemplateByNameAsync(businessId, templateName, includeButtons);

            if (template == null)
                return NotFound();

            return Ok(new
            {
                success = true,
                template
            });
        }
    }
}


``n
--- file: xbytechat-api/WhatsAppSettings/DTOs/ButtonMetadataDto.cs  (sha256:55b2b89dbf3f8b8f16bb134711c23334c37a60c9543a1ea34325fb89506a6dce)
`$lang
namespace xbytechat.api.WhatsAppSettings.DTOs
{
    public class ButtonMetadataDto
    {
        public string Type { get; set; } // Example: "URL" or "PHONE_NUMBER"
        public string Text { get; set; } // Button Text
        public string SubType { get; set; } // (optional) for URL, Phone Number etc
        public int Index { get; set; } // Index like 0, 1
                                       // Optional: dynamic parameter value for validation
        public string? ParameterValue { get; set; } // e.g. coupon_code
    }

}

``n
--- file: xbytechat-api/WhatsAppSettings/DTOs/SaveWhatsAppSettingDto.cs  (sha256:2ae3c96b70b9bd13834e6fe68cd66fe7f7be3336385574f56d0489cccf053c6f)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat_api.WhatsAppSettings.DTOs
{
    public class SaveWhatsAppSettingDto
    {
       
        public Guid BusinessId { get; set; }

        [Required]
        [MaxLength(1000)]
        public string ApiToken { get; set; }

        [Required]
        [MaxLength(100)]
        public string PhoneNumberId { get; set; }  // ✅ NEW: Needed to send messages

        [MaxLength(100)]
        public string? WabaId { get; set; } // Optional

        [MaxLength(100)]
        public string? SenderDisplayName { get; set; }

        [Required]
        [MaxLength(500)]
        public string ApiUrl { get; set; } = "https://graph.facebook.com/v18.0/";

        [Required]
        [MaxLength(50)]
        public string WhatsAppBusinessNumber { get; set; }  // ✅ Still used for testing via `/me` or WABA ID

        public bool IsActive { get; set; } = true;
    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/DTOs/TemplateMetadataDto.cs  (sha256:ee243eac02e205bf965753cb204d12e1548d23a7d43b9b21717744b30b5845e5)
`$lang
namespace xbytechat.api.WhatsAppSettings.DTOs
{
    /// <summary>
    /// DTO representing a simplified view of WhatsApp template metadata.
    /// </summary>
    public class TemplateMetadataDto
    {
        /// Unique name of the template.
        public string Name { get; set; } = string.Empty;

        /// Language code used when creating the template (e.g., en_US, hi_IN).
        public string Language { get; set; } = "en_US";

        /// The message body content with placeholders (e.g., "Hi {{1}}, your order is ready").
        public string Body { get; set; } = string.Empty;

        /// Number of dynamic parameters required (e.g., 2 for {{1}} and {{2}}).
        public int PlaceholderCount { get; set; }

        public List<ButtonMetadataDto> ButtonParams { get; set; } = new List<ButtonMetadataDto>(); // ✅ Added Buttons
        public bool HasImageHeader { get; set; } = false;

    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Models/WhatsAppSettingEntity.cs  (sha256:86a9eeecdc03ce1f55e7057e15e38a1e82a136efb5adb1a16ec2e8de605a83dd)
`$lang
using System;
using System.ComponentModel.DataAnnotations;

namespace xbytechat_api.WhatsAppSettings.Models
{
    public class WhatsAppSettingEntity
    {
        [Key]
        public Guid Id { get; set; }

        [Required]
        public Guid BusinessId { get; set; }

        [Required]
        [MaxLength(500)]
        public string ApiUrl { get; set; }

        [Required]
        [MaxLength(1000)]
        public string ApiToken { get; set; }

        [Required]
        [MaxLength(20)]
        public string? WhatsAppBusinessNumber { get; set; }

        public string? PhoneNumberId { get; set; } //Meta Business phone number ID
        public string? WabaId { get; set; } = string.Empty; //WhatsApp Business Account ID

        [MaxLength(100)]
        public string? SenderDisplayName { get; set; }

        [Required]
        public bool IsActive { get; set; } = true;

        [Required]
        public DateTime CreatedAt { get; set; } = DateTime.UtcNow;

        public DateTime? UpdatedAt { get; set; }

        // string ApiVersion { get; set; } = "v18.0";

    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Services/IWhatsAppSettingsService.cs  (sha256:efcd668cb54b466be5f66ebf202f4e32ce48c8d1e8f6404a0d2366c0ec186549)
`$lang
using System;
using System.Threading.Tasks;
using xbytechat_api.WhatsAppSettings.DTOs;
using xbytechat_api.WhatsAppSettings.Models;

namespace xbytechat_api.WhatsAppSettings.Services
{
    public interface IWhatsAppSettingsService
    {
        Task SaveOrUpdateSettingAsync(SaveWhatsAppSettingDto dto);
        Task<WhatsAppSettingEntity?> GetSettingsByBusinessIdAsync(Guid businessId);
        Task<bool> DeleteSettingsAsync(Guid businessId);
        Task<string> TestConnectionAsync(SaveWhatsAppSettingDto dto);
        Task<string?> GetSenderNumberAsync(Guid businessId);
    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Services/IWhatsAppTemplateFetcherService.cs  (sha256:b5885cf1f231339958b3654b05bafa3aceb5fcb78d7f4e8c650d39c3fa21973f)
`$lang
using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using xbytechat.api.WhatsAppSettings.DTOs;

namespace xbytechat_api.WhatsAppSettings.Services
{
    public interface IWhatsAppTemplateFetcherService
    {
        Task<List<TemplateMetadataDto>> FetchTemplatesAsync(Guid businessId);
        // 🔹 (NEW) Load all templates across all businesses (admin/debug mode)
        Task<List<TemplateForUIResponseDto>> FetchAllTemplatesAsync();

        Task<TemplateMetadataDto?> GetTemplateByNameAsync(Guid businessId, string templateName, bool includeButtons);


    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Services/WhatsAppSettingsService.cs  (sha256:ae214f0b9c67e280aded7d9d70930b9bc4e77e40cf9de8e5944787f072a23d74)
`$lang
using System;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using xbytechat.api;
using xbytechat_api.WhatsAppSettings.DTOs;
using xbytechat_api.WhatsAppSettings.Models;

namespace xbytechat_api.WhatsAppSettings.Services
{
    public class WhatsAppSettingsService : IWhatsAppSettingsService
    {
        private readonly AppDbContext _dbContext;

        public WhatsAppSettingsService(AppDbContext dbContext)
        {
            _dbContext = dbContext;
        }

        public async Task SaveOrUpdateSettingAsync(SaveWhatsAppSettingDto dto)
        {
            if (dto.BusinessId == Guid.Empty)
                throw new ArgumentException("Invalid BusinessId provided.");

            var existingSetting = await _dbContext.WhatsAppSettings
                .FirstOrDefaultAsync(x => x.BusinessId == dto.BusinessId);

            if (existingSetting != null)
            {
                // 🔁 Update existing record with null-safety
                existingSetting.ApiUrl = dto.ApiUrl?.Trim() ?? existingSetting.ApiUrl;
                existingSetting.ApiToken = dto.ApiToken?.Trim() ?? existingSetting.ApiToken;

                if (!string.IsNullOrWhiteSpace(dto.PhoneNumberId))
                    existingSetting.PhoneNumberId = dto.PhoneNumberId.Trim();

                if (!string.IsNullOrWhiteSpace(dto.WhatsAppBusinessNumber))
                    existingSetting.WhatsAppBusinessNumber = dto.WhatsAppBusinessNumber.Trim();

                if (!string.IsNullOrWhiteSpace(dto.SenderDisplayName))
                    existingSetting.SenderDisplayName = dto.SenderDisplayName.Trim();

                if (!string.IsNullOrWhiteSpace(dto.WabaId))
                    existingSetting.WabaId = dto.WabaId.Trim();

                existingSetting.IsActive = dto.IsActive;
                existingSetting.UpdatedAt = DateTime.UtcNow;
            }
            else
            {
                // ➕ Insert new record
                var newSetting = new WhatsAppSettingEntity
                {
                    Id = Guid.NewGuid(),
                    BusinessId = dto.BusinessId,
                    ApiUrl = dto.ApiUrl.Trim(),
                    ApiToken = dto.ApiToken.Trim(),
                    PhoneNumberId = dto.PhoneNumberId?.Trim(),
                    WhatsAppBusinessNumber = dto.WhatsAppBusinessNumber?.Trim(),
                    SenderDisplayName = dto.SenderDisplayName?.Trim(),
                    WabaId = dto.WabaId?.Trim(),
                    IsActive = dto.IsActive,
                    CreatedAt = DateTime.UtcNow
                };

                await _dbContext.WhatsAppSettings.AddAsync(newSetting);
            }

            try
            {
                await _dbContext.SaveChangesAsync();
            }
            catch (Exception ex)
            {
                throw new Exception("Error saving WhatsApp settings: " + ex.InnerException?.Message ?? ex.Message);
            }
        }

        public async Task<WhatsAppSettingEntity?> GetSettingsByBusinessIdAsync(Guid businessId)
        {
            // 🔎 Find active WhatsApp setting for the business
            return await _dbContext.WhatsAppSettings
                .FirstOrDefaultAsync(x => x.BusinessId == businessId && x.IsActive);
        }

        public async Task<bool> DeleteSettingsAsync(Guid businessId)
        {
            // 🗑 Delete settings based on businessId
            var setting = await _dbContext.WhatsAppSettings
                .FirstOrDefaultAsync(x => x.BusinessId == businessId);

            if (setting == null)
                return false;

            _dbContext.WhatsAppSettings.Remove(setting);
            await _dbContext.SaveChangesAsync();
            return true;
        }

        //public async Task<string> TestConnectionAsync(SaveWhatsAppSettingDto dto)
        //{
        //    using var client = new HttpClient();
        //    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", dto.ApiToken);

        //    var baseUrl = dto.ApiUrl.TrimEnd('/');
        //    var testUrl = $"{baseUrl}/me"; // 📡 Lightweight endpoint for connection test

        //    var response = await client.GetAsync(testUrl);
        //    var content = await response.Content.ReadAsStringAsync();

        //    if (!response.IsSuccessStatusCode)
        //        throw new Exception($"❌ WhatsApp API Error: {content}");

        //    return "WhatsApp API token is valid and connection was successful.";
        //}
        public async Task<string> TestConnectionAsync(SaveWhatsAppSettingDto dto)
        {
            using var client = new HttpClient();
            client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", dto.ApiToken);

            var baseUrl = dto.ApiUrl.TrimEnd('/');
            if (string.IsNullOrWhiteSpace(dto.PhoneNumberId))
                throw new Exception("PhoneNumberId is required to test WhatsApp Cloud API connection.");

            // This is the official endpoint for checking the number
            var testUrl = $"{baseUrl}/{dto.PhoneNumberId}";

            var response = await client.GetAsync(testUrl);
            var content = await response.Content.ReadAsStringAsync();

            if (!response.IsSuccessStatusCode)
                throw new Exception($"❌ WhatsApp API Error: {content}");

            return "WhatsApp API token is valid and connection was successful.";
        }

        public async Task<string?> GetSenderNumberAsync(Guid businessId)
        {
            var setting = await _dbContext.WhatsAppSettings
                .AsNoTracking()
                .FirstOrDefaultAsync(x => x.BusinessId == businessId && x.IsActive);

            if (setting == null)
            {
                throw new Exception($"❌ WhatsApp settings not found for BusinessId: {businessId}");
            }

            return setting.WhatsAppBusinessNumber;
        }

    }
}

``n
--- file: xbytechat-api/WhatsAppSettings/Services/WhatsAppTemplateFetcherService.cs  (sha256:c2ae93048c8cd03b7e28e4d0360bd8c2bf24bdfd80d3353ad8c2352244f38188)
`$lang
using Microsoft.EntityFrameworkCore;
using Newtonsoft.Json;
using System.Net.Http.Headers;
using System.Text.RegularExpressions;
using xbytechat.api;
using xbytechat.api.WhatsAppSettings.DTOs;

namespace xbytechat_api.WhatsAppSettings.Services
{

    public class WhatsAppTemplateFetcherService : IWhatsAppTemplateFetcherService
    {
        private readonly AppDbContext _dbContext;
        private readonly HttpClient _httpClient;
        private readonly ILogger<WhatsAppTemplateFetcherService> _logger;

        public WhatsAppTemplateFetcherService(AppDbContext dbContext, HttpClient httpClient, ILogger<WhatsAppTemplateFetcherService> logger)
        {
            _dbContext = dbContext;
            _httpClient = httpClient;
            _logger = logger;
        }

        //public async Task<List<TemplateMetadataDto>> FetchTemplatesAsync(Guid businessId)
        //{
        //    var templates = new List<TemplateMetadataDto>();

        //    var setting = await _dbContext.WhatsAppSettings
        //        .FirstOrDefaultAsync(x => x.BusinessId == businessId && x.IsActive);

        //    if (setting == null)
        //    {
        //        _logger.LogWarning("WhatsApp Settings not found for BusinessId: {BusinessId}", businessId);
        //        return templates;
        //    }

        //    if (string.IsNullOrWhiteSpace(setting.ApiToken) || string.IsNullOrWhiteSpace(setting.PhoneNumberId))
        //    {
        //        _logger.LogWarning("Missing API Token or WABA ID for BusinessId: {BusinessId}", businessId);
        //        return templates;
        //    }

        //    try
        //    {
        //        var baseUrl = setting.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0";
        //        var url = $"{baseUrl}/{setting.WabaId}/message_templates";

        //        _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", setting.ApiToken);

        //        var response = await _httpClient.GetAsync(url);
        //        var json = await response.Content.ReadAsStringAsync();
        //        _logger.LogInformation("🧪 Meta Template API Raw JSON for {BusinessId}:\n{Json}", setting.BusinessId, json);



        //        if (!response.IsSuccessStatusCode)
        //        {
        //            _logger.LogError("Failed to fetch templates from Meta: {Response}", json);
        //            return templates;
        //        }

        //        var parsed = JsonConvert.DeserializeObject<dynamic>(json);

        //        foreach (var tpl in parsed.data)
        //        {
        //            string name = tpl.name;
        //            string language = tpl.language ?? "en_US";
        //            string body = "";

        //            foreach (var component in tpl.components)
        //            {
        //                if (component.type == "BODY")
        //                {
        //                    body = component.text;
        //                    break;
        //                }
        //            }

        //            int placeholderCount = System.Text.RegularExpressions.Regex.Matches(body, "{{(.*?)}}").Count;

        //            templates.Add(new TemplateMetadataDto
        //            {
        //                Name = name,
        //                Language = language,
        //                Body = body,
        //                PlaceholderCount = placeholderCount
        //            });
        //        }
        //    }
        //    catch (Exception ex)
        //    {
        //        _logger.LogError(ex, "Exception while fetching WhatsApp templates.");
        //    }

        //    return templates;
        //}
        public async Task<List<TemplateMetadataDto>> FetchTemplatesAsync(Guid businessId)
        {
            var templates = new List<TemplateMetadataDto>();

            var setting = await _dbContext.WhatsAppSettings
                .FirstOrDefaultAsync(x => x.BusinessId == businessId && x.IsActive);

            if (setting == null)
            {
                _logger.LogWarning("WhatsApp Settings not found for BusinessId: {BusinessId}", businessId);
                return templates;
            }

            if (string.IsNullOrWhiteSpace(setting.ApiToken) || string.IsNullOrWhiteSpace(setting.PhoneNumberId))
            {
                _logger.LogWarning("Missing API Token or WABA ID for BusinessId: {BusinessId}", businessId);
                return templates;
            }

            try
            {
                var baseUrl = setting.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0";
                var url = $"{baseUrl}/{setting.WabaId}/message_templates";

                _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", setting.ApiToken);

                var response = await _httpClient.GetAsync(url);
                var json = await response.Content.ReadAsStringAsync();
                _logger.LogInformation("🧪 Meta Template API Raw JSON for {BusinessId}:\n{Json}", setting.BusinessId, json);

                if (!response.IsSuccessStatusCode)
                {
                    _logger.LogError("Failed to fetch templates from Meta: {Response}", json);
                    return templates;
                }

                var parsed = JsonConvert.DeserializeObject<dynamic>(json);

                foreach (var tpl in parsed.data)
                {
                    string name = tpl.name;
                    string language = tpl.language ?? "en_US";
                    string body = "";
                    var buttons = new List<ButtonMetadataDto>();
                    bool hasImageHeader = false;

                    foreach (var component in tpl.components)
                    {
                        string type = component.type?.ToString()?.ToUpper();

                        if (type == "BODY")
                        {
                            body = component.text?.ToString() ?? "";
                        }

                        if (type == "HEADER")
                        {
                            string format = component.format?.ToString()?.ToUpper();
                            if (format == "IMAGE") hasImageHeader = true;
                        }

                        if (type == "BUTTONS")
                        {
                            foreach (var button in component.buttons)
                            {
                                try
                                {
                                    string btnType = button.type?.ToString()?.ToUpper() ?? "";
                                    string text = button.text?.ToString() ?? "";
                                    int index = buttons.Count;

                                    string subType = btnType switch
                                    {
                                        "URL" => "url",
                                        "PHONE_NUMBER" => "voice_call",
                                        "QUICK_REPLY" => "quick_reply",
                                        "COPY_CODE" => "copy_code",
                                        "CATALOG" => "catalog",
                                        "FLOW" => "flow",
                                        "REMINDER" => "reminder",
                                        "ORDER_DETAILS" => "order_details",
                                        _ => "unknown"
                                    };

                                    string? paramValue = null;
                                    if (button.url != null)
                                        paramValue = button.url.ToString();
                                    else if (button.phone_number != null)
                                        paramValue = button.phone_number.ToString();
                                    else if (button.coupon_code != null)
                                        paramValue = button.coupon_code.ToString();
                                    else if (button.flow_id != null)
                                        paramValue = button.flow_id.ToString();

                                    bool hasExample = button.example != null;
                                    bool isDynamic = hasExample && Regex.IsMatch(button.example.ToString(), @"\{\{[0-9]+\}\}");
                                    bool requiresParam = new[] { "url", "flow", "copy_code", "catalog", "reminder" }.Contains(subType);
                                    bool needsRuntimeValue = requiresParam && isDynamic;

                                    if (subType == "unknown" || (paramValue == null && needsRuntimeValue))
                                    {
                                        _logger.LogWarning("⚠️ Skipping button '{Text}' due to unknown type or missing required param.", text);
                                        continue;
                                    }

                                    buttons.Add(new ButtonMetadataDto
                                    {
                                        Text = text,
                                        Type = btnType,
                                        SubType = subType,
                                        Index = index,
                                        ParameterValue = paramValue ?? ""
                                    });
                                }
                                catch (Exception exBtn)
                                {
                                    _logger.LogWarning(exBtn, "⚠️ Failed to parse button for template {TemplateName}", name);
                                }
                            }
                        }
                    }

                    int placeholderCount = Regex.Matches(body ?? "", "{{(.*?)}}").Count;

                    templates.Add(new TemplateMetadataDto
                    {
                        Name = name,
                        Language = language,
                        Body = body,
                        PlaceholderCount = placeholderCount,
                        HasImageHeader = hasImageHeader,
                        ButtonParams = buttons
                    });
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception while fetching WhatsApp templates.");
            }

            return templates;
        }


        public async Task<List<TemplateForUIResponseDto>> FetchAllTemplatesAsync()
        {
            var allTemplates = new List<TemplateForUIResponseDto>();

            var settingsList = await _dbContext.WhatsAppSettings
                .Where(x => x.IsActive)
                .ToListAsync();

            foreach (var setting in settingsList)
            {
                if (string.IsNullOrWhiteSpace(setting.ApiToken) || string.IsNullOrWhiteSpace(setting.PhoneNumberId))
                {
                    _logger.LogWarning("⏭️ Skipping BusinessId {BusinessId} due to missing token or phone ID", setting.BusinessId);
                    continue;
                }

                try
                {
                    var baseUrl = setting.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0";
                    var url = $"{baseUrl}/{setting.WabaId}/message_templates";

                    _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", setting.ApiToken);

                    var response = await _httpClient.GetAsync(url);
                    var json = await response.Content.ReadAsStringAsync();

                    _logger.LogInformation("📦 Meta Template API Raw JSON for {BusinessId}:\n{Json}", setting.BusinessId, json);

                    if (!response.IsSuccessStatusCode)
                    {
                        _logger.LogError("❌ Failed to fetch templates for BusinessId {BusinessId}: {Response}", setting.BusinessId, json);
                        continue;
                    }

                    var parsed = JsonConvert.DeserializeObject<dynamic>(json);

                    foreach (var tpl in parsed.data)
                    {
                        string name = tpl.name;
                        string language = tpl.language ?? "en_US";
                        string body = "";
                        bool hasImageHeader = false;
                        var buttons = new List<ButtonMetadataDto>();

                        foreach (var component in tpl.components)
                        {
                            string type = component.type?.ToString()?.ToUpper();

                            if (type == "BODY")
                            {
                                try
                                {
                                    body = component.text?.ToString() ?? "";
                                }
                                catch
                                {
                                    _logger.LogWarning("⚠️ Could not read BODY component text for template: {TemplateName}", name);
                                    body = "";
                                }
                            }

                            if (type == "HEADER")
                            {
                                string format = component.format?.ToString()?.ToUpper();
                                if (format == "IMAGE")
                                {
                                    hasImageHeader = true;
                                }
                            }

                            if (type == "BUTTONS")
                            {
                                foreach (var button in component.buttons)
                                {
                                    try
                                    {
                                        string btnType = button.type?.ToString()?.ToUpper() ?? "";
                                        string text = button.text?.ToString() ?? "";
                                        int index = buttons.Count;

                                        string subType = btnType switch
                                        {
                                            "URL" => "url",
                                            "PHONE_NUMBER" => "voice_call",
                                            "QUICK_REPLY" => "quick_reply",
                                            "COPY_CODE" => "copy_code",
                                            "CATALOG" => "catalog",
                                            "FLOW" => "flow",
                                            "REMINDER" => "reminder",
                                            "ORDER_DETAILS" => "order_details",
                                            _ => "unknown"
                                        };

                                        string? paramValue = null;
                                        if (button.url != null)
                                            paramValue = button.url.ToString();
                                        else if (button.phone_number != null)
                                            paramValue = button.phone_number.ToString();
                                        else if (button.coupon_code != null)
                                            paramValue = button.coupon_code.ToString();
                                        else if (button.flow_id != null)
                                            paramValue = button.flow_id.ToString();

                                        // 🧠 Meta injects static values — no need to enforce paramValue if STATIC
                                        bool hasExample = button.example != null;
                                        bool isDynamic = hasExample && Regex.IsMatch(button.example.ToString(), @"\{\{[0-9]+\}\}");

                                        bool requiresParam = new[] { "url", "flow", "copy_code", "catalog", "reminder" }.Contains(subType);
                                        bool needsRuntimeValue = requiresParam && isDynamic;

                                        // ❌ Skip if invalid OR dynamic + missing runtime param
                                        if (subType == "unknown" || (paramValue == null && needsRuntimeValue))
                                        {
                                            _logger.LogWarning("⚠️ Skipping button '{Text}' due to unknown type or missing required param.", text);
                                            continue;
                                        }

                                        buttons.Add(new ButtonMetadataDto
                                        {
                                            Text = text,
                                            Type = btnType,
                                            SubType = subType,
                                            Index = index,
                                            ParameterValue = paramValue ?? "" // ✅ Always safe for static
                                        });
                                    }
                                    catch (Exception exBtn)
                                    {
                                        _logger.LogWarning(exBtn, "⚠️ Failed to parse button for template {TemplateName}", name);
                                    }
                                }

                            }
                        }

                        int placeholderCount = Regex.Matches(body ?? "", "{{(.*?)}}").Count;

                        allTemplates.Add(new TemplateForUIResponseDto
                        {
                            Name = name,
                            Language = language,
                            Body = body,
                            ParametersCount = placeholderCount,
                            HasImageHeader = hasImageHeader,
                            ButtonParams = buttons
                        });
                    }
                }
                catch (Exception ex)
                {
                    _logger.LogError(ex, "❌ Exception while fetching templates for BusinessId {BusinessId}", setting.BusinessId);
                }
            }

            return allTemplates;
        }


        public async Task<TemplateMetadataDto?> GetTemplateByNameAsync(Guid businessId, string templateName, bool includeButtons)
        {
            var setting = await _dbContext.WhatsAppSettings
                .FirstOrDefaultAsync(x => x.IsActive && x.BusinessId == businessId);

            if (setting == null ||
                string.IsNullOrWhiteSpace(setting.ApiToken) ||
                string.IsNullOrWhiteSpace(setting.PhoneNumberId))
            {
                _logger.LogWarning("❌ Missing WhatsApp config for business: {BusinessId}", businessId);
                return null;
            }

            try
            {
                var baseUrl = setting.ApiUrl?.TrimEnd('/') ?? "https://graph.facebook.com/v18.0";
                var url = $"{baseUrl}/{setting.WabaId}/message_templates";

                _httpClient.DefaultRequestHeaders.Authorization =
                    new AuthenticationHeaderValue("Bearer", setting.ApiToken);

                var response = await _httpClient.GetAsync(url);
                var json = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                {
                    _logger.LogError("❌ Failed to fetch templates for BusinessId {BusinessId}: {Json}", businessId, json);
                    return null;
                }

                var parsed = JsonConvert.DeserializeObject<dynamic>(json);

                foreach (var tpl in parsed.data)
                {
                    string name = tpl.name;
                    if (!name.Equals(templateName, StringComparison.OrdinalIgnoreCase))
                        continue;

                    string language = tpl.language ?? "en_US";
                    string body = "";
                    var buttons = new List<ButtonMetadataDto>();
                    bool hasImageHeader = false;

                    foreach (var component in tpl.components)
                    {
                        string type = component.type?.ToString()?.ToUpper();

                        if (type == "BODY")
                        {
                            try
                            {
                                body = component.text?.ToString() ?? "";
                            }
                            catch
                            {
                                body = "";
                            }
                        }

                        if (type == "HEADER")
                        {
                            string format = component.format?.ToString()?.ToUpper();
                            if (format == "IMAGE") hasImageHeader = true;
                        }

                        if (includeButtons && type == "BUTTONS")
                        {
                            foreach (var button in component.buttons)
                            {
                                try
                                {
                                    string btnType = button.type?.ToString()?.ToUpper() ?? "";
                                    string text = button.text?.ToString() ?? "";
                                    int index = buttons.Count;

                                    string subType = btnType switch
                                    {
                                        "URL" => "url",
                                        "PHONE_NUMBER" => "voice_call",
                                        "QUICK_REPLY" => "quick_reply",
                                        "COPY_CODE" => "copy_code",
                                        "CATALOG" => "catalog",
                                        "FLOW" => "flow",
                                        "REMINDER" => "reminder",
                                        "ORDER_DETAILS" => "order_details",
                                        _ => "unknown"
                                    };

                                    // ✅ Extract known dynamic values
                                    string? paramValue = null;
                                    if (button.url != null)
                                        paramValue = button.url.ToString();
                                    else if (button.phone_number != null)
                                        paramValue = button.phone_number.ToString();
                                    else if (button.coupon_code != null)
                                        paramValue = button.coupon_code.ToString();
                                    else if (button.flow_id != null)
                                        paramValue = button.flow_id.ToString();

                                    // ✅ Skip truly invalid (unknown + missing value for dynamic)
                                    if (subType == "unknown" || (paramValue == null && new[] { "url", "flow", "copy_code" }.Contains(subType)))

                                    {
                                        _logger.LogWarning("⚠️ Skipping button '{Text}' due to unknown type or missing required param.", text);
                                        continue;
                                    }

                                    buttons.Add(new ButtonMetadataDto
                                    {
                                        Text = text,
                                        Type = btnType,
                                        SubType = subType,
                                        Index = index,
                                        ParameterValue = paramValue ?? "" // ✅ Default to empty for static buttons
                                    });
                                }
                                catch (Exception exBtn)
                                {
                                    _logger.LogWarning(exBtn, "⚠️ Failed to parse button in template {TemplateName}", name);
                                }
                            }
                        }
                    }

                    int paramCount = Regex.Matches(body ?? "", "{{(.*?)}}").Count;

                    return new TemplateMetadataDto
                    {
                        Name = name,
                        Language = language,
                        Body = body,
                        PlaceholderCount = paramCount,
                        HasImageHeader = hasImageHeader,
                        ButtonParams = includeButtons ? buttons : new List<ButtonMetadataDto>()
                    };
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "❌ Exception in GetTemplateByNameAsync");
            }

            return null;
        }

    }
}


``n
--- file: xbytechat-api/WhatsAppSettings/Validators/SaveWhatsAppSettingValidator.cs  (sha256:0514de8678bd403897fb43017b8857bf209000360de191805c741c17965c1112)
`$lang
using FluentValidation;
using xbytechat_api.WhatsAppSettings.DTOs;

namespace xbytechat_api.WhatsAppSettings.Validators
{
    public class SaveWhatsAppSettingValidator : AbstractValidator<SaveWhatsAppSettingDto> // ✅ Inherit properly
    {
        public SaveWhatsAppSettingValidator()
        {
            RuleFor(x => x.BusinessId)
                .NotEmpty().WithMessage("BusinessId is required.");

            RuleFor(x => x.ApiUrl)
                .NotEmpty().WithMessage("API URL is required.")
                .MaximumLength(500).WithMessage("API URL must not exceed 500 characters.");

            RuleFor(x => x.ApiToken)
                .NotEmpty().WithMessage("API Token is required.")
                .MaximumLength(1000).WithMessage("API Token must not exceed 1000 characters.");

            RuleFor(x => x.WhatsAppBusinessNumber)
                .NotEmpty().WithMessage("WhatsApp Business Number is required.")
                .MaximumLength(20).WithMessage("WhatsApp Business Number must not exceed 20 characters.");

            RuleFor(x => x.SenderDisplayName)
                .MaximumLength(100).WithMessage("Sender Display Name must not exceed 100 characters.")
                .When(x => !string.IsNullOrEmpty(x.SenderDisplayName));
        }
    }
}

``n
--- file: xbytechat-api/xbytechat-api/Helpers/AuditLoggingHelper.cs  (sha256:c5b311d19b5c69b6b78d7ca335b984e43795ef1e140c2239dea1ed7190e188c6)
`$lang
using xbytechat.api.Features.AuditTrail.Models;
using xbytechat.api.Features.AuditTrail.Services;

public static class AuditLoggingHelper
{
    private static IServiceProvider? _serviceProvider;

    public static void Configure(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }

    public static void Log(
        string actionType,
        string? entityName,
        string? entityId,
        string? description,
        IHttpContextAccessor contextAccessor)
    {
        if (_serviceProvider == null) return;

        var scope = _serviceProvider.CreateScope();
        var auditLogService = scope.ServiceProvider.GetRequiredService<IAuditLogService>();

        var httpContext = contextAccessor.HttpContext;
        var user = httpContext?.User;
        var claims = user?.Identities?.FirstOrDefault();

        var log = new AuditLog
        {
            Id = Guid.NewGuid(),
            ActionType = actionType,
            Description = description,
            BusinessId = TryParseGuid(claims?.FindFirst("businessId")?.Value),
            PerformedByUserId = TryParseGuid(claims?.FindFirst("sub")?.Value),
            PerformedByUserName = claims?.FindFirst("email")?.Value,
            RoleAtTime = claims?.FindFirst("role")?.Value,
            IPAddress = httpContext?.Connection?.RemoteIpAddress?.ToString(),
            UserAgent = httpContext?.Request?.Headers["User-Agent"].ToString(),
            CreatedAt = DateTime.UtcNow
        };

        _ = Task.Run(() => auditLogService.SaveLogAsync(log));
    }

    private static Guid TryParseGuid(string? input) =>
        Guid.TryParse(input, out var guid) ? guid : Guid.Empty;
}

``n
--- file: xbytechat-api/xbytechat-api/Helpers/JwtCookieHelper.cs  (sha256:50ed48ffead96168a429fe26398cbc9b3021ecfebafabcbba8dc8e59f9a12885)
`$lang
// 📄 File: Helpers/JwtCookieHelper.cs
using Microsoft.AspNetCore.Http;
using System;

namespace xbytechat.api.Helpers
{
    public static class JwtCookieHelper
    {
        // ✅ Set Access Token (short-lived)
        public static void SetJwtCookie(HttpContext httpContext, string cookieName, string token, int expiryHours = 12)
        {
            if (httpContext == null || httpContext.Response.HasStarted)
            {
                Console.WriteLine($"⚠️ Cannot set JWT cookie '{cookieName}' — response already started.");
                return;
            }

            bool isProduction = Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") == "Production";

            httpContext.Response.Cookies.Append(cookieName, token, new CookieOptions
            {
                HttpOnly = true,
                ///*Secure*/ = isProduction,
                Secure = true,
                SameSite = SameSiteMode.Strict,
                Expires = DateTimeOffset.UtcNow.AddHours(expiryHours)
            }); ;
        }

        // ✅ Clear Access Token cookie
        public static void ClearJwtCookie(HttpContext httpContext, string cookieName)
        {
            if (httpContext == null || httpContext.Response.HasStarted)
            {
                Console.WriteLine($"⚠️ Cannot clear JWT cookie '{cookieName}' — response already started.");
                return;
            }

            httpContext.Response.Cookies.Append(cookieName, "", new CookieOptions
            {
                HttpOnly = true,
                Secure = true,
                SameSite = SameSiteMode.Strict,
                Expires = DateTimeOffset.UtcNow.AddDays(-1)
            });
        }

        // ✅ Set Refresh Token (long-lived)
        public static void SetRefreshTokenCookie(HttpContext httpContext, string cookieName, string refreshToken, int expiryDays = 30)
        {
            if (httpContext == null || httpContext.Response.HasStarted)
            {
                Console.WriteLine($"⚠️ Cannot set refresh cookie '{cookieName}' — response already started.");
                return;
            }

            bool isProduction = Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") == "Production";

            httpContext.Response.Cookies.Append(cookieName, refreshToken, new CookieOptions
            {
                HttpOnly = true,
                Secure = isProduction,
                SameSite = SameSiteMode.Strict,
                Expires = DateTimeOffset.UtcNow.AddDays(expiryDays)
            });
        }

        // ✅ Clear Refresh Token cookie
        public static void ClearRefreshTokenCookie(HttpContext httpContext, string cookieName)
        {
            if (httpContext == null || httpContext.Response.HasStarted)
            {
                Console.WriteLine($"⚠️ Cannot clear refresh cookie '{cookieName}' — response already started.");
                return;
            }

            httpContext.Response.Cookies.Append(cookieName, "", new CookieOptions
            {
                HttpOnly = true,
                Secure = true,
                SameSite = SameSiteMode.Strict,
                Expires = DateTimeOffset.UtcNow.AddDays(-1)
            });
        }
    }
}

``n
--- file: xbytechat-api/xbytechat-api/Helpers/ResponseResult.cs  (sha256:e179ac827eca18c7316cf0dff9d2d9741653f9bde358cbda401ff1e978cd30ec)
`$lang
namespace xbytechat.api.Helpers
{
    /// <summary>
    /// Represents a standardized response structure for service layer results.
    /// </summary>
    public class ResponseResult
    {
        public bool Success { get; set; }                  // ✅ Whether operation succeeded
        public string Message { get; set; }                // ✅ User-friendly message
        public object? Data { get; set; }                  // Optional payload (if needed)

        // ✅ WhatsApp-specific diagnostics
        public string? ErrorMessage { get; set; }          // Error from API or exception
        public string? RawResponse { get; set; }           // Full API raw response

        public string? MessageId { get; set; } // 🌐 WhatsApp WAMID (Message ID)

        public Guid? LogId { get; set; } // ✅ Unique ID of MessageLog for tracking
                                         // ✅ Factory method for successful result

        public string? Token { get; set; }

        public string? RefreshToken { get; set; }
        public static ResponseResult SuccessInfo(string message, object? data = null, string? raw = null)
        {
            return new ResponseResult
            {
                Success = true,
                Message = message,
                Data = data,
                RawResponse = raw
            };
        }

        // ❌ Factory method for error result
        public static ResponseResult ErrorInfo(string message, string? error = null, string? raw = null)
        {
            return new ResponseResult
            {
                Success = false,
                Message = message,
                ErrorMessage = error,
                RawResponse = raw
            };
        }
    }
}

``n
--- file: xbytechat-api/xbytechat-api/Helpers/SendResultExtended.cs  (sha256:d70ced23d36d879eb80982f4a2508398175f5a06bc3e524c5c426cfe59635a0a)
`$lang
using xbytechat.api.Helpers;

public class SendResultExtended : ResponseResult
{
   // public string? MessageId { get; set; }         // WAMID from WhatsApp
    public Guid? MessageLogId { get; set; }        // Our DB log ID (from MessageLogs table)
}

``n
--- file: xbytechat-api/xbytechat-api/Helpers/UserContextHelper.cs  (sha256:ebabfd85a8a344a40535bccbbdb67a5241b585ecca9f9688e3eb6201b71fda0d)
`$lang
using System.Security.Claims;

namespace xbytechat.api.Helpers
{
    public static class UserContextHelper
    {
        /// <summary>
        /// Returns the logged-in user's unique ID from JWT.
        /// </summary>
        public static Guid GetUserId(ClaimsPrincipal user)
        {
            return Guid.TryParse(user.FindFirst("sub")?.Value, out var id) ? id : Guid.Empty;
        }

        /// <summary>
        /// Returns the business ID (tenant) from JWT claims.
        /// </summary>
        public static Guid GetBusinessId(ClaimsPrincipal user)
        {
            return Guid.TryParse(user.FindFirst("businessId")?.Value, out var id) ? id : Guid.Empty;
        }

        /// <summary>
        /// Returns the role of the logged-in user.
        /// </summary>
        public static string GetRole(ClaimsPrincipal user)
        {
            return user.FindFirst("role")?.Value ?? "";
        }

        /// <summary>
        /// Returns company name for UI display (optional).
        /// </summary>
        public static string GetCompanyName(ClaimsPrincipal user)
        {
            return user.FindFirst("companyName")?.Value ?? "";
        }

        /// <summary>
        /// Returns plan info if needed for plan-based access control.
        /// </summary>
        public static string GetPlan(ClaimsPrincipal user)
        {
            return user.FindFirst("plan")?.Value ?? "";
        }
    }
}

``n
