2025-07-14 10:15:30.331 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-14 10:15:30.367 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-14 10:15:30.402 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-14 10:15:32.502 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-14 10:15:33.036 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-14 10:15:33.335 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-14 10:15:33.336 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-14 10:15:33.337 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-14 10:15:33.338 +05:30 [INF] Hosting environment: Development
2025-07-14 10:15:33.339 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-14 10:15:33.967 +05:30 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-14 10:15:34.012 +05:30 [INF] Executed DbCommand (79ms) [Parameters=[@__cutoff_0='2025-07-07T04:45:31.9098078Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-14 10:15:34.015 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger - null null
2025-07-14 10:15:34.166 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger - 301 0 null 164.4235ms
2025-07-14 10:15:34.170 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-14 10:15:34.226 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 55.5349ms
2025-07-14 10:15:34.240 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - null null
2025-07-14 10:15:34.243 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - null null
2025-07-14 10:15:34.243 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-14 10:15:34.243 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - null null
2025-07-14 10:15:34.259 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 16.5986ms
2025-07-14 10:15:34.305 +05:30 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-14 10:15:34.305 +05:30 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-14 10:15:34.309 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - 200 152034 text/css 69.2518ms
2025-07-14 10:15:34.309 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 66.3039ms
2025-07-14 10:15:34.322 +05:30 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-14 10:15:34.324 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 81.4206ms
2025-07-14 10:15:34.338 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-14 10:15:34.398 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 60.0375ms
2025-07-14 10:15:34.613 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-14 10:15:34.705 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/favicon-32x32.png - null null
2025-07-14 10:15:34.709 +05:30 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-07-14 10:15:34.711 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/favicon-32x32.png - 200 628 image/png 6.1287ms
2025-07-14 10:15:34.853 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 240.2477ms
2025-07-14 10:18:55.370 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 10:18:55.382 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-14 10:18:55.440 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-14 10:18:55.444 +05:30 [INF] AuthenticationScheme: Bearer was challenged.
2025-07-14 10:18:55.446 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 0 null 76.0253ms
2025-07-14 10:19:01.441 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-14 10:19:01.456 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:19:01.459 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 17.9143ms
2025-07-14 10:19:01.462 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-14 10:19:01.468 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:19:01.475 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 10:19:01.510 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 10:19:01.632 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-14 10:19:01.751 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-14 10:19:01.898 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-14 10:19:02.024 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-14 10:19:02.054 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-14 10:19:02.169 +05:30 [INF] Executed DbCommand (66ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-14 10:19:02.205 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-14 10:19:02.252 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-14 10:19:02.261 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:19:02.287 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 757.1495ms
2025-07-14 10:19:02.289 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 10:19:02.296 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 833.8052ms
2025-07-14 10:19:02.618 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 10:19:02.701 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 10:19:02.706 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 10:19:02.716 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:19:02.720 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 9.5255ms
2025-07-14 10:19:02.722 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 10:19:02.724 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 105.4126ms
2025-07-14 10:19:02.863 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-14 10:19:02.869 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 10:19:02.874 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-14 10:19:02.896 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-14 10:19:02.902 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-14 10:19:02.920 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-14 10:19:02.941 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-14 10:19:02.943 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-14 10:19:02.944 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-14 10:19:02.945 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-14 10:19:02.946 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-14 10:19:02.947 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-14 10:19:02.948 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-14 10:19:02.949 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-14 10:19:02.950 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-14 10:19:02.950 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-14 10:19:02.951 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-14 10:19:02.952 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-14 10:19:02.958 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-14 10:19:02.967 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 91.6286ms
2025-07-14 10:19:02.971 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 10:19:02.972 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 109.4193ms
2025-07-14 10:19:06.926 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-14 10:19:06.933 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:19:06.939 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-14 10:19:06.952 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-14 10:19:06.991 +05:30 [INF] Executed DbCommand (9ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-14 10:19:07.016 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-14 10:19:07.025 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 60.1664ms
2025-07-14 10:19:07.027 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-14 10:19:07.029 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 102.8324ms
2025-07-14 10:22:48.035 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-14 10:22:48.075 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:22:48.077 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 41.5275ms
2025-07-14 10:22:48.085 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 470
2025-07-14 10:22:48.093 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:22:48.094 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-14 10:22:48.101 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-14 10:22:48.115 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-14 10:22:48.116 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-14 10:22:48.235 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-14 10:22:48.348 +05:30 [INF] Executed DbCommand (13ms) [Parameters=[@p4='36de2595-f729-4b07-9958-11c8a56db12f', @p0='673199269218077', @p1='2025-07-14T04:52:48.2395127Z' (Nullable = true) (DbType = DateTime), @p2='744548247936621', @p3='15551622077' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "PhoneNumberId" = @p0, "UpdatedAt" = @p1, "WabaId" = @p2, "WhatsAppBusinessNumber" = @p3
WHERE "Id" = @p4;
2025-07-14 10:22:48.363 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-14 10:22:48.365 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:22:48.368 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 264.8503ms
2025-07-14 10:22:48.370 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-14 10:22:48.372 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 289.9056ms
2025-07-14 10:22:50.077 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-14 10:22:50.081 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:22:50.083 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 5.9436ms
2025-07-14 10:22:50.086 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 470
2025-07-14 10:22:50.093 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:22:50.095 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-14 10:22:50.102 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-14 10:22:51.316 +05:30 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType128`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:22:51.320 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1215.6434ms
2025-07-14 10:22:51.322 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-14 10:22:51.323 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 500 null application/json; charset=utf-8 1237.7782ms
2025-07-14 10:23:12.689 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-14 10:23:12.693 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:23:12.695 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 6.3099ms
2025-07-14 10:23:12.736 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 473
2025-07-14 10:23:12.740 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:23:12.743 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-14 10:23:12.746 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-14 10:23:12.749 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-14 10:23:12.750 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-14 10:23:12.761 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-14 10:23:12.788 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAUbmP4285YBPEoFtWdWhGaQqto0VC82ADcqt3zAljKo7eYw1nFyKiopqQ5lh6iLoA6QgI7noOE75pdKjuqhY79SA0TiTq49ByU7z32jSpD2LrcBZCswPFNwRCDmSZAHRXlt9dDxSGmOvZALHg5luuLl8nUAHZCq6tV3NHZAZCDYYmAwQsETc9eVmTMtvHawbUZAlZAO49mqcdm78nZBuPNjLuUX98pkERxiALJ2ULZBHkn9Tch9H9STIyoQDZC4jVtnaYZD' (Nullable = false), @p1='2025-07-14T04:53:12.7671282Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-14 10:23:12.791 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-14 10:23:12.793 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:23:12.795 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 46.6727ms
2025-07-14 10:23:12.797 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-14 10:23:12.799 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 63.4759ms
2025-07-14 10:23:13.424 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-14 10:23:13.428 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:23:13.430 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 5.6135ms
2025-07-14 10:23:13.435 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 473
2025-07-14 10:23:13.442 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:23:13.443 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-14 10:23:13.446 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-14 10:23:14.864 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:23:14.866 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1417.7108ms
2025-07-14 10:23:14.868 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-14 10:23:14.870 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1434.3631ms
2025-07-14 10:25:58.548 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-14 10:25:58.555 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-14 10:25:58.565 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:25:58.569 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:25:58.575 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-14 10:25:58.577 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-14 10:25:58.584 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-14 10:25:58.585 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-14 10:25:58.599 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-14 10:25:58.632 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-14 10:25:58.651 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 10:25:58.666 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 79.0249ms
2025-07-14 10:25:58.668 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-14 10:25:58.670 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 115.0669ms
2025-07-14 10:25:58.744 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-14 10:25:58.816 +05:30 [INF] Executed DbCommand (11ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-14 10:25:58.904 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-14 10:25:58.918 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 327.2028ms
2025-07-14 10:25:58.920 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-14 10:25:58.921 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 373.2064ms
2025-07-14 10:26:20.531 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-14 10:26:20.537 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:26:20.538 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 6.6153ms
2025-07-14 10:26:20.570 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 57
2025-07-14 10:26:20.575 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:26:20.577 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:26:20.585 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-14 10:26:22.700 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-14 10:26:22.713 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-14 10:26:22.718 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-14 10:26:22.991 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-14 10:26:23.001 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:26:23.004 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:26:24.980 +05:30 [INF] Received HTTP response headers after 1971.3389ms - 200
2025-07-14 10:26:24.982 +05:30 [INF] End processing HTTP request after 1982.7661ms - 200
2025-07-14 10:26:25.231 +05:30 [INF] Executed DbCommand (31ms) [Parameters=[@p0='c368525b-6d52-41a8-b62b-b44466710d26', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-14T04:56:25.0852224Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEI3QzVDNjhFOTlCMzg0QUZFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEI3QzVDNjhFOTlCMzg0QUZFAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEI3QzVDNjhFOTlCMzg0QUZFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hello', @p16='2025-07-14T04:56:25.0852842Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-14 10:26:25.237 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-14 10:26:25.242 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 4654.6098ms
2025-07-14 10:26:25.244 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:26:25.246 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 4675.9924ms
2025-07-14 10:50:19.405 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-14 10:50:19.410 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:50:19.411 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 9.4293ms
2025-07-14 10:50:19.416 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 57
2025-07-14 10:50:19.423 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:50:19.425 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:50:19.427 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-14 10:50:20.947 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-14 10:50:21.045 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-14 10:50:21.049 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-14 10:50:21.054 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-14 10:50:21.058 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:50:21.059 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:50:22.603 +05:30 [INF] Received HTTP response headers after 1542.3486ms - 200
2025-07-14 10:50:22.605 +05:30 [INF] End processing HTTP request after 1547.7371ms - 200
2025-07-14 10:50:22.626 +05:30 [INF] Executed DbCommand (14ms) [Parameters=[@p0='ca5d3fbc-41f1-4fa9-ae16-06fd8540176a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-14T05:20:22.6103740Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMERCMDJEOEM4OTYzNTI1MzMxAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMERCMDJEOEM4OTYzNTI1MzMxAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMERCMDJEOEM4OTYzNTI1MzMxAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hello', @p16='2025-07-14T05:20:22.6103741Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-14 10:50:22.630 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-14 10:50:22.633 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3202.9038ms
2025-07-14 10:50:22.635 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:50:22.636 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3221.2847ms
2025-07-14 10:51:53.460 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-14 10:51:53.464 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:51:53.465 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 5.8352ms
2025-07-14 10:51:53.468 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 57
2025-07-14 10:51:53.480 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:51:53.481 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:51:53.483 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-14 10:51:55.118 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-14 10:51:55.124 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-14 10:51:55.129 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-14 10:51:55.134 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:51:55.136 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:51:56.596 +05:30 [INF] Received HTTP response headers after 1458.156ms - 200
2025-07-14 10:51:56.601 +05:30 [INF] End processing HTTP request after 1466.8262ms - 200
2025-07-14 10:51:56.634 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@p0='1421300e-1a57-483f-a488-bd14e02140fc', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-14T05:21:56.6103223Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRDg1RUQ3Q0FERTRBQkNEMjU5AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRDg1RUQ3Q0FERTRBQkNEMjU5AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRDg1RUQ3Q0FERTRBQkNEMjU5AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hello', @p16='2025-07-14T05:21:56.6103225Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-14 10:51:56.637 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-14 10:51:56.639 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3151.5148ms
2025-07-14 10:51:56.640 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:51:56.642 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3174.0716ms
2025-07-14 10:52:16.111 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-14 10:52:16.120 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:52:16.122 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 11.6363ms
2025-07-14 10:52:16.124 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 57
2025-07-14 10:52:16.130 +05:30 [INF] CORS policy execution successful.
2025-07-14 10:52:16.132 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:52:16.134 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-14 10:52:17.653 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-14 10:52:17.658 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-14 10:52:17.663 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-14 10:52:17.667 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:52:17.668 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-14 10:52:19.181 +05:30 [INF] Received HTTP response headers after 1511.5928ms - 200
2025-07-14 10:52:19.184 +05:30 [INF] End processing HTTP request after 1517.701ms - 200
2025-07-14 10:52:19.191 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='aa4fa817-b895-4c1b-b701-c1eb7da3a299', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-14T05:22:19.1874288Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTREQjcyOUJDMURFQ0ExQTVCAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTREQjcyOUJDMURFQ0ExQTVCAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTREQjcyOUJDMURFQ0ExQTVCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hello', @p16='2025-07-14T05:22:19.1874290Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-14 10:52:19.194 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-14 10:52:19.196 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3058.7315ms
2025-07-14 10:52:19.198 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-14 10:52:19.199 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3075.052ms
2025-07-14 11:48:28.063 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-14 11:48:28.074 +05:30 [INF] CORS policy execution successful.
2025-07-14 11:48:28.109 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:28 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 11:48:28.246 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:28 AM'.
2025-07-14 11:48:28.248 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-14 11:48:28.258 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-14 11:48:28.277 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 11:48:28.281 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 20.9024ms
2025-07-14 11:48:28.284 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-14 11:48:28.311 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-14 11:48:28.335 +05:30 [ERR] Response has already started, unable to write error response for path: /api/Campaign/paginated
2025-07-14 11:48:28.336 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 401 null application/json 273.1081ms
2025-07-14 11:48:28.343 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-14 11:48:28.352 +05:30 [INF] CORS policy execution successful.
2025-07-14 11:48:28.354 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 11.5495ms
2025-07-14 11:48:28.356 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-14 11:48:28.362 +05:30 [INF] CORS policy execution successful.
2025-07-14 11:48:28.364 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:28 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 11:48:28.368 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:28 AM'.
2025-07-14 11:48:28.370 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 14.0087ms
2025-07-14 11:48:28.375 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-14 11:48:29.281 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 11:48:29.286 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:29 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 11:48:29.289 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:29 AM'.
2025-07-14 11:48:29.293 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-14 11:48:29.326 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-14 11:48:29.333 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-14 11:48:29.335 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 54.0304ms
2025-07-14 11:48:30.326 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 11:48:30.332 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:30 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 11:48:30.336 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:18:30 AM'.
2025-07-14 11:48:30.338 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-14 11:48:30.371 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-14 11:48:30.381 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-14 11:48:30.383 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 56.9226ms
2025-07-14 11:48:39.856 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-14 11:48:39.922 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-14 11:48:39.941 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-14 11:48:40.802 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-14 11:48:41.358 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-14 11:48:41.544 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-14 11:48:41.545 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-14 11:48:41.546 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-14 11:48:41.547 +05:30 [INF] Hosting environment: Development
2025-07-14 11:48:41.549 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-14 11:48:41.559 +05:30 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-14 11:48:41.575 +05:30 [INF] Executed DbCommand (41ms) [Parameters=[@__cutoff_0='2025-07-07T06:18:40.0810402Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-14 11:48:43.634 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-14 11:48:43.927 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 304.6928ms
2025-07-14 11:48:43.946 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-14 11:48:43.954 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.1457ms
2025-07-14 11:48:44.048 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-14 11:48:44.085 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.6304ms
2025-07-14 11:48:44.372 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-14 11:48:44.636 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 263.6651ms
2025-07-14 12:00:02.334 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-14 12:00:02.386 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-14 12:00:02.399 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-14 12:00:03.063 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-14 12:00:03.477 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-14 12:00:03.604 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-14 12:00:03.605 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-14 12:00:03.605 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-14 12:00:03.606 +05:30 [INF] Hosting environment: Development
2025-07-14 12:00:03.607 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-14 12:00:03.621 +05:30 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-14 12:00:03.636 +05:30 [INF] Executed DbCommand (29ms) [Parameters=[@__cutoff_0='2025-07-07T06:30:02.5025453Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-14 12:00:06.182 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-14 12:00:06.338 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 163.5018ms
2025-07-14 12:00:06.352 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-14 12:00:06.357 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 5.5985ms
2025-07-14 12:00:06.412 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-14 12:00:06.446 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.63ms
2025-07-14 12:00:06.561 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-14 12:00:06.740 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 179.3758ms
2025-07-14 12:00:25.263 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-14 12:00:25.267 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-14 12:00:25.269 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:25.271 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 8.1673ms
2025-07-14 12:00:25.272 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-14 12:00:25.280 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:25.387 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:25 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 12:00:25.416 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:25 AM'.
2025-07-14 12:00:25.421 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:00:25.434 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 12:00:25.500 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-14 12:00:25.566 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-14 12:00:25.655 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-14 12:00:25.729 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-14 12:00:25.746 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-14 12:00:25.822 +05:30 [INF] Executed DbCommand (43ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-14 12:00:25.843 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-14 12:00:25.941 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 501.9624ms
2025-07-14 12:00:25.943 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:00:26.001 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-14 12:00:26.011 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-14 12:00:26.015 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-14 12:00:26.015 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 742.5429ms
2025-07-14 12:00:26.017 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:26.020 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 4.7228ms
2025-07-14 12:00:26.021 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-14 12:00:26.023 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:26.025 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:26 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 12:00:26.027 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:26 AM'.
2025-07-14 12:00:26.028 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 7.0025ms
2025-07-14 12:00:26.030 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-14 12:00:26.670 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 12:00:26.676 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:26 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-14 12:00:26.679 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '14-07-2025 05:49:02 AM', Current time (UTC): '14-07-2025 06:30:26 AM'.
2025-07-14 12:00:26.684 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-14 12:00:26.717 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-14 12:00:26.720 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-14 12:00:26.721 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 50.863ms
2025-07-14 12:00:56.620 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-14 12:00:56.623 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:56.623 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.0201ms
2025-07-14 12:00:56.624 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-14 12:00:56.628 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:00:56.629 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:00:56.630 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 12:00:56.634 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-14 12:00:56.640 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-14 12:00:56.645 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-14 12:00:56.649 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-14 12:00:56.653 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-14 12:00:56.656 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-14 12:00:56.658 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-14 12:00:56.660 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-14 12:00:56.665 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 12:00:56.680 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 48.6888ms
2025-07-14 12:00:56.681 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:00:56.682 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 57.8686ms
2025-07-14 12:00:56.993 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 12:00:57.003 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 12:00:57.005 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 12:00:57.013 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 12:00:57.016 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 9.1723ms
2025-07-14 12:00:57.017 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 12:00:57.017 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 24.2013ms
2025-07-14 12:00:57.258 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-14 12:00:57.262 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 12:00:57.265 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-14 12:00:57.277 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-14 12:00:57.280 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-14 12:00:57.287 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-14 12:00:57.302 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-14 12:00:57.302 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-14 12:00:57.303 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-14 12:00:57.303 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-14 12:00:57.304 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-14 12:00:57.304 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-14 12:00:57.305 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-14 12:00:57.305 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-14 12:00:57.306 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-14 12:00:57.306 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-14 12:00:57.307 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-14 12:00:57.307 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-14 12:00:57.312 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-14 12:00:57.317 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 50.6246ms
2025-07-14 12:00:57.318 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 12:00:57.319 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 61.0184ms
2025-07-14 12:01:03.870 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-14 12:01:03.873 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:01:03.874 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 4.1073ms
2025-07-14 12:01:03.875 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-14 12:01:03.878 +05:30 [INF] CORS policy execution successful.
2025-07-14 12:01:03.879 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:01:03.880 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 12:01:03.882 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-14 12:01:03.885 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-14 12:01:03.890 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-14 12:01:03.893 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-14 12:01:03.896 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-14 12:01:03.899 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-14 12:01:03.905 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-14 12:01:03.906 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-14 12:01:03.907 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 12:01:03.908 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 26.912ms
2025-07-14 12:01:03.909 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-14 12:01:03.910 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 35.4135ms
2025-07-14 12:01:03.916 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-14 12:01:03.918 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 12:01:03.919 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-14 12:01:03.922 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-14 12:01:03.923 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.8918ms
2025-07-14 12:01:03.924 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-14 12:01:03.924 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.3673ms
2025-07-14 12:01:04.239 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-14 12:01:04.242 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 12:01:04.242 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-14 12:01:04.246 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-14 12:01:04.248 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-14 12:01:04.250 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-14 12:01:04.252 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-14 12:01:04.253 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-14 12:01:04.253 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-14 12:01:04.254 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-14 12:01:04.254 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-14 12:01:04.255 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-14 12:01:04.255 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-14 12:01:04.256 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-14 12:01:04.256 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-14 12:01:04.257 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-14 12:01:04.257 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-14 12:01:04.258 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-14 12:01:04.259 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-14 12:01:04.260 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 16.4233ms
2025-07-14 12:01:04.261 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-14 12:01:04.262 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 23.2528ms
