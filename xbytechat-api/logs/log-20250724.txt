2025-07-24 08:37:45.324 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=517626051&hub.verify_token=my-secret-token - null null
2025-07-24 08:37:45.341 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=517626051&hub.verify_token=my-secret-token - 404 0 null 21.683ms
2025-07-24 08:37:45.353 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://176d1ea7bbd4.ngrok-free.app/api/webhook, Response status code: 404
2025-07-24 08:38:34.020 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1050874623&hub.verify_token=my-secret-token - null null
2025-07-24 08:38:34.041 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1050874623&hub.verify_token=my-secret-token - 404 0 null 21.7483ms
2025-07-24 08:38:34.047 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://176d1ea7bbd4.ngrok-free.app/api/webhook, Response status code: 404
2025-07-24 08:38:55.680 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-24 08:38:55.744 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-24 08:38:55.767 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-24 08:38:56.679 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-24 08:38:57.306 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-24 08:38:57.468 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-24 08:38:57.469 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-24 08:38:57.471 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-24 08:38:57.471 +05:30 [INF] Hosting environment: Development
2025-07-24 08:38:57.472 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-24 08:38:57.502 +05:30 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-24 08:38:57.521 +05:30 [INF] Executed DbCommand (34ms) [Parameters=[@__cutoff_0='2025-07-17T03:08:55.9025516Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-24 08:39:02.771 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger - null null
2025-07-24 08:39:02.956 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger - 301 0 null 197.2052ms
2025-07-24 08:39:02.963 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-24 08:39:03.049 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 86.1211ms
2025-07-24 08:39:03.075 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - null null
2025-07-24 08:39:03.079 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - null null
2025-07-24 08:39:03.081 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - null null
2025-07-24 08:39:03.081 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-24 08:39:03.105 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 23.3022ms
2025-07-24 08:39:03.145 +05:30 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-24 08:39:03.145 +05:30 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-24 08:39:03.145 +05:30 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-24 08:39:03.150 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 69.7472ms
2025-07-24 08:39:03.151 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - 200 152034 text/css 75.9821ms
2025-07-24 08:39:03.153 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 73.7194ms
2025-07-24 08:39:03.181 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-24 08:39:03.235 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 54.0131ms
2025-07-24 08:39:03.549 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-24 08:39:03.837 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 288.8579ms
2025-07-24 08:39:24.513 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1887402786&hub.verify_token=my-secret-token - null null
2025-07-24 08:39:24.527 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-24 08:39:24.614 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1887402786&hub.verify_token=my-secret-token - 404 0 null 101.0542ms
2025-07-24 08:39:24.622 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://176d1ea7bbd4.ngrok-free.app/api/webhook, Response status code: 404
2025-07-24 08:40:04.816 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1665450439&hub.verify_token=my-secret-token - null null
2025-07-24 08:40:04.833 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhook?hub.mode=subscribe&hub.challenge=1665450439&hub.verify_token=my-secret-token - 404 0 null 17.4454ms
2025-07-24 08:40:04.847 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://176d1ea7bbd4.ngrok-free.app/api/webhook, Response status code: 404
2025-07-24 08:40:59.019 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1434200609&hub.verify_token=my-secret-token - null null
2025-07-24 08:40:59.029 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:40:59.055 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-24 08:40:59.085 +05:30 [WRN] ❌ WhatsApp webhook verification failed.
2025-07-24 08:40:59.089 +05:30 [INF] Executing ForbidResult with authentication schemes (["Token mismatch."]).
2025-07-24 08:40:59.125 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 62.0254ms
2025-07-24 08:40:59.130 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:40:59.189 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: No authentication handler is registered for the scheme 'Token mismatch.'. The registered schemes are: Bearer. Did you forget to call AddAuthentication().Add[SomeAuthHandler]("Token mismatch.",...)?
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ForbidAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Mvc.ForbidResult.ExecuteResultAsync(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:40:59.276 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1434200609&hub.verify_token=my-secret-token - 500 null application/json; charset=utf-8 256.3562ms
2025-07-24 08:41:54.012 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1966173025&hub.verify_token=my-secret-token - null null
2025-07-24 08:41:54.017 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1966173025&hub.verify_token=my-secret-token - 404 0 null 5.6547ms
2025-07-24 08:41:54.024 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://176d1ea7bbd4.ngrok-free.app/webhooks/whatsapp, Response status code: 404
2025-07-24 08:42:01.638 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=656903613&hub.verify_token=my-secret-token - null null
2025-07-24 08:42:01.652 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:42:01.654 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-24 08:42:01.660 +05:30 [WRN] ❌ WhatsApp webhook verification failed.
2025-07-24 08:42:01.663 +05:30 [INF] Executing ForbidResult with authentication schemes (["Token mismatch."]).
2025-07-24 08:42:01.667 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 10.7943ms
2025-07-24 08:42:01.669 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:42:01.694 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: No authentication handler is registered for the scheme 'Token mismatch.'. The registered schemes are: Bearer. Did you forget to call AddAuthentication().Add[SomeAuthHandler]("Token mismatch.",...)?
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ForbidAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Mvc.ForbidResult.ExecuteResultAsync(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:42:01.704 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=656903613&hub.verify_token=my-secret-token - 500 null application/json; charset=utf-8 65.6077ms
2025-07-24 08:43:06.518 +05:30 [INF] Request starting HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1451307396&hub.verify_token=xbytechat-secret-token - null null
2025-07-24 08:43:06.522 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:43:06.524 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-24 08:43:06.529 +05:30 [INF] ✅ WhatsApp webhook verified successfully.
2025-07-24 08:43:06.534 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.String'.
2025-07-24 08:43:06.537 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 11.4729ms
2025-07-24 08:43:06.539 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-24 08:43:06.540 +05:30 [INF] Request finished HTTP/1.1 GET http://176d1ea7bbd4.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1451307396&hub.verify_token=xbytechat-secret-token - 200 null text/plain; charset=utf-8 22.6435ms
2025-07-24 08:43:20.821 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:43:20.829 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.830 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-24 08:43:20.839 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-24 08:43:20.865 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.851 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:43:20.854 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 33.2806ms
2025-07-24 08:43:20.864 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:43:20.874 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.877 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.886 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.888 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 37.4244ms
2025-07-24 08:43:20.891 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:43:20.909 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:20.999 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:20.999 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:20.999 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:20.999 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:21.014 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
2025-07-24 08:43:21.015 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
2025-07-24 08:43:21.018 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
2025-07-24 08:43:21.020 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:20 AM'.
2025-07-24 08:43:21.022 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:43:21.025 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:43:21.033 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-24 08:43:21.034 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-24 08:43:21.034 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:43:21.034 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:43:21.179 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 136.3214ms
2025-07-24 08:43:21.179 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 139.2386ms
2025-07-24 08:43:21.178 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:21.182 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:43:21.177 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:21.184 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:43:21.190 +05:30 [ERR] Response has already started, unable to write error response for path: /hubs/inbox/negotiate
2025-07-24 08:43:21.215 +05:30 [ERR] ❌ An unhandled exception occurred
System.UnauthorizedAccessException: Invalid or missing businessId in token.
   at xbytechat.api.Shared.ClaimsBusinessDetails.GetBusinessId(ClaimsPrincipal user) in D:\xbytechat\xbytechat-api\xbytechat-api\Shared\ClaimsBusinessDetails.cs:line 12
   at xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat() in D:\xbytechat\xbytechat-api\xbytechat-api\CRM\Controllers\ContactsController.cs:line 143
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:21.219 +05:30 [ERR] Response has already started, unable to write error response for path: /hubs/inbox/negotiate
2025-07-24 08:43:21.242 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 401 null application/json 378.5397ms
2025-07-24 08:43:21.242 +05:30 [ERR] ❌ An unhandled exception occurred
System.UnauthorizedAccessException: Invalid or missing userId in token.
   at xbytechat.api.Shared.ClaimsBusinessDetails.GetUserId(ClaimsPrincipal user) in D:\xbytechat\xbytechat-api\xbytechat-api\Shared\ClaimsBusinessDetails.cs:line 20
   at xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts() in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Inbox\Controllers\InboxController.cs:line 100
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:21.251 +05:30 [ERR] Response has already started, unable to write error response for path: /api/contacts/all
2025-07-24 08:43:21.251 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 401 null application/json 359.6115ms
2025-07-24 08:43:21.263 +05:30 [ERR] Response has already started, unable to write error response for path: /api/inbox/unread-counts
2025-07-24 08:43:21.264 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 401 null application/json 434.2155ms
2025-07-24 08:43:21.269 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-24 08:43:21.270 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 401 null application/json 431.4641ms
2025-07-24 08:43:21.278 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:21.285 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 16.8385ms
2025-07-24 08:43:21.288 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-24 08:43:21.295 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:21.299 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:21 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:21.303 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:21 AM'.
2025-07-24 08:43:21.305 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 16.9303ms
2025-07-24 08:43:21.309 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-24 08:43:22.145 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:43:22.151 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:22 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:22.158 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:22 AM'.
2025-07-24 08:43:22.161 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-24 08:43:22.185 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:22.191 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-24 08:43:22.193 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 47.6681ms
2025-07-24 08:43:28.490 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-24 08:43:28.494 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:28.496 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 5.8227ms
2025-07-24 08:43:28.499 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-24 08:43:28.506 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:28.508 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:28 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:28.512 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:28 AM'.
2025-07-24 08:43:28.514 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:28.521 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:43:28.624 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-24 08:43:28.754 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-24 08:43:28.910 +05:30 [INF] Executed DbCommand (26ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-24 08:43:29.032 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-24 08:43:29.059 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-24 08:43:29.207 +05:30 [INF] Executed DbCommand (89ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-24 08:43:29.241 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-24 08:43:29.408 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 884.7093ms
2025-07-24 08:43:29.412 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:29.497 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:29.506 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-24 08:43:29.512 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-24 08:43:29.513 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 1013.6358ms
2025-07-24 08:43:29.516 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:29.521 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 8.6871ms
2025-07-24 08:43:29.522 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-24 08:43:29.529 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:29.531 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:29 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:29.535 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:29 AM'.
2025-07-24 08:43:29.536 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 14.028ms
2025-07-24 08:43:29.543 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-24 08:43:29.812 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:43:29.819 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:29 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-24 08:43:29.822 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '23-07-2025 06:42:45 PM', Current time (UTC): '24-07-2025 03:13:29 AM'.
2025-07-24 08:43:29.823 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-24 08:43:29.853 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-24 08:43:29.862 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-24 08:43:29.865 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 52.5748ms
2025-07-24 08:43:48.934 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-24 08:43:48.940 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:48.945 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 11.074ms
2025-07-24 08:43:48.949 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-24 08:43:48.954 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:48.955 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:48.956 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:43:48.965 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-24 08:43:48.975 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-24 08:43:48.987 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-24 08:43:49.000 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-24 08:43:49.007 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-24 08:43:49.014 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-24 08:43:49.018 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-24 08:43:49.021 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-24 08:43:49.025 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:43:49.052 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 93.3501ms
2025-07-24 08:43:49.054 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:49.056 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 106.994ms
2025-07-24 08:43:49.068 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:43:49.091 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:43:49.096 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:43:49.111 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:43:49.116 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 17.2626ms
2025-07-24 08:43:49.118 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:43:49.119 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 51.4167ms
2025-07-24 08:43:49.440 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-24 08:43:49.446 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:43:49.452 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-24 08:43:49.477 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-24 08:43:49.484 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-24 08:43:49.499 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-24 08:43:49.524 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-24 08:43:49.526 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-24 08:43:49.527 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-24 08:43:49.528 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-24 08:43:49.529 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-24 08:43:49.530 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-24 08:43:49.531 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-24 08:43:49.532 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-24 08:43:49.534 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-24 08:43:49.535 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-24 08:43:49.536 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-24 08:43:49.537 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-24 08:43:49.545 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:43:49.556 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 100.2481ms
2025-07-24 08:43:49.558 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:43:49.561 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 121.3073ms
2025-07-24 08:43:53.676 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-24 08:43:53.681 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:53.683 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:53.685 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:43:53.691 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-24 08:43:53.697 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-24 08:43:53.704 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-24 08:43:53.712 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-24 08:43:53.718 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-24 08:43:53.725 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-24 08:43:53.729 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-24 08:43:53.731 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-24 08:43:53.733 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:43:53.735 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 46.5926ms
2025-07-24 08:43:53.737 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-24 08:43:53.740 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 64.1486ms
2025-07-24 08:43:53.751 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:43:53.756 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:43:53.758 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:43:53.762 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:43:53.764 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.3917ms
2025-07-24 08:43:53.766 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:43:53.767 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 16.9779ms
2025-07-24 08:43:54.084 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-24 08:43:54.093 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:43:54.096 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-24 08:43:54.102 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-24 08:43:54.108 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-24 08:43:54.112 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-24 08:43:54.116 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-24 08:43:54.117 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-24 08:43:54.118 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-24 08:43:54.118 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-24 08:43:54.121 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-24 08:43:54.122 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-24 08:43:54.123 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-24 08:43:54.124 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-24 08:43:54.125 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-24 08:43:54.126 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-24 08:43:54.127 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-24 08:43:54.128 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-24 08:43:54.130 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:43:54.132 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 33.4533ms
2025-07-24 08:43:54.133 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:43:54.135 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 51.3532ms
2025-07-24 08:43:54.410 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:43:54.411 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-24 08:43:54.411 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-24 08:43:54.416 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:43:54.416 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.428 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.434 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.442 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:43:54.437 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 26.2131ms
2025-07-24 08:43:54.435 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.442 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:43:54.450 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:43:54.453 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.459 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 42.8134ms
2025-07-24 08:43:54.461 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:43:54.462 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:43:54.462 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:43:54.464 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:43:54.474 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.475 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-24 08:43:54.479 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:43:54.485 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:43:54.485 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:43:54.488 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 26.2062ms
2025-07-24 08:43:54.490 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 48.0051ms
2025-07-24 08:43:54.493 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=DjqrFX6srRItDvBMSmEJew - null null
2025-07-24 08:43:54.501 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-24 08:43:54.511 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.515 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:43:54.545 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:43:54.547 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=tnftv1-QCaqTY2_FTrr4dA - null null
2025-07-24 08:43:54.557 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:54.558 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-24 08:43:54.560 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:43:54.623 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:43:54.630 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 154.2362ms
2025-07-24 08:43:54.632 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:43:54.634 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 222.603ms
2025-07-24 08:43:54.665 +05:30 [INF] GetAllContactsAsync returned 11 contacts
2025-07-24 08:43:54.668 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:43:54.690 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 220.0798ms
2025-07-24 08:43:54.692 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:43:54.694 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 282.7349ms
2025-07-24 08:43:56.853 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null 0
2025-07-24 08:43:56.859 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:56.863 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-24 08:43:56.873 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:56.874 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:43:56.866 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-24 08:43:56.879 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:56.880 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:43:56.869 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:43:56.882 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:43:56.889 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:43:56.890 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:43:56.895 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-24 08:43:56.935 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-24 08:43:56.962 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-24 08:43:56.973 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:43:56.978 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:43:56.983 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 94.4364ms
2025-07-24 08:43:56.984 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-24 08:43:56.985 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:43:56.990 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:43:56.991 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 127.5449ms
2025-07-24 08:43:56.993 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:43:56.998 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:43:57.001 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-24 08:43:57.009 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:43:57.014 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:43:57.016 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 15.634ms
2025-07-24 08:43:57.019 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:43:57.021 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 36.5735ms
2025-07-24 08:43:57.048 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:43:57.055 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 163.1721ms
2025-07-24 08:43:57.057 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:43:57.058 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 192.3247ms
2025-07-24 08:43:57.129 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[@p1='0b64b52d-1452-4987-8971-d6d57742c6a9', @p0='Read' (Nullable = false), @p3='350cb6a4-22f2-43f4-8fe0-c091e83e951f', @p2='Read' (Nullable = false), @p5='4f805736-c400-4fb1-af38-b6335ba1c3e4', @p4='Read' (Nullable = false), @p7='71e44a84-493d-4438-81b9-14da4dab2acb', @p6='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
UPDATE "MessageLogs" SET "Status" = @p4
WHERE "Id" = @p5;
UPDATE "MessageLogs" SET "Status" = @p6
WHERE "Id" = @p7;
2025-07-24 08:43:57.174 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-24 08:43:57.176 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 237.1299ms
2025-07-24 08:43:57.178 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:43:57.180 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 0 null 326.7184ms
2025-07-24 08:43:57.690 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='80c43c6a-508b-47ff-9360-201bfd5521d3', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-24 08:43:57.724 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p1='65f8bfb6-4b4e-44f7-90d5-aaab06fdadad', @p0='2025-07-24T03:13:57.6828912Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-24 08:43:57.971 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:43:57.980 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-24 08:44:00.347 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - null 0
2025-07-24 08:44:00.356 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:44:00.356 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:44:00.356 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:00.360 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:00.364 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:00.365 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:44:00.366 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:00.367 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:44:00.369 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:44:00.370 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:44:00.371 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:44:00.379 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-24 08:44:00.379 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-24 08:44:00.397 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-24 08:44:00.399 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 24.7192ms
2025-07-24 08:44:00.401 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:44:00.402 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - 200 0 null 55.528ms
2025-07-24 08:44:00.489 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-24 08:44:00.493 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:44:00.496 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 113.5564ms
2025-07-24 08:44:00.498 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:44:00.500 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 143.8363ms
2025-07-24 08:44:00.527 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:44:00.531 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:44:00.533 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 155.7298ms
2025-07-24 08:44:00.536 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:44:00.537 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:00.540 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:00.542 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 185.7593ms
2025-07-24 08:44:00.544 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:00.548 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:44:00.553 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-24 08:44:00.561 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:44:00.565 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:44:00.568 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 16.0042ms
2025-07-24 08:44:00.571 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:00.573 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 36.4761ms
2025-07-24 08:44:01.159 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='a307d00b-239b-4c7b-bb16-77838875fbec', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-24 08:44:01.185 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@p1='194c1b56-d199-480a-903f-fc6487cf4948', @p0='2025-07-24T03:14:01.1553092Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-24 08:44:01.192 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:44:01.199 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-24 08:44:06.842 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - null 0
2025-07-24 08:44:06.846 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:06.848 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:44:06.850 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:44:06.857 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:44:06.862 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:06.859 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-24 08:44:06.858 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:44:06.864 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:44:06.868 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-24 08:44:06.871 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:06.873 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:44:06.874 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 21.5552ms
2025-07-24 08:44:06.875 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:06.882 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:44:06.884 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-24 08:44:06.885 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:44:06.887 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - 200 0 null 45.4803ms
2025-07-24 08:44:06.892 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:44:06.893 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:44:06.899 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 22.1342ms
2025-07-24 08:44:06.903 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:44:06.907 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:44:06.907 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 50.9789ms
2025-07-24 08:44:06.912 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:44:06.917 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 24.0995ms
2025-07-24 08:44:06.918 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:44:06.919 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:06.922 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:44:06.924 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 67.0906ms
2025-07-24 08:44:06.925 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:06.930 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:44:06.933 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:44:06.939 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:44:06.944 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:44:06.963 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 30.9789ms
2025-07-24 08:44:06.966 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:44:06.967 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 49.3984ms
2025-07-24 08:44:07.665 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__contactId_0='8aac7c57-6699-4511-897b-4121b407eb1c', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-24 08:44:07.716 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='1f1fe451-ef35-4ca5-9754-e73a2bda5c12', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='8aac7c57-6699-4511-897b-4121b407eb1c', @p3='2025-07-24T03:14:07.6618389Z' (DbType = DateTime), @p4='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ContactReads" ("Id", "BusinessId", "ContactId", "LastReadAt", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-07-24 08:44:07.723 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:44:07.740 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-24 08:44:10.617 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__dto_ContactId_1='8aac7c57-6699-4511-897b-4121b407eb1c'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__dto_ContactId_1
LIMIT 1
2025-07-24 08:44:10.637 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-24 08:44:10.667 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-24 08:44:10.671 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:44:10.829 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-24 08:44:10.862 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-24 08:44:10.866 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-24 08:44:11.950 +05:30 [INF] Received HTTP response headers after 1079.3396ms - 401
2025-07-24 08:44:11.953 +05:30 [INF] End processing HTTP request after 1094.9205ms - 401
2025-07-24 08:44:12.055 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@p0='38017383-1af1-46cf-9c05-1b5001ab0628', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-24T03:14:11.9652679Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Wednesday, 23-Jul-25 12:00:00 PDT. The current time is Wednesday, 23-Jul-25 20:14:11 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"A-QGWxStChLD9mhf0RCXBu0\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hello', @p16='2025-07-24T03:14:11.9653587Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-24 08:45:14.727 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:45:14.727 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:45:14.729 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=tnftv1-QCaqTY2_FTrr4dA - 101 null null 80181.6806ms
2025-07-24 08:45:14.730 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=DjqrFX6srRItDvBMSmEJew - 101 null null 80237.0224ms
2025-07-24 08:45:16.113 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-24 08:45:16.138 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:45:16.147 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-24 08:45:16.158 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-24 08:45:16.181 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-24 08:45:16.188 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-24 08:45:16.194 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 28.6313ms
2025-07-24 08:45:16.196 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-24 08:45:16.197 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 83.7838ms
2025-07-24 08:45:21.382 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-24 08:45:21.388 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:45:21.389 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 7.6126ms
2025-07-24 08:45:21.392 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 472
2025-07-24 08:45:21.398 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:45:21.400 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-24 08:45:21.407 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-24 08:45:21.420 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-24 08:45:21.421 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-24 08:45:21.433 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-24 08:45:21.447 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAUbmP4285YBPLjRDkNPj4sPqTAVbxCnZC1ZB5Mq7GAxVnmxUsuBntW6owMAFvnjNwB66QfcMUk1ptTRCRyIDv5sZAZAmeHTTbXSHPXZBtCCHrzflxlBWdKI7vbUZBSVFmLnpIlqw0xl5rnZA7k4xz10pxb4QpyM3yyZAa2papgZAHvBq5GMH9pmoCRGmuPmyCi9K1ylUIKkbSXrHmNgPIKn9w7dSME1xheqsn0QbXgi93m83roQM2eljGi2c1F53cgZDZD' (Nullable = false), @p1='2025-07-24T03:15:21.4398016Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-24 08:45:21.452 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-24 08:45:21.453 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:45:21.457 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 46.5852ms
2025-07-24 08:45:21.458 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-24 08:45:21.460 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 68.2186ms
2025-07-24 08:45:22.240 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-24 08:45:22.246 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:45:22.247 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 6.9549ms
2025-07-24 08:45:22.250 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 472
2025-07-24 08:45:22.257 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:45:22.260 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-24 08:45:22.265 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-24 08:45:24.235 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:45:24.237 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1968.7101ms
2025-07-24 08:45:24.239 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-24 08:45:24.241 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1991.5701ms
2025-07-24 08:46:00.252 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:00.253 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-24 08:46:00.256 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-24 08:46:00.256 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:00.257 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.268 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.273 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.279 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:00.281 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:00.277 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.278 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 26.2862ms
2025-07-24 08:46:00.292 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:00.288 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:00.293 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 37.2543ms
2025-07-24 08:46:00.312 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-24 08:46:00.281 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:00.323 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-24 08:46:00.295 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:00.311 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-24 08:46:00.326 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.331 +05:30 [INF] GetAllContactsAsync returned 11 contacts
2025-07-24 08:46:00.334 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.340 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:46:00.340 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:00.341 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:00.343 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:00.347 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:46:00.349 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 38.749ms
2025-07-24 08:46:00.353 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 46.1275ms
2025-07-24 08:46:00.347 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:00.351 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:00.353 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=F8uQRSYYJXrE9_HkChtGjQ - null null
2025-07-24 08:46:00.363 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:00.365 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:00.366 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 85.7161ms
2025-07-24 08:46:00.368 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 73.2204ms
2025-07-24 08:46:00.372 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.374 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 121.2308ms
2025-07-24 08:46:00.376 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 119.4689ms
2025-07-24 08:46:00.386 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:46:00.413 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Y7zztv9hr7WvrUIRjlOMPw - null null
2025-07-24 08:46:00.417 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:00.418 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:46:06.037 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - null 0
2025-07-24 08:46:06.053 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:06.044 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:46:06.044 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:46:06.057 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:46:06.062 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:06.068 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:06.069 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:06.071 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:46:06.072 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:06.079 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:06.079 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-24 08:46:06.080 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:06.094 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-24 08:46:06.092 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-24 08:46:06.097 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:46:06.100 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:06.100 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 26.3624ms
2025-07-24 08:46:06.108 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:46:06.107 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:46:06.105 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 16.6983ms
2025-07-24 08:46:06.109 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - 200 0 null 72.5955ms
2025-07-24 08:46:06.115 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:46:06.117 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:46:06.122 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 25.5636ms
2025-07-24 08:46:06.123 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 78.5123ms
2025-07-24 08:46:06.123 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - null null
2025-07-24 08:46:06.125 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:06.132 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:06.134 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 89.3394ms
2025-07-24 08:46:06.136 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:06.140 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:06.143 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:46:06.150 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='8aac7c57-6699-4511-897b-4121b407eb1c'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:46:06.154 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:46:06.156 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 13.2132ms
2025-07-24 08:46:06.158 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:06.160 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/8aac7c57-6699-4511-897b-4121b407eb1c - 200 null application/json; charset=utf-8 36.7643ms
2025-07-24 08:46:06.850 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='8aac7c57-6699-4511-897b-4121b407eb1c', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-24 08:46:06.855 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='1f1fe451-ef35-4ca5-9754-e73a2bda5c12', @p0='2025-07-24T03:16:06.8469493Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-24 08:46:06.860 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:46:06.867 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-24 08:46:17.731 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - null 0
2025-07-24 08:46:17.736 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:17.737 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:46:17.741 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:17.738 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:46:17.737 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:46:17.742 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:17.744 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:17.747 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:17.748 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:17.754 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-24 08:46:17.752 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:46:17.758 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-24 08:46:17.763 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-24 08:46:17.770 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:46:17.764 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:17.771 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 21.0474ms
2025-07-24 08:46:17.774 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:46:17.780 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-24 08:46:17.781 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-24 08:46:17.784 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 26.6418ms
2025-07-24 08:46:17.791 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:17.786 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - 200 0 null 55.4598ms
2025-07-24 08:46:17.790 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:17.785 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - null null
2025-07-24 08:46:17.792 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 55.0926ms
2025-07-24 08:46:17.798 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 21.5397ms
2025-07-24 08:46:17.803 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:17.812 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-24 08:46:17.813 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:17.814 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 76.6115ms
2025-07-24 08:46:17.815 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:17.822 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-24 08:46:17.834 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-24 08:46:17.838 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:46:17.841 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 19.7257ms
2025-07-24 08:46:17.843 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-24 08:46:17.845 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/a307d00b-239b-4c7b-bb16-77838875fbec - 200 null application/json; charset=utf-8 59.8128ms
2025-07-24 08:46:18.540 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='a307d00b-239b-4c7b-bb16-77838875fbec', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-24 08:46:18.565 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p1='194c1b56-d199-480a-903f-fc6487cf4948', @p0='2025-07-24T03:16:18.5374064Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-24 08:46:18.571 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:46:18.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-24 08:46:26.530 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:46:26.530 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:46:26.539 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=F8uQRSYYJXrE9_HkChtGjQ - 101 null null 26185.6075ms
2025-07-24 08:46:26.540 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Y7zztv9hr7WvrUIRjlOMPw - 101 null null 26126.9027ms
2025-07-24 08:46:26.795 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:46:26.801 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:46:26.803 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:46:26.806 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:46:26.809 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.7673ms
2025-07-24 08:46:26.811 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:46:26.812 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 16.8486ms
2025-07-24 08:46:26.909 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-24 08:46:26.915 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:46:26.918 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-24 08:46:26.927 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-24 08:46:26.933 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-24 08:46:26.938 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-24 08:46:26.942 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-24 08:46:26.944 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-24 08:46:26.945 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-24 08:46:26.946 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-24 08:46:26.947 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-24 08:46:26.948 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-24 08:46:26.949 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-24 08:46:26.950 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-24 08:46:26.952 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-24 08:46:26.953 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-24 08:46:26.954 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-24 08:46:26.955 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-24 08:46:26.957 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:26.960 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 39.3019ms
2025-07-24 08:46:26.963 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:46:26.964 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 55.6802ms
2025-07-24 08:46:27.010 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:27.010 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-24 08:46:27.010 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-24 08:46:27.014 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.018 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.020 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:27.022 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.024 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:27.023 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 13.193ms
2025-07-24 08:46:27.025 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:27.028 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.029 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:27.031 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:27.041 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 21.3326ms
2025-07-24 08:46:27.043 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:27.040 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.043 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:27.046 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-24 08:46:27.057 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:27.061 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.066 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-24 08:46:27.058 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-24 08:46:27.066 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:27.074 +05:30 [INF] GetAllContactsAsync returned 11 contacts
2025-07-24 08:46:27.126 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 101.031ms
2025-07-24 08:46:27.070 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:27.126 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:46:27.130 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:27.136 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:27.137 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=xTlBYWVKTSldtDZagmQZ8Q - null null
2025-07-24 08:46:27.141 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:46:27.141 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 96.1775ms
2025-07-24 08:46:27.143 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 99.6807ms
2025-07-24 08:46:27.147 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.149 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 93.3817ms
2025-07-24 08:46:27.151 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:27.157 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:46:27.159 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:27.160 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 149.8718ms
2025-07-24 08:46:27.167 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 156.2542ms
2025-07-24 08:46:27.185 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=lhtEEXGjAYnr-Q46GNJ0nw - null null
2025-07-24 08:46:27.189 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:27.190 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:46:32.763 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:46:32.763 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:46:32.797 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=lhtEEXGjAYnr-Q46GNJ0nw - 101 null null 5612.4554ms
2025-07-24 08:46:32.794 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=xTlBYWVKTSldtDZagmQZ8Q - 101 null null 5657.3468ms
2025-07-24 08:46:32.924 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-24 08:46:32.930 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:46:32.931 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-24 08:46:32.936 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:46:32.939 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 4.2942ms
2025-07-24 08:46:32.941 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-24 08:46:32.943 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 18.767ms
2025-07-24 08:46:32.989 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-24 08:46:32.998 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:46:33.002 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-24 08:46:33.010 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-24 08:46:33.017 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-24 08:46:33.022 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-24 08:46:33.026 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-24 08:46:33.027 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-24 08:46:33.028 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-24 08:46:33.030 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-24 08:46:33.031 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-24 08:46:33.032 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-24 08:46:33.033 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-24 08:46:33.035 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-24 08:46:33.036 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-24 08:46:33.037 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-24 08:46:33.039 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-24 08:46:33.040 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-24 08:46:33.042 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:33.045 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 39.5685ms
2025-07-24 08:46:33.047 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-24 08:46:33.049 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 60.1726ms
2025-07-24 08:46:33.084 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:33.085 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-24 08:46:33.085 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-24 08:46:33.089 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.093 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-24 08:46:33.093 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.097 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.098 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 13.9811ms
2025-07-24 08:46:33.102 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.102 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:33.104 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:33.110 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 17.5814ms
2025-07-24 08:46:33.103 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:33.113 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-24 08:46:33.114 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.116 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-24 08:46:33.122 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:46:33.126 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:33.125 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.132 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-24 08:46:33.135 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-24 08:46:33.136 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:33.143 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-24 08:46:33.147 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-24 08:46:33.147 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 45.1655ms
2025-07-24 08:46:33.138 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:33.151 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=QMp4P16dgun9yxskp6eAhA - null null
2025-07-24 08:46:33.154 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:46:33.156 +05:30 [INF] GetAllContactsAsync returned 11 contacts
2025-07-24 08:46:33.161 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-24 08:46:33.164 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.166 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 37.7481ms
2025-07-24 08:46:33.168 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-24 08:46:33.169 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 55.6654ms
2025-07-24 08:46:33.171 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:46:33.172 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-24 08:46:33.174 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 40.1554ms
2025-07-24 08:46:33.185 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 99.936ms
2025-07-24 08:46:33.187 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-24 08:46:33.193 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 107.8589ms
2025-07-24 08:46:33.196 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Muiwiogr725LoeCycB1HbQ - null null
2025-07-24 08:46:33.202 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:46:33.203 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-24 08:47:20.493 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:47:20.493 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-24 08:47:20.498 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Muiwiogr725LoeCycB1HbQ - 101 null null 47301.8709ms
2025-07-24 08:47:20.499 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=QMp4P16dgun9yxskp6eAhA - 101 null null 47348.2129ms
2025-07-24 08:47:35.876 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-24 08:47:35.881 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:47:35.882 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-24 08:47:35.876 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-24 08:47:35.893 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-24 08:47:35.900 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:47:35.905 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-24 08:47:35.908 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-24 08:47:35.916 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-24 08:47:35.953 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-24 08:47:35.955 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-24 08:47:35.960 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType40`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-24 08:47:35.969 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 43.8738ms
2025-07-24 08:47:35.972 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-24 08:47:35.973 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 97.1009ms
2025-07-24 08:47:35.991 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-24 08:47:35.997 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:47:36.002 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 100.4861ms
2025-07-24 08:47:36.004 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-24 08:47:36.005 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 129.4509ms
2025-07-24 08:47:41.669 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-24 08:47:41.675 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:47:41.676 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 6.4587ms
2025-07-24 08:47:41.682 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-24 08:47:41.688 +05:30 [INF] CORS policy execution successful.
2025-07-24 08:47:41.691 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-24 08:47:41.699 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-24 08:47:41.708 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-24 08:47:41.713 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-24 08:47:41.718 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-24 08:47:41.720 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-24 08:47:41.721 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/673199269218077/messages
2025-07-24 08:47:42.678 +05:30 [INF] Received HTTP response headers after 955.0024ms - 401
2025-07-24 08:47:42.680 +05:30 [INF] End processing HTTP request after 960.1535ms - 401
2025-07-24 08:47:42.688 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='ab3a366b-be07-4a32-a179-a26542af1881', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-24T03:17:42.6840750Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='khlljhj' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Wednesday, 23-Jul-25 12:00:00 PDT. The current time is Wednesday, 23-Jul-25 20:17:42 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"A3AaBiCwX0DvKVYBD5z1s2Y\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='khlljhj', @p16='2025-07-24T03:17:42.6840751Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-24 08:47:42.695 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-24 08:47:42.702 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 1000.5031ms
2025-07-24 08:47:42.708 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-24 08:47:42.710 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 1027.9692ms
