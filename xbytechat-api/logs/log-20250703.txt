2025-07-03 09:14:15.843 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-03 09:14:15.899 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-03 09:14:15.917 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-03 09:14:16.878 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-03 09:14:17.581 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-03 09:14:17.805 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-03 09:14:17.806 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-03 09:14:17.808 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-03 09:14:17.809 +05:30 [INF] Hosting environment: Development
2025-07-03 09:14:17.810 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-03 09:14:17.843 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-03 09:14:17.864 +05:30 [INF] Executed DbCommand (38ms) [Parameters=[@__cutoff_0='2025-06-26T03:44:16.0679788Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-03 09:14:19.579 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger - null null
2025-07-03 09:14:19.834 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger - 301 0 null 270.0838ms
2025-07-03 09:14:19.841 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 09:14:19.936 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 94.8442ms
2025-07-03 09:14:19.948 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - null null
2025-07-03 09:14:19.949 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - null null
2025-07-03 09:14:19.957 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - null null
2025-07-03 09:14:19.958 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 09:14:20.003 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 44.6975ms
2025-07-03 09:14:20.024 +05:30 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-03 09:14:20.024 +05:30 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-03 09:14:20.030 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui.css - 200 152034 text/css 81.6628ms
2025-07-03 09:14:20.030 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-standalone-preset.js - 200 230280 text/javascript 73.9145ms
2025-07-03 09:14:20.041 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 09:14:20.054 +05:30 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-03 09:14:20.061 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/swagger-ui-bundle.js - 200 1456926 text/javascript 109.174ms
2025-07-03 09:14:20.107 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 66.088ms
2025-07-03 09:14:20.292 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 09:14:20.600 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 308.8102ms
2025-07-03 09:15:12.475 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:15:12.486 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-03 09:15:12.660 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:12 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:15:12.715 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:12 AM'.
2025-07-03 09:15:12.724 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 09:15:12.791 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 09:15:12.808 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 09:15:12.809 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 333.9343ms
2025-07-03 09:15:20.204 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 09:15:20.220 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:15:20.223 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 19.4316ms
2025-07-03 09:15:20.229 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 09:15:20.239 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:15:20.244 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:15:20.248 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:20 AM'.
2025-07-03 09:15:20.253 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:15:20.283 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:15:20.399 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 09:15:20.522 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 09:15:20.675 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 09:15:20.795 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 09:15:20.825 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 09:15:20.949 +05:30 [INF] Executed DbCommand (72ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 09:15:20.980 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 09:15:21.122 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 831.011ms
2025-07-03 09:15:21.127 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:15:21.222 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 09:15:21.232 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 09:15:21.239 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 09:15:21.240 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 1010.9712ms
2025-07-03 09:15:21.242 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:15:21.246 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 7.2458ms
2025-07-03 09:15:21.248 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 09:15:21.254 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:15:21.258 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:21 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:15:21.261 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:21 AM'.
2025-07-03 09:15:21.264 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 16.1387ms
2025-07-03 09:15:21.272 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 09:15:21.886 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:15:21.893 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:21 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:15:21.897 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:45:21 AM'.
2025-07-03 09:15:21.902 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 09:15:21.933 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 09:15:21.942 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 09:15:21.943 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 57.7527ms
2025-07-03 09:24:18.283 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 09:24:18.326 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:18.328 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 44.9629ms
2025-07-03 09:24:18.333 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 09:24:18.343 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:18.345 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:18 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:24:18.349 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:18 AM'.
2025-07-03 09:24:18.350 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:18.353 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:18.360 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 09:24:18.483 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 09:24:18.490 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 09:24:18.496 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 09:24:18.501 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 09:24:18.507 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 09:24:18.510 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 09:24:18.584 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 229.1525ms
2025-07-03 09:24:18.587 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:18.656 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 09:24:18.665 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 09:24:18.667 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 334.3103ms
2025-07-03 09:24:18.671 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 09:24:18.675 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:18.676 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 5.2684ms
2025-07-03 09:24:18.681 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 09:24:18.684 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:18.687 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:18 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:24:18.690 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:18 AM'.
2025-07-03 09:24:18.692 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 11.1126ms
2025-07-03 09:24:18.696 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 09:24:19.362 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:24:19.368 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:19 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 09:24:19.373 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '02-07-2025 06:44:48 PM', Current time (UTC): '03-07-2025 03:54:19 AM'.
2025-07-03 09:24:19.377 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 09:24:19.408 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 09:24:19.414 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 09:24:19.415 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 53.5698ms
2025-07-03 09:24:39.817 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 09:24:39.822 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:39.824 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 7.2912ms
2025-07-03 09:24:39.828 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 09:24:39.844 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:39.846 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:39.847 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:39.862 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 09:24:39.869 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 09:24:39.876 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 09:24:39.881 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 09:24:39.887 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 09:24:39.891 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 09:24:39.895 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 09:24:39.897 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 09:24:39.908 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:39.938 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 86.9484ms
2025-07-03 09:24:39.940 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:39.943 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 114.2297ms
2025-07-03 09:24:40.265 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:24:40.284 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:40.288 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:40.294 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:40.298 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 7.325ms
2025-07-03 09:24:40.301 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:40.303 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 38.1371ms
2025-07-03 09:24:40.522 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 09:24:40.527 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:40.534 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 09:24:40.554 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:24:40.566 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 09:24:40.585 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 09:24:40.611 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 09:24:40.612 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 09:24:40.613 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 09:24:40.614 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 09:24:40.615 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 09:24:40.616 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 09:24:40.617 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 09:24:40.619 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 09:24:40.619 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 09:24:40.620 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 09:24:40.621 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 09:24:40.622 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 09:24:40.629 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 09:24:40.639 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 103.4264ms
2025-07-03 09:24:40.642 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:40.643 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 121.4419ms
2025-07-03 09:24:45.870 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 09:24:45.874 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:45.875 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 5.2401ms
2025-07-03 09:24:45.877 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 09:24:45.882 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:45.884 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:45.885 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:45.888 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 09:24:45.892 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 09:24:45.901 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 09:24:45.905 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 09:24:45.910 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 09:24:45.916 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 09:24:45.919 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 09:24:45.921 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 09:24:45.922 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:45.924 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 36.8504ms
2025-07-03 09:24:45.926 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:45.929 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 51.8416ms
2025-07-03 09:24:45.938 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:24:45.943 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:45.945 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:45.950 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:45.953 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 4.3421ms
2025-07-03 09:24:45.955 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:45.957 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 18.2841ms
2025-07-03 09:24:46.274 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 09:24:46.280 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:46.282 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 09:24:46.287 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:24:46.292 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 09:24:46.295 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 09:24:46.301 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 09:24:46.302 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 09:24:46.303 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 09:24:46.304 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 09:24:46.304 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 09:24:46.305 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 09:24:46.306 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 09:24:46.306 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 09:24:46.307 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 09:24:46.308 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 09:24:46.309 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 09:24:46.310 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 09:24:46.312 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 09:24:46.313 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 29.3508ms
2025-07-03 09:24:46.315 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:46.316 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 41.6436ms
2025-07-03 09:24:49.189 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 09:24:49.196 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:24:49.197 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:49.198 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:49.202 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 09:24:49.209 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 09:24:49.215 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 09:24:49.220 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 09:24:49.224 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 09:24:49.231 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 09:24:49.234 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 09:24:49.235 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 09:24:49.237 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:49.239 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 38.2251ms
2025-07-03 09:24:49.241 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 09:24:49.243 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 53.6818ms
2025-07-03 09:24:49.256 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 09:24:49.263 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:49.264 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 09:24:49.267 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:24:49.269 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.75ms
2025-07-03 09:24:49.271 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 09:24:49.273 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 17.3869ms
2025-07-03 09:24:49.594 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 09:24:49.598 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:49.600 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 09:24:49.609 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:24:49.614 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 09:24:49.617 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 09:24:49.619 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 09:24:49.620 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 09:24:49.621 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 09:24:49.622 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 09:24:49.623 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 09:24:49.624 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 09:24:49.625 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 09:24:49.626 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 09:24:49.627 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 09:24:49.628 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 09:24:49.629 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 09:24:49.630 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 09:24:49.632 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 09:24:49.634 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 29.8914ms
2025-07-03 09:24:49.635 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 09:24:49.637 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 43.1958ms
2025-07-03 09:28:27.021 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 09:28:27.035 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 14.8268ms
2025-07-03 09:28:27.189 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 09:28:27.193 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 09:28:27.194 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 4.5163ms
2025-07-03 09:28:27.211 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 18.038ms
2025-07-03 09:28:27.546 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 09:28:27.565 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/favicon-32x32.png - null null
2025-07-03 09:28:27.569 +05:30 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-07-03 09:28:27.571 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/favicon-32x32.png - 200 628 image/png 5.9937ms
2025-07-03 09:28:27.618 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 71.5347ms
2025-07-03 09:31:57.045 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 09:31:57.045 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 09:31:57.051 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:31:57.054 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 09:31:57.057 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:31:57.059 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 09:31:57.059 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 09:31:57.065 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 09:31:57.071 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 09:31:57.153 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 09:31:57.172 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 09:31:57.175 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 09:31:57.177 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 09:31:57.216 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 09:31:57.266 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 09:31:57.279 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 213.0701ms
2025-07-03 09:31:57.281 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 09:31:57.282 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 236.9307ms
2025-07-03 09:31:58.039 +05:30 [INF] Received HTTP response headers after 861.675ms - 401
2025-07-03 09:31:58.042 +05:30 [INF] End processing HTTP request after 869.9874ms - 401
2025-07-03 09:31:58.044 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 12:00:00 PDT. The current time is Wednesday, 02-Jul-25 21:02:02 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"At8Kksk6krVy6vMetcD1lu-"}}
2025-07-03 09:31:58.045 +05:30 [ERR] ❌ Failed to fetch templates for BusinessId "c13be597-6ae2-42bb-9d43-925815f24ff8": {"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 12:00:00 PDT. The current time is Wednesday, 02-Jul-25 21:02:02 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"At8Kksk6krVy6vMetcD1lu-"}}
2025-07-03 09:31:58.047 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:31:58.050 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 989.1839ms
2025-07-03 09:31:58.051 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 09:31:58.052 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1006.9126ms
2025-07-03 09:33:23.898 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-03 09:33:23.901 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:23.902 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 09:33:23.906 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 09:33:23.918 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-03 09:33:23.922 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-03 09:33:23.926 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 17.6143ms
2025-07-03 09:33:23.927 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 09:33:23.928 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 30.0302ms
2025-07-03 09:33:28.200 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-03 09:33:28.203 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:28.204 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 4.5217ms
2025-07-03 09:33:28.205 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 475
2025-07-03 09:33:28.209 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:28.210 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 09:33:28.214 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 09:33:28.221 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-03 09:33:28.222 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-03 09:33:28.228 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-03 09:33:28.296 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BO8nLJmYvGIKt5leIYZBlIpemGKiBzzQZASRnKwcDAy04N6BmxcpVKtwmBZByoWnMAQjaMOJ6dmipbkMoy0LayUTEPPp9upyfQj8oh5eZCv1qViXXKZC7LinZAs7To7q9ZAFfYNEnZAtu0z7gZBfmhSTMuGOE1szwLAPDfKK1i8kuI4Kiv63U6sCtjIONGkF5KmghuCmKd1TfAuKZCsMZCP6xmWK4ZBXxVxDfl7fbw3XZA0grriwzp5S3KyXoZD' (Nullable = false), @p1='2025-07-03T04:03:28.2321081Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 09:33:28.305 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-03 09:33:28.306 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:33:28.308 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 92.4733ms
2025-07-03 09:33:28.310 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 09:33:28.310 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 105.2853ms
2025-07-03 09:33:28.853 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-03 09:33:28.856 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:28.856 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.3344ms
2025-07-03 09:33:28.857 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 475
2025-07-03 09:33:28.862 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:28.863 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 09:33:28.866 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 09:33:30.824 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:33:30.826 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1957.3776ms
2025-07-03 09:33:30.827 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 09:33:30.828 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1970.1986ms
2025-07-03 09:33:42.138 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 09:33:42.138 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 09:33:42.141 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:42.144 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 09:33:42.144 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:33:42.146 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 09:33:42.147 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 09:33:42.150 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 09:33:42.151 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 09:33:42.157 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 09:33:42.157 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 09:33:42.171 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 09:33:42.172 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 09:33:42.172 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 09:33:42.175 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 09:33:42.178 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 28.8061ms
2025-07-03 09:33:42.179 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 09:33:42.180 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 41.9073ms
2025-07-03 09:33:43.157 +05:30 [INF] Received HTTP response headers after 981.7646ms - 200
2025-07-03 09:33:43.158 +05:30 [INF] End processing HTTP request after 987.289ms - 200
2025-07-03 09:33:43.160 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=DLLZU-1vx84GBfxmyvxjpw&oh=01_Q5Aa1wGisv_CANiZSCa-BuyhrTuVcYvLQUX3gKYvyOXmo_VC9Q&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 09:33:43.301 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 09:33:43.305 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1152.563ms
2025-07-03 09:33:43.306 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 09:33:43.307 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1168.4206ms
2025-07-03 09:34:33.277 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 09:34:33.280 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:34:33.281 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 4.0561ms
2025-07-03 09:34:33.282 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 09:34:33.287 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:34:33.288 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:34:33.291 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 09:34:59.060 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='00000000-0000-0000-0000-000000000000'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:35:07.190 +05:30 [ERR] Failed executing DbCommand (34ms) [Parameters=[@p0='570169b9-08ee-4dfe-9f00-8b242ca9c6c5', @p1='00000000-0000-0000-0000-000000000000', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:05:06.1998412Z' (DbType = DateTime), @p7='WhatsApp settings not found.', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12=NULL, @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 09:35:07.203 +05:30 [ERR] An exception occurred in the database while saving changes for context type 'xbytechat.api.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-03 09:35:07.730 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 34436.6228ms
2025-07-03 09:35:07.731 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:35:07.769 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xbytechat.api.Features.MessagesEngine.Services.MessageEngineService.SendImageTemplateMessageAsync(ImageTemplateMessageDto dto)
   at xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage(ImageTemplateMessageDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context)
2025-07-03 09:35:08.077 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 500 null application/json; charset=utf-8 34795.165ms
2025-07-03 09:39:53.645 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 09:39:53.648 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:39:53.649 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 4.1792ms
2025-07-03 09:39:53.651 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 09:39:53.654 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:39:53.656 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:39:53.657 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 09:40:31.440 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='00000000-0000-0000-0000-000000000000'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:41:09.268 +05:30 [ERR] Failed executing DbCommand (20ms) [Parameters=[@p0='4709b5a4-8c44-4500-8f57-4047be97dcee', @p1='00000000-0000-0000-0000-000000000000', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:11:09.2452044Z' (DbType = DateTime), @p7='WhatsApp settings not found.', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12=NULL, @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 09:41:09.281 +05:30 [ERR] An exception occurred in the database while saving changes for context type 'xbytechat.api.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-03 09:41:09.567 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 75909.1263ms
2025-07-03 09:41:09.569 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:41:09.607 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xbytechat.api.Features.MessagesEngine.Services.MessageEngineService.SendImageTemplateMessageAsync(ImageTemplateMessageDto dto)
   at xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage(ImageTemplateMessageDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context)
2025-07-03 09:41:09.852 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 500 null application/json; charset=utf-8 76201.7431ms
2025-07-03 09:41:12.292 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 09:41:12.294 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:41:12.295 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.1439ms
2025-07-03 09:41:12.296 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 09:41:12.299 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:41:12.300 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:41:12.301 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 09:41:39.121 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='00000000-0000-0000-0000-000000000000'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:41:39.221 +05:30 [ERR] Failed executing DbCommand (19ms) [Parameters=[@p0='ec3ec6e3-143d-4e76-a827-3cb71101a1b2', @p1='00000000-0000-0000-0000-000000000000', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:11:39.2013551Z' (DbType = DateTime), @p7='WhatsApp settings not found.', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12=NULL, @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 09:41:39.232 +05:30 [ERR] An exception occurred in the database while saving changes for context type 'xbytechat.api.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-03 09:41:39.523 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 27220.9675ms
2025-07-03 09:41:39.524 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:41:39.560 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xbytechat.api.Features.MessagesEngine.Services.MessageEngineService.SendImageTemplateMessageAsync(ImageTemplateMessageDto dto)
   at xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage(ImageTemplateMessageDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context)
2025-07-03 09:41:39.706 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 500 null application/json; charset=utf-8 27409.4007ms
2025-07-03 09:41:53.370 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 09:41:53.373 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:41:53.374 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.7227ms
2025-07-03 09:41:53.407 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 09:41:53.409 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:41:53.410 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:41:53.411 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 09:44:44.933 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='00000000-0000-0000-0000-000000000000'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 09:44:44.982 +05:30 [ERR] Failed executing DbCommand (9ms) [Parameters=[@p0='eba3591e-60c9-4ca6-911d-e649c871dbbf', @p1='00000000-0000-0000-0000-000000000000', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:14:44.9731446Z' (DbType = DateTime), @p7='WhatsApp settings not found.', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12=NULL, @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 09:44:44.985 +05:30 [ERR] An exception occurred in the database while saving changes for context type 'xbytechat.api.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-03 09:44:47.619 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 174207.3066ms
2025-07-03 09:44:47.621 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:44:47.664 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "MessageLogs" violates foreign key constraint "FK_MessageLogs_Businesses_BusinessId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: MessageLogs
    ConstraintName: FK_MessageLogs_Businesses_BusinessId
    File: ri_triggers.c
    Line: 2619
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at xbytechat.api.Features.MessagesEngine.Services.MessageEngineService.SendImageTemplateMessageAsync(ImageTemplateMessageDto dto)
   at xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage(ImageTemplateMessageDto dto)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context)
2025-07-03 09:44:51.111 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 500 null application/json; charset=utf-8 177703.9985ms
2025-07-03 09:44:58.646 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 09:44:58.648 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:44:58.649 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.0778ms
2025-07-03 09:44:58.650 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 09:44:58.653 +05:30 [INF] CORS policy execution successful.
2025-07-03 09:44:58.654 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 09:44:58.655 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:03:37.264 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-03 10:03:37.299 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-03 10:03:37.311 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-03 10:03:37.940 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-03 10:03:38.456 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-03 10:03:38.640 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-03 10:03:38.641 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-03 10:03:38.643 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-03 10:03:38.644 +05:30 [INF] Hosting environment: Development
2025-07-03 10:03:38.646 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-03 10:03:38.658 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-03 10:03:38.680 +05:30 [INF] Executed DbCommand (47ms) [Parameters=[@__cutoff_0='2025-06-26T04:33:37.3996693Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-03 10:03:40.761 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 10:03:40.898 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 144.6004ms
2025-07-03 10:03:40.912 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 10:03:40.919 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 6.0614ms
2025-07-03 10:03:40.975 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 10:03:41.004 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.6297ms
2025-07-03 10:03:41.137 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 10:03:41.326 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 189.2021ms
2025-07-03 10:03:47.429 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:03:47.434 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-03 10:03:47.576 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:47.583 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:03:47.636 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:47.647 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 59.6099ms
2025-07-03 10:03:47.648 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:47.651 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 222.0795ms
2025-07-03 10:03:47.657 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:03:47.667 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:47.673 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:03:47.735 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:03:47.839 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:03:47.847 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:03:47.864 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:03:47.864 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:03:47.865 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:03:47.866 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:03:47.867 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:03:47.867 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:03:47.868 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:03:47.869 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:03:47.870 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:03:47.871 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:03:47.871 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:03:47.872 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:03:47.878 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:03:47.885 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 210.1499ms
2025-07-03 10:03:47.887 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:47.890 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 232.801ms
2025-07-03 10:03:50.731 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:03:50.736 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:50.737 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 6.4252ms
2025-07-03 10:03:50.739 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:03:50.743 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:50.745 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:03:50.753 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:03:50.786 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:50.789 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 34.8218ms
2025-07-03 10:03:50.790 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:03:50.791 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 51.3591ms
2025-07-03 10:03:50.793 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:03:50.796 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:50.796 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 3.5828ms
2025-07-03 10:03:50.797 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:03:50.801 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:50.802 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 4.8593ms
2025-07-03 10:03:50.805 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:03:50.999 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:03:51.002 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:51.003 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:03:51.008 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:51.009 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 4.3614ms
2025-07-03 10:03:51.010 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:51.011 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 12.4426ms
2025-07-03 10:03:51.057 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:03:51.061 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:51.063 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:03:51.073 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:03:51.077 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:03:51.079 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:03:51.082 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:03:51.082 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:03:51.083 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:03:51.084 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:03:51.084 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:03:51.085 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:03:51.086 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:03:51.087 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:03:51.087 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:03:51.088 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:03:51.089 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:03:51.089 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:03:51.091 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:03:51.092 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 26.3403ms
2025-07-03 10:03:51.094 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:51.095 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 37.3805ms
2025-07-03 10:03:56.838 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:03:56.841 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:56.842 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.2559ms
2025-07-03 10:03:56.843 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:03:56.847 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:56.848 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:03:56.851 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:03:56.863 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:03:56.882 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:03:56.919 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:03:56.932 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:03:56.947 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:03:57.013 +05:30 [INF] Executed DbCommand (40ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:03:57.031 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:03:57.037 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:03:57.039 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:57.045 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 193.0962ms
2025-07-03 10:03:57.047 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:03:57.048 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 204.6741ms
2025-07-03 10:03:57.053 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:03:57.055 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:57.056 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:03:57.058 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:57.059 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.5234ms
2025-07-03 10:03:57.060 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:03:57.061 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.1403ms
2025-07-03 10:03:57.067 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:03:57.070 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:57.070 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:03:57.074 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:03:57.077 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:03:57.079 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:03:57.081 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:03:57.082 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:03:57.082 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:03:57.083 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:03:57.083 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:03:57.084 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:03:57.084 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:03:57.085 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:03:57.085 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:03:57.086 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:03:57.086 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:03:57.087 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:03:57.088 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:03:57.089 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.0825ms
2025-07-03 10:03:57.089 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:03:57.090 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 23.0808ms
2025-07-03 10:03:57.329 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:03:57.329 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:03:57.332 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:57.334 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:03:57.335 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:03:57.336 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:03:57.340 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:03:57.340 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:03:57.358 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:03:57.371 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:03:57.382 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:03:57.396 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:03:57.398 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:03:57.432 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:03:57.488 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:03:57.499 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 154.6879ms
2025-07-03 10:03:57.500 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:03:57.501 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 171.9055ms
2025-07-03 10:03:58.333 +05:30 [INF] Received HTTP response headers after 932.1485ms - 200
2025-07-03 10:03:58.335 +05:30 [INF] End processing HTTP request after 940.3703ms - 200
2025-07-03 10:03:58.336 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=I_g6dXOOWLQ7dwnvSJB7cA&oh=01_Q5Aa1wEyXfsyxME8M7HxyDgc2R5KeP2ZRlJOjPH_GCYKQaTlOQ&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:03:58.453 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:03:58.457 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1114.917ms
2025-07-03 10:03:58.458 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:03:58.459 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1130.701ms
2025-07-03 10:04:23.345 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:04:23.347 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:23.348 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.6136ms
2025-07-03 10:04:23.350 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:04:23.357 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:23.358 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:04:23.358 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:04:23.361 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:23.362 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 2.7729ms
2025-07-03 10:04:23.363 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:04:23.364 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 14.1614ms
2025-07-03 10:04:23.366 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:04:23.368 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:23.368 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.4181ms
2025-07-03 10:04:23.370 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:04:23.374 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:23.375 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 5.4706ms
2025-07-03 10:04:23.377 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:04:23.786 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:04:23.789 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:23.790 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:23.792 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:23.793 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.8782ms
2025-07-03 10:04:23.794 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:23.795 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.8626ms
2025-07-03 10:04:23.817 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:04:23.819 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:23.820 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:04:23.825 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:04:23.832 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:04:23.834 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:04:23.836 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:04:23.837 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:04:23.837 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:04:23.838 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:04:23.839 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:04:23.839 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:04:23.840 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:04:23.840 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:04:23.841 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:04:23.841 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:04:23.842 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:04:23.842 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:04:23.844 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:04:23.845 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 22.8084ms
2025-07-03 10:04:23.845 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:23.846 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 29.7421ms
2025-07-03 10:04:26.303 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:04:26.305 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:26.306 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.5036ms
2025-07-03 10:04:26.308 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:04:26.311 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:26.312 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:04:26.313 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:26.315 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:04:26.318 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:04:26.323 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:04:26.326 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:04:26.329 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:04:26.332 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:04:26.334 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:04:26.335 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:04:26.336 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:26.338 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 23.5389ms
2025-07-03 10:04:26.338 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:04:26.340 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 31.8878ms
2025-07-03 10:04:26.345 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:04:26.347 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:26.348 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:26.349 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:26.350 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.502ms
2025-07-03 10:04:26.351 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:26.352 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.1252ms
2025-07-03 10:04:26.358 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:04:26.364 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:26.365 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:04:26.368 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:04:26.372 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:04:26.374 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:04:26.376 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:04:26.377 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:04:26.377 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:04:26.378 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:04:26.378 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:04:26.379 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:04:26.379 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:04:26.380 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:04:26.380 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:04:26.381 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:04:26.381 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:04:26.382 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:04:26.383 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:04:26.384 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.7177ms
2025-07-03 10:04:26.385 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:26.385 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 27.4135ms
2025-07-03 10:04:26.635 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:04:26.635 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:04:26.638 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:26.639 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:26.640 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:04:26.640 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:04:26.641 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:04:26.642 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:04:26.645 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:04:26.645 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:04:26.650 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:04:26.652 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:04:26.654 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:04:26.655 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:04:26.658 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:04:26.660 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 15.9214ms
2025-07-03 10:04:26.661 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:04:26.662 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 27.4054ms
2025-07-03 10:04:27.334 +05:30 [INF] Received HTTP response headers after 678.7157ms - 200
2025-07-03 10:04:27.336 +05:30 [INF] End processing HTTP request after 683.4215ms - 200
2025-07-03 10:04:27.343 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=muFVq4d4z7YoUF0BSZVXzQ&oh=01_Q5Aa1wFe_6bXa4qjnMW_cPSt2tEqU06xSDVXbT4yxIWmv9rYww&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:04:27.346 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:27.348 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 704.8144ms
2025-07-03 10:04:27.349 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:04:27.350 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 715.16ms
2025-07-03 10:04:44.776 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:04:44.779 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:44.780 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.241ms
2025-07-03 10:04:44.781 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:04:44.784 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:44.785 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:04:44.786 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:44.788 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:04:44.791 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:04:44.795 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:04:44.798 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:04:44.801 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:04:44.804 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:04:44.806 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:04:44.807 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:04:44.808 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:44.809 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 22.1405ms
2025-07-03 10:04:44.810 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:04:44.811 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 30.3809ms
2025-07-03 10:04:44.817 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:04:44.819 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:44.820 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:44.822 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:44.823 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6556ms
2025-07-03 10:04:44.824 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:44.825 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.0621ms
2025-07-03 10:04:45.140 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:04:45.143 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:45.144 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:04:45.148 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:04:45.150 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:04:45.152 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:04:45.153 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:04:45.154 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:04:45.154 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:04:45.155 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:04:45.155 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:04:45.156 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:04:45.156 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:04:45.157 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:04:45.158 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:04:45.158 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:04:45.159 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:04:45.159 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:04:45.160 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:04:45.161 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 15.9842ms
2025-07-03 10:04:45.162 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:45.163 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 22.2999ms
2025-07-03 10:04:49.028 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:04:49.028 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:04:49.030 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:49.032 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:49.033 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:04:49.034 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:04:49.035 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:04:49.035 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:04:49.038 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:04:49.042 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:04:49.044 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:04:49.051 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:04:49.054 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:04:49.056 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:04:49.058 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:04:49.059 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 21.9219ms
2025-07-03 10:04:49.060 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:04:49.061 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 32.6761ms
2025-07-03 10:04:49.695 +05:30 [INF] Received HTTP response headers after 640.1319ms - 200
2025-07-03 10:04:49.696 +05:30 [INF] End processing HTTP request after 644.9202ms - 200
2025-07-03 10:04:49.704 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=yYqnNNN_XPGC85TJZXjMKA&oh=01_Q5Aa1wHJBmsUaplOQy397o59uoRWC7bWXKzr4uLtJMEbeNl5sw&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:04:49.707 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:49.708 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 670.0511ms
2025-07-03 10:04:49.709 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:04:49.710 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 682.3114ms
2025-07-03 10:04:57.573 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:04:57.575 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:57.576 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.6057ms
2025-07-03 10:04:57.578 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:04:57.581 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:57.582 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:04:57.583 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:04:57.587 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:57.588 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3.7924ms
2025-07-03 10:04:57.589 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:04:57.590 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 11.8548ms
2025-07-03 10:04:57.592 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:04:57.594 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:57.595 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.7849ms
2025-07-03 10:04:57.596 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:04:57.599 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:04:57.600 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 3.2439ms
2025-07-03 10:04:57.602 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:04:57.742 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:04:57.745 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:57.746 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:04:57.747 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:04:57.748 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.5177ms
2025-07-03 10:04:57.749 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:04:57.750 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.8522ms
2025-07-03 10:04:57.915 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:04:57.918 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:57.919 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:04:57.923 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:04:57.926 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:04:57.929 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:04:57.931 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:04:57.931 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:04:57.932 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:04:57.932 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:04:57.933 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:04:57.933 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:04:57.934 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:04:57.934 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:04:57.935 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:04:57.935 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:04:57.936 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:04:57.936 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:04:57.937 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:04:57.938 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.8755ms
2025-07-03 10:04:57.939 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:04:57.940 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 24.7341ms
2025-07-03 10:05:05.081 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:05:05.084 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:05.085 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.6886ms
2025-07-03 10:05:05.087 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:05:05.091 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:05.092 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:05:05.093 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:05.094 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:05:05.097 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:05:05.100 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:05:05.103 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:05:05.106 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:05:05.109 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:05:05.111 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:05:05.112 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:05:05.113 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:05.114 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 20.4473ms
2025-07-03 10:05:05.115 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:05:05.116 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 29.6454ms
2025-07-03 10:05:05.121 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:05:05.124 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:05.125 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:05.126 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:05.127 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3859ms
2025-07-03 10:05:05.128 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:05.129 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.9145ms
2025-07-03 10:05:05.134 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:05:05.136 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:05.137 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:05:05.140 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:05:05.143 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:05:05.144 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:05:05.146 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:05:05.146 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:05:05.147 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:05:05.147 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:05:05.148 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:05:05.149 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:05:05.149 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:05:05.150 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:05:05.150 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:05:05.151 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:05:05.151 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:05:05.152 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:05:05.153 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:05:05.154 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 15.762ms
2025-07-03 10:05:05.154 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:05.156 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 21.7229ms
2025-07-03 10:05:05.400 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:05:05.403 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:05.404 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:05:05.406 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:05:05.406 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:05:05.408 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:05.409 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:05:05.410 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:05:05.412 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:05:05.413 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:05:05.417 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:05:05.421 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:05:05.421 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:05:05.423 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:05:05.424 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:05:05.425 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 15.8528ms
2025-07-03 10:05:05.427 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:05:05.428 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 28.3253ms
2025-07-03 10:05:06.068 +05:30 [INF] Received HTTP response headers after 642.6052ms - 200
2025-07-03 10:05:06.070 +05:30 [INF] End processing HTTP request after 648.6666ms - 200
2025-07-03 10:05:06.074 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=BWItlcZ2-_x5kHRhMsqh8Q&oh=01_Q5Aa1wH7NwLv989dFTh89CCj6t2d8-4NbS0nhUOod1Xh7YoyJA&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:05:06.076 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:06.077 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 662.1502ms
2025-07-03 10:05:06.079 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:05:06.079 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 673.7934ms
2025-07-03 10:05:15.041 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:05:15.043 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:15.044 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.2803ms
2025-07-03 10:05:15.046 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:05:15.049 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:15.050 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:05:15.051 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:05:15.053 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:15.054 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 1.6671ms
2025-07-03 10:05:15.055 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:05:15.056 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 10.0084ms
2025-07-03 10:05:15.058 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:05:15.060 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:15.060 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.777ms
2025-07-03 10:05:15.061 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:05:15.065 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:15.066 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 4.4137ms
2025-07-03 10:05:15.069 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:05:15.468 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:05:15.473 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:15.474 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:15.477 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:15.479 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.5805ms
2025-07-03 10:05:15.480 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:15.481 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 13.2585ms
2025-07-03 10:05:15.511 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:05:15.515 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:15.516 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:05:15.520 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:05:15.525 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:05:15.528 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:05:15.530 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:05:15.531 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:05:15.532 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:05:15.533 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:05:15.533 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:05:15.534 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:05:15.535 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:05:15.536 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:05:15.537 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:05:15.537 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:05:15.538 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:05:15.539 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:05:15.540 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:05:15.541 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 23.7702ms
2025-07-03 10:05:15.543 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:15.544 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 33.1588ms
2025-07-03 10:05:27.118 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:05:27.121 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:27.122 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.3878ms
2025-07-03 10:05:27.124 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:05:27.126 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:27.127 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:05:27.128 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:27.130 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:05:27.132 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:05:27.136 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:05:27.139 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:05:27.141 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:05:27.144 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:05:27.146 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:05:27.146 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:05:27.147 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:27.148 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 19.1916ms
2025-07-03 10:05:27.149 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:05:27.150 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 26.0089ms
2025-07-03 10:05:27.156 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:05:27.158 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:27.159 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:27.161 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:27.162 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.5688ms
2025-07-03 10:05:27.163 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:27.164 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.1522ms
2025-07-03 10:05:27.169 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:05:27.171 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:27.172 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:05:27.175 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:05:27.178 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:05:27.180 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:05:27.181 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:05:27.181 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:05:27.182 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:05:27.182 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:05:27.183 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:05:27.183 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:05:27.184 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:05:27.184 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:05:27.185 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:05:27.185 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:05:27.186 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:05:27.186 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:05:27.187 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:05:27.188 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 15.0478ms
2025-07-03 10:05:27.190 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:27.191 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 21.7136ms
2025-07-03 10:05:27.440 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:05:27.441 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:05:27.443 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:27.444 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:27.445 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:05:27.446 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:05:27.446 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:05:27.447 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:05:27.449 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:05:27.452 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:05:27.456 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:05:27.458 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:05:27.461 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:05:27.461 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:05:27.465 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:05:27.466 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 17.2476ms
2025-07-03 10:05:27.467 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:05:27.467 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 27.2715ms
2025-07-03 10:05:28.126 +05:30 [INF] Received HTTP response headers after 663.8558ms - 200
2025-07-03 10:05:28.127 +05:30 [INF] End processing HTTP request after 669.2432ms - 200
2025-07-03 10:05:28.129 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=mDR9cqfbAJBRrsfHRBXdxQ&oh=01_Q5Aa1wFkQQoYIwVR74Cds4-sUF69uVzdn3qnryIC6_iEaF7mOg&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:05:28.131 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:28.132 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 681.7076ms
2025-07-03 10:05:28.132 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:05:28.133 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 692.6584ms
2025-07-03 10:05:37.111 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:05:37.114 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:37.115 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.6862ms
2025-07-03 10:05:37.116 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:05:37.120 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:37.121 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:05:37.121 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:05:37.123 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:37.124 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 1.4901ms
2025-07-03 10:05:37.125 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:05:37.126 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 9.8122ms
2025-07-03 10:05:37.128 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:05:37.131 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:37.132 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 3.3835ms
2025-07-03 10:05:37.133 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:05:37.136 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:05:37.137 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 3.7222ms
2025-07-03 10:05:37.139 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:05:37.540 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:05:37.543 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:37.544 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:05:37.546 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:05:37.547 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3464ms
2025-07-03 10:05:37.548 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:05:37.549 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.2362ms
2025-07-03 10:05:37.567 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:05:37.571 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:37.572 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:05:37.576 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:05:37.580 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:05:37.582 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:05:37.584 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:05:37.585 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:05:37.585 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:05:37.586 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:05:37.586 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:05:37.587 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:05:37.588 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:05:37.588 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:05:37.589 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:05:37.589 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:05:37.590 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:05:37.591 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:05:37.592 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:05:37.593 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 19.3435ms
2025-07-03 10:05:37.594 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:05:37.595 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 28.1674ms
2025-07-03 10:09:20.029 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:09:20.031 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:20.032 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.2865ms
2025-07-03 10:09:20.034 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:09:20.037 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:20.039 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:09:20.040 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:09:20.042 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:09:20.102 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:09:20.106 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:09:20.108 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:09:20.111 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:09:20.114 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:09:20.116 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:09:20.117 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:09:20.118 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:09:20.119 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 78.1664ms
2025-07-03 10:09:20.120 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:09:20.121 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 87.4259ms
2025-07-03 10:09:20.127 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:09:20.130 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:09:20.131 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:09:20.133 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:09:20.134 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6695ms
2025-07-03 10:09:20.135 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:09:20.136 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.6591ms
2025-07-03 10:09:20.448 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:09:20.451 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:09:20.452 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:09:20.456 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:09:20.460 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:09:20.462 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:09:20.464 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:09:20.464 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:09:20.465 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:09:20.465 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:09:20.466 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:09:20.467 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:09:20.467 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:09:20.468 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:09:20.468 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:09:20.469 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:09:20.469 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:09:20.470 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:09:20.471 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:09:20.472 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.9383ms
2025-07-03 10:09:20.473 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:09:20.474 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.6866ms
2025-07-03 10:09:20.720 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:09:20.720 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:09:20.723 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:20.725 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:20.726 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:09:20.726 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:09:20.727 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:09:20.728 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:09:20.730 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:09:20.734 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:09:20.744 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:09:20.749 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:09:20.798 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:09:20.804 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:09:20.807 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:09:20.809 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 78.8445ms
2025-07-03 10:09:20.810 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:09:20.811 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 90.7151ms
2025-07-03 10:09:21.544 +05:30 [INF] Received HTTP response headers after 793.7343ms - 200
2025-07-03 10:09:21.546 +05:30 [INF] End processing HTTP request after 801.3026ms - 200
2025-07-03 10:09:21.548 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=fY3gj1U_cQf6bEx-Mdyjsw&oh=01_Q5Aa1wFWEDnCEhHrnFqOWk61Mp0Nd9e-id3WT3GHvMKuYMaT5w&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:09:21.551 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:09:21.552 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 820.8817ms
2025-07-03 10:09:21.553 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:09:21.554 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 834.0169ms
2025-07-03 10:09:36.373 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/app/messaging/[HttpPost("send-image-template")]    public async Task<IActionResult> SendImageTemplateMessage([FromBody] ImageTemplateMessageDto dto)    {        / Extract BusinessId from claims (assuming it's saved as "BusinessId" claim)        var businessIdClaim = User.Claims.FirstOrDefault(c => c.Type == "BusinessId")?.Value;%20%20%20%20%20%20%20%20if%20(string.IsNullOrEmpty(businessIdClaim)%20||%20!Guid.TryParse(businessIdClaim,%20out%20var%20businessId))%20%20%20%20%20%20%20%20%20%20%20%20return%20Unauthorized(new%20{%20message%20=%20%22BusinessId%20not%20found%20in%20user%20claims.%22%20});%20%20%20%20%20%20%20%20%20//%20Pass%20businessId%20explicitly%20to%20the%20service%20%20%20%20%20%20%20%20var%20result%20=%20await%20_messageEngineService.SendImageTemplateMessageAsync(dto,%20businessId);%20%20%20%20%20%20%20%20%20if%20(result.Success)%20%20%20%20%20%20%20%20%20%20%20%20return%20Ok(new%20{%20message%20=%20result.Message,%20raw%20=%20result.RawResponse%20});%20%20%20%20%20%20%20%20%20return%20BadRequest(new%20{%20message%20=%20result.Message,%20raw%20=%20result.RawResponse%20});%20%20%20%20} - null null
2025-07-03 10:09:36.376 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/app/messaging/[HttpPost("send-image-template")]    public async Task<IActionResult> SendImageTemplateMessage([FromBody] ImageTemplateMessageDto dto)    {        / Extract BusinessId from claims (assuming it's saved as "BusinessId" claim)        var businessIdClaim = User.Claims.FirstOrDefault(c => c.Type == "BusinessId")?.Value;%20%20%20%20%20%20%20%20if%20(string.IsNullOrEmpty(businessIdClaim)%20||%20!Guid.TryParse(businessIdClaim,%20out%20var%20businessId))%20%20%20%20%20%20%20%20%20%20%20%20return%20Unauthorized(new%20{%20message%20=%20%22BusinessId%20not%20found%20in%20user%20claims.%22%20});%20%20%20%20%20%20%20%20%20//%20Pass%20businessId%20explicitly%20to%20the%20service%20%20%20%20%20%20%20%20var%20result%20=%20await%20_messageEngineService.SendImageTemplateMessageAsync(dto,%20businessId);%20%20%20%20%20%20%20%20%20if%20(result.Success)%20%20%20%20%20%20%20%20%20%20%20%20return%20Ok(new%20{%20message%20=%20result.Message,%20raw%20=%20result.RawResponse%20});%20%20%20%20%20%20%20%20%20return%20BadRequest(new%20{%20message%20=%20result.Message,%20raw%20=%20result.RawResponse%20});%20%20%20%20} - 404 0 null 3.5539ms
2025-07-03 10:09:36.379 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:7113/app/messaging/%5BHttpPost(%22send-image-template%22)%5D%20%20%20%20public%20async%20Task%3CIActionResult%3E%20SendImageTemplateMessage(%5BFromBody%5D%20ImageTemplateMessageDto%20dto)%20%20%20%20%7B%20%20%20%20%20%20%20%20/%20Extract%20BusinessId%20from%20claims%20(assuming%20it's%20saved%20as%20%22BusinessId%22%20claim)%20%20%20%20%20%20%20%20var%20businessIdClaim%20=%20User.Claims.FirstOrDefault(c%20=%3E%20c.Type%20==%20%22BusinessId%22), Response status code: 404
2025-07-03 10:09:48.352 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:09:48.355 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:48.356 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 4.2533ms
2025-07-03 10:09:48.358 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:09:48.362 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:48.363 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:09:48.364 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:09:48.366 +05:30 [INF] Executing UnauthorizedObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:09:48.367 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 1.7938ms
2025-07-03 10:09:48.368 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:09:48.369 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 401 null application/json; charset=utf-8 11.5836ms
2025-07-03 10:09:48.373 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 10:09:48.375 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:48.375 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.8384ms
2025-07-03 10:09:48.377 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 10:09:48.381 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:09:48.382 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 404 0 null 4.8791ms
2025-07-03 10:09:48.384 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 404
2025-07-03 10:09:49.122 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:09:49.125 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:09:49.126 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:09:49.136 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:09:49.138 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.0129ms
2025-07-03 10:09:49.139 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:09:49.141 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 19.4231ms
2025-07-03 10:09:49.245 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:09:49.251 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:09:49.253 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:09:49.260 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:09:49.265 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:09:49.270 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:09:49.273 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:09:49.274 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:09:49.275 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:09:49.276 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:09:49.277 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:09:49.278 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:09:49.279 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:09:49.280 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:09:49.281 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:09:49.283 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:09:49.284 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:09:49.285 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:09:49.287 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:09:49.289 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 33.2688ms
2025-07-03 10:09:49.290 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:09:49.292 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 46.4014ms
2025-07-03 10:12:29.006 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-03 10:12:29.047 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-03 10:12:29.063 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-03 10:12:29.809 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-03 10:12:30.232 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-03 10:12:30.392 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-03 10:12:30.393 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-03 10:12:30.394 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-03 10:12:30.395 +05:30 [INF] Hosting environment: Development
2025-07-03 10:12:30.395 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-03 10:12:30.406 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-03 10:12:30.423 +05:30 [INF] Executed DbCommand (38ms) [Parameters=[@__cutoff_0='2025-06-26T04:42:29.1835203Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-03 10:12:32.542 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 10:12:32.711 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 175.4238ms
2025-07-03 10:12:32.724 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 10:12:32.732 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.1062ms
2025-07-03 10:12:32.786 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 10:12:32.827 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 41.519ms
2025-07-03 10:12:32.965 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 10:12:33.148 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 182.5696ms
2025-07-03 10:12:53.468 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 10:12:53.474 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-03 10:12:53.477 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:12:53.481 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 13.0363ms
2025-07-03 10:12:53.484 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 10:12:53.493 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:12:53.589 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:12:53.602 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:12:53.661 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 10:12:53.735 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 10:12:53.817 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 10:12:53.891 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 10:12:53.910 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 10:12:53.982 +05:30 [INF] Executed DbCommand (40ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 10:12:54.001 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 10:12:54.006 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 10:12:54.012 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:12:54.027 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 420.6848ms
2025-07-03 10:12:54.029 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 10:12:54.035 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 551.8066ms
2025-07-03 10:12:54.341 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:12:54.349 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:12:54.351 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:12:54.356 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:12:54.358 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 5.5351ms
2025-07-03 10:12:54.359 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:12:54.360 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 18.9298ms
2025-07-03 10:12:54.598 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:12:54.604 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:12:54.607 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:12:54.621 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:12:54.625 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:12:54.632 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:12:54.646 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:12:54.647 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:12:54.647 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:12:54.648 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:12:54.649 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:12:54.649 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:12:54.650 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:12:54.650 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:12:54.651 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:12:54.652 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:12:54.652 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:12:54.653 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:12:54.657 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:12:54.663 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 54.185ms
2025-07-03 10:12:54.664 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:12:54.665 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 66.6561ms
2025-07-03 10:12:54.926 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 10:12:54.927 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:12:54.932 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:12:54.936 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:12:54.937 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:12:54.938 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:12:54.945 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:12:54.946 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:12:54.961 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 10:12:54.985 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:12:54.995 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:12:55.015 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:12:55.018 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:12:55.068 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:12:55.133 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:12:55.147 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 197.8959ms
2025-07-03 10:12:55.149 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:12:55.150 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 223.8104ms
2025-07-03 10:12:55.958 +05:30 [INF] Received HTTP response headers after 936.8735ms - 200
2025-07-03 10:12:55.961 +05:30 [INF] End processing HTTP request after 947.205ms - 200
2025-07-03 10:12:55.963 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=JD4oZMu-uHWn_58xZmJM0Q&oh=01_Q5Aa1wG7AG4BRtQFOeMeue4P2C-jGwbMlp7bybMNAPTZ6p7fkg&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:12:56.090 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:12:56.095 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1147.8237ms
2025-07-03 10:12:56.096 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:12:56.098 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1170.6326ms
2025-07-03 10:13:14.904 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:13:14.907 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:13:14.909 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 4.2711ms
2025-07-03 10:13:14.910 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 10:13:14.916 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:13:14.917 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:13:14.920 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:13:25.520 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:13:35.505 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:13:35.509 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:13:37.098 +05:30 [INF] Received HTTP response headers after 1586.7171ms - 200
2025-07-03 10:13:37.099 +05:30 [INF] End processing HTTP request after 1593.9844ms - 200
2025-07-03 10:13:43.253 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='833431ff-d974-4b72-9e49-db416282227f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:43:43.1396370Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T04:43:43.1396848Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:13:43.262 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:13:43.264 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 28341.6942ms
2025-07-03 10:13:43.265 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:13:43.265 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 28355.7794ms
2025-07-03 10:13:43.269 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 10:13:43.270 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:13:43.271 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 2.1714ms
2025-07-03 10:13:43.272 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 315
2025-07-03 10:13:43.274 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:13:43.275 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:13:43.276 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:13:43.924 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:13:43.925 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:13:44.715 +05:30 [INF] Received HTTP response headers after 789.6901ms - 200
2025-07-03 10:13:44.716 +05:30 [INF] End processing HTTP request after 792.5489ms - 200
2025-07-03 10:13:44.739 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='92a05af2-ae40-470f-b05d-fb81ffa494db', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T04:43:44.7186191Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T04:43:44.7186193Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:13:44.741 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:13:44.742 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 1464.8451ms
2025-07-03 10:13:44.743 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 10:13:44.744 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 1472.4426ms
2025-07-03 10:24:53.169 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-03 10:24:53.172 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:24:53.174 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:24:53.183 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:24:53.262 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-03 10:24:53.272 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-03 10:24:53.275 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:24:53.280 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 95.3232ms
2025-07-03 10:24:53.281 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:24:53.282 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 113.1678ms
2025-07-03 10:25:11.876 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:25:11.881 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:25:11.882 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:25:11.887 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:25:11.914 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:25:11.917 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:25:11.918 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 28.7874ms
2025-07-03 10:25:11.919 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:25:11.920 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 44.1038ms
2025-07-03 10:25:31.167 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/d0f71321-88d2-4b99-91e0-5b5f0174400f - null 0
2025-07-03 10:25:31.170 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:25:31.172 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:25:31.176 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:25:31.203 +05:30 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-07-03 10:25:31.231 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@__campaignId_0='d0f71321-88d2-4b99-91e0-5b5f0174400f'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 10:25:31.297 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:25:31.299 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:25:31.300 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:25:32.745 +05:30 [INF] Received HTTP response headers after 1443.7449ms - 200
2025-07-03 10:25:32.746 +05:30 [INF] End processing HTTP request after 1447.0479ms - 200
2025-07-03 10:25:32.750 +05:30 [ERR] ❌ Could not fetch template metadata for null.
2025-07-03 10:25:32.754 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:25:32.755 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 1577.2215ms
2025-07-03 10:25:32.756 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:25:32.757 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/d0f71321-88d2-4b99-91e0-5b5f0174400f - 400 null application/json; charset=utf-8 1590.5209ms
2025-07-03 10:26:29.612 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:26:29.615 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:26:29.616 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:26:29.617 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:26:29.628 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:26:29.635 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:26:29.636 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 17.4413ms
2025-07-03 10:26:29.637 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:26:29.638 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 26.7496ms
2025-07-03 10:26:35.962 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:26:35.964 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:26:35.966 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:26:35.967 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:26:35.973 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:26:35.976 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:26:35.978 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 9.5831ms
2025-07-03 10:26:35.980 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:26:35.981 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 19.0489ms
2025-07-03 10:30:44.202 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 10:30:44.206 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:30:44.207 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 10:30:44.212 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:30:44.213 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 4.5816ms
2025-07-03 10:30:44.214 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 10:30:44.215 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 14.9727ms
2025-07-03 10:30:44.255 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 10:30:44.259 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:30:44.261 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 10:30:44.323 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:30:44.326 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 10:30:44.328 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 10:30:44.330 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 10:30:44.331 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 10:30:44.332 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 10:30:44.332 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 10:30:44.333 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 10:30:44.333 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 10:30:44.334 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 10:30:44.334 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 10:30:44.335 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 10:30:44.335 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 10:30:44.336 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 10:30:44.336 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 10:30:44.338 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:30:44.339 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 76.6222ms
2025-07-03 10:30:44.340 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 10:30:44.341 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 85.5501ms
2025-07-03 10:30:46.298 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 10:30:46.301 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:30:46.302 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:30:46.303 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:30:46.318 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 10:30:46.320 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:30:46.321 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 16.0625ms
2025-07-03 10:30:46.322 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:30:46.323 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 24.7725ms
2025-07-03 10:31:17.008 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/ba36287b-8233-4a42-af9d-60274555b00f - null 0
2025-07-03 10:31:17.011 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:31:17.012 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:31:17.015 +05:30 [INF] Route matched with {action = "SendImageCampaign", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageCampaign(System.Guid) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:31:36.578 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='ba36287b-8233-4a42-af9d-60274555b00f', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."CampaignId", c0."IsFromTemplate", c0."Position", c0."Title", c0."Type", c0."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 10:31:38.731 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='ba36287b-8233-4a42-af9d-60274555b00f', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BotId", c."BusinessId", c."CampaignId", c."CategoryBrowsed", c."ClickedCTA", c."ContactId", c."IsAutoTagged", c."MessagePreview", c."ProductBrowsed", c."SentAt", c."Status", c."UpdatedAt", c0."Id", c0."AssignedAgentId", c0."BusinessId", c0."CreatedAt", c0."Email", c0."Group", c0."IsActive", c0."IsArchived", c0."IsAutomationPaused", c0."IsFavorite", c0."LastCTAInteraction", c0."LastCTAType", c0."LastClickedProductId", c0."LastContactedAt", c0."LeadSource", c0."Name", c0."NextFollowUpAt", c0."Notes", c0."PhoneNumber", c0."Tags"
FROM "CampaignRecipients" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
2025-07-03 10:31:54.192 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:31:54.194 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api) in 37177.0675ms
2025-07-03 10:31:54.195 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:31:54.196 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/ba36287b-8233-4a42-af9d-60274555b00f - 400 null application/json; charset=utf-8 37187.9186ms
2025-07-03 10:32:07.130 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/d0f71321-88d2-4b99-91e0-5b5f0174400f - null 0
2025-07-03 10:32:07.133 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:32:07.133 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:32:07.134 +05:30 [INF] Route matched with {action = "SendImageCampaign", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageCampaign(System.Guid) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:32:11.737 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='d0f71321-88d2-4b99-91e0-5b5f0174400f', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."CampaignId", c0."IsFromTemplate", c0."Position", c0."Title", c0."Type", c0."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 10:32:11.743 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='d0f71321-88d2-4b99-91e0-5b5f0174400f', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BotId", c."BusinessId", c."CampaignId", c."CategoryBrowsed", c."ClickedCTA", c."ContactId", c."IsAutoTagged", c."MessagePreview", c."ProductBrowsed", c."SentAt", c."Status", c."UpdatedAt", c0."Id", c0."AssignedAgentId", c0."BusinessId", c0."CreatedAt", c0."Email", c0."Group", c0."IsActive", c0."IsArchived", c0."IsAutomationPaused", c0."IsFavorite", c0."LastCTAInteraction", c0."LastCTAType", c0."LastClickedProductId", c0."LastContactedAt", c0."LeadSource", c0."Name", c0."NextFollowUpAt", c0."Notes", c0."PhoneNumber", c0."Tags"
FROM "CampaignRecipients" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
2025-07-03 10:32:12.392 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:32:12.397 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:32:12.398 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:32:13.769 +05:30 [INF] Received HTTP response headers after 1370.4361ms - 200
2025-07-03 10:32:13.771 +05:30 [INF] End processing HTTP request after 1373.9011ms - 200
2025-07-03 10:32:13.819 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='e621b8f0-eee4-4a5f-9670-46e1cafd4013', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:02:13.7735259Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:', @p16='2025-07-03T05:02:13.7735261Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:32:13.876 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@p0='5a811837-0dfc-48cd-95ed-97c494ad00be', @p1='True', @p2=NULL, @p3='c13be597-6ae2-42bb-9d43-925815f24ff8', @p4='d0f71321-88d2-4b99-91e0-5b5f0174400f', @p5=NULL, @p6=NULL, @p7=NULL (DbType = DateTime), @p8='8aac7c57-6699-4511-897b-4121b407eb1c', @p9=NULL, @p10='2025-07-03T05:02:13.8224896Z' (DbType = DateTime), @p11='Unknown', @p12=NULL (DbType = DateTime), @p13=NULL, @p14=NULL, @p15=NULL, @p16=NULL, @p17='False', @p18=NULL (DbType = DateTime), @p19=NULL, @p20=NULL, @p21='' (Nullable = false), @p22=NULL, @p23='e621b8f0-eee4-4a5f-9670-46e1cafd4013' (Nullable = true), @p24=NULL (DbType = DateTime), @p25='c05cab06-f4d9-4175-bf4c-2b2fdab36f18', @p26='0', @p27='Sent', @p28='2025-07-03T05:02:13.8229875Z' (Nullable = true) (DbType = DateTime), @p29=NULL, @p30=NULL, @p31=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-07-03 10:32:13.880 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:32:13.881 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api) in 6745.3296ms
2025-07-03 10:32:13.882 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:32:13.883 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/d0f71321-88d2-4b99-91e0-5b5f0174400f - 200 null application/json; charset=utf-8 6752.3254ms
2025-07-03 10:32:51.771 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/recipients/d0f71321-88d2-4b99-91e0-5b5f0174400f - null null
2025-07-03 10:32:51.774 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:32:51.776 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api)'
2025-07-03 10:32:51.781 +05:30 [INF] Route matched with {action = "GetCampaignRecipients", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCampaignRecipients(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:32:51.794 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='d0f71321-88d2-4b99-91e0-5b5f0174400f', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c0."Id", c0."Name", c0."PhoneNumber", c0."Email", c0."LeadSource", c0."CreatedAt"
FROM "CampaignRecipients" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0 AND c0."BusinessId" = @__businessId_1
2025-07-03 10:32:51.802 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:32:51.803 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api) in 20.4032ms
2025-07-03 10:32:51.805 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api)'
2025-07-03 10:32:51.806 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/recipients/d0f71321-88d2-4b99-91e0-5b5f0174400f - 200 null application/json; charset=utf-8 34.9092ms
2025-07-03 10:32:54.268 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 10:32:54.270 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:32:54.271 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:32:54.272 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:32:54.278 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 10:32:54.281 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:32:54.282 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.6899ms
2025-07-03 10:32:54.283 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:32:54.284 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 16.897ms
2025-07-03 10:34:31.011 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:34:31.014 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:34:31.016 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:34:31.016 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:34:31.022 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:34:31.031 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:34:31.033 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 14.7167ms
2025-07-03 10:34:31.034 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:34:31.035 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 23.9652ms
2025-07-03 10:36:41.479 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:36:41.486 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:36:41.487 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:36:41.488 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:36:41.555 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:36:41.557 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:36:41.558 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:36:42.936 +05:30 [INF] Received HTTP response headers after 1376.8461ms - 200
2025-07-03 10:36:42.938 +05:30 [INF] End processing HTTP request after 1380.7849ms - 200
2025-07-03 10:36:42.939 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=rRDaPoG9uh5Hf1dgzknq7A&oh=01_Q5Aa1wF0e8CWQpU8qnkUeAagCkPf-X4_roC74TZKY9oWd0Sjrw&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:36:42.942 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:36:42.944 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1454.3155ms
2025-07-03 10:36:42.946 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:36:42.947 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1468.6899ms
2025-07-03 10:36:54.688 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:36:54.690 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:36:54.692 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:36:54.693 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:36:54.698 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:36:54.702 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:36:54.703 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:36:55.431 +05:30 [INF] Received HTTP response headers after 727.02ms - 200
2025-07-03 10:36:55.432 +05:30 [INF] End processing HTTP request after 730.3421ms - 200
2025-07-03 10:36:55.440 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=WvZGAqY3O-KAd_1m7nFf2w&oh=01_Q5Aa1wGHNlqObnlIgzQgwyIdE_t-K75rDBDJ1FmoD-VDAgMJag&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:36:55.442 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:36:55.443 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 748.3783ms
2025-07-03 10:36:55.444 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:36:55.445 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 757.8651ms
2025-07-03 10:38:01.630 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - null null
2025-07-03 10:38:01.632 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:01.633 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - 204 null null 3.7402ms
2025-07-03 10:38:01.636 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - application/json 434
2025-07-03 10:38:01.642 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:01.643 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 10:38:01.647 +05:30 [INF] Route matched with {action = "CreateTextCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTextCampaign(xbytechat.api.Features.CampaignModule.DTOs.CampaignCreateDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:03.071 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:38:03.074 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:38:03.075 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:38:04.367 +05:30 [INF] Received HTTP response headers after 1290.0848ms - 200
2025-07-03 10:38:04.368 +05:30 [INF] End processing HTTP request after 1294.1714ms - 200
2025-07-03 10:38:04.393 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='dcd9556d-34c9-43e8-a6c1-99319269a829', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3='image', @p4='2025-07-03T05:08:04.3725132Z' (DbType = DateTime), @p5='system', @p6=NULL (DbType = Guid), @p7=NULL (DbType = DateTime), @p8=NULL, @p9=NULL, @p10=NULL, @p11='https://picsum.photos/200/300', @p12='False', @p13='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:', @p14='imagecampaign' (Nullable = false), @p15='ImageCampaign 001' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL (DbType = Guid), @p18='Draft' (Nullable = false), @p19='imagecampaign', @p20='[]', @p21='2025-07-03T05:08:04.3725957Z' (DbType = DateTime), @p22='06f064c4-56c4-4e8c-baa4-a4b6579b7dbc', @p23='dcd9556d-34c9-43e8-a6c1-99319269a829', @p24='True', @p25='1', @p26='Visit website' (Nullable = false), @p27='URL' (Nullable = false), @p28='https://www.myntra.com/men-sweatshirts' (Nullable = false), @p29='1d474594-f65c-41b1-9207-546dcb2af5c8', @p30='dcd9556d-34c9-43e8-a6c1-99319269a829', @p31='True', @p32='2', @p33='Call Us' (Nullable = false), @p34='PHONE_NUMBER' (Nullable = false), @p35='+918765436785' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Campaigns" ("Id", "BusinessId", "CampaignId", "CampaignType", "CreatedAt", "CreatedBy", "CtaId", "DeletedAt", "DeletedBy", "FollowUpTemplateId", "ImageCaption", "ImageUrl", "IsDeleted", "MessageBody", "MessageTemplate", "Name", "ScheduledAt", "SourceCampaignId", "Status", "TemplateId", "TemplateParameters", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p22, @p23, @p24, @p25, @p26, @p27, @p28);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p29, @p30, @p31, @p32, @p33, @p34, @p35);
2025-07-03 10:38:04.405 +05:30 [INF] ✅ Campaign 'ImageCampaign 001' created with 0 recipients, 0 user buttons, 2 template buttons and 0 template parameters
2025-07-03 10:38:04.407 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:38:04.410 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api) in 2761.7217ms
2025-07-03 10:38:04.411 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 10:38:04.412 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - 200 null application/json; charset=utf-8 2776.7956ms
2025-07-03 10:38:04.452 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 10:38:04.453 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - null null
2025-07-03 10:38:04.453 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - null null
2025-07-03 10:38:04.460 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:04.463 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:04.465 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:04.466 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:38:04.467 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:38:04.467 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 10:38:04.469 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:38:04.472 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 10:38:04.474 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=1000
2025-07-03 10:38:04.475 +05:30 [INF] Route matched with {action = "GetCampaignById", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignModule.DTOs.CampaignDto]] GetCampaignById(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:04.481 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:38:04.497 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='100', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:38:04.508 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:38:04.511 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 38.6796ms
2025-07-03 10:38:04.513 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:38:04.514 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - 200 null application/json; charset=utf-8 61.2372ms
2025-07-03 10:38:04.524 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t."Id0", t."BusinessId0", t."ButtonText", t."ButtonType", t."CreatedAt0", t."Description", t."IsActive", t."TargetUrl", t."Title", t."UpdatedAt0", c1."Id", c1."CampaignId", c1."IsFromTemplate", c1."Position", c1."Title", c1."Type", c1."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt", c0."Id" AS "Id0", c0."BusinessId" AS "BusinessId0", c0."ButtonText", c0."ButtonType", c0."CreatedAt" AS "CreatedAt0", c0."Description", c0."IsActive", c0."TargetUrl", c0."Title", c0."UpdatedAt" AS "UpdatedAt0"
    FROM "Campaigns" AS c
    LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c1 ON t."Id" = c1."CampaignId"
ORDER BY t."Id", t."Id0"
2025-07-03 10:38:04.537 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignModule.DTOs.CampaignDto'.
2025-07-03 10:38:04.543 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api) in 56.8272ms
2025-07-03 10:38:04.545 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 10:38:04.546 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - 200 null application/json; charset=utf-8 93.3725ms
2025-07-03 10:38:04.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 10:38:04.581 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:38:04.585 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 109.6163ms
2025-07-03 10:38:04.586 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 10:38:04.587 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:38:04.589 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:04.589 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 137.5295ms
2025-07-03 10:38:04.590 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:38:04.594 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 10:38:04.598 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 10:38:04.601 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:38:04.602 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 6.8987ms
2025-07-03 10:38:04.604 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:38:04.605 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 18.3853ms
2025-07-03 10:38:10.089 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829/assign-contacts - null null
2025-07-03 10:38:10.092 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:10.092 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829/assign-contacts - 204 null null 3.2712ms
2025-07-03 10:38:10.094 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829/assign-contacts - application/json 55
2025-07-03 10:38:10.097 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:10.098 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 10:38:10.101 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:11.378 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 10:38:11.405 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='955b5afd-c985-4110-abd1-17c9c5f73c50', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='dcd9556d-34c9-43e8-a6c1-99319269a829', @p4=NULL, @p5=NULL, @p6='80c43c6a-508b-47ff-9360-201bfd5521d3', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-03T05:08:11.3826588Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-03T05:08:11.3827060Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
2025-07-03 10:38:11.408 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:38:11.410 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 1307.2907ms
2025-07-03 10:38:11.411 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 10:38:11.412 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/dcd9556d-34c9-43e8-a6c1-99319269a829/assign-contacts - 200 null application/json; charset=utf-8 1318.3313ms
2025-07-03 10:38:19.380 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:38:19.383 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:19.384 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:38:19.385 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:19.390 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:38:19.393 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:38:19.394 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.4772ms
2025-07-03 10:38:19.395 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:38:19.396 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 16.3043ms
2025-07-03 10:38:23.580 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - null 0
2025-07-03 10:38:23.583 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:23.584 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:38:23.586 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:23.592 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 10:38:23.596 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:38:23.598 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:38:23.598 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:38:24.483 +05:30 [INF] Received HTTP response headers after 884.1806ms - 200
2025-07-03 10:38:24.485 +05:30 [INF] End processing HTTP request after 887.3763ms - 200
2025-07-03 10:38:24.487 +05:30 [INF] 📨 Preparing to send to 447543746206
2025-07-03 10:38:28.558 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (url)
2025-07-03 10:38:28.562 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (voice_call)
2025-07-03 10:38:28.567 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:38:28.569 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:38:28.570 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:38:29.415 +05:30 [INF] Received HTTP response headers after 844.2577ms - 400
2025-07-03 10:38:29.416 +05:30 [INF] End processing HTTP request after 847.1593ms - 400
2025-07-03 10:38:29.418 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) Invalid parameter\",\"type\":\"OAuthException\",\"code\":100,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"buttons: Button at index 0 of type Url does not require parameters\"},\"fbtrace_id\":\"A9TU4uTbuq4QYdiS0y937xx\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:38:29.420 +05:30 [INF] 📥 MessageLog saved for 447543746206
2025-07-03 10:38:29.422 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "955b5afd-c985-4110-abd1-17c9c5f73c50"
2025-07-03 10:38:29.423 +05:30 [INF] 💾 Saving all DB changes...
2025-07-03 10:38:29.451 +05:30 [INF] Executed DbCommand (25ms) [Parameters=[@p0='abbb16c7-f4a4-47d1-b0d4-de7f910df383', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='dcd9556d-34c9-43e8-a6c1-99319269a829' (Nullable = true), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:08:29.4194019Z' (DbType = DateTime), @p7='API returned error', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"buttons: Button at index 0 of type Url does not require parameters"},"fbtrace_id":"A9TU4uTbuq4QYdiS0y937xx"}}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false), @p19='28302c4f-5851-49b7-a3ff-1e43a5aa2656', @p20='True', @p21=NULL, @p22='c13be597-6ae2-42bb-9d43-925815f24ff8', @p23='dcd9556d-34c9-43e8-a6c1-99319269a829', @p24=NULL, @p25=NULL, @p26=NULL (DbType = DateTime), @p27='80c43c6a-508b-47ff-9360-201bfd5521d3', @p28=NULL, @p29='2025-07-03T05:08:29.4215506Z' (DbType = DateTime), @p30='system', @p31=NULL (DbType = DateTime), @p32=NULL, @p33=NULL, @p34=NULL, @p35=NULL, @p36='False', @p37=NULL (DbType = DateTime), @p38=NULL, @p39=NULL, @p40='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p41=NULL, @p42='abbb16c7-f4a4-47d1-b0d4-de7f910df383' (Nullable = true), @p43=NULL (DbType = DateTime), @p44='955b5afd-c985-4110-abd1-17c9c5f73c50', @p45='0', @p46='Failed', @p47='2025-07-03T05:08:29.4216030Z' (Nullable = true) (DbType = DateTime), @p48=NULL, @p49='imagecampaign', @p50=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50);
2025-07-03 10:38:29.456 +05:30 [INF] ✅ All saved successfully.
2025-07-03 10:38:29.457 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:38:29.458 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 5870.2568ms
2025-07-03 10:38:29.459 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:38:29.460 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - 200 null application/json; charset=utf-8 5879.2284ms
2025-07-03 10:38:51.278 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 10:38:51.280 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:51.282 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:38:51.283 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:38:51.289 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 10:38:51.292 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:38:51.294 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 8.7448ms
2025-07-03 10:38:51.295 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:38:51.296 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 18.9ms
2025-07-03 10:38:53.488 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - null 0
2025-07-03 10:38:53.491 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:38:53.492 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:38:53.493 +05:30 [INF] Route matched with {action = "SendImageCampaign", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageCampaign(System.Guid) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 10:39:09.351 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."CampaignId", c0."IsFromTemplate", c0."Position", c0."Title", c0."Type", c0."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 10:39:11.391 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BotId", c."BusinessId", c."CampaignId", c."CategoryBrowsed", c."ClickedCTA", c."ContactId", c."IsAutoTagged", c."MessagePreview", c."ProductBrowsed", c."SentAt", c."Status", c."UpdatedAt", c0."Id", c0."AssignedAgentId", c0."BusinessId", c0."CreatedAt", c0."Email", c0."Group", c0."IsActive", c0."IsArchived", c0."IsAutomationPaused", c0."IsFavorite", c0."LastCTAInteraction", c0."LastCTAType", c0."LastClickedProductId", c0."LastContactedAt", c0."LeadSource", c0."Name", c0."NextFollowUpAt", c0."Notes", c0."PhoneNumber", c0."Tags"
FROM "CampaignRecipients" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
2025-07-03 10:39:18.786 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:39:18.787 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api) in 25292.5176ms
2025-07-03 10:39:18.789 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageCampaign (xbytechat.api)'
2025-07-03 10:39:18.789 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - 400 null application/json; charset=utf-8 25301.0637ms
2025-07-03 10:39:52.635 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:39:52.637 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:39:52.638 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:39:52.639 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:39:52.643 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:39:52.647 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:39:52.648 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:39:54.641 +05:30 [INF] Received HTTP response headers after 1991.5193ms - 200
2025-07-03 10:39:54.643 +05:30 [INF] End processing HTTP request after 1996.0127ms - 200
2025-07-03 10:39:54.684 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=4NvCVGaffrl2xxhNgb-z_w&oh=01_Q5Aa1wFXomWhgqHRRK8o1rC1XvrODJ1vTLdpNR1bL2AWlNZSvQ&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:39:54.686 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:39:54.688 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 2046.7737ms
2025-07-03 10:39:54.689 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:39:54.690 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 2055.1454ms
2025-07-03 10:41:02.339 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:41:02.346 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:41:02.348 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:41:02.349 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:41:02.354 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:41:02.363 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:02.364 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:03.440 +05:30 [INF] Received HTTP response headers after 1075.6245ms - 200
2025-07-03 10:41:03.442 +05:30 [INF] End processing HTTP request after 1079.0486ms - 200
2025-07-03 10:41:03.443 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=1_9JFk3m3Ghjd_BbcVf-Mg&oh=01_Q5Aa1wFqqRXrSOeTzdtH0nzmaV-kKgGIbPrkh-zKnD1W9fcm1w&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:41:03.445 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:41:03.447 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1095.5791ms
2025-07-03 10:41:03.448 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:41:03.449 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1110.5584ms
2025-07-03 10:41:09.893 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 10:41:09.896 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:41:09.897 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:41:09.898 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:41:09.903 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 10:41:09.906 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:41:09.908 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 8.404ms
2025-07-03 10:41:09.909 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:41:09.910 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 17.0893ms
2025-07-03 10:41:14.665 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:41:14.668 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:41:14.670 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:41:14.671 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:41:14.675 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:41:14.683 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:14.685 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:15.327 +05:30 [INF] Received HTTP response headers after 641.5697ms - 200
2025-07-03 10:41:15.329 +05:30 [INF] End processing HTTP request after 645.5272ms - 200
2025-07-03 10:41:15.330 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=XPDm3EICNY9qjMwZeDWYCg&oh=01_Q5Aa1wF1sigLG7E848oRtWX4tQtiwJrNQOhyxIBMRGiQU0bH2Q&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:41:15.333 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:41:15.334 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 661.0893ms
2025-07-03 10:41:15.335 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:41:15.336 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 670.9264ms
2025-07-03 10:41:33.120 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:41:33.124 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:41:33.125 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:41:33.126 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:41:33.131 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:41:33.134 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:41:33.136 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 8.428ms
2025-07-03 10:41:33.137 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:41:33.138 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 17.529ms
2025-07-03 10:41:37.484 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - null 0
2025-07-03 10:41:37.487 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:41:37.488 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:41:37.505 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:41:37.510 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 10:41:37.514 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:41:37.516 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:37.517 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:41:38.149 +05:30 [INF] Received HTTP response headers after 631.2438ms - 200
2025-07-03 10:41:38.150 +05:30 [INF] End processing HTTP request after 634.4568ms - 200
2025-07-03 10:41:38.156 +05:30 [INF] 📨 Preparing to send to 447543746206
2025-07-03 10:41:45.476 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (url)
2025-07-03 10:41:45.477 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (voice_call)
2025-07-03 10:41:45.478 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:41:45.479 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:41:46.434 +05:30 [INF] Received HTTP response headers after 953.8892ms - 400
2025-07-03 10:41:46.435 +05:30 [INF] End processing HTTP request after 957.034ms - 400
2025-07-03 10:41:46.437 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) Invalid parameter\",\"type\":\"OAuthException\",\"code\":100,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"buttons: Button at index 0 of type Url does not require parameters\"},\"fbtrace_id\":\"AXmhCjUnV8IzwxEQqffhYsb\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:41:46.438 +05:30 [INF] 📥 MessageLog saved for 447543746206
2025-07-03 10:41:46.439 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "955b5afd-c985-4110-abd1-17c9c5f73c50"
2025-07-03 10:41:46.440 +05:30 [INF] 💾 Saving all DB changes...
2025-07-03 10:41:46.504 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='5589ff11-13eb-40a9-b59a-59b673a3498f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='dcd9556d-34c9-43e8-a6c1-99319269a829' (Nullable = true), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:11:46.4385178Z' (DbType = DateTime), @p7='API returned error', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"buttons: Button at index 0 of type Url does not require parameters"},"fbtrace_id":"AXmhCjUnV8IzwxEQqffhYsb"}}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false), @p19='29ac3063-6948-4a8d-9466-e6a2f738f400', @p20='True', @p21=NULL, @p22='c13be597-6ae2-42bb-9d43-925815f24ff8', @p23='dcd9556d-34c9-43e8-a6c1-99319269a829', @p24=NULL, @p25=NULL, @p26=NULL (DbType = DateTime), @p27='80c43c6a-508b-47ff-9360-201bfd5521d3', @p28=NULL, @p29='2025-07-03T05:11:46.4393866Z' (DbType = DateTime), @p30='system', @p31=NULL (DbType = DateTime), @p32=NULL, @p33=NULL, @p34=NULL, @p35=NULL, @p36='False', @p37=NULL (DbType = DateTime), @p38=NULL, @p39=NULL, @p40='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p41=NULL, @p42='5589ff11-13eb-40a9-b59a-59b673a3498f' (Nullable = true), @p43=NULL (DbType = DateTime), @p44='955b5afd-c985-4110-abd1-17c9c5f73c50', @p45='0', @p46='Failed', @p47='2025-07-03T05:11:46.4393866Z' (Nullable = true) (DbType = DateTime), @p48=NULL, @p49='imagecampaign', @p50=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50);
2025-07-03 10:41:46.508 +05:30 [INF] ✅ All saved successfully.
2025-07-03 10:41:46.509 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:41:46.510 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 9002.6001ms
2025-07-03 10:41:46.511 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:41:46.511 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/dcd9556d-34c9-43e8-a6c1-99319269a829 - 200 null application/json; charset=utf-8 9027.7201ms
2025-07-03 10:42:24.706 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-03 10:42:24.709 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:24.710 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:24.711 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:42:24.717 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-03 10:42:24.721 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-03 10:42:24.724 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:42:24.725 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 12.3737ms
2025-07-03 10:42:24.726 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:24.727 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 21.2763ms
2025-07-03 10:42:28.062 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send/dcd9556d-34c9-43e8-a6c1-99319269a829 - null 0
2025-07-03 10:42:28.065 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:28.066 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api)'
2025-07-03 10:42:28.070 +05:30 [INF] Route matched with {action = "SendCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:42:28.113 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:42:28.121 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='dcd9556d-34c9-43e8-a6c1-99319269a829', @p0='Sending' (Nullable = false), @p1='2025-07-03T05:12:28.1161148Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Campaigns" SET "Status" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 10:42:28.128 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:42:28.129 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:42:29.182 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send/dcd9556d-34c9-43e8-a6c1-99319269a829 - null 0
2025-07-03 10:42:29.185 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:29.186 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api)'
2025-07-03 10:42:29.187 +05:30 [INF] Route matched with {action = "SendCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:42:29.191 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='dcd9556d-34c9-43e8-a6c1-99319269a829'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:42:29.213 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p1='dcd9556d-34c9-43e8-a6c1-99319269a829', @p0='2025-07-03T05:12:29.1944129Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Campaigns" SET "UpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-03 10:42:29.216 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:42:29.217 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:42:29.282 +05:30 [INF] Received HTTP response headers after 1151.3051ms - 400
2025-07-03 10:42:29.283 +05:30 [INF] End processing HTTP request after 1155.0235ms - 400
2025-07-03 10:42:29.288 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='5e04a925-7738-484b-9dcd-b9eb4caf7817', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:12:29.2868151Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#132012) Parameter format does not match format in the created template\",\"type\":\"OAuthException\",\"code\":132012,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"header: Format mismatch, expected IMAGE, received UNKNOWN\"},\"fbtrace_id\":\"AEz9vlcHJydNwFk564qE3ZS\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:12:29.2868144Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:42:29.295 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__recipient_Id_0='955b5afd-c985-4110-abd1-17c9c5f73c50'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BotId", c."BusinessId", c."CampaignId", c."CategoryBrowsed", c."ClickedCTA", c."ContactId", c."IsAutoTagged", c."MessagePreview", c."ProductBrowsed", c."SentAt", c."Status", c."UpdatedAt"
FROM "CampaignRecipients" AS c
WHERE c."Id" = @__recipient_Id_0
LIMIT 1
2025-07-03 10:42:29.300 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p4='955b5afd-c985-4110-abd1-17c9c5f73c50', @p0='imagecampaign', @p1='2025-07-03T05:12:29.2983748Z' (Nullable = true) (DbType = DateTime), @p2='Sent' (Nullable = false), @p3='2025-07-03T05:12:29.2983752Z' (DbType = DateTime), @p5='dd34cd79-e710-4e29-a68d-905da55ee50f', @p6='True', @p7=NULL, @p8='00000000-0000-0000-0000-000000000000', @p9='dcd9556d-34c9-43e8-a6c1-99319269a829', @p10=NULL, @p11=NULL, @p12=NULL (DbType = DateTime), @p13='80c43c6a-508b-47ff-9360-201bfd5521d3', @p14=NULL, @p15='2025-07-03T05:12:29.2909840Z' (DbType = DateTime), @p16=NULL, @p17=NULL (DbType = DateTime), @p18='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36', @p19=NULL, @p20='✅ Template sent successfully.', @p21='::1', @p22='False', @p23=NULL (DbType = DateTime), @p24=NULL, @p25=NULL, @p26='imagecampaign' (Nullable = false), @p27=NULL, @p28=NULL (DbType = Guid), @p29=NULL (DbType = DateTime), @p30='955b5afd-c985-4110-abd1-17c9c5f73c50', @p31='0', @p32='Sent', @p33='2025-07-03T05:12:29.2909838Z' (Nullable = true) (DbType = DateTime), @p34='whatsapp', @p35='imagecampaign', @p36=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignRecipients" SET "MessagePreview" = @p0, "SentAt" = @p1, "Status" = @p2, "UpdatedAt" = @p3
WHERE "Id" = @p4;
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36);
2025-07-03 10:42:29.304 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='dcd9556d-34c9-43e8-a6c1-99319269a829', @p0='Sent' (Nullable = false), @p1='2025-07-03T05:12:29.3032201Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Campaigns" SET "Status" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 10:42:29.306 +05:30 [INF] 📤 Campaign "dcd9556d-34c9-43e8-a6c1-99319269a829" sent via template to 1 recipients
2025-07-03 10:42:29.307 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:42:29.309 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api) in 1236.5755ms
2025-07-03 10:42:29.310 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api)'
2025-07-03 10:42:29.311 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send/dcd9556d-34c9-43e8-a6c1-99319269a829 - 200 null application/json; charset=utf-8 1248.348ms
2025-07-03 10:42:29.315 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-03 10:42:29.320 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:29.321 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:29.322 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:42:29.325 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-03 10:42:29.329 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-03 10:42:29.331 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:42:29.332 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 8.8225ms
2025-07-03 10:42:29.333 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:29.334 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 19.4966ms
2025-07-03 10:42:30.339 +05:30 [INF] Received HTTP response headers after 1121.3804ms - 400
2025-07-03 10:42:30.341 +05:30 [INF] End processing HTTP request after 1124.7826ms - 400
2025-07-03 10:42:30.363 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='14ae45d4-e005-4bf4-bbe7-9a1873946745', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:12:30.3434350Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#132012) Parameter format does not match format in the created template\",\"type\":\"OAuthException\",\"code\":132012,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"header: Format mismatch, expected IMAGE, received UNKNOWN\"},\"fbtrace_id\":\"ArMPHNjgTRuEq85ensjkItR\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:12:30.3434346Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:42:30.366 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__recipient_Id_0='955b5afd-c985-4110-abd1-17c9c5f73c50'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BotId", c."BusinessId", c."CampaignId", c."CategoryBrowsed", c."ClickedCTA", c."ContactId", c."IsAutoTagged", c."MessagePreview", c."ProductBrowsed", c."SentAt", c."Status", c."UpdatedAt"
FROM "CampaignRecipients" AS c
WHERE c."Id" = @__recipient_Id_0
LIMIT 1
2025-07-03 10:42:30.370 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='955b5afd-c985-4110-abd1-17c9c5f73c50', @p0='2025-07-03T05:12:30.3690310Z' (Nullable = true) (DbType = DateTime), @p1='2025-07-03T05:12:30.3690313Z' (DbType = DateTime), @p3='5336b713-36f2-4689-8793-7ab44f0a35ef', @p4='True', @p5=NULL, @p6='00000000-0000-0000-0000-000000000000', @p7='dcd9556d-34c9-43e8-a6c1-99319269a829', @p8=NULL, @p9=NULL, @p10=NULL (DbType = DateTime), @p11='80c43c6a-508b-47ff-9360-201bfd5521d3', @p12=NULL, @p13='2025-07-03T05:12:30.3651896Z' (DbType = DateTime), @p14=NULL, @p15=NULL (DbType = DateTime), @p16='Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36', @p17=NULL, @p18='✅ Template sent successfully.', @p19='::1', @p20='False', @p21=NULL (DbType = DateTime), @p22=NULL, @p23=NULL, @p24='imagecampaign' (Nullable = false), @p25=NULL, @p26=NULL (DbType = Guid), @p27=NULL (DbType = DateTime), @p28='955b5afd-c985-4110-abd1-17c9c5f73c50', @p29='0', @p30='Sent', @p31='2025-07-03T05:12:30.3651892Z' (Nullable = true) (DbType = DateTime), @p32='whatsapp', @p33='imagecampaign', @p34=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignRecipients" SET "SentAt" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34);
2025-07-03 10:42:30.374 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='dcd9556d-34c9-43e8-a6c1-99319269a829', @p0='Sent' (Nullable = false), @p1='2025-07-03T05:12:30.3731570Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Campaigns" SET "Status" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 10:42:30.376 +05:30 [INF] 📤 Campaign "dcd9556d-34c9-43e8-a6c1-99319269a829" sent via template to 1 recipients
2025-07-03 10:42:30.377 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:42:30.378 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api) in 1189.3873ms
2025-07-03 10:42:30.379 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendCampaign (xbytechat.api)'
2025-07-03 10:42:30.380 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send/dcd9556d-34c9-43e8-a6c1-99319269a829 - 200 null application/json; charset=utf-8 1198.5246ms
2025-07-03 10:42:30.383 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-03 10:42:30.386 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:30.387 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:30.388 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:42:30.391 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-03 10:42:30.396 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-03 10:42:30.398 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:42:30.399 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 9.6741ms
2025-07-03 10:42:30.400 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 10:42:30.401 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 17.3725ms
2025-07-03 10:42:54.388 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/:campaignId - null null
2025-07-03 10:42:54.390 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/:campaignId/summary - null null
2025-07-03 10:42:54.391 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:54.394 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api)'
2025-07-03 10:42:54.394 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:42:54.396 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api)'
2025-07-03 10:42:54.398 +05:30 [INF] Route matched with {action = "GetLogsByCampaign", controller = "CampaignSendLog"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetLogsByCampaign(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController (xbytechat.api).
2025-07-03 10:42:54.400 +05:30 [INF] Route matched with {action = "GetCampaignSummary", controller = "CampaignSendLog"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCampaignSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController (xbytechat.api).
2025-07-03 10:42:54.405 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 10:42:54.405 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 10:42:54.421 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api) in 19.9327ms
2025-07-03 10:42:54.421 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api) in 21.4941ms
2025-07-03 10:42:54.423 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api)'
2025-07-03 10:42:54.424 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api)'
2025-07-03 10:42:54.424 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/:campaignId/summary - 400 null application/problem+json; charset=utf-8 34.3963ms
2025-07-03 10:42:54.425 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/:campaignId - 400 null application/problem+json; charset=utf-8 37.3814ms
2025-07-03 10:43:41.906 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 10:43:41.906 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 10:43:41.906 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 10:43:41.914 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:41.916 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:41.919 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:41.919 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 12.7108ms
2025-07-03 10:43:41.920 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 10:43:41.921 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 10:43:41.926 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 10:43:41.930 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 10:43:41.939 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:43:41.939 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 10:43:41.939 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:41.941 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:44.198 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 2271.9796ms
2025-07-03 10:43:44.200 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-03 10:43:44.201 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 10:43:44.200 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 10:43:44.209 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:44.211 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 10:43:44.213 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-03 10:43:44.220 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 10:43:44.220 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 10:43:44.223 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 21.582ms
2025-07-03 10:43:44.225 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=plhNyNu5_cjmr-cn2n9OuA - null null
2025-07-03 10:43:44.225 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 2295.6829ms
2025-07-03 10:43:44.230 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:44.234 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 10:43:44.238 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 10:43:44.248 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:43:44.253 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 2308.3144ms
2025-07-03 10:43:44.254 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 10:43:44.255 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 2348.4836ms
2025-07-03 10:43:44.262 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=GDN4pycmzAec8uw1RlcMHQ - null null
2025-07-03 10:43:44.265 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:44.266 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 10:43:44.383 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-03 10:43:44.385 +05:30 [INF] GetAllContactsAsync returned 7 contacts
2025-07-03 10:43:44.386 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:43:44.389 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 2446.7683ms
2025-07-03 10:43:44.390 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 10:43:44.391 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 2484.3209ms
2025-07-03 10:43:46.744 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=0876f654-a362-420f-a912-6bce793436a5 - null 0
2025-07-03 10:43:46.747 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:46.747 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 10:43:46.747 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 10:43:46.748 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 10:43:46.751 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:46.751 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:46.753 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:43:46.753 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 10:43:46.755 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 10:43:46.756 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:43:46.757 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 10:43:48.198 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 10:43:48.202 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 10:43:48.212 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-03 10:43:48.218 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:43:48.220 +05:30 [INF] Executed DbCommand (14ms) [Parameters=[@p1='033bcc34-5325-48b7-a8d1-6fbab6d8ff92', @p0='Read' (Nullable = false), @p3='1eda63c0-b0dc-4b05-b803-b7636f862b77', @p2='Read' (Nullable = false), @p5='278939bc-73c8-401f-87f6-5dfc0b5a963a', @p4='Read' (Nullable = false), @p7='2798a7cf-63ab-493a-b360-69e2ffd0c544', @p6='Read' (Nullable = false), @p9='2ca8a311-e3a7-40f3-992b-e9a11924bc2b', @p8='Read' (Nullable = false), @p11='31de5e5a-7d30-4c2a-8fe2-e0be07b747ef', @p10='Read' (Nullable = false), @p13='52c1712c-64d1-4437-9c5d-b95f61a37da2', @p12='Read' (Nullable = false), @p15='835fe348-4330-4bdf-9fdd-1bbd6cf3203b', @p14='Read' (Nullable = false), @p17='a8fa3adf-44de-47e9-9423-924d0609d204', @p16='Read' (Nullable = false), @p19='ac338ca6-5a0c-4909-b9b2-0d29fceef1ae', @p18='Read' (Nullable = false), @p21='ca329c44-e15f-4640-b89d-c2688729de3d', @p20='Read' (Nullable = false), @p23='deb97d10-e8bd-4fae-886a-0c9227b49af2', @p22='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
UPDATE "MessageLogs" SET "Status" = @p4
WHERE "Id" = @p5;
UPDATE "MessageLogs" SET "Status" = @p6
WHERE "Id" = @p7;
UPDATE "MessageLogs" SET "Status" = @p8
WHERE "Id" = @p9;
UPDATE "MessageLogs" SET "Status" = @p10
WHERE "Id" = @p11;
UPDATE "MessageLogs" SET "Status" = @p12
WHERE "Id" = @p13;
UPDATE "MessageLogs" SET "Status" = @p14
WHERE "Id" = @p15;
UPDATE "MessageLogs" SET "Status" = @p16
WHERE "Id" = @p17;
UPDATE "MessageLogs" SET "Status" = @p18
WHERE "Id" = @p19;
UPDATE "MessageLogs" SET "Status" = @p20
WHERE "Id" = @p21;
UPDATE "MessageLogs" SET "Status" = @p22
WHERE "Id" = @p23;
2025-07-03 10:43:48.223 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 26.0718ms
2025-07-03 10:43:48.224 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 10:43:48.225 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 1477.9409ms
2025-07-03 10:43:48.227 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 10:43:48.229 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 1472.5112ms
2025-07-03 10:43:48.230 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 10:43:48.232 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=0876f654-a362-420f-a912-6bce793436a5 - 200 0 null 1488.1898ms
2025-07-03 10:43:48.231 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='0876f654-a362-420f-a912-6bce793436a5', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-03 10:43:48.243 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='d225a11a-5dab-4768-baad-6036616eabad', @p0='2025-07-03T05:13:48.2275264Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-03 10:43:48.249 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 10:43:48.254 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-03 10:43:48.274 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:43:48.276 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:43:48.277 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1519.0397ms
2025-07-03 10:43:48.278 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 10:43:48.278 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:43:48.280 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:43:48.280 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 1533.0756ms
2025-07-03 10:43:48.281 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:43:48.284 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:43:50.489 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 10:43:50.493 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:43:50.495 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:43:50.496 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 2211.0295ms
2025-07-03 10:43:50.497 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:43:50.498 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 2220.4748ms
2025-07-03 10:44:09.806 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=1b52f26e-9fad-4233-a6bb-57603945f8d6 - null 0
2025-07-03 10:44:09.809 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:09.810 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 10:44:09.811 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 10:44:09.812 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/1b52f26e-9fad-4233-a6bb-57603945f8d6 - null null
2025-07-03 10:44:09.812 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=1b52f26e-9fad-4233-a6bb-57603945f8d6 - null null
2025-07-03 10:44:09.815 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='1b52f26e-9fad-4233-a6bb-57603945f8d6' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 10:44:09.818 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:09.820 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:09.822 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 10:44:09.823 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:44:09.823 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 10:44:09.824 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 10.9938ms
2025-07-03 10:44:09.825 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:44:09.825 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 10:44:09.826 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 10:44:11.264 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="1b52f26e-9fad-4233-a6bb-57603945f8d6"
2025-07-03 10:44:11.271 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='1b52f26e-9fad-4233-a6bb-57603945f8d6', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-03 10:44:11.272 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='1b52f26e-9fad-4233-a6bb-57603945f8d6' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-03 10:44:11.280 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='1b52f26e-9fad-4233-a6bb-57603945f8d6'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:44:11.271 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=1b52f26e-9fad-4233-a6bb-57603945f8d6 - 200 0 null 1465.2196ms
2025-07-03 10:44:11.283 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='f824024c-3e88-4f0d-b01e-1856899a4a57', @p0='2025-07-03T05:14:11.2661935Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-03 10:44:11.284 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:44:11.286 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:44:11.290 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 10:44:11.291 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 23.1954ms
2025-07-03 10:44:11.292 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1464.1758ms
2025-07-03 10:44:11.292 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/1b52f26e-9fad-4233-a6bb-57603945f8d6 - null null
2025-07-03 10:44:11.295 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-03 10:44:11.295 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 10:44:11.296 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:44:11.298 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:11.300 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=1b52f26e-9fad-4233-a6bb-57603945f8d6 - 200 null application/json; charset=utf-8 1487.852ms
2025-07-03 10:44:11.301 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/1b52f26e-9fad-4233-a6bb-57603945f8d6 - 200 null application/json; charset=utf-8 1488.9358ms
2025-07-03 10:44:11.302 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:44:11.308 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:44:13.279 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="1b52f26e-9fad-4233-a6bb-57603945f8d6"
2025-07-03 10:44:13.283 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='1b52f26e-9fad-4233-a6bb-57603945f8d6'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 10:44:13.286 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:44:13.287 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1977.8922ms
2025-07-03 10:44:13.288 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 10:44:13.289 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/1b52f26e-9fad-4233-a6bb-57603945f8d6 - 200 null application/json; charset=utf-8 1996.834ms
2025-07-03 10:44:24.222 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 10:44:24.222 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 10:44:24.223 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=plhNyNu5_cjmr-cn2n9OuA - 101 null null 39998.1712ms
2025-07-03 10:44:24.223 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=GDN4pycmzAec8uw1RlcMHQ - 101 null null 39961.1687ms
2025-07-03 10:44:40.493 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:44:40.495 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:40.496 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:44:40.497 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:44:40.501 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:44:40.504 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:44:40.505 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:44:41.441 +05:30 [INF] Received HTTP response headers after 934.7182ms - 200
2025-07-03 10:44:41.442 +05:30 [INF] End processing HTTP request after 937.6917ms - 200
2025-07-03 10:44:41.443 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=t6JWc_o7unRfjk1CKIUqbQ&oh=01_Q5Aa1wFcNJ-s_Vqc8lPIJ4zfBD861Amf6X4MzWXsubcvjY4hnw&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:44:41.445 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:44:41.446 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 947.2239ms
2025-07-03 10:44:41.447 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:44:41.448 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 955.4368ms
2025-07-03 10:44:46.917 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:44:46.921 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:44:46.923 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:44:46.924 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:44:46.928 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:44:46.933 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:44:46.934 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:44:48.444 +05:30 [INF] Received HTTP response headers after 1508.098ms - 200
2025-07-03 10:44:48.446 +05:30 [INF] End processing HTTP request after 1512.9686ms - 200
2025-07-03 10:44:48.447 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=Uv6buMAf4DlxK3vviHRvPQ&oh=01_Q5Aa1wHV6PBeQmqI9lMxap7jCmx-4Ho9XGJK1MzhjSDQQ18x_A&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:44:48.451 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:44:48.452 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1526.2217ms
2025-07-03 10:44:48.454 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:44:48.456 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1538.5859ms
2025-07-03 10:45:04.057 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:45:04.059 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:45:04.061 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:04.062 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:45:04.066 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:45:04.069 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:04.070 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:04.831 +05:30 [INF] Received HTTP response headers after 759.3642ms - 200
2025-07-03 10:45:04.832 +05:30 [INF] End processing HTTP request after 763.1367ms - 200
2025-07-03 10:45:05.292 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=k1FFC7ltrRDy1miQkqpSlw&oh=01_Q5Aa1wErXbbQb91Nwvi74ulSI2LlAA5ROMsgfkKBH0B1kHO7cA&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:45:05.295 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:45:05.297 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1233.1472ms
2025-07-03 10:45:05.298 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:05.299 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1242.352ms
2025-07-03 10:45:34.990 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:45:34.993 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:45:34.994 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:34.995 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:45:34.999 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:45:35.003 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:35.004 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:36.087 +05:30 [INF] Received HTTP response headers after 1081.832ms - 200
2025-07-03 10:45:36.089 +05:30 [INF] End processing HTTP request after 1085.6606ms - 200
2025-07-03 10:45:36.171 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=E4c-1keOaxi0Iu9CqJ7F3Q&oh=01_Q5Aa1wF6EX6bUvhFN1NjgGEjIwexUesLMeAzTqmBxTRSX2CUyA&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:45:36.175 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:45:36.176 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1179.2591ms
2025-07-03 10:45:36.177 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:36.179 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1188.5789ms
2025-07-03 10:45:45.448 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:45:45.451 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:45:45.452 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:45.453 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:45:45.457 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:45:45.461 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:45.462 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:45:46.132 +05:30 [INF] Received HTTP response headers after 668.3466ms - 200
2025-07-03 10:45:46.133 +05:30 [INF] End processing HTTP request after 672.3446ms - 200
2025-07-03 10:45:46.199 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=ym1o7t9afVTrrH7AzoKx1Q&oh=01_Q5Aa1wGqH0ib0HkRXtn3e7MSTuxYS6S1atO-fUECoBKb91018A&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:45:46.202 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:45:46.204 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 748.5134ms
2025-07-03 10:45:46.206 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:45:46.207 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 759.1815ms
2025-07-03 10:46:24.682 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - null null
2025-07-03 10:46:24.685 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:46:24.687 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - 204 null null 4.6816ms
2025-07-03 10:46:24.688 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - application/json 3439
2025-07-03 10:46:24.702 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:46:24.703 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 10:46:24.708 +05:30 [INF] Route matched with {action = "SaveVisualFlow", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveVisualFlow(xbytechat.api.Features.CTAFlowBuilder.DTOs.SaveVisualFlowDto) on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-03 10:46:30.546 +05:30 [INF] 📦 Saving CTA Flow: SevenStep by Tata Consultancy Services
2025-07-03 10:46:30.556 +05:30 [INF] 🧠 SaveVisualFlow started | FlowName: SevenStep | BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:46:30.583 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__dto_FlowName_0='SevenStep', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
FROM "CTAFlowConfigs" AS c
WHERE c."FlowName" = @__dto_FlowName_0 AND c."BusinessId" = @__businessId_1
LIMIT 1
2025-07-03 10:46:30.602 +05:30 [INF] ✅ New FlowConfig created with ID: "e5ae6421-5d6a-4211-86e2-ed16a0457220"
2025-07-03 10:46:30.676 +05:30 [INF] Executed DbCommand (13ms) [Parameters=[@p0='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='2025-07-03T05:16:30.5875705Z' (DbType = DateTime), @p3='Tata Consultancy Services', @p4='SevenStep' (Nullable = false), @p5='True', @p6='True', @p7='2025-07-03T05:16:30.5876458Z' (Nullable = true) (DbType = DateTime), @p8='2590ccf7-ee9c-4811-bd5b-c6f4ef18a6ee', @p9='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p10='66.49631' (Nullable = true), @p11='-37.138817' (Nullable = true), @p12=NULL, @p13=NULL, @p14='0', @p15='flow_step_1' (Nullable = false), @p16='text_template', @p17='Yes, show me' (Nullable = false), @p18='cta' (Nullable = false), @p19='bc0714a1-376f-498a-a8e7-0fd173f055c9', @p20='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p21='954.3418' (Nullable = true), @p22='-36.216442' (Nullable = true), @p23=NULL, @p24=NULL, @p25='1', @p26='flow_step_2' (Nullable = false), @p27='text_template', @p28='Yes, show me' (Nullable = false), @p29='QUICK_REPLY' (Nullable = false), @p30='c48d2b3f-95af-43d4-bed2-d17763e5012f', @p31='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p32='245.71413' (Nullable = true), @p33='264.47284' (Nullable = true), @p34=NULL, @p35=NULL, @p36='2', @p37='flow_step_3' (Nullable = false), @p38='text_template', @p39='More Options' (Nullable = false), @p40='QUICK_REPLY' (Nullable = false), @p41='c5ade1b3-5bf8-445e-9dd7-3a4b708c7863', @p42='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p43='956.09' (Nullable = true), @p44='279.3405' (Nullable = true), @p45=NULL, @p46=NULL, @p47='4', @p48='flow_step_5' (Nullable = false), @p49='text_template', @p50='Send Pricing' (Nullable = false), @p51='QUICK_REPLY' (Nullable = false), @p52='f87ed085-26a2-4df0-95cf-e45f4c6ebd8a', @p53='e5ae6421-5d6a-4211-86e2-ed16a0457220', @p54='595.73444' (Nullable = true), @p55='272.1665' (Nullable = true), @p56=NULL, @p57=NULL, @p58='3', @p59='flow_step_4' (Nullable = false), @p60='text_template', @p61='Show Products' (Nullable = false), @p62='QUICK_REPLY' (Nullable = false), @p63='420ed1a5-e5b6-436c-b79c-13793b872f68', @p64='quick_reply' (Nullable = false), @p65='Show Products' (Nullable = false), @p66='QUICK_REPLY' (Nullable = false), @p67='' (Nullable = false), @p68='c48d2b3f-95af-43d4-bed2-d17763e5012f', @p69='f87ed085-26a2-4df0-95cf-e45f4c6ebd8a' (Nullable = true), @p70='60501074-c896-452a-a558-1159bc282d66', @p71='quick_reply' (Nullable = false), @p72='Send Pricing' (Nullable = false), @p73='QUICK_REPLY' (Nullable = false), @p74='' (Nullable = false), @p75='f87ed085-26a2-4df0-95cf-e45f4c6ebd8a', @p76='c5ade1b3-5bf8-445e-9dd7-3a4b708c7863' (Nullable = true), @p77='61dcd364-b5dc-4607-85c1-66650f2187f6', @p78='quick_reply' (Nullable = false), @p79='Yes, show me' (Nullable = false), @p80='QUICK_REPLY' (Nullable = false), @p81='' (Nullable = false), @p82='2590ccf7-ee9c-4811-bd5b-c6f4ef18a6ee', @p83='bc0714a1-376f-498a-a8e7-0fd173f055c9' (Nullable = true), @p84='8add9173-d0e4-4af0-9bd8-ecd18ba96c2f', @p85='quick_reply' (Nullable = false), @p86='More Options' (Nullable = false), @p87='QUICK_REPLY' (Nullable = false), @p88='' (Nullable = false), @p89='bc0714a1-376f-498a-a8e7-0fd173f055c9', @p90='c48d2b3f-95af-43d4-bed2-d17763e5012f' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CTAFlowConfigs" ("Id", "BusinessId", "CreatedAt", "CreatedBy", "FlowName", "IsActive", "IsPublished", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p52, @p53, @p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p63, @p64, @p65, @p66, @p67, @p68, @p69);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p70, @p71, @p72, @p73, @p74, @p75, @p76);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p77, @p78, @p79, @p80, @p81, @p82, @p83);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p84, @p85, @p86, @p87, @p88, @p89, @p90);
2025-07-03 10:46:30.685 +05:30 [INF] ✅ Flow 'SevenStep' saved | Steps: 5 | Links: 8
2025-07-03 10:46:30.687 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:46:30.688 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api) in 5977.7601ms
2025-07-03 10:46:30.689 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 10:46:30.690 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - 200 null application/json; charset=utf-8 6002.3336ms
2025-07-03 10:46:52.571 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - null null
2025-07-03 10:46:52.574 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:46:52.574 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-03 10:46:52.578 +05:30 [INF] Route matched with {action = "GetAllDraftFlows", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllDraftFlows() on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-03 10:46:52.641 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."FlowName", c."CreatedAt", c."IsPublished"
FROM "CTAFlowConfigs" AS c
WHERE c."BusinessId" = @__businessId_0 AND NOT (c."IsPublished") AND c."IsActive"
ORDER BY c."CreatedAt" DESC
2025-07-03 10:46:52.644 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAFlowBuilder.DTOs.VisualFlowSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:46:52.645 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api) in 65.1225ms
2025-07-03 10:46:52.646 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-03 10:46:52.647 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - 200 null application/json; charset=utf-8 76.3022ms
2025-07-03 10:46:54.209 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-published - null null
2025-07-03 10:46:54.211 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:46:54.212 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api)'
2025-07-03 10:46:54.215 +05:30 [INF] Route matched with {action = "GetPublishedFlows", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPublishedFlows() on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-03 10:46:54.223 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."FlowName", c."IsPublished", c."CreatedAt"
FROM "CTAFlowConfigs" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsPublished"
ORDER BY c."CreatedAt" DESC
2025-07-03 10:46:54.227 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAFlowBuilder.DTOs.VisualFlowSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:46:54.229 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api) in 12.5105ms
2025-07-03 10:46:54.231 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api)'
2025-07-03 10:46:54.232 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-published - 200 null application/json; charset=utf-8 22.9423ms
2025-07-03 10:47:22.852 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 10:47:22.855 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:22.856 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:47:22.857 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 10:47:22.863 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 10:47:22.874 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:47:22.875 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:47:24.189 +05:30 [INF] Received HTTP response headers after 1312.4059ms - 200
2025-07-03 10:47:24.191 +05:30 [INF] End processing HTTP request after 1316.7516ms - 200
2025-07-03 10:47:24.192 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=DUCutRxgr9p2z4hSxOZAaQ&oh=01_Q5Aa1wES2E-3lrk7AUeGmOhsdVXAOIwxZuokY_Zh5mJ9YPokCw&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 10:47:24.196 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:47:24.197 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1338.5908ms
2025-07-03 10:47:24.198 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 10:47:24.199 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1347.2341ms
2025-07-03 10:47:37.571 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - null null
2025-07-03 10:47:37.574 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:37.574 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - 204 null null 3.2691ms
2025-07-03 10:47:37.575 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - application/json 371
2025-07-03 10:47:37.579 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:37.580 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 10:47:37.581 +05:30 [INF] Route matched with {action = "CreateTextCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTextCampaign(xbytechat.api.Features.CampaignModule.DTOs.CampaignCreateDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:47:39.775 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:47:39.779 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:47:39.781 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:47:40.979 +05:30 [INF] Received HTTP response headers after 1197.4971ms - 200
2025-07-03 10:47:40.981 +05:30 [INF] End processing HTTP request after 1201.5031ms - 200
2025-07-03 10:47:40.986 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='105b5817-5c2e-457f-9401-790cfd4effe9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3='text', @p4='2025-07-03T05:17:40.9831756Z' (DbType = DateTime), @p5='system', @p6=NULL (DbType = Guid), @p7=NULL (DbType = DateTime), @p8=NULL, @p9=NULL, @p10=NULL, @p11=NULL, @p12='False', @p13='Hi 👋, would you like to explore our special offer?', @p14='flow_step_1' (Nullable = false), @p15='sevenSteps' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL (DbType = Guid), @p18='Draft' (Nullable = false), @p19='flow_step_1', @p20='[]', @p21='2025-07-03T05:17:40.9831757Z' (DbType = DateTime), @p22='4bf14cc8-93f8-4b79-bb29-39b0d7d36cee', @p23='105b5817-5c2e-457f-9401-790cfd4effe9', @p24='True', @p25='2', @p26='No, thanks' (Nullable = false), @p27='QUICK_REPLY' (Nullable = false), @p28='' (Nullable = false), @p29='f0afe3b1-0d19-4fe7-bdc5-e70e1073e273', @p30='105b5817-5c2e-457f-9401-790cfd4effe9', @p31='True', @p32='1', @p33='Yes, show me' (Nullable = false), @p34='QUICK_REPLY' (Nullable = false), @p35='' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Campaigns" ("Id", "BusinessId", "CampaignId", "CampaignType", "CreatedAt", "CreatedBy", "CtaId", "DeletedAt", "DeletedBy", "FollowUpTemplateId", "ImageCaption", "ImageUrl", "IsDeleted", "MessageBody", "MessageTemplate", "Name", "ScheduledAt", "SourceCampaignId", "Status", "TemplateId", "TemplateParameters", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p22, @p23, @p24, @p25, @p26, @p27, @p28);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p29, @p30, @p31, @p32, @p33, @p34, @p35);
2025-07-03 10:47:40.989 +05:30 [INF] ✅ Campaign 'sevenSteps' created with 0 recipients, 0 user buttons, 2 template buttons and 0 template parameters
2025-07-03 10:47:40.991 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:47:40.992 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api) in 3409.552ms
2025-07-03 10:47:40.993 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 10:47:40.994 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - 200 null application/json; charset=utf-8 3418.901ms
2025-07-03 10:47:41.026 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 10:47:41.026 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9 - null null
2025-07-03 10:47:41.026 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - null null
2025-07-03 10:47:41.028 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:41.031 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:41.032 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:41.033 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:47:41.034 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 10:47:41.035 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:47:41.036 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 10:47:41.037 +05:30 [INF] Route matched with {action = "GetCampaignById", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignModule.DTOs.CampaignDto]] GetCampaignById(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:47:41.038 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 10:47:41.046 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__campaignId_0='105b5817-5c2e-457f-9401-790cfd4effe9', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t."Id0", t."BusinessId0", t."ButtonText", t."ButtonType", t."CreatedAt0", t."Description", t."IsActive", t."TargetUrl", t."Title", t."UpdatedAt0", c1."Id", c1."CampaignId", c1."IsFromTemplate", c1."Position", c1."Title", c1."Type", c1."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt", c0."Id" AS "Id0", c0."BusinessId" AS "BusinessId0", c0."ButtonText", c0."ButtonType", c0."CreatedAt" AS "CreatedAt0", c0."Description", c0."IsActive", c0."TargetUrl", c0."Title", c0."UpdatedAt" AS "UpdatedAt0"
    FROM "Campaigns" AS c
    LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c1 ON t."Id" = c1."CampaignId"
ORDER BY t."Id", t."Id0"
2025-07-03 10:47:41.047 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=1000
2025-07-03 10:47:41.060 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignModule.DTOs.CampaignDto'.
2025-07-03 10:47:41.062 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api) in 21.2776ms
2025-07-03 10:47:41.064 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 10:47:41.065 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 10:47:41.069 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9 - 200 null application/json; charset=utf-8 42.8209ms
2025-07-03 10:47:41.070 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='100', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 10:47:41.074 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:47:41.076 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 31.3838ms
2025-07-03 10:47:41.078 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 10:47:41.078 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - 200 null application/json; charset=utf-8 52.2909ms
2025-07-03 10:47:41.223 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 10:47:41.225 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:47:41.226 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 186.5191ms
2025-07-03 10:47:41.226 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 10:47:41.227 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:47:41.229 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:41.230 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 203.7955ms
2025-07-03 10:47:41.230 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:47:41.233 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 10:47:41.237 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 10:47:41.240 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:47:41.241 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 6.0199ms
2025-07-03 10:47:41.242 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 10:47:41.243 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 16.2132ms
2025-07-03 10:47:46.461 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9/assign-contacts - null null
2025-07-03 10:47:46.463 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:46.463 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9/assign-contacts - 204 null null 2.8063ms
2025-07-03 10:47:46.464 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9/assign-contacts - application/json 289
2025-07-03 10:47:46.467 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:46.468 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 10:47:46.469 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:47:47.119 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__campaignId_0='105b5817-5c2e-457f-9401-790cfd4effe9', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 10:47:47.125 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='057734fa-8aa2-4841-8e07-c7890e30a32a', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='105b5817-5c2e-457f-9401-790cfd4effe9', @p4=NULL, @p5=NULL, @p6='80c43c6a-508b-47ff-9360-201bfd5521d3', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-03T05:17:47.1218979Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-03T05:17:47.1218980Z' (DbType = DateTime), @p13='0c075377-9aba-4e42-8e0d-40d1bf1d5f99', @p14=NULL, @p15='c13be597-6ae2-42bb-9d43-925815f24ff8', @p16='105b5817-5c2e-457f-9401-790cfd4effe9', @p17=NULL, @p18=NULL, @p19='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p20='False', @p21=NULL, @p22=NULL, @p23='2025-07-03T05:17:47.1218118Z' (Nullable = true) (DbType = DateTime), @p24='Pending' (Nullable = false), @p25='2025-07-03T05:17:47.1218119Z' (DbType = DateTime), @p26='519515d1-cbf0-4644-88f6-5f8d42e318e7', @p27=NULL, @p28='c13be597-6ae2-42bb-9d43-925815f24ff8', @p29='105b5817-5c2e-457f-9401-790cfd4effe9', @p30=NULL, @p31=NULL, @p32='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p33='False', @p34=NULL, @p35=NULL, @p36='2025-07-03T05:17:47.1217792Z' (Nullable = true) (DbType = DateTime), @p37='Pending' (Nullable = false), @p38='2025-07-03T05:17:47.1217793Z' (DbType = DateTime), @p39='5ee994a3-e6c5-4931-99b6-abe764f51ef5', @p40=NULL, @p41='c13be597-6ae2-42bb-9d43-925815f24ff8', @p42='105b5817-5c2e-457f-9401-790cfd4effe9', @p43=NULL, @p44=NULL, @p45='8aac7c57-6699-4511-897b-4121b407eb1c', @p46='False', @p47=NULL, @p48=NULL, @p49='2025-07-03T05:17:47.1216449Z' (Nullable = true) (DbType = DateTime), @p50='Pending' (Nullable = false), @p51='2025-07-03T05:17:47.1216451Z' (DbType = DateTime), @p52='b79c2498-b4fa-4358-a7da-f495a612b231', @p53=NULL, @p54='c13be597-6ae2-42bb-9d43-925815f24ff8', @p55='105b5817-5c2e-457f-9401-790cfd4effe9', @p56=NULL, @p57=NULL, @p58='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p59='False', @p60=NULL, @p61=NULL, @p62='2025-07-03T05:17:47.1218251Z' (Nullable = true) (DbType = DateTime), @p63='Pending' (Nullable = false), @p64='2025-07-03T05:17:47.1218252Z' (DbType = DateTime), @p65='db4aa9a8-b076-4784-9ba3-de8a7d717392', @p66=NULL, @p67='c13be597-6ae2-42bb-9d43-925815f24ff8', @p68='105b5817-5c2e-457f-9401-790cfd4effe9', @p69=NULL, @p70=NULL, @p71='491ee04c-27c4-49e4-9bb8-ef8892951090', @p72='False', @p73=NULL, @p74=NULL, @p75='2025-07-03T05:17:47.1218510Z' (Nullable = true) (DbType = DateTime), @p76='Pending' (Nullable = false), @p77='2025-07-03T05:17:47.1218511Z' (DbType = DateTime), @p78='dd431b94-0b7b-4cfe-8833-0ab85b672f7d', @p79=NULL, @p80='c13be597-6ae2-42bb-9d43-925815f24ff8', @p81='105b5817-5c2e-457f-9401-790cfd4effe9', @p82=NULL, @p83=NULL, @p84='0876f654-a362-420f-a912-6bce793436a5', @p85='False', @p86=NULL, @p87=NULL, @p88='2025-07-03T05:17:47.1218389Z' (Nullable = true) (DbType = DateTime), @p89='Pending' (Nullable = false), @p90='2025-07-03T05:17:47.1218390Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p52, @p53, @p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75, @p76, @p77);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90);
2025-07-03 10:47:47.128 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:47:47.129 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 659.3769ms
2025-07-03 10:47:47.131 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 10:47:47.132 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/105b5817-5c2e-457f-9401-790cfd4effe9/assign-contacts - 200 null application/json; charset=utf-8 667.6995ms
2025-07-03 10:47:53.486 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:47:53.488 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:53.489 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:47:53.490 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:47:53.495 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:47:53.497 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:47:53.499 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 6.8673ms
2025-07-03 10:47:53.499 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:47:53.500 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 14.3455ms
2025-07-03 10:47:56.743 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/recipients/105b5817-5c2e-457f-9401-790cfd4effe9 - null null
2025-07-03 10:47:56.746 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:47:56.747 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api)'
2025-07-03 10:47:56.748 +05:30 [INF] Route matched with {action = "GetCampaignRecipients", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCampaignRecipients(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:47:56.754 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='105b5817-5c2e-457f-9401-790cfd4effe9', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c0."Id", c0."Name", c0."PhoneNumber", c0."Email", c0."LeadSource", c0."CreatedAt"
FROM "CampaignRecipients" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0 AND c0."BusinessId" = @__businessId_1
2025-07-03 10:47:56.757 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:47:56.758 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api) in 8.3279ms
2025-07-03 10:47:56.759 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignRecipients (xbytechat.api)'
2025-07-03 10:47:56.760 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/recipients/105b5817-5c2e-457f-9401-790cfd4effe9 - 200 null application/json; charset=utf-8 17.8048ms
2025-07-03 10:48:01.173 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaigns/105b5817-5c2e-457f-9401-790cfd4effe9/recipients/1b52f26e-9fad-4233-a6bb-57603945f8d6 - null null
2025-07-03 10:48:01.175 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:48:01.176 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaigns/105b5817-5c2e-457f-9401-790cfd4effe9/recipients/1b52f26e-9fad-4233-a6bb-57603945f8d6 - 204 null null 3.1608ms
2025-07-03 10:48:01.177 +05:30 [INF] Request starting HTTP/1.1 DELETE http://localhost:7113/api/campaigns/105b5817-5c2e-457f-9401-790cfd4effe9/recipients/1b52f26e-9fad-4233-a6bb-57603945f8d6 - null null
2025-07-03 10:48:01.180 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:48:01.181 +05:30 [INF] Request finished HTTP/1.1 DELETE http://localhost:7113/api/campaigns/105b5817-5c2e-457f-9401-790cfd4effe9/recipients/1b52f26e-9fad-4233-a6bb-57603945f8d6 - 404 0 null 4.1368ms
2025-07-03 10:48:01.185 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: DELETE http://localhost:7113/api/campaigns/105b5817-5c2e-457f-9401-790cfd4effe9/recipients/1b52f26e-9fad-4233-a6bb-57603945f8d6, Response status code: 404
2025-07-03 10:49:04.320 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 10:49:04.323 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:49:04.323 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:49:04.324 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:49:04.330 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 10:49:04.332 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 10:49:04.333 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.3976ms
2025-07-03 10:49:04.334 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 10:49:04.336 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 15.4702ms
2025-07-03 10:49:10.222 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/105b5817-5c2e-457f-9401-790cfd4effe9 - null 0
2025-07-03 10:49:10.225 +05:30 [INF] CORS policy execution successful.
2025-07-03 10:49:10.226 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:49:10.227 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 10:49:10.231 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='105b5817-5c2e-457f-9401-790cfd4effe9'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 10:49:10.238 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 10:49:10.240 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:49:10.241 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 10:49:11.288 +05:30 [INF] Received HTTP response headers after 1045.8666ms - 200
2025-07-03 10:49:11.290 +05:30 [INF] End processing HTTP request after 1049.9627ms - 200
2025-07-03 10:49:11.291 +05:30 [INF] 📨 Preparing to send to 447543746206
2025-07-03 10:49:11.292 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:11.293 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:11.296 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 10:49:11.298 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:11.299 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:12.528 +05:30 [INF] Received HTTP response headers after 1228.2843ms - 200
2025-07-03 10:49:12.529 +05:30 [INF] End processing HTTP request after 1231.4532ms - 200
2025-07-03 10:49:12.531 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:12.532 +05:30 [INF] ✅ Added MessageLog for 447543746206
2025-07-03 10:49:12.532 +05:30 [INF] 📘 Added CampaignSendLog for recipient "057734fa-8aa2-4841-8e07-c7890e30a32a"
2025-07-03 10:49:12.533 +05:30 [INF] 📨 Preparing to send to 1234567890
2025-07-03 10:49:12.534 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:12.534 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:12.535 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:12.536 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:13.119 +05:30 [INF] Received HTTP response headers after 581.5716ms - 400
2025-07-03 10:49:13.120 +05:30 [INF] End processing HTTP request after 584.6715ms - 400
2025-07-03 10:49:13.122 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AauZVzebPbO0drUN_O-Kt-2\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:13.123 +05:30 [INF] ✅ Added MessageLog for 1234567890
2025-07-03 10:49:13.124 +05:30 [INF] 📘 Added CampaignSendLog for recipient "0c075377-9aba-4e42-8e0d-40d1bf1d5f99"
2025-07-03 10:49:13.124 +05:30 [INF] 📨 Preparing to send to 7082156227
2025-07-03 10:49:13.125 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:13.126 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:13.127 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:13.128 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:13.645 +05:30 [INF] Received HTTP response headers after 516.7879ms - 400
2025-07-03 10:49:13.647 +05:30 [INF] End processing HTTP request after 520.2022ms - 400
2025-07-03 10:49:13.649 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"A89FkSA3JC7rmNKQu4SKIl-\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:13.650 +05:30 [INF] ✅ Added MessageLog for 7082156227
2025-07-03 10:49:13.651 +05:30 [INF] 📘 Added CampaignSendLog for recipient "519515d1-cbf0-4644-88f6-5f8d42e318e7"
2025-07-03 10:49:13.651 +05:30 [INF] 📨 Preparing to send to +917082156227
2025-07-03 10:49:13.652 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:13.653 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:13.654 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:13.655 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:14.652 +05:30 [INF] Received HTTP response headers after 995.9994ms - 200
2025-07-03 10:49:14.653 +05:30 [INF] End processing HTTP request after 999.2582ms - 200
2025-07-03 10:49:14.655 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:14.656 +05:30 [INF] ✅ Added MessageLog for +917082156227
2025-07-03 10:49:14.656 +05:30 [INF] 📘 Added CampaignSendLog for recipient "5ee994a3-e6c5-4931-99b6-abe764f51ef5"
2025-07-03 10:49:14.657 +05:30 [INF] 📨 Preparing to send to 8787878787
2025-07-03 10:49:14.657 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:14.658 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:14.659 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:14.660 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:15.195 +05:30 [INF] Received HTTP response headers after 534.779ms - 400
2025-07-03 10:49:15.197 +05:30 [INF] End processing HTTP request after 537.699ms - 400
2025-07-03 10:49:15.198 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"A2Oln2Yl6goOMoZQ2UYIlFt\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:15.199 +05:30 [INF] ✅ Added MessageLog for 8787878787
2025-07-03 10:49:15.200 +05:30 [INF] 📘 Added CampaignSendLog for recipient "b79c2498-b4fa-4358-a7da-f495a612b231"
2025-07-03 10:49:15.201 +05:30 [INF] 📨 Preparing to send to +917654768956
2025-07-03 10:49:15.201 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:15.202 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:15.204 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:15.205 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:15.671 +05:30 [INF] Received HTTP response headers after 464.8815ms - 400
2025-07-03 10:49:15.672 +05:30 [INF] End processing HTTP request after 467.9152ms - 400
2025-07-03 10:49:15.674 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"A3dT5TaUGrGxR74o9y-DddB\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:15.675 +05:30 [INF] ✅ Added MessageLog for +917654768956
2025-07-03 10:49:15.676 +05:30 [INF] 📘 Added CampaignSendLog for recipient "db4aa9a8-b076-4784-9ba3-de8a7d717392"
2025-07-03 10:49:15.676 +05:30 [INF] 📨 Preparing to send to 917082156227
2025-07-03 10:49:15.677 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 10:49:15.678 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 10:49:15.679 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:15.680 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:49:16.778 +05:30 [INF] Received HTTP response headers after 1097.379ms - 200
2025-07-03 10:49:16.780 +05:30 [INF] End processing HTTP request after 1100.8039ms - 200
2025-07-03 10:49:16.781 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 10:49:16.782 +05:30 [INF] ✅ Added MessageLog for 917082156227
2025-07-03 10:49:16.783 +05:30 [INF] 📘 Added CampaignSendLog for recipient "dd431b94-0b7b-4cfe-8833-0ab85b672f7d"
2025-07-03 10:49:16.784 +05:30 [INF] 💾 Saving all DB changes...
2025-07-03 10:49:16.794 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@p0='167c5724-1008-4819-9248-fd473f7c25a7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T05:19:16.7827863Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_1' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==', @p12='{"messaging_product":"whatsapp","contacts":[{"input":"917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","message_status":"accepted"}]}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T05:19:16.7827865Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false), @p19='3061261f-c1b9-4412-8a6c-f769a8051309', @p20='c13be597-6ae2-42bb-9d43-925815f24ff8', @p21=NULL (DbType = Guid), @p22=NULL (DbType = Guid), @p23='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p24='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p25='2025-07-03T05:19:14.6558572Z' (DbType = DateTime), @p26=NULL, @p27='False', @p28=NULL, @p29='flow_step_1' (Nullable = false), @p30='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==', @p31='{"messaging_product":"whatsapp","contacts":[{"input":"+917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","message_status":"accepted"}]}', @p32='+917082156227' (Nullable = false), @p33=NULL (DbType = Guid), @p34=NULL, @p35='2025-07-03T05:19:14.6558574Z' (Nullable = true) (DbType = DateTime), @p36=NULL, @p37='Sent' (Nullable = false), @p38='436e31d7-9510-4c7b-a114-d86ba06642ee', @p39='c13be597-6ae2-42bb-9d43-925815f24ff8', @p40=NULL (DbType = Guid), @p41=NULL (DbType = Guid), @p42='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p43='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p44='2025-07-03T05:19:12.5318629Z' (DbType = DateTime), @p45=NULL, @p46='False', @p47=NULL, @p48='flow_step_1' (Nullable = false), @p49='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==', @p50='{"messaging_product":"whatsapp","contacts":[{"input":"447543746206","wa_id":"447543746206"}],"messages":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","message_status":"accepted"}]}', @p51='447543746206' (Nullable = false), @p52=NULL (DbType = Guid), @p53=NULL, @p54='2025-07-03T05:19:12.5318631Z' (Nullable = true) (DbType = DateTime), @p55=NULL, @p56='Sent' (Nullable = false), @p57='80d70911-b07c-427d-947b-da36007c072f', @p58='c13be597-6ae2-42bb-9d43-925815f24ff8', @p59=NULL (DbType = Guid), @p60=NULL (DbType = Guid), @p61='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p62='867c9c9b-f85e-4572-9bbd-4447b44597b7' (Nullable = true), @p63='2025-07-03T05:19:13.6500998Z' (DbType = DateTime), @p64='API returned error', @p65='False', @p66=NULL, @p67='flow_step_1' (Nullable = false), @p68=NULL, @p69='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A89FkSA3JC7rmNKQu4SKIl-"}}', @p70='7082156227' (Nullable = false), @p71=NULL (DbType = Guid), @p72=NULL, @p73=NULL (DbType = DateTime), @p74=NULL, @p75='Failed' (Nullable = false), @p76='9be04fb2-473e-4f6c-8a38-a71b486fe7e8', @p77='c13be597-6ae2-42bb-9d43-925815f24ff8', @p78=NULL (DbType = Guid), @p79=NULL (DbType = Guid), @p80='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p81='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac' (Nullable = true), @p82='2025-07-03T05:19:13.1231526Z' (DbType = DateTime), @p83='API returned error', @p84='False', @p85=NULL, @p86='flow_step_1' (Nullable = false), @p87=NULL, @p88='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AauZVzebPbO0drUN_O-Kt-2"}}', @p89='1234567890' (Nullable = false), @p90=NULL (DbType = Guid), @p91=NULL, @p92=NULL (DbType = DateTime), @p93=NULL, @p94='Failed' (Nullable = false), @p95='c6838b5f-9542-4998-9235-ccdc0ffc4ef6', @p96='c13be597-6ae2-42bb-9d43-925815f24ff8', @p97=NULL (DbType = Guid), @p98=NULL (DbType = Guid), @p99='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p100='491ee04c-27c4-49e4-9bb8-ef8892951090' (Nullable = true), @p101='2025-07-03T05:19:15.6751856Z' (DbType = DateTime), @p102='API returned error', @p103='False', @p104=NULL, @p105='flow_step_1' (Nullable = false), @p106=NULL, @p107='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A3dT5TaUGrGxR74o9y-DddB"}}', @p108='+917654768956' (Nullable = false), @p109=NULL (DbType = Guid), @p110=NULL, @p111=NULL (DbType = DateTime), @p112=NULL, @p113='Failed' (Nullable = false), @p114='d2aba187-52eb-45c4-b6f6-6c71575ffe9e', @p115='c13be597-6ae2-42bb-9d43-925815f24ff8', @p116=NULL (DbType = Guid), @p117=NULL (DbType = Guid), @p118='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p119='1b52f26e-9fad-4233-a6bb-57603945f8d6' (Nullable = true), @p120='2025-07-03T05:19:15.1996381Z' (DbType = DateTime), @p121='API returned error', @p122='False', @p123=NULL, @p124='flow_step_1' (Nullable = false), @p125=NULL, @p126='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A2Oln2Yl6goOMoZQ2UYIlFt"}}', @p127='8787878787' (Nullable = false), @p128=NULL (DbType = Guid), @p129=NULL, @p130=NULL (DbType = DateTime), @p131=NULL, @p132='Failed' (Nullable = false), @p133='60ec9021-da4c-418e-a06a-2f20b82b3445', @p134='True', @p135=NULL, @p136='00000000-0000-0000-0000-000000000000', @p137='105b5817-5c2e-457f-9401-790cfd4effe9', @p138=NULL, @p139=NULL, @p140=NULL (DbType = DateTime), @p141='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p142=NULL, @p143='2025-07-03T05:19:13.1239674Z' (DbType = DateTime), @p144='system', @p145=NULL (DbType = DateTime), @p146=NULL, @p147=NULL, @p148=NULL, @p149=NULL, @p150='False', @p151=NULL (DbType = DateTime), @p152=NULL, @p153=NULL, @p154='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p155=NULL, @p156='9be04fb2-473e-4f6c-8a38-a71b486fe7e8' (Nullable = true), @p157=NULL (DbType = DateTime), @p158='0c075377-9aba-4e42-8e0d-40d1bf1d5f99', @p159='0', @p160='Failed', @p161='2025-07-03T05:19:13.1239675Z' (Nullable = true) (DbType = DateTime), @p162=NULL, @p163='flow_step_1', @p164=NULL (DbType = Guid), @p165='90a1ae66-ac17-4aa7-ab77-aaec67b7a4cd', @p166='True', @p167=NULL, @p168='00000000-0000-0000-0000-000000000000', @p169='105b5817-5c2e-457f-9401-790cfd4effe9', @p170=NULL, @p171=NULL, @p172=NULL (DbType = DateTime), @p173='491ee04c-27c4-49e4-9bb8-ef8892951090', @p174=NULL, @p175='2025-07-03T05:19:15.6760010Z' (DbType = DateTime), @p176='system', @p177=NULL (DbType = DateTime), @p178=NULL, @p179=NULL, @p180=NULL, @p181=NULL, @p182='False', @p183=NULL (DbType = DateTime), @p184=NULL, @p185=NULL, @p186='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p187=NULL, @p188='c6838b5f-9542-4998-9235-ccdc0ffc4ef6' (Nullable = true), @p189=NULL (DbType = DateTime), @p190='db4aa9a8-b076-4784-9ba3-de8a7d717392', @p191='0', @p192='Failed', @p193='2025-07-03T05:19:15.6760011Z' (Nullable = true) (DbType = DateTime), @p194=NULL, @p195='flow_step_1', @p196=NULL (DbType = Guid), @p197='a85248ec-998a-4019-80da-24c45daead4b', @p198='True', @p199=NULL, @p200='00000000-0000-0000-0000-000000000000', @p201='105b5817-5c2e-457f-9401-790cfd4effe9', @p202=NULL, @p203=NULL, @p204=NULL (DbType = DateTime), @p205='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p206=NULL, @p207='2025-07-03T05:19:15.2004639Z' (DbType = DateTime), @p208='system', @p209=NULL (DbType = DateTime), @p210=NULL, @p211=NULL, @p212=NULL, @p213=NULL, @p214='False', @p215=NULL (DbType = DateTime), @p216=NULL, @p217=NULL, @p218='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p219=NULL, @p220='d2aba187-52eb-45c4-b6f6-6c71575ffe9e' (Nullable = true), @p221=NULL (DbType = DateTime), @p222='b79c2498-b4fa-4358-a7da-f495a612b231', @p223='0', @p224='Failed', @p225='2025-07-03T05:19:15.2004639Z' (Nullable = true) (DbType = DateTime), @p226=NULL, @p227='flow_step_1', @p228=NULL (DbType = Guid), @p229='bfb00a2a-7e8e-42ed-84a0-2cdb60b78767', @p230='True', @p231=NULL, @p232='00000000-0000-0000-0000-000000000000', @p233='105b5817-5c2e-457f-9401-790cfd4effe9', @p234=NULL, @p235=NULL, @p236=NULL (DbType = DateTime), @p237='8aac7c57-6699-4511-897b-4121b407eb1c', @p238=NULL, @p239='2025-07-03T05:19:14.6566952Z' (DbType = DateTime), @p240='system', @p241=NULL (DbType = DateTime), @p242=NULL, @p243=NULL, @p244=NULL, @p245=NULL, @p246='False', @p247=NULL (DbType = DateTime), @p248=NULL, @p249=NULL, @p250='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p251='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==', @p252='3061261f-c1b9-4412-8a6c-f769a8051309' (Nullable = true), @p253=NULL (DbType = DateTime), @p254='5ee994a3-e6c5-4931-99b6-abe764f51ef5', @p255='0', @p256='Sent', @p257='2025-07-03T05:19:14.6566953Z' (Nullable = true) (DbType = DateTime), @p258=NULL, @p259='flow_step_1', @p260=NULL (DbType = Guid), @p261='d6f3f165-047c-4a8a-9416-0a8557943d3c', @p262='True', @p263=NULL, @p264='00000000-0000-0000-0000-000000000000', @p265='105b5817-5c2e-457f-9401-790cfd4effe9', @p266=NULL, @p267=NULL, @p268=NULL (DbType = DateTime), @p269='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p270=NULL, @p271='2025-07-03T05:19:13.6509225Z' (DbType = DateTime), @p272='system', @p273=NULL (DbType = DateTime), @p274=NULL, @p275=NULL, @p276=NULL, @p277=NULL, @p278='False', @p279=NULL (DbType = DateTime), @p280=NULL, @p281=NULL, @p282='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p283=NULL, @p284='80d70911-b07c-427d-947b-da36007c072f' (Nullable = true), @p285=NULL (DbType = DateTime), @p286='519515d1-cbf0-4644-88f6-5f8d42e318e7', @p287='0', @p288='Failed', @p289='2025-07-03T05:19:13.6509225Z' (Nullable = true) (DbType = DateTime), @p290=NULL, @p291='flow_step_1', @p292=NULL (DbType = Guid), @p293='f4bf52ee-3123-49b6-addb-9a67c8f039fd', @p294='True', @p295=NULL, @p296='00000000-0000-0000-0000-000000000000', @p297='105b5817-5c2e-457f-9401-790cfd4effe9', @p298=NULL, @p299=NULL, @p300=NULL (DbType = DateTime), @p301='80c43c6a-508b-47ff-9360-201bfd5521d3', @p302=NULL, @p303='2025-07-03T05:19:12.5327294Z' (DbType = DateTime), @p304='system', @p305=NULL (DbType = DateTime), @p306=NULL, @p307=NULL, @p308=NULL, @p309=NULL, @p310='False', @p311=NULL (DbType = DateTime), @p312=NULL, @p313=NULL, @p314='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p315='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==', @p316='436e31d7-9510-4c7b-a114-d86ba06642ee' (Nullable = true), @p317=NULL (DbType = DateTime), @p318='057734fa-8aa2-4841-8e07-c7890e30a32a', @p319='0', @p320='Sent', @p321='2025-07-03T05:19:12.5327294Z' (Nullable = true) (DbType = DateTime), @p322=NULL, @p323='flow_step_1', @p324=NULL (DbType = Guid), @p325='f646c600-cc88-41f4-a6b6-46515df49965', @p326='True', @p327=NULL, @p328='00000000-0000-0000-0000-000000000000', @p329='105b5817-5c2e-457f-9401-790cfd4effe9', @p330=NULL, @p331=NULL, @p332=NULL (DbType = DateTime), @p333='0876f654-a362-420f-a912-6bce793436a5', @p334=NULL, @p335='2025-07-03T05:19:16.7835983Z' (DbType = DateTime), @p336='system', @p337=NULL (DbType = DateTime), @p338=NULL, @p339=NULL, @p340=NULL, @p341=NULL, @p342='False', @p343=NULL (DbType = DateTime), @p344=NULL, @p345=NULL, @p346='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p347='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==', @p348='167c5724-1008-4819-9248-fd473f7c25a7' (Nullable = true), @p349=NULL (DbType = DateTime), @p350='dd431b94-0b7b-4cfe-8833-0ab85b672f7d', @p351='0', @p352='Sent', @p353='2025-07-03T05:19:16.7835983Z' (Nullable = true) (DbType = DateTime), @p354=NULL, @p355='flow_step_1', @p356=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64, @p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p76, @p77, @p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90, @p91, @p92, @p93, @p94);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p95, @p96, @p97, @p98, @p99, @p100, @p101, @p102, @p103, @p104, @p105, @p106, @p107, @p108, @p109, @p110, @p111, @p112, @p113);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p114, @p115, @p116, @p117, @p118, @p119, @p120, @p121, @p122, @p123, @p124, @p125, @p126, @p127, @p128, @p129, @p130, @p131, @p132);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p133, @p134, @p135, @p136, @p137, @p138, @p139, @p140, @p141, @p142, @p143, @p144, @p145, @p146, @p147, @p148, @p149, @p150, @p151, @p152, @p153, @p154, @p155, @p156, @p157, @p158, @p159, @p160, @p161, @p162, @p163, @p164);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p165, @p166, @p167, @p168, @p169, @p170, @p171, @p172, @p173, @p174, @p175, @p176, @p177, @p178, @p179, @p180, @p181, @p182, @p183, @p184, @p185, @p186, @p187, @p188, @p189, @p190, @p191, @p192, @p193, @p194, @p195, @p196);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p197, @p198, @p199, @p200, @p201, @p202, @p203, @p204, @p205, @p206, @p207, @p208, @p209, @p210, @p211, @p212, @p213, @p214, @p215, @p216, @p217, @p218, @p219, @p220, @p221, @p222, @p223, @p224, @p225, @p226, @p227, @p228);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p229, @p230, @p231, @p232, @p233, @p234, @p235, @p236, @p237, @p238, @p239, @p240, @p241, @p242, @p243, @p244, @p245, @p246, @p247, @p248, @p249, @p250, @p251, @p252, @p253, @p254, @p255, @p256, @p257, @p258, @p259, @p260);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p261, @p262, @p263, @p264, @p265, @p266, @p267, @p268, @p269, @p270, @p271, @p272, @p273, @p274, @p275, @p276, @p277, @p278, @p279, @p280, @p281, @p282, @p283, @p284, @p285, @p286, @p287, @p288, @p289, @p290, @p291, @p292);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p293, @p294, @p295, @p296, @p297, @p298, @p299, @p300, @p301, @p302, @p303, @p304, @p305, @p306, @p307, @p308, @p309, @p310, @p311, @p312, @p313, @p314, @p315, @p316, @p317, @p318, @p319, @p320, @p321, @p322, @p323, @p324);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p325, @p326, @p327, @p328, @p329, @p330, @p331, @p332, @p333, @p334, @p335, @p336, @p337, @p338, @p339, @p340, @p341, @p342, @p343, @p344, @p345, @p346, @p347, @p348, @p349, @p350, @p351, @p352, @p353, @p354, @p355, @p356);
2025-07-03 10:49:16.810 +05:30 [INF] ✅ All saved successfully.
2025-07-03 10:49:16.811 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 10:49:16.812 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 6583.8779ms
2025-07-03 10:49:16.813 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 10:49:16.814 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/105b5817-5c2e-457f-9401-790cfd4effe9 - 200 null application/json; charset=utf-8 6591.4173ms
2025-07-03 10:50:45.354 +05:30 [INF] Request starting HTTP/1.1 GET http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1047243373&hub.verify_token=xbytechat-secret-token - null null
2025-07-03 10:50:45.357 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-03 10:50:45.360 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:50:45.362 +05:30 [INF] ✅ WhatsApp webhook verified successfully.
2025-07-03 10:50:45.362 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.String'.
2025-07-03 10:50:45.364 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 2.7158ms
2025-07-03 10:50:45.365 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-03 10:50:45.366 +05:30 [INF] Request finished HTTP/1.1 GET http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1047243373&hub.verify_token=xbytechat-secret-token - 200 null text/plain; charset=utf-8 11.2504ms
2025-07-03 10:51:04.730 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 633
2025-07-03 10:51:04.737 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:04.739 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:04.764 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNjdEN0JGRUNBNjAxQzVGNTNBMEQ4Q0M1MzQyNEUwQzAA","timestamp":"1751520068","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-03 10:51:04.767 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:04.768 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:04.769 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 28.6314ms
2025-07-03 10:51:04.770 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNjdEN0JGRUNBNjAxQzVGNTNBMEQ4Q0M1MzQyNEUwQzAA","timestamp":"1751520068","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-03 10:51:04.771 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:04.772 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:04.772 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 42.1493ms
2025-07-03 10:51:04.775 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:04.776 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNjdEN0JGRUNBNjAxQzVGNTNBMEQ4Q0M1MzQyNEUwQzAA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==, Text: Yes, show me
2025-07-03 10:51:04.789 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:04.792 +05:30 [INF] 📊 CampaignSendLog matched via context.id
2025-07-03 10:51:05.760 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:05.769 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM "CampaignSendLogs" AS c
INNER JOIN "CampaignRecipients" AS c0 ON c."RecipientId" = c0."Id"
WHERE c."MessageId" = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:05.772 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p3='f646c600-cc88-41f4-a6b6-46515df49965', @p0='Yes, show me', @p1='2025-07-03T05:21:04.7942238Z' (Nullable = true) (DbType = DateTime), @p2='True'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "ClickType" = @p0, "ClickedAt" = @p1, "IsClicked" = @p2
WHERE "Id" = @p3;
2025-07-03 10:51:05.820 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@p0='4b2d00fa-04f0-4ee2-8cd9-04a70f39aada', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Yes, show me', @p4='Yes, show me', @p5='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p6='f646c600-cc88-41f4-a6b6-46515df49965' (Nullable = true), @p7=NULL, @p8='2025-07-03T05:21:04.7942238Z' (DbType = DateTime), @p9='webhook', @p10='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==', @p18='167c5724-1008-4819-9248-fd473f7c25a7' (Nullable = true), @p19=NULL, @p20=NULL (DbType = Guid), @p21='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @p22='campaign' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:05.823 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:05.834 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__campaignId_0='105b5817-5c2e-457f-9401-790cfd4effe9' (Nullable = true), @__normalizedButtonText_1='yes, show me', @__normalizedTemplateName_2='flow_step_1'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."ButtonText", c."CampaignId", c."CreatedAt", c."CreatedBy", c."OverrideNextTemplate", c."TemplateName"
FROM "CampaignFlowOverrides" AS c
WHERE c."CampaignId" = @__campaignId_0 AND lower(c."ButtonText") = @__normalizedButtonText_1 AND lower(c."TemplateName") = @__normalizedTemplateName_2
LIMIT 1
2025-07-03 10:51:05.836 +05:30 [INF] 🟡 No campaign override found for button 'yes, show me' on template 'flow_step_1'
2025-07-03 10:51:05.843 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='yes, show me', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:05.846 +05:30 [INF] ✅ Fallback flow step matched: StepId = "b2d0e1a3-846e-49aa-a954-8badae61643f", Flow = test01
2025-07-03 10:51:05.846 +05:30 [INF] 🔁 Matched CTA Step → "b2d0e1a3-846e-49aa-a954-8badae61643f"
2025-07-03 10:51:05.849 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "b2d0e1a3-846e-49aa-a954-8badae61643f" | TrackingLogId: "4b2d00fa-04f0-4ee2-8cd9-04a70f39aada"
2025-07-03 10:51:05.863 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__trackingLogId_0='4b2d00fa-04f0-4ee2-8cd9-04a70f39aada'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:05.876 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='b2d0e1a3-846e-49aa-a954-8badae61643f' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:05.878 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "b2d0e1a3-846e-49aa-a954-8badae61643f", Template: flow_step_2
2025-07-03 10:51:05.880 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:05.880 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:07.271 +05:30 [INF] Received HTTP response headers after 1389.9571ms - 200
2025-07-03 10:51:07.273 +05:30 [INF] End processing HTTP request after 1393.09ms - 200
2025-07-03 10:51:07.277 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='9157d69d-2635-43d0-9b8e-b11beeb8a45a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:07.2750300Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:07.2750295Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:07.302 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='08ec960c-6b19-403b-a40f-c364431ca093', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:07.2801492Z' (DbType = DateTime), @p5='8c065950-26a3-4fac-a3a4-462879e809e6' (Nullable = true), @p6=NULL, @p7='b2d0e1a3-846e-49aa-a954-8badae61643f', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='4b2d00fa-04f0-4ee2-8cd9-04a70f39aada' (Nullable = true), @p13='Yes, show me'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:07.304 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to 917082156227
2025-07-03 10:51:07.304 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:08.329 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:08.331 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:08.332 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:08.335 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"sent","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","expiration_timestamp":"1751520072","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.336 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:08.337 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:08.337 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"sent","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","expiration_timestamp":"1751520072","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.341 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.3944ms
2025-07-03 10:51:08.343 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:08.344 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:08.345 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"sent","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","expiration_timestamp":"1751520072","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.345 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.942ms
2025-07-03 10:51:08.353 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:08.355 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==
2025-07-03 10:51:08.355 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==
2025-07-03 10:51:08.720 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:08.723 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:08.723 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:08.725 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"delivered","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.726 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:08.727 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:08.728 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.033ms
2025-07-03 10:51:08.729 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:08.729 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"delivered","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.730 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 9.5456ms
2025-07-03 10:51:08.731 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:08.734 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==","status":"delivered","timestamp":"1751520072","recipient_id":"917082156227","conversation":{"id":"fca83cbd7d62fedf6c50cf1480822419","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:08.736 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:08.738 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==
2025-07-03 10:51:08.739 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==
2025-07-03 10:51:17.102 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 633
2025-07-03 10:51:17.104 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:17.105 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:17.107 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjUwQTBGQTJCNDRDRDBEMTRDMEU3QTIwN0JBOTc1NUYA","timestamp":"1751520080","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:17.108 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:17.108 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjUwQTBGQTJCNDRDRDBEMTRDMEU3QTIwN0JBOTc1NUYA","timestamp":"1751520080","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:17.109 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:17.110 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:17.111 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7897ms
2025-07-03 10:51:17.112 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:17.113 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:17.114 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjUwQTBGQTJCNDRDRDBEMTRDMEU3QTIwN0JBOTc1NUYA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==, Text: More Options
2025-07-03 10:51:17.114 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.5553ms
2025-07-03 10:51:17.117 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:17.146 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:51:17.149 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:51:18.221 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:18.239 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@p0='d17d4f68-e832-4d11-a5df-027dfdfd63f0', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='More Options', @p4='More Options', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:21:17.1501295Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzQ0MDhEMjRGOTZENzQ5NjNDAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:18.240 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:18.242 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='more options', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:18.244 +05:30 [INF] ✅ Fallback flow step matched: StepId = "c48d2b3f-95af-43d4-bed2-d17763e5012f", Flow = SevenStep
2025-07-03 10:51:18.245 +05:30 [INF] 🔁 Matched CTA Step → "c48d2b3f-95af-43d4-bed2-d17763e5012f"
2025-07-03 10:51:18.245 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f" | TrackingLogId: "d17d4f68-e832-4d11-a5df-027dfdfd63f0"
2025-07-03 10:51:18.247 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__trackingLogId_0='d17d4f68-e832-4d11-a5df-027dfdfd63f0'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:18.250 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='c48d2b3f-95af-43d4-bed2-d17763e5012f' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:18.252 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f", Template: flow_step_3
2025-07-03 10:51:18.253 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:18.253 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:19.325 +05:30 [INF] Received HTTP response headers after 1070.9934ms - 200
2025-07-03 10:51:19.327 +05:30 [INF] End processing HTTP request after 1074.1686ms - 200
2025-07-03 10:51:19.349 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='11c32eb9-11b4-4c82-acff-1be866c38af5', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:19.3290012Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_3' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:19.3290008Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:19.353 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='790c9d17-71cd-4437-99ac-beac06a124dd', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:19.3515592Z' (DbType = DateTime), @p5='e5ae6421-5d6a-4211-86e2-ed16a0457220' (Nullable = true), @p6=NULL, @p7='c48d2b3f-95af-43d4-bed2-d17763e5012f', @p8='' (Nullable = false), @p9='True', @p10='flow_step_3', @p11='text_template', @p12='d17d4f68-e832-4d11-a5df-027dfdfd63f0' (Nullable = true), @p13='More Options'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:19.355 +05:30 [INF] ✅ Flow step executed → Template: flow_step_3 sent to 917082156227
2025-07-03 10:51:19.356 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:21.391 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:21.391 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:21.393 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:21.395 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:21.396 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:21.397 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:21.398 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"sent","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","expiration_timestamp":"1751520084","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.399 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"delivered","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.400 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:21.400 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"sent","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","expiration_timestamp":"1751520084","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.402 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:21.402 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:21.404 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:21.405 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:21.406 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.8732ms
2025-07-03 10:51:21.406 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"sent","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","expiration_timestamp":"1751520084","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.407 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.1441ms
2025-07-03 10:51:21.408 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:21.411 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:21.411 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:21.415 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.2336ms
2025-07-03 10:51:21.417 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==
2025-07-03 10:51:21.417 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 26.3062ms
2025-07-03 10:51:21.421 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==
2025-07-03 10:51:21.425 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"delivered","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.426 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:21.426 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==","status":"delivered","timestamp":"1751520084","recipient_id":"917082156227","conversation":{"id":"7cc9c6e15e176781d9792b9fac78136b","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:21.428 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:21.430 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==
2025-07-03 10:51:21.431 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==
2025-07-03 10:51:22.910 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 635
2025-07-03 10:51:22.912 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:22.913 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:22.915 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRkY1Q0QxNEU1MkJBMjE1MDE4RjgzQkMzMzRGMkJFQzIA","timestamp":"1751520086","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:51:22.916 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:22.916 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRkY1Q0QxNEU1MkJBMjE1MDE4RjgzQkMzMzRGMkJFQzIA","timestamp":"1751520086","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:51:22.916 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:22.918 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:22.919 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7742ms
2025-07-03 10:51:22.920 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:22.921 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:22.921 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRkY1Q0QxNEU1MkJBMjE1MDE4RjgzQkMzMzRGMkJFQzIA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==, Text: Show Products
2025-07-03 10:51:22.922 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.7559ms
2025-07-03 10:51:22.925 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:22.930 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:51:22.932 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:51:23.514 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:23.534 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='a39fed74-2b20-4151-b012-78cec08183a6', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Show Products', @p4='Show Products', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:21:22.9329464Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUM4OEIyMjIzMThCNTRBNzlBAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:23.536 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:23.538 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='show products', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:23.540 +05:30 [INF] ✅ Fallback flow step matched: StepId = "f275e674-9545-4c05-a830-3d531d7f3930", Flow = Tes001
2025-07-03 10:51:23.541 +05:30 [INF] 🔁 Matched CTA Step → "f275e674-9545-4c05-a830-3d531d7f3930"
2025-07-03 10:51:23.541 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "f275e674-9545-4c05-a830-3d531d7f3930" | TrackingLogId: "a39fed74-2b20-4151-b012-78cec08183a6"
2025-07-03 10:51:23.544 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__trackingLogId_0='a39fed74-2b20-4151-b012-78cec08183a6'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:23.547 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='f275e674-9545-4c05-a830-3d531d7f3930' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:23.548 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "f275e674-9545-4c05-a830-3d531d7f3930", Template: flow_step_2
2025-07-03 10:51:23.549 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:23.550 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:25.786 +05:30 [INF] Received HTTP response headers after 2235.1466ms - 200
2025-07-03 10:51:25.787 +05:30 [INF] End processing HTTP request after 2237.934ms - 200
2025-07-03 10:51:25.791 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='0d209b71-981e-46c4-bc42-028bbb5ab6c5', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:25.7894588Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:25.7894584Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:25.794 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='af1e0e22-033d-45d0-9d53-ea1d23862c11', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:25.7932346Z' (DbType = DateTime), @p5='123b5480-fef7-4f42-8d58-c270fbd534c9' (Nullable = true), @p6=NULL, @p7='f275e674-9545-4c05-a830-3d531d7f3930', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='a39fed74-2b20-4151-b012-78cec08183a6' (Nullable = true), @p13='Show Products'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:25.796 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to 917082156227
2025-07-03 10:51:25.797 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:26.386 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:26.388 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:26.389 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:26.390 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"sent","timestamp":"1751520090","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","expiration_timestamp":"1751520090","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:26.392 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:26.392 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"sent","timestamp":"1751520090","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","expiration_timestamp":"1751520090","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:26.393 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:26.394 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:26.395 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3839ms
2025-07-03 10:51:26.395 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"sent","timestamp":"1751520090","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","expiration_timestamp":"1751520090","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:26.396 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:26.398 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:26.398 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.7051ms
2025-07-03 10:51:26.400 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==
2025-07-03 10:51:26.403 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==
2025-07-03 10:51:27.358 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:27.361 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:27.361 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:27.363 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"delivered","timestamp":"1751520091","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:27.364 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:27.365 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"delivered","timestamp":"1751520091","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:27.365 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:27.366 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:27.367 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2674ms
2025-07-03 10:51:27.368 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==","status":"delivered","timestamp":"1751520091","recipient_id":"917082156227","conversation":{"id":"3e4214d787830ffcedbf591abd49226e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:27.369 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:27.371 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:27.371 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.8628ms
2025-07-03 10:51:27.373 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==
2025-07-03 10:51:27.376 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==
2025-07-03 10:51:31.443 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 633
2025-07-03 10:51:31.446 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:31.447 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:31.448 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUUxOTlEN0ExMUQ1NkM0RDNEQzI1REJDNzFBQzkwQzEA","timestamp":"1751520095","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:31.450 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:31.450 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUUxOTlEN0ExMUQ1NkM0RDNEQzI1REJDNzFBQzkwQzEA","timestamp":"1751520095","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:31.450 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:31.452 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:31.453 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7997ms
2025-07-03 10:51:31.454 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:31.454 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:31.455 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUUxOTlEN0ExMUQ1NkM0RDNEQzI1REJDNzFBQzkwQzEA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==, Text: More Options
2025-07-03 10:51:31.456 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.5797ms
2025-07-03 10:51:31.459 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:31.463 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:51:31.465 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:51:32.231 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:32.234 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='687e85aa-6b97-45e3-81e7-e20a6f1120ae', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='More Options', @p4='More Options', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:21:31.4659947Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNTUzNzdEMEE1QTg4OEE0NzkzAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:32.236 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:32.237 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='more options', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:32.239 +05:30 [INF] ✅ Fallback flow step matched: StepId = "c48d2b3f-95af-43d4-bed2-d17763e5012f", Flow = SevenStep
2025-07-03 10:51:32.240 +05:30 [INF] 🔁 Matched CTA Step → "c48d2b3f-95af-43d4-bed2-d17763e5012f"
2025-07-03 10:51:32.241 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f" | TrackingLogId: "687e85aa-6b97-45e3-81e7-e20a6f1120ae"
2025-07-03 10:51:32.243 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__trackingLogId_0='687e85aa-6b97-45e3-81e7-e20a6f1120ae'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:32.246 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='c48d2b3f-95af-43d4-bed2-d17763e5012f' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:32.248 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f", Template: flow_step_3
2025-07-03 10:51:32.249 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:32.249 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:33.178 +05:30 [INF] Received HTTP response headers after 927.7772ms - 200
2025-07-03 10:51:33.179 +05:30 [INF] End processing HTTP request after 930.5594ms - 200
2025-07-03 10:51:33.200 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='9b26be47-f27e-4837-b0cb-abb63b8e4aea', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:33.1812723Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_3' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:33.1812719Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:33.204 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='d6b7e15a-b964-45df-ba8d-2fd60f50fce9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:33.2032213Z' (DbType = DateTime), @p5='e5ae6421-5d6a-4211-86e2-ed16a0457220' (Nullable = true), @p6=NULL, @p7='c48d2b3f-95af-43d4-bed2-d17763e5012f', @p8='' (Nullable = false), @p9='True', @p10='flow_step_3', @p11='text_template', @p12='687e85aa-6b97-45e3-81e7-e20a6f1120ae' (Nullable = true), @p13='More Options'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:33.206 +05:30 [INF] ✅ Flow step executed → Template: flow_step_3 sent to 917082156227
2025-07-03 10:51:33.207 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:34.110 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:34.112 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:34.113 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:34.115 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"sent","timestamp":"1751520098","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","expiration_timestamp":"1751520098","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:34.116 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:34.116 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"sent","timestamp":"1751520098","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","expiration_timestamp":"1751520098","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:34.116 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:34.118 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:34.119 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2128ms
2025-07-03 10:51:34.119 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"sent","timestamp":"1751520098","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","expiration_timestamp":"1751520098","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:34.120 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:34.122 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:34.123 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.4991ms
2025-07-03 10:51:34.124 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==
2025-07-03 10:51:34.127 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==
2025-07-03 10:51:36.094 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:36.097 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:36.097 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:36.099 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"delivered","timestamp":"1751520099","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:36.101 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:36.101 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"delivered","timestamp":"1751520099","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:36.101 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:36.102 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:36.103 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4477ms
2025-07-03 10:51:36.104 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==","status":"delivered","timestamp":"1751520099","recipient_id":"917082156227","conversation":{"id":"080460e721c0b2fad8b20ff2939675a2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:36.105 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:36.107 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:36.107 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.8343ms
2025-07-03 10:51:36.109 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==
2025-07-03 10:51:36.111 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==
2025-07-03 10:51:36.837 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 635
2025-07-03 10:51:36.839 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:36.840 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:36.842 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNURCODQ1N0YyMzdDREFCN0QwODI3NDI3NjRFNDg4OTcA","timestamp":"1751520100","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:51:36.843 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:36.843 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNURCODQ1N0YyMzdDREFCN0QwODI3NDI3NjRFNDg4OTcA","timestamp":"1751520100","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:51:36.844 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:36.845 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:36.846 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0296ms
2025-07-03 10:51:36.847 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:36.848 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:36.849 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNURCODQ1N0YyMzdDREFCN0QwODI3NDI3NjRFNDg4OTcA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==, Text: Show Products
2025-07-03 10:51:36.849 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.7465ms
2025-07-03 10:51:36.852 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:36.856 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:51:36.858 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:51:37.919 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:37.923 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='7bec0298-3618-468a-9542-70ff84b323de', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Show Products', @p4='Show Products', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:21:36.8595852Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEM5QkUwMUQ2Q0U4RTA4ODMwAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:37.925 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:37.927 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='show products', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:37.928 +05:30 [INF] ✅ Fallback flow step matched: StepId = "f275e674-9545-4c05-a830-3d531d7f3930", Flow = Tes001
2025-07-03 10:51:37.929 +05:30 [INF] 🔁 Matched CTA Step → "f275e674-9545-4c05-a830-3d531d7f3930"
2025-07-03 10:51:37.929 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "f275e674-9545-4c05-a830-3d531d7f3930" | TrackingLogId: "7bec0298-3618-468a-9542-70ff84b323de"
2025-07-03 10:51:37.932 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__trackingLogId_0='7bec0298-3618-468a-9542-70ff84b323de'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:37.934 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='f275e674-9545-4c05-a830-3d531d7f3930' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:37.936 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "f275e674-9545-4c05-a830-3d531d7f3930", Template: flow_step_2
2025-07-03 10:51:37.937 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:37.937 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:38.913 +05:30 [INF] Received HTTP response headers after 974.5599ms - 200
2025-07-03 10:51:38.914 +05:30 [INF] End processing HTTP request after 977.3262ms - 200
2025-07-03 10:51:38.935 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='4d4b7b34-6de7-4601-b5cb-97477ae8a03d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:38.9161968Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:38.9161964Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:38.939 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='428fb683-a397-403d-84ec-6213e7b56a64', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:38.9382316Z' (DbType = DateTime), @p5='123b5480-fef7-4f42-8d58-c270fbd534c9' (Nullable = true), @p6=NULL, @p7='f275e674-9545-4c05-a830-3d531d7f3930', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='7bec0298-3618-468a-9542-70ff84b323de' (Nullable = true), @p13='Show Products'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:38.941 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to 917082156227
2025-07-03 10:51:38.942 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:40.183 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:40.185 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:40.186 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:40.189 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"sent","timestamp":"1751520103","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","expiration_timestamp":"1751520103","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.190 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:40.190 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"sent","timestamp":"1751520103","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","expiration_timestamp":"1751520103","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.191 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:40.192 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:40.193 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8821ms
2025-07-03 10:51:40.194 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"sent","timestamp":"1751520103","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","expiration_timestamp":"1751520103","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.195 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:40.197 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:40.197 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.6662ms
2025-07-03 10:51:40.198 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==
2025-07-03 10:51:40.201 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==
2025-07-03 10:51:40.358 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:40.361 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:40.361 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:40.363 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"delivered","timestamp":"1751520104","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.364 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:40.364 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"delivered","timestamp":"1751520104","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.365 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:40.366 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:40.367 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3198ms
2025-07-03 10:51:40.368 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==","status":"delivered","timestamp":"1751520104","recipient_id":"917082156227","conversation":{"id":"da2716953174747cca8d78022e98c8f2","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:40.369 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:40.371 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:40.372 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.5712ms
2025-07-03 10:51:40.374 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==
2025-07-03 10:51:40.376 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==
2025-07-03 10:51:43.226 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 633
2025-07-03 10:51:43.228 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:43.229 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:43.282 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjAxMjk2ODhDRTk0ODIxQ0IxMzI1RTJBMDA4OTMxQjYA","timestamp":"1751520106","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:43.285 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:43.285 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjAxMjk2ODhDRTk0ODIxQ0IxMzI1RTJBMDA4OTMxQjYA","timestamp":"1751520106","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 10:51:43.285 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:43.287 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:51:43.288 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 57.38ms
2025-07-03 10:51:43.288 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:51:43.289 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:43.290 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjAxMjk2ODhDRTk0ODIxQ0IxMzI1RTJBMDA4OTMxQjYA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==, Text: More Options
2025-07-03 10:51:43.291 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 64.9197ms
2025-07-03 10:51:43.294 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:51:43.298 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:51:43.299 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:51:44.548 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:51:44.569 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='01e50312-2082-4263-9295-30741fa7de8a', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='More Options', @p4='More Options', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:21:43.3005542Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjE5NzZBOTQzNTg3QTFGQTgwAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:51:44.571 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:51:44.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='more options', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:51:44.574 +05:30 [INF] ✅ Fallback flow step matched: StepId = "c48d2b3f-95af-43d4-bed2-d17763e5012f", Flow = SevenStep
2025-07-03 10:51:44.575 +05:30 [INF] 🔁 Matched CTA Step → "c48d2b3f-95af-43d4-bed2-d17763e5012f"
2025-07-03 10:51:44.576 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f" | TrackingLogId: "01e50312-2082-4263-9295-30741fa7de8a"
2025-07-03 10:51:44.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__trackingLogId_0='01e50312-2082-4263-9295-30741fa7de8a'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:51:44.581 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='c48d2b3f-95af-43d4-bed2-d17763e5012f' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:51:44.582 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "c48d2b3f-95af-43d4-bed2-d17763e5012f", Template: flow_step_3
2025-07-03 10:51:44.583 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:44.584 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:51:45.544 +05:30 [INF] Received HTTP response headers after 959.3896ms - 200
2025-07-03 10:51:45.546 +05:30 [INF] End processing HTTP request after 962.6857ms - 200
2025-07-03 10:51:45.567 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='429da9c8-2fd4-4041-b175-52ea39f8aea2', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:21:45.5484061Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_3' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:21:45.5484057Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:51:45.570 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='7d623326-3071-4f36-93de-eae38e9de225', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:21:45.5693242Z' (DbType = DateTime), @p5='e5ae6421-5d6a-4211-86e2-ed16a0457220' (Nullable = true), @p6=NULL, @p7='c48d2b3f-95af-43d4-bed2-d17763e5012f', @p8='' (Nullable = false), @p9='True', @p10='flow_step_3', @p11='text_template', @p12='01e50312-2082-4263-9295-30741fa7de8a' (Nullable = true), @p13='More Options'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:51:45.572 +05:30 [INF] ✅ Flow step executed → Template: flow_step_3 sent to 917082156227
2025-07-03 10:51:45.573 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:51:47.431 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:51:47.433 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:47.434 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:47.436 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"sent","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","expiration_timestamp":"1751520110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.437 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:47.437 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"sent","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","expiration_timestamp":"1751520110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.438 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:47.439 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:47.440 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3553ms
2025-07-03 10:51:47.440 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"sent","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","expiration_timestamp":"1751520110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.441 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:47.444 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:47.444 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.765ms
2025-07-03 10:51:47.445 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==
2025-07-03 10:51:47.448 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==
2025-07-03 10:51:47.492 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:51:47.495 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:47.496 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:51:47.498 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"delivered","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.499 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:51:47.499 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"delivered","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.500 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:51:47.501 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:51:47.502 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4801ms
2025-07-03 10:51:47.502 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==","status":"delivered","timestamp":"1751520110","recipient_id":"917082156227","conversation":{"id":"8008fcbd711aebed76ab06ce5d197167","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:51:47.503 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:51:47.506 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:51:47.506 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.8557ms
2025-07-03 10:51:47.507 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==
2025-07-03 10:51:47.510 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==
2025-07-03 10:52:11.001 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 635
2025-07-03 10:52:11.007 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:11.008 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:52:11.009 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjJGRUJGMkI0MjE3Qzc0OTlCNzRFNTk2QjEwN0UwMkEA","timestamp":"1751520134","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:52:11.011 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:52:11.011 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=="},"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjJGRUJGMkI0MjE3Qzc0OTlCNzRFNTk2QjEwN0UwMkEA","timestamp":"1751520134","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 10:52:11.011 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:52:11.013 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 10:52:11.014 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0376ms
2025-07-03 10:52:11.015 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 10:52:11.015 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:11.016 +05:30 [INF] 🖱️ Button Click → From: 917082156227, ClickId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjJGRUJGMkI0MjE3Qzc0OTlCNzRFNTk2QjEwN0UwMkEA, OrigMsgId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==, Text: Show Products
2025-07-03 10:52:11.017 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.3123ms
2025-07-03 10:52:11.071 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 10:52:11.074 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 10:52:11.076 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 10:52:12.921 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 10:52:12.942 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='ddac63bd-9083-495d-904a-7587947159ce', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Show Products', @p4='Show Products', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:22:11.0768532Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='917082156227', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0RCMUZEQzU2OEE0NzRDNjNEAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 10:52:12.945 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 10:52:12.947 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='show products', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 10:52:12.949 +05:30 [INF] ✅ Fallback flow step matched: StepId = "f275e674-9545-4c05-a830-3d531d7f3930", Flow = Tes001
2025-07-03 10:52:12.950 +05:30 [INF] 🔁 Matched CTA Step → "f275e674-9545-4c05-a830-3d531d7f3930"
2025-07-03 10:52:12.951 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "f275e674-9545-4c05-a830-3d531d7f3930" | TrackingLogId: "ddac63bd-9083-495d-904a-7587947159ce"
2025-07-03 10:52:12.953 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__trackingLogId_0='ddac63bd-9083-495d-904a-7587947159ce'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 10:52:12.956 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='f275e674-9545-4c05-a830-3d531d7f3930' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 10:52:12.958 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "f275e674-9545-4c05-a830-3d531d7f3930", Template: flow_step_2
2025-07-03 10:52:12.959 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:52:12.960 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 10:52:14.381 +05:30 [INF] Received HTTP response headers after 1420.4744ms - 200
2025-07-03 10:52:14.382 +05:30 [INF] End processing HTTP request after 1423.2688ms - 200
2025-07-03 10:52:14.386 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='9987b82b-0cf3-43e9-8c93-974b33345754', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:22:14.3844343Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:22:14.3844339Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 10:52:14.388 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='c16d0a62-0a1c-465a-922d-6c2604b51eff', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='917082156227', @p3=NULL, @p4='2025-07-03T05:22:14.3878288Z' (DbType = DateTime), @p5='123b5480-fef7-4f42-8d58-c270fbd534c9' (Nullable = true), @p6=NULL, @p7='f275e674-9545-4c05-a830-3d531d7f3930', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='ddac63bd-9083-495d-904a-7587947159ce' (Nullable = true), @p13='Show Products'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 10:52:14.390 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to 917082156227
2025-07-03 10:52:14.391 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 10:52:15.386 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:52:15.388 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:15.389 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:52:15.391 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"sent","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","expiration_timestamp":"1751520139","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.392 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:52:15.392 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"sent","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","expiration_timestamp":"1751520139","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.393 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:52:15.394 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:52:15.395 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6591ms
2025-07-03 10:52:15.396 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"sent","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","expiration_timestamp":"1751520139","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.397 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:15.400 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:52:15.400 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.7626ms
2025-07-03 10:52:15.402 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==
2025-07-03 10:52:15.405 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==
2025-07-03 10:52:15.945 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:52:15.947 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:15.948 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:52:15.949 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"delivered","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.951 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:52:15.951 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"delivered","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.951 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:52:15.952 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:52:15.953 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0164ms
2025-07-03 10:52:15.954 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==","status":"delivered","timestamp":"1751520139","recipient_id":"917082156227","conversation":{"id":"1c444a10ee112d27de68762e0ed8a3b8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:52:15.955 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:52:15.957 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:52:15.957 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.5295ms
2025-07-03 10:52:15.959 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==
2025-07-03 10:52:15.962 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTJFNUJFMkZGQzk1MjUxQ0RCAA==
2025-07-03 10:55:45.406 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:55:45.409 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:55:45.409 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:55:45.411 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"delivered","timestamp":"1751519960","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:55:45.412 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:55:45.412 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"delivered","timestamp":"1751519960","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:55:45.413 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:55:45.414 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:55:45.415 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0137ms
2025-07-03 10:55:45.416 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"delivered","timestamp":"1751519960","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:55:45.427 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:55:45.429 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.1436ms
2025-07-03 10:55:45.430 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:55:45.440 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='bfb00a2a-7e8e-42ed-84a0-2cdb60b78767'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 10:55:45.444 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='bfb00a2a-7e8e-42ed-84a0-2cdb60b78767', @p0='2025-07-03T05:19:20.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 10:55:45.446 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA== → delivered
2025-07-03 10:56:00.597 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:56:00.599 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:00.600 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:56:00.602 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"sent","timestamp":"1751519957","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","expiration_timestamp":"1751519957","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:00.603 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:56:00.603 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"sent","timestamp":"1751519957","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","expiration_timestamp":"1751519957","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:00.603 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:56:00.604 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:56:00.605 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2124ms
2025-07-03 10:56:00.606 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"sent","timestamp":"1751519957","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","expiration_timestamp":"1751519957","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:00.607 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:00.609 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:56:00.609 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.3714ms
2025-07-03 10:56:00.611 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='f4bf52ee-3123-49b6-addb-9a67c8f039fd'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 10:56:00.615 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA== → sent
2025-07-03 10:56:14.688 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:56:14.690 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:14.691 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:56:14.693 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"delivered","timestamp":"1751519958","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:14.694 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:56:14.694 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"delivered","timestamp":"1751519958","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:14.694 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:56:14.696 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:56:14.696 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0769ms
2025-07-03 10:56:14.697 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"delivered","timestamp":"1751519958","recipient_id":"447543746206","conversation":{"id":"8a0e9b3b3fdcea1a4c39d947ecade8c6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:14.698 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:14.701 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:56:14.701 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.5933ms
2025-07-03 10:56:14.704 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='f4bf52ee-3123-49b6-addb-9a67c8f039fd'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 10:56:14.709 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='f4bf52ee-3123-49b6-addb-9a67c8f039fd', @p0='2025-07-03T05:19:18.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 10:56:14.711 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA== → delivered
2025-07-03 10:56:36.621 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 10:56:36.624 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:36.624 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:56:36.626 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"delivered","timestamp":"1751519962","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:36.627 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:56:36.627 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"delivered","timestamp":"1751519962","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:36.628 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:56:36.629 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:56:36.630 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0705ms
2025-07-03 10:56:36.630 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"delivered","timestamp":"1751519962","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:36.631 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:36.633 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.2135ms
2025-07-03 10:56:36.634 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:56:36.642 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='f646c600-cc88-41f4-a6b6-46515df49965'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 10:56:36.645 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='f646c600-cc88-41f4-a6b6-46515df49965', @p0='2025-07-03T05:19:22.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 10:56:36.646 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA== → delivered
2025-07-03 10:56:39.163 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 10:56:39.165 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:39.166 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 10:56:39.167 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"sent","timestamp":"1751519959","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","expiration_timestamp":"1751519959","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:39.168 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 10:56:39.169 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"sent","timestamp":"1751519959","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","expiration_timestamp":"1751519959","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:39.169 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 10:56:39.170 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 10:56:39.171 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.107ms
2025-07-03 10:56:39.172 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA==","status":"sent","timestamp":"1751519959","recipient_id":"917082156227","conversation":{"id":"d094812eb6f837d3a137bc37ef9d034f","expiration_timestamp":"1751519959","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 10:56:39.172 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 10:56:39.174 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 10:56:39.175 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.6578ms
2025-07-03 10:56:39.177 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='bfb00a2a-7e8e-42ed-84a0-2cdb60b78767'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 10:56:39.199 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p1='bfb00a2a-7e8e-42ed-84a0-2cdb60b78767', @p0='Sent'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "SendStatus" = @p0
WHERE "Id" = @p1;
2025-07-03 10:56:39.201 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDk5QzVGQ0Y2MDIwRDc4RDIxAA== → sent
2025-07-03 11:02:17.055 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 11:02:17.062 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:02:17.063 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:17.063 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 11:02:17.116 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 11:02:17.118 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:17.119 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:18.739 +05:30 [INF] Received HTTP response headers after 1619.2269ms - 200
2025-07-03 11:02:18.740 +05:30 [INF] End processing HTTP request after 1622.1245ms - 200
2025-07-03 11:02:18.741 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=v97__gkkhXWCpM2I-2RiCQ&oh=01_Q5Aa1wHVF9OBOimXXcVPIDdTjIxDam7-cC4eL8CI_FHYAF8jrg&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 11:02:18.744 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:02:18.745 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1680.4955ms
2025-07-03 11:02:18.746 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:18.747 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1692.0566ms
2025-07-03 11:02:21.560 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 11:02:21.562 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:02:21.563 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:21.564 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 11:02:21.568 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 11:02:21.577 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:21.578 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:22.228 +05:30 [INF] Received HTTP response headers after 648.7319ms - 200
2025-07-03 11:02:22.229 +05:30 [INF] End processing HTTP request after 652.2955ms - 200
2025-07-03 11:02:22.243 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=NIRwTpYN-Z5-hzKf509sqw&oh=01_Q5Aa1wGN8dVu7FbJWaN54aqs5giM9hi_vgTVjvcEs-r8gDoBEQ&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 11:02:22.246 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:02:22.248 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 682.5753ms
2025-07-03 11:02:22.250 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:22.251 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 691.3295ms
2025-07-03 11:02:26.533 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 11:02:26.536 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:02:26.537 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:26.538 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 11:02:26.541 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 11:02:26.543 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:26.544 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:27.485 +05:30 [INF] Received HTTP response headers after 939.5079ms - 200
2025-07-03 11:02:27.486 +05:30 [INF] End processing HTTP request after 942.8845ms - 200
2025-07-03 11:02:27.500 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=173aPhXYHu8tNuMuV8smMQ&oh=01_Q5Aa1wGYoTkBcLb6iGXidk5CPopzN90qi9ec3YCcKJ63o0zJcg&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 11:02:27.503 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:02:27.504 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 965.2824ms
2025-07-03 11:02:27.506 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:27.507 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 973.3147ms
2025-07-03 11:02:51.980 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 11:02:51.982 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:02:51.983 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:51.984 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 11:02:51.987 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 11:02:51.990 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:51.991 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:02:52.564 +05:30 [INF] Received HTTP response headers after 571.658ms - 200
2025-07-03 11:02:52.565 +05:30 [INF] End processing HTTP request after 575.076ms - 200
2025-07-03 11:02:52.575 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=9npwCzQFttetWlcXtMNOhw&oh=01_Q5Aa1wFrUKoSl0_Ib2HndHWiVLe0uWr-Fb82tUsDrWMjj9G-lA&oe=688D6BA3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 11:02:52.578 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:02:52.579 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 594.0214ms
2025-07-03 11:02:52.581 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:02:52.583 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 603.3769ms
2025-07-03 11:03:02.847 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - null null
2025-07-03 11:03:02.849 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:03:02.850 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - 204 null null 3.5096ms
2025-07-03 11:03:02.852 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - application/json 2727
2025-07-03 11:03:02.856 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:03:02.858 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 11:03:02.859 +05:30 [INF] Route matched with {action = "SaveVisualFlow", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveVisualFlow(xbytechat.api.Features.CTAFlowBuilder.DTOs.SaveVisualFlowDto) on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-03 11:03:05.455 +05:30 [INF] 📦 Saving CTA Flow: FirstFlow by Tata Consultancy Services
2025-07-03 11:03:05.456 +05:30 [INF] 🧠 SaveVisualFlow started | FlowName: FirstFlow | BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:03:05.461 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_FlowName_0='FirstFlow', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
FROM "CTAFlowConfigs" AS c
WHERE c."FlowName" = @__dto_FlowName_0 AND c."BusinessId" = @__businessId_1
LIMIT 1
2025-07-03 11:03:05.463 +05:30 [INF] ✅ New FlowConfig created with ID: "a56134f8-4f96-482d-a62b-b40127659609"
2025-07-03 11:03:05.470 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='a56134f8-4f96-482d-a62b-b40127659609', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='2025-07-03T05:33:05.4636873Z' (DbType = DateTime), @p3='Tata Consultancy Services', @p4='FirstFlow' (Nullable = false), @p5='True', @p6='True', @p7='2025-07-03T05:33:05.4636873Z' (Nullable = true) (DbType = DateTime), @p8='4fb7142a-3ee9-45df-87cc-c82c88ccf272', @p9='a56134f8-4f96-482d-a62b-b40127659609', @p10='216.1195' (Nullable = true), @p11='331.0725' (Nullable = true), @p12=NULL, @p13=NULL, @p14='3', @p15='flow_step_4' (Nullable = false), @p16='text_template', @p17='Show Products' (Nullable = false), @p18='QUICK_REPLY' (Nullable = false), @p19='62634fdf-89f5-452e-9e58-578e87eccedd', @p20='a56134f8-4f96-482d-a62b-b40127659609', @p21='-284.4357' (Nullable = true), @p22='49.957718' (Nullable = true), @p23=NULL, @p24=NULL, @p25='0', @p26='flow_step_1' (Nullable = false), @p27='text_template', @p28='Yes, show me' (Nullable = false), @p29='cta' (Nullable = false), @p30='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759', @p31='a56134f8-4f96-482d-a62b-b40127659609', @p32='115.76563' (Nullable = true), @p33='29.716608' (Nullable = true), @p34=NULL, @p35=NULL, @p36='1', @p37='flow_step_2' (Nullable = false), @p38='text_template', @p39='Yes, show me' (Nullable = false), @p40='QUICK_REPLY' (Nullable = false), @p41='ff615e65-b3fa-4275-88a5-0703acb39e04', @p42='a56134f8-4f96-482d-a62b-b40127659609', @p43='475.06625' (Nullable = true), @p44='81.25877' (Nullable = true), @p45=NULL, @p46=NULL, @p47='2', @p48='flow_step_3' (Nullable = false), @p49='text_template', @p50='More Options' (Nullable = false), @p51='QUICK_REPLY' (Nullable = false), @p52='950a5956-0f8d-451f-a08d-3ed011541d91', @p53='quick_reply' (Nullable = false), @p54='Show Products' (Nullable = false), @p55='QUICK_REPLY' (Nullable = false), @p56='' (Nullable = false), @p57='ff615e65-b3fa-4275-88a5-0703acb39e04', @p58='4fb7142a-3ee9-45df-87cc-c82c88ccf272' (Nullable = true), @p59='bc428d40-5d56-4e82-8d7d-31325cb928b7', @p60='quick_reply' (Nullable = false), @p61='More Options' (Nullable = false), @p62='QUICK_REPLY' (Nullable = false), @p63='' (Nullable = false), @p64='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759', @p65='ff615e65-b3fa-4275-88a5-0703acb39e04' (Nullable = true), @p66='f6b4a1b7-d7f9-4c9a-9245-dfe8e1547c49', @p67='quick_reply' (Nullable = false), @p68='Yes, show me' (Nullable = false), @p69='QUICK_REPLY' (Nullable = false), @p70='' (Nullable = false), @p71='62634fdf-89f5-452e-9e58-578e87eccedd', @p72='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CTAFlowConfigs" ("Id", "BusinessId", "CreatedAt", "CreatedBy", "FlowName", "IsActive", "IsPublished", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38, @p39, @p40);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p52, @p53, @p54, @p55, @p56, @p57, @p58);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p59, @p60, @p61, @p62, @p63, @p64, @p65);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p66, @p67, @p68, @p69, @p70, @p71, @p72);
2025-07-03 11:03:05.488 +05:30 [INF] ✅ Flow 'FirstFlow' saved | Steps: 4 | Links: 6
2025-07-03 11:03:05.490 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:03:05.491 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api) in 2630.4ms
2025-07-03 11:03:05.492 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 11:03:05.493 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - 200 null application/json; charset=utf-8 2641.8812ms
2025-07-03 11:03:23.334 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:03:23.336 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:03:23.337 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:03:23.339 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:03:23.340 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.807ms
2025-07-03 11:03:23.341 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:03:23.342 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.0436ms
2025-07-03 11:03:23.387 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:03:23.391 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:03:23.392 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:03:23.399 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:03:23.402 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:03:23.405 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:03:23.408 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:03:23.408 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:03:23.409 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:03:23.410 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:03:23.411 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:03:23.413 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:03:23.414 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:03:23.415 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:03:23.416 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:03:23.416 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:03:23.417 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:03:23.418 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:03:23.419 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:03:23.421 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 26.4585ms
2025-07-03 11:03:23.422 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:03:23.423 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 35.7968ms
2025-07-03 11:03:36.875 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 11:03:36.877 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:03:36.878 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:03:36.880 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:03:36.886 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 11:03:36.888 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:03:36.889 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 8.3237ms
2025-07-03 11:03:36.891 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:03:36.892 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 16.6579ms
2025-07-03 11:03:54.367 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 11:03:54.369 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:03:54.370 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:03:54.371 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:03:54.375 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 11:03:54.378 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:03:54.379 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 6.7607ms
2025-07-03 11:03:54.380 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:03:54.381 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 14.4225ms
2025-07-03 11:04:10.159 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 11:04:10.161 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:04:10.163 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:04:10.164 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:04:10.168 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 11:04:10.171 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:04:10.173 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.6018ms
2025-07-03 11:04:10.174 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:04:10.175 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 16.3451ms
2025-07-03 11:04:14.529 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 11:04:14.531 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:04:14.533 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:04:14.534 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:04:14.539 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 11:04:14.541 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:04:14.543 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.7233ms
2025-07-03 11:04:14.544 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:04:14.545 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 16.3321ms
2025-07-03 11:06:19.586 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:06:19.588 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:06:19.589 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:06:19.591 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:06:19.592 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.2678ms
2025-07-03 11:06:19.592 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:06:19.593 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 6.9671ms
2025-07-03 11:06:19.642 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:06:19.645 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:06:19.646 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:06:19.650 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:06:19.653 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:06:19.655 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:06:19.657 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:06:19.658 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:06:19.658 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:06:19.659 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:06:19.659 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:06:19.660 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:06:19.660 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:06:19.661 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:06:19.662 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:06:19.662 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:06:19.663 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:06:19.663 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:06:19.665 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:06:19.666 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.3257ms
2025-07-03 11:06:19.667 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:06:19.668 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.9995ms
2025-07-03 11:06:19.694 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 11:06:19.697 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:06:19.697 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:19.698 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:06:19.702 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 11:06:19.705 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:06:19.706 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 6.0812ms
2025-07-03 11:06:19.707 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:19.708 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 13.987ms
2025-07-03 11:06:23.874 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 11:06:23.877 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:06:23.878 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:23.879 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:06:23.883 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 11:06:23.885 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:06:23.886 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 6.1986ms
2025-07-03 11:06:23.887 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:23.888 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 14.0685ms
2025-07-03 11:06:29.465 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 11:06:29.467 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:06:29.468 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:29.469 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:06:29.473 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 11:06:29.477 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:06:29.478 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 7.5248ms
2025-07-03 11:06:29.479 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:06:29.480 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 15.133ms
2025-07-03 11:06:33.953 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-03 11:06:33.956 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:06:33.958 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 11:06:33.959 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:06:33.962 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-03 11:06:33.967 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-03 11:06:33.969 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:06:33.970 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 10.4022ms
2025-07-03 11:06:33.972 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-03 11:06:33.973 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 19.6755ms
2025-07-03 11:07:59.450 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 11:07:59.456 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:07:59.457 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:07:59.459 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 11:07:59.521 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 11:07:59.523 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:07:59.524 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:08:00.307 +05:30 [INF] Received HTTP response headers after 782.4407ms - 200
2025-07-03 11:08:00.308 +05:30 [INF] End processing HTTP request after 785.4915ms - 200
2025-07-03 11:08:00.310 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwFT-iJG&_nc_oc=Adm8xQCaOxceNdM6mVrkNMOxh4Qzi7jHScxWnx4oX08XytQ8MtfqGzXIVpdi-T3VUhNyy9wGDBPw_PDzJ2nziTTN&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=dJVayybcT3FP4s8jNoE-kg&oh=01_Q5Aa1wEYagIF-SBbFSy7x34bYRmXVmyjrsrWzNgs8rmm7Leztw&oe=688DA3E3"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 11:08:00.312 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:00.313 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 852.6632ms
2025-07-03 11:08:00.314 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 11:08:00.315 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 865.1555ms
2025-07-03 11:08:11.879 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - null null
2025-07-03 11:08:11.882 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:11.882 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - 204 null null 3.1819ms
2025-07-03 11:08:11.883 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - application/json 373
2025-07-03 11:08:11.887 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:11.887 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 11:08:11.888 +05:30 [INF] Route matched with {action = "CreateTextCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTextCampaign(xbytechat.api.Features.CampaignModule.DTOs.CampaignCreateDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:08:12.941 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 11:08:12.944 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:08:12.945 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:08:13.747 +05:30 [INF] Received HTTP response headers after 801.4528ms - 200
2025-07-03 11:08:13.748 +05:30 [INF] End processing HTTP request after 804.7357ms - 200
2025-07-03 11:08:13.753 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='612f9239-e554-488d-942f-e5e541d4857d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3='text', @p4='2025-07-03T05:38:13.7502489Z' (DbType = DateTime), @p5='system', @p6=NULL (DbType = Guid), @p7=NULL (DbType = DateTime), @p8=NULL, @p9=NULL, @p10=NULL, @p11=NULL, @p12='False', @p13='Hi 👋, would you like to explore our special offer?', @p14='flow_step_1' (Nullable = false), @p15='FlowCampaign' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL (DbType = Guid), @p18='Draft' (Nullable = false), @p19='flow_step_1', @p20='[]', @p21='2025-07-03T05:38:13.7502491Z' (DbType = DateTime), @p22='6c8ac922-6836-46fc-9c35-e54f71835683', @p23='612f9239-e554-488d-942f-e5e541d4857d', @p24='True', @p25='2', @p26='No, thanks' (Nullable = false), @p27='QUICK_REPLY' (Nullable = false), @p28='' (Nullable = false), @p29='cb0a5c40-459b-4c90-9d3c-32fc67d212fe', @p30='612f9239-e554-488d-942f-e5e541d4857d', @p31='True', @p32='1', @p33='Yes, show me' (Nullable = false), @p34='QUICK_REPLY' (Nullable = false), @p35='' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Campaigns" ("Id", "BusinessId", "CampaignId", "CampaignType", "CreatedAt", "CreatedBy", "CtaId", "DeletedAt", "DeletedBy", "FollowUpTemplateId", "ImageCaption", "ImageUrl", "IsDeleted", "MessageBody", "MessageTemplate", "Name", "ScheduledAt", "SourceCampaignId", "Status", "TemplateId", "TemplateParameters", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p22, @p23, @p24, @p25, @p26, @p27, @p28);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p29, @p30, @p31, @p32, @p33, @p34, @p35);
2025-07-03 11:08:13.774 +05:30 [INF] ✅ Campaign 'FlowCampaign' created with 0 recipients, 0 user buttons, 2 template buttons and 0 template parameters
2025-07-03 11:08:13.776 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:13.777 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api) in 1887.7235ms
2025-07-03 11:08:13.779 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 11:08:13.779 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - 200 null application/json; charset=utf-8 1896.0769ms
2025-07-03 11:08:13.839 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d - null null
2025-07-03 11:08:13.842 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - null null
2025-07-03 11:08:13.840 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 11:08:13.846 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:13.847 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:13.849 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:13.849 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 11:08:13.850 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 11:08:13.850 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 11:08:13.851 +05:30 [INF] Route matched with {action = "GetCampaignById", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignModule.DTOs.CampaignDto]] GetCampaignById(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:08:13.851 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:08:13.852 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 11:08:13.857 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=1000
2025-07-03 11:08:13.856 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='612f9239-e554-488d-942f-e5e541d4857d', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t."Id0", t."BusinessId0", t."ButtonText", t."ButtonType", t."CreatedAt0", t."Description", t."IsActive", t."TargetUrl", t."Title", t."UpdatedAt0", c1."Id", c1."CampaignId", c1."IsFromTemplate", c1."Position", c1."Title", c1."Type", c1."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt", c0."Id" AS "Id0", c0."BusinessId" AS "BusinessId0", c0."ButtonText", c0."ButtonType", c0."CreatedAt" AS "CreatedAt0", c0."Description", c0."IsActive", c0."TargetUrl", c0."Title", c0."UpdatedAt" AS "UpdatedAt0"
    FROM "Campaigns" AS c
    LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c1 ON t."Id" = c1."CampaignId"
ORDER BY t."Id", t."Id0"
2025-07-03 11:08:13.871 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignModule.DTOs.CampaignDto'.
2025-07-03 11:08:13.873 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api) in 19.7355ms
2025-07-03 11:08:13.874 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 11:08:13.875 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d - 200 null application/json; charset=utf-8 35.5799ms
2025-07-03 11:08:13.917 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 11:08:13.919 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:08:13.919 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 58.6117ms
2025-07-03 11:08:13.920 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 11:08:13.921 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 11:08:13.923 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:13.924 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 84.0394ms
2025-07-03 11:08:13.924 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 11:08:13.927 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 11:08:13.931 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 11:08:13.934 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:08:13.935 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 6.3195ms
2025-07-03 11:08:13.937 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 11:08:13.938 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 11:08:13.938 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 17.5899ms
2025-07-03 11:08:13.944 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='100', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 11:08:13.947 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:08:13.948 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 91.9873ms
2025-07-03 11:08:13.949 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 11:08:13.949 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - 200 null application/json; charset=utf-8 107.7314ms
2025-07-03 11:08:17.041 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d/assign-contacts - null null
2025-07-03 11:08:17.043 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:17.044 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d/assign-contacts - 204 null null 2.5479ms
2025-07-03 11:08:17.045 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d/assign-contacts - application/json 289
2025-07-03 11:08:17.048 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:17.048 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 11:08:17.049 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:08:17.781 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='612f9239-e554-488d-942f-e5e541d4857d', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 11:08:17.788 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='1087f54c-90fc-4cf4-abd5-0e6ecb6bd47b', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='612f9239-e554-488d-942f-e5e541d4857d', @p4=NULL, @p5=NULL, @p6='0876f654-a362-420f-a912-6bce793436a5', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-03T05:38:17.7842146Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-03T05:38:17.7842146Z' (DbType = DateTime), @p13='16cbe38e-7193-4dba-8bd5-124c3b68b342', @p14=NULL, @p15='c13be597-6ae2-42bb-9d43-925815f24ff8', @p16='612f9239-e554-488d-942f-e5e541d4857d', @p17=NULL, @p18=NULL, @p19='491ee04c-27c4-49e4-9bb8-ef8892951090', @p20='False', @p21=NULL, @p22=NULL, @p23='2025-07-03T05:38:17.7842214Z' (Nullable = true) (DbType = DateTime), @p24='Pending' (Nullable = false), @p25='2025-07-03T05:38:17.7842214Z' (DbType = DateTime), @p26='23bcd81f-e317-4a86-82ee-3ab9952b0ecb', @p27=NULL, @p28='c13be597-6ae2-42bb-9d43-925815f24ff8', @p29='612f9239-e554-488d-942f-e5e541d4857d', @p30=NULL, @p31=NULL, @p32='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p33='False', @p34=NULL, @p35=NULL, @p36='2025-07-03T05:38:17.7841862Z' (Nullable = true) (DbType = DateTime), @p37='Pending' (Nullable = false), @p38='2025-07-03T05:38:17.7841863Z' (DbType = DateTime), @p39='7fadfc17-78f6-4bcf-bf21-89edfb9acc43', @p40=NULL, @p41='c13be597-6ae2-42bb-9d43-925815f24ff8', @p42='612f9239-e554-488d-942f-e5e541d4857d', @p43=NULL, @p44=NULL, @p45='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p46='False', @p47=NULL, @p48=NULL, @p49='2025-07-03T05:38:17.7841982Z' (Nullable = true) (DbType = DateTime), @p50='Pending' (Nullable = false), @p51='2025-07-03T05:38:17.7841983Z' (DbType = DateTime), @p52='99d7346b-e3fa-4040-a13c-99e24dc2e5f4', @p53=NULL, @p54='c13be597-6ae2-42bb-9d43-925815f24ff8', @p55='612f9239-e554-488d-942f-e5e541d4857d', @p56=NULL, @p57=NULL, @p58='8aac7c57-6699-4511-897b-4121b407eb1c', @p59='False', @p60=NULL, @p61=NULL, @p62='2025-07-03T05:38:17.7840749Z' (Nullable = true) (DbType = DateTime), @p63='Pending' (Nullable = false), @p64='2025-07-03T05:38:17.7840751Z' (DbType = DateTime), @p65='ca88e3ca-b2ad-4254-abcf-3210b5cb5236', @p66=NULL, @p67='c13be597-6ae2-42bb-9d43-925815f24ff8', @p68='612f9239-e554-488d-942f-e5e541d4857d', @p69=NULL, @p70=NULL, @p71='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p72='False', @p73=NULL, @p74=NULL, @p75='2025-07-03T05:38:17.7842047Z' (Nullable = true) (DbType = DateTime), @p76='Pending' (Nullable = false), @p77='2025-07-03T05:38:17.7842048Z' (DbType = DateTime), @p78='d0c8fd65-cc62-47c6-a670-94bbdfc3228e', @p79=NULL, @p80='c13be597-6ae2-42bb-9d43-925815f24ff8', @p81='612f9239-e554-488d-942f-e5e541d4857d', @p82=NULL, @p83=NULL, @p84='80c43c6a-508b-47ff-9360-201bfd5521d3', @p85='False', @p86=NULL, @p87=NULL, @p88='2025-07-03T05:38:17.7842271Z' (Nullable = true) (DbType = DateTime), @p89='Pending' (Nullable = false), @p90='2025-07-03T05:38:17.7842271Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p52, @p53, @p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75, @p76, @p77);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90);
2025-07-03 11:08:17.790 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:17.791 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 741.0098ms
2025-07-03 11:08:17.792 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 11:08:17.793 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/612f9239-e554-488d-942f-e5e541d4857d/assign-contacts - 200 null application/json; charset=utf-8 747.8341ms
2025-07-03 11:08:21.726 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 11:08:21.728 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:21.729 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:08:21.738 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:08:21.745 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 11:08:21.749 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:08:21.750 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 9.8986ms
2025-07-03 11:08:21.751 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 11:08:21.752 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 25.6774ms
2025-07-03 11:08:23.630 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/612f9239-e554-488d-942f-e5e541d4857d - null 0
2025-07-03 11:08:23.632 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:08:23.633 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 11:08:23.634 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 11:08:23.639 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='612f9239-e554-488d-942f-e5e541d4857d'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 11:08:23.643 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 11:08:23.644 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:08:23.645 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 11:08:24.542 +05:30 [INF] Received HTTP response headers after 896.381ms - 200
2025-07-03 11:08:24.544 +05:30 [INF] End processing HTTP request after 899.5136ms - 200
2025-07-03 11:08:24.545 +05:30 [INF] 📨 Preparing to send to 917082156227
2025-07-03 11:08:24.546 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:24.547 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:24.549 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:08:24.551 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:24.552 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:25.663 +05:30 [INF] Received HTTP response headers after 1109.6486ms - 200
2025-07-03 11:08:25.664 +05:30 [INF] End processing HTTP request after 1112.8538ms - 200
2025-07-03 11:08:25.666 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:25.667 +05:30 [INF] ✅ Added MessageLog for 917082156227
2025-07-03 11:08:25.668 +05:30 [INF] 📘 Added CampaignSendLog for recipient "1087f54c-90fc-4cf4-abd5-0e6ecb6bd47b"
2025-07-03 11:08:25.668 +05:30 [INF] 📨 Preparing to send to +917654768956
2025-07-03 11:08:25.669 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:25.670 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:25.671 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:25.672 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:26.303 +05:30 [INF] Received HTTP response headers after 630.4096ms - 400
2025-07-03 11:08:26.305 +05:30 [INF] End processing HTTP request after 633.6545ms - 400
2025-07-03 11:08:26.306 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AgXrwY6gmuaGg7RMDzai92w\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:26.307 +05:30 [INF] ✅ Added MessageLog for +917654768956
2025-07-03 11:08:26.308 +05:30 [INF] 📘 Added CampaignSendLog for recipient "16cbe38e-7193-4dba-8bd5-124c3b68b342"
2025-07-03 11:08:26.309 +05:30 [INF] 📨 Preparing to send to 7082156227
2025-07-03 11:08:26.310 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:26.310 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:26.311 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:26.312 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:26.942 +05:30 [INF] Received HTTP response headers after 628.8431ms - 400
2025-07-03 11:08:26.943 +05:30 [INF] End processing HTTP request after 631.8407ms - 400
2025-07-03 11:08:26.945 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AlGFpoZfMoRWOYR6zMSKc5W\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:26.946 +05:30 [INF] ✅ Added MessageLog for 7082156227
2025-07-03 11:08:26.947 +05:30 [INF] 📘 Added CampaignSendLog for recipient "23bcd81f-e317-4a86-82ee-3ab9952b0ecb"
2025-07-03 11:08:26.948 +05:30 [INF] 📨 Preparing to send to 1234567890
2025-07-03 11:08:26.948 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:26.949 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:26.951 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:26.951 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:26.952 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:26.953 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:26.954 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"sent","timestamp":"1751521110","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","expiration_timestamp":"1751521110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:26.955 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:26.956 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:26.956 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"sent","timestamp":"1751521110","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","expiration_timestamp":"1751521110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:26.958 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:26.959 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:26.960 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3967ms
2025-07-03 11:08:26.960 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"sent","timestamp":"1751521110","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","expiration_timestamp":"1751521110","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:26.961 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:26.963 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.294ms
2025-07-03 11:08:26.963 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:26.966 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==
2025-07-03 11:08:26.967 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==
2025-07-03 11:08:27.420 +05:30 [INF] Received HTTP response headers after 463.6705ms - 400
2025-07-03 11:08:27.422 +05:30 [INF] End processing HTTP request after 468.5853ms - 400
2025-07-03 11:08:27.423 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AjSArxUyHIoO5C_PCm9PhWG\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:27.424 +05:30 [INF] ✅ Added MessageLog for 1234567890
2025-07-03 11:08:27.425 +05:30 [INF] 📘 Added CampaignSendLog for recipient "7fadfc17-78f6-4bcf-bf21-89edfb9acc43"
2025-07-03 11:08:27.426 +05:30 [INF] 📨 Preparing to send to +917082156227
2025-07-03 11:08:27.426 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:27.427 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:27.428 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:27.429 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:28.314 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 11:08:28.316 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:28.317 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:28.319 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"delivered","timestamp":"1751521112","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:28.320 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:28.320 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"delivered","timestamp":"1751521112","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:28.320 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:28.322 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:28.323 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.1119ms
2025-07-03 11:08:28.323 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","status":"delivered","timestamp":"1751521112","recipient_id":"917082156227","conversation":{"id":"b2ed5748aead1b8f01388dba1b716825","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:28.324 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:28.327 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.458ms
2025-07-03 11:08:28.327 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:28.331 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==
2025-07-03 11:08:28.332 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==
2025-07-03 11:08:28.338 +05:30 [INF] Received HTTP response headers after 907.721ms - 200
2025-07-03 11:08:28.339 +05:30 [INF] End processing HTTP request after 910.6131ms - 200
2025-07-03 11:08:28.340 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:28.341 +05:30 [INF] ✅ Added MessageLog for +917082156227
2025-07-03 11:08:28.342 +05:30 [INF] 📘 Added CampaignSendLog for recipient "99d7346b-e3fa-4040-a13c-99e24dc2e5f4"
2025-07-03 11:08:28.342 +05:30 [INF] 📨 Preparing to send to 8787878787
2025-07-03 11:08:28.343 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:28.344 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:28.345 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:28.345 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:28.862 +05:30 [INF] Received HTTP response headers after 515.7412ms - 400
2025-07-03 11:08:28.864 +05:30 [INF] End processing HTTP request after 518.8822ms - 400
2025-07-03 11:08:28.866 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"ASu_qFAhByePHlJhDkyImPD\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:28.866 +05:30 [INF] ✅ Added MessageLog for 8787878787
2025-07-03 11:08:28.867 +05:30 [INF] 📘 Added CampaignSendLog for recipient "ca88e3ca-b2ad-4254-abcf-3210b5cb5236"
2025-07-03 11:08:28.868 +05:30 [INF] 📨 Preparing to send to 447543746206
2025-07-03 11:08:28.869 +05:30 [INF] ⏩ Skipping static button 'No, thanks' as it requires no parameters
2025-07-03 11:08:28.869 +05:30 [INF] ⏩ Skipping static button 'Yes, show me' as it requires no parameters
2025-07-03 11:08:28.870 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:28.871 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:29.504 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:29.506 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:29.507 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:29.508 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"sent","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","expiration_timestamp":"1751521113","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.510 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:29.510 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"sent","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","expiration_timestamp":"1751521113","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.511 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:29.512 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:29.513 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8036ms
2025-07-03 11:08:29.513 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"sent","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","expiration_timestamp":"1751521113","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.514 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:29.517 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.2736ms
2025-07-03 11:08:29.517 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:29.521 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==
2025-07-03 11:08:29.522 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==
2025-07-03 11:08:29.738 +05:30 [INF] Received HTTP response headers after 865.875ms - 200
2025-07-03 11:08:29.739 +05:30 [INF] End processing HTTP request after 868.9824ms - 200
2025-07-03 11:08:29.741 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 11:08:29.742 +05:30 [INF] ✅ Added MessageLog for 447543746206
2025-07-03 11:08:29.743 +05:30 [INF] 📘 Added CampaignSendLog for recipient "d0c8fd65-cc62-47c6-a670-94bbdfc3228e"
2025-07-03 11:08:29.743 +05:30 [INF] 💾 Saving all DB changes...
2025-07-03 11:08:29.751 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@p0='16665ec7-b312-487d-8475-99ca02c2a3cc', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T05:38:25.6671673Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_1' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==', @p12='{"messaging_product":"whatsapp","contacts":[{"input":"917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==","message_status":"accepted"}]}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T05:38:25.6671675Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false), @p19='5aa3ed2f-c5a8-4863-853f-892aa80c2e7b', @p20='c13be597-6ae2-42bb-9d43-925815f24ff8', @p21=NULL (DbType = Guid), @p22=NULL (DbType = Guid), @p23='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p24='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p25='2025-07-03T05:38:29.7420853Z' (DbType = DateTime), @p26=NULL, @p27='False', @p28=NULL, @p29='flow_step_1' (Nullable = false), @p30='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==', @p31='{"messaging_product":"whatsapp","contacts":[{"input":"447543746206","wa_id":"447543746206"}],"messages":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","message_status":"accepted"}]}', @p32='447543746206' (Nullable = false), @p33=NULL (DbType = Guid), @p34=NULL, @p35='2025-07-03T05:38:29.7420855Z' (Nullable = true) (DbType = DateTime), @p36=NULL, @p37='Sent' (Nullable = false), @p38='660f6682-71ef-4f1c-a740-ff646a63d13d', @p39='c13be597-6ae2-42bb-9d43-925815f24ff8', @p40=NULL (DbType = Guid), @p41=NULL (DbType = Guid), @p42='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p43='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p44='2025-07-03T05:38:28.3414634Z' (DbType = DateTime), @p45=NULL, @p46='False', @p47=NULL, @p48='flow_step_1' (Nullable = false), @p49='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==', @p50='{"messaging_product":"whatsapp","contacts":[{"input":"+917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","message_status":"accepted"}]}', @p51='+917082156227' (Nullable = false), @p52=NULL (DbType = Guid), @p53=NULL, @p54='2025-07-03T05:38:28.3414635Z' (Nullable = true) (DbType = DateTime), @p55=NULL, @p56='Sent' (Nullable = false), @p57='6d509a1d-a67b-4378-9b5c-a65973d4a763', @p58='c13be597-6ae2-42bb-9d43-925815f24ff8', @p59=NULL (DbType = Guid), @p60=NULL (DbType = Guid), @p61='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p62='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac' (Nullable = true), @p63='2025-07-03T05:38:27.4247268Z' (DbType = DateTime), @p64='API returned error', @p65='False', @p66=NULL, @p67='flow_step_1' (Nullable = false), @p68=NULL, @p69='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AjSArxUyHIoO5C_PCm9PhWG"}}', @p70='1234567890' (Nullable = false), @p71=NULL (DbType = Guid), @p72=NULL, @p73=NULL (DbType = DateTime), @p74=NULL, @p75='Failed' (Nullable = false), @p76='736bdeb9-3972-465f-a742-1dc150f660f4', @p77='c13be597-6ae2-42bb-9d43-925815f24ff8', @p78=NULL (DbType = Guid), @p79=NULL (DbType = Guid), @p80='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p81='1b52f26e-9fad-4233-a6bb-57603945f8d6' (Nullable = true), @p82='2025-07-03T05:38:28.8668744Z' (DbType = DateTime), @p83='API returned error', @p84='False', @p85=NULL, @p86='flow_step_1' (Nullable = false), @p87=NULL, @p88='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"ASu_qFAhByePHlJhDkyImPD"}}', @p89='8787878787' (Nullable = false), @p90=NULL (DbType = Guid), @p91=NULL, @p92=NULL (DbType = DateTime), @p93=NULL, @p94='Failed' (Nullable = false), @p95='d2e9d55a-b5e8-4d1a-804d-99ec4d4eec53', @p96='c13be597-6ae2-42bb-9d43-925815f24ff8', @p97=NULL (DbType = Guid), @p98=NULL (DbType = Guid), @p99='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p100='491ee04c-27c4-49e4-9bb8-ef8892951090' (Nullable = true), @p101='2025-07-03T05:38:26.3077043Z' (DbType = DateTime), @p102='API returned error', @p103='False', @p104=NULL, @p105='flow_step_1' (Nullable = false), @p106=NULL, @p107='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AgXrwY6gmuaGg7RMDzai92w"}}', @p108='+917654768956' (Nullable = false), @p109=NULL (DbType = Guid), @p110=NULL, @p111=NULL (DbType = DateTime), @p112=NULL, @p113='Failed' (Nullable = false), @p114='f411dcb1-0584-4fca-a3d1-3d9bf607166e', @p115='c13be597-6ae2-42bb-9d43-925815f24ff8', @p116=NULL (DbType = Guid), @p117=NULL (DbType = Guid), @p118='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p119='867c9c9b-f85e-4572-9bbd-4447b44597b7' (Nullable = true), @p120='2025-07-03T05:38:26.9465618Z' (DbType = DateTime), @p121='API returned error', @p122='False', @p123=NULL, @p124='flow_step_1' (Nullable = false), @p125=NULL, @p126='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AlGFpoZfMoRWOYR6zMSKc5W"}}', @p127='7082156227' (Nullable = false), @p128=NULL (DbType = Guid), @p129=NULL, @p130=NULL (DbType = DateTime), @p131=NULL, @p132='Failed' (Nullable = false), @p133='235f7058-f0f0-4142-b213-b1931f46c936', @p134='True', @p135=NULL, @p136='00000000-0000-0000-0000-000000000000', @p137='612f9239-e554-488d-942f-e5e541d4857d', @p138=NULL, @p139=NULL, @p140=NULL (DbType = DateTime), @p141='8aac7c57-6699-4511-897b-4121b407eb1c', @p142=NULL, @p143='2025-07-03T05:38:28.3422130Z' (DbType = DateTime), @p144='system', @p145=NULL (DbType = DateTime), @p146=NULL, @p147=NULL, @p148=NULL, @p149=NULL, @p150='False', @p151=NULL (DbType = DateTime), @p152=NULL, @p153=NULL, @p154='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p155='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==', @p156='660f6682-71ef-4f1c-a740-ff646a63d13d' (Nullable = true), @p157=NULL (DbType = DateTime), @p158='99d7346b-e3fa-4040-a13c-99e24dc2e5f4', @p159='0', @p160='Sent', @p161='2025-07-03T05:38:28.3422130Z' (Nullable = true) (DbType = DateTime), @p162=NULL, @p163='flow_step_1', @p164=NULL (DbType = Guid), @p165='559bf48a-7c75-47a4-8d1c-2e15ca27d1ac', @p166='True', @p167=NULL, @p168='00000000-0000-0000-0000-000000000000', @p169='612f9239-e554-488d-942f-e5e541d4857d', @p170=NULL, @p171=NULL, @p172=NULL (DbType = DateTime), @p173='0876f654-a362-420f-a912-6bce793436a5', @p174=NULL, @p175='2025-07-03T05:38:25.6680693Z' (DbType = DateTime), @p176='system', @p177=NULL (DbType = DateTime), @p178=NULL, @p179=NULL, @p180=NULL, @p181=NULL, @p182='False', @p183=NULL (DbType = DateTime), @p184=NULL, @p185=NULL, @p186='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p187='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYyNjA3OEIyNjUyOTFBMjU1AA==', @p188='16665ec7-b312-487d-8475-99ca02c2a3cc' (Nullable = true), @p189=NULL (DbType = DateTime), @p190='1087f54c-90fc-4cf4-abd5-0e6ecb6bd47b', @p191='0', @p192='Sent', @p193='2025-07-03T05:38:25.6680693Z' (Nullable = true) (DbType = DateTime), @p194=NULL, @p195='flow_step_1', @p196=NULL (DbType = Guid), @p197='63c76965-0ed3-4453-bf9b-3af6e1112b80', @p198='True', @p199=NULL, @p200='00000000-0000-0000-0000-000000000000', @p201='612f9239-e554-488d-942f-e5e541d4857d', @p202=NULL, @p203=NULL, @p204=NULL (DbType = DateTime), @p205='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p206=NULL, @p207='2025-07-03T05:38:27.4255397Z' (DbType = DateTime), @p208='system', @p209=NULL (DbType = DateTime), @p210=NULL, @p211=NULL, @p212=NULL, @p213=NULL, @p214='False', @p215=NULL (DbType = DateTime), @p216=NULL, @p217=NULL, @p218='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p219=NULL, @p220='6d509a1d-a67b-4378-9b5c-a65973d4a763' (Nullable = true), @p221=NULL (DbType = DateTime), @p222='7fadfc17-78f6-4bcf-bf21-89edfb9acc43', @p223='0', @p224='Failed', @p225='2025-07-03T05:38:27.4255398Z' (Nullable = true) (DbType = DateTime), @p226=NULL, @p227='flow_step_1', @p228=NULL (DbType = Guid), @p229='8d4a15bb-b144-4826-952e-13e17a874d26', @p230='True', @p231=NULL, @p232='00000000-0000-0000-0000-000000000000', @p233='612f9239-e554-488d-942f-e5e541d4857d', @p234=NULL, @p235=NULL, @p236=NULL (DbType = DateTime), @p237='491ee04c-27c4-49e4-9bb8-ef8892951090', @p238=NULL, @p239='2025-07-03T05:38:26.3085340Z' (DbType = DateTime), @p240='system', @p241=NULL (DbType = DateTime), @p242=NULL, @p243=NULL, @p244=NULL, @p245=NULL, @p246='False', @p247=NULL (DbType = DateTime), @p248=NULL, @p249=NULL, @p250='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p251=NULL, @p252='d2e9d55a-b5e8-4d1a-804d-99ec4d4eec53' (Nullable = true), @p253=NULL (DbType = DateTime), @p254='16cbe38e-7193-4dba-8bd5-124c3b68b342', @p255='0', @p256='Failed', @p257='2025-07-03T05:38:26.3085341Z' (Nullable = true) (DbType = DateTime), @p258=NULL, @p259='flow_step_1', @p260=NULL (DbType = Guid), @p261='bce0c30e-b101-4dfa-816b-20e7f4b0abb7', @p262='True', @p263=NULL, @p264='00000000-0000-0000-0000-000000000000', @p265='612f9239-e554-488d-942f-e5e541d4857d', @p266=NULL, @p267=NULL, @p268=NULL (DbType = DateTime), @p269='80c43c6a-508b-47ff-9360-201bfd5521d3', @p270=NULL, @p271='2025-07-03T05:38:29.7429220Z' (DbType = DateTime), @p272='system', @p273=NULL (DbType = DateTime), @p274=NULL, @p275=NULL, @p276=NULL, @p277=NULL, @p278='False', @p279=NULL (DbType = DateTime), @p280=NULL, @p281=NULL, @p282='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p283='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==', @p284='5aa3ed2f-c5a8-4863-853f-892aa80c2e7b' (Nullable = true), @p285=NULL (DbType = DateTime), @p286='d0c8fd65-cc62-47c6-a670-94bbdfc3228e', @p287='0', @p288='Sent', @p289='2025-07-03T05:38:29.7429221Z' (Nullable = true) (DbType = DateTime), @p290=NULL, @p291='flow_step_1', @p292=NULL (DbType = Guid), @p293='f54696ae-c7f0-4814-9d15-251f8ace352d', @p294='True', @p295=NULL, @p296='00000000-0000-0000-0000-000000000000', @p297='612f9239-e554-488d-942f-e5e541d4857d', @p298=NULL, @p299=NULL, @p300=NULL (DbType = DateTime), @p301='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p302=NULL, @p303='2025-07-03T05:38:28.8676819Z' (DbType = DateTime), @p304='system', @p305=NULL (DbType = DateTime), @p306=NULL, @p307=NULL, @p308=NULL, @p309=NULL, @p310='False', @p311=NULL (DbType = DateTime), @p312=NULL, @p313=NULL, @p314='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p315=NULL, @p316='736bdeb9-3972-465f-a742-1dc150f660f4' (Nullable = true), @p317=NULL (DbType = DateTime), @p318='ca88e3ca-b2ad-4254-abcf-3210b5cb5236', @p319='0', @p320='Failed', @p321='2025-07-03T05:38:28.8676819Z' (Nullable = true) (DbType = DateTime), @p322=NULL, @p323='flow_step_1', @p324=NULL (DbType = Guid), @p325='fcdfcce7-d136-4d52-a55e-0803db155785', @p326='True', @p327=NULL, @p328='00000000-0000-0000-0000-000000000000', @p329='612f9239-e554-488d-942f-e5e541d4857d', @p330=NULL, @p331=NULL, @p332=NULL (DbType = DateTime), @p333='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p334=NULL, @p335='2025-07-03T05:38:26.9474253Z' (DbType = DateTime), @p336='system', @p337=NULL (DbType = DateTime), @p338=NULL, @p339=NULL, @p340=NULL, @p341=NULL, @p342='False', @p343=NULL (DbType = DateTime), @p344=NULL, @p345=NULL, @p346='Hi 👋, would you like to explore our special offer?' (Nullable = false), @p347=NULL, @p348='f411dcb1-0584-4fca-a3d1-3d9bf607166e' (Nullable = true), @p349=NULL (DbType = DateTime), @p350='23bcd81f-e317-4a86-82ee-3ab9952b0ecb', @p351='0', @p352='Failed', @p353='2025-07-03T05:38:26.9474253Z' (Nullable = true) (DbType = DateTime), @p354=NULL, @p355='flow_step_1', @p356=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64, @p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p76, @p77, @p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90, @p91, @p92, @p93, @p94);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p95, @p96, @p97, @p98, @p99, @p100, @p101, @p102, @p103, @p104, @p105, @p106, @p107, @p108, @p109, @p110, @p111, @p112, @p113);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p114, @p115, @p116, @p117, @p118, @p119, @p120, @p121, @p122, @p123, @p124, @p125, @p126, @p127, @p128, @p129, @p130, @p131, @p132);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p133, @p134, @p135, @p136, @p137, @p138, @p139, @p140, @p141, @p142, @p143, @p144, @p145, @p146, @p147, @p148, @p149, @p150, @p151, @p152, @p153, @p154, @p155, @p156, @p157, @p158, @p159, @p160, @p161, @p162, @p163, @p164);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p165, @p166, @p167, @p168, @p169, @p170, @p171, @p172, @p173, @p174, @p175, @p176, @p177, @p178, @p179, @p180, @p181, @p182, @p183, @p184, @p185, @p186, @p187, @p188, @p189, @p190, @p191, @p192, @p193, @p194, @p195, @p196);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p197, @p198, @p199, @p200, @p201, @p202, @p203, @p204, @p205, @p206, @p207, @p208, @p209, @p210, @p211, @p212, @p213, @p214, @p215, @p216, @p217, @p218, @p219, @p220, @p221, @p222, @p223, @p224, @p225, @p226, @p227, @p228);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p229, @p230, @p231, @p232, @p233, @p234, @p235, @p236, @p237, @p238, @p239, @p240, @p241, @p242, @p243, @p244, @p245, @p246, @p247, @p248, @p249, @p250, @p251, @p252, @p253, @p254, @p255, @p256, @p257, @p258, @p259, @p260);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p261, @p262, @p263, @p264, @p265, @p266, @p267, @p268, @p269, @p270, @p271, @p272, @p273, @p274, @p275, @p276, @p277, @p278, @p279, @p280, @p281, @p282, @p283, @p284, @p285, @p286, @p287, @p288, @p289, @p290, @p291, @p292);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p293, @p294, @p295, @p296, @p297, @p298, @p299, @p300, @p301, @p302, @p303, @p304, @p305, @p306, @p307, @p308, @p309, @p310, @p311, @p312, @p313, @p314, @p315, @p316, @p317, @p318, @p319, @p320, @p321, @p322, @p323, @p324);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p325, @p326, @p327, @p328, @p329, @p330, @p331, @p332, @p333, @p334, @p335, @p336, @p337, @p338, @p339, @p340, @p341, @p342, @p343, @p344, @p345, @p346, @p347, @p348, @p349, @p350, @p351, @p352, @p353, @p354, @p355, @p356);
2025-07-03 11:08:29.764 +05:30 [INF] ✅ All saved successfully.
2025-07-03 11:08:29.765 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:08:29.766 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 6130.0848ms
2025-07-03 11:08:29.767 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 11:08:29.767 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/612f9239-e554-488d-942f-e5e541d4857d - 200 null application/json; charset=utf-8 6137.8901ms
2025-07-03 11:08:29.951 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 11:08:29.954 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:29.955 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:29.956 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"delivered","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.957 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:29.958 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"delivered","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.958 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:29.959 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:29.960 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4706ms
2025-07-03 11:08:29.961 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA==","status":"delivered","timestamp":"1751521113","recipient_id":"917082156227","conversation":{"id":"d4ffa13ac062925f48c11e9a2006cfb3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:29.962 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:29.965 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:29.965 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.5374ms
2025-07-03 11:08:29.967 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='235f7058-f0f0-4142-b213-b1931f46c936'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 11:08:29.971 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p2='235f7058-f0f0-4142-b213-b1931f46c936', @p0='2025-07-03T05:38:33.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 11:08:29.973 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjJBREUxQTFDQ0E2MTREQkMwAA== → delivered
2025-07-03 11:08:30.616 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:30.618 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:30.619 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:30.621 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"sent","timestamp":"1751521114","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","expiration_timestamp":"1751521114","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:30.622 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:30.622 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"sent","timestamp":"1751521114","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","expiration_timestamp":"1751521114","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:30.623 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:30.624 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:30.625 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3956ms
2025-07-03 11:08:30.626 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"sent","timestamp":"1751521114","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","expiration_timestamp":"1751521114","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:30.627 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:30.630 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:30.630 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.158ms
2025-07-03 11:08:30.633 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='bce0c30e-b101-4dfa-816b-20e7f4b0abb7'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 11:08:30.636 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA== → sent
2025-07-03 11:08:32.327 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 11:08:32.329 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:32.330 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:32.331 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"delivered","timestamp":"1751521116","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:32.332 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:32.332 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"delivered","timestamp":"1751521116","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:32.333 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:32.334 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:32.335 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.16ms
2025-07-03 11:08:32.336 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"delivered","timestamp":"1751521116","recipient_id":"447543746206","conversation":{"id":"c82f34de40c2ddd07548226de153b20e","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:32.337 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:32.338 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:32.339 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.1755ms
2025-07-03 11:08:32.341 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='bce0c30e-b101-4dfa-816b-20e7f4b0abb7'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 11:08:32.364 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p2='bce0c30e-b101-4dfa-816b-20e7f4b0abb7', @p0='2025-07-03T05:38:36.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 11:08:32.366 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA== → delivered
2025-07-03 11:08:35.261 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 389
2025-07-03 11:08:35.261 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 389
2025-07-03 11:08:35.263 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:35.265 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:35.266 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:35.267 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:35.268 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.269 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.270 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:35.270 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.271 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:35.272 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:35.273 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:35.273 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:35.274 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.3358ms
2025-07-03 11:08:35.275 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.276 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.2557ms
2025-07-03 11:08:35.276 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:35.278 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:35.279 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:35.279 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.1522ms
2025-07-03 11:08:35.281 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='bce0c30e-b101-4dfa-816b-20e7f4b0abb7'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-03 11:08:35.282 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.3577ms
2025-07-03 11:08:35.304 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p2='bce0c30e-b101-4dfa-816b-20e7f4b0abb7', @p0='2025-07-03T05:38:38.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Read'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "ReadAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-03 11:08:35.307 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA== → read
2025-07-03 11:08:35.308 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.309 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:35.309 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==","status":"read","timestamp":"1751521118","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 11:08:35.311 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:35.313 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==
2025-07-03 11:08:35.314 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSODMxODY2NjE0QzhBM0RDMjZDAA==
2025-07-03 11:08:38.961 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 626
2025-07-03 11:08:38.963 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:38.964 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:38.965 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggN0IwNDQ1OTY0QzY4N0VEQTU4OUE0Q0VGNEJFMDkzODkA","timestamp":"1751521122","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-03 11:08:38.966 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:38.967 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggN0IwNDQ1OTY0QzY4N0VEQTU4OUE0Q0VGNEJFMDkzODkA","timestamp":"1751521122","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-03 11:08:38.967 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:38.968 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 11:08:38.969 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0866ms
2025-07-03 11:08:38.970 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 11:08:38.971 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:38.971 +05:30 [INF] 🖱️ Button Click → From: 447543746206, ClickId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggN0IwNDQ1OTY0QzY4N0VEQTU4OUE0Q0VGNEJFMDkzODkA, OrigMsgId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==, Text: Yes, show me
2025-07-03 11:08:38.972 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.8988ms
2025-07-03 11:08:38.975 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 11:08:38.978 +05:30 [INF] 📊 CampaignSendLog matched via context.id
2025-07-03 11:08:39.547 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 11:08:39.550 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM "CampaignSendLogs" AS c
INNER JOIN "CampaignRecipients" AS c0 ON c."RecipientId" = c0."Id"
WHERE c."MessageId" = @__dto_MessageId_0
LIMIT 1
2025-07-03 11:08:39.570 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p3='bce0c30e-b101-4dfa-816b-20e7f4b0abb7', @p0='Yes, show me', @p1='2025-07-03T05:38:38.9787808Z' (Nullable = true) (DbType = DateTime), @p2='True'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "ClickType" = @p0, "ClickedAt" = @p1, "IsClicked" = @p2
WHERE "Id" = @p3;
2025-07-03 11:08:39.575 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='de4e415a-4e03-4a05-abf4-1eb5f3727569', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Yes, show me', @p4='Yes, show me', @p5='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p6='bce0c30e-b101-4dfa-816b-20e7f4b0abb7' (Nullable = true), @p7=NULL, @p8='2025-07-03T05:38:38.9787808Z' (DbType = DateTime), @p9='webhook', @p10='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p11='447543746206', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMEU2MDk4QjA5QTY1OEEwRkRCAA==', @p18='5aa3ed2f-c5a8-4863-853f-892aa80c2e7b' (Nullable = true), @p19=NULL, @p20=NULL (DbType = Guid), @p21='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @p22='campaign' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 11:08:39.577 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 11:08:39.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='612f9239-e554-488d-942f-e5e541d4857d' (Nullable = true), @__normalizedButtonText_1='yes, show me', @__normalizedTemplateName_2='flow_step_1'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."ButtonText", c."CampaignId", c."CreatedAt", c."CreatedBy", c."OverrideNextTemplate", c."TemplateName"
FROM "CampaignFlowOverrides" AS c
WHERE c."CampaignId" = @__campaignId_0 AND lower(c."ButtonText") = @__normalizedButtonText_1 AND lower(c."TemplateName") = @__normalizedTemplateName_2
LIMIT 1
2025-07-03 11:08:39.580 +05:30 [INF] 🟡 No campaign override found for button 'yes, show me' on template 'flow_step_1'
2025-07-03 11:08:39.582 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='yes, show me', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 11:08:39.584 +05:30 [INF] ✅ Fallback flow step matched: StepId = "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759", Flow = FirstFlow
2025-07-03 11:08:39.585 +05:30 [INF] 🔁 Matched CTA Step → "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759"
2025-07-03 11:08:39.585 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759" | TrackingLogId: "de4e415a-4e03-4a05-abf4-1eb5f3727569"
2025-07-03 11:08:39.588 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__trackingLogId_0='de4e415a-4e03-4a05-abf4-1eb5f3727569'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 11:08:39.591 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 11:08:39.592 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759", Template: flow_step_2
2025-07-03 11:08:39.593 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:39.594 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:40.479 +05:30 [INF] Received HTTP response headers after 884.4676ms - 200
2025-07-03 11:08:40.481 +05:30 [INF] End processing HTTP request after 887.6708ms - 200
2025-07-03 11:08:40.498 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@p0='a7785811-7d30-4abd-bde0-83f3a92f7057', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:38:40.4830098Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:38:40.4830093Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:08:40.507 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@p0='df7e3411-141c-4a94-8319-b26a8ec9d255', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='447543746206', @p3=NULL, @p4='2025-07-03T05:38:40.5010632Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='de4e415a-4e03-4a05-abf4-1eb5f3727569' (Nullable = true), @p13='Yes, show me'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 11:08:40.509 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to 447543746206
2025-07-03 11:08:40.510 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 11:08:41.348 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:41.351 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:41.351 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:41.353 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"sent","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","expiration_timestamp":"1751521125","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:41.354 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:41.354 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"sent","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","expiration_timestamp":"1751521125","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:41.355 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:41.356 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:41.357 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2112ms
2025-07-03 11:08:41.358 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"sent","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","expiration_timestamp":"1751521125","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:41.359 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:41.361 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:41.361 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.1908ms
2025-07-03 11:08:41.363 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==
2025-07-03 11:08:41.366 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==
2025-07-03 11:08:42.023 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-03 11:08:42.026 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:42.026 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:42.028 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"read","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:42.029 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:42.029 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"read","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:42.030 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:42.031 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:42.032 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2107ms
2025-07-03 11:08:42.033 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==","status":"read","timestamp":"1751521125","recipient_id":"447543746206","conversation":{"id":"fd1af9b9b89e29e7d5e22982f6a06b3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:42.034 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:42.036 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:42.036 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.1105ms
2025-07-03 11:08:42.038 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==
2025-07-03 11:08:42.041 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==
2025-07-03 11:08:45.043 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 626
2025-07-03 11:08:45.046 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:45.046 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:45.048 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNzg1N0Y3NTlEMDdDMzg4NkJCNDYxMzgwNDk2RkUzQTEA","timestamp":"1751521128","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 11:08:45.049 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:45.050 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNzg1N0Y3NTlEMDdDMzg4NkJCNDYxMzgwNDk2RkUzQTEA","timestamp":"1751521128","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-03 11:08:45.050 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:45.051 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 11:08:45.052 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6643ms
2025-07-03 11:08:45.053 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 11:08:45.054 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:45.054 +05:30 [INF] 🖱️ Button Click → From: 447543746206, ClickId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNzg1N0Y3NTlEMDdDMzg4NkJCNDYxMzgwNDk2RkUzQTEA, OrigMsgId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==, Text: More Options
2025-07-03 11:08:45.055 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.8043ms
2025-07-03 11:08:45.058 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 11:08:45.061 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==', @__originalMessageId_0_contains='%wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 11:08:45.063 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:08:45.590 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 11:08:45.597 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='be00735d-d7a6-41ae-ac09-347c0dfb888c', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='More Options', @p4='More Options', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:38:45.0637566Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='447543746206', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSMDE5RkE3Qzg3QzVFRUQxN0M4AA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 11:08:45.598 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 11:08:45.600 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='more options', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 11:08:45.602 +05:30 [INF] ✅ Fallback flow step matched: StepId = "ff615e65-b3fa-4275-88a5-0703acb39e04", Flow = FirstFlow
2025-07-03 11:08:45.602 +05:30 [INF] 🔁 Matched CTA Step → "ff615e65-b3fa-4275-88a5-0703acb39e04"
2025-07-03 11:08:45.603 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "ff615e65-b3fa-4275-88a5-0703acb39e04" | TrackingLogId: "be00735d-d7a6-41ae-ac09-347c0dfb888c"
2025-07-03 11:08:45.606 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__trackingLogId_0='be00735d-d7a6-41ae-ac09-347c0dfb888c'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 11:08:45.609 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='ff615e65-b3fa-4275-88a5-0703acb39e04' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 11:08:45.611 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "ff615e65-b3fa-4275-88a5-0703acb39e04", Template: flow_step_3
2025-07-03 11:08:45.612 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:45.613 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:46.558 +05:30 [INF] Received HTTP response headers after 944.4025ms - 200
2025-07-03 11:08:46.559 +05:30 [INF] End processing HTTP request after 947.6241ms - 200
2025-07-03 11:08:46.581 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='910b1783-28b5-4629-ae64-fd142defaa71', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:38:46.5618220Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_3' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:38:46.5618216Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:08:46.585 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='0a438cd9-f5ff-45b7-89a9-d38e15d11c38', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='447543746206', @p3=NULL, @p4='2025-07-03T05:38:46.5836725Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='ff615e65-b3fa-4275-88a5-0703acb39e04', @p8='' (Nullable = false), @p9='True', @p10='flow_step_3', @p11='text_template', @p12='be00735d-d7a6-41ae-ac09-347c0dfb888c' (Nullable = true), @p13='More Options'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 11:08:46.586 +05:30 [INF] ✅ Flow step executed → Template: flow_step_3 sent to 447543746206
2025-07-03 11:08:46.587 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 11:08:47.556 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:47.558 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:47.559 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:47.561 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"sent","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","expiration_timestamp":"1751521131","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:47.562 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:47.562 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"sent","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","expiration_timestamp":"1751521131","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:47.563 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:47.564 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:47.565 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3852ms
2025-07-03 11:08:47.565 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"sent","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","expiration_timestamp":"1751521131","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:47.566 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:47.569 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:47.569 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.3829ms
2025-07-03 11:08:47.571 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==
2025-07-03 11:08:47.574 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==
2025-07-03 11:08:48.166 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-03 11:08:48.169 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:48.169 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:48.171 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"read","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:48.172 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:48.172 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"read","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:48.173 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:48.174 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:48.175 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3671ms
2025-07-03 11:08:48.176 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==","status":"read","timestamp":"1751521131","recipient_id":"447543746206","conversation":{"id":"dd4f93371e9853216d89ef360fbf26d8","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:48.177 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:48.179 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:48.180 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.6675ms
2025-07-03 11:08:48.182 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==
2025-07-03 11:08:48.184 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==
2025-07-03 11:08:50.365 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 628
2025-07-03 11:08:50.367 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:50.368 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:50.369 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggQjE1OTg1REI5NDg2MTdGOTBDQ0ZBOEJGQTUzRUZEQUYA","timestamp":"1751521133","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 11:08:50.371 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:50.371 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggQjE1OTg1REI5NDg2MTdGOTBDQ0ZBOEJGQTUzRUZEQUYA","timestamp":"1751521133","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-03 11:08:50.371 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:50.372 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 11:08:50.373 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.497ms
2025-07-03 11:08:50.374 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 11:08:50.375 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:50.376 +05:30 [INF] 🖱️ Button Click → From: 447543746206, ClickId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggQjE1OTg1REI5NDg2MTdGOTBDQ0ZBOEJGQTUzRUZEQUYA, OrigMsgId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==, Text: Show Products
2025-07-03 11:08:50.376 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.8201ms
2025-07-03 11:08:50.379 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 11:08:50.383 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==', @__originalMessageId_0_contains='%wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 11:08:50.385 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:08:51.137 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 11:08:51.159 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='3c0ee670-eeda-4744-9a16-ff5446a84771', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Show Products', @p4='Show Products', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:38:50.3857296Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='447543746206', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQUEzRURENTVFNzI1MzhFMEYyAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 11:08:51.161 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 11:08:51.162 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='show products', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 11:08:51.164 +05:30 [INF] ✅ Fallback flow step matched: StepId = "4fb7142a-3ee9-45df-87cc-c82c88ccf272", Flow = FirstFlow
2025-07-03 11:08:51.165 +05:30 [INF] 🔁 Matched CTA Step → "4fb7142a-3ee9-45df-87cc-c82c88ccf272"
2025-07-03 11:08:51.165 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "4fb7142a-3ee9-45df-87cc-c82c88ccf272" | TrackingLogId: "3c0ee670-eeda-4744-9a16-ff5446a84771"
2025-07-03 11:08:51.168 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__trackingLogId_0='3c0ee670-eeda-4744-9a16-ff5446a84771'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-03 11:08:51.171 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='4fb7142a-3ee9-45df-87cc-c82c88ccf272' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-03 11:08:51.172 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "4fb7142a-3ee9-45df-87cc-c82c88ccf272", Template: flow_step_4
2025-07-03 11:08:51.173 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:51.174 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 11:08:52.353 +05:30 [INF] Received HTTP response headers after 1178.1418ms - 200
2025-07-03 11:08:52.355 +05:30 [INF] End processing HTTP request after 1181.633ms - 200
2025-07-03 11:08:52.377 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='35bed1de-7e59-4d5d-b5cb-ecfe30b17163', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T05:38:52.3572167Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_4' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"447543746206\",\"wa_id\":\"447543746206\"}],\"messages\":[{\"id\":\"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-03T05:38:52.3572163Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:08:52.380 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='3315b778-c0ef-417f-a4a4-06ecd6cbbce7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='447543746206', @p3=NULL, @p4='2025-07-03T05:38:52.3793636Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='4fb7142a-3ee9-45df-87cc-c82c88ccf272', @p8='' (Nullable = false), @p9='True', @p10='flow_step_4', @p11='text_template', @p12='3c0ee670-eeda-4744-9a16-ff5446a84771' (Nullable = true), @p13='Show Products'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-03 11:08:52.382 +05:30 [INF] ✅ Flow step executed → Template: flow_step_4 sent to 447543746206
2025-07-03 11:08:52.383 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-03 11:08:53.202 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 11:08:53.204 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:53.205 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:53.206 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"sent","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","expiration_timestamp":"1751521137","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.207 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:53.207 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"sent","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","expiration_timestamp":"1751521137","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.208 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:53.209 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:53.209 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.6743ms
2025-07-03 11:08:53.210 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"sent","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","expiration_timestamp":"1751521137","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.211 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:53.213 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:53.213 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.7807ms
2025-07-03 11:08:53.214 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==
2025-07-03 11:08:53.217 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==
2025-07-03 11:08:53.779 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-03 11:08:53.781 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:53.782 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:08:53.784 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"read","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.785 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:08:53.786 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"read","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.786 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:08:53.787 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:08:53.789 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.9008ms
2025-07-03 11:08:53.789 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==","status":"read","timestamp":"1751521137","recipient_id":"447543746206","conversation":{"id":"d5c71c008bd5f7b8e6c6d565a66743f3","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:08:53.791 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:08:53.792 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.7366ms
2025-07-03 11:08:53.793 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:08:53.797 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==
2025-07-03 11:08:53.798 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==
2025-07-03 11:09:00.819 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 626
2025-07-03 11:09:00.822 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:00.822 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:09:00.824 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggRjUyQkU1NDUwOUJEQjc4REQ3MjE5RjAzNDNCQzE2QkQA","timestamp":"1751521144","type":"button","button":{"payload":"Send Pricing","text":"Send Pricing"}}]},"field":"messages"}]}]}
2025-07-03 11:09:00.826 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:09:00.826 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=="},"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggRjUyQkU1NDUwOUJEQjc4REQ3MjE5RjAzNDNCQzE2QkQA","timestamp":"1751521144","type":"button","button":{"payload":"Send Pricing","text":"Send Pricing"}}]},"field":"messages"}]}]}
2025-07-03 11:09:00.826 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:09:00.827 +05:30 [INF] 👉 Routing to Click Processor
2025-07-03 11:09:00.828 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5985ms
2025-07-03 11:09:00.829 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-03 11:09:00.830 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:00.830 +05:30 [INF] 🖱️ Button Click → From: 447543746206, ClickId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggRjUyQkU1NDUwOUJEQjc4REQ3MjE5RjAzNDNCQzE2QkQA, OrigMsgId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==, Text: Send Pricing
2025-07-03 11:09:00.831 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.8423ms
2025-07-03 11:09:00.834 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-03 11:09:00.838 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__originalMessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==', @__originalMessageId_0_contains='%wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-03 11:09:00.840 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:09:01.775 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-03 11:09:01.797 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='4f2682f1-901c-4bcb-bccf-d44988631125', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Send Pricing', @p4='Send Pricing', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-03T05:39:00.8407586Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='447543746206', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSNDZCMjdEMDgxNkIwNTU3QjA1AA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-03 11:09:01.799 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-03 11:09:01.801 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='send pricing', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-03 11:09:01.803 +05:30 [WRN] ❌ No fallback step matched for button 'send pricing' of type 'quick_reply' in BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:09:01.804 +05:30 [INF] 🟡 No visual flow matched for this button: Send Pricing
2025-07-03 11:09:19.975 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 484
2025-07-03 11:09:19.977 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:19.978 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:09:19.980 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggRTJDMUM2MzRGNjA4MDcyQzFCOTE5M0EwREZGNjYzQ0MA","timestamp":"1751521163","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:09:19.981 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:09:19.981 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggRTJDMUM2MzRGNjA4MDcyQzFCOTE5M0EwREZGNjYzQ0MA","timestamp":"1751521163","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:09:19.981 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:09:19.983 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:09:19.983 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2194ms
2025-07-03 11:09:19.985 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:19.986 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.3107ms
2025-07-03 11:09:19.995 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:09:20.018 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=447543746206
2025-07-03 11:09:20.023 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='447543746206'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:09:20.025 +05:30 [INF] Contact already exists: contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:09:20.031 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:09:20.033 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='a62c23c1-e68a-4960-b32e-ec09e01b0660', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:39:20.0325501Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T05:39:20.0325503Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:09:20.041 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:09:20.043 +05:30 [INF] 🔍 No flow match found or FlowId is null. Trying fallback auto-reply...
2025-07-03 11:09:20.050 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__incomingMessage_1='Hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive" AND strpos(@__incomingMessage_1, a."TriggerKeyword") > 0
ORDER BY a."Priority"
LIMIT 1
2025-07-03 11:09:20.051 +05:30 [INF] ❌ No fallback rule matched for: Hi
2025-07-03 11:09:22.063 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='ff3efd54-4006-40ce-854f-c030b08bc05f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:39:22.0602380Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:09:30.934 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 11:09:30.934 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 11:09:30.934 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 11:09:30.936 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:30.939 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:30.941 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:30.942 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 8.0186ms
2025-07-03 11:09:30.943 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 11:09:30.943 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 11:09:30.947 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:09:30.948 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:09:31.653 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 11:09:31.659 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-03 11:09:31.653 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 11:09:31.661 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:31.653 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-03 11:09:31.664 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 11:09:31.665 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 11.6163ms
2025-07-03 11:09:31.667 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-03 11:09:31.665 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:31.668 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 11:09:31.669 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:09:31.672 +05:30 [INF] GetAllContactsAsync returned 7 contacts
2025-07-03 11:09:31.673 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 11:09:31.674 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:31.675 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 20.2984ms
2025-07-03 11:09:31.675 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:09:31.676 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 11:09:31.677 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 11:09:31.679 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 729.334ms
2025-07-03 11:09:31.680 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=9R-KCEo1k8pudbXcLN2SHA - null null
2025-07-03 11:09:31.679 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 26.1894ms
2025-07-03 11:09:31.681 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 11:09:31.677 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 11:09:31.684 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 11:09:31.686 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:31.688 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 20.7521ms
2025-07-03 11:09:31.689 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 754.7873ms
2025-07-03 11:09:31.691 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 11:09:31.690 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 755.8814ms
2025-07-03 11:09:31.721 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=96qyv9cJV0ADY1fXxaPVWw - null null
2025-07-03 11:09:31.723 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:31.724 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 11:09:33.989 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null 0
2025-07-03 11:09:33.992 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:33.993 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:09:33.994 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:09:33.994 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:09:33.995 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:09:33.999 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 11:09:33.996 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:34.001 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:34.004 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='a62c23c1-e68a-4960-b32e-ec09e01b0660', @p0='Read' (Nullable = false), @p3='ff3efd54-4006-40ce-854f-c030b08bc05f', @p2='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
2025-07-03 11:09:34.004 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:09:34.004 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 11:09:34.006 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 11:09:34.007 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:09:34.007 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:09:34.008 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 10.6521ms
2025-07-03 11:09:35.014 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:09:35.016 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:09:35.017 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-03 11:09:35.020 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 0 null 1030.5484ms
2025-07-03 11:09:35.020 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 11:09:35.023 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:09:35.027 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:09:35.027 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 12.8132ms
2025-07-03 11:09:35.028 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1019.1775ms
2025-07-03 11:09:35.029 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:09:35.029 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 11:09:35.030 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:09:35.032 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:09:35.033 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 1037.6949ms
2025-07-03 11:09:35.033 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 1039.5104ms
2025-07-03 11:09:35.034 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:09:35.040 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:09:37.068 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:09:37.071 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='80c43c6a-508b-47ff-9360-201bfd5521d3', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-03 11:09:37.073 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 11:09:37.077 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='65f8bfb6-4b4e-44f7-90d5-aaab06fdadad', @p0='2025-07-03T05:39:37.0697303Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-03 11:09:37.077 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:09:37.080 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 11:09:37.080 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 2038.9112ms
2025-07-03 11:09:37.083 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-03 11:09:37.083 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:09:37.086 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 2056.8659ms
2025-07-03 11:09:54.198 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 487
2025-07-03 11:09:54.200 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:54.201 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:09:54.203 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNEU4OTJEQjAzOTdBNjM3MDk1OEZGNUMyQzg3QzU4RjAA","timestamp":"1751521198","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:09:54.204 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:09:54.204 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNEU4OTJEQjAzOTdBNjM3MDk1OEZGNUMyQzg3QzU4RjAA","timestamp":"1751521198","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:09:54.205 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:09:54.206 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:09:54.208 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3786ms
2025-07-03 11:09:54.210 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:09:54.211 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:09:54.212 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6099ms
2025-07-03 11:09:54.214 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=447543746206
2025-07-03 11:09:54.219 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='447543746206'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:09:54.220 +05:30 [INF] Contact already exists: contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:09:54.222 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:09:54.243 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='920b3b8d-5598-4971-94fa-5f68f4d2aefc', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:39:54.2244836Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T05:39:54.2244838Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:09:54.248 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:09:54.250 +05:30 [INF] 🔍 No flow match found or FlowId is null. Trying fallback auto-reply...
2025-07-03 11:09:54.252 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__incomingMessage_1='Hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive" AND strpos(@__incomingMessage_1, a."TriggerKeyword") > 0
ORDER BY a."Priority"
LIMIT 1
2025-07-03 11:09:54.255 +05:30 [INF] ❌ No fallback rule matched for: Hello
2025-07-03 11:09:57.215 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='a6e8118e-bb42-479c-95fc-58713cc17561', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:39:57.1962341Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:10:04.100 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null 0
2025-07-03 11:10:04.103 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:04.104 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:10:04.104 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:10:04.108 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 11:10:04.113 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='920b3b8d-5598-4971-94fa-5f68f4d2aefc', @p0='Read' (Nullable = false), @p3='a6e8118e-bb42-479c-95fc-58713cc17561', @p2='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
2025-07-03 11:10:04.134 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 11:10:04.135 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 29.4396ms
2025-07-03 11:10:04.136 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:10:04.137 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 0 null 37.1828ms
2025-07-03 11:10:05.713 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 11:10:05.713 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 11:10:05.714 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=96qyv9cJV0ADY1fXxaPVWw - 101 null null 33992.5415ms
2025-07-03 11:10:05.715 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=9R-KCEo1k8pudbXcLN2SHA - 101 null null 34034.4905ms
2025-07-03 11:10:06.233 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:10:06.236 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:10:06.236 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:10:06.238 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:10:06.239 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3737ms
2025-07-03 11:10:06.240 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:10:06.241 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.5136ms
2025-07-03 11:10:06.290 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:10:06.293 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:10:06.294 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:10:06.299 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:10:06.303 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:10:06.306 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:10:06.308 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:10:06.309 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:10:06.310 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:10:06.310 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:10:06.311 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:10:06.312 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:10:06.313 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:10:06.314 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:10:06.314 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:10:06.315 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:10:06.316 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:10:06.316 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:10:06.318 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:10:06.319 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 22.9756ms
2025-07-03 11:10:06.320 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:10:06.321 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 31.0288ms
2025-07-03 11:10:06.354 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 11:10:06.355 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 11:10:06.355 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 11:10:06.359 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:06.356 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:06.361 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 11:10:06.362 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:06.363 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 11:10:06.364 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 10.4572ms
2025-07-03 11:10:06.367 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 11:10:06.367 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:06.367 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 11:10:06.368 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:10:06.375 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:06.377 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:10:06.375 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 14.4419ms
2025-07-03 11:10:08.056 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-03 11:10:06.377 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 11:10:08.065 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-03 11:10:08.056 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 11:10:08.059 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-03 11:10:08.067 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:08.069 +05:30 [INF] GetAllContactsAsync returned 7 contacts
2025-07-03 11:10:08.072 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 11:10:08.073 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 11:10:08.069 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 11:10:08.073 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=d_1icY5qYPdCDWZBR3uwfw - null null
2025-07-03 11:10:08.073 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:10:08.075 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:10:08.076 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 11:10:08.077 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 1710.1366ms
2025-07-03 11:10:08.078 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:08.079 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 1701.2736ms
2025-07-03 11:10:08.080 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 23.1176ms
2025-07-03 11:10:08.081 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 1704.5826ms
2025-07-03 11:10:08.085 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 11:10:08.085 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 11:10:08.086 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 11:10:08.092 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 1737.3666ms
2025-07-03 11:10:08.093 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 1738.551ms
2025-07-03 11:10:08.115 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=btcw0OXeBDsXnSW3-J06NA - null null
2025-07-03 11:10:08.117 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:08.118 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 11:10:10.301 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null 0
2025-07-03 11:10:10.303 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:10.304 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:10:10.306 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:10:10.307 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:10:10.309 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 11:10:10.307 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:10:10.312 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:10.314 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 11:10:10.315 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:10.316 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:10:10.317 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 9.3099ms
2025-07-03 11:10:10.317 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 11:10:10.318 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:10:10.319 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 11:10:10.320 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 11:10:11.979 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 0 null 1677.687ms
2025-07-03 11:10:11.986 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-03 11:10:11.984 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='80c43c6a-508b-47ff-9360-201bfd5521d3', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-03 11:10:11.978 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:10:11.990 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:10:11.994 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 11:10:11.995 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 10.6665ms
2025-07-03 11:10:11.997 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:10:11.997 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 11:10:11.998 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1676.9719ms
2025-07-03 11:10:11.999 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 1692.1401ms
2025-07-03 11:10:11.999 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - null null
2025-07-03 11:10:12.000 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:10:12.004 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:10:12.004 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 1697.7165ms
2025-07-03 11:10:12.005 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:10:12.007 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 11:10:12.010 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p1='65f8bfb6-4b4e-44f7-90d5-aaab06fdadad', @p0='2025-07-03T05:40:11.9807305Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-03 11:10:14.388 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:10:14.391 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 11:10:14.393 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 11:10:14.396 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-03 11:10:14.397 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 11:10:14.399 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 2390.2873ms
2025-07-03 11:10:14.400 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 11:10:14.401 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/80c43c6a-508b-47ff-9360-201bfd5521d3 - 200 null application/json; charset=utf-8 2402.0216ms
2025-07-03 11:10:47.888 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 11:10:47.888 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 11:10:47.893 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=d_1icY5qYPdCDWZBR3uwfw - 101 null null 39819.5629ms
2025-07-03 11:10:47.893 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=btcw0OXeBDsXnSW3-J06NA - 101 null null 39778.6426ms
2025-07-03 11:11:24.533 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:11:24.539 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:11:24.540 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:11:24.541 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:11:24.544 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:11:24.577 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 11:11:24.578 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 32.5519ms
2025-07-03 11:11:24.579 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:11:24.580 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 400 null application/problem+json; charset=utf-8 47.0509ms
2025-07-03 11:11:52.399 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:11:52.406 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:11:52.407 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:11:52.408 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:11:52.408 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:11:52.412 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 11:11:52.413 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 2.8976ms
2025-07-03 11:11:52.414 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:11:52.414 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 400 null application/problem+json; charset=utf-8 15.7693ms
2025-07-03 11:19:05.721 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:19:05.726 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:19:05.727 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:19:05.730 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:49:05 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:19:05.759 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:49:05 AM'.
2025-07-03 11:19:05.760 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:19:05.775 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:19:05.786 +05:30 [ERR] Response has already started, unable to write error response for path: /api/autoreplyflows/save
2025-07-03 11:19:05.787 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 401 null application/json 66.562ms
2025-07-03 11:22:27.219 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:22:27.224 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:22:27.225 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:22:27.226 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:52:27 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:22:27.228 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:52:27 AM'.
2025-07-03 11:22:27.229 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:22:27.240 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:22:27.243 +05:30 [ERR] Response has already started, unable to write error response for path: /api/autoreplyflows/save
2025-07-03 11:22:27.244 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 401 null application/json 24.5219ms
2025-07-03 11:22:31.577 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:22:31.579 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:22:31.580 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:22:31.581 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:52:31 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:22:31.583 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:52:31 AM'.
2025-07-03 11:22:31.584 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:22:31.597 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:22:31.601 +05:30 [ERR] Response has already started, unable to write error response for path: /api/autoreplyflows/save
2025-07-03 11:22:31.602 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 401 null application/json 25.2613ms
2025-07-03 11:22:52.919 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-03 11:22:52.953 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-03 11:22:52.969 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-03 11:22:53.688 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-03 11:22:54.310 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-03 11:22:54.490 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-03 11:22:54.491 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-03 11:22:54.493 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-03 11:22:54.494 +05:30 [INF] Hosting environment: Development
2025-07-03 11:22:54.496 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-03 11:22:54.535 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-03 11:22:54.554 +05:30 [INF] Executed DbCommand (42ms) [Parameters=[@__cutoff_0='2025-06-26T05:52:53.0566889Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-03 11:22:56.563 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 11:22:56.724 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 165.6854ms
2025-07-03 11:22:56.743 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 11:22:56.753 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 10.1993ms
2025-07-03 11:22:56.814 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 11:22:56.856 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 42.889ms
2025-07-03 11:22:56.980 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 11:22:57.199 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 219.2586ms
2025-07-03 11:23:21.185 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 597
2025-07-03 11:23:21.194 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-03 11:23:21.195 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:23:21.196 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:23:21.281 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:21 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:21.307 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:21 AM'.
2025-07-03 11:23:21.311 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:21.340 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:21.349 +05:30 [ERR] Response has already started, unable to write error response for path: /api/autoreplyflows/save
2025-07-03 11:23:21.350 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 401 null application/json 165.1846ms
2025-07-03 11:23:23.527 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:23:23.538 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:23 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:23.541 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:23 AM'.
2025-07-03 11:23:23.543 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:23.563 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:23.568 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:23:23.569 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 41.5724ms
2025-07-03 11:23:29.838 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:23:29.842 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:29.844 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 6.0912ms
2025-07-03 11:23:29.845 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:23:29.848 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:29.849 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:29 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:29.851 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:29 AM'.
2025-07-03 11:23:29.853 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:29.866 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:23:29.925 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:23:29.982 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:23:30.061 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:23:30.128 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:23:30.143 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:23:30.209 +05:30 [INF] Executed DbCommand (40ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:23:30.227 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:23:30.300 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 429.926ms
2025-07-03 11:23:30.302 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:30.347 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:30.354 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:23:30.357 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 11:23:30.357 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 512.3956ms
2025-07-03 11:23:30.359 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:30.361 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 4.224ms
2025-07-03 11:23:30.362 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:23:30.365 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:30.366 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:30 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:30.367 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:30 AM'.
2025-07-03 11:23:30.368 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.1325ms
2025-07-03 11:23:30.371 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:23:30.518 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:23:30.520 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:30 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:30.522 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:30 AM'.
2025-07-03 11:23:30.524 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:30.541 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:30.545 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:23:30.546 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 28.1923ms
2025-07-03 11:23:34.977 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:23:34.980 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:34.981 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.8666ms
2025-07-03 11:23:34.982 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:23:34.985 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:34.987 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:34 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:34.989 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:34 AM'.
2025-07-03 11:23:34.990 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:34.991 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:23:34.996 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:23:35.001 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:23:35.006 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:23:35.010 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:23:35.013 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:23:35.016 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:23:35.021 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:23:35.064 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 71.4106ms
2025-07-03 11:23:35.065 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:35.099 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:35.104 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:23:35.105 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 123.2248ms
2025-07-03 11:23:35.108 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:23:35.109 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:35.110 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:35 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:35.112 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:35 AM'.
2025-07-03 11:23:35.113 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 5.2406ms
2025-07-03 11:23:35.115 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:23:35.225 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:23:35.228 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:35 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:35.230 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:35 AM'.
2025-07-03 11:23:35.231 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:35.249 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:35.256 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:23:35.257 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 32.1615ms
2025-07-03 11:23:37.859 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:23:37.862 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:37.863 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:37 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:37.884 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:37 AM'.
2025-07-03 11:23:37.885 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:37.886 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:23:37.893 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:23:37.896 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:23:37.900 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:23:37.903 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:23:37.906 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:23:37.909 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:23:37.911 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:23:37.955 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 68.4047ms
2025-07-03 11:23:37.956 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:37.991 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:37.995 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:23:37.996 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 136.68ms
2025-07-03 11:23:37.998 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 11:23:38.000 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:38.000 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.809ms
2025-07-03 11:23:38.001 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:23:38.004 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:38.005 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:38 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:38.007 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:38 AM'.
2025-07-03 11:23:38.008 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.427ms
2025-07-03 11:23:38.010 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:23:38.130 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:23:38.133 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:38 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:38.135 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:38 AM'.
2025-07-03 11:23:38.136 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:38.156 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:38.160 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:23:38.162 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 31.2771ms
2025-07-03 11:23:41.333 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:23:41.336 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:41.337 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.2734ms
2025-07-03 11:23:41.339 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:23:41.341 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:41.342 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:41.344 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
2025-07-03 11:23:41.345 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:41.346 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:23:41.348 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:23:41.350 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:23:41.355 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:23:41.357 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:23:41.360 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:23:41.363 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:23:41.366 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:23:41.403 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 55.966ms
2025-07-03 11:23:41.404 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:23:41.437 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:41.442 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:23:41.443 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 103.8739ms
2025-07-03 11:23:41.445 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:23:41.447 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:23:41.448 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:41.450 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
2025-07-03 11:23:41.451 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 5.4243ms
2025-07-03 11:23:41.453 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:23:41.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:23:41.565 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:23:41.567 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:53:41 AM'.
2025-07-03 11:23:41.568 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:23:41.590 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:23:41.595 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:23:41.596 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 34.2647ms
2025-07-03 11:24:05.247 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/main.aba21c45b9e9b45c575f.hot-update.json - null null
2025-07-03 11:24:05.268 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:05 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:05.272 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:05 AM'.
2025-07-03 11:24:05.275 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/main.aba21c45b9e9b45c575f.hot-update.json - 401 null application/json 28.7451ms
2025-07-03 11:24:05.281 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:7113/main.aba21c45b9e9b45c575f.hot-update.json, Response status code: 401
2025-07-03 11:24:05.806 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:05.810 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:05 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:05.813 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:05 AM'.
2025-07-03 11:24:05.814 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:24:05.834 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:24:05.838 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:24:05.839 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 33.0728ms
2025-07-03 11:24:12.182 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:24:12.185 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:12.186 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.2104ms
2025-07-03 11:24:12.187 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:24:12.192 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:12.194 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:12.196 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
2025-07-03 11:24:12.197 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:12.198 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:12.201 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:24:12.204 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:24:12.209 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:24:12.213 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:24:12.219 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:24:12.223 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:24:12.225 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:24:12.258 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 57.9562ms
2025-07-03 11:24:12.259 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:12.288 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:24:12.293 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:24:12.294 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 107.2868ms
2025-07-03 11:24:12.297 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 11:24:12.299 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:12.300 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.6351ms
2025-07-03 11:24:12.301 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:24:12.304 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:12.305 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:12.307 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
2025-07-03 11:24:12.308 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 7.4852ms
2025-07-03 11:24:12.311 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:24:12.484 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:12.487 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:12.489 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:12 AM'.
2025-07-03 11:24:12.490 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:24:12.506 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:24:12.510 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:24:12.511 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 27.5793ms
2025-07-03 11:24:15.284 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:24:15.286 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:15.288 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:15.290 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
2025-07-03 11:24:15.291 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:15.292 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:15.294 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:24:15.297 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:24:15.301 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:24:15.305 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:24:15.308 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:24:15.311 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:24:15.313 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:24:15.345 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 50.8665ms
2025-07-03 11:24:15.346 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:15.377 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:24:15.382 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 11:24:15.383 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 99.1671ms
2025-07-03 11:24:15.386 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 11:24:15.388 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:15.390 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:15.391 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
2025-07-03 11:24:15.392 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.1737ms
2025-07-03 11:24:15.394 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 11:24:15.540 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:15.543 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 11:24:15.545 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 05:42:53 AM', Current time (UTC): '03-07-2025 05:54:15 AM'.
2025-07-03 11:24:15.546 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 11:24:15.568 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 11:24:15.574 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 11:24:15.575 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 35.3643ms
2025-07-03 11:24:38.606 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:24:38.609 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:38.610 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.9616ms
2025-07-03 11:24:38.611 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:24:38.615 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:38.616 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:38.617 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:38.619 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:24:38.623 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:24:38.627 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:24:38.630 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:24:38.633 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:24:38.641 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:24:38.643 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:24:38.644 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 11:24:38.649 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:38.663 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 45.2101ms
2025-07-03 11:24:38.665 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:38.666 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 54.3923ms
2025-07-03 11:24:38.974 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:38.984 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:38.987 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:38.991 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:38.993 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.9564ms
2025-07-03 11:24:38.994 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:38.995 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 20.5514ms
2025-07-03 11:24:39.237 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:24:39.240 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:39.244 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:24:39.256 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:24:39.260 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:24:39.267 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:24:39.280 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:24:39.281 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:24:39.282 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:24:39.282 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:24:39.283 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:24:39.283 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:24:39.284 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:24:39.285 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:24:39.285 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:24:39.286 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:24:39.287 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:24:39.287 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:24:39.291 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:24:39.296 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 51.0763ms
2025-07-03 11:24:39.298 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:39.299 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 61.1993ms
2025-07-03 11:24:42.522 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:24:42.525 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:42.526 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:42.527 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:42.529 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:24:42.532 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:24:42.537 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:24:42.540 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:24:42.544 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:24:42.547 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:24:42.550 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:24:42.552 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 11:24:42.553 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:42.555 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 26.5163ms
2025-07-03 11:24:42.556 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:42.558 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 35.501ms
2025-07-03 11:24:42.565 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:42.567 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:42.568 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:42.571 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:42.572 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.4637ms
2025-07-03 11:24:42.574 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:42.575 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.8129ms
2025-07-03 11:24:42.886 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:24:42.890 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:42.891 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:24:42.896 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:24:42.900 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:24:42.902 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:24:42.904 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:24:42.904 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:24:42.905 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:24:42.905 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:24:42.906 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:24:42.907 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:24:42.907 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:24:42.908 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:24:42.908 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:24:42.909 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:24:42.909 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:24:42.910 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:24:42.911 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:24:42.912 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 19.3674ms
2025-07-03 11:24:42.913 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:42.914 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 28.3525ms
2025-07-03 11:24:46.268 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 11:24:46.270 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:46.271 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.453ms
2025-07-03 11:24:46.273 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 11:24:46.276 +05:30 [INF] CORS policy execution successful.
2025-07-03 11:24:46.277 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:46.278 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:46.281 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 11:24:46.284 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 11:24:46.288 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 11:24:46.291 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 11:24:46.295 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 11:24:46.299 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 11:24:46.301 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 11:24:46.302 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 11:24:46.303 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:46.304 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 24.1366ms
2025-07-03 11:24:46.305 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 11:24:46.307 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 33.9913ms
2025-07-03 11:24:46.313 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 11:24:46.317 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:46.318 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 11:24:46.319 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:24:46.321 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.9787ms
2025-07-03 11:24:46.322 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 11:24:46.323 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.3927ms
2025-07-03 11:24:46.653 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 11:24:46.656 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:46.657 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 11:24:46.662 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 11:24:46.665 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 11:24:46.668 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 11:24:46.670 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 11:24:46.670 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 11:24:46.671 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 11:24:46.672 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 11:24:46.672 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 11:24:46.673 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 11:24:46.673 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 11:24:46.674 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 11:24:46.675 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 11:24:46.675 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 11:24:46.676 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 11:24:46.676 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 11:24:46.678 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 11:24:46.679 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 20.4305ms
2025-07-03 11:24:46.680 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 11:24:46.681 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 28.8136ms
2025-07-03 11:25:57.287 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 594
2025-07-03 11:25:57.295 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:25:57.296 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:25:57.298 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:25:57.301 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:25:57.320 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 11:25:57.330 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 27.0333ms
2025-07-03 11:25:57.331 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:25:57.332 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 400 null application/problem+json; charset=utf-8 44.5171ms
2025-07-03 11:25:59.516 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 594
2025-07-03 11:25:59.519 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:25:59.520 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:25:59.521 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:25:59.522 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:25:59.527 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 11:25:59.529 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 4.2903ms
2025-07-03 11:25:59.530 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:25:59.531 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 400 null application/problem+json; charset=utf-8 14.7428ms
2025-07-03 11:26:13.804 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 594
2025-07-03 11:26:13.806 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:26:13.807 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:26:13.808 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:26:13.809 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:26:13.817 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-03 11:26:13.818 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 7.0084ms
2025-07-03 11:26:13.819 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:26:13.820 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 400 null application/problem+json; charset=utf-8 16.4651ms
2025-07-03 11:28:55.963 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - application/json 562
2025-07-03 11:28:55.968 +05:30 [INF] CORS policy execution failed.
2025-07-03 11:28:55.969 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-03 11:28:55.970 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:28:55.971 +05:30 [INF] Route matched with {action = "SaveFlow", controller = "AutoReplyFlows"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveFlow(xbytechat.api.Features.AutoReplyBuilder.Flows.DTOs.SaveFlowDto) on controller xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController (xbytechat.api).
2025-07-03 11:28:55.990 +05:30 [INF] 🔄 Starting flow save for business "c13be597-6ae2-42bb-9d43-925815f24ff8" with keyword 'hi'
2025-07-03 11:28:56.185 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='2025-07-03T05:58:56.0625451Z' (DbType = DateTime), @p3='[{"Id":"reactflow__edge-start-1-node_1","Source":"start-1","Target":"node_1","SourceNodeId":"start-1","TargetNodeId":"node_1","SourceHandle":"output","TargetHandle":"input"}]' (Nullable = false), @p4='True', @p5='welcomeMsg' (Nullable = false), @p6='[{"Id":"start-1","Type":"start","Position":{"X":39.5,"Y":5.5},"Data":{"Label":"start","Config":{"ValueKind":1}}},{"Id":"node_1","Type":"message","Position":{"X":77.25,"Y":99.0},"Data":{"Label":"message","Config":{"ValueKind":1}}}]' (Nullable = false), @p7='hi'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "AutoReplyFlows" ("Id", "BusinessId", "CreatedAt", "EdgesJson", "IsActive", "Name", "NodesJson", "TriggerKeyword")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-07-03 11:28:56.194 +05:30 [INF] ✅ Flow saved: "8c3be1a6-8ec1-4e0f-b331-62e4e389adec"
2025-07-03 11:28:56.207 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedKeyword_1='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND lower(a."TriggerKeyword") = @__normalizedKeyword_1
LIMIT 1
2025-07-03 11:28:56.235 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='d62ff59c-aec7-4b2d-84e9-018350ccd32f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='2025-07-03T05:58:56.2097896Z' (DbType = DateTime), @p3='8c3be1a6-8ec1-4e0f-b331-62e4e389adec' (Nullable = true), @p4='welcomeMsg', @p5='True', @p6=NULL, @p7='1', @p8='' (Nullable = false), @p9='hi' (Nullable = false), @p10=NULL (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "AutoReplyRules" ("Id", "BusinessId", "CreatedAt", "FlowId", "FlowName", "IsActive", "MediaUrl", "Priority", "ReplyMessage", "TriggerKeyword", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-07-03 11:28:56.238 +05:30 [INF] 🔁 Linked flow to auto-reply rule: "d62ff59c-aec7-4b2d-84e9-018350ccd32f"
2025-07-03 11:28:56.239 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType15`1[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:28:56.242 +05:30 [INF] Executed action xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api) in 269.5018ms
2025-07-03 11:28:56.243 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.AutoReplyBuilder.Flows.Controllers.AutoReplyFlowsController.SaveFlow (xbytechat.api)'
2025-07-03 11:28:56.243 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/autoreplyflows/save - 200 null application/json; charset=utf-8 280.7862ms
2025-07-03 11:29:15.791 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 484
2025-07-03 11:29:15.826 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:29:15.852 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:29:15.916 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNjQwRjE1Mjg5OUQ0MTA0NjE0NTU4NjcwM0M1Rjg1MzEA","timestamp":"1751522359","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:29:15.952 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:29:15.964 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:29:15.987 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 112.5557ms
2025-07-03 11:29:16.001 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:29:16.012 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 220.9912ms
2025-07-03 11:29:16.830 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNjQwRjE1Mjg5OUQ0MTA0NjE0NTU4NjcwM0M1Rjg1MzEA","timestamp":"1751522359","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:29:16.832 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:29:16.848 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:29:16.869 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=447543746206
2025-07-03 11:29:16.877 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='447543746206'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:29:16.912 +05:30 [INF] Contact already exists: contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:29:16.920 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:29:16.992 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='350cb6a4-22f2-43f4-8fe0-c091e83e951f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:59:16.9233374Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T05:59:16.9233916Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:29:17.001 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:29:17.023 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:29:17.032 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:29:17.036 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 11:29:23.548 +05:30 [INF] Executed DbCommand (26ms) [Parameters=[@p0='0b64b52d-1452-4987-8971-d6d57742c6a9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T05:59:20.3589963Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:29:30.787 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:29:36.600 +05:30 [INF] Assigning agent to contact "80c43c6a-508b-47ff-9360-201bfd5521d3" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:29:37.216 +05:30 [INF] 🙋 Agent assigned to contact 447543746206
2025-07-03 11:30:17.003 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 484
2025-07-03 11:30:17.008 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:30:17.010 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:30:17.013 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNEQ4QTAxN0Q4NTNDOEZBQ0JFNTE5MDhGNEMzRUM4OTYA","timestamp":"1751522420","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:30:17.016 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:30:17.038 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:30:28.455 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 11:30:30.384 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 13372.8567ms
2025-07-03 11:30:31.016 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:30:31.027 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:30:34.356 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:30:34.358 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S. Kumar"},"wa_id":"447543746206"}],"messages":[{"from":"447543746206","id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAEhggNEQ4QTAxN0Q4NTNDOEZBQ0JFNTE5MDhGNEMzRUM4OTYA","timestamp":"1751522420","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:30:34.365 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17361.9383ms
2025-07-03 11:30:34.375 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:30:34.375 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQUJGRTBEMjhCNUQyMDRFMTEwRDk1ODg4QkQzOTdEOEYA","timestamp":"1751522427","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:30:34.386 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:30:34.386 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:30:34.401 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:30:34.404 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=447543746206
2025-07-03 11:30:34.405 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 31.8938ms
2025-07-03 11:30:34.409 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='447543746206'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:30:34.409 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:30:34.411 +05:30 [INF] Contact already exists: contactId="80c43c6a-508b-47ff-9360-201bfd5521d3"
2025-07-03 11:30:34.412 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 5957.1022ms
2025-07-03 11:30:34.415 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='80c43c6a-508b-47ff-9360-201bfd5521d3'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:30:34.426 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='4f805736-c400-4fb1-af38-b6335ba1c3e4', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T06:00:34.4229574Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T06:00:34.4229574Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:30:34.432 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:30:34.437 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:30:34.441 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:30:34.444 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 11:30:44.289 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='71e44a84-493d-4438-81b9-14da4dab2acb', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p6='2025-07-03T06:00:37.0684809Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='447543746206' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:30:50.965 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:30:55.204 +05:30 [INF] Assigning agent to contact "80c43c6a-508b-47ff-9360-201bfd5521d3" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:30:57.541 +05:30 [INF] 🙋 Agent assigned to contact 447543746206
2025-07-03 11:31:14.450 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQUJGRTBEMjhCNUQyMDRFMTEwRDk1ODg4QkQzOTdEOEYA","timestamp":"1751522427","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:31:14.453 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:31:14.458 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:31:14.483 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 11:31:14.487 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:31:14.491 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 11:31:14.494 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:31:14.499 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0fae67ca-2590-426a-983e-9d17652cac76', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:01:14.4967744Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T06:01:14.4967745Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:31:14.506 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:31:14.511 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:31:14.515 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:31:14.518 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 11:31:16.700 +05:30 [INF] Executed DbCommand (25ms) [Parameters=[@p0='499ab83c-ea89-4be7-ae2e-fd3cfc696315', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:01:15.3230481Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:31:20.771 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:31:22.255 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:31:23.312 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 11:31:52.664 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 11:31:52.673 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:31:52.675 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:31:52.678 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzQ5MkY4ODdENjZFQzJEMTExQURENjVBMTNCNjU3MUIA","timestamp":"1751522516","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:31:52.680 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:31:52.681 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzQ5MkY4ODdENjZFQzJEMTExQURENjVBMTNCNjU3MUIA","timestamp":"1751522516","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:31:52.681 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:31:52.683 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:31:52.685 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2741ms
2025-07-03 11:31:52.689 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:31:52.689 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:31:52.697 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 32.4812ms
2025-07-03 11:31:52.700 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 11:31:52.708 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:31:52.712 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 11:31:52.715 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:31:52.738 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='40be0b49-ea8f-42b1-a088-3e0508c23acb', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:01:52.7183251Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T06:01:52.7183252Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:31:52.744 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:31:52.749 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:31:52.756 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:31:52.759 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 11:31:54.389 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@p0='be2c7888-cc99-4ab3-8398-9d09b0ae84aa', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:01:54.3735926Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:31:54.394 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:31:54.396 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:31:54.397 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 11:39:58.565 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 11:39:58.570 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:39:58.570 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:39:58.572 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUMyOEQ0MzQ2RDM4REEwQTYxNEQ4RTFBNzdFOUM4QzkA","timestamp":"1751523001","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:39:58.573 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:39:58.574 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUMyOEQ0MzQ2RDM4REEwQTYxNEQ4RTFBNzdFOUM4QzkA","timestamp":"1751523001","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 11:39:58.574 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:39:58.575 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 11:39:58.576 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3499ms
2025-07-03 11:40:02.420 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:40:02.777 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 4212.6613ms
2025-07-03 11:40:14.390 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 11:40:35.713 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 11:40:35.715 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 11:40:35.727 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 11:40:39.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 11:40:52.889 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='7eebb1c7-1d93-4eac-adc4-04bf0fe0c2ef', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:10:48.5475103Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T06:10:48.5536485Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:41:09.002 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 11:41:21.186 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:41:22.836 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 11:41:33.670 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 11:41:43.698 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='1d96a4df-7b39-4140-ae8f-c5e7f13fd73b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T06:11:42.4470945Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 11:41:48.484 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:41:48.485 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 11:41:48.486 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 11:55:51.872 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 11:55:51.880 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:55:51.882 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 11:55:51.893 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"delivered","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:55:51.896 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 11:55:51.896 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"delivered","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:55:51.897 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 11:55:51.899 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 11:55:51.901 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.2444ms
2025-07-03 11:55:51.912 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"delivered","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 11:55:51.913 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 11:55:51.915 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 44.0511ms
2025-07-03 11:55:52.043 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 11:55:52.048 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 11:55:52.052 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 12:00:14.326 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 12:00:14.336 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:00:14.337 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:00:14.342 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"sent","timestamp":"1751517830","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","expiration_timestamp":"1751517830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:00:14.344 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:00:14.345 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"sent","timestamp":"1751517830","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","expiration_timestamp":"1751517830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:00:14.345 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:00:14.348 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:00:14.350 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.957ms
2025-07-03 12:00:14.357 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"sent","timestamp":"1751517830","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","expiration_timestamp":"1751517830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:00:14.360 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:00:14.363 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 37.6882ms
2025-07-03 12:00:14.365 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:00:14.378 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==
2025-07-03 12:00:14.380 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==
2025-07-03 12:08:37.649 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 12:08:37.659 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:08:37.660 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:08:37.726 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"sent","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","expiration_timestamp":"1751517838","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:08:37.728 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:08:37.729 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"sent","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","expiration_timestamp":"1751517838","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:08:37.729 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:08:37.732 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:08:37.734 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 71.9755ms
2025-07-03 12:08:37.740 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"sent","timestamp":"1751517838","recipient_id":"447543746206","conversation":{"id":"8e4a23cb20165bf8e1bb1d67b0562bc6","expiration_timestamp":"1751517838","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:08:37.742 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:08:37.747 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 97.3141ms
2025-07-03 12:08:37.836 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:08:37.840 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 12:08:37.842 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 12:15:52.441 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 12:15:52.451 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:15:52.453 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:15:52.458 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"delivered","timestamp":"1751517832","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:15:52.461 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:15:52.461 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"delivered","timestamp":"1751517832","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:15:52.462 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:15:52.464 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:15:52.466 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.1838ms
2025-07-03 12:15:52.471 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==","status":"delivered","timestamp":"1751517832","recipient_id":"917082156227","conversation":{"id":"13d90b691c257acae0c2dfcba50b9f89","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:15:52.476 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:15:52.480 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 39.6522ms
2025-07-03 12:15:52.589 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:15:52.592 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==
2025-07-03 12:15:52.594 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUJEODE1RkExQjUxODU1ODIyAA==
2025-07-03 12:26:56.992 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 389
2025-07-03 12:26:56.998 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:26:56.999 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:26:57.001 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"read","timestamp":"1751519530","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 12:26:57.002 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:26:57.002 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"read","timestamp":"1751519530","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 12:26:57.003 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:26:57.004 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:26:57.005 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8012ms
2025-07-03 12:26:57.007 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==","status":"read","timestamp":"1751519530","recipient_id":"447543746206"}]},"field":"messages"}]}]}
2025-07-03 12:26:57.019 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:26:57.021 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 28.0727ms
2025-07-03 12:26:57.075 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:26:57.077 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 12:26:57.077 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMNDQ3NTQzNzQ2MjA2FQIAERgSQjY3NjYwRjE0OTU1RDVGQTc4AA==
2025-07-03 12:26:58.321 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 12:26:58.324 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:26:58.325 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:26:58.326 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"sent","timestamp":"1751519961","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","expiration_timestamp":"1751519961","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:26:58.328 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:26:58.328 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"sent","timestamp":"1751519961","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","expiration_timestamp":"1751519961","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:26:58.329 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:26:58.330 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:26:58.331 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3019ms
2025-07-03 12:26:58.332 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==","status":"sent","timestamp":"1751519961","recipient_id":"917082156227","conversation":{"id":"015452355864bfff28c3deaee6d14cf4","expiration_timestamp":"1751519961","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 12:26:58.334 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:26:58.336 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:26:58.336 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.2472ms
2025-07-03 12:26:58.342 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==
2025-07-03 12:26:58.345 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDBGQjYxMzA3RDVBQ0I0RDdBAA==
2025-07-03 12:28:29.816 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-03 12:28:29.819 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:28:29.820 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 12:28:29.822 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"delivered","timestamp":"1751518939","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 12:28:29.823 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 12:28:29.823 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"delivered","timestamp":"1751518939","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 12:28:29.824 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 12:28:29.825 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 12:28:29.826 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5453ms
2025-07-03 12:28:29.826 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"delivered","timestamp":"1751518939","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 12:28:29.828 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 12:28:29.830 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 12:28:29.830 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.8939ms
2025-07-03 12:28:29.835 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==
2025-07-03 12:28:29.838 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==
2025-07-03 14:14:34.830 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 324
2025-07-03 14:14:34.835 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 14:14:34.837 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 14:14:34.839 +05:30 [WRN] 📥 Webhook received at controller:
{"entry": [{"id": "999432368375320", "time": 1751532278, "changes": [{"value": {"event": "APPROVED", "message_template_id": 1626741691348770, "message_template_name": "pdftemplate", "message_template_language": "en_US", "reason": "NONE"}, "field": "message_template_status_update"}]}], "object": "whatsapp_business_account"}
2025-07-03 14:14:34.840 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 14:14:34.841 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 14:14:34.841 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"entry": [{"id": "999432368375320", "time": 1751532278, "changes": [{"value": {"event": "APPROVED", "message_template_id": 1626741691348770, "message_template_name": "pdftemplate", "message_template_language": "en_US", "reason": "NONE"}, "field": "message_template_status_update"}]}], "object": "whatsapp_business_account"}
2025-07-03 14:14:34.842 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.088ms
2025-07-03 14:14:34.845 +05:30 [WRN] ⚠️ No matching event processor found.
2025-07-03 14:14:34.847 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 14:14:34.848 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 47.1119ms
2025-07-03 16:40:03.279 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 16:40:03.282 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:03.284 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 5.5943ms
2025-07-03 16:40:03.286 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 16:40:03.294 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:03.299 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:03 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:03.304 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:03 AM'.
2025-07-03 16:40:03.305 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:03.306 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:03.310 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 16:40:03.380 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 16:40:03.386 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 16:40:03.390 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 16:40:03.394 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 16:40:03.398 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 16:40:03.400 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 16:40:03.454 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 146.8877ms
2025-07-03 16:40:03.456 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:03.496 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 16:40:03.504 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 16:40:03.505 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 219.3942ms
2025-07-03 16:40:03.508 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 16:40:03.511 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:03.511 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 3.2245ms
2025-07-03 16:40:03.513 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 16:40:03.516 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:03.517 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:03 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:03.519 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:03 AM'.
2025-07-03 16:40:03.520 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 7.2281ms
2025-07-03 16:40:03.522 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 16:40:04.561 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:40:04.565 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:04 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:04.568 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:04 AM'.
2025-07-03 16:40:04.569 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 16:40:04.590 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 16:40:04.595 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 16:40:04.596 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 34.4363ms
2025-07-03 16:40:14.873 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 16:40:14.876 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:14.877 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.465ms
2025-07-03 16:40:14.878 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 16:40:14.882 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:14.884 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:14 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:14.886 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:14 AM'.
2025-07-03 16:40:14.887 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:14.888 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:14.891 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 16:40:14.893 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 16:40:14.897 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 16:40:14.902 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 16:40:14.905 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 16:40:14.909 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 16:40:14.911 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 16:40:14.953 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 63.4569ms
2025-07-03 16:40:14.955 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:14.988 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 16:40:14.994 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 16:40:14.994 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 116.1723ms
2025-07-03 16:40:14.998 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 16:40:15.000 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:15.000 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.92ms
2025-07-03 16:40:15.002 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 16:40:15.005 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:15.006 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:15 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:15.009 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:15 AM'.
2025-07-03 16:40:15.010 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 8.2083ms
2025-07-03 16:40:15.013 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 16:40:15.781 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:40:15.785 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:15 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 16:40:15.787 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 06:54:46 AM', Current time (UTC): '03-07-2025 11:10:15 AM'.
2025-07-03 16:40:15.789 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 16:40:15.815 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 16:40:15.821 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 16:40:15.822 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 40.613ms
2025-07-03 16:40:32.889 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 16:40:32.892 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:32.892 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.1257ms
2025-07-03 16:40:32.894 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 16:40:32.898 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:32.899 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:32.900 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:32.902 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 16:40:32.905 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 16:40:32.909 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 16:40:32.912 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 16:40:32.915 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 16:40:32.918 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 16:40:32.920 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 16:40:32.921 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 16:40:32.923 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:40:32.924 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 23.151ms
2025-07-03 16:40:32.926 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:32.927 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 32.6018ms
2025-07-03 16:40:33.250 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:40:33.253 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:40:33.254 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:33.257 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:40:33.258 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.666ms
2025-07-03 16:40:33.259 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:40:33.260 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 10.4706ms
2025-07-03 16:40:33.513 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 16:40:33.515 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:40:33.516 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 16:40:33.520 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:40:33.523 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 16:40:33.526 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 16:40:33.528 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 16:40:33.529 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 16:40:33.529 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 16:40:33.530 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 16:40:33.531 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 16:40:33.531 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 16:40:33.532 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 16:40:33.532 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 16:40:33.533 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 16:40:33.534 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 16:40:33.535 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 16:40:33.535 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 16:40:33.537 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:40:33.538 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 20.0221ms
2025-07-03 16:40:33.539 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:40:33.540 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 27.0617ms
2025-07-03 16:40:36.180 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 16:40:36.183 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:40:36.185 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:36.186 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:36.189 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 16:40:36.191 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 16:40:36.195 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 16:40:36.198 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 16:40:36.201 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 16:40:36.204 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 16:40:36.206 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 16:40:36.207 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 16:40:36.208 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:40:36.209 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 21.6023ms
2025-07-03 16:40:36.211 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:40:36.212 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 31.5106ms
2025-07-03 16:40:36.218 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:40:36.221 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:40:36.222 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:40:36.224 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:40:36.225 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6104ms
2025-07-03 16:40:36.226 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:40:36.227 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.9005ms
2025-07-03 16:40:36.549 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 16:40:36.552 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:40:36.553 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 16:40:36.557 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:40:36.561 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 16:40:36.563 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 16:40:36.565 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 16:40:36.566 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 16:40:36.567 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 16:40:36.568 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 16:40:36.568 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 16:40:36.569 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 16:40:36.569 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 16:40:36.570 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 16:40:36.570 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 16:40:36.571 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 16:40:36.571 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 16:40:36.572 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 16:40:36.573 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:40:36.575 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 19.7841ms
2025-07-03 16:40:36.576 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:40:36.577 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 27.3281ms
2025-07-03 16:41:13.536 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 16:41:13.539 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:13.540 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.7085ms
2025-07-03 16:41:13.541 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 16:41:13.548 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:13.549 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:41:13.550 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:41:13.553 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 16:41:13.556 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 16:41:13.560 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 16:41:13.563 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 16:41:13.565 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 16:41:13.568 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 16:41:13.570 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 16:41:13.571 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 16:41:13.572 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:41:13.573 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 21.3989ms
2025-07-03 16:41:13.574 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 16:41:13.575 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 33.873ms
2025-07-03 16:41:13.585 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:41:13.591 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:41:13.591 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:41:13.593 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:41:13.594 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3874ms
2025-07-03 16:41:13.595 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:41:13.596 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 11.2156ms
2025-07-03 16:41:13.913 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 16:41:13.917 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:41:13.918 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 16:41:13.921 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:41:13.925 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 16:41:13.927 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 16:41:13.929 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 16:41:13.929 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 16:41:13.930 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 16:41:13.930 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 16:41:13.931 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 16:41:13.931 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 16:41:13.932 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 16:41:13.933 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 16:41:13.933 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 16:41:13.934 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 16:41:13.934 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 16:41:13.935 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 16:41:13.936 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:41:13.937 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.6114ms
2025-07-03 16:41:13.938 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:41:13.939 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.7229ms
2025-07-03 16:41:22.495 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - null null
2025-07-03 16:41:22.516 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:22.517 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 16:41:22.523 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:41:22.574 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__type_1='image'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0 AND c."CampaignType" = @__type_1
ORDER BY c."CreatedAt" DESC
2025-07-03 16:41:22.577 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:41:22.583 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 58.4652ms
2025-07-03 16:41:22.584 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 16:41:22.585 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/get-image-campaign?type=image - 200 null application/json; charset=utf-8 90.4716ms
2025-07-03 16:41:30.748 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:41:30.751 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:30.752 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:41:30.757 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:41:30.792 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:41:30.798 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:41:30.800 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:41:31.754 +05:30 [INF] Received HTTP response headers after 950.9204ms - 401
2025-07-03 16:41:31.756 +05:30 [INF] End processing HTTP request after 958.8183ms - 401
2025-07-03 16:41:31.758 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 23:00:00 PDT. The current time is Thursday, 03-Jul-25 04:11:35 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AOhPfDKsQ9YCWXv2wBacSkJ"}}
2025-07-03 16:41:31.760 +05:30 [ERR] ❌ Failed to fetch templates for BusinessId "c13be597-6ae2-42bb-9d43-925815f24ff8": {"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 23:00:00 PDT. The current time is Thursday, 03-Jul-25 04:11:35 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"AOhPfDKsQ9YCWXv2wBacSkJ"}}
2025-07-03 16:41:31.762 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:41:31.764 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1005.868ms
2025-07-03 16:41:31.766 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:41:31.766 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1018.0275ms
2025-07-03 16:41:51.927 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:41:51.928 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:41:51.935 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:51.936 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:41:51.941 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:41:51.942 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:41:51.943 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:41:51.947 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:41:51.957 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:41:51.958 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:41:51.960 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:41:51.981 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:41:51.990 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:41:52.024 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:41:52.050 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:41:52.059 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 100.4167ms
2025-07-03 16:41:52.061 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:41:52.061 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 134.0616ms
2025-07-03 16:41:52.445 +05:30 [INF] Received HTTP response headers after 483.3843ms - 401
2025-07-03 16:41:52.446 +05:30 [INF] End processing HTTP request after 488.8014ms - 401
2025-07-03 16:41:52.448 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 23:00:00 PDT. The current time is Thursday, 03-Jul-25 04:11:56 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A2SsjKnvnbH79L8i4cjspQG"}}
2025-07-03 16:41:52.449 +05:30 [ERR] ❌ Failed to fetch templates for BusinessId "c13be597-6ae2-42bb-9d43-925815f24ff8": {"error":{"message":"Error validating access token: Session has expired on Wednesday, 02-Jul-25 23:00:00 PDT. The current time is Thursday, 03-Jul-25 04:11:56 PDT.","type":"OAuthException","code":190,"error_subcode":463,"fbtrace_id":"A2SsjKnvnbH79L8i4cjspQG"}}
2025-07-03 16:41:52.450 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:41:52.451 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 506.1705ms
2025-07-03 16:41:52.453 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:41:52.454 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 526.1524ms
2025-07-03 16:42:14.273 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-03 16:42:14.276 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:14.278 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 16:42:14.282 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 16:42:14.293 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-03 16:42:14.296 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-03 16:42:14.301 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 16.5859ms
2025-07-03 16:42:14.302 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 16:42:14.303 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 29.2446ms
2025-07-03 16:42:18.166 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-03 16:42:18.169 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:18.170 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 4.3307ms
2025-07-03 16:42:18.172 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 470
2025-07-03 16:42:18.175 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:18.176 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 16:42:18.180 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 16:42:18.189 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-03 16:42:18.190 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-03 16:42:18.195 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-03 16:42:18.207 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BOZB92MaFrglr8fzhijonH1bxlGbjUxerZASzwdx4xHgZBcgXOylNuKdQVcc8EzfDXwWkz7rvXzVYMdDk7isErHzvO1v2Vyqh5VVsWIZAUdYoxQjwBXH5r64LqST52zCUWHARIMkHhI3KH3xhlvP4TZBcRoF3t9BPEL14R0FfNziBlgUmqa2ZBxixBqBMfH3AWo5Q1DfzoMKvO1iEy8MAV6MZBTIHe1blJC0Ly64VDSr7iMoITSbJgZDZD' (Nullable = false), @p1='2025-07-03T11:12:18.1995305Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 16:42:18.210 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-03 16:42:18.211 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:42:18.213 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 31.6161ms
2025-07-03 16:42:18.214 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 16:42:18.215 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 42.9728ms
2025-07-03 16:42:18.636 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-03 16:42:18.638 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:18.639 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.5044ms
2025-07-03 16:42:18.641 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 470
2025-07-03 16:42:18.645 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:18.646 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 16:42:18.651 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 16:42:19.887 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:42:19.888 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1235.4624ms
2025-07-03 16:42:19.890 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 16:42:19.890 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1249.7867ms
2025-07-03 16:42:43.824 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:42:43.824 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:42:43.832 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:43.834 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:42:43.835 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:42:43.835 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:42:43.836 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:42:43.837 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:42:43.840 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:42:43.843 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:42:43.849 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:42:43.854 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:42:43.900 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:42:43.904 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:42:43.906 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:42:43.907 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 67.3424ms
2025-07-03 16:42:43.908 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:42:43.909 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 85.1435ms
2025-07-03 16:42:44.571 +05:30 [INF] Received HTTP response headers after 715.926ms - 200
2025-07-03 16:42:44.572 +05:30 [INF] End processing HTTP request after 723.3633ms - 200
2025-07-03 16:42:44.598 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3c4lt6Yy8ayjQtlSS6oFfQ&oh=01_Q5Aa1wHWuevi3kLCdb4Lnk67mU76vIRtGr47iLFTZrcD179sWw&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3c4lt6Yy8ayjQtlSS6oFfQ&oh=01_Q5Aa1wGCHJrdqJne41fy7Y40pc8VlHFYJDkyecgn3ubot_sxdg&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:42:44.707 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:42:44.710 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 869.2997ms
2025-07-03 16:42:44.711 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:42:44.712 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 888.0607ms
2025-07-03 16:43:22.395 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-03 16:43:22.397 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:43:22.398 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 3.584ms
2025-07-03 16:43:22.400 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-03 16:43:22.407 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:43:22.408 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 16:43:22.411 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 16:43:24.587 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:43:24.591 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:43:24.592 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:43:25.647 +05:30 [INF] Received HTTP response headers after 1053.8102ms - 200
2025-07-03 16:43:25.648 +05:30 [INF] End processing HTTP request after 1056.8802ms - 200
2025-07-03 16:43:25.664 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='036705d8-9ac2-4ed6-b903-27240c8b3553', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-03T11:13:25.6614762Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T11:13:25.6614764Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 16:43:25.666 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:43:25.668 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3255.0834ms
2025-07-03 16:43:25.669 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-03 16:43:25.670 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3270.156ms
2025-07-03 16:43:34.912 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-03 16:43:34.914 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:43:34.915 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 16:43:34.917 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"sent","timestamp":"1751541218","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","expiration_timestamp":"1751541218","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:34.919 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 16:43:34.919 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"sent","timestamp":"1751541218","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","expiration_timestamp":"1751541218","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:34.920 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:43:34.921 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 16:43:34.922 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.5795ms
2025-07-03 16:43:34.923 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"sent","timestamp":"1751541218","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","expiration_timestamp":"1751541218","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:34.924 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:43:34.927 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.7886ms
2025-07-03 16:43:34.946 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 16:43:34.948 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==
2025-07-03 16:43:34.949 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==
2025-07-03 16:43:36.874 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-03 16:43:36.877 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:43:36.878 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 16:43:36.879 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"delivered","timestamp":"1751541219","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:36.881 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 16:43:36.881 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"delivered","timestamp":"1751541219","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:36.882 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:43:36.883 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 16:43:36.884 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8087ms
2025-07-03 16:43:36.885 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==","status":"delivered","timestamp":"1751541219","recipient_id":"917082156227","conversation":{"id":"5932cf61ec4f5fc5b76d7f294ae6e8f5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-03 16:43:36.886 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:43:36.889 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6045ms
2025-07-03 16:43:36.889 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 16:43:36.894 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==
2025-07-03 16:43:36.895 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkU4QTUzNEQ4Mzk5OEUzQkQxAA==
2025-07-03 16:45:05.727 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:45:05.727 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:45:05.730 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:45:05.732 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:45:05.734 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:45:05.734 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:45:05.735 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:45:05.736 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:45:05.738 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:45:05.743 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:45:05.757 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:45:05.758 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:45:05.809 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:45:05.812 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:45:05.814 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:45:05.816 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 78.1243ms
2025-07-03 16:45:05.817 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:45:05.818 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 90.9953ms
2025-07-03 16:45:06.905 +05:30 [INF] Received HTTP response headers after 1145.9302ms - 200
2025-07-03 16:45:06.907 +05:30 [INF] End processing HTTP request after 1150.3769ms - 200
2025-07-03 16:45:06.908 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=rtBwjNZ0S2jKxAZSkYweJw&oh=01_Q5Aa1wFEWMpevUQTLp2q5phgQQP5kYGU_pdqnIYCtB8ZsGjShA&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=rtBwjNZ0S2jKxAZSkYweJw&oh=01_Q5Aa1wGzduR0gdokYI5KtOth2vnImm6K9aUcTFfUDVrXWk9leQ&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:45:06.912 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:45:06.913 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1174.3336ms
2025-07-03 16:45:06.915 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:45:06.916 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1188.7337ms
2025-07-03 16:47:00.111 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:47:00.112 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:47:00.118 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:47:00.120 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:47:00.121 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:47:00.121 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:47:00.123 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:47:00.124 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:47:00.126 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:47:00.132 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:47:00.136 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:47:00.139 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:47:00.142 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:47:00.144 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:47:00.148 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:47:00.149 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 23.6636ms
2025-07-03 16:47:00.150 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:47:00.151 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 40.0107ms
2025-07-03 16:47:01.179 +05:30 [INF] Received HTTP response headers after 1034.3729ms - 200
2025-07-03 16:47:01.180 +05:30 [INF] End processing HTTP request after 1041.4885ms - 200
2025-07-03 16:47:01.183 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3Geck2zyB4iscaxOQJ-l1w&oh=01_Q5Aa1wG_Ts4nUp9T_WUWxb7nvIwY4uh6tl7aOGV3CH5OXFK-9A&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3Geck2zyB4iscaxOQJ-l1w&oh=01_Q5Aa1wFrdGypivowQP8z9Vs_wG7T0OfgIGHzvCWCKPZBhxxjLw&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:47:01.187 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:47:01.188 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1059.4576ms
2025-07-03 16:47:01.189 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:47:01.191 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1078.7278ms
2025-07-03 16:47:03.623 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:47:03.623 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:47:03.625 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:47:03.627 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:47:03.628 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:47:03.628 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:47:03.629 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:47:03.630 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:47:03.632 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:47:03.635 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:47:03.638 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:47:03.640 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:47:03.643 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:47:03.644 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:47:03.647 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:47:03.648 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 16.932ms
2025-07-03 16:47:03.650 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:47:03.651 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 28.4198ms
2025-07-03 16:47:04.425 +05:30 [INF] Received HTTP response headers after 780.0169ms - 200
2025-07-03 16:47:04.426 +05:30 [INF] End processing HTTP request after 785.3581ms - 200
2025-07-03 16:47:04.436 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=OcKAejdoxWCnamnE62LR6Q&oh=01_Q5Aa1wE87Inrls1Xr6r04hto4O6favwrTpbrYwsP6Yw6OepTUA&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=OcKAejdoxWCnamnE62LR6Q&oh=01_Q5Aa1wGzkdqs2l3JtSvi41rHatrNNVsyOu6Cik292I9pz2e5BQ&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:47:04.439 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:47:04.441 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 807.6642ms
2025-07-03 16:47:04.442 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:47:04.443 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 820.1016ms
2025-07-03 16:48:22.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 16:48:22.564 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:48:22.565 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 16:48:22.568 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:48:22.569 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.8788ms
2025-07-03 16:48:22.570 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 16:48:22.572 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.9333ms
2025-07-03 16:48:22.627 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 16:48:22.631 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:48:22.632 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 16:48:22.639 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:48:22.644 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 16:48:22.648 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 16:48:22.651 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 16:48:22.652 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 16:48:22.653 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 16:48:22.654 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 16:48:22.655 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 16:48:22.656 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 16:48:22.657 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 16:48:22.658 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 16:48:22.659 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 16:48:22.660 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 16:48:22.660 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 16:48:22.661 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 16:48:22.663 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:48:22.664 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 29.6338ms
2025-07-03 16:48:22.666 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 16:48:22.667 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 39.5736ms
2025-07-03 16:48:53.129 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:48:53.130 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-03 16:48:53.137 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:48:53.140 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:48:53.140 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:48:53.141 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:48:53.142 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:48:53.144 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:48:53.147 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:48:53.150 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-03 16:48:53.152 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:48:53.158 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:48:53.160 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 16.5133ms
2025-07-03 16:48:53.161 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:48:53.162 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 32.7478ms
2025-07-03 16:48:53.169 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-03 16:48:53.173 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:48:53.176 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 20.6466ms
2025-07-03 16:48:53.177 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:48:53.178 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 48.5095ms
2025-07-03 16:49:01.421 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-03 16:49:01.421 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:49:01.425 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:49:01.426 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:49:01.427 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:49:01.428 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:49:01.429 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-03 16:49:01.430 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:49:01.433 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:49:01.437 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:49:01.437 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-03 16:49:01.443 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:49:01.444 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:49:01.447 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:49:01.447 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 16.085ms
2025-07-03 16:49:01.448 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 15.5977ms
2025-07-03 16:49:01.449 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:49:01.450 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:49:01.451 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 30.4298ms
2025-07-03 16:49:01.452 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 31.1412ms
2025-07-03 16:49:16.950 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-03 16:49:16.953 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:49:16.953 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 3.4766ms
2025-07-03 16:49:16.955 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 54
2025-07-03 16:49:16.959 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:49:16.960 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-03 16:49:16.963 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-03 16:49:16.987 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-03 16:49:16.990 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 16:49:16.993 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-03 16:49:16.998 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 16:49:17.001 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:49:17.002 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:49:18.145 +05:30 [INF] Received HTTP response headers after 1142.1062ms - 200
2025-07-03 16:49:18.146 +05:30 [INF] End processing HTTP request after 1145.4051ms - 200
2025-07-03 16:49:18.168 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='eca11099-2a53-47f7-81e1-8648e7059840', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-03T11:19:18.1490583Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hi' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hi', @p16='2025-07-03T11:19:18.1490585Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 16:49:18.171 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:49:18.173 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 1209.3449ms
2025-07-03 16:49:18.175 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-03 16:49:18.176 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 1220.9985ms
2025-07-03 16:49:19.526 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-03 16:49:19.529 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:49:19.530 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 16:49:19.532 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"sent","timestamp":"1751541562","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","expiration_timestamp":"1751541562","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:49:19.533 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 16:49:19.533 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"sent","timestamp":"1751541562","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","expiration_timestamp":"1751541562","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:49:19.534 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:49:19.536 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 16:49:19.537 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3105ms
2025-07-03 16:49:19.538 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"sent","timestamp":"1751541562","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","expiration_timestamp":"1751541562","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:49:19.539 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:49:19.541 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.1736ms
2025-07-03 16:49:19.541 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 16:49:19.546 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:49:19.547 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:50:02.844 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:50:02.844 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-03 16:50:02.847 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:50:02.849 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:50:02.850 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:50:02.850 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:50:02.851 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:50:02.852 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-03 16:50:02.853 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:50:02.858 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-03 16:50:02.859 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:50:02.869 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:50:02.872 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 17.3652ms
2025-07-03 16:50:02.872 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:50:02.873 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-03 16:50:02.875 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:50:02.876 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 31.6453ms
2025-07-03 16:50:02.877 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 23.4979ms
2025-07-03 16:50:02.880 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:50:02.881 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 37.2423ms
2025-07-03 16:50:18.395 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:50:18.395 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 16:50:18.398 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:50:18.400 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:50:18.401 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:50:18.402 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:50:18.403 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:50:18.404 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:50:18.417 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 16:50:18.479 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:50:18.481 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:50:18.482 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:50:18.495 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:50:18.500 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:50:18.502 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:50:18.503 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 87.4484ms
2025-07-03 16:50:18.504 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:50:18.505 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 109.6566ms
2025-07-03 16:50:19.374 +05:30 [INF] Received HTTP response headers after 890.9985ms - 200
2025-07-03 16:50:19.376 +05:30 [INF] End processing HTTP request after 894.9838ms - 200
2025-07-03 16:50:19.377 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=Ph9Uu5EXjAnHIj_9G2ZKbw&oh=01_Q5Aa1wEynvA7taSKcstiXD1tmjYnal-KcyfKcBcOTd_gvhF4Dg&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=Ph9Uu5EXjAnHIj_9G2ZKbw&oh=01_Q5Aa1wGwCktK6RZdGXVty6JjaaKBQTRLcB_uOPDSnt3TMYYVwg&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:50:19.380 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:50:19.381 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 971.0381ms
2025-07-03 16:50:19.383 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:50:19.384 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 988.8634ms
2025-07-03 16:50:28.273 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 394
2025-07-03 16:50:28.275 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:50:28.277 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 16:50:28.279 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227"}]},"field":"messages"}]}]}
2025-07-03 16:50:28.280 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 16:50:28.280 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227"}]},"field":"messages"}]}]}
2025-07-03 16:50:28.281 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:50:28.282 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 16:50:28.283 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5281ms
2025-07-03 16:50:28.283 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227"}]},"field":"messages"}]}]}
2025-07-03 16:50:28.285 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:50:28.288 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 16:50:28.288 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6769ms
2025-07-03 16:50:28.290 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:50:28.293 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:50:28.519 +05:30 [INF] Request starting HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-03 16:50:28.522 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:50:28.523 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 16:50:28.525 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:50:28.526 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 16:50:28.526 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:50:28.527 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:50:28.528 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 16:50:28.529 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6528ms
2025-07-03 16:50:28.530 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==","status":"delivered","timestamp":"1751541631","recipient_id":"917082156227","conversation":{"id":"fc03719653b0a6b41125dd0fef5ee918","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 16:50:28.531 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 16:50:28.534 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 16:50:28.534 +05:30 [INF] Request finished HTTP/1.1 POST http://cb46-2401-4900-5d30-9fdc-80fb-3a6b-6d9e-cedb.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.8218ms
2025-07-03 16:50:28.536 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:50:28.540 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk0RTI4QTQ2MkVFNDcyMEZGAA==
2025-07-03 16:50:42.227 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:50:42.229 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:50:42.231 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:50:42.232 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:50:42.235 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:50:42.238 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:50:42.239 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:50:42.955 +05:30 [INF] Received HTTP response headers after 714.4684ms - 200
2025-07-03 16:50:42.956 +05:30 [INF] End processing HTTP request after 718.2195ms - 200
2025-07-03 16:50:42.964 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=PFS7jB3nfhwqpwkQomoHgQ&oh=01_Q5Aa1wGPSvkkLY-MioA82-gcC870tZnTiEU-oYnwkAMTWNntFA&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=PFS7jB3nfhwqpwkQomoHgQ&oh=01_Q5Aa1wG3AOUICHDag_HDyB4VZao_MxJ6NQDPBXzS7vAPbHwBjw&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:50:42.967 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:50:42.969 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 735.653ms
2025-07-03 16:50:42.970 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:50:42.971 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 744.3183ms
2025-07-03 16:51:05.709 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:51:05.712 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:51:05.713 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:51:05.715 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:51:05.718 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:51:05.721 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:51:05.722 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:51:06.464 +05:30 [INF] Received HTTP response headers after 739.947ms - 200
2025-07-03 16:51:06.465 +05:30 [INF] End processing HTTP request after 743.4914ms - 200
2025-07-03 16:51:06.471 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=m7hOj1NoH4ORf9Sy-hCyQw&oh=01_Q5Aa1wEtX45pMaXBg4DgxCQ8PtaPSfFcFYrQdXZaKMiWPF4yKw&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=m7hOj1NoH4ORf9Sy-hCyQw&oh=01_Q5Aa1wEI35OWIG-lGLQHIa1jmXajP5w01mXbNPAYCqL27fvPJA&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:51:06.474 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:51:06.475 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 759.1946ms
2025-07-03 16:51:06.477 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:51:06.478 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 768.6796ms
2025-07-03 16:51:16.864 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:51:16.867 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:51:16.868 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:51:16.869 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:51:16.872 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:51:16.876 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:51:16.877 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:51:17.646 +05:30 [INF] Received HTTP response headers after 768.0427ms - 200
2025-07-03 16:51:17.648 +05:30 [INF] End processing HTTP request after 772.5758ms - 200
2025-07-03 16:51:17.650 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=vlUckZ-sWZb7FnYq641KGg&oh=01_Q5Aa1wGq4CPnGsBZLIRp3pk5HMa8HE8xq3ntZnhdFlt043IR4g&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=vlUckZ-sWZb7FnYq641KGg&oh=01_Q5Aa1wFVtq8HVVyq0wKlkNFUfjyORU2xrxP8ZCvSqX3b6NLWVQ&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:51:17.653 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:51:17.655 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 784.1738ms
2025-07-03 16:51:17.656 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:51:17.658 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 793.2796ms
2025-07-03 16:51:36.292 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - null null
2025-07-03 16:51:36.295 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:51:36.296 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/cta-flow/save-visual - 204 null null 4.5543ms
2025-07-03 16:51:36.297 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - application/json 1511
2025-07-03 16:51:36.312 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:51:36.313 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 16:51:36.336 +05:30 [INF] Route matched with {action = "SaveVisualFlow", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SaveVisualFlow(xbytechat.api.Features.CTAFlowBuilder.DTOs.SaveVisualFlowDto) on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-03 16:51:39.227 +05:30 [INF] 📦 Saving CTA Flow: imagecampaign by Tata Consultancy Services
2025-07-03 16:51:39.235 +05:30 [INF] 🧠 SaveVisualFlow started | FlowName: imagecampaign | BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 16:51:39.246 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_FlowName_0='imagecampaign', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
FROM "CTAFlowConfigs" AS c
WHERE c."FlowName" = @__dto_FlowName_0 AND c."BusinessId" = @__businessId_1
LIMIT 1
2025-07-03 16:51:39.271 +05:30 [INF] ✅ New FlowConfig created with ID: "85eda15d-813f-4854-8a68-caeb49858784"
2025-07-03 16:51:39.380 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='85eda15d-813f-4854-8a68-caeb49858784', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='2025-07-03T11:21:39.2515935Z' (DbType = DateTime), @p3='Tata Consultancy Services', @p4='imagecampaign' (Nullable = false), @p5='True', @p6='True', @p7='2025-07-03T11:21:39.2516829Z' (Nullable = true) (DbType = DateTime), @p8='93178841-883e-499a-badd-f5ba77224e5c', @p9='85eda15d-813f-4854-8a68-caeb49858784', @p10='424.44073' (Nullable = true), @p11='247.6447' (Nullable = true), @p12=NULL, @p13=NULL, @p14='1', @p15='flow_step_1' (Nullable = false), @p16='text_template', @p17='Visit website' (Nullable = false), @p18='URL' (Nullable = false), @p19='f8ea777b-e0da-40c6-b3bd-2f38442854b8', @p20='85eda15d-813f-4854-8a68-caeb49858784', @p21='5.102033' (Nullable = true), @p22='191.10248' (Nullable = true), @p23=NULL, @p24=NULL, @p25='0', @p26='imagecampaign' (Nullable = false), @p27='text_template', @p28='Visit website' (Nullable = false), @p29='cta' (Nullable = false), @p30='5f6b7a3f-cacf-44d8-a52f-d67a8dbc434c', @p31='url' (Nullable = false), @p32='Visit website' (Nullable = false), @p33='URL' (Nullable = false), @p34='https://www.myntra.com/men-sweatshirts' (Nullable = false), @p35='f8ea777b-e0da-40c6-b3bd-2f38442854b8', @p36='93178841-883e-499a-badd-f5ba77224e5c' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CTAFlowConfigs" ("Id", "BusinessId", "CreatedAt", "CreatedBy", "FlowName", "IsActive", "IsPublished", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "CTAFlowSteps" ("Id", "CTAFlowConfigId", "PositionX", "PositionY", "RequiredSource", "RequiredTag", "StepOrder", "TemplateToSend", "TemplateType", "TriggerButtonText", "TriggerButtonType")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29);
INSERT INTO "FlowButtonLinks" ("Id", "ButtonSubType", "ButtonText", "ButtonType", "ButtonValue", "CTAFlowStepId", "NextStepId")
VALUES (@p30, @p31, @p32, @p33, @p34, @p35, @p36);
2025-07-03 16:51:39.404 +05:30 [INF] ✅ Flow 'imagecampaign' saved | Steps: 2 | Links: 2
2025-07-03 16:51:39.406 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:51:39.407 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api) in 3068.7999ms
2025-07-03 16:51:39.409 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.SaveVisualFlow (xbytechat.api)'
2025-07-03 16:51:39.410 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/cta-flow/save-visual - 200 null application/json; charset=utf-8 3113.009ms
2025-07-03 16:52:08.879 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 16:52:08.881 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:08.883 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:52:08.884 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 16:52:08.888 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 16:52:08.891 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:52:08.892 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:52:09.808 +05:30 [INF] Received HTTP response headers after 914.5202ms - 200
2025-07-03 16:52:09.809 +05:30 [INF] End processing HTTP request after 918.5035ms - 200
2025-07-03 16:52:09.811 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEwxn1S&_nc_oc=AdmLpGhMMZDBWs_U-tw6X9Rx-NMEz5b2zjUN55KaNuT8QMXzekUrf-uE1_U4HNVygAuyWGrPm33u4t2eiAJ8YK6O&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=W_lxpG4Eg-8Qz42w8HgIig&oh=01_Q5Aa1wG9Mk5Po3H8OE5mFVJv9wDMg76WZm-7aFrreqzf1RAlPQ&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwFPgcpR&_nc_oc=AdnJ81E-ie8s3GT_0MLYo5lonGocfOj6DDDf8d-wHkt_QOkPvSZA6uQ2gdBH-fgaWkMdMCWImJ85qI6uVojas8_P&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=W_lxpG4Eg-8Qz42w8HgIig&oh=01_Q5Aa1wGkGD76okzHfGvFOSXrUFWPGEjEq27xgkDT2cuHWGAoNw&oe=688DBE97"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 16:52:09.813 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:52:09.815 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 929.7759ms
2025-07-03 16:52:09.816 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 16:52:09.817 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 938.3935ms
2025-07-03 16:52:36.049 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - null null
2025-07-03 16:52:36.053 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:36.054 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - 204 null null 5.1188ms
2025-07-03 16:52:36.055 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - application/json 434
2025-07-03 16:52:36.059 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:36.060 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 16:52:36.063 +05:30 [INF] Route matched with {action = "CreateTextCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTextCampaign(xbytechat.api.Features.CampaignModule.DTOs.CampaignCreateDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:52:39.151 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 16:52:39.155 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:52:39.156 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:52:39.889 +05:30 [INF] Received HTTP response headers after 732.2378ms - 200
2025-07-03 16:52:39.891 +05:30 [INF] End processing HTTP request after 736.2119ms - 200
2025-07-03 16:52:39.973 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='1ed614e8-8b66-4049-93d2-1a23085585be', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3='image', @p4='2025-07-03T11:22:39.8955916Z' (DbType = DateTime), @p5='system', @p6=NULL (DbType = Guid), @p7=NULL (DbType = DateTime), @p8=NULL, @p9=NULL, @p10=NULL, @p11='https://picsum.photos/200/300', @p12='False', @p13='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:', @p14='imagecampaign' (Nullable = false), @p15='imageCampaignFlow' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL (DbType = Guid), @p18='Draft' (Nullable = false), @p19='imagecampaign', @p20='[]', @p21='2025-07-03T11:22:39.8956448Z' (DbType = DateTime), @p22='b6c5aed4-d66a-4276-a6eb-0badb407f8a9', @p23='1ed614e8-8b66-4049-93d2-1a23085585be', @p24='True', @p25='2', @p26='Call Us' (Nullable = false), @p27='PHONE_NUMBER' (Nullable = false), @p28='+918765436785' (Nullable = false), @p29='dff1b0df-d4bb-4eb3-8777-494426ef8530', @p30='1ed614e8-8b66-4049-93d2-1a23085585be', @p31='True', @p32='1', @p33='Visit website' (Nullable = false), @p34='URL' (Nullable = false), @p35='https://www.myntra.com/men-sweatshirts' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Campaigns" ("Id", "BusinessId", "CampaignId", "CampaignType", "CreatedAt", "CreatedBy", "CtaId", "DeletedAt", "DeletedBy", "FollowUpTemplateId", "ImageCaption", "ImageUrl", "IsDeleted", "MessageBody", "MessageTemplate", "Name", "ScheduledAt", "SourceCampaignId", "Status", "TemplateId", "TemplateParameters", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p22, @p23, @p24, @p25, @p26, @p27, @p28);
INSERT INTO "CampaignButtons" ("Id", "CampaignId", "IsFromTemplate", "Position", "Title", "Type", "Value")
VALUES (@p29, @p30, @p31, @p32, @p33, @p34, @p35);
2025-07-03 16:52:39.977 +05:30 [INF] ✅ Campaign 'imageCampaignFlow' created with 0 recipients, 0 user buttons, 2 template buttons and 0 template parameters
2025-07-03 16:52:39.979 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:52:39.981 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api) in 3916.6846ms
2025-07-03 16:52:39.982 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-03 16:52:39.983 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - 200 null application/json; charset=utf-8 3928.0921ms
2025-07-03 16:52:40.032 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be - null null
2025-07-03 16:52:40.032 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 16:52:40.035 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:40.035 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - null null
2025-07-03 16:52:40.041 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:40.042 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 16:52:40.044 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:40.045 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 16:52:40.046 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:52:40.048 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 16:52:40.048 +05:30 [INF] Route matched with {action = "GetCampaignById", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignModule.DTOs.CampaignDto]] GetCampaignById(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:52:40.049 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 16:52:40.049 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=1000
2025-07-03 16:52:40.055 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 16:52:40.060 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='100', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 16:52:40.062 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:52:40.063 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 16:52:40.065 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 16.3814ms
2025-07-03 16:52:40.068 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 16:52:40.068 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:52:40.069 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - 200 null application/json; charset=utf-8 34.2278ms
2025-07-03 16:52:40.074 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 22.6174ms
2025-07-03 16:52:40.075 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-03 16:52:40.075 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 16:52:40.077 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:40.078 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 45.8472ms
2025-07-03 16:52:40.080 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 16:52:40.081 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='1ed614e8-8b66-4049-93d2-1a23085585be', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t."Id0", t."BusinessId0", t."ButtonText", t."ButtonType", t."CreatedAt0", t."Description", t."IsActive", t."TargetUrl", t."Title", t."UpdatedAt0", c1."Id", c1."CampaignId", c1."IsFromTemplate", c1."Position", c1."Title", c1."Type", c1."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt", c0."Id" AS "Id0", c0."BusinessId" AS "BusinessId0", c0."ButtonText", c0."ButtonType", c0."CreatedAt" AS "CreatedAt0", c0."Description", c0."IsActive", c0."TargetUrl", c0."Title", c0."UpdatedAt" AS "UpdatedAt0"
    FROM "Campaigns" AS c
    LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c1 ON t."Id" = c1."CampaignId"
ORDER BY t."Id", t."Id0"
2025-07-03 16:52:40.084 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-03 16:52:40.090 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-03 16:52:40.093 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:52:40.094 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 6.3308ms
2025-07-03 16:52:40.095 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-03 16:52:40.097 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 21.401ms
2025-07-03 16:52:40.097 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignModule.DTOs.CampaignDto'.
2025-07-03 16:52:40.105 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api) in 54.5194ms
2025-07-03 16:52:40.106 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-03 16:52:40.107 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be - 200 null application/json; charset=utf-8 75.146ms
2025-07-03 16:52:45.021 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be/assign-contacts - null null
2025-07-03 16:52:45.023 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:45.024 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be/assign-contacts - 204 null null 3.1475ms
2025-07-03 16:52:45.025 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be/assign-contacts - application/json 289
2025-07-03 16:52:45.029 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:45.030 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 16:52:45.033 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:52:47.191 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__campaignId_0='1ed614e8-8b66-4049-93d2-1a23085585be', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-03 16:52:47.221 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='87b88194-7e4a-46c0-92bb-10baae7ab77c', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='1ed614e8-8b66-4049-93d2-1a23085585be', @p4=NULL, @p5=NULL, @p6='0876f654-a362-420f-a912-6bce793436a5', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-03T11:22:47.2148257Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-03T11:22:47.2148258Z' (DbType = DateTime), @p13='9a3bd58c-09ff-4902-a685-35a6071ee8d2', @p14=NULL, @p15='c13be597-6ae2-42bb-9d43-925815f24ff8', @p16='1ed614e8-8b66-4049-93d2-1a23085585be', @p17=NULL, @p18=NULL, @p19='8aac7c57-6699-4511-897b-4121b407eb1c', @p20='False', @p21=NULL, @p22=NULL, @p23='2025-07-03T11:22:47.1967124Z' (Nullable = true) (DbType = DateTime), @p24='Pending' (Nullable = false), @p25='2025-07-03T11:22:47.1967641Z' (DbType = DateTime), @p26='9d66357f-9e17-497e-ac6e-4c0ddbf66e13', @p27=NULL, @p28='c13be597-6ae2-42bb-9d43-925815f24ff8', @p29='1ed614e8-8b66-4049-93d2-1a23085585be', @p30=NULL, @p31=NULL, @p32='80c43c6a-508b-47ff-9360-201bfd5521d3', @p33='False', @p34=NULL, @p35=NULL, @p36='2025-07-03T11:22:47.2148506Z' (Nullable = true) (DbType = DateTime), @p37='Pending' (Nullable = false), @p38='2025-07-03T11:22:47.2148506Z' (DbType = DateTime), @p39='b176844c-af2c-4dae-ab1c-26a4dd706b65', @p40=NULL, @p41='c13be597-6ae2-42bb-9d43-925815f24ff8', @p42='1ed614e8-8b66-4049-93d2-1a23085585be', @p43=NULL, @p44=NULL, @p45='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p46='False', @p47=NULL, @p48=NULL, @p49='2025-07-03T11:22:47.2147767Z' (Nullable = true) (DbType = DateTime), @p50='Pending' (Nullable = false), @p51='2025-07-03T11:22:47.2147768Z' (DbType = DateTime), @p52='c55c7267-577a-41a5-85c5-691fd6db67b6', @p53=NULL, @p54='c13be597-6ae2-42bb-9d43-925815f24ff8', @p55='1ed614e8-8b66-4049-93d2-1a23085585be', @p56=NULL, @p57=NULL, @p58='491ee04c-27c4-49e4-9bb8-ef8892951090', @p59='False', @p60=NULL, @p61=NULL, @p62='2025-07-03T11:22:47.2148438Z' (Nullable = true) (DbType = DateTime), @p63='Pending' (Nullable = false), @p64='2025-07-03T11:22:47.2148439Z' (DbType = DateTime), @p65='d11e6bc5-4d47-47a4-acf2-49857b6c4f1d', @p66=NULL, @p67='c13be597-6ae2-42bb-9d43-925815f24ff8', @p68='1ed614e8-8b66-4049-93d2-1a23085585be', @p69=NULL, @p70=NULL, @p71='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p72='False', @p73=NULL, @p74=NULL, @p75='2025-07-03T11:22:47.2146114Z' (Nullable = true) (DbType = DateTime), @p76='Pending' (Nullable = false), @p77='2025-07-03T11:22:47.2146118Z' (DbType = DateTime), @p78='e837c369-4d3f-4caa-942c-02b487836478', @p79=NULL, @p80='c13be597-6ae2-42bb-9d43-925815f24ff8', @p81='1ed614e8-8b66-4049-93d2-1a23085585be', @p82=NULL, @p83=NULL, @p84='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p85='False', @p86=NULL, @p87=NULL, @p88='2025-07-03T11:22:47.2148081Z' (Nullable = true) (DbType = DateTime), @p89='Pending' (Nullable = false), @p90='2025-07-03T11:22:47.2148082Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37, @p38);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p52, @p53, @p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75, @p76, @p77);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90);
2025-07-03 16:52:47.225 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 16:52:47.226 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 2190.8048ms
2025-07-03 16:52:47.227 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-03 16:52:47.227 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/1ed614e8-8b66-4049-93d2-1a23085585be/assign-contacts - 200 null application/json; charset=utf-8 2202.3261ms
2025-07-03 16:52:53.579 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 16:52:53.581 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:53.583 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 16:52:53.584 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:52:53.595 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 16:52:53.599 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 16:52:53.602 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 16.5204ms
2025-07-03 16:52:53.603 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 16:52:53.604 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 25.9378ms
2025-07-03 16:52:57.293 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/1ed614e8-8b66-4049-93d2-1a23085585be - null 0
2025-07-03 16:52:57.296 +05:30 [INF] CORS policy execution successful.
2025-07-03 16:52:57.297 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 16:52:57.301 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 16:52:59.425 +05:30 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-07-03 16:52:59.434 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='1ed614e8-8b66-4049-93d2-1a23085585be'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-03 16:52:59.444 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-03 16:52:59.446 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:52:59.447 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 16:53:00.233 +05:30 [INF] Received HTTP response headers after 785.0072ms - 200
2025-07-03 16:53:00.234 +05:30 [INF] End processing HTTP request after 788.5218ms - 200
2025-07-03 16:53:00.237 +05:30 [INF] 📨 Preparing to send to 917082156227
2025-07-03 16:53:01.235 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:01.236 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:01.241 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:01.242 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:02.129 +05:30 [INF] Received HTTP response headers after 886.1997ms - 400
2025-07-03 16:53:02.131 +05:30 [INF] End processing HTTP request after 889.754ms - 400
2025-07-03 16:53:02.134 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) Invalid parameter\",\"type\":\"OAuthException\",\"code\":100,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"buttons: Button at index 0 of type Url does not require parameters\"},\"fbtrace_id\":\"ANK1YJxarcs1jyp5LUeLBmB\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:02.136 +05:30 [INF] 📥 MessageLog saved for 917082156227
2025-07-03 16:53:02.178 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "87b88194-7e4a-46c0-92bb-10baae7ab77c"
2025-07-03 16:53:02.179 +05:30 [INF] 📨 Preparing to send to +917082156227
2025-07-03 16:53:03.132 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:03.134 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:03.135 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:03.136 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:03.728 +05:30 [INF] Received HTTP response headers after 590.9488ms - 400
2025-07-03 16:53:03.729 +05:30 [INF] End processing HTTP request after 594.156ms - 400
2025-07-03 16:53:03.731 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) Invalid parameter\",\"type\":\"OAuthException\",\"code\":100,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"buttons: Button at index 0 of type Url does not require parameters\"},\"fbtrace_id\":\"AzjROrPEiS7JUI5n9cFqC6Q\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:03.732 +05:30 [INF] 📥 MessageLog saved for +917082156227
2025-07-03 16:53:03.733 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "9a3bd58c-09ff-4902-a685-35a6071ee8d2"
2025-07-03 16:53:03.734 +05:30 [INF] 📨 Preparing to send to 447543746206
2025-07-03 16:53:04.694 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:04.695 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:04.696 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:04.697 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:05.294 +05:30 [INF] Received HTTP response headers after 596.3338ms - 400
2025-07-03 16:53:05.296 +05:30 [INF] End processing HTTP request after 599.2171ms - 400
2025-07-03 16:53:05.298 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) Invalid parameter\",\"type\":\"OAuthException\",\"code\":100,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"buttons: Button at index 0 of type Url does not require parameters\"},\"fbtrace_id\":\"Ai253Bx86igNmGraaNoR89t\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:05.299 +05:30 [INF] 📥 MessageLog saved for 447543746206
2025-07-03 16:53:05.299 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "9d66357f-9e17-497e-ac6e-4c0ddbf66e13"
2025-07-03 16:53:05.300 +05:30 [INF] 📨 Preparing to send to 1234567890
2025-07-03 16:53:06.334 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:06.335 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:06.336 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:06.337 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:06.925 +05:30 [INF] Received HTTP response headers after 586.9197ms - 400
2025-07-03 16:53:06.926 +05:30 [INF] End processing HTTP request after 590.2177ms - 400
2025-07-03 16:53:06.928 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"A-E8epn5yrz-B3I5cXOb7FO\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:06.929 +05:30 [INF] 📥 MessageLog saved for 1234567890
2025-07-03 16:53:06.930 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "b176844c-af2c-4dae-ab1c-26a4dd706b65"
2025-07-03 16:53:06.931 +05:30 [INF] 📨 Preparing to send to +917654768956
2025-07-03 16:53:08.070 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:08.071 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:08.073 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:08.074 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:08.703 +05:30 [INF] Received HTTP response headers after 628.2459ms - 400
2025-07-03 16:53:08.704 +05:30 [INF] End processing HTTP request after 631.7212ms - 400
2025-07-03 16:53:08.706 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AeElt_LoN-68l9oi-4yrTE_\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:08.707 +05:30 [INF] 📥 MessageLog saved for +917654768956
2025-07-03 16:53:08.708 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "c55c7267-577a-41a5-85c5-691fd6db67b6"
2025-07-03 16:53:08.709 +05:30 [INF] 📨 Preparing to send to 7082156227
2025-07-03 16:53:09.293 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:09.294 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:09.295 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:09.296 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:09.968 +05:30 [INF] Received HTTP response headers after 671.6338ms - 400
2025-07-03 16:53:09.970 +05:30 [INF] End processing HTTP request after 674.7386ms - 400
2025-07-03 16:53:09.972 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"A_nlYHpiiTqkY2-vcIGhgpt\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:09.973 +05:30 [INF] 📥 MessageLog saved for 7082156227
2025-07-03 16:53:09.973 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "d11e6bc5-4d47-47a4-acf2-49857b6c4f1d"
2025-07-03 16:53:09.974 +05:30 [INF] 📨 Preparing to send to 8787878787
2025-07-03 16:53:10.441 +05:30 [INF] ℹ️ Skipping parameters for static button 'Call Us' (url)
2025-07-03 16:53:10.442 +05:30 [INF] ℹ️ Skipping parameters for static button 'Visit website' (voice_call)
2025-07-03 16:53:10.443 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:10.444 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 16:53:11.007 +05:30 [INF] Received HTTP response headers after 561.7294ms - 400
2025-07-03 16:53:11.008 +05:30 [INF] End processing HTTP request after 565.2561ms - 400
2025-07-03 16:53:11.010 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#131030) Recipient phone number not in allowed list\",\"type\":\"OAuthException\",\"code\":131030,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again.\"},\"fbtrace_id\":\"AtGw4G270i_YDsc3i5-sx2x\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-03 16:53:11.011 +05:30 [INF] 📥 MessageLog saved for 8787878787
2025-07-03 16:53:11.012 +05:30 [INF] 🗃️ CampaignSendLog saved for recipient "e837c369-4d3f-4caa-942c-02b487836478"
2025-07-03 16:53:11.013 +05:30 [INF] 💾 Saving all DB changes...
2025-07-03 16:53:11.050 +05:30 [INF] Executed DbCommand (24ms) [Parameters=[@p0='084cc384-dde1-4bca-8a9e-75191621393c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p5='1b52f26e-9fad-4233-a6bb-57603945f8d6' (Nullable = true), @p6='2025-07-03T11:23:11.0116497Z' (DbType = DateTime), @p7='API returned error', @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AtGw4G270i_YDsc3i5-sx2x"}}', @p13='8787878787' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Failed' (Nullable = false), @p19='444f445a-5316-4171-ac24-c1720881625e', @p20='c13be597-6ae2-42bb-9d43-925815f24ff8', @p21=NULL (DbType = Guid), @p22=NULL (DbType = Guid), @p23='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p24='80c43c6a-508b-47ff-9360-201bfd5521d3' (Nullable = true), @p25='2025-07-03T11:23:05.2988673Z' (DbType = DateTime), @p26='API returned error', @p27='False', @p28='https://picsum.photos/200/300', @p29='imagecampaign' (Nullable = false), @p30=NULL, @p31='{"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"buttons: Button at index 0 of type Url does not require parameters"},"fbtrace_id":"Ai253Bx86igNmGraaNoR89t"}}', @p32='447543746206' (Nullable = false), @p33=NULL (DbType = Guid), @p34=NULL, @p35=NULL (DbType = DateTime), @p36=NULL, @p37='Failed' (Nullable = false), @p38='557a610b-a108-4b66-9843-b906c31d452e', @p39='c13be597-6ae2-42bb-9d43-925815f24ff8', @p40=NULL (DbType = Guid), @p41=NULL (DbType = Guid), @p42='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p43='867c9c9b-f85e-4572-9bbd-4447b44597b7' (Nullable = true), @p44='2025-07-03T11:23:09.9729205Z' (DbType = DateTime), @p45='API returned error', @p46='False', @p47='https://picsum.photos/200/300', @p48='imagecampaign' (Nullable = false), @p49=NULL, @p50='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A_nlYHpiiTqkY2-vcIGhgpt"}}', @p51='7082156227' (Nullable = false), @p52=NULL (DbType = Guid), @p53=NULL, @p54=NULL (DbType = DateTime), @p55=NULL, @p56='Failed' (Nullable = false), @p57='72a715ea-7a43-4bdc-99f6-583c2635c45e', @p58='c13be597-6ae2-42bb-9d43-925815f24ff8', @p59=NULL (DbType = Guid), @p60=NULL (DbType = Guid), @p61='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p62='491ee04c-27c4-49e4-9bb8-ef8892951090' (Nullable = true), @p63='2025-07-03T11:23:08.7077571Z' (DbType = DateTime), @p64='API returned error', @p65='False', @p66='https://picsum.photos/200/300', @p67='imagecampaign' (Nullable = false), @p68=NULL, @p69='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"AeElt_LoN-68l9oi-4yrTE_"}}', @p70='+917654768956' (Nullable = false), @p71=NULL (DbType = Guid), @p72=NULL, @p73=NULL (DbType = DateTime), @p74=NULL, @p75='Failed' (Nullable = false), @p76='86edac65-bc05-4fe6-b39e-0e51a2d53d29', @p77='c13be597-6ae2-42bb-9d43-925815f24ff8', @p78=NULL (DbType = Guid), @p79=NULL (DbType = Guid), @p80='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p81='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p82='2025-07-03T11:23:03.7323724Z' (DbType = DateTime), @p83='API returned error', @p84='False', @p85='https://picsum.photos/200/300', @p86='imagecampaign' (Nullable = false), @p87=NULL, @p88='{"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"buttons: Button at index 0 of type Url does not require parameters"},"fbtrace_id":"AzjROrPEiS7JUI5n9cFqC6Q"}}', @p89='+917082156227' (Nullable = false), @p90=NULL (DbType = Guid), @p91=NULL, @p92=NULL (DbType = DateTime), @p93=NULL, @p94='Failed' (Nullable = false), @p95='9d3ff1b3-f9fe-4b0f-888c-77971f3ac2d6', @p96='c13be597-6ae2-42bb-9d43-925815f24ff8', @p97=NULL (DbType = Guid), @p98=NULL (DbType = Guid), @p99='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p100='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p101='2025-07-03T11:23:02.1351962Z' (DbType = DateTime), @p102='API returned error', @p103='False', @p104='https://picsum.photos/200/300', @p105='imagecampaign' (Nullable = false), @p106=NULL, @p107='{"error":{"message":"(#100) Invalid parameter","type":"OAuthException","code":100,"error_data":{"messaging_product":"whatsapp","details":"buttons: Button at index 0 of type Url does not require parameters"},"fbtrace_id":"ANK1YJxarcs1jyp5LUeLBmB"}}', @p108='917082156227' (Nullable = false), @p109=NULL (DbType = Guid), @p110=NULL, @p111=NULL (DbType = DateTime), @p112=NULL, @p113='Failed' (Nullable = false), @p114='e10b47e5-4923-432f-9ab8-f7a89dfbb9e2', @p115='c13be597-6ae2-42bb-9d43-925815f24ff8', @p116=NULL (DbType = Guid), @p117=NULL (DbType = Guid), @p118='1ed614e8-8b66-4049-93d2-1a23085585be' (Nullable = true), @p119='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac' (Nullable = true), @p120='2025-07-03T11:23:06.9296595Z' (DbType = DateTime), @p121='API returned error', @p122='False', @p123='https://picsum.photos/200/300', @p124='imagecampaign' (Nullable = false), @p125=NULL, @p126='{"error":{"message":"(#131030) Recipient phone number not in allowed list","type":"OAuthException","code":131030,"error_data":{"messaging_product":"whatsapp","details":"Recipient phone number not in allowed list: Add recipient phone number to recipient list and try again."},"fbtrace_id":"A-E8epn5yrz-B3I5cXOb7FO"}}', @p127='1234567890' (Nullable = false), @p128=NULL (DbType = Guid), @p129=NULL, @p130=NULL (DbType = DateTime), @p131=NULL, @p132='Failed' (Nullable = false), @p133='3e002c44-e1b4-42b3-b39e-b51f023a938c', @p134='True', @p135=NULL, @p136='c13be597-6ae2-42bb-9d43-925815f24ff8', @p137='1ed614e8-8b66-4049-93d2-1a23085585be', @p138=NULL, @p139=NULL, @p140=NULL (DbType = DateTime), @p141='0876f654-a362-420f-a912-6bce793436a5', @p142=NULL, @p143='2025-07-03T11:23:02.1379236Z' (DbType = DateTime), @p144='system', @p145=NULL (DbType = DateTime), @p146=NULL, @p147=NULL, @p148=NULL, @p149=NULL, @p150='False', @p151=NULL (DbType = DateTime), @p152=NULL, @p153=NULL, @p154='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p155=NULL, @p156='9d3ff1b3-f9fe-4b0f-888c-77971f3ac2d6' (Nullable = true), @p157=NULL (DbType = DateTime), @p158='87b88194-7e4a-46c0-92bb-10baae7ab77c', @p159='0', @p160='Failed', @p161='2025-07-03T11:23:02.1379816Z' (Nullable = true) (DbType = DateTime), @p162=NULL, @p163='imagecampaign', @p164=NULL (DbType = Guid), @p165='87148179-ebbe-48b1-938e-229c2cad402c', @p166='True', @p167=NULL, @p168='c13be597-6ae2-42bb-9d43-925815f24ff8', @p169='1ed614e8-8b66-4049-93d2-1a23085585be', @p170=NULL, @p171=NULL, @p172=NULL (DbType = DateTime), @p173='80c43c6a-508b-47ff-9360-201bfd5521d3', @p174=NULL, @p175='2025-07-03T11:23:05.2998312Z' (DbType = DateTime), @p176='system', @p177=NULL (DbType = DateTime), @p178=NULL, @p179=NULL, @p180=NULL, @p181=NULL, @p182='False', @p183=NULL (DbType = DateTime), @p184=NULL, @p185=NULL, @p186='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p187=NULL, @p188='444f445a-5316-4171-ac24-c1720881625e' (Nullable = true), @p189=NULL (DbType = DateTime), @p190='9d66357f-9e17-497e-ac6e-4c0ddbf66e13', @p191='0', @p192='Failed', @p193='2025-07-03T11:23:05.2998312Z' (Nullable = true) (DbType = DateTime), @p194=NULL, @p195='imagecampaign', @p196=NULL (DbType = Guid), @p197='959e3597-4ddd-45e9-9a57-47b3b464aef1', @p198='True', @p199=NULL, @p200='c13be597-6ae2-42bb-9d43-925815f24ff8', @p201='1ed614e8-8b66-4049-93d2-1a23085585be', @p202=NULL, @p203=NULL, @p204=NULL (DbType = DateTime), @p205='8aac7c57-6699-4511-897b-4121b407eb1c', @p206=NULL, @p207='2025-07-03T11:23:03.7332776Z' (DbType = DateTime), @p208='system', @p209=NULL (DbType = DateTime), @p210=NULL, @p211=NULL, @p212=NULL, @p213=NULL, @p214='False', @p215=NULL (DbType = DateTime), @p216=NULL, @p217=NULL, @p218='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p219=NULL, @p220='86edac65-bc05-4fe6-b39e-0e51a2d53d29' (Nullable = true), @p221=NULL (DbType = DateTime), @p222='9a3bd58c-09ff-4902-a685-35a6071ee8d2', @p223='0', @p224='Failed', @p225='2025-07-03T11:23:03.7332777Z' (Nullable = true) (DbType = DateTime), @p226=NULL, @p227='imagecampaign', @p228=NULL (DbType = Guid), @p229='d691fa75-339f-41a7-8d07-af75b324ad90', @p230='True', @p231=NULL, @p232='c13be597-6ae2-42bb-9d43-925815f24ff8', @p233='1ed614e8-8b66-4049-93d2-1a23085585be', @p234=NULL, @p235=NULL, @p236=NULL (DbType = DateTime), @p237='bf3cf7cf-c327-42d1-b7f5-0c9fb85024ac', @p238=NULL, @p239='2025-07-03T11:23:06.9305452Z' (DbType = DateTime), @p240='system', @p241=NULL (DbType = DateTime), @p242=NULL, @p243=NULL, @p244=NULL, @p245=NULL, @p246='False', @p247=NULL (DbType = DateTime), @p248=NULL, @p249=NULL, @p250='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p251=NULL, @p252='e10b47e5-4923-432f-9ab8-f7a89dfbb9e2' (Nullable = true), @p253=NULL (DbType = DateTime), @p254='b176844c-af2c-4dae-ab1c-26a4dd706b65', @p255='0', @p256='Failed', @p257='2025-07-03T11:23:06.9305453Z' (Nullable = true) (DbType = DateTime), @p258=NULL, @p259='imagecampaign', @p260=NULL (DbType = Guid), @p261='f522e009-9ef5-4990-bcca-2cfaa9522b47', @p262='True', @p263=NULL, @p264='c13be597-6ae2-42bb-9d43-925815f24ff8', @p265='1ed614e8-8b66-4049-93d2-1a23085585be', @p266=NULL, @p267=NULL, @p268=NULL (DbType = DateTime), @p269='491ee04c-27c4-49e4-9bb8-ef8892951090', @p270=NULL, @p271='2025-07-03T11:23:08.7086392Z' (DbType = DateTime), @p272='system', @p273=NULL (DbType = DateTime), @p274=NULL, @p275=NULL, @p276=NULL, @p277=NULL, @p278='False', @p279=NULL (DbType = DateTime), @p280=NULL, @p281=NULL, @p282='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p283=NULL, @p284='72a715ea-7a43-4bdc-99f6-583c2635c45e' (Nullable = true), @p285=NULL (DbType = DateTime), @p286='c55c7267-577a-41a5-85c5-691fd6db67b6', @p287='0', @p288='Failed', @p289='2025-07-03T11:23:08.7086392Z' (Nullable = true) (DbType = DateTime), @p290=NULL, @p291='imagecampaign', @p292=NULL (DbType = Guid), @p293='f52d364f-00a9-4949-a048-d8ece0303b8e', @p294='True', @p295=NULL, @p296='c13be597-6ae2-42bb-9d43-925815f24ff8', @p297='1ed614e8-8b66-4049-93d2-1a23085585be', @p298=NULL, @p299=NULL, @p300=NULL (DbType = DateTime), @p301='1b52f26e-9fad-4233-a6bb-57603945f8d6', @p302=NULL, @p303='2025-07-03T11:23:11.0124667Z' (DbType = DateTime), @p304='system', @p305=NULL (DbType = DateTime), @p306=NULL, @p307=NULL, @p308=NULL, @p309=NULL, @p310='False', @p311=NULL (DbType = DateTime), @p312=NULL, @p313=NULL, @p314='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p315=NULL, @p316='084cc384-dde1-4bca-8a9e-75191621393c' (Nullable = true), @p317=NULL (DbType = DateTime), @p318='e837c369-4d3f-4caa-942c-02b487836478', @p319='0', @p320='Failed', @p321='2025-07-03T11:23:11.0124667Z' (Nullable = true) (DbType = DateTime), @p322=NULL, @p323='imagecampaign', @p324=NULL (DbType = Guid), @p325='fc590d7f-cc2b-4457-89fe-803ff4ca83aa', @p326='True', @p327=NULL, @p328='c13be597-6ae2-42bb-9d43-925815f24ff8', @p329='1ed614e8-8b66-4049-93d2-1a23085585be', @p330=NULL, @p331=NULL, @p332=NULL (DbType = DateTime), @p333='867c9c9b-f85e-4572-9bbd-4447b44597b7', @p334=NULL, @p335='2025-07-03T11:23:09.9738478Z' (DbType = DateTime), @p336='system', @p337=NULL (DbType = DateTime), @p338=NULL, @p339=NULL, @p340=NULL, @p341=NULL, @p342='False', @p343=NULL (DbType = DateTime), @p344=NULL, @p345=NULL, @p346='Hello,
We’re excited to announce that we’re launching some amazing new products at [Your Company Name]! 🚀

Be the first to check them out and grab special launch offers!
If you’re interested, reply to this message or click here:' (Nullable = false), @p347=NULL, @p348='557a610b-a108-4b66-9843-b906c31d452e' (Nullable = true), @p349=NULL (DbType = DateTime), @p350='d11e6bc5-4d47-47a4-acf2-49857b6c4f1d', @p351='0', @p352='Failed', @p353='2025-07-03T11:23:09.9738478Z' (Nullable = true) (DbType = DateTime), @p354=NULL, @p355='imagecampaign', @p356=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64, @p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p76, @p77, @p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90, @p91, @p92, @p93, @p94);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p95, @p96, @p97, @p98, @p99, @p100, @p101, @p102, @p103, @p104, @p105, @p106, @p107, @p108, @p109, @p110, @p111, @p112, @p113);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p114, @p115, @p116, @p117, @p118, @p119, @p120, @p121, @p122, @p123, @p124, @p125, @p126, @p127, @p128, @p129, @p130, @p131, @p132);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p133, @p134, @p135, @p136, @p137, @p138, @p139, @p140, @p141, @p142, @p143, @p144, @p145, @p146, @p147, @p148, @p149, @p150, @p151, @p152, @p153, @p154, @p155, @p156, @p157, @p158, @p159, @p160, @p161, @p162, @p163, @p164);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p165, @p166, @p167, @p168, @p169, @p170, @p171, @p172, @p173, @p174, @p175, @p176, @p177, @p178, @p179, @p180, @p181, @p182, @p183, @p184, @p185, @p186, @p187, @p188, @p189, @p190, @p191, @p192, @p193, @p194, @p195, @p196);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p197, @p198, @p199, @p200, @p201, @p202, @p203, @p204, @p205, @p206, @p207, @p208, @p209, @p210, @p211, @p212, @p213, @p214, @p215, @p216, @p217, @p218, @p219, @p220, @p221, @p222, @p223, @p224, @p225, @p226, @p227, @p228);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p229, @p230, @p231, @p232, @p233, @p234, @p235, @p236, @p237, @p238, @p239, @p240, @p241, @p242, @p243, @p244, @p245, @p246, @p247, @p248, @p249, @p250, @p251, @p252, @p253, @p254, @p255, @p256, @p257, @p258, @p259, @p260);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p261, @p262, @p263, @p264, @p265, @p266, @p267, @p268, @p269, @p270, @p271, @p272, @p273, @p274, @p275, @p276, @p277, @p278, @p279, @p280, @p281, @p282, @p283, @p284, @p285, @p286, @p287, @p288, @p289, @p290, @p291, @p292);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p293, @p294, @p295, @p296, @p297, @p298, @p299, @p300, @p301, @p302, @p303, @p304, @p305, @p306, @p307, @p308, @p309, @p310, @p311, @p312, @p313, @p314, @p315, @p316, @p317, @p318, @p319, @p320, @p321, @p322, @p323, @p324);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p325, @p326, @p327, @p328, @p329, @p330, @p331, @p332, @p333, @p334, @p335, @p336, @p337, @p338, @p339, @p340, @p341, @p342, @p343, @p344, @p345, @p346, @p347, @p348, @p349, @p350, @p351, @p352, @p353, @p354, @p355, @p356);
2025-07-03 16:53:11.059 +05:30 [INF] ✅ All saved successfully.
2025-07-03 16:53:11.060 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 16:53:11.061 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 13758.7351ms
2025-07-03 16:53:11.062 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-03 16:53:11.063 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/1ed614e8-8b66-4049-93d2-1a23085585be - 200 null application/json; charset=utf-8 13769.9665ms
2025-07-03 16:53:42.448 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 16:53:42.452 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 3.8855ms
2025-07-03 16:53:42.641 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 16:53:42.700 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 58.6685ms
2025-07-03 18:02:32.616 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 18:02:32.622 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 18:02:32.628 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:32.630 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:32.631 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:32.631 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:32.634 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
2025-07-03 18:02:32.635 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
2025-07-03 18:02:32.636 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 18:02:32.637 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:02:32.638 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 18:02:32.638 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 18:02:32.662 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 22.5927ms
2025-07-03 18:02:32.665 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 18:02:32.682 +05:30 [ERR] ❌ An unhandled exception occurred
System.UnauthorizedAccessException: Invalid or missing businessId in token.
   at xbytechat.api.Shared.ClaimsBusinessDetails.GetBusinessId(ClaimsPrincipal user) in D:\xbytechat\xbytechat-api\xbytechat-api\Shared\ClaimsBusinessDetails.cs:line 12
   at xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts(String tab, Int32 page, Int32 pageSize) in D:\xbytechat\xbytechat-api\xbytechat-api\CRM\Controllers\ContactsController.cs:line 135
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:02:32.687 +05:30 [ERR] Response has already started, unable to write error response for path: /api/contacts
2025-07-03 18:02:32.688 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 401 null application/json 71.7045ms
2025-07-03 18:02:32.690 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 18:02:32.692 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:32.692 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.0893ms
2025-07-03 18:02:32.693 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 18:02:32.696 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:32.697 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:32.698 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:32 PM'.
2025-07-03 18:02:32.699 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 5.7128ms
2025-07-03 18:02:32.701 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 18:02:32.714 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 18:02:32.716 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:02:32.717 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:02:32.771 +05:30 [ERR] ❌ Exception while fetching templates for BusinessId "c13be597-6ae2-42bb-9d43-925815f24ff8"
System.Net.Http.HttpRequestException: No such host is known. (graph.facebook.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at xbytechat_api.WhatsAppSettings.Services.WhatsAppTemplateFetcherService.FetchAllTemplatesAsync() in D:\xbytechat\xbytechat-api\xbytechat-api\WhatsAppSettings\Services\WhatsAppTemplateFetcherService.cs:line 264
2025-07-03 18:02:32.783 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:32.785 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 132.9124ms
2025-07-03 18:02:32.786 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:02:32.831 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Mvc.ObjectResult.OnFormatting(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:02:32.836 +05:30 [ERR] Response has already started, unable to write error response for path: /api/WhatsAppTemplateFetcher/get-template-all
2025-07-03 18:02:32.836 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 401 null application/json 214.4759ms
2025-07-03 18:02:33.234 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:02:33.237 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:33 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:33.238 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:33 PM'.
2025-07-03 18:02:33.239 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 18:02:33.256 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:02:33.259 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 18:02:33.259 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 25.1481ms
2025-07-03 18:02:41.550 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 18:02:41.552 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:41.553 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 2.9661ms
2025-07-03 18:02:41.555 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:02:41.558 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:41.559 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:41 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:41.561 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:41 PM'.
2025-07-03 18:02:41.562 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:41.562 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:02:41.564 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:02:41.567 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:02:41.570 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:02:41.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:02:41.576 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:02:41.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:02:41.580 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:02:41.612 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 48.8354ms
2025-07-03 18:02:41.613 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:41.645 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:02:41.650 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 18:02:41.651 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 96.7379ms
2025-07-03 18:02:41.654 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 18:02:41.656 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:41.657 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.5517ms
2025-07-03 18:02:41.658 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 18:02:41.661 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:41.662 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:41 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:41.663 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:41 PM'.
2025-07-03 18:02:41.664 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.4259ms
2025-07-03 18:02:41.666 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 18:02:42.107 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:02:42.109 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:42 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 18:02:42.110 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 12:11:13 PM', Current time (UTC): '03-07-2025 12:32:42 PM'.
2025-07-03 18:02:42.111 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 18:02:42.125 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:02:42.128 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 18:02:42.129 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 22.4176ms
2025-07-03 18:02:54.969 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 18:02:54.971 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:54.972 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.2096ms
2025-07-03 18:02:54.973 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:02:54.977 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:54.978 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:54.979 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:02:54.980 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:02:54.982 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:02:54.985 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:02:54.988 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:02:54.990 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:02:54.992 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:02:54.994 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:02:54.995 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:02:54.996 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:54.997 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 17.1523ms
2025-07-03 18:02:54.998 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:54.999 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 25.3582ms
2025-07-03 18:02:55.005 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:02:55.007 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:02:55.008 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:02:55.010 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:55.011 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.5714ms
2025-07-03 18:02:55.012 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:02:55.013 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.7434ms
2025-07-03 18:02:55.320 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:02:55.323 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:02:55.323 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:02:55.326 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:02:55.329 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:02:55.331 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:02:55.333 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:02:55.334 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:02:55.334 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:02:55.335 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:02:55.335 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:02:55.336 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:02:55.336 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:02:55.337 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:02:55.338 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:02:55.338 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:02:55.339 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:02:55.339 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:02:55.340 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:02:55.341 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 16.3885ms
2025-07-03 18:02:55.342 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:02:55.343 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 22.7063ms
2025-07-03 18:02:58.602 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:02:58.604 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:58.605 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:58.606 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:02:58.609 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:02:58.611 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:02:58.614 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:02:58.617 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:02:58.619 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:02:58.622 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:02:58.623 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:02:58.624 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:02:58.625 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:58.627 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 18.7738ms
2025-07-03 18:02:58.627 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:02:58.628 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 26.2772ms
2025-07-03 18:02:58.634 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:02:58.636 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:02:58.637 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:02:58.639 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:58.640 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6859ms
2025-07-03 18:02:58.641 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:02:58.642 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.7021ms
2025-07-03 18:02:58.954 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:02:58.957 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:02:58.958 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:02:58.961 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:02:58.963 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:02:58.965 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:02:58.967 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:02:58.968 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:02:58.968 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:02:58.969 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:02:58.969 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:02:58.970 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:02:58.971 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:02:58.971 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:02:58.972 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:02:58.972 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:02:58.973 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:02:58.973 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:02:58.974 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:02:58.975 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 16.069ms
2025-07-03 18:02:58.976 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:02:58.977 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 22.4026ms
2025-07-03 18:02:59.223 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-03 18:02:59.224 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 18:02:59.225 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:59.227 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:02:59.228 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 18:02:59.229 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:02:59.229 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 18:02:59.230 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 18:02:59.231 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-03 18:02:59.234 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 18:02:59.239 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:02:59.240 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:02:59.267 +05:30 [ERR] ❌ Exception while fetching templates for BusinessId "c13be597-6ae2-42bb-9d43-925815f24ff8"
System.Net.Http.HttpRequestException: No such host is known. (graph.facebook.com:443)
 ---> System.Net.Sockets.SocketException (11001): No such host is known.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.HttpConnectionWaiter`1.WaitForConnectionWithTelemetryAsync(HttpRequestMessage request, HttpConnectionPool pool, Boolean async, CancellationToken requestCancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at xbytechat_api.WhatsAppSettings.Services.WhatsAppTemplateFetcherService.FetchAllTemplatesAsync() in D:\xbytechat\xbytechat-api\xbytechat-api\WhatsAppSettings\Services\WhatsAppTemplateFetcherService.cs:line 264
2025-07-03 18:02:59.272 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:02:59.274 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 41.5792ms
2025-07-03 18:02:59.275 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:02:59.276 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 51.896ms
2025-07-03 18:02:59.294 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-03 18:02:59.298 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-03 18:02:59.300 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 18:02:59.301 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 69.5264ms
2025-07-03 18:02:59.301 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-03 18:02:59.302 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 79.69ms
2025-07-03 18:04:20.250 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-03 18:04:20.255 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:20.256 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 18:04:20.257 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 18:04:20.268 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-03 18:04:20.278 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-03 18:04:20.279 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 20.5433ms
2025-07-03 18:04:20.280 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 18:04:20.281 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 32.5755ms
2025-07-03 18:04:24.344 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-03 18:04:24.346 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:24.347 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 2.8858ms
2025-07-03 18:04:24.348 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 470
2025-07-03 18:04:24.351 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:24.352 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 18:04:24.353 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 18:04:24.355 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-03 18:04:24.355 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-03 18:04:24.358 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-03 18:04:24.365 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BOZC6AM1BLJqFHi2HXPrSTUCd4XeePtttlyvkaVEyB5k6k25hORTy9znxlE16eYHbE8fxOetljG3uLbN6EZBp2HRq0sCGVU3s1iMq1Ju3IsZB0ZBZCXO6PTK2f92GDQ3FIeh9sZAhMve6YzOO6pmqIMXp8KwigZAmq0knzisweLo3MZBoRt88MyPWu9s47I8slEE3u9UhFuo1bhVgIxoB4IFtIwY6UgzpMWQBPSqJbsocf9YC3BESSDYZD' (Nullable = false), @p1='2025-07-03T12:34:24.3607730Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 18:04:24.367 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-03 18:04:24.367 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:04:24.368 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 13.8325ms
2025-07-03 18:04:24.369 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 18:04:24.370 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 22.0318ms
2025-07-03 18:04:25.058 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-03 18:04:25.060 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:25.060 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 2.7477ms
2025-07-03 18:04:25.062 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 470
2025-07-03 18:04:25.064 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:25.065 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 18:04:25.066 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 18:04:26.187 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:04:26.189 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1121.657ms
2025-07-03 18:04:26.190 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 18:04:26.191 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1129.1902ms
2025-07-03 18:04:38.292 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 18:04:38.295 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:38.296 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:38.297 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 18:04:38.300 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 18:04:38.304 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:38.305 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:39.226 +05:30 [INF] Received HTTP response headers after 919.9387ms - 200
2025-07-03 18:04:39.227 +05:30 [INF] End processing HTTP request after 923.4359ms - 200
2025-07-03 18:04:39.228 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEvVoVK&_nc_oc=AdmKkHZAa4J6k40YOZPfMu6EhRhm5Rjk5e6yQg0oOokE8cR3LtFWF59RDe3Su6fYUDH08y2IsUhKJ_rJXzUJ6L8z&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=AI82WtuJnq44RbKBHaNHeQ&oh=01_Q5Aa1wE_qgylm5EQ7pKh-vtRegaXW6UorLe0jGUVT8Pq_1nahg&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwEiBIP6&_nc_oc=AdlXiO-AnfJXR2RLewOAKauBbuw6-4ctDcMHuKsv2pI2yYpW6ihQ74815UrmHV8r-CMC_pL3WGhhgCfh6NlNrymI&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=AI82WtuJnq44RbKBHaNHeQ&oh=01_Q5Aa1wFbnjYG5shCabmwtwdhXov6ubpfHr0F9urQjHtWm4pT-A&oe=688DF6D7"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 18:04:39.230 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:04:39.231 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 932.7723ms
2025-07-03 18:04:39.232 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:39.233 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 940.9494ms
2025-07-03 18:04:43.784 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 18:04:43.787 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:43.788 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:43.790 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 18:04:43.794 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 18:04:43.797 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:43.798 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:44.690 +05:30 [INF] Received HTTP response headers after 890.6439ms - 200
2025-07-03 18:04:44.691 +05:30 [INF] End processing HTTP request after 894.0183ms - 200
2025-07-03 18:04:44.700 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEvVoVK&_nc_oc=AdmKkHZAa4J6k40YOZPfMu6EhRhm5Rjk5e6yQg0oOokE8cR3LtFWF59RDe3Su6fYUDH08y2IsUhKJ_rJXzUJ6L8z&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=5TYFt1mkTEojDnNLdtr9gQ&oh=01_Q5Aa1wHJzfOAGtUhN2ysWEfLD1zhr-diKpvD-DxXUW2kXuR8lw&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwEiBIP6&_nc_oc=AdlXiO-AnfJXR2RLewOAKauBbuw6-4ctDcMHuKsv2pI2yYpW6ihQ74815UrmHV8r-CMC_pL3WGhhgCfh6NlNrymI&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=5TYFt1mkTEojDnNLdtr9gQ&oh=01_Q5Aa1wHnPbGA4Ss2r3JicXb2sQhZpJl56Zq3veiwL49xfQyoGA&oe=688DF6D7"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 18:04:44.702 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:04:44.704 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 912.2591ms
2025-07-03 18:04:44.705 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:44.706 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 921.3793ms
2025-07-03 18:04:47.081 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-03 18:04:47.083 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:04:47.084 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:47.086 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-03 18:04:47.090 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-03 18:04:47.092 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:47.094 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-03 18:04:47.851 +05:30 [INF] Received HTTP response headers after 756.0679ms - 200
2025-07-03 18:04:47.852 +05:30 [INF] End processing HTTP request after 760.0448ms - 200
2025-07-03 18:04:47.867 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=UW_i0L8_Rd4Q7kNvwEvVoVK&_nc_oc=AdmKkHZAa4J6k40YOZPfMu6EhRhm5Rjk5e6yQg0oOokE8cR3LtFWF59RDe3Su6fYUDH08y2IsUhKJ_rJXzUJ6L8z&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=HpoHJxDuXUVN3aMSVUiRRA&oh=01_Q5Aa1wFZ5SJO6SjBqBOgrFAhY4lPkXEBfzHY0sfarz5atZa4Gg&oe=688DDC23"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=FCC_-iZgWW0Q7kNvwEiBIP6&_nc_oc=AdlXiO-AnfJXR2RLewOAKauBbuw6-4ctDcMHuKsv2pI2yYpW6ihQ74815UrmHV8r-CMC_pL3WGhhgCfh6NlNrymI&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=HpoHJxDuXUVN3aMSVUiRRA&oh=01_Q5Aa1wFi4gJNuYybfiHxKntb50BNN9qD-U7xnKwoyxvBe7m0bA&oe=688DF6D7"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-03 18:04:47.870 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:04:47.871 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 783.2011ms
2025-07-03 18:04:47.872 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-03 18:04:47.873 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 791.8777ms
2025-07-03 18:05:01.255 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-03 18:05:01.258 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:05:01.259 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 18:05:01.260 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-03 18:05:01.267 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-03 18:05:01.269 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:05:01.271 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 8.4927ms
2025-07-03 18:05:01.272 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-03 18:05:01.273 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 17.5513ms
2025-07-03 18:20:14.965 +05:30 [INF] Request starting HTTP/1.1 GET http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=841656874&hub.verify_token=xbytechat-secret-token - null null
2025-07-03 18:20:14.971 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-03 18:20:14.975 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:20:14.979 +05:30 [INF] ✅ WhatsApp webhook verified successfully.
2025-07-03 18:20:14.980 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.String'.
2025-07-03 18:20:14.981 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 4.3412ms
2025-07-03 18:20:14.982 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-03 18:20:14.983 +05:30 [INF] Request finished HTTP/1.1 GET http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=841656874&hub.verify_token=xbytechat-secret-token - 200 null text/plain; charset=utf-8 18.2881ms
2025-07-03 18:22:16.484 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 18:22:16.490 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:16.491 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 6.843ms
2025-07-03 18:22:16.493 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:22:16.499 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:16.500 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:16.501 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:16.503 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:22:16.562 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:22:16.566 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:22:16.568 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:22:16.571 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:22:16.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:22:16.575 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:22:16.576 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:22:16.578 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:16.579 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 76.519ms
2025-07-03 18:22:16.580 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:16.581 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 87.6264ms
2025-07-03 18:22:16.902 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:22:16.905 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:16.906 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:16.908 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:16.909 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6638ms
2025-07-03 18:22:16.910 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:16.911 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.0242ms
2025-07-03 18:22:17.161 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:22:17.164 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:17.165 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:22:17.169 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:22:17.173 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:22:17.175 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:22:17.176 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:22:17.177 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:22:17.178 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:22:17.178 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:22:17.179 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:22:17.179 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:22:17.180 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:22:17.180 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:22:17.181 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:22:17.181 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:22:17.182 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:22:17.182 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:22:17.183 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:22:17.184 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.5353ms
2025-07-03 18:22:17.186 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:17.186 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.0226ms
2025-07-03 18:22:24.680 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 18:22:24.682 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:24.683 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.1397ms
2025-07-03 18:22:24.684 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:22:24.688 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:24.689 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:24.690 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:24.692 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:22:24.694 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:22:24.697 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:22:24.700 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:22:24.703 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:22:24.706 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:22:24.708 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:22:24.708 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:22:24.709 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:24.710 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 19.295ms
2025-07-03 18:22:24.711 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:24.712 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 28.4269ms
2025-07-03 18:22:24.717 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:22:24.721 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:24.722 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:24.723 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:24.725 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.4398ms
2025-07-03 18:22:24.726 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:24.726 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.0372ms
2025-07-03 18:22:25.038 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:22:25.041 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:25.042 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:22:25.045 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:22:25.048 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:22:25.050 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:22:25.052 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:22:25.053 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:22:25.054 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:22:25.055 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:22:25.055 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:22:25.056 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:22:25.057 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:22:25.058 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:22:25.058 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:22:25.059 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:22:25.059 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:22:25.060 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:22:25.061 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:22:25.063 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 19.4143ms
2025-07-03 18:22:25.064 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:25.064 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 26.3507ms
2025-07-03 18:22:28.419 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:22:28.421 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:28.422 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:28.423 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:28.425 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:22:28.427 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:22:28.431 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:22:28.434 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:22:28.438 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:22:28.441 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:22:28.443 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:22:28.443 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:22:28.455 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:28.456 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 31.6085ms
2025-07-03 18:22:28.457 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:28.458 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 39.8246ms
2025-07-03 18:22:28.465 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:22:28.468 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:28.469 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:28.471 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:28.472 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.0348ms
2025-07-03 18:22:28.473 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:28.474 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.2707ms
2025-07-03 18:22:28.786 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:22:28.789 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:28.790 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:22:28.793 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:22:28.796 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:22:28.798 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:22:28.801 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:22:28.802 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:22:28.802 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:22:28.803 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:22:28.803 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:22:28.804 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:22:28.804 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:22:28.805 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:22:28.805 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:22:28.806 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:22:28.807 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:22:28.807 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:22:28.808 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:22:28.809 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.1045ms
2025-07-03 18:22:28.810 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:28.811 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.0667ms
2025-07-03 18:22:31.749 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 18:22:31.751 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:31.752 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.3846ms
2025-07-03 18:22:31.754 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:22:31.757 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:31.758 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:31.759 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:31.761 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:22:31.763 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:22:31.767 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:22:31.770 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:22:31.773 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:22:31.776 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:22:31.778 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:22:31.779 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:22:31.780 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:31.799 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 38.6613ms
2025-07-03 18:22:31.801 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:31.802 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 48.0085ms
2025-07-03 18:22:31.807 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:22:31.809 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:31.809 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:31.811 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:31.812 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3425ms
2025-07-03 18:22:31.814 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:31.815 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.8757ms
2025-07-03 18:22:32.127 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:22:32.130 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:32.131 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:22:32.134 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:22:32.137 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:22:32.138 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:22:32.140 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:22:32.140 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:22:32.141 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:22:32.141 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:22:32.142 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:22:32.143 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:22:32.143 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:22:32.144 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:22:32.144 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:22:32.145 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:22:32.146 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:22:32.146 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:22:32.148 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:22:32.149 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 16.6562ms
2025-07-03 18:22:32.150 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:32.151 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 23.8725ms
2025-07-03 18:22:35.297 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 18:22:35.299 +05:30 [INF] CORS policy execution successful.
2025-07-03 18:22:35.300 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:35.301 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:35.303 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 18:22:35.305 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 18:22:35.309 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 18:22:35.313 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 18:22:35.315 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 18:22:35.318 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 18:22:35.320 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 18:22:35.320 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 18:22:35.322 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:35.323 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 19.712ms
2025-07-03 18:22:35.324 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 18:22:35.325 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 28.5021ms
2025-07-03 18:22:35.330 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 18:22:35.333 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:35.334 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 18:22:35.336 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:22:35.337 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.3778ms
2025-07-03 18:22:35.338 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 18:22:35.338 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 7.8997ms
2025-07-03 18:22:35.647 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 18:22:35.650 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:35.651 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 18:22:35.654 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 18:22:35.658 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 18:22:35.660 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 18:22:35.662 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 18:22:35.663 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 18:22:35.664 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 18:22:35.664 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 18:22:35.665 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 18:22:35.665 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 18:22:35.666 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 18:22:35.666 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 18:22:35.667 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 18:22:35.667 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 18:22:35.668 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 18:22:35.669 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 18:22:35.670 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 18:22:35.671 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 17.9642ms
2025-07-03 18:22:35.672 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 18:22:35.672 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 24.9287ms
2025-07-03 18:23:10.666 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:23:10.668 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:23:10.669 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:23:10.671 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQzEwNkFCRjFDQ0QzQUM1NDMxMEQ4REY3RTI5NTYxNEMA","timestamp":"1751547193","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:23:10.672 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 18:23:10.672 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQzEwNkFCRjFDQ0QzQUM1NDMxMEQ4REY3RTI5NTYxNEMA","timestamp":"1751547193","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:23:10.673 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:23:10.674 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 18:23:10.675 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4511ms
2025-07-03 18:28:53.856 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:28:54.900 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 344233.6852ms
2025-07-03 18:28:57.140 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:28:58.243 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:28:59.127 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:01.174 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:01.174 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:01.751 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:03.672 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:01.180 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:05.021 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:28:58.242 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:28:59.112 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:05.029 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.032 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:28:59.127 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:05.043 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:05.043 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:05.045 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 25.7638ms
2025-07-03 18:29:05.045 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 19.7849ms
2025-07-03 18:29:05.045 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 22.3284ms
2025-07-03 18:29:05.050 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.051 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.052 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.048 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 1.5476ms
2025-07-03 18:29:05.050 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 1.223ms
2025-07-03 18:29:05.046 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.089 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:00.330 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:05.089 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.090 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:05.064 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:05.077 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:05.088 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:05.102 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:05.127 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 6885.6105ms
2025-07-03 18:29:05.127 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 3953.1117ms
2025-07-03 18:29:05.128 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 7988.3583ms
2025-07-03 18:29:05.131 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 6889.4067ms
2025-07-03 18:29:05.114 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:05.116 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 1.7724ms
2025-07-03 18:29:05.103 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:01.179 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:02.620 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:29:05.032 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 18:29:05.143 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 6031.9298ms
2025-07-03 18:29:05.143 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.144 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:05.145 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:05.147 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:12.909 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:12.910 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:29:15.862 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 18:29:15.876 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 18:29:15.874 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:15.877 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 2969.1651ms
2025-07-03 18:29:15.877 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 2965.8042ms
2025-07-03 18:29:15.906 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 18:29:15.912 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 16785.3406ms
2025-07-03 18:29:15.912 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:15.913 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:15.877 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 2964.7351ms
2025-07-03 18:29:21.580 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:29:21.583 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 18:29:21.580 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:21.607 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:47.633 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 47303.0672ms
2025-07-03 18:29:21.618 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:29:49.752 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 48573.5461ms
2025-07-03 18:29:49.766 +05:30 [INF] Executed DbCommand (13ms) [Parameters=[@p0='921d6f90-15d4-4990-972b-2c285deb7f6f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T12:59:47.6189684Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T12:59:47.6262324Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:29:49.770 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 47149.4623ms
2025-07-03 18:30:00.772 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 18:30:07.371 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:30:08.540 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:30:18.239 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 18:31:02.084 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='89c79ae6-e9d6-447d-a61b-1ec4a5c6ba9c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T13:00:22.0914921Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:31:07.678 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:31:09.104 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:31:09.715 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 18:31:35.428 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:31:35.430 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:31:35.431 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:31:35.433 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRkJDOUU4ODkzRUE0QjM2OTVFNDAyODlDOUNGN0YwQ0YA","timestamp":"1751547698","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:31:35.434 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 18:31:35.434 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRkJDOUU4ODkzRUE0QjM2OTVFNDAyODlDOUNGN0YwQ0YA","timestamp":"1751547698","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:31:35.434 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:31:35.435 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 18:31:35.436 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.8453ms
2025-07-03 18:31:39.567 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:31:39.568 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 18:31:39.569 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 4141.165ms
2025-07-03 18:31:39.571 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 18:31:39.575 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 18:31:39.577 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 18:31:39.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 18:31:39.583 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='c60a7af0-5727-426c-baa3-ab84e4b9d5a1', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T13:01:39.5810596Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T13:01:39.5810596Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:31:39.586 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 18:31:40.445 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:31:40.447 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:31:40.449 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 18:31:41.236 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='eb627098-2dbc-4b02-9ac8-7ed461c7b1af', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T13:01:41.2350857Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:31:41.238 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:31:41.239 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:31:41.240 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 18:32:18.621 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:32:18.624 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:32:18.625 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:32:18.627 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkNCMEIyQzYzNDI5RDgyNzhFMEZFMDM2NEI4OTQzOEYA","timestamp":"1751547193","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:32:18.629 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 18:32:18.629 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkNCMEIyQzYzNDI5RDgyNzhFMEZFMDM2NEI4OTQzOEYA","timestamp":"1751547193","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 18:32:18.630 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 18:32:18.631 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 18:32:18.632 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.6995ms
2025-07-03 18:32:23.153 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:32:23.153 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 18:32:23.154 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 4532.9638ms
2025-07-03 18:32:23.156 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 18:32:23.160 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 18:32:23.162 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 18:32:23.163 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 18:32:23.167 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='a8915cfb-2ed7-4135-9b3f-4ffac7559596', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T13:02:23.1654122Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T13:02:23.1654122Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:32:23.170 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 18:33:26.591 +05:30 [INF] Executed DbCommand (30ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:33:26.592 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 18:33:26.601 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 18:33:26.602 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:33:26.603 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 18:33:26.604 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 18:33:28.108 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='eb0b197a-77f5-4f82-bc3a-21cd9641566d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T13:03:28.1059609Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 18:33:28.109 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 2.6639ms
2025-07-03 18:33:28.110 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:33:28.111 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 18:33:28.112 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 18:33:28.124 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 18:33:28.124 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 18:33:28.131 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 1538.807ms
2025-07-03 21:48:20.946 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-03 21:48:20.990 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-03 21:48:21.005 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-03 21:48:21.901 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-03 21:48:22.535 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-03 21:48:22.726 +05:30 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-03 21:48:22.754 +05:30 [INF] Executed DbCommand (68ms) [Parameters=[@__cutoff_0='2025-06-26T16:18:21.1410456Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-03 21:48:22.822 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-03 21:48:22.823 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-03 21:48:22.824 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-03 21:48:22.825 +05:30 [INF] Hosting environment: Development
2025-07-03 21:48:22.825 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-03 21:48:23.223 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 21:48:23.288 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-03 21:48:23.342 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:48:23.359 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 21:48:23.383 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUQ3MjFCNzA0MUExNDgxNTBDQkRGQkNENTk1MEM5MjEA","timestamp":"1751559468","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:48:23.386 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 21:48:23.391 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:48:23.410 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 46.1469ms
2025-07-03 21:48:23.414 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:48:23.424 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 207.2699ms
2025-07-03 21:48:23.522 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUQ3MjFCNzA0MUExNDgxNTBDQkRGQkNENTk1MEM5MjEA","timestamp":"1751559468","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:48:23.523 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 21:48:28.769 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-03 21:48:28.875 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 21:48:28.882 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 112.8046ms
2025-07-03 21:48:28.970 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-03 21:48:28.971 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-03 21:48:28.977 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.0671ms
2025-07-03 21:48:29.011 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.7777ms
2025-07-03 21:48:29.019 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 21:48:29.032 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 21:48:29.069 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 21:48:29.077 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 21:48:29.167 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-03 21:48:29.293 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='eb25841c-00c1-449b-9ef5-cb1fd2562554', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:18:29.0803095Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:18:29.0803650Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:48:29.316 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 21:48:29.336 +05:30 [INF] 🔍 No flow match found or FlowId is null. Trying fallback auto-reply...
2025-07-03 21:48:29.353 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__incomingMessage_1='pizza'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive" AND strpos(@__incomingMessage_1, a."TriggerKeyword") > 0
ORDER BY a."Priority"
LIMIT 1
2025-07-03 21:48:29.355 +05:30 [INF] ❌ No fallback rule matched for: pizza
2025-07-03 21:48:30.403 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='d34311e6-9c2c-4ffd-bfea-116b0bc6981c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:18:30.3827503Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:48:30.412 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 1245.0471ms
2025-07-03 21:48:44.821 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 21:48:44.829 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:48:44.830 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 21:48:44.834 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQUJCREE3N0Y3MjIwNDk4NzIwODJENzVBMDBGOEZBM0IA","timestamp":"1751559528","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:48:44.835 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 21:48:44.836 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:48:44.837 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQUJCREE3N0Y3MjIwNDk4NzIwODJENzVBMDBGOEZBM0IA","timestamp":"1751559528","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:48:44.838 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.7647ms
2025-07-03 21:48:44.838 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 21:48:44.840 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:48:51.460 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 6636.3784ms
2025-07-03 21:49:10.886 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 21:49:28.274 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 21:49:28.278 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 21:49:28.281 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 21:49:32.469 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 21:49:40.219 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='79c3d745-ccfb-4329-bc4a-b5dfd5ac1c67', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:19:35.5401712Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:19:35.5445735Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:50:01.062 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 21:50:53.485 +05:30 [INF] 🔍 No flow match found or FlowId is null. Trying fallback auto-reply...
2025-07-03 21:51:11.987 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__incomingMessage_1='pizza'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive" AND strpos(@__incomingMessage_1, a."TriggerKeyword") > 0
ORDER BY a."Priority"
LIMIT 1
2025-07-03 21:51:42.836 +05:30 [INF] ❌ No fallback rule matched for: pizza
2025-07-03 21:52:09.438 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='657de8c6-34b9-4a26-b396-1b2d48c13176', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:22:09.4171622Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:57:16.222 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 21:57:16.230 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:57:16.231 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 21:57:16.234 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQ0Q3MUMwQ0JFM0ZGQzc3NkUwRjZFRjRENEJFREI3OUMA","timestamp":"1751560039","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:57:16.235 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 21:57:16.236 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:57:16.237 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6073ms
2025-07-03 21:57:16.241 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 21:57:16.257 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 35.7468ms
2025-07-03 21:57:16.264 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQ0Q3MUMwQ0JFM0ZGQzc3NkUwRjZFRjRENEJFREI3OUMA","timestamp":"1751560039","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 21:57:16.265 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 21:57:27.508 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 21:57:31.026 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 21:57:31.029 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 21:57:31.042 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 21:57:32.592 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 21:57:35.973 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='3ed9016b-db68-40fa-b636-2811f9050975', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:27:34.0662259Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:27:34.0735005Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:57:39.454 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 21:57:50.896 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 21:57:52.444 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 21:58:01.596 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 21:58:07.319 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='0e4f83f9-d5a1-4e9f-947e-2e794cd64b74', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:28:06.2215168Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 21:58:12.104 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 21:58:13.474 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 21:58:13.921 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 21:58:38.453 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 21:58:38.457 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 21:58:38.462 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 21:58:38.457 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 21:58:38.476 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.474 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.473 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.482 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.486 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 32.7457ms
2025-07-03 21:58:38.486 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 30.1095ms
2025-07-03 21:58:38.489 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 21:58:38.489 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 21:58:38.498 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.500 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:38.561 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:38.561 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:38.561 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:38.561 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:38.599 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
2025-07-03 21:58:38.600 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
2025-07-03 21:58:38.602 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
2025-07-03 21:58:38.603 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:38 PM'.
2025-07-03 21:58:38.605 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 21:58:38.607 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 21:58:38.612 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 21:58:38.612 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 21:58:38.613 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 21:58:38.613 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 21:58:40.302 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 1686.6464ms
2025-07-03 21:58:40.302 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 1684.9085ms
2025-07-03 21:58:40.305 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 21:58:40.305 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 21:58:40.301 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:40.301 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:40.330 +05:30 [ERR] ❌ An unhandled exception occurred
System.UnauthorizedAccessException: Invalid or missing businessId in token.
   at xbytechat.api.Shared.ClaimsBusinessDetails.GetBusinessId(ClaimsPrincipal user) in D:\xbytechat\xbytechat-api\xbytechat-api\Shared\ClaimsBusinessDetails.cs:line 12
   at xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat() in D:\xbytechat\xbytechat-api\xbytechat-api\CRM\Controllers\ContactsController.cs:line 143
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:40.318 +05:30 [ERR] ❌ An unhandled exception occurred
System.UnauthorizedAccessException: Invalid or missing userId in token.
   at xbytechat.api.Shared.ClaimsBusinessDetails.GetUserId(ClaimsPrincipal user) in D:\xbytechat\xbytechat-api\xbytechat-api\Shared\ClaimsBusinessDetails.cs:line 20
   at xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts() in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Inbox\Controllers\InboxController.cs:line 100
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:40.338 +05:30 [ERR] Response has already started, unable to write error response for path: /hubs/inbox/negotiate
2025-07-03 21:58:40.341 +05:30 [ERR] Response has already started, unable to write error response for path: /hubs/inbox/negotiate
2025-07-03 21:58:40.344 +05:30 [ERR] Response has already started, unable to write error response for path: /api/contacts/all
2025-07-03 21:58:40.348 +05:30 [ERR] Response has already started, unable to write error response for path: /api/inbox/unread-counts
2025-07-03 21:58:40.348 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 401 null application/json 1859.349ms
2025-07-03 21:58:40.349 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 401 null application/json 1860.4546ms
2025-07-03 21:58:40.351 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 401 null application/json 1889.6798ms
2025-07-03 21:58:40.350 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 401 null application/json 1894.2968ms
2025-07-03 21:58:40.359 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 21:58:40.366 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:40.367 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 8.8463ms
2025-07-03 21:58:40.371 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 21:58:40.375 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:40.377 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:40 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:40.379 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:40 PM'.
2025-07-03 21:58:40.380 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 9.0002ms
2025-07-03 21:58:40.384 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 21:58:41.362 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:58:41.366 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:41 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:41.370 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:41 PM'.
2025-07-03 21:58:41.374 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 21:58:41.400 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:41.404 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 21:58:41.406 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 43.9662ms
2025-07-03 21:58:47.017 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 21:58:47.019 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:47.020 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.7651ms
2025-07-03 21:58:47.022 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 21:58:47.027 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:47.028 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:47.030 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
2025-07-03 21:58:47.031 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:58:47.034 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:58:47.049 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 21:58:47.065 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 21:58:47.102 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 21:58:47.129 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 21:58:47.144 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 21:58:47.211 +05:30 [INF] Executed DbCommand (41ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 21:58:47.228 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 21:58:47.285 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 249.4706ms
2025-07-03 21:58:47.287 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:58:47.329 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:47.334 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 21:58:47.338 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 315.2029ms
2025-07-03 21:58:47.338 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 21:58:47.342 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:47.342 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 4.4099ms
2025-07-03 21:58:47.343 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 21:58:47.346 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:47.348 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:47.349 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
2025-07-03 21:58:47.350 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 7.0697ms
2025-07-03 21:58:47.353 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 21:58:47.532 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:58:47.536 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:47.539 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:47 PM'.
2025-07-03 21:58:47.540 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 21:58:47.558 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:47.564 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 21:58:47.565 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 32.8817ms
2025-07-03 21:58:57.712 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 21:58:57.715 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:57.716 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.6865ms
2025-07-03 21:58:57.718 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 21:58:57.722 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:57.723 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:57 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:57.726 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:57 PM'.
2025-07-03 21:58:57.727 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:58:57.728 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:58:57.731 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 21:58:57.734 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 21:58:57.740 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 21:58:57.745 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 21:58:57.749 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 21:58:57.752 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 21:58:57.755 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 21:58:57.792 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 62.5173ms
2025-07-03 21:58:57.793 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:58:57.824 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:57.828 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-03 21:58:57.829 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 111.3269ms
2025-07-03 21:58:57.831 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-03 21:58:57.833 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:57.834 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.5165ms
2025-07-03 21:58:57.835 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-03 21:58:57.838 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:58:57.839 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:57 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:57.841 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:57 PM'.
2025-07-03 21:58:57.842 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.6424ms
2025-07-03 21:58:57.845 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-03 21:58:58.508 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:58:58.512 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:58 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-03 21:58:58.515 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '03-07-2025 01:52:35 PM', Current time (UTC): '03-07-2025 04:28:58 PM'.
2025-07-03 21:58:58.516 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-03 21:58:58.542 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-03 21:58:58.546 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-03 21:58:58.548 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 39.4721ms
2025-07-03 21:59:10.464 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 21:59:10.467 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:10.468 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.8518ms
2025-07-03 21:59:10.470 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 21:59:10.473 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:10.473 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:10.474 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:10.482 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 21:59:10.484 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 21:59:10.488 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 21:59:10.490 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 21:59:10.494 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 21:59:10.497 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 21:59:10.500 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 21:59:10.501 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 21:59:10.504 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:10.535 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 58.7423ms
2025-07-03 21:59:10.536 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:10.537 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 67.2977ms
2025-07-03 21:59:10.856 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:59:10.867 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:10.870 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:10.873 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:10.875 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 4.3528ms
2025-07-03 21:59:10.876 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:10.877 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 21.3212ms
2025-07-03 21:59:11.111 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 21:59:11.114 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:11.117 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 21:59:11.129 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 21:59:11.132 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 21:59:11.138 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 21:59:11.152 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 21:59:11.152 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 21:59:11.153 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 21:59:11.154 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 21:59:11.154 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 21:59:11.155 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 21:59:11.155 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 21:59:11.156 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 21:59:11.156 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 21:59:11.157 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 21:59:11.157 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 21:59:11.158 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 21:59:11.163 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 21:59:11.168 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 48.9075ms
2025-07-03 21:59:11.169 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:11.170 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 58.5646ms
2025-07-03 21:59:15.877 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-03 21:59:15.880 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:15.881 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 4.0933ms
2025-07-03 21:59:15.883 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 21:59:15.886 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:15.888 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:15.889 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:15.891 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 21:59:15.893 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 21:59:15.897 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 21:59:15.900 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 21:59:15.903 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 21:59:15.906 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 21:59:15.908 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 21:59:15.909 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 21:59:15.910 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:15.911 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 20.9094ms
2025-07-03 21:59:15.912 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:15.913 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 29.9599ms
2025-07-03 21:59:15.919 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:59:15.922 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:15.923 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:15.926 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:15.927 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.8372ms
2025-07-03 21:59:15.928 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:15.929 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 9.2254ms
2025-07-03 21:59:16.243 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 21:59:16.247 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:16.248 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 21:59:16.252 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 21:59:16.255 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 21:59:16.257 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 21:59:16.259 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 21:59:16.260 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 21:59:16.260 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 21:59:16.261 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 21:59:16.261 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 21:59:16.262 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 21:59:16.263 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 21:59:16.263 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 21:59:16.264 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 21:59:16.264 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 21:59:16.265 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 21:59:16.265 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 21:59:16.267 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 21:59:16.268 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.8529ms
2025-07-03 21:59:16.269 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:16.270 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 26.4597ms
2025-07-03 21:59:20.390 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-03 21:59:20.393 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:20.394 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:20.395 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:20.397 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-03 21:59:20.400 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-03 21:59:20.405 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-03 21:59:20.408 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-03 21:59:20.411 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-03 21:59:20.414 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000007' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-03 21:59:20.416 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-03 21:59:20.417 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-03 21:59:20.419 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:20.420 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 23.496ms
2025-07-03 21:59:20.421 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-03 21:59:20.423 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 32.3204ms
2025-07-03 21:59:20.431 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-03 21:59:20.434 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:20.436 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-03 21:59:20.438 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:20.439 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.8226ms
2025-07-03 21:59:20.440 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-03 21:59:20.442 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 10.8833ms
2025-07-03 21:59:20.755 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-03 21:59:20.757 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:20.758 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-03 21:59:20.762 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 21:59:20.765 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-03 21:59:20.768 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-03 21:59:20.770 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-03 21:59:20.771 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-03 21:59:20.771 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-03 21:59:20.772 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-03 21:59:20.773 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-03 21:59:20.774 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-03 21:59:20.775 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-03 21:59:20.776 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-03 21:59:20.776 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-03 21:59:20.777 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-03 21:59:20.778 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-03 21:59:20.778 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-03 21:59:20.780 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 21:59:20.781 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 21.6132ms
2025-07-03 21:59:20.782 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-03 21:59:20.784 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 28.9237ms
2025-07-03 21:59:21.040 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 21:59:21.042 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:21.043 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 3.0645ms
2025-07-03 21:59:21.045 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 21:59:21.048 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:21.050 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 21:59:21.050 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 21:59:21.050 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 21:59:21.050 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 21:59:21.053 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:21.058 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:21.060 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 10.3235ms
2025-07-03 21:59:21.060 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:21.061 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 21:59:21.067 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 21:59:21.066 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 21:59:21.062 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 21:59:21.067 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 21:59:24.824 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 21:59:24.822 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=uzsrYAMpOoRcYgFuE4CrPQ - null null
2025-07-03 21:59:24.827 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-03 21:59:24.828 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:24.828 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 3783.9642ms
2025-07-03 21:59:24.832 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:24.833 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 21:59:24.836 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 21:59:24.836 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 21:59:24.839 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 3776.6348ms
2025-07-03 21:59:24.856 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-03 21:59:24.872 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 21:59:24.880 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:24.881 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Q-eF4OF-p1KeUi0aLIcyWQ - null null
2025-07-03 21:59:24.886 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:24.887 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-03 21:59:24.888 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 21:59:24.889 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 59.0707ms
2025-07-03 21:59:24.893 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 21:59:24.895 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 3844.7816ms
2025-07-03 21:59:24.913 +05:30 [INF] GetAllContactsAsync returned 7 contacts
2025-07-03 21:59:24.914 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 21:59:24.926 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 3855.9112ms
2025-07-03 21:59:24.927 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 21:59:24.928 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 3878.0166ms
2025-07-03 21:59:31.350 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-03 21:59:31.358 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:31.360 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 21:59:31.365 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 21:59:31.366 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 21:59:31.366 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 21:59:31.368 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=uzsrYAMpOoRcYgFuE4CrPQ - 101 null null 6545.9792ms
2025-07-03 21:59:31.369 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=Q-eF4OF-p1KeUi0aLIcyWQ - 101 null null 6487.9385ms
2025-07-03 21:59:31.376 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-03 21:59:31.380 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-03 21:59:31.383 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 16.3118ms
2025-07-03 21:59:31.385 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-03 21:59:31.386 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 35.4596ms
2025-07-03 21:59:33.371 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-03 21:59:33.374 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:33.375 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 4.5919ms
2025-07-03 21:59:33.378 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 470
2025-07-03 21:59:33.380 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:33.382 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 21:59:33.385 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 21:59:34.546 +05:30 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType127`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:34.549 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1162.897ms
2025-07-03 21:59:34.550 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 21:59:34.552 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 500 null application/json; charset=utf-8 1174.0285ms
2025-07-03 21:59:54.100 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-03 21:59:54.103 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:54.104 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 3.5309ms
2025-07-03 21:59:54.105 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 476
2025-07-03 21:59:54.109 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:54.110 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 21:59:54.115 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 21:59:54.119 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-03 21:59:54.120 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-03 21:59:54.126 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-03 21:59:54.138 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BOygu1zFW8ZCQREmzas0wxWP8RQyw0hx22FLlYXBymhdZAi6ks6e7EoLKZA1DkSkZCZB0MSZC5UplyHAjbeCuLQvVNYfm23jCakM4TmzZARcODkmZBM8zpIhH3c0fyV0tmw9XWdyvDpkZAUflt4sxXuv4EElpYZACnT6k0OP21YiJ3QtJXke9Rbxr46FTO8rWhmLyjsfTb7ZB8YYXK8kXZCuEvRYrSCVY3blVDRYNP0ilk6jbftQ9RZCvaXwZDZD' (Nullable = false), @p1='2025-07-03T16:29:54.1302199Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-03 21:59:54.140 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-03 21:59:54.141 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:54.143 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 26.4872ms
2025-07-03 21:59:54.144 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-03 21:59:54.145 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 39.8047ms
2025-07-03 21:59:55.183 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-03 21:59:55.186 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:55.187 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.4785ms
2025-07-03 21:59:55.188 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 476
2025-07-03 21:59:55.193 +05:30 [INF] CORS policy execution successful.
2025-07-03 21:59:55.194 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 21:59:55.196 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-03 21:59:56.730 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 21:59:56.732 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1533.4629ms
2025-07-03 21:59:56.733 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-03 21:59:56.734 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1546.1205ms
2025-07-03 22:00:33.755 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-03 22:00:33.758 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:00:33.759 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:00:33.761 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNkJDOUFGOUU3REU0OUQwMUY0NDQxMURFMzUyODBEMDIA","timestamp":"1751560237","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:00:33.762 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:00:33.763 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNkJDOUFGOUU3REU0OUQwMUY0NDQxMURFMzUyODBEMDIA","timestamp":"1751560237","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:00:33.764 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:00:33.765 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:00:33.766 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.9712ms
2025-07-03 22:00:37.319 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:00:37.321 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:00:37.321 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 3566.1285ms
2025-07-03 22:00:37.342 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:00:37.347 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:00:37.349 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:00:37.351 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:00:37.356 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='325fb4ad-a1f0-4b5f-9702-869d09d13304', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:30:37.3538234Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:30:37.3538235Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:00:37.359 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:00:38.307 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:00:38.310 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='8c3be1a6-8ec1-4e0f-b331-62e4e389adec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:00:38.312 +05:30 [INF] ⚡ Flow triggered: welcomeMsg by keyword: hi
2025-07-03 22:00:39.119 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='0f094d77-dee4-4f59-baad-841a9c048b21', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:30:39.1000887Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:00:39.121 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:00:39.122 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:00:39.123 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:00:54.806 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 22:00:54.808 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-03 22:00:54.808 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-03 22:00:54.814 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-03 22:00:54.813 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.811 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.846 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.848 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.849 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 22:00:54.850 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 36.8954ms
2025-07-03 22:00:54.851 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 22:00:54.850 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 22:00:54.849 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 42.8366ms
2025-07-03 22:00:54.850 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-03 22:00:54.855 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 22:00:54.860 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.861 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 22:00:54.868 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 22:00:54.869 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-03 22:00:54.866 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.872 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-03 22:00:54.873 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 22:00:54.877 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 22:00:54.882 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 30.4401ms
2025-07-03 22:00:54.877 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=xRo_89uA_7drixXOe1xTwA - null null
2025-07-03 22:00:54.876 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-03 22:00:54.889 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:00:54.893 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.894 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-03 22:00:54.895 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 27.6357ms
2025-07-03 22:00:54.896 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 22:00:54.896 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 46.2307ms
2025-07-03 22:00:54.897 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-03 22:00:54.904 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 96.2552ms
2025-07-03 22:00:54.925 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=SYpaB7_TLkGHD6PzPdWzNQ - null null
2025-07-03 22:00:54.928 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:54.929 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-03 22:00:54.937 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-03 22:00:54.939 +05:30 [INF] GetAllContactsAsync returned 7 contacts
2025-07-03 22:00:54.941 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 22:00:54.942 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 70.1172ms
2025-07-03 22:00:54.943 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-03 22:00:54.944 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 136.514ms
2025-07-03 22:00:57.244 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=0876f654-a362-420f-a912-6bce793436a5 - null 0
2025-07-03 22:00:57.247 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:57.249 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 22:00:57.249 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 22:00:57.249 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 22:00:57.253 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:57.255 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:57.256 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 22:00:57.256 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 22:00:57.268 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 22:00:57.268 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 22:00:57.268 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-03 22:00:59.143 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:00:59.150 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-03 22:00:59.159 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-03 22:00:59.161 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='0876f654-a362-420f-a912-6bce793436a5', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-03 22:00:59.168 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 22:00:59.173 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 22:00:59.176 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='d225a11a-5dab-4768-baad-6036616eabad', @p0='2025-07-03T16:30:59.1546464Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-03 22:00:59.178 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 1906.7515ms
2025-07-03 22:00:59.179 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - null null
2025-07-03 22:00:59.180 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 22:00:59.182 +05:30 [INF] CORS policy execution successful.
2025-07-03 22:00:59.184 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 1934.5926ms
2025-07-03 22:00:59.184 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-03 22:00:59.185 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 22:00:59.191 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-03 22:00:59.195 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-03 22:01:01.686 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:01:01.691 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-03 22:01:01.695 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-03 22:01:01.697 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 2502.5145ms
2025-07-03 22:01:01.698 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-03 22:01:01.699 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 2520.0454ms
2025-07-03 22:01:01.705 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p1='0e4f83f9-d5a1-4e9f-947e-2e794cd64b74', @p0='Read' (Nullable = false), @p3='0f094d77-dee4-4f59-baad-841a9c048b21', @p2='Read' (Nullable = false), @p5='0fae67ca-2590-426a-983e-9d17652cac76', @p4='Read' (Nullable = false), @p7='1d96a4df-7b39-4140-ae8f-c5e7f13fd73b', @p6='Read' (Nullable = false), @p9='325fb4ad-a1f0-4b5f-9702-869d09d13304', @p8='Read' (Nullable = false), @p11='3ed9016b-db68-40fa-b636-2811f9050975', @p10='Read' (Nullable = false), @p13='40be0b49-ea8f-42b1-a088-3e0508c23acb', @p12='Read' (Nullable = false), @p15='499ab83c-ea89-4be7-ae2e-fd3cfc696315', @p14='Read' (Nullable = false), @p17='657de8c6-34b9-4a26-b396-1b2d48c13176', @p16='Read' (Nullable = false), @p19='79c3d745-ccfb-4329-bc4a-b5dfd5ac1c67', @p18='Read' (Nullable = false), @p21='7eebb1c7-1d93-4eac-adc4-04bf0fe0c2ef', @p20='Read' (Nullable = false), @p23='89c79ae6-e9d6-447d-a61b-1ec4a5c6ba9c', @p22='Read' (Nullable = false), @p25='921d6f90-15d4-4990-972b-2c285deb7f6f', @p24='Read' (Nullable = false), @p27='a8915cfb-2ed7-4135-9b3f-4ffac7559596', @p26='Read' (Nullable = false), @p29='be2c7888-cc99-4ab3-8398-9d09b0ae84aa', @p28='Read' (Nullable = false), @p31='c60a7af0-5727-426c-baa3-ab84e4b9d5a1', @p30='Read' (Nullable = false), @p33='d34311e6-9c2c-4ffd-bfea-116b0bc6981c', @p32='Read' (Nullable = false), @p35='eb0b197a-77f5-4f82-bc3a-21cd9641566d', @p34='Read' (Nullable = false), @p37='eb25841c-00c1-449b-9ef5-cb1fd2562554', @p36='Read' (Nullable = false), @p39='eb627098-2dbc-4b02-9ac8-7ed461c7b1af', @p38='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
UPDATE "MessageLogs" SET "Status" = @p4
WHERE "Id" = @p5;
UPDATE "MessageLogs" SET "Status" = @p6
WHERE "Id" = @p7;
UPDATE "MessageLogs" SET "Status" = @p8
WHERE "Id" = @p9;
UPDATE "MessageLogs" SET "Status" = @p10
WHERE "Id" = @p11;
UPDATE "MessageLogs" SET "Status" = @p12
WHERE "Id" = @p13;
UPDATE "MessageLogs" SET "Status" = @p14
WHERE "Id" = @p15;
UPDATE "MessageLogs" SET "Status" = @p16
WHERE "Id" = @p17;
UPDATE "MessageLogs" SET "Status" = @p18
WHERE "Id" = @p19;
UPDATE "MessageLogs" SET "Status" = @p20
WHERE "Id" = @p21;
UPDATE "MessageLogs" SET "Status" = @p22
WHERE "Id" = @p23;
UPDATE "MessageLogs" SET "Status" = @p24
WHERE "Id" = @p25;
UPDATE "MessageLogs" SET "Status" = @p26
WHERE "Id" = @p27;
UPDATE "MessageLogs" SET "Status" = @p28
WHERE "Id" = @p29;
UPDATE "MessageLogs" SET "Status" = @p30
WHERE "Id" = @p31;
UPDATE "MessageLogs" SET "Status" = @p32
WHERE "Id" = @p33;
UPDATE "MessageLogs" SET "Status" = @p34
WHERE "Id" = @p35;
UPDATE "MessageLogs" SET "Status" = @p36
WHERE "Id" = @p37;
UPDATE "MessageLogs" SET "Status" = @p38
WHERE "Id" = @p39;
2025-07-03 22:01:01.709 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-03 22:01:01.715 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 4444.7159ms
2025-07-03 22:01:01.716 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-03 22:01:01.717 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=0876f654-a362-420f-a912-6bce793436a5 - 200 null application/json; charset=utf-8 4467.844ms
2025-07-03 22:01:01.722 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-03 22:01:01.723 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 4449.4881ms
2025-07-03 22:01:01.724 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-03 22:01:01.725 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=0876f654-a362-420f-a912-6bce793436a5 - 200 0 null 4480.5233ms
2025-07-03 22:01:07.098 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__dto_ContactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__dto_ContactId_1
LIMIT 1
2025-07-03 22:01:07.103 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:01:07.106 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:01:07.107 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:01:07.196 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-03 22:01:07.201 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 22:01:07.202 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-03 22:01:09.000 +05:30 [INF] Received HTTP response headers after 1794.3636ms - 200
2025-07-03 22:01:09.002 +05:30 [INF] End processing HTTP request after 1802.4291ms - 200
2025-07-03 22:01:09.093 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='7835ba4f-aa3a-44c4-8dce-301c600f9103', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:31:09.0912396Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hlkhh;' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hlkhh;', @p16='2025-07-03T16:31:09.0912398Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:01:10.974 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-03 22:01:10.976 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:10.977 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:01:10.979 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"sent","timestamp":"1751560274","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","expiration_timestamp":"1751560274","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:10.981 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:01:10.981 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"sent","timestamp":"1751560274","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","expiration_timestamp":"1751560274","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:10.982 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:01:10.983 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 22:01:10.984 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3276ms
2025-07-03 22:01:10.986 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"sent","timestamp":"1751560274","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","expiration_timestamp":"1751560274","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:10.986 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:10.988 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.6491ms
2025-07-03 22:01:10.997 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 22:01:10.999 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==
2025-07-03 22:01:11.020 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==
2025-07-03 22:01:11.675 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-03 22:01:11.678 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:11.679 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:01:11.681 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"delivered","timestamp":"1751560275","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:11.683 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:01:11.683 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"delivered","timestamp":"1751560275","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:11.684 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:01:11.685 +05:30 [INF] 📦 Routing to Status Processor
2025-07-03 22:01:11.686 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.8386ms
2025-07-03 22:01:11.687 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==","status":"delivered","timestamp":"1751560275","recipient_id":"917082156227","conversation":{"id":"157eb6e65e2a720a806f28103df70b73","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-03 22:01:11.688 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:11.691 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.885ms
2025-07-03 22:01:11.691 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-03 22:01:11.696 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==
2025-07-03 22:01:11.697 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDMwREJFREYwNDdBRjkzREU2AA==
2025-07-03 22:01:22.384 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 22:01:22.387 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:22.388 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:01:22.391 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjhBRjhDNjczRDMwOENBQUUzRDVGMEQyRjc3M0E0MUMA","timestamp":"1751560285","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:01:22.392 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:01:22.392 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMjhBRjhDNjczRDMwOENBQUUzRDVGMEQyRjc3M0E0MUMA","timestamp":"1751560285","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:01:22.393 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:01:22.394 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:01:22.395 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1434ms
2025-07-03 22:01:25.230 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:25.232 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:01:25.232 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 2847.5689ms
2025-07-03 22:01:25.234 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:01:25.239 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:01:25.241 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:01:25.243 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:01:25.247 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='d42ac8c6-e8ca-49db-a56b-f1409bd56979', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:31:25.2450896Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:31:25.2450897Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:01:25.250 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:01:26.206 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:01:26.210 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:01:26.212 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:01:27.097 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='5b6efbdc-59f0-4324-919a-5d8ba4f514ed', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:31:27.0765876Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:01:27.100 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:01:27.101 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:01:27.102 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:01:47.604 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 22:01:47.607 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:47.608 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:01:47.611 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNDkxRTc0QjA0MDMwNUQ5MUQ1QzAwQjk4MDU5NEEzQzMA","timestamp":"1751560310","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:01:47.612 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:01:47.612 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNDkxRTc0QjA0MDMwNUQ5MUQ1QzAwQjk4MDU5NEEzQzMA","timestamp":"1751560310","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:01:47.613 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:01:47.614 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:01:47.615 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4725ms
2025-07-03 22:01:51.385 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:01:51.387 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:01:51.387 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 3783.2154ms
2025-07-03 22:01:51.390 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:01:51.394 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:01:51.396 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:01:51.398 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:01:51.419 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='bd115c20-89ee-4d65-9657-19060d486a64', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:31:51.4006630Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:31:51.4006631Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:01:51.422 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:01:53.285 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:01:53.288 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:01:53.290 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:01:54.781 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='65925517-cebe-43d8-9e0a-8f7b8a999719', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:31:54.7609853Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:01:54.783 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:01:54.784 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:01:54.785 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:02:08.990 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 22:02:08.997 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=xRo_89uA_7drixXOe1xTwA - 101 null null 74120.1778ms
2025-07-03 22:02:08.999 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-03 22:02:09.002 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=SYpaB7_TLkGHD6PzPdWzNQ - 101 null null 74076.7279ms
2025-07-03 22:02:21.924 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 22:02:21.927 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:02:21.928 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:02:21.930 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTZCMTIxRjIyRjIzODkzNjE4NkNFN0NEQjMzRUM2QjMA","timestamp":"1751560345","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:02:21.931 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:02:21.931 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTZCMTIxRjIyRjIzODkzNjE4NkNFN0NEQjMzRUM2QjMA","timestamp":"1751560345","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:02:21.932 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:02:21.933 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:02:21.934 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7337ms
2025-07-03 22:02:23.726 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:02:23.728 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:02:23.728 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 1803.4107ms
2025-07-03 22:02:23.730 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:02:23.734 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:02:23.736 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:02:23.738 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:02:23.742 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='eadd4529-b99d-4deb-b8fd-5422b85440e9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:32:23.7401757Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:32:23.7401757Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:02:23.745 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:02:25.168 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:02:25.172 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:02:25.174 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:02:25.966 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='c1e6fdbd-521a-432f-a67b-6c99d3291eae', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:32:25.9636871Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:02:25.967 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:02:25.968 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:02:25.969 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:08:52.459 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 22:08:52.465 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:08:52.466 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:08:52.467 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMEZFQjNGREQxQjc1NDdFMTVBMzQyNkMxNzRDMjM2RjAA","timestamp":"1751560735","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:08:52.469 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:08:52.469 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMEZFQjNGREQxQjc1NDdFMTVBMzQyNkMxNzRDMjM2RjAA","timestamp":"1751560735","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:08:52.469 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:08:52.471 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:08:52.472 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.635ms
2025-07-03 22:08:54.421 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:08:54.423 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 1963.8628ms
2025-07-03 22:08:54.582 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:08:54.585 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:08:54.587 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:08:54.589 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:08:54.591 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:08:54.595 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='6f2b7604-c125-43ef-8e58-e16393b0bf54', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:38:54.5929328Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:38:54.5929329Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:08:54.598 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:08:55.543 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:08:55.546 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:08:55.548 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:08:55.550 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:08:55.552 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:08:55.553 +05:30 [INF] ⚙️ Executing node "5b25d482-4701-4644-b1aa-94ec65cc5d89" [start]
2025-07-03 22:08:55.554 +05:30 [INF] 🚦 Start node reached: "5b25d482-4701-4644-b1aa-94ec65cc5d89"
2025-07-03 22:08:55.562 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:08:56.333 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='f01142be-9e1c-4760-8e58-6a9e539ad787', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:38:56.3310732Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:08:56.335 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:08:56.336 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:08:56.337 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:09:16.154 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-03 22:09:16.156 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:09:16.157 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:09:16.159 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTNFRUE0QUNBMDkzNjM4QTY5RjY2MkNFOTJEMzhCODMA","timestamp":"1751560759","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:09:16.160 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:09:16.160 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTNFRUE0QUNBMDkzNjM4QTY5RjY2MkNFOTJEMzhCODMA","timestamp":"1751560759","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:09:16.161 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:09:16.162 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:09:16.163 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4128ms
2025-07-03 22:09:25.118 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:09:25.811 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 9657.1146ms
2025-07-03 22:09:32.327 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:09:36.236 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:09:36.239 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:09:36.252 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:09:38.150 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:09:55.265 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='79ce570c-95e6-4516-8aad-67894470994c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:39:52.8802994Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:39:52.8865867Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:10:14.533 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:10:40.574 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:10:42.175 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:11:08.184 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-03 22:11:08.186 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:11:08.199 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-03 22:11:27.327 +05:30 [INF] ⚙️ Executing node "5b25d482-4701-4644-b1aa-94ec65cc5d89" [start]
2025-07-03 22:11:34.478 +05:30 [INF] 🚦 Start node reached: "5b25d482-4701-4644-b1aa-94ec65cc5d89"
2025-07-03 22:11:54.641 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:12:00.707 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='807615bf-604b-4e93-a330-bd127dea4647', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-03T16:41:59.3782287Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:12:06.606 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:12:07.484 +05:30 [INF] Assigning agent to contact "0876f654-a362-420f-a912-6bce793436a5" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:12:08.011 +05:30 [INF] 🙋 Agent assigned to contact 917082156227
2025-07-03 22:12:54.392 +05:30 [INF] Request starting HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-03 22:12:54.399 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:12:54.400 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-03 22:12:54.402 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggREFDMUE0RDE2QjBERjIwQTE3M0M4ODExOURERDMwMEYA","timestamp":"1751560977","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:12:54.404 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-03 22:12:54.412 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-03 22:12:56.192 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 1790.0191ms
2025-07-03 22:12:56.192 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggREFDMUE0RDE2QjBERjIwQTE3M0M4ODExOURERDMwMEYA","timestamp":"1751560977","text":{"body":"pizza"},"type":"text"}]},"field":"messages"}]}]}
2025-07-03 22:12:56.193 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-03 22:12:56.195 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-03 22:12:56.195 +05:30 [INF] Request finished HTTP/1.1 POST http://f761-2401-4900-5d30-557b-dc94-38c9-6992-f2de.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 1803.8268ms
2025-07-03 22:12:56.762 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-03 22:12:56.770 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-03 22:12:56.773 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:12:56.777 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='a307d00b-239b-4c7b-bb16-77838875fbec', @p1=NULL (DbType = Guid), @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='2025-07-03T16:42:56.7751787Z' (DbType = DateTime), @p4=NULL, @p5=NULL, @p6='True', @p7='False', @p8='False', @p9='False', @p10=NULL (DbType = DateTime), @p11=NULL, @p12=NULL (DbType = Guid), @p13=NULL (DbType = DateTime), @p14=NULL, @p15='WhatsApp User' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL, @p18='918974005240' (Nullable = false), @p19=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Contacts" ("Id", "AssignedAgentId", "BusinessId", "CreatedAt", "Email", "Group", "IsActive", "IsArchived", "IsAutomationPaused", "IsFavorite", "LastCTAInteraction", "LastCTAType", "LastClickedProductId", "LastContactedAt", "LeadSource", "Name", "NextFollowUpAt", "Notes", "PhoneNumber", "Tags")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
2025-07-03 22:12:56.779 +05:30 [INF] Contact created: "a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-03 22:12:56.782 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-03 22:12:56.785 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='88c92ef0-39c4-448e-b0bd-9089b03872b3', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-03T16:42:56.7837269Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-03T16:42:56.7837269Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:12:56.788 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."FlowId", a."FlowName", a."IsActive", a."MediaUrl", a."Priority", a."ReplyMessage", a."TriggerKeyword", a."UpdatedAt"
FROM "AutoReplyRules" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."IsActive"
2025-07-03 22:12:57.342 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."ConfigJson", a."CreatedAt", a."FlowId", a."Label", a."NodeType", a."Order", a."Position_X", a."Position_Y"
FROM "AutoReplyFlowNodes" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:12:57.346 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__flowId_0='d6c0e208-6966-468d-93cc-bd4409423860'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."CreatedAt", a."FlowId", a."SourceHandle", a."SourceNodeId", a."TargetHandle", a."TargetNodeId"
FROM "AutoReplyFlowEdges" AS a
WHERE a."FlowId" = @__flowId_0
2025-07-03 22:12:57.348 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-03 22:12:57.350 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-03 22:12:57.352 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-03 22:12:57.353 +05:30 [INF] ⚙️ Executing node "5b25d482-4701-4644-b1aa-94ec65cc5d89" [start]
2025-07-03 22:12:57.353 +05:30 [INF] 🚦 Start node reached: "5b25d482-4701-4644-b1aa-94ec65cc5d89"
2025-07-03 22:12:57.354 +05:30 [INF] ⚡ Flow triggered: Pizza Order Flow by keyword: pizza
2025-07-03 22:12:57.790 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='772341f8-2c75-4aea-8541-63bd86383e8c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-03T16:42:57.7879750Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='pizza' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16=NULL (DbType = DateTime), @p17=NULL, @p18='Queued' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-03 22:12:57.792 +05:30 [INF] Checking if agent is available for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:12:57.792 +05:30 [INF] Assigning agent to contact "a307d00b-239b-4c7b-bb16-77838875fbec" for business "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-03 22:12:57.793 +05:30 [INF] 🙋 Agent assigned to contact 918974005240
