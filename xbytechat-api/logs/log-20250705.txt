2025-07-05 10:32:03.685 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 10:32:03.741 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 10:32:03.760 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 10:32:04.804 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 10:32:05.647 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 10:32:06.066 +05:30 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 10:32:06.074 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 10:32:06.076 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 10:32:06.077 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 10:32:06.079 +05:30 [INF] Hosting environment: Development
2025-07-05 10:32:06.081 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 10:32:06.091 +05:30 [INF] Executed DbCommand (126ms) [Parameters=[@__cutoff_0='2025-06-28T05:02:03.9266673Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 10:32:06.636 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 10:32:06.934 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 309.8326ms
2025-07-05 10:32:06.947 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 10:32:06.955 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.5828ms
2025-07-05 10:32:07.010 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 10:32:07.084 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 74.2186ms
2025-07-05 10:32:07.218 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 10:32:07.473 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 254.8287ms
2025-07-05 10:32:16.316 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 10:32:16.336 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 10:32:16.340 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:16.342 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 26.4072ms
2025-07-05 10:32:16.345 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 10:32:16.353 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:16.510 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 10:32:16.528 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 10:32:16.592 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 10:32:16.663 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 10:32:16.760 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 10:32:16.837 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 10:32:16.855 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 10:32:16.928 +05:30 [INF] Executed DbCommand (43ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 10:32:16.951 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 10:32:17.029 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 10:32:17.036 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:32:17.054 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 520.6584ms
2025-07-05 10:32:17.056 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 10:32:17.060 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 715.5028ms
2025-07-05 10:32:17.368 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 10:32:17.414 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 10:32:17.416 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 10:32:17.421 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:32:17.424 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 5.7334ms
2025-07-05 10:32:17.425 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 10:32:17.426 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 58.0324ms
2025-07-05 10:32:17.620 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 10:32:17.626 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 10:32:17.629 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 10:32:17.643 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 10:32:17.648 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 10:32:17.679 +05:30 [INF] Executed DbCommand (25ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 10:32:17.697 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 10:32:17.698 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 10:32:17.699 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 10:32:17.699 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 10:32:17.700 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 10:32:17.701 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 10:32:17.702 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 10:32:17.702 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 10:32:17.703 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 10:32:17.704 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 10:32:17.705 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 10:32:17.705 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 10:32:17.709 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 10:32:17.716 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 85.0791ms
2025-07-05 10:32:17.717 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 10:32:17.718 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 97.9089ms
2025-07-05 10:32:21.691 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 10:32:21.696 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:21.700 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 10:32:21.706 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 10:32:21.720 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 10:32:21.739 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 10:32:21.745 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 37.8034ms
2025-07-05 10:32:21.746 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 10:32:21.747 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 55.857ms
2025-07-05 10:32:25.751 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 10:32:25.755 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:25.756 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 6.0001ms
2025-07-05 10:32:25.758 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 482
2025-07-05 10:32:25.761 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:25.762 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 10:32:25.767 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 10:32:25.775 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 10:32:25.776 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 10:32:25.784 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 10:32:25.849 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BPBV83CJquJZB1r1nBFHH9FJSOKrCXvwc1ZBKTNAsvFY5bV6C4cYeGVUB1aIF9ZAwjCuj0CLWHBtY6ZBLNQ4G0i4H9ZCf4ffJd8sFKLZCZAl4RmUKZCk328PgZA8kZCgmSScb1wC4ZBJxc35OtrLZA5ZCM6UE5TYr0eAOr8IkAXIUUiVNrpyNQfcAEagdBpqGEVsfA3Yph9cTYlJGCPy8HTI7r7RFZAUZBNlwoW3cocuVNkyYdZCNtZBRZBSZAcu2QZDZD' (Nullable = false), @p1='2025-07-05T05:02:25.7879591Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-05 10:32:25.858 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 10:32:25.859 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:32:25.861 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 92.5258ms
2025-07-05 10:32:25.862 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 10:32:25.863 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 105.5633ms
2025-07-05 10:32:26.422 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 10:32:26.424 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:26.425 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.4874ms
2025-07-05 10:32:26.427 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 482
2025-07-05 10:32:26.431 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:32:26.433 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 10:32:26.436 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 10:32:27.677 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:32:27.679 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1241.2189ms
2025-07-05 10:32:27.680 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 10:32:27.681 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1254.7511ms
2025-07-05 10:33:12.085 +05:30 [INF] Request starting HTTP/1.1 GET http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1846933058&hub.verify_token=xbytechat-secret-token - null null
2025-07-05 10:33:12.089 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-05 10:33:12.112 +05:30 [INF] Route matched with {action = "VerifyWebhook", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult VerifyWebhook(System.String, System.String, System.String) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 10:33:12.121 +05:30 [INF] ✅ WhatsApp webhook verified successfully.
2025-07-05 10:33:12.122 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.String'.
2025-07-05 10:33:12.123 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api) in 9.8812ms
2025-07-05 10:33:12.125 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.VerifyWebhook (xbytechat.api)'
2025-07-05 10:33:12.126 +05:30 [INF] Request finished HTTP/1.1 GET http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp?hub.mode=subscribe&hub.challenge=1846933058&hub.verify_token=xbytechat-secret-token - 200 null text/plain; charset=utf-8 42.4737ms
2025-07-05 10:33:25.214 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 10:33:25.216 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:33:25.217 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.0215ms
2025-07-05 10:33:25.218 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 482
2025-07-05 10:33:25.225 +05:30 [INF] CORS policy execution successful.
2025-07-05 10:33:25.226 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 10:33:25.227 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 10:33:26.212 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:33:26.213 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 984.7583ms
2025-07-05 10:33:26.215 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 10:33:26.216 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 997.7673ms
2025-07-05 10:34:03.977 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 479
2025-07-05 10:34:03.981 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 10:34:03.984 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 10:34:03.991 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRUFGNzk2MDY2NEQwNUZERURCMjk5QUU5OEU4MkYyNkUA","timestamp":"1751691845","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 10:34:03.993 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 10:34:03.994 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:34:03.996 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 10.3171ms
2025-07-05 10:34:03.997 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 10:34:03.998 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.9102ms
2025-07-05 10:34:04.102 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRUFGNzk2MDY2NEQwNUZERURCMjk5QUU5OEU4MkYyNkUA","timestamp":"1751691845","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 10:34:04.103 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 10:34:30.550 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 10:34:35.682 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 10:34:35.702 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 10:34:35.731 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 10:34:41.456 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 10:34:48.565 +05:30 [INF] Executed DbCommand (14ms) [Parameters=[@p0='5a6a7db5-b393-413b-b40a-595b2a3a6334', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:04:44.0438442Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:04:44.0513997Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 10:34:54.748 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__ToLower_1='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND lower(a."TriggerKeyword") = @__ToLower_1 AND NOT (a."IsActive")
LIMIT 1
2025-07-05 10:35:05.395 +05:30 [INF] TryRun: No matching flow found for keyword 'hi'
2025-07-05 10:35:09.369 +05:30 [INF] 🕵️ No automation flow matched keyword: hi
2025-07-05 10:35:11.984 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 10:59:17.018 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 10:59:17.064 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 10:59:17.079 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 10:59:17.779 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 10:59:18.256 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 10:59:18.434 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 10:59:18.435 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 10:59:18.436 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 10:59:18.437 +05:30 [INF] Hosting environment: Development
2025-07-05 10:59:18.438 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 10:59:18.501 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 10:59:18.517 +05:30 [INF] Executed DbCommand (39ms) [Parameters=[@__cutoff_0='2025-06-28T05:29:17.1856146Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 10:59:20.760 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 10:59:20.919 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 168.6752ms
2025-07-05 10:59:20.935 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 10:59:20.943 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.0892ms
2025-07-05 10:59:21.008 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 10:59:21.050 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 41.2048ms
2025-07-05 10:59:21.185 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 10:59:21.393 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 208.3754ms
2025-07-05 10:59:42.241 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 10:59:42.245 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 10:59:42.276 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 10:59:42.287 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 10:59:42.301 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMkI1N0M0QjBDNjg1RTZDNzBCOEEwMENDQjEyRDVGMzcA","timestamp":"1751693384","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 10:59:42.303 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 10:59:42.307 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 10:59:42.315 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 24.0398ms
2025-07-05 10:59:42.316 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 10:59:42.320 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 79.7434ms
2025-07-05 10:59:42.424 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMkI1N0M0QjBDNjg1RTZDNzBCOEEwMENDQjEyRDVGMzcA","timestamp":"1751693384","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 10:59:42.426 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 10:59:56.461 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:00:00.951 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:00:00.962 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:00:01.001 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:00:04.200 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:00:07.658 +05:30 [INF] Executed DbCommand (16ms) [Parameters=[@p0='145ccb9b-69ee-4b93-8fce-3255fd0eb32d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:30:06.0716499Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:30:06.0793508Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:00:12.150 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__ToLower_1='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND lower(a."TriggerKeyword") = @__ToLower_1 AND NOT (a."IsActive")
LIMIT 1
2025-07-05 11:00:44.519 +05:30 [INF] TryRun: No matching flow found for keyword 'hello'
2025-07-05 11:00:48.769 +05:30 [INF] 🕵️ No automation flow matched keyword: hello
2025-07-05 11:00:52.565 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:02:57.556 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:02:57.569 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 13.2826ms
2025-07-05 11:02:57.594 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:02:57.594 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:02:57.602 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.3358ms
2025-07-05 11:02:57.611 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.7495ms
2025-07-05 11:02:57.961 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:02:58.037 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 75.5751ms
2025-07-05 11:03:08.602 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:03:08.607 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:03:08.611 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:03:08.615 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQjFGRUQyMzgzNkU3NUE1OEQ2RjJDQ0FFQUI3NEExMUYA","timestamp":"1751693133","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:03:08.616 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:03:08.617 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:03:08.618 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQjFGRUQyMzgzNkU3NUE1OEQ2RjJDQ0FFQUI3NEExMUYA","timestamp":"1751693133","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:03:08.619 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.5326ms
2025-07-05 11:03:08.620 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:03:08.621 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:03:13.474 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 4872.0521ms
2025-07-05 11:03:13.485 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:03:13.487 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:03:13.491 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:03:13.493 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:03:13.496 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:03:13.522 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@p0='59fd02f5-34ce-4f0a-98ac-b68192ff72e3', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:33:13.4992249Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:33:13.4992250Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:03:13.531 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__ToLower_1='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND lower(a."TriggerKeyword") = @__ToLower_1 AND a."IsActive"
LIMIT 1
2025-07-05 11:03:13.544 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:03:13.547 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:03:13.549 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:03:13.838 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:03:13.875 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:04:05.663 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:04:05.670 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 6.7309ms
2025-07-05 11:04:05.690 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:04:05.690 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:04:05.697 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 6.6102ms
2025-07-05 11:04:05.698 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 8.1991ms
2025-07-05 11:04:05.846 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:04:05.901 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 54.8753ms
2025-07-05 11:04:13.406 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:04:13.414 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 7.5558ms
2025-07-05 11:04:13.434 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:04:13.434 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:04:13.442 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.0732ms
2025-07-05 11:04:13.442 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 8.8317ms
2025-07-05 11:04:13.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:04:13.601 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 38.9324ms
2025-07-05 11:04:35.228 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:04:35.233 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:04:35.235 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:04:35.238 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkIyODREOThCQkIzRDVEQjM0REE2MEVFMDIxNDVDMzQA","timestamp":"1751693677","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:04:35.240 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:04:35.241 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:04:35.242 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.9967ms
2025-07-05 11:04:35.243 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:04:35.244 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.0849ms
2025-07-05 11:04:35.246 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkIyODREOThCQkIzRDVEQjM0REE2MEVFMDIxNDVDMzQA","timestamp":"1751693677","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:04:35.248 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:04:55.020 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:05:19.893 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:05:19.897 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:05:19.911 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:05:24.133 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:05:30.559 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='cd15d55c-2262-45c6-8311-e00f876f9929', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:35:26.0042302Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:35:26.0131896Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:06:07.116 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:06:34.644 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:06:34.647 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:06:34.663 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:12:12.856 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:12:12.925 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:12:12.935 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:12:12.941 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:12:12.942 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:12:12.945 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRjExOTU1NDM5Njk5MTA4MjFGRTJDQTYxQjMwNkM4RDcA","timestamp":"1751694125","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:12:12.946 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:12:12.947 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRjExOTU1NDM5Njk5MTA4MjFGRTJDQTYxQjMwNkM4RDcA","timestamp":"1751694125","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:12:12.947 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:12:12.949 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:12:12.951 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.9371ms
2025-07-05 11:12:14.655 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:12:14.656 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 1731.8164ms
2025-07-05 11:12:14.659 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:12:14.663 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:12:14.667 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:12:14.669 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:12:14.672 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:12:14.694 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='16b82af4-6b52-4902-a1df-350d71a38f13', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:42:14.6744689Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:42:14.6744690Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:12:14.698 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:12:14.700 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:12:14.703 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:12:14.705 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:12:14.765 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:12:14.771 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:12:30.019 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:12:30.022 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:12:30.025 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:12:30.027 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzlFMEE5QkEwOTU0MDZENjAxMkNCMEQ0NzI2OUY5QzcA","timestamp":"1751694152","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:12:30.028 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:12:30.029 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzlFMEE5QkEwOTU0MDZENjAxMkNCMEQ0NzI2OUY5QzcA","timestamp":"1751694152","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:12:30.029 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:12:30.030 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:12:30.031 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8371ms
2025-07-05 11:12:33.968 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:12:33.980 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 3960.9104ms
2025-07-05 11:12:45.405 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:12:45.408 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:12:45.410 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:12:45.412 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:12:45.414 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:12:45.436 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='784c6821-c211-4f6d-8b88-d549824fb916', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:42:45.4156809Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:42:45.4156811Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:12:56.441 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:13:08.050 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:13:12.356 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:13:19.714 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:13:24.211 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:13:24.216 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:14:15.699 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:14:15.735 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:14:15.736 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:14:15.738 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMEM5RDhBRjk1M0NFNEQwNUE1RUI4M0YzQzM4OUVGNzgA","timestamp":"1751694258","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:14:15.739 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:14:15.740 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMEM5RDhBRjk1M0NFNEQwNUE1RUI4M0YzQzM4OUVGNzgA","timestamp":"1751694258","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:14:15.740 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:14:15.741 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:14:15.742 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7499ms
2025-07-05 11:14:15.744 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:14:15.746 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:14:15.750 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 50.7723ms
2025-07-05 11:14:15.751 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:14:15.754 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:14:15.756 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:14:15.758 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:14:15.761 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='9b8eba71-5d69-4b8c-9fb5-5a92162f5e52', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:44:15.7600427Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:44:15.7600440Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:14:25.614 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:14:30.255 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:14:33.709 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:14:36.439 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:15:07.910 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:15:07.915 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:16:01.892 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:16:01.895 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:16:01.896 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:16:01.899 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQUFDODZCMDI4NDM4M0Y2MzcyMkMwMTU5ODdCODVDOTIA","timestamp":"1751694364","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:16:01.900 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:16:01.901 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQUFDODZCMDI4NDM4M0Y2MzcyMkMwMTU5ODdCODVDOTIA","timestamp":"1751694364","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:16:01.901 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:16:01.902 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:16:01.904 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.9784ms
2025-07-05 11:16:01.906 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:16:01.907 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:16:01.912 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.954ms
2025-07-05 11:16:03.769 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:16:03.775 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:16:03.777 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:16:03.780 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:16:04.167 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='33bec483-5ba2-4452-83ac-ecaebb24a643', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:46:04.1646127Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:46:04.1646128Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:16:04.501 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:16:04.503 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:16:04.505 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:16:04.506 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:16:04.580 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "n1" to type 'System.Guid'. Path '[0].id', line 3, position 22.
 ---> System.ArgumentException: Could not cast or convert from System.String to System.Guid.
   at Newtonsoft.Json.Utilities.ConvertUtils.EnsureTypeAssignable(Object value, Type initialType, Type targetType)
   at Newtonsoft.Json.Utilities.ConvertUtils.ConvertOrCast(Object initialValue, CultureInfo culture, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag)
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value)
2025-07-05 11:16:04.588 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:24:06.141 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:24:06.183 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:24:06.197 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:24:06.979 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:24:07.523 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:24:07.867 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:24:07.868 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:24:07.869 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:24:07.870 +05:30 [INF] Hosting environment: Development
2025-07-05 11:24:07.871 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:24:07.927 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:24:07.948 +05:30 [INF] Executed DbCommand (36ms) [Parameters=[@__cutoff_0='2025-06-28T05:54:06.3174481Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:24:09.815 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:24:10.003 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 196.8354ms
2025-07-05 11:24:10.143 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:24:10.143 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:24:10.155 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 11.6234ms
2025-07-05 11:24:10.186 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 42.9048ms
2025-07-05 11:24:10.307 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:24:10.507 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 199.2543ms
2025-07-05 11:24:35.641 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:24:35.647 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:24:35.681 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:24:35.692 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:24:35.706 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRTFCNUExMEQ1MkQ5NzJGRTUzNDI3NEI5Mzk5NTExRjAA","timestamp":"1751694877","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:24:35.709 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:24:35.714 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:24:35.724 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 27.2011ms
2025-07-05 11:24:35.725 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:24:35.727 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 86.1577ms
2025-07-05 11:24:35.810 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRTFCNUExMEQ1MkQ5NzJGRTUzNDI3NEI5Mzk5NTExRjAA","timestamp":"1751694877","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:24:35.811 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:24:35.904 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:24:35.998 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:24:36.008 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:24:36.040 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:24:36.047 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:24:36.203 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@p0='5434ab35-7be9-4c25-92e1-825d98f62967', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T05:54:36.0499482Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T05:54:36.0499712Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:24:47.889 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:24:55.585 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:24:55.590 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:24:55.603 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:25:21.063 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:25:30.666 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:31:00.575 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:31:00.610 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:31:00.622 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:31:01.267 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:31:01.696 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:31:01.860 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:31:01.861 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:31:01.863 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:31:01.863 +05:30 [INF] Hosting environment: Development
2025-07-05 11:31:01.864 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:31:01.930 +05:30 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:31:01.947 +05:30 [INF] Executed DbCommand (42ms) [Parameters=[@__cutoff_0='2025-06-28T06:01:00.7099552Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:31:04.193 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:31:04.368 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 184.2182ms
2025-07-05 11:31:04.378 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:31:04.388 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 9.6765ms
2025-07-05 11:31:04.475 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:31:04.506 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.4101ms
2025-07-05 11:31:04.629 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:31:04.809 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 179.5652ms
2025-07-05 11:31:13.791 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:31:13.796 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:31:13.832 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:31:13.843 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:31:13.858 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNkI0RkEyNUUwQTI3ODNDM0Q1OUNEMUQwOUVDNkE0QjAA","timestamp":"1751695276","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:31:13.861 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:31:13.866 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:31:13.876 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 27.705ms
2025-07-05 11:31:13.877 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:31:13.879 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 88.1439ms
2025-07-05 11:31:13.957 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNkI0RkEyNUUwQTI3ODNDM0Q1OUNEMUQwOUVDNkE0QjAA","timestamp":"1751695276","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:31:13.959 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:31:14.056 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:31:14.149 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:31:14.161 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:31:14.194 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:31:14.203 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:31:14.335 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='dd67bf39-0894-4553-820b-06fc41dc3e55', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:01:14.2080034Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:01:14.2080517Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:31:22.451 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:31:27.810 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:31:27.814 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:31:27.828 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:31:39.436 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:31:42.952 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:33:30.045 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:33:30.091 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:33:30.107 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:33:30.856 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:33:31.368 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:33:31.588 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:33:31.590 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:33:31.591 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:33:31.592 +05:30 [INF] Hosting environment: Development
2025-07-05 11:33:31.593 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:33:31.643 +05:30 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:33:31.660 +05:30 [INF] Executed DbCommand (35ms) [Parameters=[@__cutoff_0='2025-06-28T06:03:30.2084049Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:33:33.900 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:33:34.056 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 163.4358ms
2025-07-05 11:33:34.082 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:33:34.095 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 13.6719ms
2025-07-05 11:33:34.150 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:33:34.181 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.4923ms
2025-07-05 11:33:34.318 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:33:34.500 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 182.2912ms
2025-07-05 11:33:42.324 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:33:42.329 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:33:42.368 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:33:42.382 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:33:42.397 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQjIxMjkxNkI3QTQzRTgzNEEwOTM3Qzc1MzhENjlCMjMA","timestamp":"1751695424","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:33:42.399 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:33:42.404 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:33:42.415 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 28.167ms
2025-07-05 11:33:42.416 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:33:42.418 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 93.7777ms
2025-07-05 11:33:42.495 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQjIxMjkxNkI3QTQzRTgzNEEwOTM3Qzc1MzhENjlCMjMA","timestamp":"1751695424","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:33:42.497 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:33:42.599 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:33:42.690 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:33:42.700 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:33:42.732 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:33:42.739 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:33:42.889 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='7a56f9ed-da27-44b1-b81f-20afa0b5ab4e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:03:42.7426151Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:03:42.7426386Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:33:49.140 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:33:50.290 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:33:50.295 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:33:50.311 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:34:22.675 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:34:26.423 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:36:14.058 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 11:36:14.059 +05:30 [INF] ✅ End node reached.
2025-07-05 11:36:14.060 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:36:26.978 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:36:26.986 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:36:26.987 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:36:26.990 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzFBOEZGMUZBRkIzMkI1MDAyRjU4NzBEMUNEOEEzMDEA","timestamp":"1751695589","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:36:26.991 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:36:26.992 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:36:26.993 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzFBOEZGMUZBRkIzMkI1MDAyRjU4NzBEMUNEOEEzMDEA","timestamp":"1751695589","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:36:26.993 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6902ms
2025-07-05 11:36:26.994 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:36:26.995 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:36:26.996 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.8734ms
2025-07-05 11:36:26.999 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:36:27.002 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:36:27.004 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:36:27.006 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:36:27.009 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:36:27.031 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='98a2b68f-ff65-4542-b434-8ddd53c84774', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:06:27.0106752Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:06:27.0106753Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:36:33.063 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:36:37.480 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:36:40.249 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:36:43.047 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:36:45.087 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:36:45.088 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:36:45.122 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 11:36:45.123 +05:30 [INF] ✅ End node reached.
2025-07-05 11:36:51.638 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:37:08.040 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:37:08.044 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:37:08.045 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:37:08.048 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggN0QzMDM3NTg3REU4RkJDRjhGRDAyNjZBRDI1ODI4RTcA","timestamp":"1751695630","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:37:08.049 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:37:08.049 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:37:08.050 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.7902ms
2025-07-05 11:37:08.051 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:37:08.052 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.0825ms
2025-07-05 11:37:08.053 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggN0QzMDM3NTg3REU4RkJDRjhGRDAyNjZBRDI1ODI4RTcA","timestamp":"1751695630","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:37:08.055 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:37:08.060 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:37:08.062 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:37:08.064 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:37:08.066 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:37:08.068 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:37:08.088 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='f8da92c5-d520-4c7c-998e-a4c2c0b0a91f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:07:08.0695751Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:07:08.0695752Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:37:14.189 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:37:16.576 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:37:16.578 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:37:16.591 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:37:26.349 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:37:30.137 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:38:37.549 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:38:37.589 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:38:37.602 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:38:38.397 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:38:38.997 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:38:39.247 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:38:39.248 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:38:39.250 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:38:39.251 +05:30 [INF] Hosting environment: Development
2025-07-05 11:38:39.252 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:38:39.285 +05:30 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:38:39.305 +05:30 [INF] Executed DbCommand (44ms) [Parameters=[@__cutoff_0='2025-06-28T06:08:37.6971613Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:38:41.226 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:38:41.390 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 171.3574ms
2025-07-05 11:38:41.407 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:38:41.417 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 9.9037ms
2025-07-05 11:38:41.471 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:38:41.502 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.3966ms
2025-07-05 11:38:41.639 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:38:41.824 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 184.7295ms
2025-07-05 11:38:46.249 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:38:46.255 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:38:46.288 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:38:46.299 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:38:46.313 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNzgxMUU0QUFDNzA4MEI4ODE5RUFCQTg3MzRDNjBEQzcA","timestamp":"1751695728","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:38:46.316 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:38:46.321 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:38:46.330 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 26.656ms
2025-07-05 11:38:46.331 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:38:46.333 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 83.2163ms
2025-07-05 11:38:46.413 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNzgxMUU0QUFDNzA4MEI4ODE5RUFCQTg3MzRDNjBEQzcA","timestamp":"1751695728","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:38:46.414 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:38:46.512 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:38:46.607 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:38:46.618 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:38:46.649 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:38:46.656 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:38:46.793 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='e60a88bf-fdb5-4f7f-ae68-84335a3436b2', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:08:46.6589411Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:08:46.6589807Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:38:52.251 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:38:52.912 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:38:52.917 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:38:52.929 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:38:58.417 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:38:59.874 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:39:20.469 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:39:20.473 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:39:20.486 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:39:30.680 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:39:46.211 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:39:46.212 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:39:47.242 +05:30 [INF] Received HTTP response headers after 1026.3481ms - 400
2025-07-05 11:39:47.244 +05:30 [INF] End processing HTTP request after 1034.1498ms - 400
2025-07-05 11:40:20.466 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 11:40:20.481 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:20.483 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 16.6093ms
2025-07-05 11:40:20.484 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 482
2025-07-05 11:40:20.489 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:20.498 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='92296dbe-2dfc-46bc-9b8a-11d0b669b35b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:10:20.4799111Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AYdiUo-XTmsWSkYaRr88cpI\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T06:10:20.4799112Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:40:20.503 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 11:40:20.506 +05:30 [INF] ✅ End node reached.
2025-07-05 11:40:20.507 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:40:20.546 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:20.571 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:20 AM'.
2025-07-05 11:40:20.575 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 11:40:20.600 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 11:40:20.611 +05:30 [ERR] Response has already started, unable to write error response for path: /api/whatsappsettings/test-connection
2025-07-05 11:40:20.612 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 401 null application/json 128.2626ms
2025-07-05 11:40:20.616 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 11:40:20.618 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:20.619 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 3.0243ms
2025-07-05 11:40:20.620 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 11:40:20.624 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:20.626 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:20 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:20.628 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:20 AM'.
2025-07-05 11:40:20.629 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 9.2656ms
2025-07-05 11:40:20.632 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 11:40:21.314 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:40:21.318 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:21 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:21.321 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:21 AM'.
2025-07-05 11:40:21.323 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 11:40:21.346 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 11:40:21.350 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 11:40:21.351 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 37.6582ms
2025-07-05 11:40:27.315 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 11:40:27.318 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:27.318 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.5053ms
2025-07-05 11:40:27.320 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 11:40:27.323 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:27.325 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:27.326 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
2025-07-05 11:40:27.327 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:27.332 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:40:27.346 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 11:40:27.362 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 11:40:27.400 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 11:40:27.430 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 11:40:27.445 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 11:40:27.511 +05:30 [INF] Executed DbCommand (39ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 11:40:27.528 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 11:40:27.587 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 252.9382ms
2025-07-05 11:40:27.589 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:27.639 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 11:40:27.644 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-05 11:40:27.648 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 328.1397ms
2025-07-05 11:40:27.648 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 11:40:27.652 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:27.652 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 4.3684ms
2025-07-05 11:40:27.653 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 11:40:27.656 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:27.657 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:27.659 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
2025-07-05 11:40:27.660 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.3397ms
2025-07-05 11:40:27.662 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 11:40:27.833 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:40:27.836 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 11:40:27.838 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 06:02:16 AM', Current time (UTC): '05-07-2025 06:10:27 AM'.
2025-07-05 11:40:27.841 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 11:40:27.861 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 11:40:27.866 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 11:40:27.867 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 34.996ms
2025-07-05 11:40:40.559 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 11:40:40.561 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:40.562 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 2.7124ms
2025-07-05 11:40:40.563 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 11:40:40.566 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:40.566 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:40.567 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:40:40.571 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 11:40:40.575 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 11:40:40.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 11:40:40.581 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 11:40:40.584 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 11:40:40.588 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 11:40:40.590 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 11:40:40.591 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 11:40:40.593 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:40.602 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 33.6769ms
2025-07-05 11:40:40.603 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:40.605 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 41.2539ms
2025-07-05 11:40:40.611 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:40:40.622 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:40:40.624 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:40:40.631 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:40.633 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 7.6732ms
2025-07-05 11:40:40.634 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:40:40.635 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 23.6192ms
2025-07-05 11:40:40.641 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 11:40:40.644 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:40:40.647 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 11:40:40.658 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:40:40.662 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 11:40:40.668 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 11:40:40.681 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 11:40:40.682 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 11:40:40.682 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 11:40:40.683 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 11:40:40.684 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 11:40:40.684 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 11:40:40.685 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 11:40:40.685 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 11:40:40.686 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 11:40:40.687 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 11:40:40.687 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 11:40:40.688 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 11:40:40.692 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 11:40:40.698 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 49.3664ms
2025-07-05 11:40:40.699 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:40:40.700 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 58.0942ms
2025-07-05 11:40:44.086 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 11:40:44.089 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:44.090 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:44.090 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:40:44.092 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 11:40:44.095 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 11:40:44.099 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 11:40:44.103 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 11:40:44.106 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 11:40:44.109 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 11:40:44.110 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 11:40:44.111 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 11:40:44.112 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:44.113 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 21.5543ms
2025-07-05 11:40:44.114 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:40:44.115 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 29.5097ms
2025-07-05 11:40:44.436 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:40:44.439 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:40:44.440 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:40:44.441 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:44.443 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.6149ms
2025-07-05 11:40:44.444 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:40:44.444 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 8.2631ms
2025-07-05 11:40:44.696 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 11:40:44.699 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:40:44.700 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 11:40:44.704 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:40:44.707 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 11:40:44.710 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 11:40:44.712 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 11:40:44.712 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 11:40:44.713 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 11:40:44.713 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 11:40:44.714 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 11:40:44.714 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 11:40:44.715 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 11:40:44.715 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 11:40:44.716 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 11:40:44.717 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 11:40:44.717 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 11:40:44.718 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 11:40:44.719 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 11:40:44.720 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.2355ms
2025-07-05 11:40:44.721 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:40:44.721 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 25.4254ms
2025-07-05 11:40:44.980 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 11:40:44.983 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:44.985 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 11:40:44.988 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:40:44.997 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 11:40:45.001 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 11:40:45.008 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 17.8732ms
2025-07-05 11:40:45.009 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 11:40:45.009 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 29.1714ms
2025-07-05 11:40:46.994 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 11:40:46.996 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:46.997 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 2.9078ms
2025-07-05 11:40:46.999 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 482
2025-07-05 11:40:47.002 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:47.003 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 11:40:47.006 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:40:48.032 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:48.034 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1026.71ms
2025-07-05 11:40:48.036 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 11:40:48.036 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1037.3422ms
2025-07-05 11:40:50.136 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 11:40:50.138 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:50.139 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 2.8719ms
2025-07-05 11:40:50.140 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 482
2025-07-05 11:40:50.143 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:40:50.144 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 11:40:50.148 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:40:50.152 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 11:40:50.153 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 11:40:50.158 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 11:40:50.169 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='36de2595-f729-4b07-9958-11c8a56db12f', @p0='2025-07-05T06:10:50.1626413Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "UpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 11:40:50.171 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 11:40:50.172 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:40:50.173 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 24.1076ms
2025-07-05 11:40:50.174 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 11:40:50.175 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 34.7933ms
2025-07-05 11:41:08.528 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:41:08.532 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:41:08.533 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:41:08.534 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDlFOUY1MDAwN0JDNEQwOTVFMEY3RDI4MTQzRDAwMjkA","timestamp":"1751695870","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:41:08.536 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:41:08.536 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:41:08.537 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.4682ms
2025-07-05 11:41:08.537 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDlFOUY1MDAwN0JDNEQwOTVFMEY3RDI4MTQzRDAwMjkA","timestamp":"1751695870","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:41:08.538 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:41:08.539 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:41:08.540 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.6411ms
2025-07-05 11:41:08.543 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:41:08.545 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:08.548 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:08.550 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:08.552 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:41:08.558 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='db45f27b-479d-4c42-bdf4-40674820fb19', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:11:08.5532344Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:11:08.5532344Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:41:10.583 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:41:10.585 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:10.587 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:10.589 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:10.590 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:41:10.591 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:41:11.686 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:11.689 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:11.690 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:11.692 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:41:11.692 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:41:12.733 +05:30 [INF] Received HTTP response headers after 1040.0288ms - 400
2025-07-05 11:41:12.734 +05:30 [INF] End processing HTTP request after 1042.4142ms - 400
2025-07-05 11:41:12.740 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0beea3ef-3113-40f1-951b-583fc1a1db78', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:11:12.7366657Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AULMUn_77zhtZwFBFqPW-sK\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T06:11:12.7366659Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:41:12.742 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 11:41:12.743 +05:30 [INF] ✅ End node reached.
2025-07-05 11:41:12.743 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:41:32.267 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 11:41:32.270 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:41:32.270 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:41:32.273 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggM0NBRjJEQ0ZFODhEMDVDNDg0NzYwMUJCNDk5Qjk1ODYA","timestamp":"1751695894","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:41:32.274 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:41:32.275 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:41:32.276 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.1284ms
2025-07-05 11:41:32.277 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:41:32.278 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.1963ms
2025-07-05 11:41:32.280 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggM0NBRjJEQ0ZFODhEMDVDNDg0NzYwMUJCNDk5Qjk1ODYA","timestamp":"1751695894","text":{"body":"Hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:41:32.282 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:41:32.287 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:41:32.289 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:32.291 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:32.292 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:32.294 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:41:32.298 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='e9192086-7004-4ffa-9e40-ddded23e2d46', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:11:32.2962937Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:11:32.2962938Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:41:33.700 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:41:33.702 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:33.705 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:33.706 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:33.707 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 11:41:33.708 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 11:41:38.317 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 11:41:38.321 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:41:38.322 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 11:41:38.324 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:41:38.324 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:41:39.087 +05:30 [INF] Received HTTP response headers after 761.9178ms - 400
2025-07-05 11:41:39.088 +05:30 [INF] End processing HTTP request after 764.922ms - 400
2025-07-05 11:41:39.104 +05:30 [INF] Executed DbCommand (13ms) [Parameters=[@p0='2d2a7103-9c53-478a-8eda-5f3c88b9639a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:11:39.0911410Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AdH-k-aQRZr6yx1UHkV1kYY\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T06:11:39.0911411Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:41:39.107 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 11:41:39.108 +05:30 [INF] ✅ End node reached.
2025-07-05 11:41:39.108 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:42:33.122 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 11:42:33.124 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 11:42:33.125 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:42:33.128 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:42:33.129 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:42:33.130 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:42:33.134 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 11:42:33.134 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 11:42:33.141 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 11:42:33.169 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 11:42:33.172 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 11:42:33.179 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:42:33.188 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 52.1024ms
2025-07-05 11:42:33.189 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:42:33.190 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 66.2606ms
2025-07-05 11:42:33.217 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 11:42:33.243 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:42:33.251 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 113.5939ms
2025-07-05 11:42:33.252 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:42:33.253 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 131.6166ms
2025-07-05 11:42:37.170 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 11:42:37.173 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:42:37.174 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 3.9737ms
2025-07-05 11:42:37.175 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-05 11:42:37.180 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:42:37.181 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:42:37.185 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 11:42:39.336 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 11:42:39.340 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:42:39.347 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 11:42:39.348 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:42:39.349 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:42:40.269 +05:30 [INF] Received HTTP response headers after 918.3581ms - 400
2025-07-05 11:42:40.270 +05:30 [INF] End processing HTTP request after 921.4959ms - 400
2025-07-05 11:42:40.275 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='d5abd7e0-300f-49b1-babf-fcfb528c5ea9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T06:12:40.2727673Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='sfasfas' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AWJ9784IBzGEr3kvQ-Pk2Mh\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='sfasfas', @p16='2025-07-05T06:12:40.2727674Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:42:40.278 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:42:40.281 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3094.8881ms
2025-07-05 11:42:40.283 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:42:40.284 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3108.4869ms
2025-07-05 11:43:17.534 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 11:43:17.537 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:43:17.537 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 3.7492ms
2025-07-05 11:43:17.539 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-05 11:43:17.542 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:43:17.543 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:43:17.544 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 11:43:28.223 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 11:43:28.226 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:43:28.240 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 11:43:54.206 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:43:54.207 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:43:56.270 +05:30 [INF] Received HTTP response headers after 2062.0126ms - 400
2025-07-05 11:43:56.271 +05:30 [INF] End processing HTTP request after 2065.2266ms - 400
2025-07-05 11:44:46.397 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:44:46.447 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:44:46.463 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:44:47.316 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:44:47.808 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:44:47.970 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:44:47.971 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:44:47.972 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:44:47.973 +05:30 [INF] Hosting environment: Development
2025-07-05 11:44:47.974 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:44:48.066 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:44:48.086 +05:30 [INF] Executed DbCommand (40ms) [Parameters=[@__cutoff_0='2025-06-28T06:14:46.6158265Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:44:50.074 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:44:50.239 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 172.0083ms
2025-07-05 11:44:50.256 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:44:50.264 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.3492ms
2025-07-05 11:44:50.345 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:44:50.392 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 47.2502ms
2025-07-05 11:44:50.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:44:50.779 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 216.9863ms
2025-07-05 11:45:04.545 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:45:04.551 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:45:04.715 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:45:04.725 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:45:04.780 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:04.791 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 61.1673ms
2025-07-05 11:45:04.793 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:45:04.795 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 250.8437ms
2025-07-05 11:45:04.802 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 11:45:04.811 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:45:04.816 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 11:45:04.881 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:45:04.989 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 11:45:04.999 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 11:45:05.015 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 11:45:05.016 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 11:45:05.016 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 11:45:05.017 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 11:45:05.018 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 11:45:05.018 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 11:45:05.019 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 11:45:05.020 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 11:45:05.020 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 11:45:05.021 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 11:45:05.022 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 11:45:05.022 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 11:45:05.028 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 11:45:05.035 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 217.2888ms
2025-07-05 11:45:05.036 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:45:05.040 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 238.2449ms
2025-07-05 11:45:14.743 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 11:45:14.748 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:14.750 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 7.3009ms
2025-07-05 11:45:14.753 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 11:45:14.755 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:14.758 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:45:14.765 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:45:14.789 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 11:45:14.826 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 11:45:14.865 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 11:45:14.879 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 11:45:14.895 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 11:45:14.966 +05:30 [INF] Executed DbCommand (39ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 11:45:14.985 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 11:45:14.991 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 11:45:14.993 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:15.002 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 236.2915ms
2025-07-05 11:45:15.004 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:45:15.005 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 252.2811ms
2025-07-05 11:45:15.011 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:45:15.015 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:45:15.016 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:45:15.022 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:15.024 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 6.5335ms
2025-07-05 11:45:15.025 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:45:15.026 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 14.6231ms
2025-07-05 11:45:15.335 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 11:45:15.339 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:45:15.340 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 11:45:15.346 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:45:15.350 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 11:45:15.352 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 11:45:15.354 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 11:45:15.355 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 11:45:15.355 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 11:45:15.356 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 11:45:15.356 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 11:45:15.357 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 11:45:15.358 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 11:45:15.358 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 11:45:15.359 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 11:45:15.359 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 11:45:15.360 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 11:45:15.360 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 11:45:15.362 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 11:45:15.363 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 21.5004ms
2025-07-05 11:45:15.364 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:45:15.365 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 30.4326ms
2025-07-05 11:45:25.963 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 11:45:25.966 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:25.968 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 11:45:25.973 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:45:25.988 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 11:45:26.009 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 11:45:26.016 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 41.354ms
2025-07-05 11:45:26.017 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 11:45:26.018 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 55.1895ms
2025-07-05 11:45:31.390 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 11:45:31.393 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:31.394 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 4.653ms
2025-07-05 11:45:31.396 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 477
2025-07-05 11:45:31.400 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:31.401 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 11:45:31.404 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:45:31.412 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 11:45:31.413 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 11:45:31.419 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 11:45:31.479 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BPCc2oMuvAJFdlIbRZBIkTQWPIvpGktFb8gMix4kmxQNLRUxQQZBPWKgyzP49HlEmZCV1EAxERuZCI8LyZA6UkEb8eF0Hfc5s8wqkViqJFMSGMFWirBjAHFJSZAcibLsbUlDJZBklJhf0zRTfBzZCkTXj75oLHNwLSO1ZBZAENp84iMX06ZBEIwDcZBO5TG9r8xk1INzn9rRtvKCTVCrvdYQ8q1LIFZCl8cZAQHCEE5qf2UCnSZAqTSnDKvCEgkZD' (Nullable = false), @p1='2025-07-05T06:15:31.4237088Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-05 11:45:31.490 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 11:45:31.491 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:31.493 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 87.4581ms
2025-07-05 11:45:31.494 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 11:45:31.495 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 99.8436ms
2025-07-05 11:45:32.244 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 11:45:32.247 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:32.247 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.3148ms
2025-07-05 11:45:32.249 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 477
2025-07-05 11:45:32.253 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:32.254 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 11:45:32.258 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 11:45:34.022 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:34.024 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1763.9154ms
2025-07-05 11:45:34.025 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 11:45:34.026 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1777.6472ms
2025-07-05 11:45:38.610 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 11:45:38.610 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 11:45:38.613 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:38.616 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:38.617 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:45:38.617 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:45:38.623 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 11:45:38.623 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 11:45:38.631 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 11:45:38.650 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 11:45:38.654 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:38.657 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 11:45:38.665 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 39.8594ms
2025-07-05 11:45:38.666 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:45:38.667 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 57.4128ms
2025-07-05 11:45:38.696 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 11:45:38.748 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:45:38.756 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 129.6113ms
2025-07-05 11:45:38.757 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:45:38.758 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 148.4059ms
2025-07-05 11:45:42.585 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 11:45:42.588 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:42.589 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 4.0854ms
2025-07-05 11:45:42.590 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 61
2025-07-05 11:45:42.595 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:45:42.597 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:45:42.600 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 11:45:44.517 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 11:45:44.525 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:45:44.529 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 11:45:44.618 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:45:44.624 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:45:44.626 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:45:46.180 +05:30 [INF] Received HTTP response headers after 1550.925ms - 200
2025-07-05 11:45:46.182 +05:30 [INF] End processing HTTP request after 1558.5926ms - 200
2025-07-05 11:45:46.347 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='190f99d0-7640-4118-bf3d-996db32356dd', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T06:15:46.2758681Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='zsfsfsdgf' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='zsfsfsdgf', @p16='2025-07-05T06:15:46.2759030Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:45:46.351 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:45:46.355 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3753.6577ms
2025-07-05 11:45:46.356 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:45:46.357 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3767.1339ms
2025-07-05 11:45:47.479 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 11:45:47.482 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:45:47.484 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:45:47.489 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==","status":"failed","timestamp":"1751696149","recipient_id":"917082156227","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 11:45:47.493 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:45:47.494 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:45:47.495 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 10.1536ms
2025-07-05 11:45:47.497 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:45:47.498 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.0065ms
2025-07-05 11:45:47.579 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==","status":"failed","timestamp":"1751696149","recipient_id":"917082156227","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 11:45:47.580 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 11:45:47.581 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==","status":"failed","timestamp":"1751696149","recipient_id":"917082156227","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 11:45:47.596 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 11:45:47.599 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==
2025-07-05 11:45:47.600 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRjk3MTRCMzE1REI3NDE1NkE1AA==
2025-07-05 11:46:41.220 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-05 11:46:41.223 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:46:41.224 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:46:41.226 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkNCRkI0NTREQUI3RTcxMTNGMkU1NkYyM0IxNkMzRDgA","timestamp":"1751696203","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:46:41.228 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:46:41.228 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:46:41.229 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkNCRkI0NTREQUI3RTcxMTNGMkU1NkYyM0IxNkMzRDgA","timestamp":"1751696203","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 11:46:41.230 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0418ms
2025-07-05 11:46:41.234 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 11:46:41.235 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:46:41.237 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.141ms
2025-07-05 11:46:41.246 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 11:46:41.248 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 11:46:41.250 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:46:41.252 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 11:46:41.258 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 11:46:41.282 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='8ae4eec4-a488-409b-b148-116a5d7bff18', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T06:16:41.2598636Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:16:41.2598637Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:46:47.621 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 11:46:47.632 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 11:46:47.635 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:46:47.636 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 11:46:47.672 +05:30 [INF] ➡️ Running node: "Message" | node-1
2025-07-05 11:46:47.673 +05:30 [INF] 📤 Sending message: 
2025-07-05 11:46:49.785 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 11:46:49.789 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:46:49.791 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 11:46:49.792 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:46:49.793 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:46:50.672 +05:30 [INF] Received HTTP response headers after 877.8156ms - 400
2025-07-05 11:46:50.673 +05:30 [INF] End processing HTTP request after 880.9216ms - 400
2025-07-05 11:46:50.682 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='d94a9958-9c5d-4c0e-8ac2-a0ccef6cd922', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T06:16:50.6760551Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) The parameter text['body'] is required.\",\"type\":\"OAuthException\",\"code\":100,\"fbtrace_id\":\"AscrVo6BSMLlC6_y4_0d6m-\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T06:16:50.6760553Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:46:50.685 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 11:54:13.346 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:54:13.409 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:54:13.428 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:54:14.213 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:54:14.742 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:54:14.909 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:54:14.911 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:54:14.912 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:54:14.913 +05:30 [INF] Hosting environment: Development
2025-07-05 11:54:14.913 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:54:14.972 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:54:14.989 +05:30 [INF] Executed DbCommand (38ms) [Parameters=[@__cutoff_0='2025-06-28T06:24:13.5439997Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:54:17.179 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:54:17.327 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 155.7286ms
2025-07-05 11:54:17.352 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:54:17.359 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.1558ms
2025-07-05 11:54:17.409 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:54:17.441 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.4209ms
2025-07-05 11:54:17.596 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:54:17.788 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 192.2021ms
2025-07-05 11:54:29.865 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 11:54:29.870 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:54:29.908 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:54:29.918 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:54:29.933 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"sent","timestamp":"1751518938","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","expiration_timestamp":"1751518938","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:54:29.935 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:54:29.940 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:54:29.950 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 27.4371ms
2025-07-05 11:54:29.951 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:54:29.953 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 87.6891ms
2025-07-05 11:54:30.038 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"sent","timestamp":"1751518938","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","expiration_timestamp":"1751518938","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:54:30.040 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 11:54:30.041 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==","status":"sent","timestamp":"1751518938","recipient_id":"917082156227","conversation":{"id":"bd9d7d1ed1c1145f673c590705b51577","expiration_timestamp":"1751518938","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:54:30.103 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 11:54:30.107 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==
2025-07-05 11:54:30.108 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjBDMUQ3RTBGNDBGRDQxRDBGAA==
2025-07-05 11:54:45.422 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 11:54:45.482 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 11:54:45.499 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 11:54:46.371 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 11:54:46.861 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 11:54:47.004 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 11:54:47.006 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 11:54:47.007 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 11:54:47.007 +05:30 [INF] Hosting environment: Development
2025-07-05 11:54:47.008 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 11:54:47.071 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 11:54:47.086 +05:30 [INF] Executed DbCommand (35ms) [Parameters=[@__cutoff_0='2025-06-28T06:24:45.6452299Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 11:54:49.317 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 11:54:49.484 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 175.018ms
2025-07-05 11:54:49.505 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 11:54:49.514 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.7378ms
2025-07-05 11:54:49.581 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 11:54:49.616 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 34.7713ms
2025-07-05 11:54:49.765 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 11:54:49.936 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 170.8491ms
2025-07-05 11:54:59.031 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 11:54:59.037 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 11:54:59.039 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:54:59.041 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 9.1391ms
2025-07-05 11:54:59.042 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 11:54:59.052 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:54:59.145 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:54:59.158 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:54:59.223 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 11:54:59.290 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 11:54:59.383 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 11:54:59.453 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 11:54:59.469 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 11:54:59.538 +05:30 [INF] Executed DbCommand (41ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 11:54:59.556 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 11:54:59.564 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 11:54:59.574 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:54:59.591 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 427.8495ms
2025-07-05 11:54:59.593 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 11:54:59.597 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 554.7989ms
2025-07-05 11:54:59.918 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 11:54:59.925 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:54:59.927 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 11:54:59.932 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:54:59.935 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 5.6189ms
2025-07-05 11:54:59.936 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 11:54:59.937 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 18.8953ms
2025-07-05 11:55:00.168 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 11:55:00.174 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:55:00.177 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 11:55:00.194 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:55:00.198 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 11:55:00.207 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 11:55:00.223 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 11:55:00.224 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 11:55:00.224 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 11:55:00.225 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 11:55:00.226 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 11:55:00.226 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 11:55:00.227 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 11:55:00.227 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 11:55:00.228 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 11:55:00.229 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 11:55:00.229 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 11:55:00.230 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 11:55:00.234 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 11:55:00.240 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 61.5302ms
2025-07-05 11:55:00.241 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 11:55:00.242 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 74.4634ms
2025-07-05 11:55:00.488 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 11:55:00.488 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 11:55:00.490 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:55:00.493 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:55:00.494 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:55:00.494 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:55:00.500 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 11:55:00.500 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 11:55:00.508 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 11:55:00.526 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 11:55:00.530 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:55:00.533 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 11:55:00.549 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 47.2718ms
2025-07-05 11:55:00.550 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 11:55:00.551 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 63.3239ms
2025-07-05 11:55:00.580 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 11:55:00.640 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:55:00.648 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 145.1949ms
2025-07-05 11:55:00.650 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 11:55:00.651 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 162.8359ms
2025-07-05 11:55:04.950 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 11:55:04.953 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:55:04.954 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 3.9294ms
2025-07-05 11:55:04.956 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 58
2025-07-05 11:55:04.960 +05:30 [INF] CORS policy execution successful.
2025-07-05 11:55:04.962 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:55:04.965 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 11:55:07.426 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 11:55:07.434 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 11:55:07.438 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 11:55:07.517 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 11:55:07.535 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:55:07.537 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 11:55:09.229 +05:30 [INF] Received HTTP response headers after 1688.4713ms - 200
2025-07-05 11:55:09.230 +05:30 [INF] End processing HTTP request after 1695.6959ms - 200
2025-07-05 11:55:09.416 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='82cf2040-855d-4b95-b4a1-3717b68b8be0', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T06:25:09.2894671Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='sfsdfg' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='sfsdfg', @p16='2025-07-05T06:25:09.2895148Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 11:55:09.428 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 11:55:09.431 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 4464.024ms
2025-07-05 11:55:09.433 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 11:55:09.433 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 4477.953ms
2025-07-05 11:55:10.477 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 11:55:10.480 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:55:10.483 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:55:10.489 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"sent","timestamp":"1751696712","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","expiration_timestamp":"1751696712","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:10.493 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:55:10.494 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:55:10.495 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 11.0586ms
2025-07-05 11:55:10.497 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:55:10.497 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.4766ms
2025-07-05 11:55:10.586 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"sent","timestamp":"1751696712","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","expiration_timestamp":"1751696712","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:10.588 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 11:55:10.590 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"sent","timestamp":"1751696712","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","expiration_timestamp":"1751696712","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:10.602 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 11:55:10.604 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==
2025-07-05 11:55:10.606 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==
2025-07-05 11:55:11.925 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 11:55:11.930 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:55:11.931 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 11:55:11.934 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"delivered","timestamp":"1751696714","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:11.936 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 11:55:11.936 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 11:55:11.937 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"delivered","timestamp":"1751696714","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:11.938 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8598ms
2025-07-05 11:55:11.940 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 11:55:11.941 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 11:55:11.941 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==","status":"delivered","timestamp":"1751696714","recipient_id":"917082156227","conversation":{"id":"1bfb1fb4e00917c1a55cf89f8dc907cc","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 11:55:11.942 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.6011ms
2025-07-05 11:55:11.947 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 11:55:11.949 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==
2025-07-05 11:55:11.950 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0IzNzkwRDBFNjIxOUM0Rjg1AA==
2025-07-05 12:00:09.098 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 12:00:09.134 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 12:00:09.146 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 12:00:09.968 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 12:00:10.450 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 12:00:10.609 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 12:00:10.611 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 12:00:10.613 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 12:00:10.614 +05:30 [INF] Hosting environment: Development
2025-07-05 12:00:10.616 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 12:00:10.689 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 12:00:10.706 +05:30 [INF] Executed DbCommand (36ms) [Parameters=[@__cutoff_0='2025-06-28T06:30:09.2358384Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 12:00:12.854 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 12:00:13.009 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 164.0309ms
2025-07-05 12:00:13.031 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 12:00:13.039 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.3103ms
2025-07-05 12:00:13.092 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 12:00:13.122 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.567ms
2025-07-05 12:00:13.272 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 12:00:13.460 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 187.6645ms
2025-07-05 12:00:31.484 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 12:00:31.488 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 12:00:31.532 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:00:31.542 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:00:31.556 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRDIwMjIzMTgzMDVCQzQyMjczNThDMTU2ODM3NjNGMDkA","timestamp":"1751697033","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:00:31.559 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:00:31.562 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:00:31.571 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 25.377ms
2025-07-05 12:00:31.572 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:00:31.602 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 117.7095ms
2025-07-05 12:00:31.671 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRDIwMjIzMTgzMDVCQzQyMjczNThDMTU2ODM3NjNGMDkA","timestamp":"1751697033","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:00:31.672 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:00:31.771 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:00:31.861 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:00:31.872 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:00:31.902 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:00:31.909 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:00:32.055 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='b26a544c-4f54-4067-9bf4-834d2fd62084', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:30:31.9118048Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:30:31.9118356Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:00:38.461 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:00:39.805 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:00:39.810 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:00:39.822 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:00:53.061 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 12:01:01.072 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 12:03:39.471 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 12:03:39.505 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 12:03:39.517 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 12:03:40.159 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 12:03:40.650 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 12:03:40.820 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 12:03:40.821 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 12:03:40.822 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 12:03:40.824 +05:30 [INF] Hosting environment: Development
2025-07-05 12:03:40.825 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 12:03:40.899 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 12:03:40.917 +05:30 [INF] Executed DbCommand (41ms) [Parameters=[@__cutoff_0='2025-06-28T06:33:39.6037489Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 12:03:43.871 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 12:03:44.028 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 162.9816ms
2025-07-05 12:03:44.051 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 12:03:44.058 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.431ms
2025-07-05 12:03:44.108 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 12:03:44.137 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.9471ms
2025-07-05 12:03:44.276 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 12:03:44.443 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 167.6694ms
2025-07-05 12:04:07.840 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 12:04:07.880 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 12:04:07.916 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:04:07.926 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:04:07.941 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggOTNENThDRTlDODMzRDhDQzcxMENEOTY1MTc0M0M1OEMA","timestamp":"1751697250","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:04:07.943 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:04:07.948 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:04:07.956 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 26.2812ms
2025-07-05 12:04:07.958 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:04:07.963 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 123.3597ms
2025-07-05 12:04:08.039 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggOTNENThDRTlDODMzRDhDQzcxMENEOTY1MTc0M0M1OEMA","timestamp":"1751697250","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:04:08.041 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:04:08.135 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:04:08.226 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:04:08.236 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:04:08.265 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:04:08.272 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:04:08.395 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='3230af62-d0b2-4c2d-8da3-f1dca01f6e61', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:34:08.2742654Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:34:08.2742959Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:04:15.388 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:04:18.042 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:04:18.047 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:04:18.059 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:04:26.545 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 12:04:31.668 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 12:05:07.396 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:05:18.636 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:05:23.507 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:05:35.834 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 12:05:43.996 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:05:43.997 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:05:45.635 +05:30 [INF] Received HTTP response headers after 1634.9249ms - 200
2025-07-05 12:05:45.637 +05:30 [INF] End processing HTTP request after 1642.5397ms - 200
2025-07-05 12:09:59.508 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:09:59.508 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:09:59.514 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:09:59.518 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:09:59.511 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:09:59.517 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:09:59.523 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:09:59.527 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:09:59.530 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:09:59.536 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:09:59.542 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.542 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.545 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.545 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.548 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.551 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.554 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.557 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.560 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.563 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.565 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.566 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.567 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.568 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.570 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.571 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.572 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.574 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.596 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 17.6ms
2025-07-05 12:09:59.596 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 15.3884ms
2025-07-05 12:09:59.603 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.596 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 13.043ms
2025-07-05 12:09:59.604 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.596 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 10.2442ms
2025-07-05 12:09:59.640 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.596 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2629ms
2025-07-05 12:09:59.658 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.699 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.597 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8455ms
2025-07-05 12:09:59.600 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.9887ms
2025-07-05 12:09:59.725 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.604 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3419ms
2025-07-05 12:09:59.739 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.575 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.755 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.576 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:09:59.790 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 18.7472ms
2025-07-05 12:09:59.791 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.3348ms
2025-07-05 12:09:59.792 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.794 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:09:59.658 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.724 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.770 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.641 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.869 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 361.3754ms
2025-07-05 12:09:59.698 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.882 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 374.1319ms
2025-07-05 12:09:59.869 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 350.8451ms
2025-07-05 12:09:59.891 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 377.2374ms
2025-07-05 12:09:59.739 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.754 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.873 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 349.7672ms
2025-07-05 12:09:59.909 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 397.7347ms
2025-07-05 12:09:59.916 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 398.5734ms
2025-07-05 12:09:59.788 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.812 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.828 +05:30 [ERR] ❌ An unhandled exception occurred
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Unexpected end of request content.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1ContentLengthMessageBody.ReadAsyncInternal(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpRequestStream.ReadAsyncInternal(Memory`1 destination, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Text.Json.Serialization.ReadBufferState.ReadFromStreamAsync(Stream utf8Json, CancellationToken cancellationToken, Boolean fillBuffer)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsync(Stream utf8Json, CancellationToken cancellationToken)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.DeserializeAsObjectAsync(Stream utf8Json, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter.ReadRequestBodyAsync(InputFormatterContext context, Encoding encoding)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinder.BindModelAsync(ModelBindingContext bindingContext)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 12:09:59.932 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 404.8346ms
2025-07-05 12:09:59.937 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 407.25ms
2025-07-05 12:09:59.943 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 499 null application/json; charset=utf-8 407.8221ms
2025-07-05 12:09:59.876 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='96460f87-5950-446b-ace2-ea10eebb8569', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:39:59.8488223Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T06:39:59.8488229Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:09:59.957 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 12:09:59.958 +05:30 [INF] ✅ End node reached.
2025-07-05 12:09:59.959 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 12:10:09.322 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 479
2025-07-05 12:10:09.324 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:09.325 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:10:09.327 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQTMzRjNEOEREMzI5QjNDQzNCMTM4MDk1MjgzNjFFMEYA","timestamp":"1751697611","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:09.329 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:10:09.330 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:10:09.330 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQTMzRjNEOEREMzI5QjNDQzNCMTM4MDk1MjgzNjFFMEYA","timestamp":"1751697611","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:09.331 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.296ms
2025-07-05 12:10:09.332 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:10:09.333 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:09.334 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.4316ms
2025-07-05 12:10:09.336 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:10:09.339 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:09.341 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:09.343 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:09.345 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:10:09.367 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='4f62389a-e90f-4d56-9c76-4d4046c50f48', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:09.3643399Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:40:09.3643400Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:11.405 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:10:11.407 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:11.410 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:11.411 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:11.414 +05:30 [INF] ➡️ Running node: "Message" | node-1
2025-07-05 12:10:11.415 +05:30 [INF] 📤 Sending message: 
2025-07-05 12:10:11.416 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:11.418 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:11.420 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:11.957 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:11.958 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:12.740 +05:30 [INF] Received HTTP response headers after 781.7468ms - 400
2025-07-05 12:10:12.741 +05:30 [INF] End processing HTTP request after 784.7776ms - 400
2025-07-05 12:10:12.747 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0999c119-34fa-4a52-9c2c-ece30b013f10', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:12.7441464Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) The parameter text['body'] is required.\",\"type\":\"OAuthException\",\"code\":100,\"fbtrace_id\":\"ASl6kkFZUHiluluutAas_VT\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T06:40:12.7441465Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:12.749 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 12:10:24.505 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 12:10:24.508 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:24.508 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:10:24.510 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMEI3N0Q3QjBFRTBBN0JGMTEwQ0IxMTk4MURBMjZFQjEA","timestamp":"1751697626","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:24.512 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:10:24.512 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:10:24.513 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.3073ms
2025-07-05 12:10:24.514 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:24.515 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.0054ms
2025-07-05 12:10:24.516 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMEI3N0Q3QjBFRTBBN0JGMTEwQ0IxMTk4MURBMjZFQjEA","timestamp":"1751697626","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:24.518 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:10:24.523 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:10:24.525 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:24.527 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:24.529 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:24.530 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:10:24.552 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='af931dbe-ffb8-4a89-8553-d236bfad4e18', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:24.5320835Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:40:24.5320835Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:26.566 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:10:26.568 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:26.571 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:26.572 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:26.573 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 12:10:26.574 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 12:10:26.575 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:26.577 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:26.578 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:27.345 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:27.346 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:28.322 +05:30 [INF] Received HTTP response headers after 975.7335ms - 200
2025-07-05 12:10:28.323 +05:30 [INF] End processing HTTP request after 978.6946ms - 200
2025-07-05 12:10:28.328 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='0db9730e-4ede-4abd-861b-95cfeaa19ab9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:28.3259215Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T06:40:28.3259217Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:28.329 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 12:10:28.330 +05:30 [INF] ✅ End node reached.
2025-07-05 12:10:28.331 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 12:10:29.598 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:10:29.599 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:10:29.601 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:29.602 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:29.603 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:10:29.604 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:10:29.606 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"sent","timestamp":"1751697631","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","expiration_timestamp":"1751697631","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.607 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"read","timestamp":"1751697632","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.608 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:10:29.608 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"sent","timestamp":"1751697631","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","expiration_timestamp":"1751697631","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.609 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:10:29.609 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:10:29.610 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:10:29.611 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:10:29.612 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.3348ms
2025-07-05 12:10:29.613 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"sent","timestamp":"1751697631","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","expiration_timestamp":"1751697631","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.613 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.4303ms
2025-07-05 12:10:29.614 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:29.615 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:29.616 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.7511ms
2025-07-05 12:10:29.617 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.9817ms
2025-07-05 12:10:29.627 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:10:29.629 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==
2025-07-05 12:10:29.630 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==
2025-07-05 12:10:29.631 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"read","timestamp":"1751697632","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.632 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:10:29.632 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==","status":"read","timestamp":"1751697632","recipient_id":"918974005240","conversation":{"id":"9e85c6fcc89a6a172c264847039f760d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:10:29.635 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:10:29.636 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==
2025-07-05 12:10:29.637 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMjlFRDg2QzZFNTZFNEM4ODRFAA==
2025-07-05 12:10:38.908 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 479
2025-07-05 12:10:38.911 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:38.912 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:10:38.913 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzFDQTM4QTI3RTU0NUUwRkRCMTE0NjBGQjQzMTNDMDAA","timestamp":"1751697635","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:38.915 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:10:38.915 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggQzFDQTM4QTI3RTU0NUUwRkRCMTE0NjBGQjQzMTNDMDAA","timestamp":"1751697635","text":{"body":"hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:10:38.915 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:10:38.916 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:10:38.917 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4611ms
2025-07-05 12:10:38.920 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:10:38.920 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:10:38.921 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.6324ms
2025-07-05 12:10:38.922 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:38.926 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:38.928 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:38.930 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:10:38.952 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='ccccfbb5-1804-4810-ae6c-e38c4c6f778d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:38.9316928Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T06:40:38.9316928Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:41.096 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:10:41.098 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:41.100 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:41.102 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:41.103 +05:30 [INF] ➡️ Running node: "Message" | node-1
2025-07-05 12:10:41.103 +05:30 [INF] 📤 Sending message: 
2025-07-05 12:10:41.104 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 12:10:41.106 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:10:41.108 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 12:10:42.726 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 12:10:42.728 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:42.729 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:10:43.653 +05:30 [INF] Received HTTP response headers after 923.482ms - 400
2025-07-05 12:10:43.655 +05:30 [INF] End processing HTTP request after 927.0358ms - 400
2025-07-05 12:10:43.678 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='9ab92555-1de3-4117-b833-432bb591f4a8', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T06:40:43.6579640Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) The parameter text['body'] is required.\",\"type\":\"OAuthException\",\"code\":100,\"fbtrace_id\":\"AQsYomvbhloGTodDEx7mBuw\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T06:40:43.6579641Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:10:43.680 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 12:14:27.114 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:14:27.117 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:14:27.118 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:14:27.120 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"sent","timestamp":"1751697349","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","expiration_timestamp":"1751697349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:27.122 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:14:27.122 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"sent","timestamp":"1751697349","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","expiration_timestamp":"1751697349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:27.122 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:14:27.124 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:14:27.125 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1512ms
2025-07-05 12:14:27.126 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"sent","timestamp":"1751697349","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","expiration_timestamp":"1751697349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:27.130 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:14:27.132 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.2707ms
2025-07-05 12:14:27.257 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:14:27.259 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==
2025-07-05 12:14:27.260 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==
2025-07-05 12:14:51.593 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 12:14:51.595 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:14:51.596 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:14:51.598 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"read","timestamp":"1751697350","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:51.600 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:14:51.600 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"read","timestamp":"1751697350","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:51.601 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:14:51.602 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:14:51.603 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1141ms
2025-07-05 12:14:51.604 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==","status":"read","timestamp":"1751697350","recipient_id":"918974005240","conversation":{"id":"d73e92b0649fd258946feaf99976254d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:14:51.605 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:14:51.607 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.8626ms
2025-07-05 12:14:51.607 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:14:51.618 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==
2025-07-05 12:14:51.619 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSREEyMzQ5NjEzQUI3QUIyRjdDAA==
2025-07-05 12:52:23.783 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 12:52:23.787 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:52:23.788 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:52:23.790 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNUE4QURGM0Y1M0QxRUFDOERGNTM2NzkxRkVDNkVEN0QA","timestamp":"1751700146","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:52:23.791 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:52:23.791 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNUE4QURGM0Y1M0QxRUFDOERGNTM2NzkxRkVDNkVEN0QA","timestamp":"1751700146","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:52:23.792 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:52:23.793 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:52:23.794 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7079ms
2025-07-05 12:52:23.830 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:52:23.831 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 71.3263ms
2025-07-05 12:52:24.046 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:52:24.048 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 12:52:24.050 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:52:24.052 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 12:52:24.054 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:52:24.057 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='affde06c-9b58-42d5-a5ec-14c9f019c525', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:22:24.0554781Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:22:24.0554783Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:52:32.098 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 12:54:10.435 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 12:54:10.447 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:54:10.449 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 12:54:10.449 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 12:54:10.450 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 12:54:10.451 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 12:54:10.454 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:54:10.455 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 12:54:11.335 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 12:54:11.338 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:54:11.338 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 12:54:12.827 +05:30 [INF] Received HTTP response headers after 1487.0527ms - 200
2025-07-05 12:54:12.828 +05:30 [INF] End processing HTTP request after 1490.1438ms - 200
2025-07-05 12:54:12.832 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0bc65e09-07d9-43e7-9a38-42469f45ea4f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:24:12.8298390Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T07:24:12.8298390Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:54:12.833 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 12:54:12.834 +05:30 [INF] ✅ End node reached.
2025-07-05 12:54:12.835 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 12:54:13.899 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 12:54:13.902 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:13.902 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:54:13.904 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"sent","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","expiration_timestamp":"1751700256","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:13.905 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:54:13.906 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"sent","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","expiration_timestamp":"1751700256","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:13.906 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:54:13.907 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:54:13.908 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4609ms
2025-07-05 12:54:13.909 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"sent","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","expiration_timestamp":"1751700256","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:13.910 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:13.912 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.2632ms
2025-07-05 12:54:13.912 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:54:13.916 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==
2025-07-05 12:54:13.916 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==
2025-07-05 12:54:14.528 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 12:54:14.530 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:14.531 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:54:14.533 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"delivered","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:14.534 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:54:14.534 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"delivered","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:14.535 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:54:14.536 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 12:54:14.537 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2615ms
2025-07-05 12:54:14.537 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==","status":"delivered","timestamp":"1751700256","recipient_id":"917082156227","conversation":{"id":"24eae2945d4307d53e6779590a887f27","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 12:54:14.538 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:14.540 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.2272ms
2025-07-05 12:54:14.541 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 12:54:14.561 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==
2025-07-05 12:54:14.562 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0Q1NTFERTk3OUY5NDM1MEJGAA==
2025-07-05 12:54:41.243 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 12:54:41.246 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:41.247 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 12:54:41.248 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjE5MjdFQzFDMzQ4RTY1RUVGNzU0MjEzQTE4RjU2ODIA","timestamp":"1751700283","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:54:41.250 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 12:54:41.250 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjE5MjdFQzFDMzQ4RTY1RUVGNzU0MjEzQTE4RjU2ODIA","timestamp":"1751700283","text":{"body":"hello"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 12:54:41.251 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 12:54:41.252 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 12:54:41.253 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8009ms
2025-07-05 12:54:41.255 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 12:54:41.256 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 12:54:41.257 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.2033ms
2025-07-05 12:54:41.259 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 12:54:41.262 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 12:54:41.264 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 12:54:41.265 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 12:54:41.269 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='021750f5-da31-4772-b4c3-2ef7b00888f2', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:24:41.2674216Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='hello' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:24:41.2674218Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 12:55:07.508 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:02:14.464 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:14.490 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:14.492 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 13:02:14.496 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:14.498 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:14.498 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 13:02:14.499 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:14.500 +05:30 [INF] 📤 Sending message: Hello! 👋 Welcome to our service.
2025-07-05 13:02:14.501 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMzM4NkE3N0IwMDBDQjJFNTIwODEyNzg3NzFDNDFCM0MA","timestamp":"1751700731","text":{"body":"testflow"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:02:14.502 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:14.503 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:14.505 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:14.505 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:14.507 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.6459ms
2025-07-05 13:02:14.508 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:14.509 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:15.424 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 932.26ms
2025-07-05 13:02:15.425 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:02:15.430 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:15.431 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:16.959 +05:30 [INF] Received HTTP response headers after 1527.6149ms - 200
2025-07-05 13:02:16.961 +05:30 [INF] End processing HTTP request after 1531.0683ms - 200
2025-07-05 13:02:17.016 +05:30 [INF] Executed DbCommand (52ms) [Parameters=[@p0='34e27cb3-eb81-4321-8311-68fb7d2f9f14', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:16.9633184Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hello! 👋 Welcome to our service.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hello! 👋 Welcome to our service.', @p16='2025-07-05T07:32:16.9633191Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:17.019 +05:30 [INF] ➡️ Running node: "End" | n2
2025-07-05 13:02:17.020 +05:30 [INF] ✅ End node reached.
2025-07-05 13:02:17.020 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:02:17.021 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMzM4NkE3N0IwMDBDQjJFNTIwODEyNzg3NzFDNDFCM0MA","timestamp":"1751700731","text":{"body":"testflow"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:02:17.023 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:02:17.026 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:02:17.029 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:17.032 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:17.034 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:17.036 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:02:17.039 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='285faf32-581c-4f52-a195-6fbe04c0344f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:17.0381403Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='testflow' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:32:17.0381404Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:20.013 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:02:20.014 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='testflow'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:02:20.014 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:02:20.020 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:20.021 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:20.023 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:20.023 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:20.026 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:20.026 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:20.027 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"sent","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","expiration_timestamp":"1751700740","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:20.028 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"delivered","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:20.029 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:20.030 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:20.031 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:20.032 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:20.032 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 13:02:20.033 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:20.034 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.0981ms
2025-07-05 13:02:20.035 +05:30 [INF] 📤 Sending message: 👋 Welcome to our service!
2025-07-05 13:02:20.036 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.7298ms
2025-07-05 13:02:20.036 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:20.037 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:20.038 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:20.038 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.239ms
2025-07-05 13:02:20.041 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:20.041 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 27.6502ms
2025-07-05 13:02:20.045 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:20.882 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:20.883 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:22.013 +05:30 [INF] Received HTTP response headers after 1129.5112ms - 200
2025-07-05 13:02:22.015 +05:30 [INF] End processing HTTP request after 1132.6986ms - 200
2025-07-05 13:02:22.019 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='de758e88-88c0-4366-bf3c-44238ea49a82', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:22.0170674Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='👋 Welcome to our service!' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='👋 Welcome to our service!', @p16='2025-07-05T07:32:22.0170675Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:22.020 +05:30 [INF] ➡️ Running node: "Message" | n2
2025-07-05 13:02:22.022 +05:30 [INF] 📤 Sending message: 💬 How can we help you today?
2025-07-05 13:02:22.022 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:22.025 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:22.026 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:25.239 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:25.243 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:02:25.239 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:02:25.244 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:25.246 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:25.248 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:25.249 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:25.250 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:25.251 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"delivered","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:25.253 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"sent","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","expiration_timestamp":"1751700745","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:25.253 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:25.254 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:25.255 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:25.255 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:25.256 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0212ms
2025-07-05 13:02:25.257 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5774ms
2025-07-05 13:02:25.258 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:25.259 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:25.259 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.7012ms
2025-07-05 13:02:25.260 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.3144ms
2025-07-05 13:02:26.334 +05:30 [INF] Received HTTP response headers after 1086.1792ms - 200
2025-07-05 13:02:26.336 +05:30 [INF] End processing HTTP request after 1097.0158ms - 200
2025-07-05 13:02:26.358 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='eac54079-89a2-4e95-b887-f5c4f68c5b62', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:26.3383372Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='💬 How can we help you today?' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='💬 How can we help you today?', @p16='2025-07-05T07:32:26.3383374Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:26.360 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:02:26.361 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"sent","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","expiration_timestamp":"1751700740","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.362 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:26.363 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"sent","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","expiration_timestamp":"1751700740","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.365 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:26.367 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==
2025-07-05 13:02:26.368 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==
2025-07-05 13:02:26.368 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"delivered","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.370 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:26.370 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==","status":"delivered","timestamp":"1751700740","recipient_id":"917082156227","conversation":{"id":"94b1485c13a3c92c197d9c8ae275ef8c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.373 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:26.375 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==
2025-07-05 13:02:26.375 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSM0NFOEIzMDExRUFBRTA3NUExAA==
2025-07-05 13:02:26.376 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"delivered","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.377 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:26.377 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"delivered","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.379 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:26.381 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==
2025-07-05 13:02:26.381 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==
2025-07-05 13:02:26.382 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"sent","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","expiration_timestamp":"1751700745","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.384 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:26.384 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==","status":"sent","timestamp":"1751700745","recipient_id":"917082156227","conversation":{"id":"c3ce3422f16d1bdc5206bad393f822d7","expiration_timestamp":"1751700745","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:26.387 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:26.388 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==
2025-07-05 13:02:26.389 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMkExQ0EwOUZEMUMxN0ZFRTc5AA==
2025-07-05 13:02:27.398 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:02:27.400 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:27.401 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:27.404 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"sent","timestamp":"1751700749","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","expiration_timestamp":"1751700749","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.405 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:27.405 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"sent","timestamp":"1751700749","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","expiration_timestamp":"1751700749","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.406 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:27.407 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:27.408 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5648ms
2025-07-05 13:02:27.408 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"sent","timestamp":"1751700749","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","expiration_timestamp":"1751700749","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.409 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:27.411 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:27.412 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.7381ms
2025-07-05 13:02:27.413 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==
2025-07-05 13:02:27.416 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==
2025-07-05 13:02:27.755 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:02:27.757 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:27.758 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:27.760 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"delivered","timestamp":"1751700750","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.761 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:27.761 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"delivered","timestamp":"1751700750","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.762 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:27.763 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:27.764 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2533ms
2025-07-05 13:02:27.764 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==","status":"delivered","timestamp":"1751700750","recipient_id":"917082156227","conversation":{"id":"208b91174fe33cb5f787685615cd0370","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:27.766 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:27.768 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:27.768 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.8396ms
2025-07-05 13:02:27.771 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==
2025-07-05 13:02:27.773 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzRBMUNBM0I2RkNGMTNBRDlCAA==
2025-07-05 13:02:47.365 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 13:02:47.367 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:47.368 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:47.370 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREVBNUQzQzBCNkY1NTZBRjdFMDg4MTMwRDQyQUI2MDkA","timestamp":"1751700769","text":{"body":"testflow"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:02:47.371 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:47.372 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREVBNUQzQzBCNkY1NTZBRjdFMDg4MTMwRDQyQUI2MDkA","timestamp":"1751700769","text":{"body":"testflow"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:02:47.372 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:47.373 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:02:47.374 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5692ms
2025-07-05 13:02:47.376 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:47.376 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:02:47.377 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.7556ms
2025-07-05 13:02:47.379 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:47.382 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:47.384 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:47.385 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:02:47.406 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='fc9b4bc0-d698-4c1a-aaf2-26780d9a50ff', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:47.3872056Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='testflow' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:32:47.3872056Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:51.444 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='testflow'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:02:51.446 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:51.448 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:51.450 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:51.451 +05:30 [INF] ➡️ Running node: "Message" | n1
2025-07-05 13:02:51.452 +05:30 [INF] 📤 Sending message: 👋 Welcome to our service!
2025-07-05 13:02:51.452 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:51.454 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:51.456 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:52.475 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:52.476 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:53.820 +05:30 [INF] Received HTTP response headers after 1343.6727ms - 200
2025-07-05 13:02:53.822 +05:30 [INF] End processing HTTP request after 1347.0369ms - 200
2025-07-05 13:02:53.826 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='01023c3d-9f68-4fb5-8899-0761de9123c6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:53.8240883Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='👋 Welcome to our service!' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='👋 Welcome to our service!', @p16='2025-07-05T07:32:53.8240885Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:53.828 +05:30 [INF] ➡️ Running node: "Message" | n2
2025-07-05 13:02:53.829 +05:30 [INF] 📤 Sending message: 💬 How can we help you today?
2025-07-05 13:02:53.830 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:02:53.832 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:02:53.834 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:02:56.168 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:56.169 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:02:56.169 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:02:56.170 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:02:56.172 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:56.173 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:56.176 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:56.176 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:56.178 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"sent","timestamp":"1751700776","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","expiration_timestamp":"1751700776","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:56.179 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"delivered","timestamp":"1751700777","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:56.180 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:56.181 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:56.182 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:56.182 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:56.183 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.7392ms
2025-07-05 13:02:56.184 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3181ms
2025-07-05 13:02:56.185 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:56.186 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:56.187 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.2355ms
2025-07-05 13:02:56.187 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.8797ms
2025-07-05 13:02:57.240 +05:30 [INF] Received HTTP response headers after 1066.0635ms - 200
2025-07-05 13:02:57.241 +05:30 [INF] End processing HTTP request after 1072.8987ms - 200
2025-07-05 13:02:57.245 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='5c899cb9-1ef1-4e31-8781-a59fbefb9f8e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:32:57.2433384Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='💬 How can we help you today?' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='💬 How can we help you today?', @p16='2025-07-05T07:32:57.2433385Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:02:57.247 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:02:57.248 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"sent","timestamp":"1751700776","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","expiration_timestamp":"1751700776","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:57.249 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:57.250 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"sent","timestamp":"1751700776","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","expiration_timestamp":"1751700776","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:57.252 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:57.253 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==
2025-07-05 13:02:57.254 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==
2025-07-05 13:02:57.255 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"delivered","timestamp":"1751700777","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:57.255 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:57.256 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==","status":"delivered","timestamp":"1751700777","recipient_id":"917082156227","conversation":{"id":"96d0bc270274766ba27d913ee8cd3a3d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:57.258 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:57.259 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==
2025-07-05 13:02:57.260 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQ0EyNzFGNURDNzkyQzc2MzY0AA==
2025-07-05 13:02:58.176 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:02:58.179 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:58.180 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:58.183 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"sent","timestamp":"1751700780","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","expiration_timestamp":"1751700780","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.184 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:58.185 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"sent","timestamp":"1751700780","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","expiration_timestamp":"1751700780","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.185 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:58.187 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:58.188 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3059ms
2025-07-05 13:02:58.188 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"sent","timestamp":"1751700780","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","expiration_timestamp":"1751700780","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.189 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:58.191 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:58.191 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.2965ms
2025-07-05 13:02:58.193 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==
2025-07-05 13:02:58.197 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==
2025-07-05 13:02:58.818 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:02:58.820 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:58.821 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:02:58.823 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"delivered","timestamp":"1751700781","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.824 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:02:58.824 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"delivered","timestamp":"1751700781","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.825 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:02:58.826 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:02:58.827 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4223ms
2025-07-05 13:02:58.828 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==","status":"delivered","timestamp":"1751700781","recipient_id":"917082156227","conversation":{"id":"aa109249776a4f9e1dfd49e9db59832c","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:02:58.829 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:02:58.831 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:02:58.831 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.9582ms
2025-07-05 13:02:58.833 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==
2025-07-05 13:02:58.836 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNEY2RTM2MzNCQ0Y4NkE3MEE1AA==
2025-07-05 13:11:40.018 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:11:40.021 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:40.022 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:11:40.023 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjdERTY5REUwNTgzMkY4RjM1MzlBMDNGQzlDMjhGMzgA","timestamp":"1751701302","text":{"body":"agent"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:11:40.025 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:11:40.025 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjdERTY5REUwNTgzMkY4RjM1MzlBMDNGQzlDMjhGMzgA","timestamp":"1751701302","text":{"body":"agent"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:11:40.026 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:11:40.027 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:11:40.028 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3422ms
2025-07-05 13:11:40.034 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:40.036 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.5358ms
2025-07-05 13:11:40.136 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:11:40.139 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:11:40.141 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:11:40.143 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:11:40.145 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:11:40.149 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='54a4c64e-726d-4192-8f8b-fcaacfacf919', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:41:40.1475511Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='agent' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:41:40.1475513Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:11:43.473 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='agent'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:11:43.476 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:11:43.478 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:11:43.480 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:11:43.481 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:11:43.482 +05:30 [INF] 📤 Sending message: Hi! 👋 Welcome to our service.
2025-07-05 13:11:43.483 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:11:43.485 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:11:43.488 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:11:44.195 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:11:44.198 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:11:44.199 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:11:45.648 +05:30 [INF] Received HTTP response headers after 1447.5098ms - 200
2025-07-05 13:11:45.649 +05:30 [INF] End processing HTTP request after 1451.5614ms - 200
2025-07-05 13:11:45.670 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='881c5fc9-0ccd-4fe5-9e83-316379c1b82d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:41:45.6518603Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi! 👋 Welcome to our service.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi! 👋 Welcome to our service.', @p16='2025-07-05T07:41:45.6518605Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:11:45.673 +05:30 [INF] ➡️ Running node: "AgentHandoff" | agent
2025-07-05 13:11:45.674 +05:30 [WRN] ⚠️ Invalid node ID format for AgentHandoff node: agent
2025-07-05 13:11:45.675 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:11:46.461 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:11:46.463 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:46.464 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:11:46.466 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"sent","timestamp":"1751701308","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","expiration_timestamp":"1751701308","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.467 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:11:46.467 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"sent","timestamp":"1751701308","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","expiration_timestamp":"1751701308","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.468 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:11:46.469 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:11:46.470 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6306ms
2025-07-05 13:11:46.471 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"sent","timestamp":"1751701308","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","expiration_timestamp":"1751701308","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.472 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:46.474 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.4505ms
2025-07-05 13:11:46.475 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:11:46.484 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==
2025-07-05 13:11:46.485 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==
2025-07-05 13:11:46.873 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:11:46.876 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:46.876 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:11:46.878 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"delivered","timestamp":"1751701309","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.879 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:11:46.880 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"delivered","timestamp":"1751701309","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.880 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:11:46.881 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:11:46.882 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4532ms
2025-07-05 13:11:46.883 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==","status":"delivered","timestamp":"1751701309","recipient_id":"917082156227","conversation":{"id":"1cf4ea99da05a1a2edadd8cc444aa40a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:11:46.883 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:46.885 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:11:46.885 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.0491ms
2025-07-05 13:11:46.887 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==
2025-07-05 13:11:46.890 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUU1MjgzNDZDOEJCRUZEMjUwAA==
2025-07-05 13:11:58.953 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 491
2025-07-05 13:11:58.955 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:58.956 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:11:58.958 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjM1MUY2QURBMDU1MDU2QjUwRDI2OThFRDZGNTRCM0EA","timestamp":"1751701321","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:11:58.959 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:11:58.959 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQjM1MUY2QURBMDU1MDU2QjUwRDI2OThFRDZGNTRCM0EA","timestamp":"1751701321","text":{"body":"Hi"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:11:58.959 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:11:58.961 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:11:58.962 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2279ms
2025-07-05 13:11:58.964 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:11:58.964 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:11:58.965 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.7826ms
2025-07-05 13:11:58.966 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:11:58.970 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:11:58.972 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:11:58.973 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:11:58.976 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='0a4203ea-9f6d-48f4-8ae4-aa19fcd1d6ae', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:41:58.9748842Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hi' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:41:58.9748843Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:12:01.815 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hi'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:12:01.817 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:01.819 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:01.821 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:01.822 +05:30 [INF] ➡️ Running node: "Message" | node-1
2025-07-05 13:12:01.822 +05:30 [INF] 📤 Sending message: 
2025-07-05 13:12:01.823 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:01.825 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:01.827 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:02.550 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:02.551 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:02.879 +05:30 [INF] Received HTTP response headers after 326.7474ms - 400
2025-07-05 13:12:02.880 +05:30 [INF] End processing HTTP request after 329.8296ms - 400
2025-07-05 13:12:02.884 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='62ba00fb-4d8c-49d2-98d5-87a7cb5ef0d1', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:42:02.8824240Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#100) The parameter text['body'] is required.\",\"type\":\"OAuthException\",\"code\":100,\"fbtrace_id\":\"A9WFdSKGJ5x4veQtJamdxBM\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T07:42:02.8824241Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:12:02.886 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:12:25.738 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:12:25.740 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:25.741 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:12:25.743 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREU4MTYyRUU2MjRFRDQ3NUQzNjAxOTI4MkFBMEE3ODMA","timestamp":"1751701348","text":{"body":"start"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:12:25.744 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:12:25.744 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREU4MTYyRUU2MjRFRDQ3NUQzNjAxOTI4MkFBMEE3ODMA","timestamp":"1751701348","text":{"body":"start"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:12:25.745 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:12:25.746 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:12:25.747 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.1043ms
2025-07-05 13:12:25.750 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:12:25.750 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:25.752 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:25.752 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6244ms
2025-07-05 13:12:25.754 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:25.759 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:25.761 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:12:25.764 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='5b2c5133-41b9-4d65-9cbe-9a084a07b39d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:42:25.7630780Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='start' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:42:25.7630781Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:12:28.410 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='start'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:12:28.412 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:28.415 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:28.417 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:28.417 +05:30 [INF] ➡️ Running node: "Message" | greet
2025-07-05 13:12:28.418 +05:30 [INF] 📤 Sending message: Hey there! ✨ Let’s get you started.
2025-07-05 13:12:28.419 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:28.421 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:28.423 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:29.060 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:29.061 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:30.238 +05:30 [INF] Received HTTP response headers after 1176.3493ms - 200
2025-07-05 13:12:30.239 +05:30 [INF] End processing HTTP request after 1179.7823ms - 200
2025-07-05 13:12:30.244 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='c469f050-4203-4fbb-b2d6-1385fd983c23', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:42:30.2417811Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hey there! ✨ Let’s get you started.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hey there! ✨ Let’s get you started.', @p16='2025-07-05T07:42:30.2417813Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:12:30.246 +05:30 [INF] ➡️ Running node: "Tag" | tag
2025-07-05 13:12:30.249 +05:30 [INF] 🏷️ Assigning tags: Lead, Trial
2025-07-05 13:12:30.260 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1 AND NOT (c."IsArchived")
LIMIT 1
2025-07-05 13:12:30.266 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__8__locals2_tagName_1='Lead'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
FROM "Tags" AS t
WHERE t."BusinessId" = @__8__locals1_businessId_0 AND t."Name" = @__8__locals2_tagName_1 AND t."IsActive"
LIMIT 1
2025-07-05 13:12:30.292 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__8__locals1_contact_Id_0='0876f654-a362-420f-a912-6bce793436a5', @__tag_Id_1='031ff6b4-e3b7-4775-8fd0-472cadca6192'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "ContactTags" AS c
    WHERE c."ContactId" = @__8__locals1_contact_Id_0 AND c."TagId" = @__tag_Id_1)
2025-07-05 13:12:30.312 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__8__locals2_tagName_1='Trial'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
FROM "Tags" AS t
WHERE t."BusinessId" = @__8__locals1_businessId_0 AND t."Name" = @__8__locals2_tagName_1 AND t."IsActive"
LIMIT 1
2025-07-05 13:12:30.315 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_contact_Id_0='0876f654-a362-420f-a912-6bce793436a5', @__tag_Id_1='5e82214d-4190-469b-b591-b7df2a3d2aa8'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "ContactTags" AS c
    WHERE c."ContactId" = @__8__locals1_contact_Id_0 AND c."TagId" = @__tag_Id_1)
2025-07-05 13:12:30.336 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='b15507f6-eab1-4395-802b-1984948ebf10', @p1='2025-07-05T07:42:30.2957271Z' (DbType = DateTime), @p2=NULL, @p3='00000000-0000-0000-0000-000000000000', @p4='0876f654-a362-420f-a912-6bce793436a5', @p5='031ff6b4-e3b7-4775-8fd0-472cadca6192', @p6='5e82214d-4190-469b-b591-b7df2a3d2aa8', @p7='c13be597-6ae2-42bb-9d43-925815f24ff8', @p8=NULL, @p9='#8c8c8c', @p10='2025-07-05T07:42:30.3142055Z' (DbType = DateTime), @p11='True', @p12='False', @p13=NULL (DbType = DateTime), @p14='Trial' (Nullable = false), @p15=NULL, @p16='39233334-4fbc-433c-bf25-28335867dc52', @p17='2025-07-05T07:42:30.3175759Z' (DbType = DateTime), @p18=NULL, @p19='00000000-0000-0000-0000-000000000000', @p20='0876f654-a362-420f-a912-6bce793436a5', @p21='5e82214d-4190-469b-b591-b7df2a3d2aa8'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ContactTags" ("Id", "AssignedAt", "AssignedBy", "BusinessId", "ContactId", "TagId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
INSERT INTO "Tags" ("Id", "BusinessId", "Category", "ColorHex", "CreatedAt", "IsActive", "IsSystemTag", "LastUsedAt", "Name", "Notes")
VALUES (@p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
INSERT INTO "ContactTags" ("Id", "AssignedAt", "AssignedBy", "BusinessId", "ContactId", "TagId")
VALUES (@p16, @p17, @p18, @p19, @p20, @p21);
2025-07-05 13:12:30.348 +05:30 [INF] ➡️ Running node: "Wait" | wait
2025-07-05 13:12:30.351 +05:30 [INF] ⏳ Waiting 3s
2025-07-05 13:12:31.253 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:12:31.256 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:31.257 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:12:31.258 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"sent","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","expiration_timestamp":"1751701353","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:31.260 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:12:31.261 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:12:31.262 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.9847ms
2025-07-05 13:12:31.264 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:31.264 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.1441ms
2025-07-05 13:12:31.463 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:12:31.465 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:31.466 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:12:31.468 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"delivered","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:31.470 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:12:31.470 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:12:31.472 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.9936ms
2025-07-05 13:12:31.473 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:31.474 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.0717ms
2025-07-05 13:12:33.362 +05:30 [INF] ➡️ Running node: "Message" | followup
2025-07-05 13:12:33.364 +05:30 [INF] 📤 Sending message: You’re all set! Let us know how we can help.
2025-07-05 13:12:33.365 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:12:33.367 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:12:33.369 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:12:35.034 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:35.035 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:12:36.278 +05:30 [INF] Received HTTP response headers after 1242.2386ms - 200
2025-07-05 13:12:36.280 +05:30 [INF] End processing HTTP request after 1245.8253ms - 200
2025-07-05 13:12:36.301 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='915670f7-2d68-4b77-8b54-0a987b9ee798', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:42:36.2823877Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='You’re all set! Let us know how we can help.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='You’re all set! Let us know how we can help.', @p16='2025-07-05T07:42:36.2823879Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:12:36.303 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:12:36.304 +05:30 [INF] ✅ End node reached.
2025-07-05 13:12:36.305 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:12:36.306 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"sent","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","expiration_timestamp":"1751701353","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:36.307 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:12:36.307 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"sent","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","expiration_timestamp":"1751701353","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:36.310 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:12:36.312 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==
2025-07-05 13:12:36.313 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==
2025-07-05 13:12:36.313 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"delivered","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:36.315 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:12:36.315 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==","status":"delivered","timestamp":"1751701353","recipient_id":"917082156227","conversation":{"id":"56adce2e93e755a0f64166b592092467","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:36.318 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:12:36.320 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==
2025-07-05 13:12:36.321 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQUExMzgxNjBENjg1RkUxM0I4AA==
2025-07-05 13:12:37.352 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:12:37.355 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:37.356 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:12:37.357 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"sent","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","expiration_timestamp":"1751701359","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.359 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:12:37.359 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"sent","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","expiration_timestamp":"1751701359","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.360 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:12:37.361 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:12:37.363 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.7431ms
2025-07-05 13:12:37.363 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"sent","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","expiration_timestamp":"1751701359","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.365 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:37.367 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.0418ms
2025-07-05 13:12:37.368 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:12:37.373 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==
2025-07-05 13:12:37.373 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==
2025-07-05 13:12:37.729 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:12:37.732 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:37.733 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:12:37.734 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"delivered","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.736 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:12:37.736 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"delivered","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.736 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:12:37.737 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:12:37.739 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4996ms
2025-07-05 13:12:37.739 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==","status":"delivered","timestamp":"1751701359","recipient_id":"917082156227","conversation":{"id":"d70a8c6eb7f4e55f10b49b21552a84b0","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:12:37.741 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:12:37.743 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.2544ms
2025-07-05 13:12:37.744 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:12:37.749 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==
2025-07-05 13:12:37.749 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODRDQTEwNkI0NTVBMTJBRTU4AA==
2025-07-05 13:17:26.842 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:17:26.849 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:26.850 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:17:26.852 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQ0E2Nzc1QTA0QTEyRUQ3RjNGRDRBMkY1ODhCQTRGN0EA","timestamp":"1751701648","text":{"body":"start"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:17:26.853 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:17:26.853 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQ0E2Nzc1QTA0QTEyRUQ3RjNGRDRBMkY1ODhCQTRGN0EA","timestamp":"1751701648","text":{"body":"start"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:17:26.853 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:17:26.854 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:17:26.855 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.994ms
2025-07-05 13:17:26.860 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:26.862 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.2013ms
2025-07-05 13:17:26.965 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:17:26.967 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:17:26.969 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:17:26.971 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:17:26.973 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:17:26.977 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='b7817d42-0bb8-4352-aba8-3304b3d6fea9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:47:26.9756801Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='start' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:47:26.9756803Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:17:29.004 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='start'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:17:29.006 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:17:29.008 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:17:29.010 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:17:29.011 +05:30 [INF] ➡️ Running node: "Message" | greet
2025-07-05 13:17:29.012 +05:30 [INF] 📤 Sending message: Hey there! ✨ Let’s get you started.
2025-07-05 13:17:29.012 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:17:29.015 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:17:29.016 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:17:29.724 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:17:29.726 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:17:29.727 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:17:31.317 +05:30 [INF] Received HTTP response headers after 1588.9506ms - 200
2025-07-05 13:17:31.319 +05:30 [INF] End processing HTTP request after 1592.4575ms - 200
2025-07-05 13:17:31.341 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='d188b183-850e-44ea-b78e-eb5a9fdb9f21', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:47:31.3216606Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hey there! ✨ Let’s get you started.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hey there! ✨ Let’s get you started.', @p16='2025-07-05T07:47:31.3216608Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:17:31.344 +05:30 [INF] ➡️ Running node: "Tag" | tag
2025-07-05 13:17:31.345 +05:30 [INF] 🏷️ Assigning tags: Lead, Trial
2025-07-05 13:17:31.347 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1 AND NOT (c."IsArchived")
LIMIT 1
2025-07-05 13:17:31.350 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__8__locals2_tagName_1='Lead'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
FROM "Tags" AS t
WHERE t."BusinessId" = @__8__locals1_businessId_0 AND t."Name" = @__8__locals2_tagName_1 AND t."IsActive"
LIMIT 1
2025-07-05 13:17:31.353 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_contact_Id_0='0876f654-a362-420f-a912-6bce793436a5', @__tag_Id_1='031ff6b4-e3b7-4775-8fd0-472cadca6192'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "ContactTags" AS c
    WHERE c."ContactId" = @__8__locals1_contact_Id_0 AND c."TagId" = @__tag_Id_1)
2025-07-05 13:17:31.356 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__8__locals2_tagName_1='Trial'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
FROM "Tags" AS t
WHERE t."BusinessId" = @__8__locals1_businessId_0 AND t."Name" = @__8__locals2_tagName_1 AND t."IsActive"
LIMIT 1
2025-07-05 13:17:31.359 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_contact_Id_0='0876f654-a362-420f-a912-6bce793436a5', @__tag_Id_1='5e82214d-4190-469b-b591-b7df2a3d2aa8'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "ContactTags" AS c
    WHERE c."ContactId" = @__8__locals1_contact_Id_0 AND c."TagId" = @__tag_Id_1)
2025-07-05 13:17:31.361 +05:30 [INF] ➡️ Running node: "Wait" | wait
2025-07-05 13:17:31.362 +05:30 [INF] ⏳ Waiting 3s
2025-07-05 13:17:32.247 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:17:32.250 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:32.251 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:17:32.252 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"sent","timestamp":"1751701654","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","expiration_timestamp":"1751701654","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:32.254 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:17:32.254 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:17:32.255 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.2812ms
2025-07-05 13:17:32.256 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:32.257 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.2753ms
2025-07-05 13:17:33.148 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:17:33.151 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:33.152 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:17:33.153 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"delivered","timestamp":"1751701655","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:33.155 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:17:33.155 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:17:33.156 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.2978ms
2025-07-05 13:17:33.158 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:33.158 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.2533ms
2025-07-05 13:17:34.369 +05:30 [INF] ➡️ Running node: "Message" | followup
2025-07-05 13:17:34.371 +05:30 [INF] 📤 Sending message: You’re all set! Let us know how we can help.
2025-07-05 13:17:34.372 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:17:34.374 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:17:34.376 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:17:36.731 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:17:36.732 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:17:37.781 +05:30 [INF] Received HTTP response headers after 1046.068ms - 200
2025-07-05 13:17:37.782 +05:30 [INF] End processing HTTP request after 1051.1554ms - 200
2025-07-05 13:17:37.803 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='2d5f4eef-c503-4de8-a47a-7835592e48f8', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:47:37.7840094Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='You’re all set! Let us know how we can help.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='You’re all set! Let us know how we can help.', @p16='2025-07-05T07:47:37.7840096Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:17:37.805 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:17:37.805 +05:30 [INF] ✅ End node reached.
2025-07-05 13:17:37.806 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:17:37.807 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"sent","timestamp":"1751701654","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","expiration_timestamp":"1751701654","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:37.809 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:17:37.809 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"sent","timestamp":"1751701654","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","expiration_timestamp":"1751701654","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:37.811 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:17:37.813 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==
2025-07-05 13:17:37.813 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==
2025-07-05 13:17:37.814 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"delivered","timestamp":"1751701655","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:37.815 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:17:37.815 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==","status":"delivered","timestamp":"1751701655","recipient_id":"917082156227","conversation":{"id":"ce99720fde4295b0c0a2f510677c6865","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:37.817 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:17:37.819 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==
2025-07-05 13:17:37.819 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjk4RkRCQjVEMUI1MjE3MEU3AA==
2025-07-05 13:17:38.688 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:17:38.690 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:38.691 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:17:38.693 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"sent","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","expiration_timestamp":"1751701661","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:38.694 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:17:38.694 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"sent","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","expiration_timestamp":"1751701661","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:38.695 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:17:38.696 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:17:38.697 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3377ms
2025-07-05 13:17:38.697 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"sent","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","expiration_timestamp":"1751701661","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:38.699 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:38.701 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:17:38.701 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.9212ms
2025-07-05 13:17:38.702 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==
2025-07-05 13:17:38.705 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==
2025-07-05 13:17:39.319 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:17:39.321 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:39.322 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:17:39.324 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"delivered","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:39.325 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:17:39.325 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"delivered","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:39.326 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:17:39.327 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:17:39.328 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0753ms
2025-07-05 13:17:39.328 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==","status":"delivered","timestamp":"1751701661","recipient_id":"917082156227","conversation":{"id":"81d7fb7b7a81980babc761f514d5a8dd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:17:39.329 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:17:39.331 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:17:39.332 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.3213ms
2025-07-05 13:17:39.333 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==
2025-07-05 13:17:39.336 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzQ3QjBFOUE1QUZGQzRBOEVFAA==
2025-07-05 13:22:17.389 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 499
2025-07-05 13:22:17.395 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:17.395 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:22:17.397 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjQyNTA0NEIwN0Q2NEQyOUEwNjlEOTRERTE5OEMxRTMA","timestamp":"1751701939","text":{"body":"start20sec"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:22:17.399 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:22:17.399 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjQyNTA0NEIwN0Q2NEQyOUEwNjlEOTRERTE5OEMxRTMA","timestamp":"1751701939","text":{"body":"start20sec"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:22:17.400 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:22:17.401 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:22:17.402 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.5701ms
2025-07-05 13:22:17.408 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:17.409 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:22:17.413 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.0262ms
2025-07-05 13:22:17.415 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:22:17.420 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:22:17.421 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:22:17.423 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:22:17.444 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='b387afda-13b8-46c7-b815-aeba2e78fa58', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:52:17.4246692Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='start20sec' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:52:17.4246694Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:22:19.094 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='start20sec'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:22:19.096 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:22:19.098 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:22:19.100 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:22:19.101 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:22:19.102 +05:30 [INF] 📤 Sending message: ⌛ Hold on, we’re preparing something for you...
2025-07-05 13:22:19.102 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:22:19.105 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:22:19.106 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:22:19.873 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:22:19.874 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:22:21.241 +05:30 [INF] Received HTTP response headers after 1365.3093ms - 200
2025-07-05 13:22:21.242 +05:30 [INF] End processing HTTP request after 1368.5103ms - 200
2025-07-05 13:22:21.264 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='93d2ce27-e508-4997-ac24-47026b38696a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:52:21.2439301Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='⌛ Hold on, we’re preparing something for you...' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='⌛ Hold on, we’re preparing something for you...', @p16='2025-07-05T07:52:21.2439302Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:22:21.266 +05:30 [INF] ➡️ Running node: "Wait" | wait
2025-07-05 13:22:21.267 +05:30 [INF] ⏳ Waiting 20s
2025-07-05 13:22:22.196 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:22:22.199 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:22.200 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:22:22.203 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"sent","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","expiration_timestamp":"1751701944","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:22.205 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:22:22.206 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:22:22.207 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.273ms
2025-07-05 13:22:22.209 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:22.209 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.4272ms
2025-07-05 13:22:22.542 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:22:22.544 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:22.545 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:22:22.547 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"delivered","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:22.548 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:22:22.549 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:22:22.550 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.4496ms
2025-07-05 13:22:22.552 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:22.553 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.3419ms
2025-07-05 13:22:41.265 +05:30 [INF] ➡️ Running node: "Message" | final
2025-07-05 13:22:41.266 +05:30 [INF] 📤 Sending message: 🎉 Thanks for waiting! Here's your response.
2025-07-05 13:22:41.267 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:22:41.372 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:22:41.373 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:22:44.279 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:22:44.290 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:22:44.291 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:22:45.223 +05:30 [INF] Received HTTP response headers after 931.2203ms - 200
2025-07-05 13:22:45.224 +05:30 [INF] End processing HTTP request after 933.9419ms - 200
2025-07-05 13:22:45.228 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='4508489a-95eb-4e8b-a2b3-02f0b6a7960a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:52:45.2260383Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='🎉 Thanks for waiting! Here's your response.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='🎉 Thanks for waiting! Here's your response.', @p16='2025-07-05T07:52:45.2260384Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:22:45.230 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:22:45.231 +05:30 [INF] ✅ End node reached.
2025-07-05 13:22:45.231 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:22:45.232 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"sent","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","expiration_timestamp":"1751701944","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:45.233 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:22:45.234 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"sent","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","expiration_timestamp":"1751701944","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:45.236 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:22:45.237 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==
2025-07-05 13:22:45.238 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==
2025-07-05 13:22:45.239 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"delivered","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:45.240 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:22:45.240 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==","status":"delivered","timestamp":"1751701944","recipient_id":"917082156227","conversation":{"id":"3e17859faada86c0382ebf80c821fe51","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:45.242 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:22:45.244 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==
2025-07-05 13:22:45.244 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMjE3Njg2MURFMzVCMUI1RTJCAA==
2025-07-05 13:22:46.187 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:22:46.189 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:46.190 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:22:46.192 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"sent","timestamp":"1751701968","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","expiration_timestamp":"1751701968","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.194 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:22:46.194 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"sent","timestamp":"1751701968","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","expiration_timestamp":"1751701968","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.195 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:22:46.196 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:22:46.197 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1658ms
2025-07-05 13:22:46.198 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"sent","timestamp":"1751701968","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","expiration_timestamp":"1751701968","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.199 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:46.200 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:22:46.201 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.2242ms
2025-07-05 13:22:46.203 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==
2025-07-05 13:22:46.206 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==
2025-07-05 13:22:46.656 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:22:46.659 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:46.660 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:22:46.662 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"delivered","timestamp":"1751701969","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.664 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:22:46.664 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"delivered","timestamp":"1751701969","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.664 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:22:46.666 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:22:46.667 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8953ms
2025-07-05 13:22:46.668 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==","status":"delivered","timestamp":"1751701969","recipient_id":"917082156227","conversation":{"id":"b76c89567f69825b4b8511e0f6fbe55d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:22:46.669 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:22:46.671 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:22:46.671 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.696ms
2025-07-05 13:22:46.673 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==
2025-07-05 13:22:46.676 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkY0RkNCQUY0OUZFRjczNURBAA==
2025-07-05 13:24:32.990 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:24:32.993 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:24:32.994 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:24:32.996 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkIxNTYwNTI0NDcwMjUxMkNCQ0Q2RjQ2MzZBOURBODQA","timestamp":"1751702074","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:24:32.998 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:24:32.998 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkIxNTYwNTI0NDcwMjUxMkNCQ0Q2RjQ2MzZBOURBODQA","timestamp":"1751702074","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:24:32.999 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:24:33.000 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:24:33.001 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.4721ms
2025-07-05 13:24:33.004 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:24:33.004 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:24:33.008 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.26ms
2025-07-05 13:24:33.010 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:24:33.014 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:24:33.016 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:24:33.018 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:24:33.038 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='6d5c0f2b-ab82-4d8a-aa85-488214e85337', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:54:33.0196981Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:54:33.0196982Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:24:35.569 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:24:35.571 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:24:35.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:24:35.575 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:24:35.632 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "Choice" to type 'xbytechat.api.Features.Automation.Models.NodeTypeEnum'. Path '[1].NodeType', line 9, position 28.
 ---> System.ArgumentException: Requested value 'Choice' was not found.
   at Newtonsoft.Json.Utilities.EnumUtils.ParseEnum(Type enumType, NamingStrategy namingStrategy, String value, Boolean disallowNumber)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationRunner.cs:line 39
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationService.cs:line 103
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Webhooks\Services\Processors\InboundMessageProcessor.cs:line 235
2025-07-05 13:24:35.641 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:25:04.892 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:25:04.894 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:04.895 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:25:04.896 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNjM0NjAzREExMDlFMjhBNjJEMjFDNEE1QTNCN0Y3NDIA","timestamp":"1751702107","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:04.898 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:25:04.898 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNjM0NjAzREExMDlFMjhBNjJEMjFDNEE1QTNCN0Y3NDIA","timestamp":"1751702107","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:04.899 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:25:04.900 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:25:04.901 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5432ms
2025-07-05 13:25:04.903 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:04.903 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:25:04.907 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.2866ms
2025-07-05 13:25:04.908 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:25:04.913 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:25:04.915 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:25:04.916 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:25:04.937 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='1b25f88a-f9ed-4fa4-8966-159432a35a1f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:55:04.9185312Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:55:04.9185313Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:25:07.651 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:25:07.653 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:25:07.655 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:25:07.656 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:25:07.706 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "Choice" to type 'xbytechat.api.Features.Automation.Models.NodeTypeEnum'. Path '[1].NodeType', line 9, position 28.
 ---> System.ArgumentException: Requested value 'Choice' was not found.
   at Newtonsoft.Json.Utilities.EnumUtils.ParseEnum(Type enumType, NamingStrategy namingStrategy, String value, Boolean disallowNumber)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationRunner.cs:line 39
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationService.cs:line 103
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Webhooks\Services\Processors\InboundMessageProcessor.cs:line 235
2025-07-05 13:25:07.710 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:25:24.433 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:25:24.436 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:24.437 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:25:24.438 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMEZCRkZFNUNFMDQwODU3Q0E2NDIzOEU0M0VFMDU5MTkA","timestamp":"1751702126","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:24.440 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:25:24.440 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMEZCRkZFNUNFMDQwODU3Q0E2NDIzOEU0M0VFMDU5MTkA","timestamp":"1751702126","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:24.440 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:25:24.442 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:25:24.442 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.4964ms
2025-07-05 13:25:24.445 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:25:24.445 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:24.447 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:25:24.448 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.5308ms
2025-07-05 13:25:24.449 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:25:24.454 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:25:24.456 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:25:24.477 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='7d14600a-6407-4ef7-8e48-d005c1aaa344', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:55:24.4580182Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:55:24.4580183Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:25:26.856 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:25:26.858 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 13:25:26.858 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 13:25:26.859 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:25:56.339 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:25:56.342 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:56.343 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:25:56.346 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQzIzMERBQzdGRDczMUFCRDlCMzI5MTdCOTg3REUyRTIA","timestamp":"1751702158","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:56.347 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:25:56.347 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQzIzMERBQzdGRDczMUFCRDlCMzI5MTdCOTg3REUyRTIA","timestamp":"1751702158","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:25:56.348 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:25:56.349 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:25:56.351 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.465ms
2025-07-05 13:25:56.354 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:25:56.354 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:25:56.359 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:25:56.360 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.7755ms
2025-07-05 13:25:56.362 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:25:56.366 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:25:56.367 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:25:56.389 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='2b5d4345-2be8-44ec-8c63-87bd1ff2066e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:55:56.3693717Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:55:56.3693718Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:26:04.547 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:26:45.687 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:26:45.697 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:26:45.702 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 13:26:45.706 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:26:45.700 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 13:26:45.721 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:45.755 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:45.755 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "Choice" to type 'xbytechat.api.Features.Automation.Models.NodeTypeEnum'. Path '[1].NodeType', line 9, position 28.
 ---> System.ArgumentException: Requested value 'Choice' was not found.
   at Newtonsoft.Json.Utilities.EnumUtils.ParseEnum(Type enumType, NamingStrategy namingStrategy, String value, Boolean disallowNumber)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationRunner.cs:line 39
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationService.cs:line 103
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Webhooks\Services\Processors\InboundMessageProcessor.cs:line 235
2025-07-05 13:26:45.756 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 54.0347ms
2025-07-05 13:26:45.758 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:26:45.760 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:26:45.766 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:45.819 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:45.819 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:45.844 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
2025-07-05 13:26:45.844 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
2025-07-05 13:26:45.846 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:26:45.851 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 13:26:45.851 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:26:45.875 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.Microsoft.AspNetCore.Http.Features.IHttpResponseFeature.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 13:26:45.879 +05:30 [ERR] Response has already started, unable to write error response for path: /api/whatsappsettings/me
2025-07-05 13:26:45.880 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 401 null application/json 179.7424ms
2025-07-05 13:26:45.883 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 13:26:45.885 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:45.885 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:26:45.886 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 3.1073ms
2025-07-05 13:26:45.887 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 13:26:45.891 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:45.892 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:45.894 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:45 AM'.
2025-07-05 13:26:45.895 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 8.5598ms
2025-07-05 13:26:45.899 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:26:45.899 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 13:26:45.942 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:26:45.968 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:26:45.982 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:26:46.050 +05:30 [INF] Executed DbCommand (39ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:26:46.068 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:26:46.138 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 285.3048ms
2025-07-05 13:26:46.140 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:26:46.189 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 13:26:46.196 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-05 13:26:46.199 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 440.3786ms
2025-07-05 13:26:46.201 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 13:26:46.203 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:46.204 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:46 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:46.206 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:46 AM'.
2025-07-05 13:26:46.207 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 5.6039ms
2025-07-05 13:26:46.209 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 13:26:46.633 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:26:46.637 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:46 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:46.641 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:46 AM'.
2025-07-05 13:26:46.643 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 13:26:46.669 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 13:26:46.672 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 13:26:46.673 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 40.8206ms
2025-07-05 13:26:51.824 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 13:26:51.827 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:51.828 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.6927ms
2025-07-05 13:26:51.830 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:26:51.833 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:51.834 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:51 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:51.836 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:51 AM'.
2025-07-05 13:26:51.837 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:26:51.837 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:26:51.840 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:26:51.842 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:26:51.846 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:26:51.850 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:26:51.853 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:26:51.856 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:26:51.857 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:26:51.886 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 48.1328ms
2025-07-05 13:26:51.888 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:26:51.922 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 13:26:51.927 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-05 13:26:51.927 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 97.7214ms
2025-07-05 13:26:51.931 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 13:26:51.933 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:51.933 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 2.3622ms
2025-07-05 13:26:51.934 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 13:26:51.937 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:26:51.938 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:51 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:51.940 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:51 AM'.
2025-07-05 13:26:51.940 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 6.2087ms
2025-07-05 13:26:51.943 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 13:26:52.415 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:26:52.417 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:52 AM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 13:26:52.419 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 07:24:59 AM', Current time (UTC): '05-07-2025 07:56:52 AM'.
2025-07-05 13:26:52.421 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 13:26:52.438 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Http.DefaultHttpResponse.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 13:26:52.441 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 13:26:52.442 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 27.364ms
2025-07-05 13:27:11.211 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 13:27:11.213 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:11.214 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.387ms
2025-07-05 13:27:11.222 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:27:11.225 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:11.225 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:11.226 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:11.235 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:27:11.238 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:27:11.242 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:27:11.245 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:27:11.248 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:27:11.251 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:27:11.253 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:27:11.255 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 13:27:11.256 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:11.268 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 40.3599ms
2025-07-05 13:27:11.269 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:11.270 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 48.217ms
2025-07-05 13:27:11.276 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:27:11.287 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:11.289 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:11.292 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:11.294 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.0936ms
2025-07-05 13:27:11.295 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:11.296 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 19.8988ms
2025-07-05 13:27:11.620 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 13:27:11.624 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:11.628 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 13:27:11.644 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:27:11.648 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 13:27:11.655 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 13:27:11.669 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 13:27:11.670 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 13:27:11.670 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 13:27:11.671 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 13:27:11.671 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 13:27:11.672 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 13:27:11.673 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 13:27:11.673 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 13:27:11.674 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 13:27:11.674 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 13:27:11.675 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 13:27:11.675 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 13:27:11.679 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 13:27:11.686 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 55.5732ms
2025-07-05 13:27:11.687 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:11.688 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 67.9741ms
2025-07-05 13:27:14.743 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:27:14.747 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:14.748 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:14.749 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:14.752 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:27:14.754 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:27:14.758 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:27:14.762 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:27:14.766 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:27:14.769 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:27:14.771 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:27:14.772 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 13:27:14.774 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:14.775 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 23.8996ms
2025-07-05 13:27:14.776 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:14.777 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 33.7661ms
2025-07-05 13:27:14.786 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:27:14.789 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:14.790 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:14.792 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:14.794 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 1.7518ms
2025-07-05 13:27:14.795 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:14.796 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 10.0033ms
2025-07-05 13:27:15.114 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 13:27:15.117 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:15.119 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 13:27:15.122 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:27:15.126 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 13:27:15.129 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 13:27:15.130 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 13:27:15.131 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 13:27:15.132 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 13:27:15.132 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 13:27:15.133 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 13:27:15.133 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 13:27:15.134 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 13:27:15.134 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 13:27:15.135 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 13:27:15.135 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 13:27:15.136 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 13:27:15.137 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 13:27:15.138 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 13:27:15.139 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.5291ms
2025-07-05 13:27:15.140 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:15.141 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 27.1447ms
2025-07-05 13:27:18.124 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 13:27:18.126 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:18.127 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 3.5918ms
2025-07-05 13:27:18.129 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:27:18.132 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:18.133 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:18.134 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:18.136 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:27:18.138 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:27:18.143 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:27:18.147 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:27:18.150 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:27:18.153 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:27:18.155 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:27:18.156 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 13:27:18.158 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:18.160 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 24.6027ms
2025-07-05 13:27:18.161 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:27:18.163 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 34.0234ms
2025-07-05 13:27:18.171 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:27:18.175 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:18.177 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:27:18.218 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:18.220 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 41.1757ms
2025-07-05 13:27:18.222 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:27:18.224 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 52.4709ms
2025-07-05 13:27:18.545 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 13:27:18.548 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:18.549 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 13:27:18.553 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:27:18.557 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 13:27:18.559 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 13:27:18.561 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 13:27:18.562 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 13:27:18.563 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 13:27:18.563 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 13:27:18.564 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 13:27:18.564 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 13:27:18.565 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 13:27:18.565 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 13:27:18.566 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 13:27:18.566 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 13:27:18.567 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 13:27:18.567 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 13:27:18.569 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 13:27:18.570 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 18.965ms
2025-07-05 13:27:18.571 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:27:18.572 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 26.8663ms
2025-07-05 13:27:18.830 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 13:27:18.833 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:18.835 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 13:27:18.838 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 13:27:18.847 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 13:27:18.852 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 13:27:18.858 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 18.0638ms
2025-07-05 13:27:18.859 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 13:27:18.860 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 29.8946ms
2025-07-05 13:27:21.931 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 13:27:21.933 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:21.934 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.1217ms
2025-07-05 13:27:21.935 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 477
2025-07-05 13:27:21.939 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:27:21.941 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:27:21.945 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 13:27:23.608 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:23.611 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1664.9229ms
2025-07-05 13:27:23.612 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:27:23.613 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1677.8357ms
2025-07-05 13:27:50.566 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:27:50.571 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:27:50.572 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:27:50.574 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUIzRDM2QjE0MUU4ODNGQzU0MjM1OTFCQjdGMTEzMTUA","timestamp":"1751702272","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:27:50.575 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:27:50.575 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUIzRDM2QjE0MUU4ODNGQzU0MjM1OTFCQjdGMTEzMTUA","timestamp":"1751702272","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:27:50.575 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:27:50.576 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:27:50.577 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.8006ms
2025-07-05 13:27:50.579 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:27:50.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:27:50.583 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.5532ms
2025-07-05 13:27:50.584 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:27:50.588 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:27:50.589 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:27:50.591 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:27:50.594 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='f9101f19-a137-4efd-b6c5-6466af31441d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:57:50.5929663Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:57:50.5929665Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:27:56.332 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:27:57.862 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:27:57.865 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:27:57.878 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:28:15.237 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:28:15.239 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:28:15.252 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:28:33.511 +05:30 [ERR] ❌ Automation flow execution failed.
Newtonsoft.Json.JsonSerializationException: Error converting value "Choice" to type 'xbytechat.api.Features.Automation.Models.NodeTypeEnum'. Path '[1].NodeType', line 9, position 28.
 ---> System.ArgumentException: Requested value 'Choice' was not found.
   at Newtonsoft.Json.Utilities.EnumUtils.ParseEnum(Type enumType, NamingStrategy namingStrategy, String value, Boolean disallowNumber)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   --- End of inner exception stack trace ---
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.EnsureType(JsonReader reader, Object value, CultureInfo culture, JsonContract contract, Type targetType)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateList(IList list, JsonReader reader, JsonArrayContract contract, JsonProperty containerProperty, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateList(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, Object existingValue, String id)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInternal(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type type, JsonSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, JsonSerializerSettings settings)
   at xbytechat.api.Features.Automation.Services.AutomationRunner.RunFlowAsync(AutomationFlow flow, Guid businessId, Guid contactId, String contactPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationRunner.cs:line 39
   at xbytechat.api.Features.Automation.Services.AutomationService.TryRunFlowByKeywordAsync(Guid businessId, String messageText, String userPhone, String sourceChannel, String industryTag) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Automation\Services\AutomationService.cs:line 103
   at xbytechat.api.Features.Webhooks.Services.Processors.InboundMessageProcessor.ProcessChatAsync(JsonElement value) in D:\xbytechat\xbytechat-api\xbytechat-api\Features\Webhooks\Services\Processors\InboundMessageProcessor.cs:line 235
2025-07-05 13:28:33.516 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:28:44.543 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:28:44.546 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:28:44.547 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:28:44.549 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTVFQ0Y4OTQxNjdGOThCNzg1NTA3MzM4QzFGOUVBMjkA","timestamp":"1751702326","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:28:44.550 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:28:44.550 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTVFQ0Y4OTQxNjdGOThCNzg1NTA3MzM4QzFGOUVBMjkA","timestamp":"1751702326","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:28:44.551 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:28:44.552 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:28:44.554 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1886ms
2025-07-05 13:28:44.556 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:28:44.558 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.4338ms
2025-07-05 13:28:44.656 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:28:44.658 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:28:44.660 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:28:44.662 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:28:44.664 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:28:44.667 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='5c2b3c5f-6a12-4114-b6f0-52e6fb8cba2a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T07:58:44.6659117Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T07:58:44.6659118Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:28:52.253 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:28:53.860 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:28:53.862 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:28:53.875 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:31:35.122 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 13:31:35.156 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 13:31:35.169 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 13:31:35.854 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 13:31:36.353 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 13:31:36.511 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 13:31:36.512 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 13:31:36.514 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 13:31:36.515 +05:30 [INF] Hosting environment: Development
2025-07-05 13:31:36.517 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 13:31:36.647 +05:30 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 13:31:36.666 +05:30 [INF] Executed DbCommand (33ms) [Parameters=[@__cutoff_0='2025-06-28T08:01:35.2640361Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 13:31:38.794 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 13:31:38.937 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 149.8277ms
2025-07-05 13:31:38.949 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 13:31:38.956 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.0935ms
2025-07-05 13:31:39.057 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 13:31:39.102 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.7627ms
2025-07-05 13:31:39.235 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 13:31:39.424 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 189.3059ms
2025-07-05 13:31:56.285 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:31:56.290 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 13:31:56.328 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:31:56.341 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:31:56.355 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkJCRUQ3MEVDRUEyQUJBMDExMjQ5RkE1NjZERjBCNDgA","timestamp":"1751702518","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:31:56.358 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:31:56.364 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:31:56.375 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 29.8783ms
2025-07-05 13:31:56.376 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:31:56.378 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 93.2289ms
2025-07-05 13:31:56.483 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMkJCRUQ3MEVDRUEyQUJBMDExMjQ5RkE1NjZERjBCNDgA","timestamp":"1751702518","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:31:56.485 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:31:56.588 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:31:56.688 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:31:56.698 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:31:56.731 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:31:56.738 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:31:56.879 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='063aaa80-230b-4b04-a095-055b0ef3b213', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:01:56.7410420Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:01:56.7410661Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:32:16.732 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:32:16.744 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:32:16.749 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:32:16.751 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:32:16.821 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:32:16.823 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 13:32:16.826 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:32:16.828 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:32:16.830 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:32:22.069 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:32:22.086 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:32:22.088 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:32:22.587 +05:30 [INF] Received HTTP response headers after 496.5193ms - 401
2025-07-05 13:32:22.589 +05:30 [INF] End processing HTTP request after 504.1728ms - 401
2025-07-05 13:32:28.019 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='91121989-8f79-45ac-af39-b7f2648a41a7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:02:27.9870887Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Saturday, 05-Jul-25 01:00:00 PDT. The current time is Saturday, 05-Jul-25 01:02:25 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"AoEWCDqbQZ1vJQqHr6grWDC\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:02:27.9870888Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:32:28.023 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 13:32:28.024 +05:30 [INF] ➡️ Running node: "Message" | priceMsg
2025-07-05 13:32:28.025 +05:30 [INF] 📤 Sending message: 💰 Our product starts at ₹499/month.
2025-07-05 13:32:28.025 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:32:28.028 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:32:28.030 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:32:30.033 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:32:30.034 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:32:30.568 +05:30 [INF] Received HTTP response headers after 533.1123ms - 401
2025-07-05 13:32:30.569 +05:30 [INF] End processing HTTP request after 536.5448ms - 401
2025-07-05 13:32:30.592 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='24a2c738-0bb3-42c3-9493-3f23bfc10e7d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:02:30.5717724Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='💰 Our product starts at ₹499/month.' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Saturday, 05-Jul-25 01:00:00 PDT. The current time is Saturday, 05-Jul-25 01:02:33 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"AT8BckRSwqGy3Nc3I24sbHM\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='💰 Our product starts at ₹499/month.', @p16='2025-07-05T08:02:30.5717729Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:32:30.594 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:32:30.595 +05:30 [INF] ✅ End node reached.
2025-07-05 13:32:30.596 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:32:44.911 +05:30 [INF] Application is shutting down...
2025-07-05 13:32:44.982 +05:30 [INF] 🛑 Graceful shutdown requested.
2025-07-05 13:32:44.983 +05:30 [INF] 🛑 Webhook Queue Worker stopped.
2025-07-05 13:33:05.465 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 13:33:05.526 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 13:33:05.542 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 13:33:06.420 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 13:33:06.877 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 13:33:07.028 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 13:33:07.029 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 13:33:07.030 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 13:33:07.031 +05:30 [INF] Hosting environment: Development
2025-07-05 13:33:07.032 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 13:33:07.089 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 13:33:07.102 +05:30 [INF] Executed DbCommand (35ms) [Parameters=[@__cutoff_0='2025-06-28T08:03:05.6872102Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 13:33:09.321 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 13:33:09.510 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 196.8931ms
2025-07-05 13:33:09.538 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 13:33:09.547 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 9.2118ms
2025-07-05 13:33:09.608 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 13:33:09.653 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.2706ms
2025-07-05 13:33:09.808 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 13:33:09.985 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 177.13ms
2025-07-05 13:33:16.439 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:33:16.444 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 13:33:16.480 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:33:16.491 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:33:16.507 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggODc0MzczQjNFRjRBNDFCM0U1OUNGRDAxMjhGNjU5MjMA","timestamp":"1751702598","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:33:16.509 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:33:16.514 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:33:16.523 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 26.8964ms
2025-07-05 13:33:16.538 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:33:16.540 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 101.1753ms
2025-07-05 13:33:16.602 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggODc0MzczQjNFRjRBNDFCM0U1OUNGRDAxMjhGNjU5MjMA","timestamp":"1751702598","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:33:16.604 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:33:16.700 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:33:16.792 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:33:16.802 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:33:16.833 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:33:16.840 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:33:16.991 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[@p0='f5475cad-76e6-492a-891f-a7ab3bc9b621', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:03:16.8437071Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:03:16.8437583Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:33:31.232 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:33:32.690 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:33:32.695 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:33:32.708 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:33:47.142 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:33:51.026 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 13:33:57.675 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:33:57.678 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:33:57.691 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:34:03.455 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:34:08.648 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:34:08.650 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:34:09.298 +05:30 [INF] Received HTTP response headers after 645.3979ms - 401
2025-07-05 13:34:09.300 +05:30 [INF] End processing HTTP request after 652.6948ms - 401
2025-07-05 13:34:19.427 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='40937f10-eb42-4d79-ae9d-ca3d31c3a89a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:04:19.4103423Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Saturday, 05-Jul-25 01:00:00 PDT. The current time is Saturday, 05-Jul-25 01:04:12 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"AXbdMWPbh-IZqtf_FRWsbfk\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:04:19.4103426Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:34:19.430 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 13:34:19.431 +05:30 [INF] ➡️ Running node: "Message" | priceMsg
2025-07-05 13:34:19.431 +05:30 [INF] 📤 Sending message: 💰 Our product starts at ₹499/month.
2025-07-05 13:34:19.432 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:34:19.435 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:34:19.437 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:34:20.308 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:34:20.309 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:34:20.653 +05:30 [INF] Received HTTP response headers after 342.8663ms - 401
2025-07-05 13:34:20.654 +05:30 [INF] End processing HTTP request after 346.0676ms - 401
2025-07-05 13:34:20.659 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='ae8fa821-5c37-4d36-b37a-f0709c3745c6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:04:20.6565536Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='💰 Our product starts at ₹499/month.' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp token has expired. Please update your token.","Data":null,"ErrorMessage":"Access token expired","RawResponse":"{\"error\":{\"message\":\"Error validating access token: Session has expired on Saturday, 05-Jul-25 01:00:00 PDT. The current time is Saturday, 05-Jul-25 01:04:23 PDT.\",\"type\":\"OAuthException\",\"code\":190,\"error_subcode\":463,\"fbtrace_id\":\"AiBfAaRDSajFG3hCd4_kFy2\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='💰 Our product starts at ₹499/month.', @p16='2025-07-05T08:04:20.6565536Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:34:20.660 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:34:20.661 +05:30 [INF] ✅ End node reached.
2025-07-05 13:34:20.662 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:34:25.055 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 13:34:25.062 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:25.064 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 9.4547ms
2025-07-05 13:34:25.065 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 477
2025-07-05 13:34:25.071 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:25.132 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:34:25.136 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 13:34:25.674 +05:30 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType128`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:34:25.678 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 540.1459ms
2025-07-05 13:34:25.679 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:34:25.681 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 500 null application/json; charset=utf-8 615.3414ms
2025-07-05 13:34:46.538 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 13:34:46.541 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:46.542 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 3.6678ms
2025-07-05 13:34:46.544 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 469
2025-07-05 13:34:46.551 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:46.554 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 13:34:46.558 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 13:34:46.562 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 13:34:46.563 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 13:34:46.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 13:34:46.587 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BPHeMVpMuOgFJOR9VC0NG8aJI0DMsRZCZBHsWuGdsd1vWi1RgX7b5qAM6wHdh875BdBmWhAdrupLVbldBvps6jO9k0pZBA3dUYAlAJi6QdHLLy91YkT7QTAJJLmE1S2KTaR2dahvxjJDNWDCWDZAychRtFulJ0BmScLxDjzpRXx4P2Dv27Ane79sTpNJMYH4YJLAlYw0gMagvK58TxuPOxaZB5RQp6qRtsVZBJpH6uPrXfixfEwiwZDZD' (Nullable = false), @p1='2025-07-05T08:04:46.5775927Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-05 13:34:46.589 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 13:34:46.591 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:34:46.592 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 32.7247ms
2025-07-05 13:34:46.593 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 13:34:46.596 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 52.7399ms
2025-07-05 13:34:47.141 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 13:34:47.143 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:47.144 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 3.2156ms
2025-07-05 13:34:47.145 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 469
2025-07-05 13:34:47.148 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:34:47.151 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:34:47.152 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 13:34:48.098 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:34:48.100 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 945.909ms
2025-07-05 13:34:48.101 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 13:34:48.102 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 957.2007ms
2025-07-05 13:35:12.548 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:35:12.553 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:35:12.554 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:35:12.556 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNDdDNzE5MkVDODIyQUYzMjM2RDQ4MTA5NUVEQTYzNTQA","timestamp":"1751702713","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:35:12.558 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:35:12.559 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:35:12.560 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNDdDNzE5MkVDODIyQUYzMjM2RDQ4MTA5NUVEQTYzNTQA","timestamp":"1751702713","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:35:12.560 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.9499ms
2025-07-05 13:35:12.564 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:35:12.565 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:35:12.567 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.4931ms
2025-07-05 13:35:12.572 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:35:12.576 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:35:12.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:35:12.581 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:35:12.583 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:35:12.587 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='7e528ce9-7ff6-4d0c-9ca6-71a72b34f880', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:05:12.5850614Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:05:12.5850616Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:35:18.397 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:35:19.808 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:35:19.810 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:35:19.824 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:35:29.970 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:35:33.508 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 13:35:39.006 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:35:39.009 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:35:39.023 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:35:44.689 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:35:44.690 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:35:45.334 +05:30 [INF] Received HTTP response headers after 643.2854ms - 401
2025-07-05 13:35:45.337 +05:30 [INF] End processing HTTP request after 647.5594ms - 401
2025-07-05 13:35:59.990 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 13:36:00.061 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 13:36:00.080 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 13:36:00.922 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 13:36:01.390 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 13:36:01.533 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 13:36:01.534 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 13:36:01.536 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 13:36:01.537 +05:30 [INF] Hosting environment: Development
2025-07-05 13:36:01.538 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 13:36:01.596 +05:30 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 13:36:01.611 +05:30 [INF] Executed DbCommand (35ms) [Parameters=[@__cutoff_0='2025-06-28T08:06:00.2323227Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 13:36:03.999 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 13:36:04.171 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 180.7615ms
2025-07-05 13:36:04.198 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 13:36:04.206 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 8.3534ms
2025-07-05 13:36:04.261 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 13:36:04.298 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.4823ms
2025-07-05 13:36:04.448 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 13:36:04.642 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 193.7315ms
2025-07-05 13:36:17.899 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 13:36:17.904 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 13:36:17.906 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:36:17.908 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 9.0286ms
2025-07-05 13:36:17.909 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 13:36:17.919 +05:30 [INF] CORS policy execution successful.
2025-07-05 13:36:18.016 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:36:18.028 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:36:18.087 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 13:36:18.147 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 13:36:18.228 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 13:36:18.300 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 13:36:18.316 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 13:36:18.384 +05:30 [INF] Executed DbCommand (41ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 13:36:18.404 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 13:36:18.412 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 13:36:18.419 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:36:18.435 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 403.224ms
2025-07-05 13:36:18.437 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 13:36:18.442 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 532.5136ms
2025-07-05 13:36:18.746 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 13:36:18.753 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:36:18.755 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 13:36:18.760 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:36:18.763 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 6.0221ms
2025-07-05 13:36:18.764 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 13:36:18.765 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 18.6259ms
2025-07-05 13:36:19.009 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 13:36:19.015 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:36:19.018 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 13:36:19.032 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:36:19.036 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 13:36:19.044 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 13:36:19.058 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 13:36:19.060 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 13:36:19.060 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 13:36:19.061 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 13:36:19.062 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 13:36:19.062 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 13:36:19.063 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 13:36:19.063 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 13:36:19.064 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 13:36:19.065 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 13:36:19.065 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 13:36:19.066 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 13:36:19.070 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 13:36:19.075 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 56.1127ms
2025-07-05 13:36:19.077 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 13:36:19.078 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 68.398ms
2025-07-05 13:36:32.245 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:36:32.249 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:32.251 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:36:32.258 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTUwODUyNUMxODkxNEU5RkUzQTA0MzdDMUM1REZDNzQA","timestamp":"1751702794","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:36:32.261 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:36:32.262 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:36:32.264 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 10.7329ms
2025-07-05 13:36:32.265 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:32.266 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.8355ms
2025-07-05 13:36:32.364 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTUwODUyNUMxODkxNEU5RkUzQTA0MzdDMUM1REZDNzQA","timestamp":"1751702794","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:36:32.367 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:36:32.385 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:36:32.403 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:36:32.411 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:36:32.440 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:36:32.447 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:36:32.594 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='2e857c18-b262-4e41-a60f-1027e22cf37b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:06:32.4508464Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:06:32.4508711Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:36:43.385 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:36:43.409 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:36:43.414 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:36:43.416 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:36:43.485 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:36:43.487 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 13:36:43.490 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:36:43.492 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:36:43.494 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:36:46.604 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:36:46.611 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:36:46.613 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:36:47.808 +05:30 [INF] Received HTTP response headers after 1192.6373ms - 200
2025-07-05 13:36:47.809 +05:30 [INF] End processing HTTP request after 1199.3277ms - 200
2025-07-05 13:36:47.881 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='f2c07cdc-9ce2-45a5-b3a0-7453fa7a1c2f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:06:47.8663459Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:06:47.8663461Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:36:52.812 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:36:54.026 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:36:54.039 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:54.659 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:54.670 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:36:58.148 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 13:36:58.148 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:36:58.151 +05:30 [INF] ➡️ Running node: "Message" | priceMsg
2025-07-05 13:36:58.151 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"sent","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","expiration_timestamp":"1751702811","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:36:58.153 +05:30 [INF] 📤 Sending message: 💰 Our product starts at ₹499/month.
2025-07-05 13:36:58.153 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"delivered","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:36:58.154 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:36:58.154 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:36:58.155 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:36:58.156 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:36:58.157 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:36:58.159 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:36:58.159 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.7045ms
2025-07-05 13:36:58.160 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.455ms
2025-07-05 13:36:58.162 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:36:58.162 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:58.163 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:36:58.934 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 6122.5767ms
2025-07-05 13:36:58.935 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:36:58.935 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 4909.3958ms
2025-07-05 13:36:58.939 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:37:00.196 +05:30 [INF] Received HTTP response headers after 1253.5172ms - 200
2025-07-05 13:37:00.197 +05:30 [INF] End processing HTTP request after 1262.6706ms - 200
2025-07-05 13:37:00.202 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='2846d343-0a20-4dc8-acea-d4c14761cfc9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:07:00.1996700Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='💰 Our product starts at ₹499/month.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='💰 Our product starts at ₹499/month.', @p16='2025-07-05T08:07:00.1996701Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:37:00.204 +05:30 [INF] ➡️ Running node: "End" | end
2025-07-05 13:37:00.205 +05:30 [INF] ✅ End node reached.
2025-07-05 13:37:00.206 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:37:00.209 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"sent","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","expiration_timestamp":"1751702811","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:00.210 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:37:00.211 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"sent","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","expiration_timestamp":"1751702811","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:00.224 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:37:00.228 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==
2025-07-05 13:37:00.229 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==
2025-07-05 13:37:00.235 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"delivered","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:00.236 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:37:00.237 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==","status":"delivered","timestamp":"1751702811","recipient_id":"917082156227","conversation":{"id":"6986f018f89b7fca3a37af3138ab0772","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:00.240 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:37:00.242 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==
2025-07-05 13:37:00.243 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODI5RTY1QzRFMDQ5QUQzRUEzAA==
2025-07-05 13:37:01.199 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:37:01.202 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:01.203 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:37:01.205 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"sent","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","expiration_timestamp":"1751702823","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.207 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:37:01.207 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"sent","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","expiration_timestamp":"1751702823","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.207 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:37:01.209 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:37:01.210 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0845ms
2025-07-05 13:37:01.210 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"sent","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","expiration_timestamp":"1751702823","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.212 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:01.214 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.9213ms
2025-07-05 13:37:01.215 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:37:01.219 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==
2025-07-05 13:37:01.220 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==
2025-07-05 13:37:01.597 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:37:01.599 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:01.600 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:37:01.602 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"delivered","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.603 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:37:01.603 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"delivered","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.604 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:37:01.605 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:37:01.606 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5876ms
2025-07-05 13:37:01.606 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==","status":"delivered","timestamp":"1751702823","recipient_id":"917082156227","conversation":{"id":"6c44e13af58f9213e2bbef37c536906e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:37:01.607 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:01.610 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.9214ms
2025-07-05 13:37:01.611 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:37:01.615 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==
2025-07-05 13:37:01.615 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMUU5RjEwRkM5MjJFNzRBOTM2AA==
2025-07-05 13:37:32.937 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:37:32.940 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:32.941 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:37:32.943 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMzNGNDAyRTA4OEEzQTNBQjYwQzgyN0YwMTAyMjg1MDkA","timestamp":"1751702854","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:37:32.945 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:37:32.945 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMzNGNDAyRTA4OEEzQTNBQjYwQzgyN0YwMTAyMjg1MDkA","timestamp":"1751702854","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:37:32.945 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:37:32.947 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:37:32.948 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.4379ms
2025-07-05 13:37:32.950 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:37:32.952 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.3569ms
2025-07-05 13:37:32.952 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:37:32.960 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:37:32.963 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:37:32.965 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:37:32.967 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:37:32.972 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='05d7c0c5-053d-42d4-a312-80d2b4c6b676', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:07:32.9696778Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:07:32.9696779Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:37:35.749 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:37:35.752 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 13:37:35.753 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 13:37:35.753 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:38:05.769 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:38:05.772 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:38:05.773 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:38:05.776 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMTU2MUQ5ODAwMzkzRURDMjFDREQxNTgyQUE1N0VBQUMA","timestamp":"1751702887","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:38:05.777 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:38:05.778 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMTU2MUQ5ODAwMzkzRURDMjFDREQxNTgyQUE1N0VBQUMA","timestamp":"1751702887","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:38:05.778 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:38:05.779 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:38:05.780 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3292ms
2025-07-05 13:38:05.782 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:38:05.783 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6219ms
2025-07-05 13:38:05.786 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:38:05.793 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:38:05.796 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:38:05.798 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:38:05.800 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:38:05.804 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='9bb429f5-b013-4a59-8980-5faa70a50486', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:08:05.8022203Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:08:05.8022205Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:38:07.537 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:38:07.539 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 13:38:07.540 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 13:38:07.540 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:38:21.575 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 13:38:21.577 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:38:21.578 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:38:21.580 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQTg3QkRBRkMwOEM3RkZGMjNDODc4QzE3N0JEOTI0MzYA","timestamp":"1751702903","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:38:21.581 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:38:21.581 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggQTg3QkRBRkMwOEM3RkZGMjNDODc4QzE3N0JEOTI0MzYA","timestamp":"1751702903","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:38:21.582 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:38:21.583 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:38:21.584 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.1471ms
2025-07-05 13:38:21.585 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:38:21.587 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:38:21.587 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.3943ms
2025-07-05 13:38:21.589 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:38:21.593 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:38:21.596 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:38:21.598 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:38:21.619 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='e95a98fb-55bc-411f-885f-7b2ae2a35dc7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:08:21.5998983Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='features' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:08:21.5998984Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:38:23.614 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='features'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:38:23.617 +05:30 [INF] TryRun: No matching flow found for keyword 'features'
2025-07-05 13:38:23.618 +05:30 [INF] 🕵️ No automation flow matched keyword: features
2025-07-05 13:38:23.618 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:54:03.463 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 13:54:03.501 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 13:54:03.514 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 13:54:04.327 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 13:54:04.946 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 13:54:05.277 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 13:54:05.279 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 13:54:05.280 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 13:54:05.280 +05:30 [INF] Hosting environment: Development
2025-07-05 13:54:05.281 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 13:54:05.293 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 13:54:05.310 +05:30 [INF] Executed DbCommand (39ms) [Parameters=[@__cutoff_0='2025-06-28T08:24:03.6178915Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 13:54:07.354 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 13:54:07.508 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 161.869ms
2025-07-05 13:54:07.532 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 13:54:07.540 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.634ms
2025-07-05 13:54:07.587 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 13:54:07.618 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.3424ms
2025-07-05 13:54:07.752 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 13:54:07.923 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 170.6194ms
2025-07-05 13:54:28.355 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:54:28.365 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 13:54:28.409 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:28.424 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:54:28.443 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMUQwMjU4QTYzQ0QwMERDNkExODZFNjkzNzRFOTA5REMA","timestamp":"1751703870","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:54:28.446 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:54:28.450 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:54:28.461 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 32.1169ms
2025-07-05 13:54:28.462 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:28.464 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 109.3655ms
2025-07-05 13:54:28.557 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMUQwMjU4QTYzQ0QwMERDNkExODZFNjkzNzRFOTA5REMA","timestamp":"1751703870","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:54:28.559 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:54:28.676 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:54:28.769 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:54:28.779 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:54:28.816 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:54:28.823 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:54:28.954 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='095b13d5-e497-483e-8414-af6f7886b2ef', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:24:28.8258364Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:24:28.8258606Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:54:30.980 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:54:30.998 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:54:31.004 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:54:31.006 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:54:31.090 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 13:54:31.092 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 13:54:31.095 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:54:31.098 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:54:31.100 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:54:32.040 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 13:54:32.047 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:54:32.049 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 13:54:33.637 +05:30 [INF] Received HTTP response headers after 1584.435ms - 200
2025-07-05 13:54:33.639 +05:30 [INF] End processing HTTP request after 1592.998ms - 200
2025-07-05 13:54:33.709 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='902b400f-3a16-4f89-a822-864ed56f5bd1', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:24:33.6941017Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:24:33.6941019Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:54:33.712 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 13:54:33.713 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 13:54:33.716 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:54:33.732 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='afe7bc89-daf4-4b5d-b52d-5adff1f56868', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='0876f654-a362-420f-a912-6bce793436a5', @p3='2025-07-05T08:24:33.7259895Z' (DbType = DateTime), @p4='awaiting_choice' (Nullable = false), @p5='choice'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ChatSessionStates" ("Id", "BusinessId", "ContactId", "LastUpdatedAt", "Mode", "UpdatedBy")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-05 13:54:33.734 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:54:34.743 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 13:54:34.752 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:34.753 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:54:34.756 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"sent","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","expiration_timestamp":"1751703877","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:34.758 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:54:34.759 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:54:34.761 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"sent","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","expiration_timestamp":"1751703877","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:34.762 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.0626ms
2025-07-05 13:54:34.763 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:54:34.764 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:34.766 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"sent","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","expiration_timestamp":"1751703877","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:34.766 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.9993ms
2025-07-05 13:54:34.780 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:54:34.785 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==
2025-07-05 13:54:34.786 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==
2025-07-05 13:54:35.227 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 13:54:35.232 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:35.233 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:54:35.236 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"delivered","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:35.237 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:54:35.238 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:54:35.239 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5088ms
2025-07-05 13:54:35.241 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:35.242 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.4175ms
2025-07-05 13:54:35.243 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"delivered","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:35.246 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 13:54:35.246 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==","status":"delivered","timestamp":"1751703877","recipient_id":"917082156227","conversation":{"id":"0948ddf545685e3bf94213b4d3ae5d3b","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 13:54:35.250 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 13:54:35.252 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==
2025-07-05 13:54:35.253 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNzZGRjMyOTUwRUM4NkVCNjI3AA==
2025-07-05 13:54:40.669 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 13:54:40.672 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:40.673 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:54:40.675 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTA4Mjg0MEYyNzVCMERDRTg3NzRFRUU4RTQwN0IyNTYA","timestamp":"1751703882","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:54:40.677 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:54:40.677 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNTA4Mjg0MEYyNzVCMERDRTg3NzRFRUU4RTQwN0IyNTYA","timestamp":"1751703882","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:54:40.678 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:54:40.679 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:54:40.680 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3124ms
2025-07-05 13:54:40.682 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:54:40.684 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.1091ms
2025-07-05 13:54:40.684 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:54:40.689 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:54:40.692 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:54:40.694 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:54:40.696 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:54:40.701 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='d3755651-1500-41e5-a101-2e51b07f387e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:24:40.6990936Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:24:40.6990937Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:54:44.065 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:54:44.067 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 13:54:44.068 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 13:54:44.069 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:55:03.096 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 13:55:03.098 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:55:03.099 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:55:03.101 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMDk5RUFBMzAzQUE3OUVCQkJCRUY1MzE0RTgzM0Q4OUUA","timestamp":"1751703905","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:55:03.102 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:55:03.102 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggMDk5RUFBMzAzQUE3OUVCQkJCRUY1MzE0RTgzM0Q4OUUA","timestamp":"1751703905","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:55:03.103 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:55:03.104 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:55:03.105 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8304ms
2025-07-05 13:55:03.108 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:55:03.109 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.2698ms
2025-07-05 13:55:03.111 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:55:03.115 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:55:03.117 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:55:03.119 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:55:03.121 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:55:03.144 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='bd4fa16a-6c7f-41de-b125-fe23af9ba7ba', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:25:03.1244338Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='features' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:25:03.1244339Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 13:55:05.004 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='features'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 13:55:05.007 +05:30 [INF] TryRun: No matching flow found for keyword 'features'
2025-07-05 13:55:05.008 +05:30 [INF] 🕵️ No automation flow matched keyword: features
2025-07-05 13:55:05.008 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 13:59:59.409 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 13:59:59.412 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:59:59.413 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 13:59:59.415 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUJDN0MzRENCNDY0N0UwMkE5RTc3QzgxMzMwMTYwMEUA","timestamp":"1751704201","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:59:59.416 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 13:59:59.417 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggOUJDN0MzRENCNDY0N0UwMkE5RTc3QzgxMzMwMTYwMEUA","timestamp":"1751704201","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 13:59:59.417 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 13:59:59.418 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 13:59:59.419 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.9722ms
2025-07-05 13:59:59.425 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 13:59:59.428 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.3409ms
2025-07-05 13:59:59.530 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 13:59:59.532 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 13:59:59.534 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 13:59:59.536 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 13:59:59.538 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 13:59:59.542 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='ccd792c8-a6be-4ad7-a133-f1b72b1e1ceb', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:29:59.5405844Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:29:59.5405845Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:01.869 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:00:01.872 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:01.875 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:01.877 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:01.879 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:00:01.880 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:00:01.881 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:01.884 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:01.887 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:03.203 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 14:00:03.206 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:00:03.207 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:00:04.412 +05:30 [INF] Received HTTP response headers after 1203.2135ms - 200
2025-07-05 14:00:04.414 +05:30 [INF] End processing HTTP request after 1207.4447ms - 200
2025-07-05 14:00:04.419 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='6df4aafe-7b0f-4119-a0f2-e35fe88aea2c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:30:04.4170400Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:30:04.4170401Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:04.422 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:00:04.423 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:00:04.425 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:00:04.431 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='afe7bc89-daf4-4b5d-b52d-5adff1f56868', @p0='2025-07-05T08:30:04.4271864Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:00:04.434 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:00:05.795 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:00:05.798 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:05.800 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:05.802 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"sent","timestamp":"1751704207","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","expiration_timestamp":"1751704207","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.803 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:05.804 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"sent","timestamp":"1751704207","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","expiration_timestamp":"1751704207","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.804 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:05.805 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:00:05.806 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1945ms
2025-07-05 14:00:05.807 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"sent","timestamp":"1751704207","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","expiration_timestamp":"1751704207","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.808 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:05.811 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.6685ms
2025-07-05 14:00:05.813 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:00:05.822 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==
2025-07-05 14:00:05.823 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==
2025-07-05 14:00:05.856 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 14:00:05.858 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:05.859 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:05.862 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"delivered","timestamp":"1751704208","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.863 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:05.863 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"delivered","timestamp":"1751704208","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.864 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:05.865 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:00:05.867 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.5905ms
2025-07-05 14:00:05.868 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==","status":"delivered","timestamp":"1751704208","recipient_id":"917082156227","conversation":{"id":"de49cd51583676806d1e0038ad68aee1","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:05.869 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:05.872 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:00:05.873 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.2556ms
2025-07-05 14:00:05.875 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==
2025-07-05 14:00:05.878 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNUI0Mzc4RUZCNUU3NEY2NTQxAA==
2025-07-05 14:00:10.826 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 14:00:10.829 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:10.830 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:10.832 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREQ2QzUzMzg3MzFBMDNDNUEzRjVCRURERjQyQTY1RjMA","timestamp":"1751704213","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:10.834 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:10.834 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggREQ2QzUzMzg3MzFBMDNDNUEzRjVCRURERjQyQTY1RjMA","timestamp":"1751704213","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:10.835 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:10.836 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:00:10.837 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.2935ms
2025-07-05 14:00:10.840 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:10.841 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:00:10.842 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.3662ms
2025-07-05 14:00:10.845 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:10.850 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:10.852 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:10.854 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:00:10.875 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='6ba96652-957a-498e-a6d8-d8d9d97cf52f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:30:10.8564995Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:30:10.8564996Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:12.747 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:00:12.750 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 14:00:12.751 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:00:12.752 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:00:37.363 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 14:00:37.365 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:37.366 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:37.367 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUQ3NTFGNzQ3M0JFNEM4ODdEMEUzQTZEQTY4MDdERjQA","timestamp":"1751704239","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:37.368 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:37.369 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUQ3NTFGNzQ3M0JFNEM4ODdEMEUzQTZEQTY4MDdERjQA","timestamp":"1751704239","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:37.369 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:37.370 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:00:37.371 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.9217ms
2025-07-05 14:00:37.374 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:37.374 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:00:37.378 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.0915ms
2025-07-05 14:00:37.380 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:37.384 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:37.385 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:37.387 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:00:37.410 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='912ae171-43ad-4de2-b560-6eac4497de9d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:30:37.3893815Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:30:37.3893816Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:39.224 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:00:39.226 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:39.229 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:39.231 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:39.232 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:00:39.233 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:00:39.234 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:39.236 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:39.238 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:39.899 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:00:39.901 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:00:40.845 +05:30 [INF] Received HTTP response headers after 943.1285ms - 200
2025-07-05 14:00:40.846 +05:30 [INF] End processing HTTP request after 946.412ms - 200
2025-07-05 14:00:40.867 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='443bfbba-2fdd-44ac-b573-fff764e77cc3', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:30:40.8485256Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:30:40.8485259Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:40.869 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:00:40.870 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:00:40.873 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:00:40.877 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='afe7bc89-daf4-4b5d-b52d-5adff1f56868', @p0='2025-07-05T08:30:40.8755144Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:00:40.879 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:00:41.816 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:00:41.818 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:41.819 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:41.821 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"sent","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","expiration_timestamp":"1751704244","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:41.822 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:41.823 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"sent","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","expiration_timestamp":"1751704244","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:41.823 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:41.825 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:00:41.826 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.5903ms
2025-07-05 14:00:41.827 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"sent","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","expiration_timestamp":"1751704244","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:41.828 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:41.829 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.4685ms
2025-07-05 14:00:41.830 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:00:41.836 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==
2025-07-05 14:00:41.838 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==
2025-07-05 14:00:42.596 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 14:00:42.598 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:42.599 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:42.601 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"delivered","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:42.602 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:42.602 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"delivered","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:42.603 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:42.604 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:00:42.605 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.3122ms
2025-07-05 14:00:42.605 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==","status":"delivered","timestamp":"1751704244","recipient_id":"917082156227","conversation":{"id":"bb4eeb048a0f6a965d977bbc56d1a7a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:00:42.606 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:42.607 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.1195ms
2025-07-05 14:00:42.608 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:00:42.612 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==
2025-07-05 14:00:42.612 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTMxRDZFOTkzMTgzODRGNTgzAA==
2025-07-05 14:00:48.420 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 14:00:48.422 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:48.423 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:00:48.425 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjI2QjRCNzAwQ0U5ODBDRTE1RTFFQ0NCQkVCMDZBOUQA","timestamp":"1751704250","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:48.426 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:00:48.427 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjI2QjRCNzAwQ0U5ODBDRTE1RTFFQ0NCQkVCMDZBOUQA","timestamp":"1751704250","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:00:48.427 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:00:48.429 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:00:48.430 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.5034ms
2025-07-05 14:00:48.432 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:00:48.433 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:00:48.437 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.4812ms
2025-07-05 14:00:48.443 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:00:48.448 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:00:48.450 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:00:48.453 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:00:48.456 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='c8fe881c-7138-4c9d-8183-6a0649254414', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:30:48.4549508Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:30:48.4549509Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:00:50.243 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:00:50.246 +05:30 [INF] TryRun: No matching flow found for keyword 'price'
2025-07-05 14:00:50.246 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:00:50.247 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:01:02.919 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 14:01:02.921 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:01:02.922 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:01:02.924 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzI4QUQwNzRFNjU1MEZCNzZEQzQ4RDExMEYwRjFFRUUA","timestamp":"1751704265","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:01:02.925 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:01:02.926 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzI4QUQwNzRFNjU1MEZCNzZEQzQ4RDExMEYwRjFFRUUA","timestamp":"1751704265","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:01:02.926 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:01:02.927 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:01:02.928 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.426ms
2025-07-05 14:01:02.930 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:01:02.932 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:01:02.933 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.5179ms
2025-07-05 14:01:02.935 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:01:02.942 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:01:02.943 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:01:02.946 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:01:02.950 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='613aed9b-1cbf-41d1-bab2-671543b70ef6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:31:02.9487701Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='features' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:31:02.9487703Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:01:03.998 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='features'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:01:04.000 +05:30 [INF] TryRun: No matching flow found for keyword 'features'
2025-07-05 14:01:04.001 +05:30 [INF] 🕵️ No automation flow matched keyword: features
2025-07-05 14:01:04.002 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:18:13.175 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 14:18:13.223 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 14:18:13.238 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 14:18:13.913 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 14:18:14.403 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 14:18:14.596 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 14:18:14.597 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 14:18:14.599 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 14:18:14.600 +05:30 [INF] Hosting environment: Development
2025-07-05 14:18:14.602 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 14:18:14.659 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 14:18:14.681 +05:30 [INF] Executed DbCommand (43ms) [Parameters=[@__cutoff_0='2025-06-28T08:48:13.3336975Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 14:18:16.903 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 14:18:17.081 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 186.4842ms
2025-07-05 14:18:17.116 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 14:18:17.131 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 14.7964ms
2025-07-05 14:18:17.173 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 14:18:17.206 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.5382ms
2025-07-05 14:18:17.321 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 14:18:17.496 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 174.8501ms
2025-07-05 14:18:29.712 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 14:18:29.717 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 14:18:29.758 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:29.769 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:18:29.783 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTNCRDIwNUM2MjMwREE4QjA5QTM4MjI4QjM4MkQ1NUIA","timestamp":"1751705312","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:18:29.786 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:18:29.791 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:18:29.800 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 27.1066ms
2025-07-05 14:18:29.802 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:29.803 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 91.6376ms
2025-07-05 14:18:29.886 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRTNCRDIwNUM2MjMwREE4QjA5QTM4MjI4QjM4MkQ1NUIA","timestamp":"1751705312","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:18:29.887 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:18:29.986 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:18:30.080 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:18:30.091 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:18:30.125 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:18:30.134 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:18:30.283 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='6e637154-838b-4f89-8497-3e6b97cdc7db', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:48:30.1440976Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:48:30.1441207Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:18:32.973 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:18:32.991 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:18:32.996 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:18:32.998 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:18:33.000 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:18:33.098 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:18:33.100 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:18:33.103 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:18:33.107 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:18:33.109 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:18:35.187 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 14:18:35.194 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:18:35.198 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:18:36.557 +05:30 [INF] Received HTTP response headers after 1355.0186ms - 200
2025-07-05 14:18:36.559 +05:30 [INF] End processing HTTP request after 1366.2717ms - 200
2025-07-05 14:18:36.643 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='564df010-a085-457f-ada3-a6d6a504ea43', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:48:36.6118736Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:48:36.6118739Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:18:36.647 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:18:36.648 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:18:36.651 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:18:36.658 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='afe7bc89-daf4-4b5d-b52d-5adff1f56868', @p0='2025-07-05T08:48:36.6529980Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:18:36.660 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:18:37.826 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:18:37.833 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:37.835 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:18:37.837 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"sent","timestamp":"1751705319","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","expiration_timestamp":"1751705319","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:37.839 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:18:37.840 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:18:37.840 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"sent","timestamp":"1751705319","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","expiration_timestamp":"1751705319","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:37.841 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.2601ms
2025-07-05 14:18:37.842 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:18:37.843 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:37.844 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.5393ms
2025-07-05 14:18:37.845 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"sent","timestamp":"1751705319","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","expiration_timestamp":"1751705319","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:37.860 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:18:37.862 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==
2025-07-05 14:18:37.863 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==
2025-07-05 14:18:38.202 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 14:18:38.207 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:38.207 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:18:38.210 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"delivered","timestamp":"1751705320","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:38.211 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:18:38.212 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:18:38.212 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.6496ms
2025-07-05 14:18:38.214 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:38.214 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.7489ms
2025-07-05 14:18:38.216 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"delivered","timestamp":"1751705320","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:38.218 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:18:38.219 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==","status":"delivered","timestamp":"1751705320","recipient_id":"917082156227","conversation":{"id":"ef160ef5072bc1c85e0da154b7d9d275","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:18:38.223 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:18:38.225 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==
2025-07-05 14:18:38.226 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDY5OTU0RTNENTY2MjdGOTBFAA==
2025-07-05 14:18:42.254 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 14:18:42.256 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:42.257 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:18:42.260 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRDRGMkJEODg4MTU5MUVCRkFGRjgyM0REQ0Q3QjVDNTEA","timestamp":"1751705324","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:18:42.261 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:18:42.261 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRDRGMkJEODg4MTU5MUVCRkFGRjgyM0REQ0Q3QjVDNTEA","timestamp":"1751705324","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:18:42.262 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:18:42.263 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:18:42.265 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.3784ms
2025-07-05 14:18:42.267 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:18:42.269 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:18:42.269 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.4851ms
2025-07-05 14:18:42.271 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:18:42.276 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:18:42.278 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:18:42.281 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:18:42.285 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='050fc61b-c2df-46ba-bfc3-2b650b2266bc', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:48:42.2829985Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:48:42.2829985Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:18:43.967 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:18:43.969 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:18:43.970 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:18:43.971 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:19:01.737 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 500
2025-07-05 14:19:01.739 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:01.740 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:19:01.741 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzZBRUQ4NTkyQjlEQUI5OEVBNEUyNUJDQUJBQUMzRjcA","timestamp":"1751705343","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:01.743 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:19:01.743 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggNzZBRUQ4NTkyQjlEQUI5OEVBNEUyNUJDQUJBQUMzRjcA","timestamp":"1751705343","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:01.743 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:19:01.744 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:19:01.745 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.9324ms
2025-07-05 14:19:01.746 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:01.747 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.4162ms
2025-07-05 14:19:01.750 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:19:01.753 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:19:01.755 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:19:01.759 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:19:01.761 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:19:01.782 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='bcb63a64-d772-4007-9483-cfc90f8bb124', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:49:01.7629328Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:49:01.7629330Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:19:04.593 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:19:04.596 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:19:04.598 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:19:04.600 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:19:04.601 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:19:04.602 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:19:04.603 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:19:04.604 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:19:04.606 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:19:04.608 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:19:05.460 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:19:05.461 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:19:06.401 +05:30 [INF] Received HTTP response headers after 938.8387ms - 200
2025-07-05 14:19:06.403 +05:30 [INF] End processing HTTP request after 942.9529ms - 200
2025-07-05 14:19:06.407 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='1c75fc7a-4760-4370-a062-eb566abdd3ba', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:49:06.4050213Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T08:49:06.4050215Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:19:06.409 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:19:06.410 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:19:06.411 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:19:06.414 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='afe7bc89-daf4-4b5d-b52d-5adff1f56868', @p0='2025-07-05T08:49:06.4133061Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:19:06.416 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:19:07.534 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:19:07.537 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:07.538 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:19:07.540 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"sent","timestamp":"1751705349","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","expiration_timestamp":"1751705349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:07.541 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:19:07.541 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"sent","timestamp":"1751705349","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","expiration_timestamp":"1751705349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:07.542 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:19:07.543 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:19:07.544 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.114ms
2025-07-05 14:19:07.545 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"sent","timestamp":"1751705349","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","expiration_timestamp":"1751705349","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:07.546 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:07.549 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.1491ms
2025-07-05 14:19:07.550 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:19:07.554 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==
2025-07-05 14:19:07.555 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==
2025-07-05 14:19:08.001 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 14:19:08.004 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:08.006 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:19:08.007 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"delivered","timestamp":"1751705350","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:08.008 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:19:08.008 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"delivered","timestamp":"1751705350","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:08.009 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:19:08.010 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:19:08.011 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.8735ms
2025-07-05 14:19:08.011 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==","status":"delivered","timestamp":"1751705350","recipient_id":"917082156227","conversation":{"id":"38145df80e0d5d0762b72f15723d10df","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:19:08.012 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:08.014 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.2173ms
2025-07-05 14:19:08.015 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:19:08.021 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==
2025-07-05 14:19:08.022 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSRTg5NzdBOEQzNTA3MDRDOTg2AA==
2025-07-05 14:19:13.136 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 494
2025-07-05 14:19:13.139 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:13.140 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:19:13.141 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUQ3MjcwQTBBNTI1ODhDMTEzNEY3NzY1MjA4QzQ0QjEA","timestamp":"1751705355","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:13.143 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:19:13.143 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRUQ3MjcwQTBBNTI1ODhDMTEzNEY3NzY1MjA4QzQ0QjEA","timestamp":"1751705355","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:13.143 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:19:13.145 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:19:13.146 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.9028ms
2025-07-05 14:19:13.148 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:13.149 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:19:13.150 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.344ms
2025-07-05 14:19:13.153 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:19:13.159 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:19:13.160 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:19:13.162 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:19:13.167 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='fe8d0f5e-64f5-432b-8c5d-9e0f2c761d7b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:49:13.1647193Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:49:13.1647194Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:19:15.028 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:19:15.031 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:19:15.032 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:19:15.033 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:19:23.045 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 14:19:23.047 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:23.047 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:19:23.049 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjI4QTEzRTlGMEZCMDI2QjBCM0FBMkY3NzE2MzEwMzgA","timestamp":"1751705365","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:23.050 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:19:23.050 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"\ua9c1S.K\ua9c2"},"wa_id":"917082156227"}],"messages":[{"from":"917082156227","id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAEhggRjI4QTEzRTlGMEZCMDI2QjBCM0FBMkY3NzE2MzEwMzgA","timestamp":"1751705365","text":{"body":"features"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:19:23.051 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:19:23.052 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:19:23.053 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2092ms
2025-07-05 14:19:23.054 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:19:23.056 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:19:23.056 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.7611ms
2025-07-05 14:19:23.058 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=917082156227
2025-07-05 14:19:23.062 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:19:23.064 +05:30 [INF] Contact already exists: contactId="0876f654-a362-420f-a912-6bce793436a5"
2025-07-05 14:19:23.065 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='0876f654-a362-420f-a912-6bce793436a5'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:19:23.086 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='5028daa4-b70d-4f28-a3de-f1b6863fb2fa', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='0876f654-a362-420f-a912-6bce793436a5' (Nullable = true), @p6='2025-07-05T08:49:23.0674168Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='features' (Nullable = false), @p11=NULL, @p12=NULL, @p13='917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T08:49:23.0674169Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:19:24.385 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='features'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:19:24.386 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'features'
2025-07-05 14:19:24.387 +05:30 [INF] 🕵️ No automation flow matched keyword: features
2025-07-05 14:19:24.388 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:41:11.034 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 14:41:11.102 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 14:41:11.120 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 14:41:11.955 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 14:41:12.428 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 14:41:12.613 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 14:41:12.614 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 14:41:12.615 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 14:41:12.616 +05:30 [INF] Hosting environment: Development
2025-07-05 14:41:12.616 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 14:41:12.683 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 14:41:12.706 +05:30 [INF] Executed DbCommand (48ms) [Parameters=[@__cutoff_0='2025-06-28T09:11:11.2787882Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 14:41:15.004 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 14:41:15.161 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 165.161ms
2025-07-05 14:41:15.181 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 14:41:15.189 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 7.7074ms
2025-07-05 14:41:15.256 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 14:41:15.287 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.8006ms
2025-07-05 14:41:15.435 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 14:41:15.607 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 172.2863ms
2025-07-05 14:42:52.209 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 14:42:52.219 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 14:42:52.253 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:52.263 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:42:52.281 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNENDQkE1RUMyNUJEMDIwOEJDRkY0Mjc1RDM1NEVEM0QA","timestamp":"1751706774","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:42:52.285 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:42:52.290 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:42:52.299 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 32.1608ms
2025-07-05 14:42:52.301 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:52.303 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 93.6443ms
2025-07-05 14:42:52.387 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNENDQkE1RUMyNUJEMDIwOEJDRkY0Mjc1RDM1NEVEM0QA","timestamp":"1751706774","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:42:52.388 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:42:52.481 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:42:52.577 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:42:52.587 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:42:52.619 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:42:52.625 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:42:52.783 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='1ac77b60-b91c-45f1-b3d0-7c40a2bdb41f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:12:52.6278704Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:12:52.6278964Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:42:54.463 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:42:54.477 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:42:54.481 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:42:54.483 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:42:54.484 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:42:54.561 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:42:54.563 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:42:54.566 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:42:54.569 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:42:54.571 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:42:56.277 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 14:42:56.283 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:42:56.284 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:42:57.789 +05:30 [INF] Received HTTP response headers after 1501.8379ms - 200
2025-07-05 14:42:57.792 +05:30 [INF] End processing HTTP request after 1509.7245ms - 200
2025-07-05 14:42:57.877 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='44bbc62d-e6f3-40a5-92e3-2d237efa4626', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:12:57.8463746Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T09:12:57.8463748Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:42:57.881 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:42:57.882 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:42:57.885 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:42:57.901 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='d80a6bb5-34e5-4855-beb9-41d67a7a650e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='a307d00b-239b-4c7b-bb16-77838875fbec', @p3='2025-07-05T09:12:57.8953615Z' (DbType = DateTime), @p4='awaiting_choice' (Nullable = false), @p5='choice'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ChatSessionStates" ("Id", "BusinessId", "ContactId", "LastUpdatedAt", "Mode", "UpdatedBy")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-05 14:42:57.903 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:42:58.876 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:42:58.885 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:58.886 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:42:58.889 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"sent","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","expiration_timestamp":"1751706781","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:58.891 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:42:58.892 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:42:58.893 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"sent","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","expiration_timestamp":"1751706781","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:58.894 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.0406ms
2025-07-05 14:42:58.895 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:42:58.895 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:58.897 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"sent","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","expiration_timestamp":"1751706781","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:58.897 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.3424ms
2025-07-05 14:42:58.927 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:42:58.931 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==
2025-07-05 14:42:58.932 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==
2025-07-05 14:42:59.380 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 14:42:59.385 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:59.386 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:42:59.389 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"read","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:59.391 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:42:59.392 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:42:59.393 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.6081ms
2025-07-05 14:42:59.394 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:42:59.395 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 15.6071ms
2025-07-05 14:42:59.397 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"read","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:59.399 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:42:59.400 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==","status":"read","timestamp":"1751706781","recipient_id":"918974005240","conversation":{"id":"195940c49f0b01e4dfaa501c83ef181a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:42:59.403 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:42:59.405 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==
2025-07-05 14:42:59.406 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOEUwRjFEQkVEQ0FGODEzMzU2AA==
2025-07-05 14:43:07.947 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:43:07.950 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:43:07.951 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:43:07.952 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNUY5N0MzQ0I4RjU2MjlBMzRDNzYwQTZFODU3MDcwRDcA","timestamp":"1751706789","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:43:07.954 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:43:07.954 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNUY5N0MzQ0I4RjU2MjlBMzRDNzYwQTZFODU3MDcwRDcA","timestamp":"1751706789","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:43:07.955 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:43:07.956 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:43:07.957 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.14ms
2025-07-05 14:43:07.959 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:43:07.960 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.3247ms
2025-07-05 14:43:07.961 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:43:07.965 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:43:07.967 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:43:07.970 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:43:07.972 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:43:07.994 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='72d53c57-b56e-4f09-8e28-3653004c6b50', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:13:07.9747306Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:13:07.9747307Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:43:23.119 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:43:38.047 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:43:41.791 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:43:45.071 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:44:07.553 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 14:44:07.556 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:07.557 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:07.559 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDU0Q0E4QzQyNzYzQUZCMDBENjA4Qjg2OUUyRjdBQjcA","timestamp":"1751706849","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:07.560 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:07.560 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDU0Q0E4QzQyNzYzQUZCMDBENjA4Qjg2OUUyRjdBQjcA","timestamp":"1751706849","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:07.561 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:07.562 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:44:07.564 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.0888ms
2025-07-05 14:44:07.565 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:07.566 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.871ms
2025-07-05 14:44:07.569 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:44:07.572 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:07.575 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:07.577 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:07.579 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:44:07.583 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='f32e2534-5759-4417-8430-850fd7f154b9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:14:07.5814981Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:14:07.5814983Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:44:09.825 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:44:09.827 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:09.830 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:09.832 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:09.832 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:44:09.834 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:44:09.835 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:44:09.836 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:09.838 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:09.841 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:11.022 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:44:11.023 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:44:12.507 +05:30 [INF] Received HTTP response headers after 1482.6479ms - 200
2025-07-05 14:44:12.508 +05:30 [INF] End processing HTTP request after 1486.1955ms - 200
2025-07-05 14:44:12.513 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='39b413f0-7d5f-488d-9dd0-08fad87a69c4', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:14:12.5106663Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T09:14:12.5106665Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:44:12.515 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:44:12.516 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:44:12.519 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:44:12.525 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='d80a6bb5-34e5-4855-beb9-41d67a7a650e', @p0='2025-07-05T09:14:12.5210406Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:44:12.526 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:44:13.799 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:44:13.802 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:13.803 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:13.804 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"sent","timestamp":"1751706855","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","expiration_timestamp":"1751706855","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:13.806 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:13.806 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"sent","timestamp":"1751706855","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","expiration_timestamp":"1751706855","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:13.806 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:13.808 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:44:13.809 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.766ms
2025-07-05 14:44:13.809 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"sent","timestamp":"1751706855","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","expiration_timestamp":"1751706855","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:13.811 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:13.813 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.412ms
2025-07-05 14:44:13.816 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:44:13.823 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==
2025-07-05 14:44:13.824 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==
2025-07-05 14:44:13.998 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 14:44:14.001 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:14.002 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:14.005 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"read","timestamp":"1751706856","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:14.007 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:14.007 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"read","timestamp":"1751706856","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:14.008 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:14.009 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:44:14.010 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.2612ms
2025-07-05 14:44:14.011 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==","status":"read","timestamp":"1751706856","recipient_id":"918974005240","conversation":{"id":"f408555ed6d58fff98fff62d9ff9790d","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:14.012 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:14.016 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:44:14.016 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.974ms
2025-07-05 14:44:14.018 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==
2025-07-05 14:44:14.021 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSOTk1QjEyOEY1RDk5MDg3M0JGAA==
2025-07-05 14:44:19.550 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:44:19.552 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:19.553 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:19.554 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMTkxQTU1QTlBQzI1MEM2OEMwNjU1QjBEQUJBNUREMjQA","timestamp":"1751706861","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:19.555 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:19.555 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMTkxQTU1QTlBQzI1MEM2OEMwNjU1QjBEQUJBNUREMjQA","timestamp":"1751706861","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:19.556 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:19.557 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:44:19.558 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.5024ms
2025-07-05 14:44:19.560 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:19.562 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:44:19.563 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.0001ms
2025-07-05 14:44:19.565 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:19.570 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:19.572 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:19.574 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:44:19.596 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='1a65a1ba-f8e2-40a1-9a95-baef3d6f7f0e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:14:19.5764114Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:14:19.5764115Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:44:22.829 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:44:22.831 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:44:22.832 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:44:22.833 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:44:47.879 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 14:44:47.882 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:47.883 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:47.885 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggOUNFRkM3QTMzNURERTdFMzYzRjY1NTZGMUNDREI4MTYA","timestamp":"1751706889","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:47.886 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:47.886 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggOUNFRkM3QTMzNURERTdFMzYzRjY1NTZGMUNDREI4MTYA","timestamp":"1751706889","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:44:47.887 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:47.888 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:44:47.889 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.111ms
2025-07-05 14:44:47.891 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:47.893 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:44:47.893 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.0692ms
2025-07-05 14:44:47.895 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:47.900 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:47.902 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:47.904 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:44:47.931 +05:30 [INF] Executed DbCommand (23ms) [Parameters=[@p0='29b023d3-4275-4a53-bd50-42b5d17c3de9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:14:47.9066669Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:14:47.9066671Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:44:51.683 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:44:51.686 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:51.689 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:51.691 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:51.692 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:44:51.693 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:44:51.694 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:44:51.694 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:44:51.696 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:44:51.698 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:44:52.311 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:44:52.312 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:44:53.242 +05:30 [INF] Received HTTP response headers after 928.8825ms - 200
2025-07-05 14:44:53.243 +05:30 [INF] End processing HTTP request after 931.8061ms - 200
2025-07-05 14:44:53.265 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='9e45453c-832f-4e5a-93b5-9e6b02bccff6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:14:53.2455397Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T09:14:53.2455398Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:44:53.268 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:44:53.269 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:44:53.271 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:44:53.274 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='d80a6bb5-34e5-4855-beb9-41d67a7a650e', @p0='2025-07-05T09:14:53.2730296Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:44:53.276 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:44:54.281 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:44:54.283 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:54.284 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:54.286 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"sent","timestamp":"1751706896","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","expiration_timestamp":"1751706896","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.287 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:54.288 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"sent","timestamp":"1751706896","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","expiration_timestamp":"1751706896","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.288 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:54.289 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:44:54.290 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.0394ms
2025-07-05 14:44:54.290 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"sent","timestamp":"1751706896","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","expiration_timestamp":"1751706896","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.291 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:54.293 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 11.4384ms
2025-07-05 14:44:54.294 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:44:54.301 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==
2025-07-05 14:44:54.302 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==
2025-07-05 14:44:54.754 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 14:44:54.756 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:54.756 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:44:54.758 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"read","timestamp":"1751706897","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.759 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:44:54.759 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"read","timestamp":"1751706897","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.760 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:44:54.760 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:44:54.761 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.8106ms
2025-07-05 14:44:54.762 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==","status":"read","timestamp":"1751706897","recipient_id":"918974005240","conversation":{"id":"178f0c1719369468cad3df8d4a6c12a7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:44:54.763 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:44:54.765 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 10.8432ms
2025-07-05 14:44:54.766 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:44:54.775 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==
2025-07-05 14:44:54.775 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSMUJFMEQ2N0U3RTUyQzFCQzEzAA==
2025-07-05 14:45:09.579 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:45:09.582 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:09.583 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:45:09.585 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggN0U0RUQ2NEUyMzk5OUIwRkVDN0UwNTczMkE0QTQzRUUA","timestamp":"1751706911","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:09.586 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:45:09.586 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggN0U0RUQ2NEUyMzk5OUIwRkVDN0UwNTczMkE0QTQzRUUA","timestamp":"1751706911","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:09.587 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:45:09.588 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:45:09.589 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.887ms
2025-07-05 14:45:09.591 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:09.592 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:45:09.593 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.4233ms
2025-07-05 14:45:09.595 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:45:09.599 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:45:09.601 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:45:09.603 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:45:09.608 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='96b4e774-5d37-4e52-b6d5-1cdb312a3843', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:15:09.6053842Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:15:09.6053844Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:45:12.748 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:45:12.750 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:45:12.751 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:45:12.751 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:45:25.466 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 14:45:25.468 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:25.469 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:45:25.471 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRDlFN0VGMkIyOENFQ0Q0Q0FFRkM3NEQ0ODI3QzlBRDQA","timestamp":"1751706927","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:25.472 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:45:25.473 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRDlFN0VGMkIyOENFQ0Q0Q0FFRkM3NEQ0ODI3QzlBRDQA","timestamp":"1751706927","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:25.473 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:45:25.474 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:45:25.476 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1483ms
2025-07-05 14:45:25.478 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:25.479 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:45:25.480 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.3049ms
2025-07-05 14:45:25.482 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:45:25.486 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:45:25.487 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:45:25.489 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:45:25.493 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='6e09f729-0b6b-405e-a0a2-b96877d70070', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:15:25.4913768Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:15:25.4913769Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:45:27.596 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:45:27.599 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:45:27.602 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:45:27.604 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:45:27.605 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:45:27.606 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:45:27.607 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:45:27.608 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:45:27.611 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:45:27.613 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:45:29.011 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:45:29.012 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:45:30.261 +05:30 [INF] Received HTTP response headers after 1248.6456ms - 200
2025-07-05 14:45:30.263 +05:30 [INF] End processing HTTP request after 1252.0753ms - 200
2025-07-05 14:45:30.286 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='0ec8d835-794d-4501-8139-a50341f17700', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:15:30.2655786Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T09:15:30.2655787Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:45:30.288 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:45:30.289 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:45:30.292 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:45:30.296 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='d80a6bb5-34e5-4855-beb9-41d67a7a650e', @p0='2025-07-05T09:15:30.2945776Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:45:30.298 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:45:31.545 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:45:31.546 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 14:45:31.548 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:31.550 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:31.551 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:45:31.552 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:45:31.553 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"sent","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","expiration_timestamp":"1751706933","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.555 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"read","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.556 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:45:31.556 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"sent","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","expiration_timestamp":"1751706933","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.557 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:45:31.558 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:45:31.559 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:45:31.559 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:45:31.560 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.1008ms
2025-07-05 14:45:31.561 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"sent","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","expiration_timestamp":"1751706933","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.561 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.1351ms
2025-07-05 14:45:31.565 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:45:31.562 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:31.565 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:31.567 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==
2025-07-05 14:45:31.568 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.8047ms
2025-07-05 14:45:31.569 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.0531ms
2025-07-05 14:45:31.570 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==
2025-07-05 14:45:31.579 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"read","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.580 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:45:31.581 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==","status":"read","timestamp":"1751706933","recipient_id":"918974005240","conversation":{"id":"7383c48f29497de2f92ae73cc00c958a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:45:31.583 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:45:31.586 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==
2025-07-05 14:45:31.587 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSODYxNUQyRTNDOTgwMTVFRkEyAA==
2025-07-05 14:45:37.070 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:45:37.072 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:37.073 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:45:37.075 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDdENUE2OTE3ODEyODg4QkEyMTExRDczRjA4RTVERDYA","timestamp":"1751706939","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:37.076 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:45:37.077 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDdENUE2OTE3ODEyODg4QkEyMTExRDczRjA4RTVERDYA","timestamp":"1751706939","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:45:37.077 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:45:37.078 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:45:37.080 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.8587ms
2025-07-05 14:45:37.083 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:45:37.083 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:45:37.084 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.5253ms
2025-07-05 14:45:37.086 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:45:37.090 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:45:37.092 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:45:37.094 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:45:37.116 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='aa832272-a6be-4f82-83b2-b586f47144dd', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:15:37.0965333Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:15:37.0965335Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:45:38.587 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:45:38.589 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:45:38.590 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:45:38.592 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:50:22.743 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:50:22.749 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:50:22.750 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:50:22.751 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkYzOENEQkI0MTAwMDQzQTM1Q0MxMjIyOUVENzdEMzIA","timestamp":"1751707224","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:50:22.752 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:50:22.753 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkYzOENEQkI0MTAwMDQzQTM1Q0MxMjIyOUVENzdEMzIA","timestamp":"1751707224","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:50:22.753 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:50:22.754 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:50:22.755 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2887ms
2025-07-05 14:50:22.758 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:50:22.762 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.5635ms
2025-07-05 14:50:22.862 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:50:22.864 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:50:22.866 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:50:22.867 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:50:22.869 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:50:22.873 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='4d0cf1ef-c849-4671-b6f8-d85abf3e7ab5', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:20:22.8714648Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:20:22.8714649Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:50:24.478 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:50:24.480 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:50:24.481 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:50:24.481 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:55:17.824 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 14:55:17.829 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:17.830 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:55:17.832 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDE1NTczNTg5QjgzREE5MDlERjk1RjgyM0NDMDYwNDYA","timestamp":"1751707520","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:55:17.833 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:55:17.833 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDE1NTczNTg5QjgzREE5MDlERjk1RjgyM0NDMDYwNDYA","timestamp":"1751707520","text":{"body":"startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:55:17.834 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:55:17.835 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:55:17.836 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.7967ms
2025-07-05 14:55:17.870 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:17.871 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:55:17.874 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 49.6566ms
2025-07-05 14:55:17.876 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:55:17.881 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:55:17.883 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:55:17.884 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:55:17.888 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='d50a1eb4-9cc7-4caf-91d1-a8a7729b1e02', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:25:17.8866207Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:25:17.8866209Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:55:22.178 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:55:22.181 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:55:22.183 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:55:22.185 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:55:22.186 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 14:55:22.187 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 14:55:22.188 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 14:55:22.188 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:55:22.190 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:55:22.193 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:55:24.858 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 14:55:24.859 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:55:24.860 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 14:55:26.136 +05:30 [INF] Received HTTP response headers after 1274.7914ms - 200
2025-07-05 14:55:26.137 +05:30 [INF] End processing HTTP request after 1277.5149ms - 200
2025-07-05 14:55:26.141 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='08e77479-9dda-4e9e-b2b1-e5d99cb84b1c', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:25:26.1390955Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918974005240\",\"wa_id\":\"918974005240\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==\"}]}","MessageId":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T09:25:26.1390956Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:55:26.143 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 14:55:26.144 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 14:55:26.146 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:55:26.150 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p1='d80a6bb5-34e5-4855-beb9-41d67a7a650e', @p0='2025-07-05T09:25:26.1484860Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 14:55:26.151 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:55:26.967 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 14:55:26.970 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:26.971 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:55:26.972 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"sent","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","expiration_timestamp":"1751707529","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:26.974 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:55:26.974 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"sent","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","expiration_timestamp":"1751707529","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:26.975 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:55:26.976 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:55:26.977 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1794ms
2025-07-05 14:55:26.978 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"sent","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","expiration_timestamp":"1751707529","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:26.979 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:26.980 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.9589ms
2025-07-05 14:55:26.981 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:55:26.985 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==
2025-07-05 14:55:26.986 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==
2025-07-05 14:55:27.560 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 14:55:27.563 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:27.564 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:55:27.566 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"read","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:27.567 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:55:27.567 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"read","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:27.567 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:55:27.568 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 14:55:27.569 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2047ms
2025-07-05 14:55:27.570 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==","status":"read","timestamp":"1751707529","recipient_id":"918974005240","conversation":{"id":"b695582fdb190c4ba10ea2612ef7633a","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 14:55:27.571 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:27.573 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 14:55:27.573 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 12.8943ms
2025-07-05 14:55:27.575 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==
2025-07-05 14:55:27.578 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4OTc0MDA1MjQwFQIAERgSNzk1M0I3MkZBQzc3MkIzQkExAA==
2025-07-05 14:55:33.827 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 482
2025-07-05 14:55:33.830 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:33.831 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:55:33.833 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkUwREVDNjlCMzIzMTk3QzI0NDc2REYyN0FCOUJFQTgA","timestamp":"1751707536","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:55:33.834 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:55:33.834 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggRkUwREVDNjlCMzIzMTk3QzI0NDc2REYyN0FCOUJFQTgA","timestamp":"1751707536","text":{"body":"price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:55:33.835 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:55:33.836 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:55:33.838 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.1664ms
2025-07-05 14:55:33.840 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:55:33.841 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:55:33.842 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 14.525ms
2025-07-05 14:55:33.844 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:55:33.848 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:55:33.849 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:55:33.851 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:55:33.858 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='f9941dc1-d081-4165-b2de-8f0ac4d270ac', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:25:33.8532225Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:25:33.8532227Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:55:34.599 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:55:34.601 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 14:55:34.602 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 14:55:34.603 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:56:37.207 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 483
2025-07-05 14:56:37.209 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:37.209 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:56:37.211 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDg4OEJBMTI0NDgwMjA2NkI1NEY1NTk1RUY3QkUyNEIA","timestamp":"1751707599","text":{"body":"choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:37.212 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:56:37.212 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggNDg4OEJBMTI0NDgwMjA2NkI1NEY1NTk1RUY3QkUyNEIA","timestamp":"1751707599","text":{"body":"choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:37.213 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:56:37.214 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:56:37.214 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 3.8688ms
2025-07-05 14:56:37.219 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:37.221 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:56:37.224 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.7999ms
2025-07-05 14:56:37.227 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:56:37.231 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:56:37.232 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:56:37.234 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:56:37.237 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='ccd571c6-ef88-4b63-ac31-161869727dc4', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:26:37.2358601Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='choice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:26:37.2358603Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:56:38.463 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='choice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:56:38.465 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'choice'
2025-07-05 14:56:38.466 +05:30 [INF] 🕵️ No automation flow matched keyword: choice
2025-07-05 14:56:38.467 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:56:52.087 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 483
2025-07-05 14:56:52.090 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:52.091 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:56:52.092 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMDU1MDA4NzJCOUM4MUNBRURDQjUyMDMxOTU1NkU0NzEA","timestamp":"1751707613","text":{"body":"chooce"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:52.094 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:56:52.094 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMDU1MDA4NzJCOUM4MUNBRURDQjUyMDMxOTU1NkU0NzEA","timestamp":"1751707613","text":{"body":"chooce"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:52.095 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:56:52.096 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:56:52.097 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6402ms
2025-07-05 14:56:52.099 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:56:52.099 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:52.101 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:56:52.101 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.7897ms
2025-07-05 14:56:52.103 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:56:52.109 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:56:52.111 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:56:52.114 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='6e383b8f-fd90-4b93-9b75-3844ddfb0150', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:26:52.1132204Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='chooce' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:26:52.1132205Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:56:57.249 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='chooce'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:56:57.251 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'chooce'
2025-07-05 14:56:57.252 +05:30 [INF] 🕵️ No automation flow matched keyword: chooce
2025-07-05 14:56:57.253 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 14:56:57.606 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 483
2025-07-05 14:56:57.608 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:57.609 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 14:56:57.611 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMURDM0ZBMUNGNzU2NTI3NzYwOEFGOEQwODc5NDRCMkEA","timestamp":"1751707619","text":{"body":"Choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:57.612 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 14:56:57.612 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"S K"},"wa_id":"918974005240"}],"messages":[{"from":"918974005240","id":"wamid.HBgMOTE4OTc0MDA1MjQwFQIAEhggMURDM0ZBMUNGNzU2NTI3NzYwOEFGOEQwODc5NDRCMkEA","timestamp":"1751707619","text":{"body":"Choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 14:56:57.613 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 14:56:57.614 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 14:56:57.615 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.2635ms
2025-07-05 14:56:57.617 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 14:56:57.617 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 14:56:57.619 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918974005240
2025-07-05 14:56:57.619 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 13.444ms
2025-07-05 14:56:57.621 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918974005240'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 14:56:57.625 +05:30 [INF] Contact already exists: contactId="a307d00b-239b-4c7b-bb16-77838875fbec"
2025-07-05 14:56:57.627 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='a307d00b-239b-4c7b-bb16-77838875fbec'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 14:56:57.630 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='1195c839-2d82-49cc-87ea-88299b700c3b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='a307d00b-239b-4c7b-bb16-77838875fbec' (Nullable = true), @p6='2025-07-05T09:26:57.6288050Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Choice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918974005240' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T09:26:57.6288052Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 14:56:57.841 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='choice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 14:56:57.844 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'choice'
2025-07-05 14:56:57.844 +05:30 [INF] 🕵️ No automation flow matched keyword: choice
2025-07-05 14:56:57.845 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 19:47:14.604 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:47:14.788 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:14 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:47:14.854 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:14 PM'.
2025-07-05 19:47:14.867 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 19:47:14.939 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 19:47:14.959 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 19:47:14.961 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 357.3477ms
2025-07-05 19:47:26.169 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 19:47:26.247 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 19:47:26.273 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 19:47:27.111 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 19:47:27.667 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 19:47:27.851 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 19:47:27.852 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 19:47:27.853 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 19:47:27.854 +05:30 [INF] Hosting environment: Development
2025-07-05 19:47:27.855 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 19:47:27.925 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 19:47:27.943 +05:30 [INF] Executed DbCommand (40ms) [Parameters=[@__cutoff_0='2025-06-28T14:17:26.3995416Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 19:47:30.230 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 19:47:30.487 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 266.807ms
2025-07-05 19:47:30.529 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 19:47:30.543 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 13.1126ms
2025-07-05 19:47:30.618 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 19:47:30.660 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 42.1023ms
2025-07-05 19:47:30.899 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 19:47:31.184 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 285.0518ms
2025-07-05 19:47:38.698 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:47:38.711 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 19:47:38.716 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:47:38.720 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 22.6888ms
2025-07-05 19:47:38.724 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:47:38.744 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:47:38.904 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:38 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:47:38.948 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:38 PM'.
2025-07-05 19:47:38.952 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:47:38.971 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:47:39.070 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:47:39.173 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:47:39.308 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:47:39.465 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:47:39.496 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:47:39.623 +05:30 [INF] Executed DbCommand (77ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:47:39.655 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:47:39.788 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 809.1056ms
2025-07-05 19:47:39.793 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:47:39.880 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 19:47:39.899 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-05 19:47:39.906 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 19:47:39.907 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 1183.311ms
2025-07-05 19:47:39.911 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:47:39.916 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 9.9089ms
2025-07-05 19:47:39.918 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 19:47:39.925 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:47:39.929 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:39 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:47:39.932 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:39 PM'.
2025-07-05 19:47:39.934 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 16.1066ms
2025-07-05 19:47:39.940 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 19:47:40.505 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:47:40.514 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:40 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:47:40.518 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:17:40 PM'.
2025-07-05 19:47:40.527 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 19:47:40.587 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 19:47:40.594 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 19:47:40.596 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 90.7603ms
2025-07-05 19:49:20.196 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:49:20.219 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:20.223 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 27.0173ms
2025-07-05 19:49:20.232 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:49:20.236 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:20.239 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:20 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:49:20.245 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:20 PM'.
2025-07-05 19:49:20.247 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:20.249 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:20.263 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:49:20.274 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:49:20.285 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:49:20.294 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:49:20.301 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:49:20.307 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:49:20.312 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:49:20.413 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 159.9894ms
2025-07-05 19:49:20.416 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:20.508 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: Headers are read-only, response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpHeaders.ThrowHeadersReadOnlyException()
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseHeaders.Microsoft.AspNetCore.Http.IHeaderDictionary.set_SetCookie(StringValues value)
   at Microsoft.AspNetCore.Http.ResponseCookies.Append(String key, String value, CookieOptions options)
   at xbytechat.api.AuthModule.Services.AuthService.LoginAsync(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Services\AuthService.cs:line 462
   at xbytechat.api.AuthModule.Controllers.AuthController.Login(UserLoginDto dto) in D:\xbytechat\xbytechat-api\xbytechat-api\AuthModule\Controllers\AuthController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 19:49:20.518 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/login
2025-07-05 19:49:20.520 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 401 null application/json 288.8415ms
2025-07-05 19:49:20.526 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - null null
2025-07-05 19:49:20.540 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:20.543 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/refresh - 204 null null 16.8871ms
2025-07-05 19:49:20.547 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/refresh - application/json 2
2025-07-05 19:49:20.554 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:20.557 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:20 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:49:20.562 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:20 PM'.
2025-07-05 19:49:20.564 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/refresh - 401 null application/json 17.4612ms
2025-07-05 19:49:20.570 +05:30 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:7113/api/auth/refresh, Response status code: 401
2025-07-05 19:49:22.026 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:49:22.034 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:22 PM'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-07-05 19:49:22.038 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '05-07-2025 09:06:18 AM', Current time (UTC): '05-07-2025 02:19:22 PM'.
2025-07-05 19:49:22.043 +05:30 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-07-05 19:49:22.072 +05:30 [ERR] ❌ An unhandled exception occurred
System.InvalidOperationException: StatusCode cannot be set because the response has already started.
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String value)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.set_StatusCode(Int32 value)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationHandler`1.ChallengeAsync(AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.<>c__DisplayClass0_0.<<HandleAsync>g__Handle|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at GlobalExceptionMiddleware.Invoke(HttpContext context) in D:\xbytechat\xbytechat-api\xbytechat-api\Middlewares\GlobalExceptionMiddleware.cs:line 32
2025-07-05 19:49:22.078 +05:30 [ERR] Response has already started, unable to write error response for path: /api/auth/session
2025-07-05 19:49:22.080 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 401 null application/json 53.6812ms
2025-07-05 19:49:29.519 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:49:29.523 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:29.524 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 5.3754ms
2025-07-05 19:49:29.528 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:49:29.534 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:29.536 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:29.537 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:29.554 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:49:29.562 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:49:29.569 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:49:29.577 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:49:29.583 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:49:29.590 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:49:29.594 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:49:29.598 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:49:29.608 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:29.654 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 113.7689ms
2025-07-05 19:49:29.656 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:29.659 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 130.8302ms
2025-07-05 19:49:29.972 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:49:30.013 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:30.017 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:30.024 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:30.028 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 7.8225ms
2025-07-05 19:49:30.030 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:30.032 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 59.7272ms
2025-07-05 19:49:30.258 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:49:30.264 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:30.270 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:49:30.294 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:49:30.301 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:49:30.315 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:49:30.344 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:49:30.345 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:49:30.346 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:49:30.347 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:49:30.348 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:49:30.349 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:49:30.350 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:49:30.352 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:49:30.353 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:49:30.354 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:49:30.355 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:49:30.356 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:49:30.363 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:49:30.375 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 101.7303ms
2025-07-05 19:49:30.377 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:30.379 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 120.6763ms
2025-07-05 19:49:32.852 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:49:32.856 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:32.857 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:32.859 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:32.862 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:49:32.870 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:49:32.879 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:49:32.888 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:49:32.893 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:49:32.899 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:49:32.903 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:49:32.904 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:49:32.906 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:32.908 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 47.6712ms
2025-07-05 19:49:32.910 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:32.912 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 60.2686ms
2025-07-05 19:49:32.923 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:49:32.929 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:32.931 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:32.935 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:32.937 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.5899ms
2025-07-05 19:49:32.938 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:32.940 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 16.5935ms
2025-07-05 19:49:33.252 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:49:33.258 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:33.259 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:49:33.266 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:49:33.271 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:49:33.275 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:49:33.279 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:49:33.280 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:49:33.281 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:49:33.282 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:49:33.283 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:49:33.284 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:49:33.285 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:49:33.286 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:49:33.287 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:49:33.288 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:49:33.289 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:49:33.290 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:49:33.292 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:49:33.294 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 31.7578ms
2025-07-05 19:49:33.296 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:33.297 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 45.7316ms
2025-07-05 19:49:37.171 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:49:37.176 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:37.178 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 6.5264ms
2025-07-05 19:49:37.183 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:49:37.189 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:49:37.190 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:37.192 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:37.197 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:49:37.202 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:49:37.210 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:49:37.217 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:49:37.222 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:49:37.227 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:49:37.232 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:49:37.234 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:49:37.237 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:37.239 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 45.1788ms
2025-07-05 19:49:37.241 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:49:37.243 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 60.5675ms
2025-07-05 19:49:37.259 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:49:37.266 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:37.268 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:49:37.271 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:49:37.273 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 3.3892ms
2025-07-05 19:49:37.275 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:49:37.277 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 17.4494ms
2025-07-05 19:49:37.593 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:49:37.599 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:37.600 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:49:37.607 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:49:37.612 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:49:37.616 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:49:37.619 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:49:37.621 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:49:37.622 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:49:37.623 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:49:37.624 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:49:37.625 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:49:37.626 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:49:37.627 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:49:37.627 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:49:37.629 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:49:37.630 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:49:37.631 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:49:37.633 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:49:37.635 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 32.4512ms
2025-07-05 19:49:37.640 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:49:37.642 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 48.5062ms
2025-07-05 19:54:07.382 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:54:07.390 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:54:07.391 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 9.0352ms
2025-07-05 19:54:07.394 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:54:07.407 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:54:07.409 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:54:07.411 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:54:07.416 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:54:07.618 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:54:07.625 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:54:07.631 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:54:07.636 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:54:07.640 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:54:07.643 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:54:07.645 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:54:07.647 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:54:07.649 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 234.4812ms
2025-07-05 19:54:07.651 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:54:07.653 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 259.6379ms
2025-07-05 19:54:07.979 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:54:07.984 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:54:07.985 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:54:07.988 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:54:07.990 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.6752ms
2025-07-05 19:54:07.992 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:54:07.993 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 14.5331ms
2025-07-05 19:54:08.233 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:54:08.238 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:54:08.239 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:54:08.247 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:54:08.252 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:54:08.256 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:54:08.266 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:54:08.267 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:54:08.268 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:54:08.270 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:54:08.271 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:54:08.272 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:54:08.273 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:54:08.274 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:54:08.276 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:54:08.277 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:54:08.278 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:54:08.280 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:54:08.282 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:54:08.284 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 41.6938ms
2025-07-05 19:54:08.286 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:54:08.287 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 54.189ms
2025-07-05 19:54:26.795 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 19:54:26.853 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 19:54:26.869 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 19:54:27.970 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 19:54:28.498 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 19:54:28.647 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 19:54:28.648 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 19:54:28.649 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 19:54:28.650 +05:30 [INF] Hosting environment: Development
2025-07-05 19:54:28.651 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 19:54:28.719 +05:30 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 19:54:28.738 +05:30 [INF] Executed DbCommand (45ms) [Parameters=[@__cutoff_0='2025-06-28T14:24:27.1359952Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 19:54:30.788 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 19:54:31.043 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 267.0826ms
2025-07-05 19:54:31.070 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 19:54:31.087 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 17.5149ms
2025-07-05 19:54:31.191 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 19:54:31.234 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 42.8879ms
2025-07-05 19:54:31.482 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 19:54:31.767 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 284.5263ms
2025-07-05 19:54:58.730 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:54:58.740 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 19:54:58.881 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:54:58.892 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:54:58.951 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:54:58.965 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 68.6728ms
2025-07-05 19:54:58.967 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:54:58.969 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 239.384ms
2025-07-05 19:54:58.997 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:54:59.008 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:54:59.013 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:54:59.087 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:54:59.213 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:54:59.224 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:54:59.243 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:54:59.244 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:54:59.244 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:54:59.245 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:54:59.246 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:54:59.246 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:54:59.247 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:54:59.247 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:54:59.249 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:54:59.250 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:54:59.251 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:54:59.251 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:54:59.258 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:54:59.266 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 251.7009ms
2025-07-05 19:54:59.268 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:54:59.273 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 276.0575ms
2025-07-05 19:55:01.794 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:55:01.802 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:01.806 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 11.7369ms
2025-07-05 19:55:01.810 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:55:01.815 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:01.820 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:55:01.832 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:55:01.876 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:55:01.934 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:55:02.002 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:55:02.024 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:55:02.050 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:55:02.178 +05:30 [INF] Executed DbCommand (78ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:55:02.211 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:55:02.225 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:55:02.229 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:02.246 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 410.4921ms
2025-07-05 19:55:02.249 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:55:02.251 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 440.9786ms
2025-07-05 19:55:02.264 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:55:02.271 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:55:02.273 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:55:02.286 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:02.289 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 13.1975ms
2025-07-05 19:55:02.290 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:55:02.291 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 27.0501ms
2025-07-05 19:55:02.302 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:55:02.308 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:55:02.310 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:55:02.320 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:55:02.324 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:55:02.328 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:55:02.331 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:55:02.332 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:55:02.333 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:55:02.334 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:55:02.335 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:55:02.336 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:55:02.337 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:55:02.338 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:55:02.339 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:55:02.340 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:55:02.341 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:55:02.342 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:55:02.344 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:55:02.346 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 33.9745ms
2025-07-05 19:55:02.348 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:55:02.350 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 47.6085ms
2025-07-05 19:55:15.113 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 19:55:15.117 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:15.118 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 5.7771ms
2025-07-05 19:55:15.121 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 19:55:15.128 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:15.130 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:55:15.131 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:55:15.135 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 19:55:15.142 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 19:55:15.149 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 19:55:15.155 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 19:55:15.162 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 19:55:15.167 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 19:55:15.171 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 19:55:15.173 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 19:55:15.175 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:15.178 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 45.0681ms
2025-07-05 19:55:15.180 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 19:55:15.182 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 61.0255ms
2025-07-05 19:55:15.192 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 19:55:15.197 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:55:15.198 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 19:55:15.201 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:15.203 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.5828ms
2025-07-05 19:55:15.204 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 19:55:15.206 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 13.9974ms
2025-07-05 19:55:15.539 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 19:55:15.544 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:55:15.545 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 19:55:15.554 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:55:15.557 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 19:55:15.561 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 19:55:15.566 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 19:55:15.567 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 19:55:15.568 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 19:55:15.569 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 19:55:15.570 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 19:55:15.571 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 19:55:15.572 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 19:55:15.573 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 19:55:15.574 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 19:55:15.575 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 19:55:15.576 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 19:55:15.577 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 19:55:15.579 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 19:55:15.581 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 34.1827ms
2025-07-05 19:55:15.583 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 19:55:15.584 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 45.1141ms
2025-07-05 19:55:23.328 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 19:55:23.332 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:23.336 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 19:55:23.343 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 19:55:23.369 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 19:55:23.406 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 19:55:23.418 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 72.6109ms
2025-07-05 19:55:23.420 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 19:55:23.422 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 93.6406ms
2025-07-05 19:55:25.651 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 19:55:25.659 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:25.662 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 19:55:25.690 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 19:55:25.719 +05:30 [INF] Executed DbCommand (11ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 19:55:25.724 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 19:55:25.727 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 29.4485ms
2025-07-05 19:55:25.730 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 19:55:25.732 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 80.7669ms
2025-07-05 19:55:30.322 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 19:55:30.325 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:30.326 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 4.4739ms
2025-07-05 19:55:30.328 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 473
2025-07-05 19:55:30.337 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:30.339 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 19:55:30.345 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 19:55:30.358 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 19:55:30.359 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 19:55:30.372 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 19:55:30.493 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p2='36de2595-f729-4b07-9958-11c8a56db12f', @p0='EAAIo1fBYKV8BPMmtcrFoTD9SULW94KcoVmpDJfwMwpHguph0W6dy3tt4QcnxXK6KWL7SIKg0v2LuEzuZBm0BugcVZBUHvDzv2s1IeZAtODRLpc7QdkCidzrZB220cRFybrCfGZCHNdAjy1KWrAQQcZBpWZBQWTMwl3wfen0HIMbLpSqvL9J5pbfB0g34g6UyShNlnoCOx8YRuYYvAKkltdIKWy2bfAp31AvuGpmIZAcZBFRlTQgZBCmASUmlBCyskaagZDZD' (Nullable = false), @p1='2025-07-05T14:25:30.3781250Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "ApiToken" = @p0, "UpdatedAt" = @p1
WHERE "Id" = @p2;
2025-07-05 19:55:30.509 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 19:55:30.511 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:30.516 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 168.3797ms
2025-07-05 19:55:30.518 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 19:55:30.519 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 191.3266ms
2025-07-05 19:55:30.954 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 19:55:30.958 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:30.959 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 4.8339ms
2025-07-05 19:55:30.961 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 473
2025-07-05 19:55:30.968 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:30.970 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 19:55:30.975 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 19:55:32.834 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:32.836 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1858.5814ms
2025-07-05 19:55:32.838 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 19:55:32.839 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1877.8706ms
2025-07-05 19:55:37.643 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 19:55:37.648 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 19:55:37.651 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:37.655 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:37.657 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 19:55:37.658 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 19:55:37.667 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 19:55:37.667 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 19:55:37.683 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 19:55:37.721 +05:30 [INF] Executed DbCommand (9ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 19:55:37.730 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:37.731 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 19:55:37.747 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 76.3685ms
2025-07-05 19:55:37.749 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 19:55:37.751 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 103.521ms
2025-07-05 19:55:37.799 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 19:55:37.892 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 19:55:37.905 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 231.4906ms
2025-07-05 19:55:37.907 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 19:55:37.909 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 266.475ms
2025-07-05 19:55:43.239 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 19:55:43.244 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:43.246 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 6.4833ms
2025-07-05 19:55:43.248 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-05 19:55:43.255 +05:30 [INF] CORS policy execution successful.
2025-07-05 19:55:43.258 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 19:55:43.266 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 19:55:46.245 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 19:55:46.259 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 19:55:46.263 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 19:55:46.409 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 19:55:46.420 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 19:55:46.423 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 19:55:48.593 +05:30 [INF] Received HTTP response headers after 2165.9439ms - 200
2025-07-05 19:55:48.597 +05:30 [INF] End processing HTTP request after 2178.7934ms - 200
2025-07-05 19:55:48.868 +05:30 [INF] Executed DbCommand (23ms) [Parameters=[@p0='c8b94301-6895-41d4-b9e6-7ecea1832409', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T14:25:48.7226709Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='asxaxsa' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='asxaxsa', @p16='2025-07-05T14:25:48.7227230Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 19:55:48.875 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 19:55:48.880 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 5609.4323ms
2025-07-05 19:55:48.883 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 19:55:48.885 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 5636.6481ms
2025-07-05 19:55:49.861 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 19:55:49.866 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 19:55:49.869 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 19:55:49.879 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"sent","timestamp":"1751725548","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","expiration_timestamp":"1751725548","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:49.884 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 19:55:49.885 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:49.888 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 16.6522ms
2025-07-05 19:55:49.889 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 19:55:49.891 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 30.0348ms
2025-07-05 19:55:50.053 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"sent","timestamp":"1751725548","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","expiration_timestamp":"1751725548","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:50.056 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 19:55:50.058 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"sent","timestamp":"1751725548","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","expiration_timestamp":"1751725548","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:50.086 +05:30 [INF] Executed DbCommand (9ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 19:55:50.090 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==
2025-07-05 19:55:50.092 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==
2025-07-05 19:55:51.228 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 19:55:51.233 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 19:55:51.235 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 19:55:51.238 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"delivered","timestamp":"1751725550","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:51.240 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 19:55:51.241 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 19:55:51.243 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 5.6833ms
2025-07-05 19:55:51.243 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"delivered","timestamp":"1751725550","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:51.244 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 19:55:51.246 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 19:55:51.247 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.767ms
2025-07-05 19:55:51.250 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==","status":"delivered","timestamp":"1751725550","recipient_id":"917082156227","conversation":{"id":"6128ba0c63dc8ee89c4a6b527167aa18","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 19:55:51.259 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 19:55:51.263 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==
2025-07-05 19:55:51.264 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNjAxNUVDNDA3QTcwM0Q3NEE4AA==
2025-07-05 20:50:37.304 +05:30 [INF] User profile is available. Using 'C:\Users\sunde\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-07-05 20:50:37.355 +05:30 [INF] 🚀 Webhook Queue Worker started.
2025-07-05 20:50:37.371 +05:30 [INF] 🧹 FailedWebhookLogCleanupService started.
2025-07-05 20:50:38.398 +05:30 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-07-05 20:50:38.976 +05:30 [WRN] The query uses the 'First'/'FirstOrDefault' operator without 'OrderBy' and filter operators. This may lead to unpredictable results.
2025-07-05 20:50:39.133 +05:30 [INF] Now listening on: http://localhost:7113
2025-07-05 20:50:39.135 +05:30 [INF] Now listening on: http://localhost:5295
2025-07-05 20:50:39.136 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-07-05 20:50:39.137 +05:30 [INF] Hosting environment: Development
2025-07-05 20:50:39.138 +05:30 [INF] Content root path: D:\xbytechat\xbytechat-api\xbytechat-api
2025-07-05 20:50:39.224 +05:30 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."AutoCleanupEnabled", w."LastCleanupAt"
FROM "WebhookSettings" AS w
LIMIT 1
2025-07-05 20:50:39.241 +05:30 [INF] Executed DbCommand (44ms) [Parameters=[@__cutoff_0='2025-06-28T15:20:37.5127380Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."CreatedAt", f."ErrorMessage", f."FailureType", f."RawJson", f."SourceModule"
FROM "FailedWebhookLogs" AS f
WHERE f."CreatedAt" < @__cutoff_0
2025-07-05 20:50:41.338 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/index.html - null null
2025-07-05 20:50:41.602 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/index.html - 200 null text/html;charset=utf-8 271.4069ms
2025-07-05 20:50:41.793 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_vs/browserLink - null null
2025-07-05 20:50:41.793 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - null null
2025-07-05 20:50:41.805 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_framework/aspnetcore-browser-refresh.js - 200 13762 application/javascript; charset=utf-8 12.6353ms
2025-07-05 20:50:41.837 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.8763ms
2025-07-05 20:50:41.992 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - null null
2025-07-05 20:50:42.261 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 269.8942ms
2025-07-05 20:51:03.219 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 20:51:03.226 +05:30 [WRN] Failed to determine the https port for redirect.
2025-07-05 20:51:03.378 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 20:51:03.389 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 20:51:03.451 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:51:03.465 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 71.112ms
2025-07-05 20:51:03.467 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 20:51:03.471 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 251.6723ms
2025-07-05 20:51:03.482 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 20:51:03.494 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 20:51:03.500 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 20:51:03.584 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 20:51:03.720 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 20:51:03.731 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 20:51:03.751 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 20:51:03.753 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 20:51:03.753 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 20:51:03.754 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 20:51:03.755 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 20:51:03.756 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 20:51:03.757 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 20:51:03.758 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 20:51:03.759 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 20:51:03.760 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 20:51:03.761 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 20:51:03.761 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 20:51:03.769 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 20:51:03.780 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 277.365ms
2025-07-05 20:51:03.782 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 20:51:03.787 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 304.9848ms
2025-07-05 20:54:32.834 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - null null
2025-07-05 20:54:32.847 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:54:32.851 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/auth/login - 204 null null 18.0933ms
2025-07-05 20:54:32.855 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/auth/login - application/json 47
2025-07-05 20:54:32.866 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:54:32.872 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 20:54:32.890 +05:30 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(xbytechat.api.AuthModule.DTOs.UserLoginDto) on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 20:54:32.947 +05:30 [INF] 🔑 Login attempt for email: ratan@tcs.com
2025-07-05 20:54:32.990 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__dto_Email_0='ratan@tcs.com', @__hashedPassword_1='JAvlGPq9JyTdtvBO6x2llnRI1+gxwIyPqCKAn3THIKk='], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."BusinessId", u."CreatedAt", u."DeletedAt", u."Email", u."IsDeleted", u."Name", u."PasswordHash", u."RefreshToken", u."RefreshTokenExpiry", u."RoleId", u."Status", r."Id", r."CreatedAt", r."Description", r."IsActive", r."IsSystemDefined", r."Name"
FROM "Users" AS u
LEFT JOIN "Roles" AS r ON u."RoleId" = r."Id"
WHERE u."Email" = @__dto_Email_0 AND u."PasswordHash" = @__hashedPassword_1 AND NOT (u."IsDeleted")
LIMIT 1
2025-07-05 20:54:33.070 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_BusinessId_Value_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__user_BusinessId_Value_0
LIMIT 1
2025-07-05 20:54:33.097 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__user_RoleId_0='00000000-0000-0000-0000-000000000004' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT r."Id", r."AssignedAt", r."AssignedBy", r."IsActive", r."IsRevoked", r."PermissionId", r."RoleId"
FROM "RolePermissions" AS r
WHERE r."RoleId" = @__user_RoleId_0 AND NOT (r."IsRevoked")
2025-07-05 20:54:33.126 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Id", u."AssignedAt", u."AssignedBy", u."IsGranted", u."IsRevoked", u."PermissionId", u."UserId"
FROM "UserPermissions" AS u
WHERE u."UserId" = @__userId_0 AND NOT (u."IsRevoked")
2025-07-05 20:54:33.257 +05:30 [INF] Executed DbCommand (76ms) [Parameters=[@__permissionIds_0={ '30000000-0000-0000-0000-000000000000', '30000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004' } (DbType = Object)], CommandType='"Text"', CommandTimeout='30']
SELECT p."Id", p."Code", p."CreatedAt", p."Description", p."Group", p."IsActive", p."Name"
FROM "Permissions" AS p
WHERE p."Id" = ANY (@__permissionIds_0)
2025-07-05 20:54:33.292 +05:30 [INF] ✅ Token generated for: ratan@tcs.com
2025-07-05 20:54:33.305 +05:30 [INF] ✅ Login successful for ratan@tcs.com, Role: business, Plan: Smart
2025-07-05 20:54:33.311 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:54:33.328 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api) in 435.0181ms
2025-07-05 20:54:33.330 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.Login (xbytechat.api)'
2025-07-05 20:54:33.334 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/auth/login - 200 null application/json; charset=utf-8 478.1875ms
2025-07-05 20:54:33.660 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 20:54:33.667 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 20:54:33.669 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 20:54:33.682 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:54:33.684 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 10.8143ms
2025-07-05 20:54:33.686 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 20:54:33.687 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 27.5201ms
2025-07-05 20:54:33.911 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 20:54:33.916 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 20:54:33.918 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 20:54:33.930 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 20:54:33.943 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 20:54:33.948 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 20:54:33.951 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 20:54:33.952 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 20:54:33.953 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 20:54:33.956 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 20:54:33.957 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 20:54:33.958 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 20:54:33.959 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 20:54:33.960 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 20:54:33.961 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 20:54:33.962 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 20:54:33.963 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 20:54:33.964 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 20:54:33.966 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 20:54:33.969 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 47.6664ms
2025-07-05 20:54:33.971 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 20:54:33.972 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 61.0077ms
2025-07-05 20:55:12.668 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&search= - null null
2025-07-05 20:55:12.672 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:55:12.675 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-05 20:55:12.675 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:55:12.684 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 20:55:12.692 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-05 20:55:12.694 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 20:55:12.716 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 20:55:12.729 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-05 20:55:12.741 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:55:12.760 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 20:55:12.769 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 70.0761ms
2025-07-05 20:55:12.771 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 20:55:12.772 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 97.1726ms
2025-07-05 20:55:12.820 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 20:55:12.913 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:55:12.924 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 222.2374ms
2025-07-05 20:55:12.925 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:55:12.927 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&search= - 200 null application/json; charset=utf-8 259.5286ms
2025-07-05 20:56:43.366 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/contacts - application/json 234
2025-07-05 20:56:43.370 +05:30 [INF] CORS policy execution failed.
2025-07-05 20:56:43.371 +05:30 [INF] Request origin http://localhost:7113/ does not have permission to access the resource.
2025-07-05 20:56:43.373 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.AddContact (xbytechat.api)'
2025-07-05 20:56:43.379 +05:30 [INF] Route matched with {action = "AddContact", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddContact(xbytechat.api.CRM.Dtos.ContactDto) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 20:56:43.400 +05:30 [INF] AddContactAsync called for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", Name=Gulpham
2025-07-05 20:56:43.762 +05:30 [INF] Executed DbCommand (6ms) [Parameters=[@p0='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p1=NULL (DbType = Guid), @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='2025-07-05T15:26:43.4035951Z' (DbType = DateTime), @p4='test@gulpham.com', @p5=NULL, @p6='True', @p7='False', @p8='False', @p9='False', @p10=NULL (DbType = DateTime), @p11=NULL, @p12=NULL (DbType = Guid), @p13=NULL (DbType = DateTime), @p14='WhatsApp', @p15='Gulpham' (Nullable = false), @p16=NULL (DbType = DateTime), @p17='test', @p18='+918130891737' (Nullable = false), @p19=NULL, @p20='4b9d23e0-a593-49a0-95cd-fe2a5ec725be', @p21='2025-07-05T15:26:43.4046126Z' (DbType = DateTime), @p22='system', @p23='c13be597-6ae2-42bb-9d43-925815f24ff8', @p24='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p25='031ff6b4-e3b7-4775-8fd0-472cadca6192'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Contacts" ("Id", "AssignedAgentId", "BusinessId", "CreatedAt", "Email", "Group", "IsActive", "IsArchived", "IsAutomationPaused", "IsFavorite", "LastCTAInteraction", "LastCTAType", "LastClickedProductId", "LastContactedAt", "LeadSource", "Name", "NextFollowUpAt", "Notes", "PhoneNumber", "Tags")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
INSERT INTO "ContactTags" ("Id", "AssignedAt", "AssignedBy", "BusinessId", "ContactId", "TagId")
VALUES (@p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 20:56:43.789 +05:30 [INF] Contact added: "63faf7a5-4506-431d-884c-cb0a363fa7ac" for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 20:56:43.791 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:56:43.794 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.AddContact (xbytechat.api) in 411.6591ms
2025-07-05 20:56:43.796 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.AddContact (xbytechat.api)'
2025-07-05 20:56:43.797 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 431.5794ms
2025-07-05 20:56:43.814 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&search= - null null
2025-07-05 20:56:43.819 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:56:43.821 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:56:43.822 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 20:56:43.826 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 20:56:43.831 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 20:56:43.841 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 20:56:43.845 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:56:43.847 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 22.6147ms
2025-07-05 20:56:43.849 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:56:43.851 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&search= - 200 null application/json; charset=utf-8 36.4999ms
2025-07-05 20:58:37.992 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 20:58:38.000 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 20:58:38.008 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:58:38.016 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:58:38.017 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:58:38.019 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 20:58:38.020 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 20:58:38.024 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 20:58:38.028 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 20:58:38.034 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 20:58:38.053 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 20:58:38.060 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:58:38.063 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 40.029ms
2025-07-05 20:58:38.066 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:58:38.068 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 20:58:38.070 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 78.2237ms
2025-07-05 20:58:38.076 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:58:38.087 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 50.4852ms
2025-07-05 20:58:38.089 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 20:58:38.091 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 91.1689ms
2025-07-05 20:58:45.240 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 20:58:45.243 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:58:45.245 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 5.4626ms
2025-07-05 20:58:45.248 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-05 20:58:45.257 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:58:45.259 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:58:45.265 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 20:58:47.339 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 20:58:47.354 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 20:58:47.359 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 20:58:47.513 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 20:58:47.547 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:58:47.551 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:58:49.002 +05:30 [INF] Received HTTP response headers after 1445.3935ms - 200
2025-07-05 20:58:49.005 +05:30 [INF] End processing HTTP request after 1459.8553ms - 200
2025-07-05 20:58:49.228 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='dc35ebf8-6374-42b9-865c-6afd0d8b0d84', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:28:49.1332147Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='ggkgkgj' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='ggkgkgj', @p16='2025-07-05T15:28:49.1333222Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 20:58:49.235 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:58:49.242 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3974.433ms
2025-07-05 20:58:49.243 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:58:49.245 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3996.6351ms
2025-07-05 20:58:51.364 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 20:58:51.368 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:58:51.372 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 20:58:51.385 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==","status":"failed","timestamp":"1751729330","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:58:51.390 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 20:58:51.392 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:58:51.396 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 22.1752ms
2025-07-05 20:58:51.398 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:58:51.399 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 35.4929ms
2025-07-05 20:58:51.581 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==","status":"failed","timestamp":"1751729330","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:58:51.583 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 20:58:51.586 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==","status":"failed","timestamp":"1751729330","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:58:51.605 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 20:58:51.611 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==
2025-07-05 20:58:51.613 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMEMyNDUzQzEwMTNERTFBQTc0AA==
2025-07-05 20:59:15.449 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 20:59:15.453 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:15.455 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 6.2008ms
2025-07-05 20:59:15.458 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 59
2025-07-05 20:59:15.467 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:15.469 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:15.470 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 20:59:17.362 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 20:59:17.373 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 20:59:17.416 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 20:59:17.419 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:17.420 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:18.273 +05:30 [INF] Received HTTP response headers after 851.249ms - 200
2025-07-05 20:59:18.275 +05:30 [INF] End processing HTTP request after 856.4332ms - 200
2025-07-05 20:59:18.295 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@p0='6fbf0b18-2bd3-4361-bc75-311682419e81', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:29:18.2785883Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='ggkgkgj' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='ggkgkgj', @p16='2025-07-05T15:29:18.2785884Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 20:59:18.300 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:59:18.301 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2828.7286ms
2025-07-05 20:59:18.303 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:18.304 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2846.0475ms
2025-07-05 20:59:19.116 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 20:59:19.121 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:19.122 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 20:59:19.126 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==","status":"failed","timestamp":"1751729358","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:19.128 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 20:59:19.129 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:19.131 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==","status":"failed","timestamp":"1751729358","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:19.131 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.0075ms
2025-07-05 20:59:19.133 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 20:59:19.135 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:19.136 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==","status":"failed","timestamp":"1751729358","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:19.137 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.4069ms
2025-07-05 20:59:19.141 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 20:59:19.149 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==
2025-07-05 20:59:19.150 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDA0QTk4QkEwOTdFOTk2NDVFAA==
2025-07-05 20:59:20.596 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 20:59:20.602 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:20.606 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 20:59:20.617 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 20:59:20.635 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 20:59:20.644 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 20:59:20.651 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 31.9335ms
2025-07-05 20:59:20.653 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 20:59:20.655 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 59.2736ms
2025-07-05 20:59:22.104 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - null null
2025-07-05 20:59:22.110 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:22.111 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/update - 204 null null 7.6457ms
2025-07-05 20:59:22.113 +05:30 [INF] Request starting HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - application/json 473
2025-07-05 20:59:22.118 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:22.120 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 20:59:22.126 +05:30 [INF] Route matched with {action = "UpdateSetting", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateSetting(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 20:59:22.137 +05:30 [INF] 🔧 [UpdateSetting] Request received for WhatsApp settings update.
2025-07-05 20:59:22.138 +05:30 [INF] 💾 [UpdateSetting] Saving/updating WhatsApp settings for businessId="c13be597-6ae2-42bb-9d43-925815f24ff8".
2025-07-05 20:59:22.149 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__dto_BusinessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__dto_BusinessId_0
LIMIT 1
2025-07-05 20:59:22.163 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='36de2595-f729-4b07-9958-11c8a56db12f', @p0='2025-07-05T15:29:22.1543827Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "WhatsAppSettings" SET "UpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 20:59:22.167 +05:30 [INF] ✅ [UpdateSetting] WhatsApp settings updated successfully.
2025-07-05 20:59:22.169 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:22.172 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api) in 42.8208ms
2025-07-05 20:59:22.174 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.UpdateSetting (xbytechat.api)'
2025-07-05 20:59:22.177 +05:30 [INF] Request finished HTTP/1.1 PUT http://localhost:7113/api/whatsappsettings/update - 200 null application/json; charset=utf-8 63.3929ms
2025-07-05 20:59:22.765 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 20:59:22.769 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:22.770 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 4.8377ms
2025-07-05 20:59:22.773 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 473
2025-07-05 20:59:22.779 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:22.781 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 20:59:22.785 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 20:59:24.059 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:24.061 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1272.788ms
2025-07-05 20:59:24.063 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 20:59:24.065 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1292.1529ms
2025-07-05 20:59:27.764 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 20:59:27.765 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - null null
2025-07-05 20:59:27.768 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:27.779 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:27.779 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:59:27.780 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 20:59:27.782 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 20:59:27.783 +05:30 [INF] Route matched with {action = "GetRecentLogs", controller = "MessageAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetRecentLogs(Int32) on controller xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController (xbytechat.api).
2025-07-05 20:59:27.788 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 20:59:27.796 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 20:59:27.810 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 20:59:27.814 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:59:27.816 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 28.5259ms
2025-07-05 20:59:27.818 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 20:59:27.821 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 57.3267ms
2025-07-05 20:59:27.971 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_1='10'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."RecipientNumber", m."MessageContent", m."CreatedAt", m."CampaignId", m."Status", m."SentAt"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0
ORDER BY m."CreatedAt" DESC
LIMIT @__p_1
2025-07-05 20:59:27.974 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[xbytechat.api.Features.ReportingModule.DTOs.RecentMessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:27.975 +05:30 [INF] Executed action xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api) in 183.8721ms
2025-07-05 20:59:27.977 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.ReportingModule.Controllers.MessageAnalyticsController.GetRecentLogs (xbytechat.api)'
2025-07-05 20:59:27.978 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/reporting/messages/recent?limit=10 - 200 null application/json; charset=utf-8 213.7278ms
2025-07-05 20:59:33.338 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 20:59:33.342 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:33.343 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 4.7966ms
2025-07-05 20:59:33.345 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 20:59:33.349 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:33.350 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:33.352 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 20:59:34.636 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 20:59:34.640 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 20:59:34.644 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 20:59:34.646 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:34.647 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:35.886 +05:30 [INF] Received HTTP response headers after 1237.2536ms - 200
2025-07-05 20:59:35.888 +05:30 [INF] End processing HTTP request after 1242.1783ms - 200
2025-07-05 20:59:35.896 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='85bed5ee-27bd-44aa-8f36-fcd66b750eba', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:29:35.8919279Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:29:35.8919280Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 20:59:35.899 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:59:35.900 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2546.4563ms
2025-07-05 20:59:35.902 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:35.904 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2559.0596ms
2025-07-05 20:59:35.908 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 20:59:35.913 +05:30 [INF] CORS policy execution successful.
2025-07-05 20:59:35.915 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:35.916 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 20:59:37.401 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 20:59:37.402 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 20:59:37.406 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 20:59:37.412 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:37.413 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 20:59:37.417 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:37.416 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 20:59:37.418 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 20:59:37.424 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"sent","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","expiration_timestamp":"1751729376","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.426 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 20:59:37.427 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:37.430 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.3905ms
2025-07-05 20:59:37.433 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:37.434 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 31.9191ms
2025-07-05 20:59:37.437 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"sent","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","expiration_timestamp":"1751729376","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.441 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 20:59:37.442 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"sent","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","expiration_timestamp":"1751729376","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.447 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 20:59:37.449 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==
2025-07-05 20:59:37.451 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==
2025-07-05 20:59:37.608 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 20:59:37.611 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:37.612 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 20:59:37.615 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"delivered","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.617 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 20:59:37.617 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"delivered","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.619 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:37.620 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 20:59:37.622 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2053ms
2025-07-05 20:59:37.623 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==","status":"delivered","timestamp":"1751729376","recipient_id":"917082156227","conversation":{"id":"b5d1416bf1e3a8cf0dd56c745fcffbc8","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 20:59:37.625 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:37.629 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 20:59:37.631 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.2435ms
2025-07-05 20:59:37.635 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==
2025-07-05 20:59:37.639 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTgyQzVCMjAyNTNEQUUyRUJBAA==
2025-07-05 20:59:38.414 +05:30 [INF] Received HTTP response headers after 992.0003ms - 200
2025-07-05 20:59:38.416 +05:30 [INF] End processing HTTP request after 999.0765ms - 200
2025-07-05 20:59:38.466 +05:30 [INF] Executed DbCommand (37ms) [Parameters=[@p0='9d0fac9f-1638-406c-b2a7-8461cfd7520e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:29:38.4188167Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:29:38.4188170Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 20:59:38.507 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 20:59:38.512 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2594.0449ms
2025-07-05 20:59:38.518 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 20:59:38.521 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2612.2495ms
2025-07-05 20:59:39.282 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 20:59:39.286 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:39.288 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 20:59:39.290 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==","status":"failed","timestamp":"1751729378","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:39.293 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 20:59:39.293 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==","status":"failed","timestamp":"1751729378","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:39.295 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 20:59:39.296 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 20:59:39.298 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.9497ms
2025-07-05 20:59:39.299 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==","status":"failed","timestamp":"1751729378","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 20:59:39.300 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 20:59:39.303 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.7758ms
2025-07-05 20:59:39.304 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 20:59:39.320 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==
2025-07-05 20:59:39.322 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRThFQjU0QjBBMDY3RDdBQkNFAA==
2025-07-05 21:00:58.733 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 21:00:58.745 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:00:58.751 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 17.9218ms
2025-07-05 21:00:58.754 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:00:58.759 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:00:58.760 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:00:58.762 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:01:00.782 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 21:01:00.791 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:01:00.795 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 21:01:00.797 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:01:00.798 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:01:02.014 +05:30 [INF] Received HTTP response headers after 1215.1957ms - 200
2025-07-05 21:01:02.017 +05:30 [INF] End processing HTTP request after 1219.9834ms - 200
2025-07-05 21:01:02.025 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='7a7c6643-4f4c-4f12-8923-a5018ce44fe6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:31:02.0208799Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:31:02.0208802Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:01:02.029 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:01:02.031 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3265.6412ms
2025-07-05 21:01:02.034 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:01:02.036 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3282.8676ms
2025-07-05 21:01:02.041 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:01:02.046 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:01:02.047 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:01:02.049 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:01:03.482 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 21:01:03.488 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:01:03.499 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:01:03.502 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:03.505 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 21:01:03.506 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:01:03.508 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:01:03.510 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"sent","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","expiration_timestamp":"1751729462","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.512 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:01:03.513 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:01:03.514 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"sent","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","expiration_timestamp":"1751729462","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.517 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:01:03.519 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:01:03.521 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 11.471ms
2025-07-05 21:01:03.522 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"sent","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","expiration_timestamp":"1751729462","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.523 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:03.529 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 40.6652ms
2025-07-05 21:01:03.531 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:01:03.537 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==
2025-07-05 21:01:03.539 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==
2025-07-05 21:01:03.790 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:01:03.794 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:03.795 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:01:03.798 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"delivered","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.800 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:01:03.800 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"delivered","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.801 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:01:03.803 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:01:03.805 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.1246ms
2025-07-05 21:01:03.806 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==","status":"delivered","timestamp":"1751729462","recipient_id":"917082156227","conversation":{"id":"852710b286a0e77975222532d85eee77","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:01:03.808 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:03.812 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:01:03.812 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.7169ms
2025-07-05 21:01:03.815 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==
2025-07-05 21:01:03.819 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzlBRUYyMjZBOUZFQzE0QjJCAA==
2025-07-05 21:01:04.412 +05:30 [INF] Received HTTP response headers after 896.7496ms - 200
2025-07-05 21:01:04.413 +05:30 [INF] End processing HTTP request after 905.5303ms - 200
2025-07-05 21:01:04.438 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='4510b82f-a8d4-496b-8b37-36a5a16cc1e9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:31:04.4166673Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:31:04.4166675Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:01:04.441 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:01:04.443 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2391.9621ms
2025-07-05 21:01:04.445 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:01:04.446 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2404.7746ms
2025-07-05 21:01:05.281 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 21:01:05.284 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:05.286 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:01:05.288 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==","status":"failed","timestamp":"1751729464","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:01:05.290 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:01:05.290 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==","status":"failed","timestamp":"1751729464","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:01:05.291 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:01:05.292 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:01:05.295 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==","status":"failed","timestamp":"1751729464","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:01:05.294 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.4314ms
2025-07-05 21:01:05.299 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:01:05.299 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:01:05.302 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==
2025-07-05 21:01:05.303 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.428ms
2025-07-05 21:01:05.304 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzQ5OTM4N0FGNDNBMjY4M0U0AA==
2025-07-05 21:02:06.216 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 21:02:06.221 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:02:06.222 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 5.9687ms
2025-07-05 21:02:06.225 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:02:06.234 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:02:06.236 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:02:06.237 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:02:07.645 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 21:02:07.651 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:02:07.661 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 21:02:07.662 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:02:07.664 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:02:08.806 +05:30 [INF] Received HTTP response headers after 1140.4038ms - 200
2025-07-05 21:02:08.810 +05:30 [INF] End processing HTTP request after 1147.5952ms - 200
2025-07-05 21:02:08.815 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='355fa3dc-3a59-4228-805a-f95f8ba16ae7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:32:08.8127571Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:32:08.8127574Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:02:08.818 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:02:08.819 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2579.1938ms
2025-07-05 21:02:08.821 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:02:08.823 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2597.6818ms
2025-07-05 21:02:08.826 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:02:08.829 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:02:08.831 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:02:08.832 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:02:10.241 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 21:02:10.242 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:02:10.247 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:02:10.252 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:10.254 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 21:02:10.255 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:02:10.257 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:02:10.260 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"sent","timestamp":"1751729528","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","expiration_timestamp":"1751729528","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.261 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:02:10.263 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:02:10.263 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"sent","timestamp":"1751729528","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","expiration_timestamp":"1751729528","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.266 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:02:10.268 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:02:10.269 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 10.4171ms
2025-07-05 21:02:10.270 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"sent","timestamp":"1751729528","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","expiration_timestamp":"1751729528","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.272 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:10.276 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:02:10.276 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 33.6682ms
2025-07-05 21:02:10.279 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==
2025-07-05 21:02:10.284 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==
2025-07-05 21:02:10.382 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:02:10.385 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:10.387 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:02:10.389 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"delivered","timestamp":"1751729529","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.391 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:02:10.392 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"delivered","timestamp":"1751729529","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.392 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:02:10.394 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:02:10.396 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.7938ms
2025-07-05 21:02:10.396 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==","status":"delivered","timestamp":"1751729529","recipient_id":"917082156227","conversation":{"id":"1ba9f0230d44c0af8d39595adb1af92e","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:02:10.398 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:10.401 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:02:10.401 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 18.9628ms
2025-07-05 21:02:10.404 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==
2025-07-05 21:02:10.409 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSODE3Qjc5NzhDRDg0NDBFNDEwAA==
2025-07-05 21:02:11.314 +05:30 [INF] Received HTTP response headers after 1049.9414ms - 200
2025-07-05 21:02:11.318 +05:30 [INF] End processing HTTP request after 1060.6248ms - 200
2025-07-05 21:02:11.333 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@p0='f5034c4a-4d0c-4a39-87e3-ab5d86790155', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:32:11.3220933Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:32:11.3220935Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:02:11.337 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:02:11.339 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2505.6704ms
2025-07-05 21:02:11.341 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:02:11.343 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2516.2537ms
2025-07-05 21:02:12.126 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 715
2025-07-05 21:02:12.130 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:12.131 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:02:12.134 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==","status":"failed","timestamp":"1751729531","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:02:12.136 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:02:12.136 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==","status":"failed","timestamp":"1751729531","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:02:12.137 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:02:12.139 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:02:12.141 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2854ms
2025-07-05 21:02:12.142 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==","status":"failed","timestamp":"1751729531","recipient_id":"918130891737","errors":[{"code":131047,"title":"Re-engagement message","message":"Re-engagement message","error_data":{"details":"Message failed to send because more than 24 hours have passed since the customer last replied to this number."},"href":"https:\/\/developers.facebook.com\/docs\/whatsapp\/cloud-api\/support\/error-codes\/"}]}]},"field":"messages"}]}]}
2025-07-05 21:02:12.143 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:12.148 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.5244ms
2025-07-05 21:02:12.148 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:02:12.155 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==
2025-07-05 21:02:12.156 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjJERUVDNkNCMkYwOUJBOTIwAA==
2025-07-05 21:02:55.931 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 598
2025-07-05 21:02:55.935 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:55.938 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:02:55.941 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"sent","timestamp":"1751729574","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","expiration_timestamp":"1751729574","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:55.943 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:02:55.943 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"sent","timestamp":"1751729574","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","expiration_timestamp":"1751729574","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:55.946 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:02:55.948 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:02:55.949 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.9782ms
2025-07-05 21:02:55.952 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:55.953 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.6637ms
2025-07-05 21:02:55.950 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"sent","timestamp":"1751729574","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","expiration_timestamp":"1751729574","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:55.962 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:02:55.965 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:02:55.966 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:02:57.402 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 567
2025-07-05 21:02:57.406 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:57.408 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:02:57.411 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"delivered","timestamp":"1751729576","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:57.413 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:02:57.413 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"delivered","timestamp":"1751729576","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:57.414 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:02:57.416 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:02:57.418 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.5618ms
2025-07-05 21:02:57.420 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"delivered","timestamp":"1751729576","recipient_id":"918130891737","conversation":{"id":"a554deeb21e986577a23c2ad55e77eb6","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:02:57.422 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:02:57.424 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.8411ms
2025-07-05 21:02:57.426 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:02:57.439 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:02:57.440 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:03:08.058 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 598
2025-07-05 21:03:08.062 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.063 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:08.066 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"sent","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","expiration_timestamp":"1751729587","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.068 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:08.068 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"sent","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","expiration_timestamp":"1751729587","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.069 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:08.070 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:03:08.072 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.8885ms
2025-07-05 21:03:08.073 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"sent","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","expiration_timestamp":"1751729587","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.075 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.078 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.9291ms
2025-07-05 21:03:08.078 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:03:08.085 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:08.086 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:08.309 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 389
2025-07-05 21:03:08.313 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.315 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:08.317 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.319 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:08.319 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.320 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:08.321 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:03:08.323 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.3389ms
2025-07-05 21:03:08.326 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.326 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 16.9171ms
2025-07-05 21:03:08.324 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.333 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 567
2025-07-05 21:03:08.336 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:03:08.339 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.341 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:03:08.343 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQjUxRjJERjRDQzcxQUE1QzY1AA==
2025-07-05 21:03:08.342 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:08.347 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"delivered","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.349 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:08.349 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"delivered","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.350 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:08.352 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:03:08.354 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.3756ms
2025-07-05 21:03:08.355 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"delivered","timestamp":"1751729587","recipient_id":"918130891737","conversation":{"id":"133a5af64094f17e41924a9f359e94f4","origin":{"type":"utility"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"utility","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:03:08.356 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.360 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:03:08.361 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 28.2047ms
2025-07-05 21:03:08.374 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:08.379 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:08.450 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 389
2025-07-05 21:03:08.453 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.454 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:08.457 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.458 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:08.458 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.459 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:08.461 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:03:08.462 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.1596ms
2025-07-05 21:03:08.463 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==","status":"read","timestamp":"1751729587","recipient_id":"918130891737"}]},"field":"messages"}]}]}
2025-07-05 21:03:08.465 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:08.469 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:03:08.469 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.72ms
2025-07-05 21:03:08.472 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:08.477 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMDdFOEQyOUIyQzdGN0EwMkUzAA==
2025-07-05 21:03:23.220 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 488
2025-07-05 21:03:23.223 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:23.225 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:23.228 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggN0JEMENDQzJGMjI3NzM2RTY1RkREMkNCRUJBNUFEMzEA","timestamp":"1751729602","text":{"body":"Yes"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:03:23.230 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:23.230 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:23.230 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggN0JEMENDQzJGMjI3NzM2RTY1RkREMkNCRUJBNUFEMzEA","timestamp":"1751729602","text":{"body":"Yes"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:03:23.232 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 4.6848ms
2025-07-05 21:03:23.235 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:03:23.236 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:23.239 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.2132ms
2025-07-05 21:03:23.257 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:03:23.260 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:03:23.264 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:03:23.290 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='132f271b-f223-426d-adc9-9a000f447b36', @p1=NULL (DbType = Guid), @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='2025-07-05T15:33:23.2670539Z' (DbType = DateTime), @p4=NULL, @p5=NULL, @p6='True', @p7='False', @p8='False', @p9='False', @p10=NULL (DbType = DateTime), @p11=NULL, @p12=NULL (DbType = Guid), @p13=NULL (DbType = DateTime), @p14=NULL, @p15='WhatsApp User' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL, @p18='918130891737' (Nullable = false), @p19=NULL], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Contacts" ("Id", "AssignedAgentId", "BusinessId", "CreatedAt", "Email", "Group", "IsActive", "IsArchived", "IsAutomationPaused", "IsFavorite", "LastCTAInteraction", "LastCTAType", "LastClickedProductId", "LastContactedAt", "LeadSource", "Name", "NextFollowUpAt", "Notes", "PhoneNumber", "Tags")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
2025-07-05 21:03:23.292 +05:30 [INF] Contact created: "132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:03:23.304 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:03:23.309 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0b016d4a-3332-4f35-8e22-a9557cb4ff50', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:33:23.3067925Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Yes' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:33:23.3067928Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:03:25.276 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='yes'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:03:25.280 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'yes'
2025-07-05 21:03:25.282 +05:30 [INF] 🕵️ No automation flow matched keyword: yes
2025-07-05 21:03:25.283 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:03:32.434 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 512
2025-07-05 21:03:32.438 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:32.443 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:03:32.449 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggMjQ5NThFNzQ3NDQ3MjRCRDUwNDlDNUZBRTU1NTFCQUQA","timestamp":"1751729611","text":{"body":"I have received the message"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:03:32.452 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:03:32.452 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggMjQ5NThFNzQ3NDQ3MjRCRDUwNDlDNUZBRTU1NTFCQUQA","timestamp":"1751729611","text":{"body":"I have received the message"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:03:32.457 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:03:32.453 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:03:32.461 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 12.6197ms
2025-07-05 21:03:32.464 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:03:32.465 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:03:32.468 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:03:32.468 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 34.6513ms
2025-07-05 21:03:32.472 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:03:32.479 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:03:32.482 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:03:32.487 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='9e7f2b38-7a5a-45eb-84be-1865ceafdc22', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:33:32.4844681Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='I have received the message' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:33:32.4844685Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:03:37.295 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='i have received the message'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:03:37.299 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'i have received the message'
2025-07-05 21:03:37.301 +05:30 [INF] 🕵️ No automation flow matched keyword: i have received the message
2025-07-05 21:03:37.304 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:03:58.076 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 21:03:58.085 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:03:58.091 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 15.6795ms
2025-07-05 21:03:58.094 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:03:58.099 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:03:58.101 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:03:58.104 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:03:59.582 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 21:03:59.587 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:03:59.592 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 21:03:59.596 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:03:59.600 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:03:59.601 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:01.925 +05:30 [INF] Received HTTP response headers after 2321.8816ms - 200
2025-07-05 21:04:01.928 +05:30 [INF] End processing HTTP request after 2328.2529ms - 200
2025-07-05 21:04:01.953 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='70799b70-5ffd-427e-877a-3a5ce9297511', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:34:01.9320920Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:34:01.9320922Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:04:01.958 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:04:01.960 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 3852.1999ms
2025-07-05 21:04:01.962 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:01.964 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 3869.6621ms
2025-07-05 21:04:01.968 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 62
2025-07-05 21:04:01.973 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:04:01.975 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:01.977 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:04:03.467 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 21:04:03.468 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:04:03.469 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:04:03.472 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:04:03.472 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:03.475 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:03.479 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 21:04:03.480 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:03.481 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:03.483 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:03.485 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"sent","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","expiration_timestamp":"1751729642","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.487 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"delivered","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.488 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:03.489 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:03.492 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:03.495 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:03.490 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"sent","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","expiration_timestamp":"1751729642","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.497 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:03.498 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 13.7445ms
2025-07-05 21:04:03.500 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:03.501 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 14.9417ms
2025-07-05 21:04:03.503 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:03.504 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"sent","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","expiration_timestamp":"1751729642","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.506 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:03.507 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 39.3108ms
2025-07-05 21:04:03.511 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 42.2422ms
2025-07-05 21:04:03.511 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:03.523 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==
2025-07-05 21:04:03.525 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==
2025-07-05 21:04:03.527 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"delivered","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.529 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:03.530 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==","status":"delivered","timestamp":"1751729642","recipient_id":"917082156227","conversation":{"id":"f6714461c22340e5a1d2272bc0ed58a5","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:03.533 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:03.536 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==
2025-07-05 21:04:03.537 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMzQ5QTA2MzZFOTQ3NzZFNTZCAA==
2025-07-05 21:04:04.576 +05:30 [INF] Received HTTP response headers after 1082.9649ms - 200
2025-07-05 21:04:04.578 +05:30 [INF] End processing HTTP request after 1095.0771ms - 200
2025-07-05 21:04:04.602 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='1819af7e-436e-4739-8664-e85d8ab4d5d6', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:34:04.5821829Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hkjhkjhkjg' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='hkjhkjhkjg', @p16='2025-07-05T15:34:04.5821831Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:04:04.606 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:04:04.608 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 2628.1844ms
2025-07-05 21:04:04.609 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:04.611 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 2642.7594ms
2025-07-05 21:04:05.634 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:04:05.639 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:05.641 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:05.644 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"sent","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","expiration_timestamp":"1751729644","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.646 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:05.646 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"sent","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","expiration_timestamp":"1751729644","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.647 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:05.650 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:05.652 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.3694ms
2025-07-05 21:04:05.653 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"sent","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","expiration_timestamp":"1751729644","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.654 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:05.658 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:05.659 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.1198ms
2025-07-05 21:04:05.661 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==
2025-07-05 21:04:05.668 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==
2025-07-05 21:04:05.961 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 21:04:05.965 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:05.966 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:05.969 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"read","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.972 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:05.972 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"read","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.973 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:05.975 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:05.976 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.4173ms
2025-07-05 21:04:05.977 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==","status":"read","timestamp":"1751729644","recipient_id":"918130891737","conversation":{"id":"78aefc6b8c9f03238076e2f409c9a6fd","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:05.979 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:05.984 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:05.984 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.8178ms
2025-07-05 21:04:05.987 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==
2025-07-05 21:04:05.991 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNTU3Njg0NEIwQUYzMTQ5MERBAA==
2025-07-05 21:04:31.118 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - null null
2025-07-05 21:04:31.122 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:04:31.123 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-text - 204 null null 5.6367ms
2025-07-05 21:04:31.126 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 180
2025-07-05 21:04:31.132 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:04:31.133 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:31.134 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:04:34.863 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+917082156227
2025-07-05 21:04:34.869 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+917082156227'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:04:34.877 +05:30 [INF] Contact already exists: contactId="8aac7c57-6699-4511-897b-4121b407eb1c"
2025-07-05 21:04:34.879 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:34.881 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:35.843 +05:30 [INF] Received HTTP response headers after 960.4553ms - 200
2025-07-05 21:04:35.845 +05:30 [INF] End processing HTTP request after 965.5914ms - 200
2025-07-05 21:04:35.868 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='bbfad8dc-9c4c-4861-8fbb-f8e4973a99d0', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:34:35.8481585Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Clicking Generate access token will allow you to select one or more WhatsApp Business accounts to generate temporary tokens for.' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Clicking Generate access token will allow you to select one or more WhatsApp Business accounts to generate temporary tokens for.', @p16='2025-07-05T15:34:35.8481591Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:04:35.872 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:04:35.874 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 4737.5308ms
2025-07-05 21:04:35.877 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:35.879 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 4753.5062ms
2025-07-05 21:04:35.954 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - application/json 180
2025-07-05 21:04:35.958 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:04:35.961 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:35.962 +05:30 [INF] Route matched with {action = "SendTextMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTextMessage(xbytechat.api.Features.MessagesEngine.DTOs.TextMessageSendDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:04:35.965 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=+918130891737
2025-07-05 21:04:35.970 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='+918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:04:35.977 +05:30 [INF] Contact already exists: contactId="63faf7a5-4506-431d-884c-cb0a363fa7ac"
2025-07-05 21:04:35.979 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:35.982 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:04:36.938 +05:30 [INF] Received HTTP response headers after 954.3475ms - 200
2025-07-05 21:04:36.940 +05:30 [INF] End processing HTTP request after 961.0314ms - 200
2025-07-05 21:04:36.949 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='d5f3526c-fbad-4e19-ae67-8340ed359b33', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p6='2025-07-05T15:34:36.9443662Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Clicking Generate access token will allow you to select one or more WhatsApp Business accounts to generate temporary tokens for.' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Clicking Generate access token will allow you to select one or more WhatsApp Business accounts to generate temporary tokens for.', @p16='2025-07-05T15:34:36.9443664Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:04:36.953 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:04:36.957 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api) in 992.3204ms
2025-07-05 21:04:36.959 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTextMessage (xbytechat.api)'
2025-07-05 21:04:36.961 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-text - 200 null application/json; charset=utf-8 1007.6789ms
2025-07-05 21:04:37.014 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:04:37.019 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.020 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:37.024 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"sent","timestamp":"1751729675","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","expiration_timestamp":"1751729675","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.026 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:37.027 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"sent","timestamp":"1751729675","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","expiration_timestamp":"1751729675","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.028 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:37.030 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:37.031 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.918ms
2025-07-05 21:04:37.032 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"sent","timestamp":"1751729675","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","expiration_timestamp":"1751729675","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.034 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.037 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.4254ms
2025-07-05 21:04:37.037 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:37.046 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==
2025-07-05 21:04:37.047 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==
2025-07-05 21:04:37.660 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:04:37.664 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.665 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:37.668 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"delivered","timestamp":"1751729676","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.669 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:37.670 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"delivered","timestamp":"1751729676","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.670 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:37.672 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:37.674 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.8146ms
2025-07-05 21:04:37.675 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==","status":"delivered","timestamp":"1751729676","recipient_id":"917082156227","conversation":{"id":"701b9550d1181f0d766557cc7d3e7aa7","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.677 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.680 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.6163ms
2025-07-05 21:04:37.680 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:37.687 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==
2025-07-05 21:04:37.688 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSOEE1QjdEREM4RTQ4NDA0MDY0AA==
2025-07-05 21:04:37.885 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:04:37.889 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.890 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:37.893 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"sent","timestamp":"1751729676","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","expiration_timestamp":"1751729676","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.895 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:37.895 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"sent","timestamp":"1751729676","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","expiration_timestamp":"1751729676","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.896 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:37.898 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:37.900 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2609ms
2025-07-05 21:04:37.901 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"sent","timestamp":"1751729676","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","expiration_timestamp":"1751729676","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.902 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.905 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.0623ms
2025-07-05 21:04:37.906 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:37.913 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==
2025-07-05 21:04:37.914 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==
2025-07-05 21:04:37.916 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 21:04:37.920 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.922 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:04:37.924 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"read","timestamp":"1751729677","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.926 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:04:37.926 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"read","timestamp":"1751729677","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.927 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:04:37.929 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:04:37.931 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.4638ms
2025-07-05 21:04:37.932 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==","status":"read","timestamp":"1751729677","recipient_id":"918130891737","conversation":{"id":"7b13756170f67bae3a55d0459fce8518","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:04:37.934 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:04:37.938 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.6179ms
2025-07-05 21:04:37.938 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:04:37.946 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==
2025-07-05 21:04:37.947 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSOEY0QThDOUMzRjVGRkFFQUVDAA==
2025-07-05 21:05:01.463 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:05:01.468 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.470 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 6.7977ms
2025-07-05 21:05:01.478 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:05:01.479 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:05:01.482 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.485 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.487 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:01.487 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 8.8858ms
2025-07-05 21:05:01.491 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:05:01.609 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-05 21:05:01.608 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-05 21:05:01.619 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.623 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.628 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:01.628 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=dlzjo_I2ciLH0E79jPNEGg - null null
2025-07-05 21:05:01.632 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:05:01.622 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:01.626 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.636 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:01.640 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.642 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 164.1788ms
2025-07-05 21:05:01.644 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:05:01.645 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:01.645 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 154.404ms
2025-07-05 21:05:01.646 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:05:01.656 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:01.667 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-05 21:05:01.675 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-05 21:05:01.709 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=LMRIML2x36TvnLBi2ky6sA - null null
2025-07-05 21:05:01.714 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:01.715 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:05:01.719 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:05:01.743 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:05:01.749 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 94.5068ms
2025-07-05 21:05:01.751 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:05:01.753 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 143.8703ms
2025-07-05 21:05:01.887 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-05 21:05:01.891 +05:30 [INF] GetAllContactsAsync returned 10 contacts
2025-07-05 21:05:01.893 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:05:01.897 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 233.9495ms
2025-07-05 21:05:01.899 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:05:01.901 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 292.6129ms
2025-07-05 21:05:05.595 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null 0
2025-07-05 21:05:05.604 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:05.604 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:05.605 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:05.608 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:05.614 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:05:05.614 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:05.618 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:05.614 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:05:05.621 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:05.629 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:05.629 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:05.647 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-05 21:05:09.277 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:05:09.282 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p1='0b016d4a-3332-4f35-8e22-a9557cb4ff50', @p0='Read' (Nullable = false), @p3='9e7f2b38-7a5a-45eb-84be-1865ceafdc22', @p2='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
2025-07-05 21:05:09.301 +05:30 [INF] Executed DbCommand (10ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-05 21:05:09.303 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-05 21:05:09.307 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 3678.0333ms
2025-07-05 21:05:09.308 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:05:09.311 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:05:09.317 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:05:09.320 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='132f271b-f223-426d-adc9-9a000f447b36', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-05 21:05:09.323 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 3669.5947ms
2025-07-05 21:05:09.320 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 0 null 3724.9969ms
2025-07-05 21:05:09.334 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:09.336 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='1996d4f9-d78e-42b0-a685-86338454011e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='132f271b-f223-426d-adc9-9a000f447b36', @p3='2025-07-05T15:35:09.3117188Z' (DbType = DateTime), @p4='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ContactReads" ("Id", "BusinessId", "ContactId", "LastReadAt", "UserId")
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-07-05 21:05:09.339 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:09.340 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:05:09.341 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 3736.7076ms
2025-07-05 21:05:09.349 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:09.351 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:05:09.356 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 3717.5311ms
2025-07-05 21:05:09.359 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:09.364 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:05:09.366 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:09.369 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-05 21:05:09.367 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 3762.8955ms
2025-07-05 21:05:09.371 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:05:09.384 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:05:09.389 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:05:09.391 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 19.9376ms
2025-07-05 21:05:09.393 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:09.394 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 54.8336ms
2025-07-05 21:05:36.954 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 534
2025-07-05 21:05:36.958 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:05:36.959 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:05:36.963 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggODE5QUJDMTZCM0REOURCNDkzMzE2QjZFNUZDRDVCQjIA","timestamp":"1751729735","text":{"body":"Hello \n\nI need help to understand the use case."},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:05:36.965 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:05:36.965 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggODE5QUJDMTZCM0REOURCNDkzMzE2QjZFNUZDRDVCQjIA","timestamp":"1751729735","text":{"body":"Hello \n\nI need help to understand the use case."},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:05:36.966 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:05:36.968 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:05:36.969 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2355ms
2025-07-05 21:05:36.973 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:05:36.975 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.1815ms
2025-07-05 21:05:36.982 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:05:36.985 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:05:36.989 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:05:36.993 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:05:36.997 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:05:37.020 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='9f82b916-d2ee-4d06-81f4-588b8356636d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:35:37.0001010Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Hello 

I need help to understand the use case.' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:35:37.0001013Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:05:38.653 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='hello 

i need help to understand the use case.'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:05:38.656 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'hello 

i need help to understand the use case.'
2025-07-05 21:05:38.657 +05:30 [INF] 🕵️ No automation flow matched keyword: hello 

i need help to understand the use case.
2025-07-05 21:05:38.658 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:05:41.930 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:05:41.930 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:05:41.932 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=dlzjo_I2ciLH0E79jPNEGg - 101 null null 40304.1329ms
2025-07-05 21:05:41.934 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=LMRIML2x36TvnLBi2ky6sA - 101 null null 40224.5691ms
2025-07-05 21:05:42.365 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 21:05:42.372 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:05:42.374 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 21:05:42.376 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:05:42.378 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.1244ms
2025-07-05 21:05:42.380 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:05:42.381 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 15.3878ms
2025-07-05 21:05:42.469 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 21:05:42.476 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:05:42.478 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 21:05:42.486 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:05:42.492 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 21:05:42.495 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 21:05:42.498 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 21:05:42.499 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 21:05:42.500 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 21:05:42.501 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 21:05:42.502 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 21:05:42.504 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 21:05:42.505 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 21:05:42.506 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 21:05:42.507 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 21:05:42.508 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 21:05:42.509 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 21:05:42.510 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 21:05:42.513 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:05:42.514 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 33.0242ms
2025-07-05 21:05:42.516 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:05:42.518 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 48.6792ms
2025-07-05 21:05:42.560 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:05:42.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-05 21:05:42.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-05 21:05:42.564 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.567 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.571 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:05:42.571 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.572 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 12.0496ms
2025-07-05 21:05:42.574 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:05:42.574 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:05:42.576 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.591 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 19.3821ms
2025-07-05 21:05:42.583 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:42.594 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:05:42.587 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.578 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:05:42.599 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-05 21:05:42.602 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.603 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:42.609 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:42.612 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:42.614 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 20.6634ms
2025-07-05 21:05:42.611 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:05:42.609 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-05 21:05:42.604 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:42.619 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 45.3625ms
2025-07-05 21:05:42.626 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-05 21:05:42.623 +05:30 [INF] GetAllContactsAsync returned 10 contacts
2025-07-05 21:05:42.637 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:05:42.638 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:05:42.640 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=RgMG7GB-lZ36VxboVYKAXA - null null
2025-07-05 21:05:42.642 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:05:42.643 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 44.4276ms
2025-07-05 21:05:42.646 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.647 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 23.0051ms
2025-07-05 21:05:42.649 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:05:42.650 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:05:42.652 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:05:42.653 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 91.354ms
2025-07-05 21:05:42.659 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 96.5814ms
2025-07-05 21:05:42.670 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=rztU-17Hp2qNHdAYfKFWVA - null null
2025-07-05 21:05:42.673 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:42.674 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:05:44.827 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null 0
2025-07-05 21:05:44.836 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:44.837 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:44.837 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:44.838 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:05:44.841 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:44.844 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:44.846 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:44.847 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:44.854 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-05 21:05:44.847 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:05:44.856 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:44.863 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p1='9f82b916-d2ee-4d06-81f4-588b8356636d', @p0='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
2025-07-05 21:05:44.863 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:05:44.867 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:05:44.871 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-05 21:05:44.878 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-05 21:05:44.882 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:05:44.879 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 29.8446ms
2025-07-05 21:05:44.886 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:05:44.888 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:05:44.889 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:05:44.891 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 18.175ms
2025-07-05 21:05:44.893 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 26.3915ms
2025-07-05 21:05:44.894 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:05:44.894 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 0 null 67.2561ms
2025-07-05 21:05:44.896 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:05:44.898 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:44.901 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:05:44.909 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 71.4697ms
2025-07-05 21:05:44.910 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 73.0291ms
2025-07-05 21:05:44.912 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:44.922 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:05:44.925 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:05:44.931 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:05:44.935 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:05:44.938 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 12.8713ms
2025-07-05 21:05:44.939 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:05:44.941 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 46.6396ms
2025-07-05 21:05:45.638 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='132f271b-f223-426d-adc9-9a000f447b36', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-05 21:05:45.663 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p1='1996d4f9-d78e-42b0-a685-86338454011e', @p0='2025-07-05T15:35:45.6367776Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-05 21:05:45.671 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:05:45.676 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-05 21:07:55.684 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:07:55.684 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:07:55.686 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=rztU-17Hp2qNHdAYfKFWVA - 101 null null 133016.4691ms
2025-07-05 21:07:55.687 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=RgMG7GB-lZ36VxboVYKAXA - 101 null null 133046.7498ms
2025-07-05 21:08:54.416 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 21:08:54.420 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:08:54.422 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:08:54.423 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:08:54.427 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:08:54.430 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:08:54.431 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:08:54.439 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 21:08:54.443 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:08:54.447 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:08:54.473 +05:30 [INF] Executed DbCommand (15ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:08:54.483 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:08:54.485 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 46.6273ms
2025-07-05 21:08:54.487 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:08:54.488 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 72.6433ms
2025-07-05 21:08:54.498 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:08:54.503 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:08:54.504 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:08:58.581 +05:30 [INF] Received HTTP response headers after 4074.8498ms - 200
2025-07-05 21:08:58.583 +05:30 [INF] End processing HTTP request after 4080.3515ms - 200
2025-07-05 21:08:58.681 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=LGPD95Au878_T9qo9DUdBg&oh=01_Q5Aa1wHBgLf1ESLP_t1oEuJjfFkMKiCLKUNaXuu4Z0-OCnQCMg&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=LGPD95Au878_T9qo9DUdBg&oh=01_Q5Aa1wGSpg3Kd-tt449zSiSEo_cGLODUSfiEhEwzAWrhIw5CsA&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:08:58.732 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:08:58.740 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 4289.5999ms
2025-07-05 21:08:58.742 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:08:58.743 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 4321.0307ms
2025-07-05 21:11:21.338 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 21:11:21.342 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:11:21.344 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:11:21.346 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:11:21.346 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:11:21.356 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:11:21.357 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 21:11:21.358 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:11:21.363 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:11:21.366 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:11:21.387 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:11:21.398 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:11:21.400 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 43.3825ms
2025-07-05 21:11:21.402 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:11:21.403 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 65.6307ms
2025-07-05 21:11:21.583 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:11:21.587 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:11:21.588 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:11:22.978 +05:30 [INF] Received HTTP response headers after 1388.793ms - 200
2025-07-05 21:11:22.984 +05:30 [INF] End processing HTTP request after 1397.5397ms - 200
2025-07-05 21:11:23.003 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=FsRbpYadysanh5i55yN9cA&oh=01_Q5Aa1wHNnc_1PFhm9xeZ1a9D7wB4XbqkmhAu-YHgQsZYCa2AiA&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=FsRbpYadysanh5i55yN9cA&oh=01_Q5Aa1wGf39GRjGs21PctJMyoblRjQLeJqF1SW3Y0a3pBusyLEQ&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:11:23.007 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:11:23.010 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1633.1033ms
2025-07-05 21:11:23.016 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:11:23.017 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1671.6451ms
2025-07-05 21:12:48.254 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-05 21:12:48.267 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:12:48.268 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 14.1947ms
2025-07-05 21:12:48.271 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:12:48.276 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:12:48.278 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:12:48.287 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:12:50.301 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:12:50.304 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:12:50.305 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:12:52.188 +05:30 [INF] Received HTTP response headers after 1880.6523ms - 200
2025-07-05 21:12:52.189 +05:30 [INF] End processing HTTP request after 1885.2458ms - 200
2025-07-05 21:12:52.215 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='26523143-be3e-4cbf-8bcf-b14344ac1385', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:42:52.1935085Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:42:52.1935086Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:12:52.220 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:12:52.224 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3933.8916ms
2025-07-05 21:12:52.228 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:12:52.230 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3958.4517ms
2025-07-05 21:12:59.606 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:12:59.610 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:12:59.611 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:12:59.614 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==","status":"failed","timestamp":"1751730178","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:12:59.617 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:12:59.617 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==","status":"failed","timestamp":"1751730178","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:12:59.618 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:12:59.621 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:12:59.622 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.414ms
2025-07-05 21:12:59.624 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==","status":"failed","timestamp":"1751730178","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:12:59.625 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:12:59.630 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:12:59.630 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.9015ms
2025-07-05 21:12:59.633 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==
2025-07-05 21:12:59.638 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDExNUNCNTUzNkE1NzE5RTZDAA==
2025-07-05 21:13:23.794 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-05 21:13:23.798 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:23.803 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 8.7783ms
2025-07-05 21:13:23.805 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:13:23.811 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:23.812 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:23.814 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:13:26.768 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:26.769 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:27.632 +05:30 [INF] Received HTTP response headers after 861.7338ms - 200
2025-07-05 21:13:27.634 +05:30 [INF] End processing HTTP request after 865.9407ms - 200
2025-07-05 21:13:27.639 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='8f0ce191-3519-4bed-9680-978146b2aa51', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:43:27.6370988Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:43:27.6370989Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:13:27.643 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:27.645 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3828.1187ms
2025-07-05 21:13:27.648 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:27.649 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3843.9884ms
2025-07-05 21:13:27.654 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:13:27.657 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:27.659 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:27.661 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:13:30.105 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:30.108 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:30.994 +05:30 [INF] Received HTTP response headers after 884.1747ms - 200
2025-07-05 21:13:30.998 +05:30 [INF] End processing HTTP request after 892.5474ms - 200
2025-07-05 21:13:31.004 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='0ece731c-85e7-4998-badc-af5ac1e7a203', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:43:31.0010737Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:43:31.0010739Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:13:31.008 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:31.009 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3345.7036ms
2025-07-05 21:13:31.011 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:31.014 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3359.8789ms
2025-07-05 21:13:35.398 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:13:35.402 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:35.403 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:13:35.407 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==","status":"failed","timestamp":"1751730214","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:35.409 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:13:35.410 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==","status":"failed","timestamp":"1751730214","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:35.411 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:35.412 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:13:35.415 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==","status":"failed","timestamp":"1751730214","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:35.414 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.0075ms
2025-07-05 21:13:35.418 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:13:35.419 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:35.422 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==
2025-07-05 21:13:35.425 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNDY5NzQyOTA5RjdFMTI3Q0UwAA==
2025-07-05 21:13:35.423 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.6754ms
2025-07-05 21:13:37.825 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:13:37.829 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:37.830 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:13:37.833 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==","status":"failed","timestamp":"1751730216","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:37.835 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:13:37.835 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==","status":"failed","timestamp":"1751730216","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:37.836 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:37.839 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.0834ms
2025-07-05 21:13:37.840 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:37.838 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:13:37.843 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 17.6672ms
2025-07-05 21:13:37.844 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==","status":"failed","timestamp":"1751730216","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:13:37.852 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:13:37.856 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==
2025-07-05 21:13:37.858 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMDcyNDExNjUyNDg4OTI0NDc3AA==
2025-07-05 21:13:49.135 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-05 21:13:49.139 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:49.140 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 5.1428ms
2025-07-05 21:13:49.142 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:13:49.147 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:49.149 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:49.151 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:13:51.597 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:51.599 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:52.674 +05:30 [INF] Received HTTP response headers after 1072.4797ms - 200
2025-07-05 21:13:52.678 +05:30 [INF] End processing HTTP request after 1081.0303ms - 200
2025-07-05 21:13:52.686 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='7b7b51a2-7a34-4997-a93e-61fdb696901f', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:43:52.6835861Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:43:52.6835863Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:13:52.690 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:52.692 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3538.4968ms
2025-07-05 21:13:52.696 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:52.698 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3556.5696ms
2025-07-05 21:13:52.705 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:13:52.709 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:13:52.710 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:52.713 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:13:55.665 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:55.667 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:13:56.423 +05:30 [INF] Received HTTP response headers after 753.901ms - 200
2025-07-05 21:13:56.425 +05:30 [INF] End processing HTTP request after 760.3776ms - 200
2025-07-05 21:13:56.449 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='5a21d2c4-08a2-424f-8e70-02f90230b469', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:43:56.4288078Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:43:56.4288079Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:13:56.452 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:56.454 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3739.1942ms
2025-07-05 21:13:56.457 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:13:56.459 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3753.9163ms
2025-07-05 21:13:59.398 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 512
2025-07-05 21:13:59.402 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:59.403 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:13:59.407 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggNEZGMTVBRUI4NjcwQ0RERDgyNzREOEM5OEFFN0Y2MUUA","timestamp":"1751730237","text":{"body":"I am not receiving anything"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:13:59.408 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:13:59.409 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggNEZGMTVBRUI4NjcwQ0RERDgyNzREOEM5OEFFN0Y2MUUA","timestamp":"1751730237","text":{"body":"I am not receiving anything"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:13:59.409 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:13:59.411 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:13:59.413 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.3879ms
2025-07-05 21:13:59.416 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:13:59.416 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:13:59.419 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:13:59.421 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.5234ms
2025-07-05 21:13:59.425 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:13:59.430 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:13:59.433 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:13:59.452 +05:30 [INF] Executed DbCommand (16ms) [Parameters=[@p0='8e31ad64-a427-4ac4-ba1d-b181adf64e56', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:43:59.4361373Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='I am not receiving anything' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:43:59.4361375Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:14:14.748 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:14:14.750 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='i am not receiving anything'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:14:14.750 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:14:14.764 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:14.767 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'i am not receiving anything'
2025-07-05 21:14:14.770 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:14.771 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:14:14.772 +05:30 [INF] 🕵️ No automation flow matched keyword: i am not receiving anything
2025-07-05 21:14:14.774 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:14:14.776 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==","status":"failed","timestamp":"1751730238","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.778 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:14:14.780 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==","status":"failed","timestamp":"1751730242","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.781 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:14:14.783 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==","status":"failed","timestamp":"1751730238","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.784 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:14:14.785 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:14.787 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:14:14.788 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:14.790 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 14.0655ms
2025-07-05 21:14:14.791 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==","status":"failed","timestamp":"1751730238","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.793 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 13.3572ms
2025-07-05 21:14:14.795 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:14.798 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:14:14.799 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:14.801 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 52.6701ms
2025-07-05 21:14:14.803 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==
2025-07-05 21:14:14.804 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 54.6859ms
2025-07-05 21:14:14.810 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzRGMTMyODZCNUQ1NzA2OEEzAA==
2025-07-05 21:14:14.817 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==","status":"failed","timestamp":"1751730242","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.819 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:14:14.820 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==","status":"failed","timestamp":"1751730242","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:14.824 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:14:14.828 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==
2025-07-05 21:14:14.829 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQTE3MkQ2MDQ2OEJCQTA3NTI3AA==
2025-07-05 21:14:38.680 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-05 21:14:38.688 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:38.696 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 15.7343ms
2025-07-05 21:14:38.699 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:14:38.704 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:38.705 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:14:38.717 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:14:40.903 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:14:40.906 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:14:42.557 +05:30 [INF] Received HTTP response headers after 1649.9381ms - 200
2025-07-05 21:14:42.560 +05:30 [INF] End processing HTTP request after 1656.9458ms - 200
2025-07-05 21:14:42.582 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p0='91d67e98-5ef6-4d47-96c7-c75bfc9c379a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:44:42.5629926Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:44:42.5629927Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:14:42.586 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:42.588 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3868.7182ms
2025-07-05 21:14:42.590 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:14:42.592 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3892.6514ms
2025-07-05 21:14:42.596 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:14:42.599 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:42.599 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:14:42.601 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:14:43.907 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:14:43.908 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:14:44.897 +05:30 [INF] Received HTTP response headers after 987.9871ms - 200
2025-07-05 21:14:44.900 +05:30 [INF] End processing HTTP request after 992.9602ms - 200
2025-07-05 21:14:44.933 +05:30 [INF] Executed DbCommand (25ms) [Parameters=[@p0='26dba3fb-2c0a-4863-ae04-7fd3ec3da7ef', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:44:44.9059961Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:44:44.9059962Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:14:44.941 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:44.948 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 2344.1997ms
2025-07-05 21:14:44.951 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:14:44.959 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 2363.2236ms
2025-07-05 21:14:49.872 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:14:49.876 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:49.877 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:14:49.881 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==","status":"failed","timestamp":"1751730289","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:49.884 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:14:49.884 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==","status":"failed","timestamp":"1751730289","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:49.885 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:49.886 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:14:49.889 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 9.548ms
2025-07-05 21:14:49.890 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==","status":"failed","timestamp":"1751730289","recipient_id":"918130891737","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:49.893 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:49.898 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.191ms
2025-07-05 21:14:49.898 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:14:49.905 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==
2025-07-05 21:14:49.906 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSNzY5MjVBMjk2MUFCMTAxODg4AA==
2025-07-05 21:14:51.915 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 562
2025-07-05 21:14:51.918 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:51.920 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:14:51.923 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==","status":"failed","timestamp":"1751730290","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:51.925 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:14:51.925 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==","status":"failed","timestamp":"1751730290","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:51.926 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:51.927 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:14:51.929 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.3272ms
2025-07-05 21:14:51.930 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==","status":"failed","timestamp":"1751730290","recipient_id":"917082156227","errors":[{"code":131000,"title":"Something went wrong","message":"Something went wrong","error_data":{"details":"Application does not have permission for this action"}}]}]},"field":"messages"}]}]}
2025-07-05 21:14:51.932 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:14:51.935 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:14:51.935 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.4527ms
2025-07-05 21:14:51.938 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==
2025-07-05 21:14:51.943 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSNkVGMThGRTdFNUNCMDkyNkY3AA==
2025-07-05 21:14:55.708 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - null null
2025-07-05 21:14:55.715 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:55.718 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 21:14:55.726 +05:30 [INF] Route matched with {action = "GetMySettings", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMySettings() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 21:14:55.736 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."BusinessId" = @__businessId_0 AND w."IsActive"
LIMIT 1
2025-07-05 21:14:55.742 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat_api.WhatsAppSettings.Models.WhatsAppSettingEntity'.
2025-07-05 21:14:55.746 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api) in 14.4857ms
2025-07-05 21:14:55.748 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.GetMySettings (xbytechat.api)'
2025-07-05 21:14:55.750 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/whatsappsettings/me - 200 null application/json; charset=utf-8 42.3427ms
2025-07-05 21:14:56.970 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - null null
2025-07-05 21:14:56.974 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:56.978 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/whatsappsettings/test-connection - 204 null null 7.5409ms
2025-07-05 21:14:56.980 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - application/json 473
2025-07-05 21:14:56.986 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:14:56.987 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 21:14:56.989 +05:30 [INF] Route matched with {action = "TestConnection", controller = "WhatsAppSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] TestConnection(xbytechat_api.WhatsAppSettings.DTOs.SaveWhatsAppSettingDto) on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController (xbytechat.api).
2025-07-05 21:14:58.027 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:14:58.030 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api) in 1038.5274ms
2025-07-05 21:14:58.031 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppSettingsController.TestConnection (xbytechat.api)'
2025-07-05 21:14:58.033 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/whatsappsettings/test-connection - 200 null application/json; charset=utf-8 1052.9613ms
2025-07-05 21:15:03.067 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 21:15:03.067 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:15:03.086 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:03.095 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:03.097 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:15:03.099 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:15:03.101 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:15:03.100 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:15:03.113 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:15:03.116 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 21:15:03.119 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:03.125 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:03.125 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:15:03.138 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:15:03.142 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:03.143 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 27.4169ms
2025-07-05 21:15:03.145 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:15:03.147 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 79.7999ms
2025-07-05 21:15:07.718 +05:30 [INF] Received HTTP response headers after 4590.1615ms - 200
2025-07-05 21:15:07.720 +05:30 [INF] End processing HTTP request after 4600.8101ms - 200
2025-07-05 21:15:07.845 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=fAdeKg_tTu_g3fSuaGaAgA&oh=01_Q5Aa1wG8DteL7bdaUQOiqgcVQcUHcOUsemjEFRhmL5f7jCafaw&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=fAdeKg_tTu_g3fSuaGaAgA&oh=01_Q5Aa1wEuvCSYaLeHVOrifk6rk2ScyJoVWU4OjCANqqwLvOBYvQ&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:15:07.850 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:15:07.853 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 4743.9021ms
2025-07-05 21:15:07.859 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:15:07.860 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 4793.031ms
2025-07-05 21:15:12.647 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - null null
2025-07-05 21:15:12.654 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:12.655 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - 204 null null 7.8269ms
2025-07-05 21:15:12.657 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 155
2025-07-05 21:15:12.665 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:12.667 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:12.673 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:15:12.686 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:12.688 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:14.397 +05:30 [INF] Received HTTP response headers after 1707.4776ms - 400
2025-07-05 21:15:14.400 +05:30 [INF] End processing HTTP request after 1713.6328ms - 400
2025-07-05 21:15:14.417 +05:30 [INF] Executed DbCommand (11ms) [Parameters=[@p0='70ca54aa-40de-4d66-8a01-5c4085f75d89', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:45:14.4059095Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"A21h4SPWNoxUzXdhVnpYbfJ\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:45:14.4059088Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:15:14.421 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:14.422 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 1747.2969ms
2025-07-05 21:15:14.426 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:14.428 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 1771.4593ms
2025-07-05 21:15:16.500 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 155
2025-07-05 21:15:16.503 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:16.504 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:16.505 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:15:16.508 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:16.512 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:17.565 +05:30 [INF] Received HTTP response headers after 1050.5972ms - 400
2025-07-05 21:15:17.567 +05:30 [INF] End processing HTTP request after 1058.7335ms - 400
2025-07-05 21:15:17.573 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='868583bc-3ec1-458f-8ae7-20bf784fa38d', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:45:17.5703028Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AG-APYzFktTTmT2rfm0_RHw\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:45:17.5703019Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:15:17.577 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:17.579 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 1071.3313ms
2025-07-05 21:15:17.581 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:17.582 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 1082.8847ms
2025-07-05 21:15:17.587 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 155
2025-07-05 21:15:17.590 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:17.591 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:17.593 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:15:17.596 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:17.597 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:18.577 +05:30 [INF] Received HTTP response headers after 977.9989ms - 400
2025-07-05 21:15:18.579 +05:30 [INF] End processing HTTP request after 982.4167ms - 400
2025-07-05 21:15:18.604 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='4776bae6-05b6-4019-9f10-5f5472d6eeab', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:45:18.5828021Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"A1Gx88P9if_Gz5ZQ2pT9A7l\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:45:18.5828015Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:15:18.608 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:18.611 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 1015.7525ms
2025-07-05 21:15:18.613 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:18.615 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 1028.8082ms
2025-07-05 21:15:29.580 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - null null
2025-07-05 21:15:29.588 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:29.589 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - 204 null null 9.1361ms
2025-07-05 21:15:29.591 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 155
2025-07-05 21:15:29.595 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:29.597 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:29.598 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:15:29.602 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:29.604 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:30.363 +05:30 [INF] Received HTTP response headers after 757.5123ms - 400
2025-07-05 21:15:30.366 +05:30 [INF] End processing HTTP request after 763.7762ms - 400
2025-07-05 21:15:30.374 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='b12caede-01ad-440e-b8ba-0f47fbd59584', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:45:30.3718711Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AF-ibCwHBh1YGuOjkX5-Fhv\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:45:30.3718703Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:15:30.379 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:30.380 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 779.7055ms
2025-07-05 21:15:30.383 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:30.385 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 793.7045ms
2025-07-05 21:15:30.389 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 155
2025-07-05 21:15:30.392 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:30.394 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:30.395 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:15:30.400 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:30.401 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:15:31.062 +05:30 [INF] Received HTTP response headers after 659.3217ms - 400
2025-07-05 21:15:31.064 +05:30 [INF] End processing HTTP request after 664.0926ms - 400
2025-07-05 21:15:31.088 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='30c47de6-f9a8-4023-9631-6b3446c85ed2', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:45:31.0677277Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AMj-W5tGcP7YfiEI2XLjjo_\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:45:31.0677271Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:15:31.092 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:31.094 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 696.5017ms
2025-07-05 21:15:31.095 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:15:31.097 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 707.8341ms
2025-07-05 21:15:41.149 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:15:41.161 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:41.163 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:15:41.165 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:15:41.178 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:15:41.183 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:41.184 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:42.870 +05:30 [INF] Received HTTP response headers after 1683.2547ms - 200
2025-07-05 21:15:42.872 +05:30 [INF] End processing HTTP request after 1689.5311ms - 200
2025-07-05 21:15:42.874 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=CPKVM1H6hBJOZ6bv2jSEwA&oh=01_Q5Aa1wGg_RXrVjLSIs0tlZU5_kDDgWlQctA6HcMCzmWf3L_rEA&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=CPKVM1H6hBJOZ6bv2jSEwA&oh=01_Q5Aa1wGIZhl5JM_JQzL99Z-aTAZL_A491NYxdzOOOvV5hb-Mcg&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:15:42.877 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:15:42.878 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1711.0714ms
2025-07-05 21:15:42.881 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:15:42.882 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1733.081ms
2025-07-05 21:15:53.116 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - null null
2025-07-05 21:15:53.122 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:53.123 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/create-text-campaign - 204 null null 6.6354ms
2025-07-05 21:15:53.125 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - application/json 217
2025-07-05 21:15:53.133 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:53.134 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-05 21:15:53.141 +05:30 [INF] Route matched with {action = "CreateTextCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTextCampaign(xbytechat.api.Features.CampaignModule.DTOs.CampaignCreateDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:15:54.860 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-05 21:15:54.866 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:54.867 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:15:57.928 +05:30 [INF] Received HTTP response headers after 3059.6005ms - 200
2025-07-05 21:15:57.931 +05:30 [INF] End processing HTTP request after 3065.1586ms - 200
2025-07-05 21:15:58.021 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3='text', @p4='2025-07-05T15:45:57.9364496Z' (DbType = DateTime), @p5='system', @p6=NULL (DbType = Guid), @p7=NULL (DbType = DateTime), @p8=NULL, @p9=NULL, @p10=NULL, @p11=NULL, @p12='False', @p13='Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.', @p14='hello_world' (Nullable = false), @p15='test campaign' (Nullable = false), @p16=NULL (DbType = DateTime), @p17=NULL (DbType = Guid), @p18='Draft' (Nullable = false), @p19='hello_world', @p20='[]', @p21='2025-07-05T15:45:57.9365556Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Campaigns" ("Id", "BusinessId", "CampaignId", "CampaignType", "CreatedAt", "CreatedBy", "CtaId", "DeletedAt", "DeletedBy", "FollowUpTemplateId", "ImageCaption", "ImageUrl", "IsDeleted", "MessageBody", "MessageTemplate", "Name", "ScheduledAt", "SourceCampaignId", "Status", "TemplateId", "TemplateParameters", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21);
2025-07-05 21:15:58.026 +05:30 [INF] ✅ Campaign 'test campaign' created with 0 recipients, 0 user buttons, 0 template buttons and 0 template parameters
2025-07-05 21:15:58.031 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType20`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:15:58.035 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api) in 4892.5394ms
2025-07-05 21:15:58.037 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.CreateTextCampaign (xbytechat.api)'
2025-07-05 21:15:58.040 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/create-text-campaign - 200 null application/json; charset=utf-8 4914.5482ms
2025-07-05 21:15:58.139 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - null null
2025-07-05 21:15:58.139 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-05 21:15:58.143 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:58.148 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:58.149 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-05 21:15:58.151 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 21:15:58.156 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - null null
2025-07-05 21:15:58.156 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-05 21:15:58.157 +05:30 [INF] Route matched with {action = "GetCampaignById", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignModule.DTOs.CampaignDto]] GetCampaignById(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:15:58.165 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-05 21:15:58.160 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:58.171 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:58.172 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:15:58.174 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 11.5884ms
2025-07-05 21:15:58.177 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:15:58.177 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/tags - null null
2025-07-05 21:15:58.189 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 21:15:58.192 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=1000
2025-07-05 21:15:58.195 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:15:58.196 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 57.0671ms
2025-07-05 21:15:58.201 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 21:15:58.200 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:15:58.208 +05:30 [INF] Route matched with {action = "GetAllTags", controller = "Tags"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTags() on controller xbytechat.api.CRM.Controllers.TagsController (xbytechat.api).
2025-07-05 21:15:58.214 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='100', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:15:58.222 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:58.228 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 36.8126ms
2025-07-05 21:15:58.231 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:15:58.233 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts?tab=all&page=1&pageSize=1000 - 200 null application/json; charset=utf-8 76.8295ms
2025-07-05 21:15:58.419 +05:30 [INF] Executed DbCommand (26ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t."Id0", t."BusinessId0", t."ButtonText", t."ButtonType", t."CreatedAt0", t."Description", t."IsActive", t."TargetUrl", t."Title", t."UpdatedAt0", c1."Id", c1."CampaignId", c1."IsFromTemplate", c1."Position", c1."Title", c1."Type", c1."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt", c0."Id" AS "Id0", c0."BusinessId" AS "BusinessId0", c0."ButtonText", c0."ButtonType", c0."CreatedAt" AS "CreatedAt0", c0."Description", c0."IsActive", c0."TargetUrl", c0."Title", c0."UpdatedAt" AS "UpdatedAt0"
    FROM "Campaigns" AS c
    LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignButtons" AS c1 ON t."Id" = c1."CampaignId"
ORDER BY t."Id", t."Id0"
2025-07-05 21:15:58.429 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignModule.DTOs.CampaignDto'.
2025-07-05 21:15:58.435 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api) in 267.9045ms
2025-07-05 21:15:58.438 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetCampaignById (xbytechat.api)'
2025-07-05 21:15:58.439 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - 200 null application/json; charset=utf-8 300.1508ms
2025-07-05 21:15:58.504 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name", t."ColorHex", t."Category", t."Notes", t."IsSystemTag", t."IsActive", t."CreatedAt", t."LastUsedAt"
FROM "Tags" AS t
WHERE t."BusinessId" = @__businessId_0 AND t."IsActive"
ORDER BY t."CreatedAt" DESC
2025-07-05 21:15:58.508 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:15:58.511 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api) in 294.6612ms
2025-07-05 21:15:58.513 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.TagsController.GetAllTags (xbytechat.api)'
2025-07-05 21:15:58.514 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/tags - 200 null application/json; charset=utf-8 337.4187ms
2025-07-05 21:16:06.032 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - null null
2025-07-05 21:16:06.036 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:06.037 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - 204 null null 4.8685ms
2025-07-05 21:16:06.039 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - application/json 94
2025-07-05 21:16:06.045 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:06.047 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-05 21:16:06.054 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:16:07.967 +05:30 [INF] Executed DbCommand (24ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-05 21:16:08.020 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='078b252e-5520-41c8-b476-1e3211f325f1', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p4=NULL, @p5=NULL, @p6='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-05T15:46:07.9739114Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-05T15:46:07.9739771Z' (DbType = DateTime), @p13='4a3f92fa-0ac6-4834-b2c7-20facdeecd18', @p14=NULL, @p15='c13be597-6ae2-42bb-9d43-925815f24ff8', @p16='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p17=NULL, @p18=NULL, @p19='8aac7c57-6699-4511-897b-4121b407eb1c', @p20='False', @p21=NULL, @p22=NULL, @p23='2025-07-05T15:46:08.0052196Z' (Nullable = true) (DbType = DateTime), @p24='Pending' (Nullable = false), @p25='2025-07-05T15:46:08.0052201Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:16:08.025 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:08.027 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 1970.8441ms
2025-07-05 21:16:08.028 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-05 21:16:08.030 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - 200 null application/json; charset=utf-8 1990.6831ms
2025-07-05 21:16:16.543 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - null null
2025-07-05 21:16:16.547 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:16.547 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - 204 null null 4.6321ms
2025-07-05 21:16:16.549 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - application/json 94
2025-07-05 21:16:16.554 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:16.555 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-05 21:16:16.557 +05:30 [INF] Route matched with {action = "AssignContactsToCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AssignContactsToCampaign(System.Guid, xbytechat.api.Features.CampaignModule.DTOs.AssignContactsDto) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:16:19.452 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @__businessId_1='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND c."BusinessId" = @__businessId_1
    LIMIT 1
) AS t
LEFT JOIN "CampaignRecipients" AS c0 ON t."Id" = c0."CampaignId"
ORDER BY t."Id"
2025-07-05 21:16:19.467 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='2e88a51e-c608-44c5-ac6e-a3af17295e96', @p1=NULL, @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p4=NULL, @p5=NULL, @p6='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p7='False', @p8=NULL, @p9=NULL, @p10='2025-07-05T15:46:19.4635676Z' (Nullable = true) (DbType = DateTime), @p11='Pending' (Nullable = false), @p12='2025-07-05T15:46:19.4635678Z' (DbType = DateTime), @p13='862f5843-4e3d-49d6-95cf-fbc9636fd805', @p14=NULL, @p15='c13be597-6ae2-42bb-9d43-925815f24ff8', @p16='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p17=NULL, @p18=NULL, @p19='8aac7c57-6699-4511-897b-4121b407eb1c', @p20='False', @p21=NULL, @p22=NULL, @p23='2025-07-05T15:46:19.4636616Z' (Nullable = true) (DbType = DateTime), @p24='Pending' (Nullable = false), @p25='2025-07-05T15:46:19.4636617Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
INSERT INTO "CampaignRecipients" ("Id", "BotId", "BusinessId", "CampaignId", "CategoryBrowsed", "ClickedCTA", "ContactId", "IsAutoTagged", "MessagePreview", "ProductBrowsed", "SentAt", "Status", "UpdatedAt")
VALUES (@p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:16:19.471 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:19.473 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api) in 2913.4137ms
2025-07-05 21:16:19.476 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.AssignContactsToCampaign (xbytechat.api)'
2025-07-05 21:16:19.477 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/assign-contacts - 200 null application/json; charset=utf-8 2927.8841ms
2025-07-05 21:16:26.079 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - null null
2025-07-05 21:16:26.091 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:26.093 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-05 21:16:26.101 +05:30 [INF] Route matched with {action = "GetAll", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll(System.String) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:16:26.141 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt", c."ImageUrl", c."ImageCaption", c0."Title" AS "CtaTitle", (
    SELECT count(*)::int
    FROM "CampaignRecipients" AS c1
    WHERE c."Id" = c1."CampaignId") AS "RecipientCount"
FROM "Campaigns" AS c
LEFT JOIN "CTADefinitions" AS c0 ON c."CtaId" = c0."Id"
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
2025-07-05 21:16:26.148 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:16:26.153 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api) in 47.4513ms
2025-07-05 21:16:26.155 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetAll (xbytechat.api)'
2025-07-05 21:16:26.156 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign/get-image-campaign - 200 null application/json; charset=utf-8 77.2037ms
2025-07-05 21:16:34.384 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - null 0
2025-07-05 21:16:34.389 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:34.390 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-05 21:16:34.395 +05:30 [INF] Route matched with {action = "SendTemplateCampaign", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateCampaign(System.Guid) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:16:37.284 +05:30 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-07-05 21:16:37.295 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CampaignId", t."CampaignType", t."CreatedAt", t."CreatedBy", t."CtaId", t."DeletedAt", t."DeletedBy", t."FollowUpTemplateId", t."ImageCaption", t."ImageUrl", t."IsDeleted", t."MessageBody", t."MessageTemplate", t."Name", t."ScheduledAt", t."SourceCampaignId", t."Status", t."TemplateId", t."TemplateParameters", t."UpdatedAt", t0."Id", t0."BotId", t0."BusinessId", t0."CampaignId", t0."CategoryBrowsed", t0."ClickedCTA", t0."ContactId", t0."IsAutoTagged", t0."MessagePreview", t0."ProductBrowsed", t0."SentAt", t0."Status", t0."UpdatedAt", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", c2."Id", c2."CampaignId", c2."IsFromTemplate", c2."Position", c2."Title", c2."Type", c2."Value"
FROM (
    SELECT c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
    FROM "Campaigns" AS c
    WHERE c."Id" = @__campaignId_0 AND NOT (c."IsDeleted")
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."BotId", c0."BusinessId", c0."CampaignId", c0."CategoryBrowsed", c0."ClickedCTA", c0."ContactId", c0."IsAutoTagged", c0."MessagePreview", c0."ProductBrowsed", c0."SentAt", c0."Status", c0."UpdatedAt", c1."Id" AS "Id0", c1."AssignedAgentId", c1."BusinessId" AS "BusinessId0", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
    FROM "CampaignRecipients" AS c0
    INNER JOIN "Contacts" AS c1 ON c0."ContactId" = c1."Id"
) AS t0 ON t."Id" = t0."CampaignId"
LEFT JOIN "CampaignButtons" AS c2 ON t."Id" = c2."CampaignId"
ORDER BY t."Id", t0."Id", t0."Id0"
2025-07-05 21:16:37.305 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive" AND w."BusinessId" = @__businessId_0
LIMIT 1
2025-07-05 21:16:37.309 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:16:37.310 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:16:37.950 +05:30 [INF] Received HTTP response headers after 637.9555ms - 200
2025-07-05 21:16:37.952 +05:30 [INF] End processing HTTP request after 643.346ms - 200
2025-07-05 21:16:38.047 +05:30 [INF] 📨 Preparing to send to +918130891737
2025-07-05 21:16:38.052 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:38.054 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:38.823 +05:30 [INF] Received HTTP response headers after 767.1882ms - 400
2025-07-05 21:16:38.825 +05:30 [INF] End processing HTTP request after 772.7618ms - 400
2025-07-05 21:16:38.829 +05:30 [INF] 📬 Send result: {"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"ApyTUxgMFtWDFIxOLla7rrc\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}
2025-07-05 21:16:38.832 +05:30 [INF] ✅ Added MessageLog for +918130891737
2025-07-05 21:16:38.898 +05:30 [INF] 📘 Added CampaignSendLog for recipient "078b252e-5520-41c8-b476-1e3211f325f1"
2025-07-05 21:16:38.900 +05:30 [INF] 📨 Preparing to send to +918130891737
2025-07-05 21:16:38.901 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:38.903 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:40.561 +05:30 [INF] Received HTTP response headers after 1657.2661ms - 200
2025-07-05 21:16:40.563 +05:30 [INF] End processing HTTP request after 1661.8568ms - 200
2025-07-05 21:16:40.565 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-05 21:16:40.567 +05:30 [INF] ✅ Added MessageLog for +918130891737
2025-07-05 21:16:40.568 +05:30 [INF] 📘 Added CampaignSendLog for recipient "2e88a51e-c608-44c5-ac6e-a3af17295e96"
2025-07-05 21:16:40.569 +05:30 [INF] 📨 Preparing to send to +917082156227
2025-07-05 21:16:40.571 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:40.572 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:41.715 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:16:41.720 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 21:16:41.722 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:41.726 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:41.727 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:41.728 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:41.732 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"sent","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","expiration_timestamp":"1751730400","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.734 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"read","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.736 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:41.736 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"sent","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","expiration_timestamp":"1751730400","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.737 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:41.738 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:41.740 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:41.741 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:41.743 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 11.4616ms
2025-07-05 21:16:41.744 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"sent","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","expiration_timestamp":"1751730400","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.745 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 11.2498ms
2025-07-05 21:16:41.748 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:41.753 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:41.753 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:41.754 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 38.6201ms
2025-07-05 21:16:41.755 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 35.5501ms
2025-07-05 21:16:41.758 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==
2025-07-05 21:16:41.768 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==
2025-07-05 21:16:41.770 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"read","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.772 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:41.773 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","status":"read","timestamp":"1751730400","recipient_id":"918130891737","conversation":{"id":"44e0ba9ea79dff0e5c2a6a84e866f835","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:41.779 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:41.781 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==
2025-07-05 21:16:41.782 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==
2025-07-05 21:16:41.791 +05:30 [INF] Received HTTP response headers after 1217.8856ms - 200
2025-07-05 21:16:41.793 +05:30 [INF] End processing HTTP request after 1222.621ms - 200
2025-07-05 21:16:41.796 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-05 21:16:41.798 +05:30 [INF] ✅ Added MessageLog for +917082156227
2025-07-05 21:16:41.799 +05:30 [INF] 📘 Added CampaignSendLog for recipient "4a3f92fa-0ac6-4834-b2c7-20facdeecd18"
2025-07-05 21:16:41.800 +05:30 [INF] 📨 Preparing to send to +917082156227
2025-07-05 21:16:41.801 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:41.803 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:16:43.844 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:16:43.844 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:16:43.848 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:43.850 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:43.851 +05:30 [INF] Received HTTP response headers after 2046.6675ms - 200
2025-07-05 21:16:43.851 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:43.853 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:43.854 +05:30 [INF] End processing HTTP request after 2052.4837ms - 200
2025-07-05 21:16:43.856 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"delivered","timestamp":"1751730402","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.858 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"sent","timestamp":"1751730401","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","expiration_timestamp":"1751730401","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.861 +05:30 [INF] 📬 Send result: {"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","LogId":null,"Token":null,"RefreshToken":null}
2025-07-05 21:16:43.862 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:43.863 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"delivered","timestamp":"1751730402","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.864 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:43.866 +05:30 [INF] ✅ Added MessageLog for +917082156227
2025-07-05 21:16:43.867 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:43.869 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:43.873 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"delivered","timestamp":"1751730402","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.871 +05:30 [INF] 📘 Added CampaignSendLog for recipient "862f5843-4e3d-49d6-95cf-fbc9636fd805"
2025-07-05 21:16:43.872 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 16.1895ms
2025-07-05 21:16:43.876 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:43.870 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:43.878 +05:30 [INF] 💾 Saving all DB changes...
2025-07-05 21:16:43.878 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:43.880 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==
2025-07-05 21:16:43.882 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 23.8384ms
2025-07-05 21:16:43.885 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 40.9033ms
2025-07-05 21:16:43.886 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==
2025-07-05 21:16:43.887 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:43.892 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"sent","timestamp":"1751730401","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","expiration_timestamp":"1751730401","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.893 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 48.7028ms
2025-07-05 21:16:43.895 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:43.900 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","status":"sent","timestamp":"1751730401","recipient_id":"917082156227","conversation":{"id":"e90fc2095a9a2b629e1b394e4e33a057","expiration_timestamp":"1751730401","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:43.903 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:43.906 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==
2025-07-05 21:16:43.907 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==
2025-07-05 21:16:43.939 +05:30 [INF] Executed DbCommand (31ms) [Parameters=[@p0='599568ea-f767-4f1f-bed6-d07b3ec85c99', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0' (Nullable = true), @p5='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p6='2025-07-05T15:46:41.7978323Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='hello_world' (Nullable = false), @p11='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==', @p12='{"messaging_product":"whatsapp","contacts":[{"input":"+917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==","message_status":"accepted"}]}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:46:41.7978326Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false), @p19='72613f40-e36a-4945-9a10-4c4f5b3f61ee', @p20='c13be597-6ae2-42bb-9d43-925815f24ff8', @p21=NULL (DbType = Guid), @p22=NULL (DbType = Guid), @p23='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0' (Nullable = true), @p24='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p25='2025-07-05T15:46:40.5671637Z' (DbType = DateTime), @p26=NULL, @p27='False', @p28=NULL, @p29='hello_world' (Nullable = false), @p30='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==', @p31='{"messaging_product":"whatsapp","contacts":[{"input":"+918130891737","wa_id":"918130891737"}],"messages":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==","message_status":"accepted"}]}', @p32='+918130891737' (Nullable = false), @p33=NULL (DbType = Guid), @p34=NULL, @p35='2025-07-05T15:46:40.5671639Z' (Nullable = true) (DbType = DateTime), @p36=NULL, @p37='Sent' (Nullable = false), @p38='8321cbc1-d80d-4476-b882-275e154d662a', @p39='c13be597-6ae2-42bb-9d43-925815f24ff8', @p40=NULL (DbType = Guid), @p41=NULL (DbType = Guid), @p42='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0' (Nullable = true), @p43='8aac7c57-6699-4511-897b-4121b407eb1c' (Nullable = true), @p44='2025-07-05T15:46:43.8658051Z' (DbType = DateTime), @p45=NULL, @p46='False', @p47=NULL, @p48='hello_world' (Nullable = false), @p49='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==', @p50='{"messaging_product":"whatsapp","contacts":[{"input":"+917082156227","wa_id":"917082156227"}],"messages":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","message_status":"accepted"}]}', @p51='+917082156227' (Nullable = false), @p52=NULL (DbType = Guid), @p53=NULL, @p54='2025-07-05T15:46:43.8658054Z' (Nullable = true) (DbType = DateTime), @p55=NULL, @p56='Sent' (Nullable = false), @p57='d004cadf-87b0-4be0-9717-69dd5ec2fa1f', @p58='c13be597-6ae2-42bb-9d43-925815f24ff8', @p59=NULL (DbType = Guid), @p60=NULL (DbType = Guid), @p61='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0' (Nullable = true), @p62='63faf7a5-4506-431d-884c-cb0a363fa7ac' (Nullable = true), @p63='2025-07-05T15:46:38.8311205Z' (DbType = DateTime), @p64='API returned error', @p65='False', @p66=NULL, @p67='hello_world' (Nullable = false), @p68=NULL, @p69='{"error":{"message":"(#10) Application does not have permission for this action","type":"OAuthException","code":10,"error_data":{"messaging_product":"whatsapp","details":"There was a problem with the access token or permissions you are using for the API call."},"fbtrace_id":"ApyTUxgMFtWDFIxOLla7rrc"}}', @p70='+918130891737' (Nullable = false), @p71=NULL (DbType = Guid), @p72=NULL, @p73=NULL (DbType = DateTime), @p74=NULL, @p75='Failed' (Nullable = false), @p76='001b62a7-ddca-4c4d-a932-5308361bc4cb', @p77='True', @p78=NULL, @p79='00000000-0000-0000-0000-000000000000', @p80='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p81=NULL, @p82=NULL, @p83=NULL (DbType = DateTime), @p84='8aac7c57-6699-4511-897b-4121b407eb1c', @p85=NULL, @p86='2025-07-05T15:46:43.8709405Z' (DbType = DateTime), @p87='system', @p88=NULL (DbType = DateTime), @p89=NULL, @p90=NULL, @p91=NULL, @p92=NULL, @p93='False', @p94=NULL (DbType = DateTime), @p95=NULL, @p96=NULL, @p97='Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.' (Nullable = false), @p98='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==', @p99='8321cbc1-d80d-4476-b882-275e154d662a' (Nullable = true), @p100=NULL (DbType = DateTime), @p101='862f5843-4e3d-49d6-95cf-fbc9636fd805', @p102='0', @p103='Sent', @p104='2025-07-05T15:46:43.8709407Z' (Nullable = true) (DbType = DateTime), @p105=NULL, @p106='hello_world', @p107=NULL (DbType = Guid), @p108='23d34faa-eb4f-43de-a969-b62f0b54a817', @p109='True', @p110=NULL, @p111='00000000-0000-0000-0000-000000000000', @p112='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p113=NULL, @p114=NULL, @p115=NULL (DbType = DateTime), @p116='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p117=NULL, @p118='2025-07-05T15:46:40.5685199Z' (DbType = DateTime), @p119='system', @p120=NULL (DbType = DateTime), @p121=NULL, @p122=NULL, @p123=NULL, @p124=NULL, @p125='False', @p126=NULL (DbType = DateTime), @p127=NULL, @p128=NULL, @p129='Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.' (Nullable = false), @p130='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMzgzMkZCNDYxNDczNTgzNzNCAA==', @p131='72613f40-e36a-4945-9a10-4c4f5b3f61ee' (Nullable = true), @p132=NULL (DbType = DateTime), @p133='2e88a51e-c608-44c5-ac6e-a3af17295e96', @p134='0', @p135='Sent', @p136='2025-07-05T15:46:40.5685199Z' (Nullable = true) (DbType = DateTime), @p137=NULL, @p138='hello_world', @p139=NULL (DbType = Guid), @p140='5ae28e5e-3a5f-4b37-a655-355e60a8082a', @p141='True', @p142=NULL, @p143='00000000-0000-0000-0000-000000000000', @p144='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p145=NULL, @p146=NULL, @p147=NULL (DbType = DateTime), @p148='63faf7a5-4506-431d-884c-cb0a363fa7ac', @p149=NULL, @p150='2025-07-05T15:46:38.8349078Z' (DbType = DateTime), @p151='system', @p152=NULL (DbType = DateTime), @p153=NULL, @p154=NULL, @p155=NULL, @p156=NULL, @p157='False', @p158=NULL (DbType = DateTime), @p159=NULL, @p160=NULL, @p161='Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.' (Nullable = false), @p162=NULL, @p163='d004cadf-87b0-4be0-9717-69dd5ec2fa1f' (Nullable = true), @p164=NULL (DbType = DateTime), @p165='078b252e-5520-41c8-b476-1e3211f325f1', @p166='0', @p167='Failed', @p168='2025-07-05T15:46:38.8349991Z' (Nullable = true) (DbType = DateTime), @p169=NULL, @p170='hello_world', @p171=NULL (DbType = Guid), @p172='bae1956d-cfae-4a7d-8323-4c527d2284ee', @p173='True', @p174=NULL, @p175='00000000-0000-0000-0000-000000000000', @p176='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0', @p177=NULL, @p178=NULL, @p179=NULL (DbType = DateTime), @p180='8aac7c57-6699-4511-897b-4121b407eb1c', @p181=NULL, @p182='2025-07-05T15:46:41.7992250Z' (DbType = DateTime), @p183='system', @p184=NULL (DbType = DateTime), @p185=NULL, @p186=NULL, @p187=NULL, @p188=NULL, @p189='False', @p190=NULL (DbType = DateTime), @p191=NULL, @p192=NULL, @p193='Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us.' (Nullable = false), @p194='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSMEQxRTREN0Y5Q0VBQTI1QTdGAA==', @p195='599568ea-f767-4f1f-bed6-d07b3ec85c99' (Nullable = true), @p196=NULL (DbType = DateTime), @p197='4a3f92fa-0ac6-4834-b2c7-20facdeecd18', @p198='0', @p199='Sent', @p200='2025-07-05T15:46:41.7992251Z' (Nullable = true) (DbType = DateTime), @p201=NULL, @p202='hello_world', @p203=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, @p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64, @p65, @p66, @p67, @p68, @p69, @p70, @p71, @p72, @p73, @p74, @p75);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p76, @p77, @p78, @p79, @p80, @p81, @p82, @p83, @p84, @p85, @p86, @p87, @p88, @p89, @p90, @p91, @p92, @p93, @p94, @p95, @p96, @p97, @p98, @p99, @p100, @p101, @p102, @p103, @p104, @p105, @p106, @p107);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p108, @p109, @p110, @p111, @p112, @p113, @p114, @p115, @p116, @p117, @p118, @p119, @p120, @p121, @p122, @p123, @p124, @p125, @p126, @p127, @p128, @p129, @p130, @p131, @p132, @p133, @p134, @p135, @p136, @p137, @p138, @p139);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p140, @p141, @p142, @p143, @p144, @p145, @p146, @p147, @p148, @p149, @p150, @p151, @p152, @p153, @p154, @p155, @p156, @p157, @p158, @p159, @p160, @p161, @p162, @p163, @p164, @p165, @p166, @p167, @p168, @p169, @p170, @p171);
INSERT INTO "CampaignSendLogs" ("Id", "AllowRetry", "Browser", "BusinessId", "CampaignId", "City", "ClickType", "ClickedAt", "ContactId", "Country", "CreatedAt", "CreatedBy", "DeliveredAt", "DeviceInfo", "DeviceType", "ErrorMessage", "IpAddress", "IsClicked", "LastRetryAt", "LastRetryStatus", "MacAddress", "MessageBody", "MessageId", "MessageLogId", "ReadAt", "RecipientId", "RetryCount", "SendStatus", "SentAt", "SourceChannel", "TemplateId", "UserId")
VALUES (@p172, @p173, @p174, @p175, @p176, @p177, @p178, @p179, @p180, @p181, @p182, @p183, @p184, @p185, @p186, @p187, @p188, @p189, @p190, @p191, @p192, @p193, @p194, @p195, @p196, @p197, @p198, @p199, @p200, @p201, @p202, @p203);
2025-07-05 21:16:43.948 +05:30 [INF] ✅ All saved successfully.
2025-07-05 21:16:43.950 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:16:43.951 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api) in 9550.7701ms
2025-07-05 21:16:43.953 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.SendTemplateCampaign (xbytechat.api)'
2025-07-05 21:16:43.954 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/campaign/send-campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - 200 null application/json; charset=utf-8 9569.59ms
2025-07-05 21:16:43.996 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:16:44.000 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:44.001 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:44.003 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"sent","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","expiration_timestamp":"1751730403","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.005 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:44.005 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"sent","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","expiration_timestamp":"1751730403","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.007 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:44.008 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:44.010 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.7376ms
2025-07-05 21:16:44.011 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"sent","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","expiration_timestamp":"1751730403","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.012 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:44.016 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:44.016 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.1366ms
2025-07-05 21:16:44.029 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__logId_Value_0='001b62a7-ddca-4c4d-a932-5308361bc4cb'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-05 21:16:44.032 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA== → sent
2025-07-05 21:16:44.469 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 582
2025-07-05 21:16:44.474 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:44.475 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:16:44.479 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"delivered","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.481 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:16:44.481 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"delivered","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.482 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:44.483 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:16:44.485 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.7369ms
2025-07-05 21:16:44.486 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA==","status":"delivered","timestamp":"1751730403","recipient_id":"917082156227","conversation":{"id":"bab1d2ded8eb5bef0cca64e402f2bc37","origin":{"type":"utility"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"utility","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:16:44.488 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:16:44.494 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:16:44.495 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.6287ms
2025-07-05 21:16:44.499 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__logId_Value_0='001b62a7-ddca-4c4d-a932-5308361bc4cb'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."Id" = @__logId_Value_0
LIMIT 1
2025-07-05 21:16:44.527 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p2='001b62a7-ddca-4c4d-a932-5308361bc4cb', @p0='2025-07-05T15:46:43.0000000Z' (Nullable = true) (DbType = DateTime), @p1='Delivered'], CommandType='"Text"', CommandTimeout='30']
UPDATE "CampaignSendLogs" SET "DeliveredAt" = @p0, "SendStatus" = @p1
WHERE "Id" = @p2;
2025-07-05 21:16:44.531 +05:30 [INF] ✅ CampaignSendLog updated for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkVDMTY1OEU1REYwMzdCODY5AA== → delivered
2025-07-05 21:16:56.494 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 21:16:56.496 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:16:56.513 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:56.515 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:16:56.516 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:16:56.517 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:16:56.518 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:16:56.519 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:16:56.522 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 21:16:56.533 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:16:56.534 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:16:56.542 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:16:56.548 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:16:56.548 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:16:56.556 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:16:56.558 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 36.7241ms
2025-07-05 21:16:56.560 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:16:56.561 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 67.0575ms
2025-07-05 21:16:57.513 +05:30 [INF] Received HTTP response headers after 962.9646ms - 200
2025-07-05 21:16:57.515 +05:30 [INF] End processing HTTP request after 973.8283ms - 200
2025-07-05 21:16:57.975 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=Wu5pMjZJOgIrdqpPFee9hQ&oh=01_Q5Aa1wHx8AdgDP61K5g3V_KxcLKey6NDqvNKXf2U2VIz5O_aNA&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=Wu5pMjZJOgIrdqpPFee9hQ&oh=01_Q5Aa1wEyiq079PJAh-44xLnZc-v1ptDca7Udg4dbK0hfqMT88Q&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:16:57.979 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:16:57.981 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1457.5047ms
2025-07-05 21:16:57.983 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:16:57.985 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1489.1091ms
2025-07-05 21:17:10.632 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - null null
2025-07-05 21:17:10.636 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:17:10.637 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-image-template - 204 null null 5.4712ms
2025-07-05 21:17:10.639 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:17:10.644 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:17:10.645 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:17:10.646 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:17:13.763 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:17:13.767 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:17:14.620 +05:30 [INF] Received HTTP response headers after 850.7071ms - 200
2025-07-05 21:17:14.621 +05:30 [INF] End processing HTTP request after 857.9189ms - 200
2025-07-05 21:17:14.646 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='5c1b3425-c8d2-4a18-9718-b1be6d418b6b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:47:14.6244010Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:47:14.6244011Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:17:14.651 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:14.653 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 4004.7175ms
2025-07-05 21:17:14.655 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:17:14.656 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 4016.855ms
2025-07-05 21:17:14.661 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - application/json 316
2025-07-05 21:17:14.665 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:17:14.666 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:17:14.668 +05:30 [INF] Route matched with {action = "SendImageTemplateMessage", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendImageTemplateMessage(ImageTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:17:16.586 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:17:16.587 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:17:17.837 +05:30 [INF] Received HTTP response headers after 1246.6801ms - 200
2025-07-05 21:17:17.839 +05:30 [INF] End processing HTTP request after 1253.381ms - 200
2025-07-05 21:17:17.845 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='10e9a144-4d8e-4bcb-8544-3a919ea9e9bc', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:47:17.8422622Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9='https://picsum.photos/200/300', @p10='imagecampaign' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:47:17.8422623Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:17:17.848 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType48`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:17.850 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api) in 3179.9597ms
2025-07-05 21:17:17.852 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendImageTemplateMessage (xbytechat.api)'
2025-07-05 21:17:17.853 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-image-template - 200 null application/json; charset=utf-8 3192.8998ms
2025-07-05 21:17:23.423 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:17:23.423 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-05 21:17:23.427 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:23.430 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:23.431 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:17:23.433 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:17:23.436 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"sent","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","expiration_timestamp":"1751730442","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.438 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"read","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.441 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:17:23.441 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"sent","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","expiration_timestamp":"1751730442","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.443 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:17:23.444 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:23.446 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:17:23.447 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:23.449 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 13.1428ms
2025-07-05 21:17:23.451 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"sent","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","expiration_timestamp":"1751730442","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.453 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 14.6351ms
2025-07-05 21:17:23.455 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:23.459 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:17:23.460 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:23.461 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 38.4094ms
2025-07-05 21:17:23.465 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==
2025-07-05 21:17:23.466 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 43.0929ms
2025-07-05 21:17:23.472 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==
2025-07-05 21:17:23.478 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"read","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.481 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:17:23.483 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==","status":"read","timestamp":"1751730442","recipient_id":"918130891737","conversation":{"id":"1c6ef90c6d718537b4a695ac4d6af625","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:23.487 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:17:23.490 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==
2025-07-05 21:17:23.492 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzAyRjQ0MjY5RkQ0NDlFMEE3AA==
2025-07-05 21:17:26.056 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:17:26.060 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:26.061 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:17:26.064 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"sent","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","expiration_timestamp":"1751730445","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.066 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:17:26.066 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"sent","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","expiration_timestamp":"1751730445","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.067 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:26.069 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:17:26.072 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"sent","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","expiration_timestamp":"1751730445","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.072 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.9617ms
2025-07-05 21:17:26.077 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:17:26.078 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:26.081 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==
2025-07-05 21:17:26.082 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 26.6046ms
2025-07-05 21:17:26.084 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==
2025-07-05 21:17:26.728 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-05 21:17:26.732 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:26.734 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:17:26.737 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"delivered","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.739 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:17:26.739 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"delivered","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.740 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:17:26.742 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:17:26.744 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.8385ms
2025-07-05 21:17:26.745 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==","status":"delivered","timestamp":"1751730445","recipient_id":"917082156227","conversation":{"id":"06d37f46cacccbed1e58f5b88d8a35fb","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:17:26.747 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:17:26.750 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:17:26.751 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.8978ms
2025-07-05 21:17:26.754 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==
2025-07-05 21:17:26.759 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQzJDNzVBQjFFQTYxQTc2QzM2AA==
2025-07-05 21:20:21.038 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:20:21.049 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:20:21.051 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:20:21.052 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:20:21.058 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:20:21.062 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:20:21.064 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:20:22.208 +05:30 [INF] Received HTTP response headers after 1142.6365ms - 200
2025-07-05 21:20:22.210 +05:30 [INF] End processing HTTP request after 1147.6065ms - 200
2025-07-05 21:20:22.211 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=mqQU4a7YoePhREjJ9VRMgA&oh=01_Q5Aa1wEcdoFCZb2mBnaDB7QFQXOUyqhlLGD6vx-y1EeQSwt47Q&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=mqQU4a7YoePhREjJ9VRMgA&oh=01_Q5Aa1wEDLdKpqD1TShnPmqtwIimlrMuTf09c7-A-enBgMrTguA&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:20:22.215 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:20:22.218 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1163.4151ms
2025-07-05 21:20:22.220 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:20:22.221 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1183.8458ms
2025-07-05 21:20:57.675 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:20:57.678 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:20:57.679 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:20:57.680 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:20:57.684 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:20:57.693 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:20:57.695 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:20:58.525 +05:30 [INF] Received HTTP response headers after 829.1952ms - 200
2025-07-05 21:20:58.528 +05:30 [INF] End processing HTTP request after 834.8835ms - 200
2025-07-05 21:20:58.545 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3gK5Qiesg9gXOP2iFhYc1Q&oh=01_Q5Aa1wF35YgF05pLOMbTCcf7aNaZUjmPs8kRz_gOP60vAANQrg&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=3gK5Qiesg9gXOP2iFhYc1Q&oh=01_Q5Aa1wH9i8mlD5e5V1iU1BUHVoPaTpTbVl-UFde2VD_7NsOA0w&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:20:58.548 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:20:58.549 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 868.3057ms
2025-07-05 21:20:58.551 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:20:58.552 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 876.9091ms
2025-07-05 21:21:23.812 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:21:23.814 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:21:23.817 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:21:23.818 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:21:23.821 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:21:23.824 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:21:23.825 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:21:24.571 +05:30 [INF] Received HTTP response headers after 745.038ms - 200
2025-07-05 21:21:24.574 +05:30 [INF] End processing HTTP request after 749.1591ms - 200
2025-07-05 21:21:24.590 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=I7nujWefUcLRRK5vHZ-ipQ&oh=01_Q5Aa1wGSYSc5wEKURj2jLLgqOsXYVccK9r_cDSpsW1BTHRtJXg&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=I7nujWefUcLRRK5vHZ-ipQ&oh=01_Q5Aa1wHv7t2-7jCxRSMkutx3XPLd5ryooQfW6JEo2ueeXYEEPQ&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:21:24.593 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:21:24.595 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 775.3067ms
2025-07-05 21:21:24.596 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:21:24.598 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 786.3448ms
2025-07-05 21:22:16.789 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:22:16.794 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:22:16.795 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:22:16.796 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:22:16.966 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:22:16.969 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:22:16.971 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:22:17.824 +05:30 [INF] Received HTTP response headers after 851.9568ms - 200
2025-07-05 21:22:17.825 +05:30 [INF] End processing HTTP request after 855.7822ms - 200
2025-07-05 21:22:17.837 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=ab2z1yHAMgt0_6KDgf0QQQ&oh=01_Q5Aa1wHckbKIp0uh4DALBXuEGSrZmhGV_Yuc0ZrFGYM9QzUukQ&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=ab2z1yHAMgt0_6KDgf0QQQ&oh=01_Q5Aa1wGrgMM2VMLbsrs3gADFWTLnXAfyYkbMQoK8bkLdmlMB5w&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:22:17.840 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:22:17.842 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 1044.2537ms
2025-07-05 21:22:17.844 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:22:17.845 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 1056.0367ms
2025-07-05 21:22:52.988 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:22:52.992 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:22:52.992 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:22:52.994 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:22:52.998 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:22:53.001 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:22:53.002 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:22:55.192 +05:30 [INF] Received HTTP response headers after 2187.5217ms - 200
2025-07-05 21:22:55.194 +05:30 [INF] End processing HTTP request after 2193.747ms - 200
2025-07-05 21:22:55.196 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=MzNGKk1VsWnxehNFW5E9QA&oh=01_Q5Aa1wE04z7vi0zUul6h9Xz5DxhxQpfk5qzyu_VBvL9I1UIiXQ&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=MzNGKk1VsWnxehNFW5E9QA&oh=01_Q5Aa1wF8D1siCyz7y_WpJ7MqcAU45udM5banJTN_HDGdeRpQ5A&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:22:55.199 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:22:55.202 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 2206.0546ms
2025-07-05 21:22:55.203 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:22:55.204 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 2216.8776ms
2025-07-05 21:23:08.612 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - null null
2025-07-05 21:23:08.637 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:08.639 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-05 21:23:08.645 +05:30 [INF] Route matched with {action = "GetAllDraftFlows", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllDraftFlows() on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-05 21:23:08.663 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."FlowName", c."CreatedAt", c."IsPublished"
FROM "CTAFlowConfigs" AS c
WHERE c."BusinessId" = @__businessId_0 AND NOT (c."IsPublished") AND c."IsActive"
ORDER BY c."CreatedAt" DESC
2025-07-05 21:23:08.668 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAFlowBuilder.DTOs.VisualFlowSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:23:08.671 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api) in 23.6524ms
2025-07-05 21:23:08.674 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-05 21:23:08.676 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - 200 null application/json; charset=utf-8 64.0758ms
2025-07-05 21:23:10.251 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-published - null null
2025-07-05 21:23:10.257 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:10.258 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api)'
2025-07-05 21:23:10.264 +05:30 [INF] Route matched with {action = "GetPublishedFlows", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPublishedFlows() on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-05 21:23:10.277 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."FlowName", c."IsPublished", c."CreatedAt"
FROM "CTAFlowConfigs" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsPublished"
ORDER BY c."CreatedAt" DESC
2025-07-05 21:23:10.284 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAFlowBuilder.DTOs.VisualFlowSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:23:10.287 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api) in 17.6488ms
2025-07-05 21:23:10.289 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetPublishedFlows (xbytechat.api)'
2025-07-05 21:23:10.291 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-published - 200 null application/json; charset=utf-8 39.5337ms
2025-07-05 21:23:19.095 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - null null
2025-07-05 21:23:19.101 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:19.102 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-05 21:23:19.104 +05:30 [INF] Route matched with {action = "GetAllDraftFlows", controller = "CTAFlow"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllDraftFlows() on controller xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController (xbytechat.api).
2025-07-05 21:23:19.111 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."FlowName", c."CreatedAt", c."IsPublished"
FROM "CTAFlowConfigs" AS c
WHERE c."BusinessId" = @__businessId_0 AND NOT (c."IsPublished") AND c."IsActive"
ORDER BY c."CreatedAt" DESC
2025-07-05 21:23:19.121 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAFlowBuilder.DTOs.VisualFlowSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:23:19.124 +05:30 [INF] Executed action xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api) in 16.8326ms
2025-07-05 21:23:19.127 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAFlowBuilder.Controllers.CTAFlowController.GetAllDraftFlows (xbytechat.api)'
2025-07-05 21:23:19.128 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/cta-flow/all-draft - 200 null application/json; charset=utf-8 33.4251ms
2025-07-05 21:23:29.283 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:23:29.302 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:29.304 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:23:29.306 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:23:29.313 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:23:29.320 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:23:29.322 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:23:30.056 +05:30 [INF] Received HTTP response headers after 732.9189ms - 200
2025-07-05 21:23:30.059 +05:30 [INF] End processing HTTP request after 738.7898ms - 200
2025-07-05 21:23:30.061 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=EL_mwHCWu6mWwYZk-cGqIg&oh=01_Q5Aa1wFLuNeYTScKZRlwUyA8bypCGtEzgKJfe3py16uQDvswKQ&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=EL_mwHCWu6mWwYZk-cGqIg&oh=01_Q5Aa1wER71As9aBzYXioUx0m422rZj8sxX6sbZ35oYngQo2_Mg&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:23:30.066 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:30.068 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 759.6819ms
2025-07-05 21:23:30.071 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:23:30.073 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 789.7556ms
2025-07-05 21:23:39.758 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts - null null
2025-07-05 21:23:39.763 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - null null
2025-07-05 21:23:39.768 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:39.771 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:39.772 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:23:39.773 +05:30 [INF] Executing endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:23:39.775 +05:30 [INF] Route matched with {action = "GetAllContacts", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContacts(System.String, Int32, Int32) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:23:39.776 +05:30 [INF] Route matched with {action = "GetAllTemplates", controller = "WhatsAppTemplateFetcher"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllTemplatesAsync() on controller xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController (xbytechat.api).
2025-07-05 21:23:39.779 +05:30 [INF] GetPagedContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all, page=1, pageSize=25
2025-07-05 21:23:39.783 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "WhatsAppSettings" AS w
WHERE w."IsActive"
2025-07-05 21:23:39.791 +05:30 [INF] Start processing HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:23:39.793 +05:30 [INF] Sending HTTP request GET https://graph.facebook.com/v22.0/999432368375320/message_templates
2025-07-05 21:23:39.976 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
2025-07-05 21:23:39.985 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='25', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
    ORDER BY c."Name"
    LIMIT @__p_2 OFFSET @__p_1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Name", t."Id", t0."Id"
2025-07-05 21:23:39.989 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:23:39.991 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api) in 212.3211ms
2025-07-05 21:23:39.993 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContacts (xbytechat.api)'
2025-07-05 21:23:39.994 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts - 200 null application/json; charset=utf-8 235.2895ms
2025-07-05 21:23:40.573 +05:30 [INF] Received HTTP response headers after 778.431ms - 200
2025-07-05 21:23:40.576 +05:30 [INF] End processing HTTP request after 784.2608ms - 200
2025-07-05 21:23:40.577 +05:30 [INF] 📦 Meta Template API Raw JSON for "c13be597-6ae2-42bb-9d43-925815f24ff8":
{"data":[{"name":"imagecampaign","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"IMAGE","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/505192710_1239512614060917_4344497973514528434_n.png?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=lbxMZX35hdUQ7kNvwFpAH2k&_nc_oc=Adnef8G6pkm6wCVz60_b96zQnysYFrDu1BpC4KxdzNhPEXmYKJ0d34Up82dIKbqaAX0x5VueMjEu8SQAilHB0LKK&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=I3sXet6YYmNu4vqhgL7CrQ&oh=01_Q5Aa1wHcvPygKzVfUjBDqgVU4cLDLgsTRco8eVO6aBtE_EgUQw&oe=6890B763"]}},{"type":"BODY","text":"Hello,\nWe\u2019re excited to announce that we\u2019re launching some amazing new products at [Your Company Name]! \ud83d\ude80\n\nBe the first to check them out and grab special launch offers!\nIf you\u2019re interested, reply to this message or click here:"},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.myntra.com\/men-sweatshirts"},{"type":"PHONE_NUMBER","text":"Call Us","phone_number":"+918765436785"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1239512610727584"},{"name":"hello_world","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Hello World"},{"type":"BODY","text":"Welcome and congratulations!! This message demonstrates your ability to send a WhatsApp message notification from the Cloud API, hosted by Meta. Thank you for taking the time to test with us."},{"type":"FOOTER","text":"WhatsApp Business Platform sample message"}],"language":"en_US","status":"APPROVED","category":"UTILITY","id":"1726067301662421"},{"name":"pdftemplate","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"DOCUMENT","example":{"header_handle":["https:\/\/scontent.whatsapp.net\/v\/t61.29466-34\/508635433_1626741698015436_7649302186679608064_n.pdf?ccb=1-7&_nc_sid=8b1bef&_nc_ohc=gTIshCa1sfYQ7kNvwFdEQoH&_nc_oc=AdktIfOTjjd6FPZSpp5jmH47h-fvfh-IARrJB4tRkmUJwINnw8xDT5qHGQKzhjaKctFwm-6N6KV8sQSj1xzmjV96&_nc_zt=3&_nc_ht=scontent.whatsapp.net&edm=AH51TzQEAAAA&_nc_gid=I3sXet6YYmNu4vqhgL7CrQ&oh=01_Q5Aa1wHwdTwnuJQDSVTr3FPdaqSE64P6RFOrjTzfp2mSY1O8Ag&oe=6890D217"]}},{"type":"BODY","text":"Hello,\n\nThis is you pdf file."},{"type":"BUTTONS","buttons":[{"type":"URL","text":"Visit website","url":"https:\/\/www.zoho.com\/"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1626741691348770"},{"name":"flow_step_4","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -4"},{"type":"BODY","text":"Would you like pricing details for your selected product?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Send Pricing"},{"type":"QUICK_REPLY","text":"Back to Products"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"710642074690811"},{"name":"flow_step_3","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -3"},{"type":"BODY","text":"We have 3 amazing products for you. Want to check them out?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Products"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2154240945038413"},{"name":"flow_step_2","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -2"},{"type":"BODY","text":"Here's our latest deal. Want to see more options?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"More Options"},{"type":"PHONE_NUMBER","text":"Talk to Support","phone_number":"+917082156227"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","id":"721245346987995"},{"name":"flow_step_1","parameter_format":"POSITIONAL","components":[{"type":"BODY","text":"Hi \ud83d\udc4b, would you like to explore our special offer?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"720586043866779"},{"name":"flow_step_6","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -6"},{"type":"BODY","text":"Here's what our happy customers say. Would you like to read reviews?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Show Reviews"},{"type":"QUICK_REPLY","text":"Skip"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1919507328796848"},{"name":"flow_step_5","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step =5"},{"type":"BODY","text":"Limited time discount available. Want to grab it now?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Claim Discount"},{"type":"QUICK_REPLY","text":"Not Now"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1780686429496003"},{"name":"flow_step_7","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -7"},{"type":"BODY","text":"Would you like to talk to our support team for custom guidance?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Talk to Agent"},{"type":"QUICK_REPLY","text":"Later"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1390795521994729"},{"name":"back_to_restart","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Chat Restarted"},{"type":"BODY","text":"Your Process has restarted."},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Yes, show me"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"2174325859705396"},{"name":"flow_step_10_","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -10"},{"type":"BODY","text":"Thanks for your interest! Would you like to give feedback?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Give Feedback"},{"type":"QUICK_REPLY","text":"End Chat"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"700742109026088"},{"name":"flow_step_9","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -9"},{"type":"BODY","text":"This is your final offer summary. Ready to proceed?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Proceed"},{"type":"QUICK_REPLY","text":"Restart"}]}],"language":"en_US","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"703808575467306"},{"name":"flow_step_8","parameter_format":"POSITIONAL","components":[{"type":"HEADER","format":"TEXT","text":"Step -8"},{"type":"BODY","text":"We can compare 2 products for you. Shall we continue?"},{"type":"BUTTONS","buttons":[{"type":"QUICK_REPLY","text":"Compare Now"},{"type":"QUICK_REPLY","text":"No, thanks"}]}],"language":"en","status":"APPROVED","category":"MARKETING","sub_category":"CUSTOM","id":"1399963891041518"}],"paging":{"cursors":{"before":"MAZDZD","after":"MjQZD"}}}
2025-07-05 21:23:40.580 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType64`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[TemplateForUIResponseDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:40.582 +05:30 [INF] Executed action xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api) in 801.0021ms
2025-07-05 21:23:40.584 +05:30 [INF] Executed endpoint 'xbytechat_api.WhatsAppSettings.Controllers.WhatsAppTemplateFetcherController.GetAllTemplatesAsync (xbytechat.api)'
2025-07-05 21:23:40.586 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/WhatsAppTemplateFetcher/get-template-all - 200 null application/json; charset=utf-8 822.8891ms
2025-07-05 21:23:47.376 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - null null
2025-07-05 21:23:47.380 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:47.382 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/messageengine/send-template-simple - 204 null null 6.3375ms
2025-07-05 21:23:47.385 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 296
2025-07-05 21:23:47.395 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:47.396 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:23:47.398 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:23:47.406 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:23:47.410 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:23:47.411 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:23:49.059 +05:30 [INF] Received HTTP response headers after 1645.8352ms - 200
2025-07-05 21:23:49.060 +05:30 [INF] End processing HTTP request after 1650.5029ms - 200
2025-07-05 21:23:49.070 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='b268949b-1d07-41f5-b5ef-65accc2f2709', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:53:49.0637895Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_1' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:53:49.0637883Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:23:49.073 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:23:49.075 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 1674.8375ms
2025-07-05 21:23:49.077 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:23:49.078 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 1692.8531ms
2025-07-05 21:23:49.083 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - application/json 296
2025-07-05 21:23:49.086 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:23:49.087 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:23:49.089 +05:30 [INF] Route matched with {action = "SendTemplateMessageSimple", controller = "MessageEngine"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendTemplateMessageSimple(xbytechat.api.Features.MessagesEngine.DTOs.SimpleTemplateMessageDto) on controller xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController (xbytechat.api).
2025-07-05 21:23:49.092 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:23:49.094 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:23:49.783 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:23:49.788 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:49.789 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:23:49.791 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"sent","timestamp":"1751730828","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","expiration_timestamp":"1751730828","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:49.793 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:23:49.793 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"sent","timestamp":"1751730828","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","expiration_timestamp":"1751730828","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:49.794 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:49.796 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:23:49.797 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.4937ms
2025-07-05 21:23:49.799 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"sent","timestamp":"1751730828","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","expiration_timestamp":"1751730828","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:49.800 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:49.804 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 20.7253ms
2025-07-05 21:23:49.804 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:23:49.819 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==
2025-07-05 21:23:49.820 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==
2025-07-05 21:23:49.992 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-05 21:23:49.995 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:49.997 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:23:50.001 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"read","timestamp":"1751730829","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:50.003 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:23:50.003 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"read","timestamp":"1751730829","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:50.004 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:50.006 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:23:50.007 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.0808ms
2025-07-05 21:23:50.009 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==","status":"read","timestamp":"1751730829","recipient_id":"918130891737","conversation":{"id":"fa237de44cf877d873d3467f38520f3a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:50.011 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:50.019 +05:30 [INF] Executed DbCommand (7ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:23:50.020 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 27.5416ms
2025-07-05 21:23:50.021 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==
2025-07-05 21:23:50.027 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==
2025-07-05 21:23:50.195 +05:30 [INF] Received HTTP response headers after 1100.372ms - 200
2025-07-05 21:23:50.197 +05:30 [INF] End processing HTTP request after 1104.4268ms - 200
2025-07-05 21:23:50.203 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='b689c7b0-bfe1-4f32-a9a2-62bac2de8599', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:53:50.2002827Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_1' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+917082156227\",\"wa_id\":\"917082156227\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+917082156227' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:53:50.2002823Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:23:50.206 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:23:50.207 +05:30 [INF] Executed action xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api) in 1115.6065ms
2025-07-05 21:23:50.209 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.MessagesEngine.Controllers.MessageEngineController.SendTemplateMessageSimple (xbytechat.api)'
2025-07-05 21:23:50.211 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/messageengine/send-template-simple - 200 null application/json; charset=utf-8 1127.889ms
2025-07-05 21:23:51.268 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:23:51.272 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:51.273 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:23:51.276 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"sent","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","expiration_timestamp":"1751730830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.278 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:23:51.278 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"sent","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","expiration_timestamp":"1751730830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.279 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:51.280 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:23:51.284 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.6394ms
2025-07-05 21:23:51.285 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"sent","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","expiration_timestamp":"1751730830","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.287 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:51.290 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:23:51.291 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 22.8043ms
2025-07-05 21:23:51.294 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==
2025-07-05 21:23:51.301 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==
2025-07-05 21:23:51.697 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 571
2025-07-05 21:23:51.701 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:51.703 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:23:51.705 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"delivered","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.707 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:23:51.707 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"delivered","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.708 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:23:51.710 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:23:51.711 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.746ms
2025-07-05 21:23:51.713 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==","status":"delivered","timestamp":"1751730830","recipient_id":"917082156227","conversation":{"id":"f7d9b1e737c715109ab3b0b5f0551244","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:23:51.714 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:23:51.717 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 19.7613ms
2025-07-05 21:23:51.718 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:23:51.725 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==
2025-07-05 21:23:51.726 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE3MDgyMTU2MjI3FQIAERgSQkYxQ0Q5NUZCMUZCOUIzMTBDAA==
2025-07-05 21:24:24.036 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 629
2025-07-05 21:24:24.040 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:24.042 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:24.100 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRTM3OUU3NTg2MDBCRjE3MTAwMzQzRTA3RDg4OENEMUUA","timestamp":"1751730862","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-05 21:24:24.102 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:24.103 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRTM3OUU3NTg2MDBCRjE3MTAwMzQzRTA3RDg4OENEMUUA","timestamp":"1751730862","type":"button","button":{"payload":"Yes, show me","text":"Yes, show me"}}]},"field":"messages"}]}]}
2025-07-05 21:24:24.103 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:24.106 +05:30 [INF] 👉 Routing to Click Processor
2025-07-05 21:24:24.108 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 63.8993ms
2025-07-05 21:24:24.110 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:24.112 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 75.245ms
2025-07-05 21:24:24.113 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-05 21:24:24.116 +05:30 [INF] 🖱️ Button Click → From: 918130891737, ClickId: wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRTM3OUU3NTg2MDBCRjE3MTAwMzQzRTA3RDg4OENEMUUA, OrigMsgId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==, Text: Yes, show me
2025-07-05 21:24:24.138 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-05 21:24:24.158 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-05 21:24:24.161 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 21:24:25.909 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-05 21:24:25.992 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@p0='887fc770-5df0-4da6-a661-523c019d075d', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Yes, show me', @p4='Yes, show me', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-05T15:54:24.1638214Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='+918130891737', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRTMxM0UwMEFEODkwMUU0OTkxAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:24:25.995 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-05 21:24:26.017 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='yes, show me', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-05 21:24:26.063 +05:30 [INF] ✅ Fallback flow step matched: StepId = "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759", Flow = FirstFlow
2025-07-05 21:24:26.065 +05:30 [INF] 🔁 Matched CTA Step → "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759"
2025-07-05 21:24:26.069 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759" | TrackingLogId: "887fc770-5df0-4da6-a661-523c019d075d"
2025-07-05 21:24:26.094 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__trackingLogId_0='887fc770-5df0-4da6-a661-523c019d075d'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-05 21:24:26.118 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-05 21:24:26.123 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759", Template: flow_step_2
2025-07-05 21:24:26.126 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:26.127 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:27.280 +05:30 [INF] Received HTTP response headers after 1150.7424ms - 200
2025-07-05 21:24:27.282 +05:30 [INF] End processing HTTP request after 1156.5109ms - 200
2025-07-05 21:24:27.324 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='db437395-540b-4222-b01f-81746cd735e0', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:54:27.2854908Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_2' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:54:27.2854899Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:24:27.374 +05:30 [INF] Executed DbCommand (5ms) [Parameters=[@p0='44e5f1d0-0854-4174-9d37-b9eed796a4b7', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='+918130891737', @p3=NULL, @p4='2025-07-05T15:54:27.3314147Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='d6d6edb7-4b4b-4ed3-9f7e-8ed8124ce759', @p8='' (Nullable = false), @p9='True', @p10='flow_step_2', @p11='text_template', @p12='887fc770-5df0-4da6-a661-523c019d075d' (Nullable = true), @p13='Yes, show me'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-05 21:24:27.379 +05:30 [INF] ✅ Flow step executed → Template: flow_step_2 sent to +918130891737
2025-07-05 21:24:27.381 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-05 21:24:28.158 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-05 21:24:28.161 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:28.163 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:28.166 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"read","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.168 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:28.168 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"read","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.169 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:28.170 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:28.173 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.1529ms
2025-07-05 21:24:28.174 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"read","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.176 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:28.179 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.1169ms
2025-07-05 21:24:28.180 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:28.204 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==
2025-07-05 21:24:28.206 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==
2025-07-05 21:24:28.454 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:24:28.458 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:28.460 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:28.463 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"sent","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","expiration_timestamp":"1751730867","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.465 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:28.466 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"sent","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","expiration_timestamp":"1751730867","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.466 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:28.468 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:28.471 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==","status":"sent","timestamp":"1751730867","recipient_id":"918130891737","conversation":{"id":"92547944629fb619d8b5f13cd1b61dc5","expiration_timestamp":"1751730867","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:28.470 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.4165ms
2025-07-05 21:24:28.474 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:28.475 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:28.476 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.5912ms
2025-07-05 21:24:28.479 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==
2025-07-05 21:24:28.485 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==
2025-07-05 21:24:33.406 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 629
2025-07-05 21:24:33.410 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:33.412 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:33.415 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRjZCMTI3QkRGQzNGM0I1Mzg0NzE3RTE5Qjk3M0ZENEIA","timestamp":"1751730871","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-05 21:24:33.417 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:33.417 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRjZCMTI3QkRGQzNGM0I1Mzg0NzE3RTE5Qjk3M0ZENEIA","timestamp":"1751730871","type":"button","button":{"payload":"More Options","text":"More Options"}}]},"field":"messages"}]}]}
2025-07-05 21:24:33.418 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:33.420 +05:30 [INF] 👉 Routing to Click Processor
2025-07-05 21:24:33.422 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.3155ms
2025-07-05 21:24:33.424 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-05 21:24:33.425 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:33.426 +05:30 [INF] 🖱️ Button Click → From: 918130891737, ClickId: wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRjZCMTI3QkRGQzNGM0I1Mzg0NzE3RTE5Qjk3M0ZENEIA, OrigMsgId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==, Text: More Options
2025-07-05 21:24:33.427 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.019ms
2025-07-05 21:24:33.435 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-05 21:24:33.443 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==', @__originalMessageId_0_contains='%wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-05 21:24:33.447 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 21:24:34.251 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-05 21:24:34.275 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='343a227c-a3a9-4d9c-aeb8-55caf4e89a29', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='More Options', @p4='More Options', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-05T15:54:33.4487726Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='+918130891737', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSODU0NEI2NEM3QTk0RjZDRUNEAA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:24:34.278 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-05 21:24:34.283 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='more options', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-05 21:24:34.285 +05:30 [INF] ✅ Fallback flow step matched: StepId = "ff615e65-b3fa-4275-88a5-0703acb39e04", Flow = FirstFlow
2025-07-05 21:24:34.286 +05:30 [INF] 🔁 Matched CTA Step → "ff615e65-b3fa-4275-88a5-0703acb39e04"
2025-07-05 21:24:34.287 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "ff615e65-b3fa-4275-88a5-0703acb39e04" | TrackingLogId: "343a227c-a3a9-4d9c-aeb8-55caf4e89a29"
2025-07-05 21:24:34.292 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__trackingLogId_0='343a227c-a3a9-4d9c-aeb8-55caf4e89a29'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-05 21:24:34.298 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='ff615e65-b3fa-4275-88a5-0703acb39e04' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-05 21:24:34.301 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "ff615e65-b3fa-4275-88a5-0703acb39e04", Template: flow_step_3
2025-07-05 21:24:34.303 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:34.304 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:35.448 +05:30 [INF] Received HTTP response headers after 1142.3655ms - 200
2025-07-05 21:24:35.450 +05:30 [INF] End processing HTTP request after 1147.3822ms - 200
2025-07-05 21:24:35.475 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='8c999314-9cc5-42f7-b637-45fe1392ad2b', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:54:35.4538384Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_3' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:54:35.4538375Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:24:35.483 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='88744055-bce3-4620-85d5-bc7a3d08d5e9', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='+918130891737', @p3=NULL, @p4='2025-07-05T15:54:35.4802434Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='ff615e65-b3fa-4275-88a5-0703acb39e04', @p8='' (Nullable = false), @p9='True', @p10='flow_step_3', @p11='text_template', @p12='343a227c-a3a9-4d9c-aeb8-55caf4e89a29' (Nullable = true), @p13='More Options'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-05 21:24:35.486 +05:30 [INF] ✅ Flow step executed → Template: flow_step_3 sent to +918130891737
2025-07-05 21:24:35.487 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-05 21:24:36.255 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:24:36.259 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:36.260 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:36.264 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"sent","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","expiration_timestamp":"1751730875","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.266 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:36.266 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"sent","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","expiration_timestamp":"1751730875","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.267 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:36.269 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:36.270 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.7193ms
2025-07-05 21:24:36.272 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"sent","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","expiration_timestamp":"1751730875","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.273 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:36.276 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:36.276 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.7165ms
2025-07-05 21:24:36.280 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==
2025-07-05 21:24:36.285 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==
2025-07-05 21:24:36.781 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-05 21:24:36.785 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:36.787 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:36.790 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"read","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.792 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:36.792 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"read","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.793 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:36.796 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:36.798 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.8892ms
2025-07-05 21:24:36.800 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==","status":"read","timestamp":"1751730875","recipient_id":"918130891737","conversation":{"id":"e40c3829d9ca628091d23887d25bbe6a","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:36.802 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:36.805 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:36.806 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.401ms
2025-07-05 21:24:36.810 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==
2025-07-05 21:24:36.815 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==
2025-07-05 21:24:46.710 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 631
2025-07-05 21:24:46.715 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:46.716 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:46.719 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggN0FBRkNCRUNCMjAwRkZDQUVFRUFFRkYwMjk0QzVFNDIA","timestamp":"1751730885","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-05 21:24:46.722 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:46.722 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggN0FBRkNCRUNCMjAwRkZDQUVFRUFFRkYwMjk0QzVFNDIA","timestamp":"1751730885","type":"button","button":{"payload":"Show Products","text":"Show Products"}}]},"field":"messages"}]}]}
2025-07-05 21:24:46.723 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:46.725 +05:30 [INF] 👉 Routing to Click Processor
2025-07-05 21:24:46.727 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.8315ms
2025-07-05 21:24:46.728 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-05 21:24:46.730 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:46.730 +05:30 [INF] 🖱️ Button Click → From: 918130891737, ClickId: wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggN0FBRkNCRUNCMjAwRkZDQUVFRUFFRkYwMjk0QzVFNDIA, OrigMsgId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==, Text: Show Products
2025-07-05 21:24:46.732 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.5138ms
2025-07-05 21:24:46.737 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-05 21:24:46.745 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==', @__originalMessageId_0_contains='%wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-05 21:24:46.748 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 21:24:47.355 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-05 21:24:47.379 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p0='5667cebd-5a4c-417e-aac5-91d5b1691915', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Show Products', @p4='Show Products', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-05T15:54:46.7490785Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='+918130891737', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSQzY0QTgwNTlGNkNBM0Y4MEQ5AA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:24:47.383 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-05 21:24:47.387 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='show products', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-05 21:24:47.390 +05:30 [INF] ✅ Fallback flow step matched: StepId = "4fb7142a-3ee9-45df-87cc-c82c88ccf272", Flow = FirstFlow
2025-07-05 21:24:47.392 +05:30 [INF] 🔁 Matched CTA Step → "4fb7142a-3ee9-45df-87cc-c82c88ccf272"
2025-07-05 21:24:47.393 +05:30 [INF] 🚦 Executing Visual Flow → StepId: "4fb7142a-3ee9-45df-87cc-c82c88ccf272" | TrackingLogId: "5667cebd-5a4c-417e-aac5-91d5b1691915"
2025-07-05 21:24:47.398 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__trackingLogId_0='5667cebd-5a4c-417e-aac5-91d5b1691915'], CommandType='"Text"', CommandTimeout='30']
SELECT t0."Id", t0."Browser", t0."BusinessId", t0."ButtonText", t0."CTAType", t0."CampaignId", t0."CampaignSendLogId", t0."City", t0."ClickedAt", t0."ClickedVia", t0."ContactId", t0."ContactPhone", t0."Country", t0."DeviceType", t0."FollowUpSent", t0."IPAddress", t0."LastInteractionType", t0."MessageId", t0."MessageLogId", t0."Referrer", t0."SessionId", t0."SourceId", t0."SourceType", t0."StepId", t0."TemplateId", t0."ThreadId", t0."Id0", t0."AssignedAgentId", t0."BusinessId0", t0."CreatedAt", t0."Email", t0."Group", t0."IsActive", t0."IsArchived", t0."IsAutomationPaused", t0."IsFavorite", t0."LastCTAInteraction", t0."LastCTAType", t0."LastClickedProductId", t0."LastContactedAt", t0."LeadSource", t0."Name", t0."NextFollowUpAt", t0."Notes", t0."PhoneNumber", t0."Tags", t1."Id", t1."AssignedAt", t1."AssignedBy", t1."BusinessId", t1."ContactId", t1."TagId", t1."Id0", t1."BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
FROM (
    SELECT t."Id", t."Browser", t."BusinessId", t."ButtonText", t."CTAType", t."CampaignId", t."CampaignSendLogId", t."City", t."ClickedAt", t."ClickedVia", t."ContactId", t."ContactPhone", t."Country", t."DeviceType", t."FollowUpSent", t."IPAddress", t."LastInteractionType", t."MessageId", t."MessageLogId", t."Referrer", t."SessionId", t."SourceId", t."SourceType", t."StepId", t."TemplateId", t."ThreadId", c."Id" AS "Id0", c."AssignedAgentId", c."BusinessId" AS "BusinessId0", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "TrackingLogs" AS t
    LEFT JOIN "Contacts" AS c ON t."ContactId" = c."Id"
    WHERE t."Id" = @__trackingLogId_0
    LIMIT 1
) AS t0
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t2."Id" AS "Id0", t2."BusinessId" AS "BusinessId0", t2."Category", t2."ColorHex", t2."CreatedAt", t2."IsActive", t2."IsSystemTag", t2."LastUsedAt", t2."Name", t2."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t2 ON c0."TagId" = t2."Id"
) AS t1 ON t0."Id0" = t1."ContactId"
ORDER BY t0."Id", t0."Id0", t1."Id"
2025-07-05 21:24:47.403 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__nextStepId_1='4fb7142a-3ee9-45df-87cc-c82c88ccf272' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."BusinessId", t."CreatedAt", t."CreatedBy", t."FlowName", t."IsActive", t."IsPublished", t."UpdatedAt", c1."Id", c1."CTAFlowConfigId", c1."PositionX", c1."PositionY", c1."RequiredSource", c1."RequiredTag", c1."StepOrder", c1."TemplateToSend", c1."TemplateType", c1."TriggerButtonText", c1."TriggerButtonType"
FROM (
    SELECT c."Id", c."BusinessId", c."CreatedAt", c."CreatedBy", c."FlowName", c."IsActive", c."IsPublished", c."UpdatedAt"
    FROM "CTAFlowConfigs" AS c
    WHERE c."BusinessId" = @__businessId_0 AND EXISTS (
        SELECT 1
        FROM "CTAFlowSteps" AS c0
        WHERE c."Id" = c0."CTAFlowConfigId" AND c0."Id" = @__nextStepId_1)
    LIMIT 1
) AS t
LEFT JOIN "CTAFlowSteps" AS c1 ON t."Id" = c1."CTAFlowConfigId"
ORDER BY t."Id"
2025-07-05 21:24:47.407 +05:30 [INF] ✅ Follow-up step found and matched → StepId: "4fb7142a-3ee9-45df-87cc-c82c88ccf272", Template: flow_step_4
2025-07-05 21:24:47.409 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:47.410 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:24:48.414 +05:30 [INF] Received HTTP response headers after 1002.749ms - 200
2025-07-05 21:24:48.417 +05:30 [INF] End processing HTTP request after 1008.5375ms - 200
2025-07-05 21:24:48.443 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='c34c2674-0703-4682-8816-bfb21a114c72', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5=NULL (DbType = Guid), @p6='2025-07-05T15:54:48.4222683Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='flow_step_4' (Nullable = false), @p11=NULL, @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"+918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==\",\"message_status\":\"accepted\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='+918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='', @p16='2025-07-05T15:54:48.4222676Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:24:48.450 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='3b6914a0-4964-4eb6-86d3-67a449a40c47', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='+918130891737', @p3=NULL, @p4='2025-07-05T15:54:48.4466906Z' (DbType = DateTime), @p5='a56134f8-4f96-482d-a62b-b40127659609' (Nullable = true), @p6=NULL, @p7='4fb7142a-3ee9-45df-87cc-c82c88ccf272', @p8='' (Nullable = false), @p9='True', @p10='flow_step_4', @p11='text_template', @p12='5667cebd-5a4c-417e-aac5-91d5b1691915' (Nullable = true), @p13='Show Products'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "FlowExecutionLogs" ("Id", "BusinessId", "ContactPhone", "ErrorMessage", "ExecutedAt", "FlowId", "RawResponse", "StepId", "StepName", "Success", "TemplateName", "TemplateType", "TrackingLogId", "TriggeredByButton")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-07-05 21:24:48.453 +05:30 [INF] ✅ Flow step executed → Template: flow_step_4 sent to +918130891737
2025-07-05 21:24:48.455 +05:30 [INF] ⚡ Visual flow triggered via CTA click.
2025-07-05 21:24:49.381 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 602
2025-07-05 21:24:49.385 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:49.386 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:49.389 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"sent","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","expiration_timestamp":"1751730888","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.391 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:49.391 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"sent","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","expiration_timestamp":"1751730888","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.394 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:49.392 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:49.395 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"sent","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","expiration_timestamp":"1751730888","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.396 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.4039ms
2025-07-05 21:24:49.402 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:49.402 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:49.405 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==
2025-07-05 21:24:49.406 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.1041ms
2025-07-05 21:24:49.408 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==
2025-07-05 21:24:49.470 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 566
2025-07-05 21:24:49.474 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:49.475 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:49.479 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"read","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.480 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:49.481 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"read","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.481 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:49.483 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:24:49.485 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==","status":"read","timestamp":"1751730888","recipient_id":"918130891737","conversation":{"id":"09c3dd86043580d944af7d58ac9cd9b6","origin":{"type":"marketing"}},"pricing":{"billable":true,"pricing_model":"PMP","category":"marketing","type":"regular"}}]},"field":"messages"}]}]}
2025-07-05 21:24:49.485 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.671ms
2025-07-05 21:24:49.489 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:24:49.490 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:49.493 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==
2025-07-05 21:24:49.494 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.2496ms
2025-07-05 21:24:49.495 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==
2025-07-05 21:24:59.726 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 508
2025-07-05 21:24:59.729 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:59.731 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:24:59.735 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggNjJBNDMyQTExQjJCMTkzNjRCNTlFQjNFNjAzOUI4MUEA","timestamp":"1751730898","text":{"body":"No i want more products"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:24:59.737 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:24:59.737 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggNjJBNDMyQTExQjJCMTkzNjRCNTlFQjNFNjAzOUI4MUEA","timestamp":"1751730898","text":{"body":"No i want more products"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:24:59.738 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:24:59.740 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:24:59.741 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 8.0492ms
2025-07-05 21:24:59.748 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:24:59.748 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:24:59.751 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:24:59.753 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 26.4366ms
2025-07-05 21:24:59.757 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:24:59.763 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:24:59.766 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:24:59.772 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p0='b73da577-5fe4-42f3-9bd3-0f72b89c207e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:54:59.7691105Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='No i want more products' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:54:59.7691108Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:25:02.378 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='no i want more products'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:25:02.382 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'no i want more products'
2025-07-05 21:25:02.384 +05:30 [INF] 🕵️ No automation flow matched keyword: no i want more products
2025-07-05 21:25:02.385 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:25:13.130 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 629
2025-07-05 21:25:13.135 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:13.136 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:25:13.139 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRkFCQkY1MzM2QTEwRUFFNkFCQjg5QzQxMkI1QTg0RDIA","timestamp":"1751730911","type":"button","button":{"payload":"Send Pricing","text":"Send Pricing"}}]},"field":"messages"}]}]}
2025-07-05 21:25:13.141 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:25:13.142 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"context":{"from":"15556395845","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=="},"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRkFCQkY1MzM2QTEwRUFFNkFCQjg5QzQxMkI1QTg0RDIA","timestamp":"1751730911","type":"button","button":{"payload":"Send Pricing","text":"Send Pricing"}}]},"field":"messages"}]}]}
2025-07-05 21:25:13.143 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:25:13.145 +05:30 [INF] 👉 Routing to Click Processor
2025-07-05 21:25:13.148 +05:30 [WRN] 📥 [ENTERED CLICK PROCESSOR]
2025-07-05 21:25:13.146 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.7742ms
2025-07-05 21:25:13.149 +05:30 [INF] 🖱️ Button Click → From: 918130891737, ClickId: wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRkFCQkY1MzM2QTEwRUFFNkFCQjg5QzQxMkI1QTg0RDIA, OrigMsgId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==, Text: Send Pricing
2025-07-05 21:25:13.151 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:13.155 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.6277ms
2025-07-05 21:25:13.155 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId", c0."Id", c0."BusinessId", c0."CampaignId", c0."CampaignType", c0."CreatedAt", c0."CreatedBy", c0."CtaId", c0."DeletedAt", c0."DeletedBy", c0."FollowUpTemplateId", c0."ImageCaption", c0."ImageUrl", c0."IsDeleted", c0."MessageBody", c0."MessageTemplate", c0."Name", c0."ScheduledAt", c0."SourceCampaignId", c0."Status", c0."TemplateId", c0."TemplateParameters", c0."UpdatedAt", c1."Id", c1."AssignedAgentId", c1."BusinessId", c1."CreatedAt", c1."Email", c1."Group", c1."IsActive", c1."IsArchived", c1."IsAutomationPaused", c1."IsFavorite", c1."LastCTAInteraction", c1."LastCTAType", c1."LastClickedProductId", c1."LastContactedAt", c1."LeadSource", c1."Name", c1."NextFollowUpAt", c1."Notes", c1."PhoneNumber", c1."Tags"
FROM "CampaignSendLogs" AS c
INNER JOIN "Campaigns" AS c0 ON c."CampaignId" = c0."Id"
INNER JOIN "Contacts" AS c1 ON c."ContactId" = c1."Id"
WHERE c."MessageId" = @__originalMessageId_0
LIMIT 1
2025-07-05 21:25:13.163 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__originalMessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==', @__originalMessageId_0_contains='%wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==%'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__originalMessageId_0 OR m."Id"::text = @__originalMessageId_0 OR m."RawResponse" LIKE @__originalMessageId_0_contains
LIMIT 1
2025-07-05 21:25:13.166 +05:30 [INF] ✅ Fallback matched MessageLog. BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 21:25:13.857 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__dto_MessageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA=='], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."MessageId" = @__dto_MessageId_0 OR m."Id"::text = @__dto_MessageId_0
LIMIT 1
2025-07-05 21:25:13.881 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='691b88f2-c331-46ba-bb95-2c3e26117541', @p1='WhatsApp', @p2='c13be597-6ae2-42bb-9d43-925815f24ff8', @p3='Send Pricing', @p4='Send Pricing', @p5=NULL (DbType = Guid), @p6=NULL (DbType = Guid), @p7=NULL, @p8='2025-07-05T15:55:13.1675941Z' (DbType = DateTime), @p9='webhook', @p10=NULL (DbType = Guid), @p11='+918130891737', @p12='Unknown', @p13='Unknown', @p14='False', @p15='webhook', @p16='Clicked', @p17='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSRDUyMEVGQUU5MEJCN0ZFRTY1AA==', @p18=NULL (DbType = Guid), @p19=NULL, @p20=NULL (DbType = Guid), @p21=NULL (DbType = Guid), @p22='flow' (Nullable = false), @p23=NULL (DbType = Guid), @p24=NULL, @p25=NULL (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TrackingLogs" ("Id", "Browser", "BusinessId", "ButtonText", "CTAType", "CampaignId", "CampaignSendLogId", "City", "ClickedAt", "ClickedVia", "ContactId", "ContactPhone", "Country", "DeviceType", "FollowUpSent", "IPAddress", "LastInteractionType", "MessageId", "MessageLogId", "Referrer", "SessionId", "SourceId", "SourceType", "StepId", "TemplateId", "ThreadId")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25);
2025-07-05 21:25:13.885 +05:30 [INF] 📥 Click Tracked → Result: CTA click tracked successfully.
2025-07-05 21:25:13.888 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__normalizedButtonText_1='send pricing', @__normalizedButtonType_2='quick_reply'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CTAFlowConfigId", c."PositionX", c."PositionY", c."RequiredSource", c."RequiredTag", c."StepOrder", c."TemplateToSend", c."TemplateType", c."TriggerButtonText", c."TriggerButtonType", c0."Id", c0."BusinessId", c0."CreatedAt", c0."CreatedBy", c0."FlowName", c0."IsActive", c0."IsPublished", c0."UpdatedAt"
FROM "CTAFlowSteps" AS c
INNER JOIN "CTAFlowConfigs" AS c0 ON c."CTAFlowConfigId" = c0."Id"
WHERE c0."BusinessId" = @__businessId_0 AND c0."IsActive" AND c0."IsPublished" AND lower(c."TriggerButtonText") = @__normalizedButtonText_1 AND lower(c."TriggerButtonType") = @__normalizedButtonType_2
LIMIT 1
2025-07-05 21:25:13.891 +05:30 [WRN] ❌ No fallback step matched for button 'send pricing' of type 'quick_reply' in BusinessId: "c13be597-6ae2-42bb-9d43-925815f24ff8"
2025-07-05 21:25:13.893 +05:30 [INF] 🟡 No visual flow matched for this button: Send Pricing
2025-07-05 21:25:24.815 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 497
2025-07-05 21:25:24.819 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:24.820 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:25:24.823 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRjFCMzc4QjQyQ0U4M0MxQTIyMDYzMzczNTQzN0E2ODkA","timestamp":"1751730923","text":{"body":"Start choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:25:24.825 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:25:24.825 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRjFCMzc4QjQyQ0U4M0MxQTIyMDYzMzczNTQzN0E2ODkA","timestamp":"1751730923","text":{"body":"Start choice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:25:24.826 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:25:24.827 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:25:24.829 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.1137ms
2025-07-05 21:25:24.833 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:25:24.834 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:24.837 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:25:24.838 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 23.0253ms
2025-07-05 21:25:24.842 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:25:24.848 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:25:24.851 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:25:24.875 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='566e4e4c-19d3-42a4-bb09-fe0d5846b713', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:55:24.8546732Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Start choice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:55:24.8546736Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:25:38.748 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 496
2025-07-05 21:25:38.749 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='start choice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:25:38.752 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:38.754 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'start choice'
2025-07-05 21:25:38.757 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:25:38.758 +05:30 [INF] 🕵️ No automation flow matched keyword: start choice
2025-07-05 21:25:38.761 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggQzQ0OTAyQTc2OThDM0JERjgzRkY4QzhGNTMwQ0M3NDMA","timestamp":"1751730930","text":{"body":"Startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:25:38.762 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:25:38.763 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:25:38.765 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggQzQ0OTAyQTc2OThDM0JERjgzRkY4QzhGNTMwQ0M3NDMA","timestamp":"1751730930","text":{"body":"Startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:25:38.765 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:25:38.767 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:25:38.768 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.9758ms
2025-07-05 21:25:38.772 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:25:38.773 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:25:38.774 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.3758ms
2025-07-05 21:25:38.776 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:25:38.784 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:25:38.786 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:25:38.790 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:25:38.798 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@p0='527bb16f-b003-4a4a-b4ec-304eb290f1f3', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:55:38.7946400Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:55:38.7946404Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:25:41.410 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:25:41.431 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:25:41.435 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:25:41.438 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:25:41.439 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 21:25:41.464 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 21:25:41.468 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 21:25:41.474 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:25:41.478 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:25:41.481 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:25:42.686 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:25:42.688 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:25:45.304 +05:30 [INF] Received HTTP response headers after 2613.3469ms - 400
2025-07-05 21:25:45.306 +05:30 [INF] End processing HTTP request after 2619.4763ms - 400
2025-07-05 21:25:45.336 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='176c46d0-8002-401a-983b-970250529985', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:55:45.3089028Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11=NULL, @p12='{"Success":false,"Message":"❌ WhatsApp API returned an error.","Data":null,"ErrorMessage":"API returned error","RawResponse":"{\"error\":{\"message\":\"(#10) Application does not have permission for this action\",\"type\":\"OAuthException\",\"code\":10,\"error_data\":{\"messaging_product\":\"whatsapp\",\"details\":\"There was a problem with the access token or permissions you are using for the API call.\"},\"fbtrace_id\":\"AAy8Nwx7iImVGRjoL2tLiOE\"}}","MessageId":null,"LogId":null,"Token":null,"RefreshToken":null}', @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T15:55:45.3089030Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:25:45.340 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 21:25:45.342 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 21:25:45.345 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:25:45.367 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@p0='3e8512a5-17bb-45a4-a5a2-23b579d1656e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='132f271b-f223-426d-adc9-9a000f447b36', @p3='2025-07-05T15:55:45.3602250Z' (DbType = DateTime), @p4='awaiting_choice' (Nullable = false), @p5='choice'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "ChatSessionStates" ("Id", "BusinessId", "ContactId", "LastUpdatedAt", "Mode", "UpdatedBy")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-05 21:25:45.369 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:26:53.341 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:26:53.354 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-05 21:26:53.348 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-05 21:26:53.348 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:26:53.387 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.391 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.394 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.397 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.399 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:26:53.400 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:26:53.410 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:26:53.398 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 56.255ms
2025-07-05 21:26:53.419 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:26:53.407 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 59.2399ms
2025-07-05 21:26:53.400 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:26:53.438 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-05 21:26:53.410 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:26:53.448 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-05 21:26:53.445 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.425 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-05 21:26:53.452 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.455 +05:30 [INF] GetAllContactsAsync returned 10 contacts
2025-07-05 21:26:53.456 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:53.460 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:26:53.461 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:53.467 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=ZT0TT4CqtvBSv1M3uiKyGQ - null null
2025-07-05 21:26:53.463 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:53.467 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:26:53.462 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:26:53.467 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:53.472 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.474 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 73.3075ms
2025-07-05 21:26:53.475 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 54.0617ms
2025-07-05 21:26:53.477 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 39.8401ms
2025-07-05 21:26:53.480 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:26:53.479 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 68.4883ms
2025-07-05 21:26:53.487 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:26:53.486 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:26:53.499 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 150.5013ms
2025-07-05 21:26:53.501 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 151.483ms
2025-07-05 21:26:53.503 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=W-bw_Xt5AqL19zLrpdZJ_g - null null
2025-07-05 21:26:53.513 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:53.514 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:26:58.880 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:26:58.883 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:26:58.884 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=W-bw_Xt5AqL19zLrpdZJ_g - 101 null null 5381.2276ms
2025-07-05 21:26:58.885 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=ZT0TT4CqtvBSv1M3uiKyGQ - 101 null null 5418.346ms
2025-07-05 21:26:59.383 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 21:26:59.387 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:26:59.389 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 21:26:59.392 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:26:59.394 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.6434ms
2025-07-05 21:26:59.396 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:26:59.398 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 15.2364ms
2025-07-05 21:26:59.486 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 21:26:59.495 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:26:59.501 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 21:26:59.509 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:26:59.515 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 21:26:59.519 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 21:26:59.522 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 21:26:59.524 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 21:26:59.525 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 21:26:59.527 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 21:26:59.528 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 21:26:59.529 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 21:26:59.530 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 21:26:59.532 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 21:26:59.533 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 21:26:59.534 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 21:26:59.535 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 21:26:59.536 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 21:26:59.538 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:26:59.540 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 34.5315ms
2025-07-05 21:26:59.542 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:26:59.544 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 57.4515ms
2025-07-05 21:26:59.600 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:26:59.603 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-05 21:26:59.603 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-05 21:26:59.615 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:26:59.611 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.607 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.615 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.621 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.622 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:26:59.623 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 22.7696ms
2025-07-05 21:26:59.624 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:26:59.624 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:26:59.625 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 10.0522ms
2025-07-05 21:26:59.627 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:26:59.627 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:26:59.634 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:26:59.640 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.651 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.655 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-05 21:26:59.661 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-05 21:26:59.665 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:59.659 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:59.675 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:26:59.670 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-05 21:26:59.676 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:59.678 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:26:59.683 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:26:59.687 +05:30 [INF] GetAllContactsAsync returned 10 contacts
2025-07-05 21:26:59.688 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 61.6205ms
2025-07-05 21:26:59.690 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 65.1934ms
2025-07-05 21:26:59.692 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 33.9187ms
2025-07-05 21:26:59.694 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=RP-1TCqwbtX47tBknqZmKg - null null
2025-07-05 21:26:59.694 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:26:59.705 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:26:59.708 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.710 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 55.6374ms
2025-07-05 21:26:59.711 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 108.5439ms
2025-07-05 21:26:59.713 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:26:59.714 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:26:59.724 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 120.816ms
2025-07-05 21:26:59.735 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=XMDtbqCpqQcToL0z08NFuQ - null null
2025-07-05 21:26:59.738 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:26:59.739 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:27:02.510 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null 0
2025-07-05 21:27:02.516 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:02.520 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:27:02.523 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:27:02.525 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:02.525 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:02.533 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-05 21:27:02.537 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:02.540 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:02.544 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:02.547 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='527bb16f-b003-4a4a-b4ec-304eb290f1f3', @p0='Read' (Nullable = false), @p3='566e4e4c-19d3-42a4-bb09-fe0d5846b713', @p2='Read' (Nullable = false), @p5='8e31ad64-a427-4ac4-ba1d-b181adf64e56', @p4='Read' (Nullable = false), @p7='b73da577-5fe4-42f3-9bd3-0f72b89c207e', @p6='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
UPDATE "MessageLogs" SET "Status" = @p2
WHERE "Id" = @p3;
UPDATE "MessageLogs" SET "Status" = @p4
WHERE "Id" = @p5;
UPDATE "MessageLogs" SET "Status" = @p6
WHERE "Id" = @p7;
2025-07-05 21:27:02.547 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:27:02.548 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:27:02.554 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:27:02.558 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:02.563 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-05 21:27:02.575 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-05 21:27:02.576 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:27:02.578 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 51.4227ms
2025-07-05 21:27:02.579 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 19.5957ms
2025-07-05 21:27:02.581 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:27:02.583 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:27:02.585 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 0 null 75.5507ms
2025-07-05 21:27:02.586 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 61.7186ms
2025-07-05 21:27:02.805 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:27:02.809 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:27:02.811 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 253.6883ms
2025-07-05 21:27:02.812 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:02.813 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:02.816 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:02.817 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 292.8147ms
2025-07-05 21:27:02.819 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:02.824 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:27:02.827 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:02.832 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:27:02.837 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:27:02.839 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 12.8239ms
2025-07-05 21:27:02.841 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:02.843 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 30.5322ms
2025-07-05 21:27:03.336 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__contactId_0='132f271b-f223-426d-adc9-9a000f447b36', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-05 21:27:03.341 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='1996d4f9-d78e-42b0-a685-86338454011e', @p0='2025-07-05T15:57:03.3340374Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-05 21:27:03.346 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:27:03.352 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-05 21:27:06.090 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 518
2025-07-05 21:27:06.093 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:06.094 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:27:06.098 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggQzUyMDM4ODQyMTcxNkQwMDJGRTlFNjIxMDU2MTFGQUYA","timestamp":"1751731023","text":{"body":"I need more info\nPlease guide me"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:27:06.100 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:27:06.101 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggQzUyMDM4ODQyMTcxNkQwMDJGRTlFNjIxMDU2MTFGQUYA","timestamp":"1751731023","text":{"body":"I need more info\nPlease guide me"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:27:06.101 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:06.103 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:27:06.105 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.2092ms
2025-07-05 21:27:06.108 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:06.111 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 21.7798ms
2025-07-05 21:27:06.112 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:27:06.119 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:27:06.123 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:27:06.126 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:06.129 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:27:06.155 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='3f582e54-8233-42a0-8aa7-73161de6cd93', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:57:06.1337590Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='I need more info
Please guide me' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:57:06.1337596Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:27:08.087 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='i need more info
please guide me'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:27:08.090 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'i need more info
please guide me'
2025-07-05 21:27:08.092 +05:30 [INF] 🕵️ No automation flow matched keyword: i need more info
please guide me
2025-07-05 21:27:08.093 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:27:11.511 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:27:11.511 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:27:11.513 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=XMDtbqCpqQcToL0z08NFuQ - 101 null null 11778.4479ms
2025-07-05 21:27:11.514 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=RP-1TCqwbtX47tBknqZmKg - 101 null null 11820.5344ms
2025-07-05 21:27:11.730 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/auth/session - null null
2025-07-05 21:27:11.734 +05:30 [INF] Executing endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:27:11.735 +05:30 [INF] Route matched with {action = "GetSession", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetSession() on controller xbytechat.api.AuthModule.Controllers.AuthController (xbytechat.api).
2025-07-05 21:27:11.738 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:11.740 +05:30 [INF] Executed action xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api) in 2.5434ms
2025-07-05 21:27:11.741 +05:30 [INF] Executed endpoint 'xbytechat.api.AuthModule.Controllers.AuthController.GetSession (xbytechat.api)'
2025-07-05 21:27:11.743 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/auth/session - 200 null application/json; charset=utf-8 13.294ms
2025-07-05 21:27:11.759 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/feature-access/me - null null
2025-07-05 21:27:11.763 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:27:11.764 +05:30 [INF] Route matched with {action = "GetMyFeatures", controller = "FeatureAccess"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.List`1[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto]]] GetMyFeatures() on controller xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController (xbytechat.api).
2025-07-05 21:27:11.769 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", b0."Id", b0."BusinessId", b0."CreatedAt", b0."Plan", b0."QuotaResetDate", b0."RemainingMessages", b0."TotalMonthlyQuota", b0."UpdatedAt", b0."WalletBalance"
FROM "Businesses" AS b
LEFT JOIN "BusinessPlanInfos" AS b0 ON b."Id" = b0."BusinessId"
WHERE b."Id" = @__businessId_0
LIMIT 1
2025-07-05 21:27:11.774 +05:30 [INF] 📦 Resolved plan for Business "c13be597-6ae2-42bb-9d43-925815f24ff8": Smart
2025-07-05 21:27:11.778 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT f."Id", f."BusinessId", f."CreatedAt", f."Description", f."FeatureName", f."Group", f."IsEnabled", f."Notes", f."Plan"
FROM "FeatureAccess" AS f
WHERE f."BusinessId" = @__businessId_0
2025-07-05 21:27:11.781 +05:30 [INF] 🔧 Feature override: AddProduct = False
2025-07-05 21:27:11.782 +05:30 [INF] 🔧 Feature override: Automation = True
2025-07-05 21:27:11.784 +05:30 [INF] 🔧 Feature override: Campaigns = True
2025-07-05 21:27:11.785 +05:30 [INF] 🔧 Feature override: Catalog = True
2025-07-05 21:27:11.786 +05:30 [INF] 🔧 Feature override: CRM = True
2025-07-05 21:27:11.788 +05:30 [INF] 🔧 Feature override: CRMInsights = True
2025-07-05 21:27:11.789 +05:30 [INF] 🔧 Feature override: CTAFlow = True
2025-07-05 21:27:11.792 +05:30 [INF] 🔧 Feature override: FlowInsights = True
2025-07-05 21:27:11.798 +05:30 [INF] 🔧 Feature override: Messaging = True
2025-07-05 21:27:11.799 +05:30 [INF] 🔧 Feature override: ProfileCompletion = True
2025-07-05 21:27:11.800 +05:30 [INF] 🔧 Feature override: UpgradePlan = True
2025-07-05 21:27:11.801 +05:30 [INF] 🔧 Feature override: WhatsAppSettings = True
2025-07-05 21:27:11.802 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.FeatureAccess.DTOs.FeatureStatusDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:27:11.805 +05:30 [INF] Executed action xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api) in 38.4876ms
2025-07-05 21:27:11.806 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.FeatureAccessModule.Controllers.FeatureAccessController.GetMyFeatures (xbytechat.api)'
2025-07-05 21:27:11.808 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/feature-access/me - 200 null application/json; charset=utf-8 48.541ms
2025-07-05 21:27:11.854 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:27:11.855 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/all - null null
2025-07-05 21:27:11.855 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - null null
2025-07-05 21:27:11.858 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.860 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null null
2025-07-05 21:27:11.861 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.865 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.866 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 11.9201ms
2025-07-05 21:27:11.869 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:27:11.870 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.871 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:27:11.872 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:27:11.879 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.880 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 204 null null 19.985ms
2025-07-05 21:27:11.881 +05:30 [INF] Route matched with {action = "GetAllContactsFlat", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAllContactsFlat() on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:27:11.883 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - null 0
2025-07-05 21:27:11.883 +05:30 [INF] Route matched with {action = "GetUnreadCounts", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUnreadCounts() on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:27:11.885 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:27:11.900 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userId_0
2025-07-05 21:27:11.901 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:27:11.906 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=1ayz-jGQAjSpW_pRIMQk7w - null null
2025-07-05 21:27:11.895 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.892 +05:30 [INF] GetAllContactsAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", tab=all
2025-07-05 21:27:11.908 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:27:11.908 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 39.0181ms
2025-07-05 21:27:11.911 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.913 +05:30 [INF] Executing endpoint '/hubs/inbox/negotiate'
2025-07-05 21:27:11.916 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM "Contacts" AS c
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t."Id" AS "Id0", t."BusinessId" AS "BusinessId0", t."Category", t."ColorHex", t."CreatedAt", t."IsActive", t."IsSystemTag", t."LastUsedAt", t."Name", t."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t ON c0."TagId" = t."Id"
) AS t0 ON c."Id" = t0."ContactId"
WHERE c."BusinessId" = @__businessId_0 AND c."IsActive"
ORDER BY c."Id", t0."Id"
2025-07-05 21:27:11.920 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.Dictionary`2[[System.Guid, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:11.924 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:27:11.924 +05:30 [INF] Executed endpoint '/hubs/inbox/negotiate'
2025-07-05 21:27:11.929 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api) in 31.1859ms
2025-07-05 21:27:11.935 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/hubs/inbox/negotiate?negotiateVersion=1 - 200 316 application/json 51.8114ms
2025-07-05 21:27:11.927 +05:30 [INF] GetAllContactsAsync returned 10 contacts
2025-07-05 21:27:11.937 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetUnreadCounts (xbytechat.api)'
2025-07-05 21:27:11.942 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Linq.Enumerable+SelectListIterator`2[[xbytechat.api.CRM.Models.Contact, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[xbytechat.api.CRM.Dtos.ContactDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:27:11.943 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/unread-counts - 200 null application/json; charset=utf-8 87.3668ms
2025-07-05 21:27:11.945 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=_gAUwoGiY5nPz_RptTOBpw - null null
2025-07-05 21:27:11.945 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api) in 53.8165ms
2025-07-05 21:27:11.952 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:11.954 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetAllContactsFlat (xbytechat.api)'
2025-07-05 21:27:11.955 +05:30 [INF] Executing endpoint '/hubs/inbox'
2025-07-05 21:27:11.956 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/all - 200 null application/json; charset=utf-8 100.6296ms
2025-07-05 21:27:13.530 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null 0
2025-07-05 21:27:13.558 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:13.559 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:13.576 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:13.580 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:27:13.583 +05:30 [INF] Route matched with {action = "GetMessagesByContact", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetMessagesByContact(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:27:13.567 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:13.592 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:13.595 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status", c."Id", c."BusinessId", c."CampaignId", c."CampaignType", c."CreatedAt", c."CreatedBy", c."CtaId", c."DeletedAt", c."DeletedBy", c."FollowUpTemplateId", c."ImageCaption", c."ImageUrl", c."IsDeleted", c."MessageBody", c."MessageTemplate", c."Name", c."ScheduledAt", c."SourceCampaignId", c."Status", c."TemplateId", c."TemplateParameters", c."UpdatedAt"
FROM "MessageLogs" AS m
LEFT JOIN "Campaigns" AS c ON m."CampaignId" = c."Id"
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1
ORDER BY m."CreatedAt"
2025-07-05 21:27:13.564 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:13.599 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:27:13.601 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.MessageManagement.DTOs.MessageLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:27:13.605 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:27:13.608 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:13.609 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api) in 18.6715ms
2025-07-05 21:27:13.614 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:27:13.615 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.GetMessagesByContact (xbytechat.api)'
2025-07-05 21:27:13.610 +05:30 [INF] Route matched with {action = "MarkMessagesAsRead", controller = "Inbox"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MarkMessagesAsRead(System.Guid) on controller xbytechat.api.Features.Inbox.Controllers.InboxController (xbytechat.api).
2025-07-05 21:27:13.618 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:27:13.619 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/inbox/messages?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 59.8919ms
2025-07-05 21:27:13.628 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 20.5939ms
2025-07-05 21:27:13.626 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessId_0 AND m."ContactId" = @__contactId_1 AND m."IsIncoming" AND m."Status" <> 'Read'
2025-07-05 21:27:13.632 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - null null
2025-07-05 21:27:13.634 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:13.643 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:27:13.645 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 86.4134ms
2025-07-05 21:27:13.646 +05:30 [INF] Executing endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:13.655 +05:30 [INF] Route matched with {action = "GetContactById", controller = "Contacts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContactById(System.Guid) on controller xbytechat.api.CRM.Controllers.ContactsController (xbytechat.api).
2025-07-05 21:27:13.657 +05:30 [INF] Executed DbCommand (18ms) [Parameters=[@p1='3f582e54-8233-42a0-8aa7-73161de6cd93', @p0='Read' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
UPDATE "MessageLogs" SET "Status" = @p0
WHERE "Id" = @p1;
2025-07-05 21:27:13.658 +05:30 [INF] GetContactByIdAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:13.661 +05:30 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-07-05 21:27:13.665 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."AssignedAgentId", t."BusinessId", t."CreatedAt", t."Email", t."Group", t."IsActive", t."IsArchived", t."IsAutomationPaused", t."IsFavorite", t."LastCTAInteraction", t."LastCTAType", t."LastClickedProductId", t."LastContactedAt", t."LeadSource", t."Name", t."NextFollowUpAt", t."Notes", t."PhoneNumber", t."Tags", t0."Id", t0."AssignedAt", t0."AssignedBy", t0."BusinessId", t0."ContactId", t0."TagId", t0."Id0", t0."BusinessId0", t0."Category", t0."ColorHex", t0."CreatedAt", t0."IsActive", t0."IsSystemTag", t0."LastUsedAt", t0."Name", t0."Notes"
FROM (
    SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
    FROM "Contacts" AS c
    WHERE c."BusinessId" = @__businessId_0 AND c."Id" = @__contactId_1 AND c."IsActive"
    LIMIT 1
) AS t
LEFT JOIN (
    SELECT c0."Id", c0."AssignedAt", c0."AssignedBy", c0."BusinessId", c0."ContactId", c0."TagId", t1."Id" AS "Id0", t1."BusinessId" AS "BusinessId0", t1."Category", t1."ColorHex", t1."CreatedAt", t1."IsActive", t1."IsSystemTag", t1."LastUsedAt", t1."Name", t1."Notes"
    FROM "ContactTags" AS c0
    INNER JOIN "Tags" AS t1 ON c0."TagId" = t1."Id"
) AS t0 ON t."Id" = t0."ContactId"
ORDER BY t."Id", t0."Id"
2025-07-05 21:27:13.665 +05:30 [INF] Executed action xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api) in 42.3119ms
2025-07-05 21:27:13.671 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Helpers.ResponseResult'.
2025-07-05 21:27:13.673 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Inbox.Controllers.InboxController.MarkMessagesAsRead (xbytechat.api)'
2025-07-05 21:27:13.675 +05:30 [INF] Executed action xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api) in 17.0901ms
2025-07-05 21:27:13.676 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/inbox/mark-read?contactId=132f271b-f223-426d-adc9-9a000f447b36 - 200 0 null 146.438ms
2025-07-05 21:27:13.678 +05:30 [INF] Executed endpoint 'xbytechat.api.CRM.Controllers.ContactsController.GetContactById (xbytechat.api)'
2025-07-05 21:27:13.684 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/contacts/132f271b-f223-426d-adc9-9a000f447b36 - 200 null application/json; charset=utf-8 51.2442ms
2025-07-05 21:27:14.350 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__contactId_0='132f271b-f223-426d-adc9-9a000f447b36', @__userGuid_1='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."ContactId" = @__contactId_0 AND c."UserId" = @__userGuid_1
LIMIT 1
2025-07-05 21:27:14.373 +05:30 [INF] Executed DbCommand (19ms) [Parameters=[@p1='1996d4f9-d78e-42b0-a685-86338454011e', @p0='2025-07-05T15:57:14.3487431Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ContactReads" SET "LastReadAt" = @p0
WHERE "Id" = @p1;
2025-07-05 21:27:14.378 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessGuid_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT m."Id", m."BusinessId", m."CTAFlowConfigId", m."CTAFlowStepId", m."CampaignId", m."ContactId", m."CreatedAt", m."ErrorMessage", m."IsIncoming", m."MediaUrl", m."MessageContent", m."MessageId", m."RawResponse", m."RecipientNumber", m."RefMessageId", m."RenderedBody", m."SentAt", m."Source", m."Status"
FROM "MessageLogs" AS m
WHERE m."BusinessId" = @__businessGuid_0 AND m."IsIncoming" AND m."ContactId" IS NOT NULL
2025-07-05 21:27:14.383 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__userGuid_0='2870e1d8-0e80-4b12-88bd-70a8113307d6'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastReadAt", c."UserId"
FROM "ContactReads" AS c
WHERE c."UserId" = @__userGuid_0
2025-07-05 21:27:50.536 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 496
2025-07-05 21:27:50.540 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:50.541 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:27:50.544 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggMjEwQzBFNDQ1MUQ3QkIwRkU0RDYwM0M0NjEwQTcyMDAA","timestamp":"1751731069","text":{"body":"Startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:27:50.545 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:27:50.546 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggMjEwQzBFNDQ1MUQ3QkIwRkU0RDYwM0M0NjEwQTcyMDAA","timestamp":"1751731069","text":{"body":"Startchoice"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:27:50.546 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:50.548 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:27:50.549 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 6.1103ms
2025-07-05 21:27:50.554 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:50.554 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:27:50.562 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 24.9127ms
2025-07-05 21:27:50.565 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:27:50.573 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:27:50.576 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:50.580 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:27:50.602 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='359211eb-2860-4b5c-b22b-cf0efd77595a', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:57:50.5825560Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Startchoice' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:57:50.5825565Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:27:52.630 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='startchoice'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:27:52.634 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:27:52.638 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:27:52.642 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:52.644 +05:30 [INF] 🚀 Running flow 'Choice Flow' for keyword 'startchoice'
2025-07-05 21:27:52.646 +05:30 [INF] ➡️ Running node: "Message" | start
2025-07-05 21:27:52.647 +05:30 [INF] 📤 Sending message: Hi 👋 What would you like to know? Type: price, features, or help
2025-07-05 21:27:52.649 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:27:52.652 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:27:52.656 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:27:53.904 +05:30 [INF] Start processing HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:27:53.907 +05:30 [INF] Sending HTTP request POST https://graph.facebook.com/v22.0/601884673011340/messages
2025-07-05 21:27:55.215 +05:30 [INF] Received HTTP response headers after 1306.7923ms - 200
2025-07-05 21:27:55.217 +05:30 [INF] End processing HTTP request after 1313.6582ms - 200
2025-07-05 21:27:55.241 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='d437c397-96a7-42e1-86c2-bc894b40fbd4', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:57:55.2206232Z' (DbType = DateTime), @p7=NULL, @p8='False', @p9=NULL, @p10='Hi 👋 What would you like to know? Type: price, features, or help' (Nullable = false), @p11='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==', @p12='{"Success":true,"Message":"✅ Message sent successfully","Data":null,"ErrorMessage":null,"RawResponse":"{\"messaging_product\":\"whatsapp\",\"contacts\":[{\"input\":\"918130891737\",\"wa_id\":\"918130891737\"}],\"messages\":[{\"id\":\"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==\"}]}","MessageId":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","LogId":null,"Token":null,"RefreshToken":null}', @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15='Hi 👋 What would you like to know? Type: price, features, or help', @p16='2025-07-05T15:57:55.2206233Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='Sent' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:27:55.245 +05:30 [INF] ➡️ Running node: "Choice" | choice
2025-07-05 21:27:55.246 +05:30 [INF] 🧠 Reached Choice node. Saving session state to wait for user input...
2025-07-05 21:27:55.249 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:27:55.255 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@p1='3e8512a5-17bb-45a4-a5a2-23b579d1656e', @p0='2025-07-05T15:57:55.2531184Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE "ChatSessionStates" SET "LastUpdatedAt" = @p0
WHERE "Id" = @p1;
2025-07-05 21:27:55.258 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:27:56.143 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 613
2025-07-05 21:27:56.146 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:56.147 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:27:56.278 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"sent","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","expiration_timestamp":"1751731075","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.280 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 577
2025-07-05 21:27:56.293 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:27:56.293 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:56.293 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"sent","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","expiration_timestamp":"1751731075","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.294 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:56.295 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:27:56.297 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:27:56.301 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"sent","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","expiration_timestamp":"1751731075","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.300 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"read","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.298 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 147.9022ms
2025-07-05 21:27:56.306 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:27:56.307 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:27:56.313 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:56.316 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==
2025-07-05 21:27:56.317 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:27:56.321 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 177.4114ms
2025-07-05 21:27:56.322 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==
2025-07-05 21:27:56.324 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 24.4346ms
2025-07-05 21:27:56.329 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"read","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.330 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:27:56.332 +05:30 [INF] 📦 Routing to Status Processor
2025-07-05 21:27:56.333 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 53.0922ms
2025-07-05 21:27:56.334 +05:30 [WRN] 🔍 Incoming timestamp raw value: {"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"statuses":[{"id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==","status":"read","timestamp":"1751731075","recipient_id":"918130891737","conversation":{"id":"368b23be806dc4a0466355db6fc7aa36","origin":{"type":"service"}},"pricing":{"billable":false,"pricing_model":"PMP","category":"service","type":"free_customer_service"}}]},"field":"messages"}]}]}
2025-07-05 21:27:56.342 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__messageId_0='wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA=='], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."MessageId" = @__messageId_0
LIMIT 1
2025-07-05 21:27:56.345 +05:30 [WRN] ⚠️ CampaignSendLog not found for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==
2025-07-05 21:27:56.346 +05:30 [WRN] ⚠️ No matching CampaignSendLog for MessageId: wamid.HBgMOTE4MTMwODkxNzM3FQIAERgSMjVBQ0Y4M0RBNTA1RERENDQwAA==
2025-07-05 21:28:05.584 +05:30 [INF] Request starting HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - application/json 490
2025-07-05 21:28:05.588 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:28:05.590 +05:30 [INF] Route matched with {action = "HandleStatus", controller = "WhatsAppWebhook"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult HandleStatus(System.Text.Json.JsonElement) on controller xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController (xbytechat.api).
2025-07-05 21:28:05.592 +05:30 [WRN] 📥 Webhook received at controller:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRUFGMkJDQzc0MjA1RTYxMzk2NjJFQzUxNzUzMTMxREEA","timestamp":"1751731084","text":{"body":"Price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:28:05.595 +05:30 [INF] 📥 Webhook payload enqueued successfully.
2025-07-05 21:28:05.595 +05:30 [WRN] 📦 Dispatcher Raw Payload:
{"object":"whatsapp_business_account","entry":[{"id":"999432368375320","changes":[{"value":{"messaging_product":"whatsapp","metadata":{"display_phone_number":"15556395845","phone_number_id":"601884673011340"},"contacts":[{"profile":{"name":"Digital Buz"},"wa_id":"918130891737"}],"messages":[{"from":"918130891737","id":"wamid.HBgMOTE4MTMwODkxNzM3FQIAEhggRUFGMkJDQzc0MjA1RTYxMzk2NjJFQzUxNzUzMTMxREEA","timestamp":"1751731084","text":{"body":"Price"},"type":"text"}]},"field":"messages"}]}]}
2025-07-05 21:28:05.596 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType73`1[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:28:05.598 +05:30 [INF] 💬 Routing to InboundMessageProcessor (type: text)
2025-07-05 21:28:05.600 +05:30 [INF] Executed action xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api) in 7.8255ms
2025-07-05 21:28:05.604 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessNumber_0='15556395845'], CommandType='"Text"', CommandTimeout='30']
SELECT b."Id", b."Address", b."ApprovedAt", b."ApprovedBy", b."BusinessEmail", b."BusinessName", b."CompanyName", b."CompanyPhone", b."CreatedAt", b."CreatedBy", b."CreatedByPartnerId", b."DeletedAt", b."DeletedBy", b."Industry", b."IsApproved", b."IsDeleted", b."LastLoginAt", b."LogoUrl", b."Notes", b."Phone", b."RepresentativeName", b."Source", b."Status", b."Tags", b."Website", w."Id", w."ApiToken", w."ApiUrl", w."BusinessId", w."CreatedAt", w."IsActive", w."PhoneNumberId", w."SenderDisplayName", w."UpdatedAt", w."WabaId", w."WhatsAppBusinessNumber"
FROM "Businesses" AS b
LEFT JOIN "WhatsAppSettings" AS w ON b."Id" = w."BusinessId"
WHERE w."WhatsAppBusinessNumber" = @__businessNumber_0
LIMIT 1
2025-07-05 21:28:05.605 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.Webhooks.Controllers.WhatsAppWebhookController.HandleStatus (xbytechat.api)'
2025-07-05 21:28:05.608 +05:30 [INF] FindOrCreateAsync: businessId="c13be597-6ae2-42bb-9d43-925815f24ff8", phoneNumber=918130891737
2025-07-05 21:28:05.610 +05:30 [INF] Request finished HTTP/1.1 POST http://432f-2401-4900-5955-c839-5138-bd4a-4b6c-e260.ngrok-free.app/api/webhooks/whatsapp - 200 null application/json; charset=utf-8 25.8948ms
2025-07-05 21:28:05.614 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__phoneNumber_1='918130891737'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AssignedAgentId", c."BusinessId", c."CreatedAt", c."Email", c."Group", c."IsActive", c."IsArchived", c."IsAutomationPaused", c."IsFavorite", c."LastCTAInteraction", c."LastCTAType", c."LastClickedProductId", c."LastContactedAt", c."LeadSource", c."Name", c."NextFollowUpAt", c."Notes", c."PhoneNumber", c."Tags"
FROM "Contacts" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."PhoneNumber" = @__phoneNumber_1
LIMIT 1
2025-07-05 21:28:05.620 +05:30 [INF] Contact already exists: contactId="132f271b-f223-426d-adc9-9a000f447b36"
2025-07-05 21:28:05.624 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__contactId_1='132f271b-f223-426d-adc9-9a000f447b36'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."BusinessId", c."ContactId", c."LastUpdatedAt", c."Mode", c."UpdatedBy"
FROM "ChatSessionStates" AS c
WHERE c."BusinessId" = @__businessId_0 AND c."ContactId" = @__contactId_1
LIMIT 1
2025-07-05 21:28:05.649 +05:30 [INF] Executed DbCommand (20ms) [Parameters=[@p0='682ad188-56ff-416f-aa73-7148a11e3af4', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2=NULL (DbType = Guid), @p3=NULL (DbType = Guid), @p4=NULL (DbType = Guid), @p5='132f271b-f223-426d-adc9-9a000f447b36' (Nullable = true), @p6='2025-07-05T15:58:05.6280562Z' (DbType = DateTime), @p7=NULL, @p8='True', @p9=NULL, @p10='Price' (Nullable = false), @p11=NULL, @p12=NULL, @p13='918130891737' (Nullable = false), @p14=NULL (DbType = Guid), @p15=NULL, @p16='2025-07-05T15:58:05.6280566Z' (Nullable = true) (DbType = DateTime), @p17=NULL, @p18='received' (Nullable = false)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "MessageLogs" ("Id", "BusinessId", "CTAFlowConfigId", "CTAFlowStepId", "CampaignId", "ContactId", "CreatedAt", "ErrorMessage", "IsIncoming", "MediaUrl", "MessageContent", "MessageId", "RawResponse", "RecipientNumber", "RefMessageId", "RenderedBody", "SentAt", "Source", "Status")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-07-05 21:28:07.230 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__keyword_2='price'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."BusinessId", a."CreatedAt", a."EdgesJson", a."IsActive", a."Name", a."NodesJson", a."TriggerKeyword", a."UpdatedAt"
FROM "AutomationFlows" AS a
WHERE a."BusinessId" = @__businessId_0 AND a."TriggerKeyword" ILIKE @__keyword_2 ESCAPE '' AND a."IsActive"
LIMIT 1
2025-07-05 21:28:07.234 +05:30 [INF] TryRun: No matching automation flow found for keyword: 'price'
2025-07-05 21:28:07.235 +05:30 [INF] 🕵️ No automation flow matched keyword: price
2025-07-05 21:28:07.237 +05:30 [INF] 🚫 Skipping inbox sync: chat mode is not 'agent'
2025-07-05 21:29:47.207 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:29:47.209 +05:30 [INF] Executed endpoint '/hubs/inbox'
2025-07-05 21:29:47.217 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=_gAUwoGiY5nPz_RptTOBpw - 101 null null 155272.4845ms
2025-07-05 21:29:47.218 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/hubs/inbox?id=1ayz-jGQAjSpW_pRIMQk7w - 101 null null 155312.4588ms
2025-07-05 21:29:52.400 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-05 21:29:52.405 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:29:52.406 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:29:52.417 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:29:52.437 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-05 21:29:52.446 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-05 21:29:52.450 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:29:52.453 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 33.8883ms
2025-07-05 21:29:52.455 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:29:52.456 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 56.0874ms
2025-07-05 21:29:55.320 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - null null
2025-07-05 21:29:55.321 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - null null
2025-07-05 21:29:55.337 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:29:55.348 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:29:55.348 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api)'
2025-07-05 21:29:55.349 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api)'
2025-07-05 21:29:55.354 +05:30 [INF] Route matched with {action = "GetLogsByCampaign", controller = "CampaignSendLog"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetLogsByCampaign(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController (xbytechat.api).
2025-07-05 21:29:55.356 +05:30 [INF] Route matched with {action = "GetCampaignSummary", controller = "CampaignSendLog"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCampaignSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController (xbytechat.api).
2025-07-05 21:29:55.370 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."CampaignId" = @__campaignId_0
2025-07-05 21:29:55.387 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Features.CampaignTracking.DTOs.CampaignLogSummaryDto'.
2025-07-05 21:29:55.391 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api) in 32.1879ms
2025-07-05 21:29:55.393 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetCampaignSummary (xbytechat.api)'
2025-07-05 21:29:55.395 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - 200 null application/json; charset=utf-8 73.7782ms
2025-07-05 21:29:55.397 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."CampaignId", c."ContactId", c0."Name" AS "ContactName", c0."PhoneNumber" AS "ContactPhone", c."MessageBody", c."TemplateId", c."SendStatus", c."ErrorMessage", c."CreatedAt", c."SentAt", c."DeliveredAt", c."ReadAt", c."IpAddress", c."DeviceInfo", c."MacAddress", c."SourceChannel", c."IsClicked", c."ClickedAt", c."ClickType"
FROM "CampaignSendLogs" AS c
INNER JOIN "Contacts" AS c0 ON c."ContactId" = c0."Id"
WHERE c."CampaignId" = @__campaignId_0
2025-07-05 21:29:55.407 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CampaignTracking.DTOs.CampaignSendLogDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:29:55.419 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api) in 62.3342ms
2025-07-05 21:29:55.421 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignSendLogController.GetLogsByCampaign (xbytechat.api)'
2025-07-05 21:29:55.424 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaign-logs/campaign/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0 - 200 null application/json; charset=utf-8 103.654ms
2025-07-05 21:30:40.044 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-05 21:30:40.048 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:30:40.050 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:30:40.051 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:30:40.059 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-05 21:30:40.076 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-05 21:30:40.080 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:30:40.082 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 26.9491ms
2025-07-05 21:30:40.085 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:30:40.087 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 43.2986ms
2025-07-05 21:30:41.817 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - null null
2025-07-05 21:30:41.820 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:30:41.821 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:30:41.828 +05:30 [INF] Route matched with {action = "GetSummary", controller = "CampaignAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto]] GetSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController (xbytechat.api).
2025-07-05 21:30:48.562 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - null null
2025-07-05 21:30:48.566 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."CampaignId" = @__campaignId_0
2025-07-05 21:30:48.578 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:30:48.582 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:30:48.584 +05:30 [INF] Route matched with {action = "GetPaginatedCampaigns", controller = "Campaign"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPaginatedCampaigns(xbytechat.api.Shared.PaginatedRequest) on controller xbytechat.api.Features.CampaignModule.Controllers.CampaignController (xbytechat.api).
2025-07-05 21:30:48.585 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:30:48.588 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT count(*)::int
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
2025-07-05 21:30:48.595 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8', @__p_2='10', @__p_1='0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Name", c."Status", c."ScheduledAt", c."CreatedAt"
FROM "Campaigns" AS c
WHERE c."BusinessId" = @__businessId_0
ORDER BY c."CreatedAt" DESC
LIMIT @__p_2 OFFSET @__p_1
2025-07-05 21:30:48.599 +05:30 [INF] Executing OkObjectResult, writing value of type 'xbytechat.api.Shared.PaginatedResponse`1[[xbytechat.api.Features.CampaignModule.DTOs.CampaignSummaryDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:30:48.601 +05:30 [INF] Executed action xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api) in 14.5647ms
2025-07-05 21:30:48.603 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignModule.Controllers.CampaignController.GetPaginatedCampaigns (xbytechat.api)'
2025-07-05 21:30:48.604 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/Campaign/paginated?page=1&pageSize=10&status= - 200 null application/json; charset=utf-8 42.4452ms
2025-07-05 21:30:48.622 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api) in 6791.2401ms
2025-07-05 21:30:48.624 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:30:48.625 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - 200 null application/json; charset=utf-8 6808.8876ms
2025-07-05 21:30:52.671 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - null null
2025-07-05 21:30:52.684 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:30:52.690 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:30:52.693 +05:30 [INF] Route matched with {action = "GetSummary", controller = "CampaignAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto]] GetSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController (xbytechat.api).
2025-07-05 21:30:54.251 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__campaignId_0='3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."AllowRetry", c."Browser", c."BusinessId", c."CampaignId", c."City", c."ClickType", c."ClickedAt", c."ContactId", c."Country", c."CreatedAt", c."CreatedBy", c."DeliveredAt", c."DeviceInfo", c."DeviceType", c."ErrorMessage", c."IpAddress", c."IsClicked", c."LastRetryAt", c."LastRetryStatus", c."MacAddress", c."MessageBody", c."MessageId", c."MessageLogId", c."ReadAt", c."RecipientId", c."RetryCount", c."SendStatus", c."SentAt", c."SourceChannel", c."TemplateId", c."UserId"
FROM "CampaignSendLogs" AS c
WHERE c."CampaignId" = @__campaignId_0
2025-07-05 21:30:54.255 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:30:54.258 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api) in 1562.5978ms
2025-07-05 21:30:54.261 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:30:54.262 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/3b5d1770-f5ec-4890-90ae-7bfd58fe0ae0/summary - 200 null application/json; charset=utf-8 1591.1784ms
2025-07-05 21:31:13.153 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/:campaignId/summary - null null
2025-07-05 21:31:13.163 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:31:13.166 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:31:13.168 +05:30 [INF] Route matched with {action = "GetSummary", controller = "CampaignAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto]] GetSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController (xbytechat.api).
2025-07-05 21:31:13.181 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-05 21:31:13.207 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api) in 36.4723ms
2025-07-05 21:31:13.209 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:31:13.211 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/:campaignId/summary - 400 null application/problem+json; charset=utf-8 57.5138ms
2025-07-05 21:31:27.948 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/:campaignId/summary - null null
2025-07-05 21:31:27.952 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:31:27.953 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:31:27.955 +05:30 [INF] Route matched with {action = "GetSummary", controller = "CampaignAnalytics"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[xbytechat.api.Features.CampaignTracking.DTOs.CampaignStatusDashboardDto]] GetSummary(System.Guid) on controller xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController (xbytechat.api).
2025-07-05 21:31:27.957 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-05 21:31:27.959 +05:30 [INF] Executed action xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api) in 2.6102ms
2025-07-05 21:31:27.961 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CampaignTracking.Controllers.CampaignAnalyticsController.GetSummary (xbytechat.api)'
2025-07-05 21:31:27.962 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/campaigns/analytics/:campaignId/summary - 400 null application/problem+json; charset=utf-8 14.9245ms
2025-07-05 21:47:49.808 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/ctamanagement/get-all - null null
2025-07-05 21:47:49.823 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:47:49.825 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api)'
2025-07-05 21:47:49.831 +05:30 [INF] Route matched with {action = "GetAll", controller = "CTAManagement"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController (xbytechat.api).
2025-07-05 21:47:50.022 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Title", c."ButtonText", c."ButtonType", c."TargetUrl", c."Description", c."IsActive"
FROM "CTADefinitions" AS c
WHERE c."IsActive" AND c."BusinessId" = @__businessId_0
2025-07-05 21:47:50.026 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAManagement.DTOs.CTADefinitionDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:47:50.028 +05:30 [INF] Executed action xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api) in 194.7704ms
2025-07-05 21:47:50.030 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api)'
2025-07-05 21:47:50.032 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/ctamanagement/get-all - 200 null application/json; charset=utf-8 224.1721ms
2025-07-05 21:47:53.280 +05:30 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:7113/api/ctamanagement/create - null null
2025-07-05 21:47:53.285 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:47:53.288 +05:30 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:7113/api/ctamanagement/create - 204 null null 8.5284ms
2025-07-05 21:47:53.291 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:7113/api/ctamanagement/create - application/json 79
2025-07-05 21:47:53.305 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:47:53.306 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.Create (xbytechat.api)'
2025-07-05 21:47:53.313 +05:30 [INF] Route matched with {action = "Create", controller = "CTAManagement"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(xbytechat.api.Features.CTAManagement.DTOs.CTADefinitionDto) on controller xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController (xbytechat.api).
2025-07-05 21:47:54.937 +05:30 [INF] Executed DbCommand (21ms) [Parameters=[@p0='ab93b531-ecd8-43c5-a6b9-ff327df0309e', @p1='c13be597-6ae2-42bb-9d43-925815f24ff8', @p2='' (Nullable = false), @p3='url' (Nullable = false), @p4='2025-07-05T16:17:54.8882867Z' (DbType = DateTime), @p5='' (Nullable = false), @p6='True', @p7='' (Nullable = false), @p8='' (Nullable = false), @p9=NULL (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "CTADefinitions" ("Id", "BusinessId", "ButtonText", "ButtonType", "CreatedAt", "Description", "IsActive", "TargetUrl", "Title", "UpdatedAt")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
2025-07-05 21:47:54.943 +05:30 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType16`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-05 21:47:54.945 +05:30 [INF] Executed action xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.Create (xbytechat.api) in 1629.7217ms
2025-07-05 21:47:54.947 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.Create (xbytechat.api)'
2025-07-05 21:47:54.948 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:7113/api/ctamanagement/create - 200 null application/json; charset=utf-8 1656.6316ms
2025-07-05 21:47:54.953 +05:30 [INF] Request starting HTTP/1.1 GET http://localhost:7113/api/ctamanagement/get-all - null null
2025-07-05 21:47:54.957 +05:30 [INF] CORS policy execution successful.
2025-07-05 21:47:54.960 +05:30 [INF] Executing endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api)'
2025-07-05 21:47:54.962 +05:30 [INF] Route matched with {action = "GetAll", controller = "CTAManagement"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController (xbytechat.api).
2025-07-05 21:47:54.968 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[@__businessId_0='c13be597-6ae2-42bb-9d43-925815f24ff8'], CommandType='"Text"', CommandTimeout='30']
SELECT c."Id", c."Title", c."ButtonText", c."ButtonType", c."TargetUrl", c."Description", c."IsActive"
FROM "CTADefinitions" AS c
WHERE c."IsActive" AND c."BusinessId" = @__businessId_0
2025-07-05 21:47:54.973 +05:30 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[xbytechat.api.Features.CTAManagement.DTOs.CTADefinitionDto, xbytechat.api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-07-05 21:47:54.978 +05:30 [INF] Executed action xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api) in 13.242ms
2025-07-05 21:47:54.981 +05:30 [INF] Executed endpoint 'xbytechat.api.Features.CTAManagement.Controllers.CTAManagementController.GetAll (xbytechat.api)'
2025-07-05 21:47:54.983 +05:30 [INF] Request finished HTTP/1.1 GET http://localhost:7113/api/ctamanagement/get-all - 200 null application/json; charset=utf-8 29.7937ms
